/*! For license information please see vendors~element-web-app.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[29],{1313:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.default=t.ReactReduxContext=void 0;var i=a(n(0)).default.createContext(null);t.ReactReduxContext=i;var r=i;t.default=r},1314:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(3),o=n(75),s=n(67),l=n(4),c=n(6),d=n(22),u=n(12),m=n(7),h=n(5),p=n(15);class g extends s.EventEmitter{constructor(...e){super(...e),i()(this,"crawlerCheckpoints",[]),i()(this,"crawler",null),i()(this,"currentCheckpoint",null),i()(this,"onSync",(async(e,t,n)=>{var a;const i=null===(a=o.a.get())||void 0===a?void 0:a.getEventIndexingManager();if(i){if("PREPARED"===t&&"SYNCING"===e){return await i.isEventIndexEmpty()&&await this.addInitialCheckpoints(),void this.startCrawler()}"SYNCING"===t&&"SYNCING"===e&&await i.commitLiveEvents()}})),i()(this,"onRoomTimeline",(async(e,t,n,a,i)=>{if(!t)return;const r=m.a.safeGet();return r.isRoomEncrypted(e.getRoomId())?e.isRedaction()?this.redactEvent(e):void(!n&&i&&i.liveEvent&&!e.isRedacted()&&(await r.decryptEventIfNeeded(e),await this.addLiveEventToIndex(e))):void 0})),i()(this,"onRoomStateEvent",(async(e,t)=>{m.a.safeGet().isRoomEncrypted(t.roomId)&&(e.getType()!==l.EventType.RoomEncryption||await this.isRoomIndexed(t.roomId)||(r.a.log("EventIndex: Adding a checkpoint for a newly encrypted room",t.roomId),this.addRoomCheckpoint(t.roomId,!0)))})),i()(this,"redactEvent",(async e=>{var t;const n=null===(t=o.a.get())||void 0===t?void 0:t.getEventIndexingManager();if(!n)return;const a=e.getAssociatedId();if(a)try{await n.deleteEvent(a)}catch(e){r.a.log("EventIndex: Error deleting event from index",e)}})),i()(this,"onTimelineReset",(async e=>{e&&m.a.safeGet().isRoomEncrypted(e.roomId)&&(r.a.log("EventIndex: Adding a checkpoint because of a limited timeline",e.roomId),this.addRoomCheckpoint(e.roomId,!1))}))}async init(){var e;const t=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();t&&(this.crawlerCheckpoints=await t.loadCheckpoints(),r.a.log("EventIndex: Loaded checkpoints",this.crawlerCheckpoints),this.registerListeners())}registerListeners(){const e=m.a.safeGet();e.on(d.b.Sync,this.onSync),e.on(l.RoomEvent.Timeline,this.onRoomTimeline),e.on(l.RoomEvent.TimelineReset,this.onTimelineReset),e.on(l.RoomStateEvent.Events,this.onRoomStateEvent)}removeListeners(){const e=m.a.get();null!==e&&(e.removeListener(d.b.Sync,this.onSync),e.removeListener(l.RoomEvent.Timeline,this.onRoomTimeline),e.removeListener(l.RoomEvent.TimelineReset,this.onTimelineReset),e.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvent))}async addInitialCheckpoints(){var e;const t=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();if(!t)return;const n=m.a.safeGet(),a=n.getRooms().filter((e=>n.isRoomEncrypted(e.roomId)));r.a.log("EventIndex: Adding initial crawler checkpoints"),await Promise.all(a.map((async e=>{const n=e.getLiveTimeline().getPaginationToken(l.Direction.Backward),a={roomId:e.roomId,token:n,direction:l.Direction.Backward,fullCrawl:!0},i={roomId:e.roomId,token:n,direction:l.Direction.Forward};try{a.token&&(await t.addCrawlerCheckpoint(a),this.crawlerCheckpoints.push(a)),i.token&&(await t.addCrawlerCheckpoint(i),this.crawlerCheckpoints.push(i))}catch(t){r.a.log("EventIndex: Error adding initial checkpoints for room",e.roomId,a,i,t)}})))}isValidEvent(e){const t=[l.EventType.RoomMessage,l.EventType.RoomName,l.EventType.RoomTopic].includes(e.getType())&&!e.isRedacted()&&!e.isDecryptionFailure();let n=!0,a=!0;if(e.getType()!==l.EventType.RoomMessage||e.isRedacted())e.getType()!==l.EventType.RoomTopic||e.isRedacted()?e.getType()!==l.EventType.RoomName||e.isRedacted()||e.getContent().name||(a=!1):e.getContent().topic||(a=!1);else{const t=e.getContent().msgtype;n=!!t&&!t.startsWith("m.key.verification"),e.getContent().body||(a=!1)}return t&&n&&a}eventToJson(e){const t=e.toJSON(),n=e.isEncrypted()?t.decrypted:t;return e.isEncrypted()?(n.curve25519Key=e.getSenderKey(),n.ed25519Key=e.getClaimedEd25519Key(),n.algorithm=e.getWireContent().algorithm,n.forwardingCurve25519KeyChain=e.getForwardingCurve25519KeyChain()):(delete n.curve25519Key,delete n.ed25519Key,delete n.algorithm,delete n.forwardingCurve25519KeyChain),n}async addLiveEventToIndex(e){var t,n,a;const i=null===(t=o.a.get())||void 0===t?void 0:t.getEventIndexingManager();if(!i||!this.isValidEvent(e))return;const r=this.eventToJson(e),s={displayname:null===(n=e.sender)||void 0===n?void 0:n.rawDisplayName,avatar_url:null===(a=e.sender)||void 0===a?void 0:a.getMxcAvatarUrl()};await i.addEventToIndex(r,s)}emitNewCheckpoint(){this.emit("changedCheckpoint",this.currentRoom())}async addEventsFromLiveTimeline(e){const t=e.getEvents();for(let e=0;e<t.length;e++){const n=t[e];await this.addLiveEventToIndex(n)}}async addRoomCheckpoint(e,t=!1){var n;const a=null===(n=o.a.get())||void 0===n?void 0:n.getEventIndexingManager();if(!a)return;const i=m.a.safeGet().getRoom(e);if(!i)return;const s=i.getLiveTimeline(),c=s.getPaginationToken(l.Direction.Backward);if(!c)return void await this.addEventsFromLiveTimeline(s);const d={roomId:i.roomId,token:c,fullCrawl:t,direction:l.Direction.Backward};r.a.log("EventIndex: Adding checkpoint",d);try{await a.addCrawlerCheckpoint(d)}catch(e){r.a.log("EventIndex: Error adding new checkpoint for room",i.roomId,d,e)}this.crawlerCheckpoints.push(d)}async crawlerFunc(){var e;let t=!1;const n=m.a.safeGet(),a=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();if(!a)return;this.crawler={cancel:()=>{t=!0}};let i=!1;for(;!t;){let e=h.b.getValueAt(p.a.DEVICE,"crawlerSleepTime");if(e=Math.max(e,100),i&&(e=5e3),null!==this.currentCheckpoint&&(this.currentCheckpoint=null,this.emitNewCheckpoint()),await Object(c.N)(e),t)break;const o=this.crawlerCheckpoints.shift();if(void 0===o){i=!0;continue}this.currentCheckpoint=o,this.emitNewCheckpoint(),i=!1;const s=n.getEventMapper({preventReEmit:!0});let l;try{l=await n.createMessagesRequest(o.roomId,o.token,100,o.direction)}catch(e){if(e instanceof u.c&&403===e.httpStatus){r.a.log("EventIndex: Removing checkpoint as we don't have ","permissions to fetch messages from this room.",o);try{await a.removeCrawlerCheckpoint(o)}catch(e){r.a.log("EventIndex: Error removing checkpoint",o,e)}continue}r.a.log("EventIndex: Error crawling using checkpoint:",o,",",e),this.crawlerCheckpoints.push(o);continue}if(t){this.crawlerCheckpoints.push(o);break}if(0===l.chunk.length){r.a.log("EventIndex: Done with the checkpoint",o);try{await a.removeCrawlerCheckpoint(o)}catch(e){r.a.log("EventIndex: Error removing checkpoint",o,e)}continue}const d=l.chunk.map(s);let m=[];void 0!==l.state&&(m=l.state.map(s));const g={};m.forEach((e=>{"join"===e.getContent().membership&&(g[e.getSender()]={displayname:e.getContent().displayname,avatar_url:e.getContent().avatar_url})}));const b=d.filter((e=>e.isEncrypted())).map((e=>n.decryptEventIfNeeded(e,{isRetry:!0,emit:!1})));await Promise.all(b);const v=d.filter(this.isValidEvent),f=d.filter((e=>e.isRedaction())),y=v.map((e=>{const t=this.eventToJson(e);let n={};t.sender in g&&(n=g[t.sender]);return{event:t,profile:n}}));let E=null;l.end&&(E={roomId:o.roomId,token:l.end,fullCrawl:o.fullCrawl,direction:o.direction});try{for(let e=0;e<f.length;e++){const t=f[e],n=t.getAssociatedId();n?await a.deleteEvent(n):r.a.warn("EventIndex: Redaction event doesn't contain a valid associated event id",t)}const e=await a.addHistoricEvents(y,E,o);if(!E){r.a.log("EventIndex: The server didn't return a valid ","new checkpoint, not continuing the crawl.",o);continue}!0===e&&!0!==E.fullCrawl?(r.a.log("EventIndex: Checkpoint had already all events","added, stopping the crawl",o),await a.removeCrawlerCheckpoint(E)):(!0===e&&r.a.log("EventIndex: Checkpoint had already all events","added, but continuing due to a full crawl",o),this.crawlerCheckpoints.push(E))}catch(e){r.a.log("EventIndex: Error during a crawl",e),this.crawlerCheckpoints.push(o)}}this.crawler=null}startCrawler(){null===this.crawler&&this.crawlerFunc()}stopCrawler(){null!==this.crawler&&this.crawler.cancel()}async close(){var e;const t=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();this.removeListeners(),this.stopCrawler(),await(null==t?void 0:t.closeEventIndex())}async search(e){var t;const n=null===(t=o.a.get())||void 0===t?void 0:t.getEventIndexingManager();return null==n?void 0:n.searchEventIndex(e)}async loadFileEvents(e,t=10,n,a=l.EventTimeline.BACKWARDS){var i;const s=m.a.safeGet(),c=null===(i=o.a.get())||void 0===i?void 0:i.getEventIndexingManager();if(!c)return[];const d={roomId:e.roomId,limit:t};let u;n&&(d.fromEvent=n,d.direction=a);try{u=await c.loadFileEvents(d)}catch(e){return r.a.log("EventIndex: Error getting file events",e),[]}const h=s.getEventMapper();return u.map((t=>{const n=h(t.event),a=new l.RoomMember(e.roomId,n.getSender());a.name=t.profile.displayname+" ("+n.getSender()+")";const i=h({content:{membership:"join",avatar_url:t.profile.avatar_url,displayname:t.profile.displayname},type:l.EventType.RoomMember,event_id:n.getId()+":eventIndex",room_id:n.getRoomId(),sender:n.getSender(),origin_server_ts:n.getTs(),state_key:n.getSender()});return a.events.member=i,n.sender=a,n}))}async populateFileTimeline(e,t,n,a=10,i,o=l.EventTimeline.BACKWARDS){const s=await this.loadFileEvents(n,a,i,o);null===i&&(s.reverse(),o=o==l.EventTimeline.BACKWARDS?l.EventTimeline.FORWARDS:l.EventTimeline.BACKWARDS),s.forEach((n=>{e.eventIdToTimeline(n.getId())||e.addEventToTimeline(n,t,o==l.EventTimeline.BACKWARDS)}));let c=!1,d="";return s.length>0&&(d=s[s.length-1].getId(),c=!0),r.a.log("EventIndex: Populating file panel with",s.length,"events and setting the pagination token to",d),t.setPaginationToken(d,l.EventTimeline.BACKWARDS),c}paginateTimelineWindow(e,t,n,a){const i=t.getTimelineIndex(n);if(!i)return Promise.resolve(!1);if(i.pendingPaginate)return i.pendingPaginate;if(t.extend(n,a))return Promise.resolve(!0);const r=(async(e,t,n,a,i)=>{var r;const o=t.timeline,s=o.getTimelineSet(),l=null!==(r=o.getPaginationToken(a))&&void 0!==r?r:void 0,c=await this.populateFileTimeline(s,o,n,i,l,a);return t.pendingPaginate=void 0,e.extend(a,i),c})(t,i,e,n,a);return i.pendingPaginate=r,r}async getStats(){var e;const t=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();return null==t?void 0:t.getStats()}async isRoomIndexed(e){var t;const n=null===(t=o.a.get())||void 0===t?void 0:t.getEventIndexingManager();return null==n?void 0:n.isRoomIndexed(e)}currentRoom(){if(null===this.currentCheckpoint&&0===this.crawlerCheckpoints.length)return null;const e=m.a.safeGet();return null!==this.currentCheckpoint?e.getRoom(this.currentCheckpoint.roomId):e.getRoom(this.crawlerCheckpoints[0].roomId)}crawlingRooms(){const e=new Set,t=new Set;this.crawlerCheckpoints.forEach(((e,n)=>{t.add(e.roomId)})),null!==this.currentCheckpoint&&t.add(this.currentCheckpoint.roomId);const n=m.a.safeGet();return n.getRooms().filter((e=>n.isRoomEncrypted(e.roomId))).forEach(((t,n)=>{e.add(t.roomId)})),{crawlingRooms:t,totalRooms:e}}}class b{constructor(){i()(this,"index",null),i()(this,"error",void 0),i()(this,"_supportIsInstalled",!1)}async init(){var e;const t=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();return t?(this._supportIsInstalled=await t.supportsEventIndexing(),this.supportIsInstalled()?h.b.getValueAt(p.a.DEVICE,"enableEventIndexing")?this.initEventIndex():(r.a.log("EventIndex: Event indexing is disabled, not initializing"),!1):(r.a.log("EventIndex: Event indexing isn't installed for the platform, not initializing."),!1)):(r.a.log("EventIndex: Platform doesn't support event indexing, not initializing."),!1)}async initEventIndex(){var e;const t=new g,n=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager(),a=m.a.get();if(!n||!a)throw new Error("Unable to init event index");const i=a.getUserId(),s=a.getDeviceId();try{await n.initEventIndex(i,s);const e=await n.getUserVersion(),a=await n.isEventIndexEmpty();a?await n.setUserVersion(1):0!==e||a||(await n.closeEventIndex(),await this.deleteEventIndex(),await n.initEventIndex(i,s),await n.setUserVersion(1)),r.a.log("EventIndex: Successfully initialized the event index"),await t.init()}catch(e){return r.a.log("EventIndex: Error initializing the event index",e),this.error=e,!1}return this.index=t,!0}platformHasSupport(){var e;return null!=(null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager())}supportIsInstalled(){return this._supportIsInstalled}get(){return this.index}start(){null!==this.index&&this.index.startCrawler()}stop(){null!==this.index&&this.index.stopCrawler()}async unset(){null!==this.index&&(await this.index.close(),this.index=null)}async deleteEventIndex(){var e;const t=null===(e=o.a.get())||void 0===e?void 0:e.getEventIndexingManager();t&&(await this.unset(),r.a.log("EventIndex: Deleting event index."),await t.deleteEventIndex())}}window.mxEventIndexPeg||(window.mxEventIndexPeg=new b);t.a=window.mxEventIndexPeg},1317:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(13),l=n.n(s),c=n(25),d=n(229),u=n(2),m=n(46),h=n(7);class p extends r.PureComponent{constructor(...e){super(...e),i()(this,"validate",Object(d.a)({description:function(e){const t=e?e.score:0;return o.a.createElement("progress",{className:"mx_PassphraseField_progress",max:4,value:t})},deriveData:async({value:e})=>{if(!e)return null;const{scorePassword:t}=await n.e(33).then(n.bind(null,1431));return t(h.a.get(),e,this.props.userInputs)},rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(u.b)(this.props.labelEnterPassword)},{key:"complexity",test:async function({value:e},t){if(!e||!t)return!1;const n=t.score>=this.props.minScore;return c.b.get("dangerously_allow_unsafe_and_insecure_passwords")||n},valid:function(e){return e&&e.score>=this.props.minScore?Object(u.b)(this.props.labelStrongPassword):Object(u.b)(this.props.labelAllowedButUnsafe)},invalid:function(e){if(!e)return null;const{feedback:t}=e;return t.warning||t.suggestions[0]||Object(u.b)("Keep going…")}}],memoize:!0})),i()(this,"onValidate",(async e=>{const t=await this.validate(e);return this.props.onValidate&&this.props.onValidate(t),t}))}render(){return o.a.createElement(m.a,{id:this.props.id,autoFocus:this.props.autoFocus,className:l()("mx_PassphraseField",this.props.className),ref:this.props.fieldRef,type:"password",autoComplete:"new-password",label:Object(u.b)(this.props.label),value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate})}}i()(p,"defaultProps",{label:Object(u.d)("Password"),labelEnterPassword:Object(u.d)("Enter password"),labelStrongPassword:Object(u.d)("Nice, strong password!"),labelAllowedButUnsafe:Object(u.d)("Password is allowed, but unsafe")}),t.a=p},1318:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(0),i=n.n(a),r=n(420),o=n(22),s=n(3),l=n(2),c=n(25);const d=[r.a.ERROR_INVALID_HOMESERVER,r.a.ERROR_INVALID_IDENTITY_SERVER];class u{static isLivelinessError(e){return!!e&&!!d.find((t=>e instanceof Error?t===e.message:t===e))}static authComponentStateForError(e,t="login"){if(!e)return{serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:null};let n=Object(l.b)("Cannot reach homeserver"),a=Object(l.b)("Ensure you have a stable internet connection, or get in touch with the server admin");if(!u.isLivelinessError(e)){const e=c.b.get().brand;n=Object(l.b)("Your %(brand)s is misconfigured",{brand:e}),a=Object(l.b)("Ask your %(brand)s admin to check <a>your config</a> for incorrect or duplicate entries.",{brand:e},{a:e=>i.a.createElement("a",{href:"https://github.com/vector-im/element-web/blob/master/docs/config.md",target:"_blank",rel:"noreferrer noopener"},e)})}let o=!0;return(e instanceof Error?e.message:e)===r.a.ERROR_INVALID_IDENTITY_SERVER&&(o=!1,n=Object(l.b)("Cannot reach identity server"),a="register"===t?Object(l.b)("You can register, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin."):"reset_password"===t?Object(l.b)("You can reset your password, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin."):Object(l.b)("You can log in, but some features will be unavailable until the identity server is back online. If you keep seeing this warning, check your configuration or contact a server admin.")),{serverIsAlive:!1,serverErrorIsFatal:o,serverDeadError:i.a.createElement("div",null,i.a.createElement("strong",null,n),i.a.createElement("div",null,a))}}static async validateServerConfigWithStaticUrls(e,t,n=!1){if(!e)throw new l.a("No homeserver URL provided");const a={"m.homeserver":{base_url:e}};t&&(a["m.identity_server"]={base_url:t});const i=await r.a.fromDiscoveryConfig(a),o=new URL(e).hostname;return u.buildValidatedConfigFromDiscovery(o,i,n,!0)}static async validateServerName(e){const t=await r.a.findClientConfig(e);return u.buildValidatedConfigFromDiscovery(e,t)}static buildValidatedConfigFromDiscovery(e,t,n=!1,a=!1){var i;if(null==t||!t["m.homeserver"])throw s.a.error("Ended up in a state of not knowing which homeserver to connect to."),new l.a("Unexpected error resolving homeserver configuration");const d=t["m.homeserver"],m=t["m.identity_server"],h=c.b.get("validated_server_config");let p=h&&h.isUrl;var g;if(m&&m.state===r.a.SUCCESS)p=null!==(g=m.base_url)&&void 0!==g?g:void 0;else if(m&&m.state!==r.a.PROMPT){if(s.a.error("Error determining preferred identity server URL:",m),m.state===r.a.FAIL_ERROR){if(-1!==r.a.ALL_ERRORS.indexOf(m.error))throw new l.a(String(m.error));throw new l.a("Unexpected error resolving identity server configuration")}d.error=r.a.ERROR_INVALID_IDENTITY_SERVER,m.base_url&&(p=m.base_url)}if(d.state!==r.a.SUCCESS&&(s.a.error("Error processing homeserver config:",d),!n||!u.isLivelinessError(d.error))){if(-1!==r.a.ALL_ERRORS.indexOf(d.error))throw new l.a(String(d.error));throw new l.a("Unexpected error resolving homeserver configuration")}const b=d.base_url;if(!b)throw s.a.error("No homeserver URL configured"),new l.a("Unexpected error resolving homeserver configuration");let v=null!=e?e:d.server_name;const f=new URL(b);if(v||(v=f.hostname),!v)throw s.a.error("Failed to parse homeserver name from homeserver URL"),new l.a("Unexpected error resolving homeserver configuration");let y;if((null===(i=t[o.c.stable])||void 0===i?void 0:i.state)===r.a.SUCCESS){const{authorizationEndpoint:e,registrationEndpoint:n,tokenEndpoint:a,account:i,issuer:r,metadata:s,signingKeys:l}=t[o.c.stable];y=Object.freeze({authorizationEndpoint:e,registrationEndpoint:n,tokenEndpoint:a,account:i,issuer:r,metadata:s,signingKeys:l})}return{hsUrl:b,hsName:v,hsNameIsDifferent:f.hostname!==v,isUrl:p,isDefault:!1,warning:d.error,isNameResolvable:!a,delegatedAuthentication:y}}}},1319:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));let a=function(e){return e.Verified="Verified",e.Unverified="Unverified",e.Inactive="Inactive",e.Unverifiable="Unverifiable",e}({})},1320:function(e,t,n){"use strict";n.d(t,"c",(function(){return It})),n.d(t,"a",(function(){return Tt}));var a=n(17),i=n.n(a),r=n(1),o=n.n(r),s=n(0),l=n.n(s),c=n(13),d=n.n(c),u=n(4),m=n(30),h=n(3),p=n(18),g=n(47),b=n(2),v=n(9),f=n(45),y=n(5),E=n(230),w=n(14),S=n(38),_=n(1444),C=n(214),O=n(10),x=n(141),k=n(28),R=n(7);class j extends l.a.Component{constructor(e,t){super(e,t),o()(this,"context",void 0),o()(this,"unmounted",!1),o()(this,"room",void 0),o()(this,"blockquoteRef",l.a.createRef()),o()(this,"canCollapse",(()=>this.state.events.length>1)),o()(this,"collapse",(()=>{this.initialize()})),o()(this,"onQuoteClick",(async()=>{if(!this.state.loadedEv)return;const e=[this.state.loadedEv,...this.state.events];let t=null;e.length>0&&(t=await this.getNextEvent(e[0])),this.setState({loadedEv:t,events:e}),v.a.fire(w.a.FocusSendMessageComposer)})),this.state={events:[],loadedEv:null,loading:!0,err:!1},this.room=this.matrixClient.getRoom(this.props.parentEv.getRoomId())}get matrixClient(){return R.a.safeGet()}componentDidMount(){this.initialize(),this.trySetExpandableQuotes()}componentDidUpdate(){var e,t;null===(e=(t=this.props).onHeightChanged)||void 0===e||e.call(t),this.trySetExpandableQuotes()}componentWillUnmount(){this.unmounted=!0}trySetExpandableQuotes(){if(void 0===this.props.isQuoteExpanded&&this.blockquoteRef.current){const e=this.blockquoteRef.current.querySelector(".mx_EventTile_body");if(e){const t=e.querySelector("code"),n=!!t&&t.offsetHeight>=60;(e.offsetHeight>=60||n)&&this.props.setQuoteExpanded(!1)}}}async initialize(){const{parentEv:e}=this.props,t=await this.getEvent(Object(x.b)(e));if(!this.unmounted)if(t){const e=await this.getNextEvent(t);this.setState({events:[t],loadedEv:e,loading:!1})}else this.setState({err:!0})}async getNextEvent(e){try{const t=Object(x.b)(e);return t?await this.getEvent(t):null}catch(e){return null}}async getEvent(e){var t;if(!e)return null;const n=this.room.findEventById(e);if(n)return n;try{await this.matrixClient.getEventTimeline(this.room.getUnfilteredTimelineSet(),e)}catch(e){return null}return null!==(t=this.room.findEventById(e))&&void 0!==t?t:null}getReplyChainColorClass(e){return Object(E.f)(e.getSender()).replace("Username","ReplyChain")}render(){let e;if(this.state.err)e=l.a.createElement("blockquote",{className:"mx_ReplyChain mx_ReplyChain_error"},Object(b.b)("Unable to load event that was replied to, it either does not exist or you do not have permission to view it."));else if(this.state.loadedEv&&Object(x.c)(this.state.events[0])){const t=this.state.loadedEv,n=this.matrixClient.getRoom(t.getRoomId());e=l.a.createElement("blockquote",{className:`mx_ReplyChain ${this.getReplyChainColorClass(t)}`},Object(b.b)("<a>In reply to</a> <pill>",{},{a:e=>l.a.createElement(O.a,{kind:"link_inline",className:"mx_ReplyChain_show",onClick:this.onQuoteClick},e),pill:l.a.createElement(C.a,{type:C.b.UserMention,room:null!=n?n:void 0,url:Object(f.g)(t.getSender()),shouldShowPillAvatar:y.b.getValue("Pill.shouldShowPillAvatar")})}))}else if(this.props.forExport){const t=Object(x.b)(this.props.parentEv);e=l.a.createElement("p",{className:"mx_ReplyChain_Export"},Object(b.b)("In reply to <a>this message</a>",{},{a:e=>l.a.createElement("a",{className:"mx_reply_anchor",href:`#${t}`,"data-scroll-to":t}," ",e," ")}))}else this.state.loading&&(e=l.a.createElement(S.a,{w:16,h:16}));const{isQuoteExpanded:t}=this.props,n=this.state.events.map((e=>{const n=d()({mx_ReplyChain:!0,[this.getReplyChainColorClass(e)]:!0,"mx_ReplyChain--expanded":!0===t,"mx_ReplyChain--collapsed":!1===t});return l.a.createElement("blockquote",{ref:this.blockquoteRef,className:n,key:e.getId()},l.a.createElement(_.a,{mxEvent:e,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator,toggleExpandedQuote:()=>this.props.setQuoteExpanded(!this.props.isQuoteExpanded),getRelationsForEvent:this.props.getRelationsForEvent}))}));return l.a.createElement("div",{className:"mx_ReplyChain_wrapper"},l.a.createElement("div",null,e),l.a.createElement("div",null,n))}}o()(j,"contextType",k.b);var I,T=n(256),P=n(71),N=n(796),D=n(237),M=n(92),A=n(668),L=n(70),U=n(88),F=n(106),B=n(638),V=n(233),W=n(75),z=n(116),H=n(1394),G=n(736),K=n(105),q=n(1355);function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},$.apply(this,arguments)}function Y(e){return s.createElement("svg",$({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),I||(I=s.createElement("path",{d:"M3 14h12M5 10.5l7-7",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}var J,Q=n(1396);function X(){return X=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},X.apply(this,arguments)}function Z(e){return s.createElement("svg",X({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 17 16",role:"presentation","aria-hidden":!0},e),J||(J=s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M4.523 2.964a6.418 6.418 0 0110.36 4.369h1.29c.26 0 .416.292.272.51l-2.006 3.011a.327.327 0 01-.544 0l-2.006-3.012a.327.327 0 01.272-.509h1.21a4.918 4.918 0 00-7.918-3.192 3.684 3.684 0 01-.184.136l-.014.01-.004.003-.002.001h-.001v.001l-.415-.625.414.625a.75.75 0 01-.83-1.25l.003-.001.02-.014a1.7 1.7 0 00.083-.063zm-.895 5.703H4.84a.327.327 0 00.272-.51L3.106 5.146a.327.327 0 00-.545 0L.555 8.157a.328.328 0 00.273.51h1.29a6.418 6.418 0 0010.503 4.251.75.75 0 00-.963-1.15 4.918 4.918 0 01-8.03-3.102z",clipRule:"evenodd"})))}var ee,te;function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ne.apply(this,arguments)}function ae(e){return s.createElement("svg",ne({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),ee||(ee=s.createElement("path",{fill:"currentColor",d:"M5 5.25a.75.75 0 000 1.5h8a.75.75 0 000-1.5H5zm0 3a.75.75 0 000 1.5h4a.75.75 0 100-1.5H5z"})),te||(te=s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M3 .25A2.75 2.75 0 00.25 3v14a.75.75 0 001.2.6L4.916 15c.217-.162.48-.25.75-.25H15A2.75 2.75 0 0017.75 12V3A2.75 2.75 0 0015 .25H3zM1.75 3c0-.69.56-1.25 1.25-1.25h12c.69 0 1.25.56 1.25 1.25v9c0 .69-.56 1.25-1.25 1.25H5.666a2.75 2.75 0 00-1.65.55L1.75 15.5V3z",clipRule:"evenodd"})))}var ie;function re(){return re=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},re.apply(this,arguments)}function oe(e){return s.createElement("svg",re({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),ie||(ie=s.createElement("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V9c0-1.1-.9-2-2-2H8c-1.1 0-2 .9-2 2v10zM18 4h-2.5l-.71-.71c-.18-.18-.44-.29-.7-.29H9.91c-.26 0-.52.11-.7.29L8.5 4H6c-.55 0-1 .45-1 1s.45 1 1 1h12c.55 0 1-.45 1-1s-.45-1-1-1z",fill:"currentColor"})))}var se,le=n(1397);function ce(){return ce=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ce.apply(this,arguments)}function de(e){return s.createElement("svg",ce({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 14",role:"presentation","aria-hidden":!0},e),se||(se=s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M.22 8.494a.753.753 0 011.062-.002l3.724 3.7L8.718 8.48a.753.753 0 011.062-.002.747.747 0 01.002 1.06L5.54 13.78a.753.753 0 01-1.063.002L.221 9.552a.747.747 0 01-.002-1.058zm9.562-2.988a.753.753 0 01-1.062.002l-3.724-3.7L1.283 5.52a.753.753 0 01-1.062.002.747.747 0 01-.002-1.06L4.462.22A.753.753 0 015.524.218l4.257 4.23a.747.747 0 01.001 1.058z",clipRule:"evenodd"})))}var ue;function me(){return me=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},me.apply(this,arguments)}function he(e){return s.createElement("svg",me({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 11 14",role:"presentation","aria-hidden":!0},e),ue||(ue=s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M.22.234A.753.753 0 011.281.232l3.724 3.7L8.718.22A.753.753 0 019.781.218a.747.747 0 01.001 1.06L5.54 5.52a.753.753 0 01-1.063.002L.221 1.292A.747.747 0 01.219.235zm9.562 13.532a.753.753 0 01-1.062.002l-3.724-3.7-3.713 3.712a.753.753 0 01-1.062.002.747.747 0 01-.002-1.06L4.462 8.48a.753.753 0 011.062-.002l4.257 4.23a.747.747 0 01.001 1.058z",clipRule:"evenodd"})))}var pe=n(97),ge=n(423),be=n(68),ve=n(320),fe=n(261),ye=n(872),Ee=n(785);class we extends l.a.PureComponent{constructor(e){super(e),o()(this,"downloader",new Ee.a),o()(this,"onDownloadClick",(async()=>{const e=this.props.mediaEventHelperGet();if(this.state.loading||!e)return;if(e.media.isEncrypted&&this.setState({tooltip:Object(b.d)("Decrypting")}),this.setState({loading:!0}),this.state.blob)return this.doDownload(this.state.blob);const t=await e.sourceBlob.value;this.setState({blob:t}),await this.doDownload(t)})),this.state={loading:!1,tooltip:Object(b.d)("Downloading")}}async doDownload(e){await this.downloader.download({blob:e,name:this.props.mediaEventHelperGet().fileName}),this.setState({loading:!1})}render(){let e;this.state.loading&&(e=l.a.createElement(S.a,{w:18,h:18}));const t=d()({mx_MessageActionBar_iconButton:!0,mx_MessageActionBar_downloadButton:!0,mx_MessageActionBar_downloadSpinnerButton:!!e});return l.a.createElement(be.b,{className:t,title:e?Object(b.b)(this.state.tooltip):Object(b.b)("Download"),onClick:this.onDownloadClick,disabled:!!e},l.a.createElement(ye.Icon,null),e)}}var Se=n(658),_e=n(348),Ce=n(20),Oe=n(16),xe=n(155);const ke=({mxEvent:e,getTile:t,getReplyChain:n,permalinkCreator:a,onFocusChange:r,getRelationsForEvent:o})=>{const[c,d,u,m]=Object(L.q)(),[h,p]=Object(be.i)(d);Object(s.useEffect)((()=>{r(c)}),[r,c]);const g=Object(s.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),u(),h()}),[u,h]);let v;if(c&&d.current){const r=null==t?void 0:t(),s=n(),c=d.current.getBoundingClientRect();v=l.a.createElement(A.a,i()({},Object(L.i)(c),{mxEvent:e,permalinkCreator:a,eventTileOps:r&&r.getEventTileOps?r.getEventTileOps():void 0,collapseReplyChain:null!=s&&s.canCollapse()?s.collapse:void 0,onFinished:m,getRelationsForEvent:o}))}return l.a.createElement(l.a.Fragment,null,l.a.createElement(L.c,{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_optionsButton",title:Object(b.b)("Options"),onClick:g,onContextMenu:g,isExpanded:c,inputRef:d,onFocus:h,tabIndex:p?0:-1},l.a.createElement(q.a,null)),v)},Re=({mxEvent:e,reactions:t,onFocusChange:n})=>{const[a,r,o,c]=Object(L.q)(),[d,u]=Object(be.i)(r);let m;if(Object(s.useEffect)((()=>{n(a)}),[n,a]),a&&r.current){const n=r.current.getBoundingClientRect();m=l.a.createElement(L.n,i()({},Object(L.i)(n),{onFinished:c,managed:!1}),l.a.createElement(Se.a,{mxEvent:e,reactions:t,onFinished:c}))}const h=Object(s.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),o(),d()}),[o,d]);return l.a.createElement(l.a.Fragment,null,l.a.createElement(L.c,{className:"mx_MessageActionBar_iconButton",title:Object(b.b)("React"),onClick:h,onContextMenu:h,isExpanded:a,inputRef:r,onFocus:d,tabIndex:u?0:-1},l.a.createElement(Q.a,null)),m)},je=({mxEvent:e})=>{var t;const n=Object(s.useContext)(_e.a),a=null==e||null===(t=e.getRelation())||void 0===t?void 0:t.rel_type,i=!!a&&a!==u.RelationType.Thread,r=t=>{t.preventDefault(),t.stopPropagation();const a=e.getThread();null!=a&&a.rootEvent&&!e.isThreadRoot?v.b.dispatch({action:w.a.ShowThread,rootEvent:a.rootEvent,initialEvent:e,scroll_into_view:!0,highlighted:!0,push:n.isCard}):v.b.dispatch({action:w.a.ShowThread,rootEvent:e,push:n.isCard})};return l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_threadButton",disabled:i,tooltip:l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},i?Object(b.b)("Can't create a thread from an event with an existing relation"):Object(b.b)("Reply in thread"))),title:i?Object(b.b)("Can't create a thread from an event with an existing relation"):Object(b.b)("Reply in thread"),onClick:r,onContextMenu:r},l.a.createElement(ae,null))};class Ie extends l.a.PureComponent{constructor(...e){super(...e),o()(this,"onDecrypted",(()=>{this.forceUpdate()})),o()(this,"onBeforeRedaction",(()=>{this.forceUpdate()})),o()(this,"onSent",(()=>{this.forceUpdate()})),o()(this,"onFocusChange",(e=>{var t,n;null===(t=(n=this.props).onFocusChange)||void 0===t||t.call(n,e)})),o()(this,"onReplyClick",(e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:"reply_to_event",event:this.props.mxEvent,context:this.context.timelineRenderingType})})),o()(this,"onEditClick",(e=>{e.preventDefault(),e.stopPropagation(),Object(pe.e)(R.a.safeGet(),this.props.mxEvent,this.context.timelineRenderingType,this.props.getRelationsForEvent)})),o()(this,"forbiddenThreadHeadMsgType",[u.MsgType.KeyVerificationRequest]),o()(this,"onResendClick",(e=>{e.preventDefault(),e.stopPropagation(),this.runActionOnFailedEv((e=>ve.a.resend(R.a.safeGet(),e)))})),o()(this,"onCancelClick",(e=>{this.runActionOnFailedEv((e=>ve.a.removeFromQueue(R.a.safeGet(),e)),(e=>Object(pe.b)(e.status)))}))}componentDidMount(){this.props.mxEvent.status&&this.props.mxEvent.status!==u.EventStatus.SENT&&this.props.mxEvent.on(u.MatrixEventEvent.Status,this.onSent);R.a.safeGet().decryptEventIfNeeded(this.props.mxEvent),this.props.mxEvent.isBeingDecrypted()&&this.props.mxEvent.once(u.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.on(u.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction)}componentWillUnmount(){this.props.mxEvent.off(u.MatrixEventEvent.Status,this.onSent),this.props.mxEvent.off(u.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.off(u.MatrixEventEvent.BeforeRedaction,this.onBeforeRedaction)}get showReplyInThreadAction(){const e=this.context.timelineRenderingType!==k.a.Thread,t=!(this.forbiddenThreadHeadMsgType.includes(this.props.mxEvent.getContent().msgtype)||K.b.matches(this.props.mxEvent.getType())||this.props.mxEvent.getType()===xe.b);return e&&t}runActionOnFailedEv(e,t){t||(t=()=>!0);const n=this.props.mxEvent,a=n.replacingEvent(),i=[n.localRedactionEvent(),a,n];for(const n of i)if(n&&t(n)){e(n);break}}render(){var e,t;const n=[];Object(pe.c)(R.a.safeGet(),this.props.mxEvent)&&n.push(l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton",title:Object(b.b)("Edit"),onClick:this.onEditClick,onContextMenu:this.onEditClick,key:"edit"},l.a.createElement(Y,null)));const a=l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton",title:Object(b.b)("Delete"),onClick:this.onCancelClick,onContextMenu:this.onCancelClick,key:"cancel"},l.a.createElement(oe,null)),i=l.a.createElement(je,{mxEvent:this.props.mxEvent,key:"reply_thread"}),r=this.props.mxEvent,o=null===(e=r.replacingEvent())||void 0===e?void 0:e.status,s=null===(t=r.localRedactionEvent())||void 0===t?void 0:t.status,c=Object(pe.b)(r.status)||Object(pe.b)(o)||Object(pe.b)(s),m=[r.status,o,s].includes(u.EventStatus.NOT_SENT);if(c&&m)n.splice(0,0,l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton",title:Object(b.b)("Retry"),onClick:this.onResendClick,onContextMenu:this.onResendClick,key:"resend"},l.a.createElement(Z,null))),n.push(a);else{if(Object(pe.k)(this.props.mxEvent)?(this.context.canSendMessages&&(this.showReplyInThreadAction&&n.splice(0,0,i),n.splice(0,0,l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton",title:Object(b.b)("Reply"),onClick:this.onReplyClick,onContextMenu:this.onReplyClick,key:"reply"},l.a.createElement(le.a,null)))),this.context.canReact&&n.splice(0,0,l.a.createElement(Re,{mxEvent:this.props.mxEvent,reactions:this.props.reactions,onFocusChange:this.onFocusChange,key:"react"})),fe.a.isEligible(this.props.mxEvent)&&n.splice(0,0,l.a.createElement(we,{mxEvent:this.props.mxEvent,mediaEventHelperGet:()=>{var e,t;return null===(e=this.props.getTile())||void 0===e||null===(t=e.getMediaHelper)||void 0===t?void 0:t.call(e)},key:"download"}))):this.context.timelineRenderingType===k.a.Room&&this.props.mxEvent.getThread()&&n.unshift(i),c&&n.push(a),void 0!==this.props.isQuoteExpanded&&Object(x.c)(this.props.mxEvent)){const e=d()({mx_MessageActionBar_iconButton:!0,mx_MessageActionBar_expandCollapseMessageButton:!0}),t=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},this.props.isQuoteExpanded?Object(b.b)("Collapse quotes"):Object(b.b)("Expand quotes")),l.a.createElement("div",{className:"mx_Tooltip_sub"},Object(b.b)(Oe.a[Ce.b.SHIFT])+" + "+Object(b.b)("Click")));n.push(l.a.createElement(be.b,{className:e,title:this.props.isQuoteExpanded?Object(b.b)("Collapse quotes"):Object(b.b)("Expand quotes"),tooltip:t,onClick:this.props.toggleThreadExpanded,key:"expand"},this.props.isQuoteExpanded?l.a.createElement(he,null):l.a.createElement(de,null)))}n.push(l.a.createElement(ke,{mxEvent:this.props.mxEvent,getReplyChain:this.props.getReplyChain,getTile:this.props.getTile,permalinkCreator:this.props.permalinkCreator,onFocusChange:this.onFocusChange,key:"menu",getRelationsForEvent:this.props.getRelationsForEvent}))}return l.a.createElement(ge.a,{className:"mx_MessageActionBar","aria-label":Object(b.b)("Message Actions"),"aria-live":"off"},n)}}o()(Ie,"contextType",k.b);var Te=n(142),Pe=n(39),Ne=n(422),De=n(98),Me=n(21);class Ae extends l.a.PureComponent{constructor(...e){super(...e),o()(this,"context",void 0)}render(){const{content:e,reactionEvents:t,mxEvent:n,visible:a}=this.props,i=this.context.getRoom(n.getRoomId());let r,o;if(i){const n=[];for(const e of t){var s;const t=i.getMember(e.getSender()),a=null!==(s=null==t?void 0:t.name)&&void 0!==s?s:e.getSender();n.push(a)}const a=Object(De.j)(e);r=l.a.createElement("div",null,Object(b.b)("<reactors/><reactedWith>reacted with %(shortName)s</reactedWith>",{shortName:a},{reactors:()=>l.a.createElement("div",{className:"mx_Tooltip_title"},Object(E.b)(n,6)),reactedWith:e=>a?l.a.createElement("div",{className:"mx_Tooltip_sub"},e):null}))}return r&&(o=l.a.createElement(F.b,{visible:a,label:r})),o}}o()(Ae,"contextType",Me.a);class Le extends l.a.PureComponent{constructor(...e){super(...e),o()(this,"context",void 0),o()(this,"state",{tooltipRendered:!1,tooltipVisible:!1}),o()(this,"onClick",(()=>{const{mxEvent:e,myReactionEvent:t,content:n}=this.props;t?this.context.redactEvent(e.getRoomId(),t.getId()):(this.context.sendEvent(e.getRoomId(),"m.reaction",{"m.relates_to":{rel_type:"m.annotation",event_id:e.getId(),key:n}}),v.a.dispatch({action:"message_sent"}))})),o()(this,"onMouseOver",(()=>{this.setState({tooltipRendered:!0,tooltipVisible:!0})})),o()(this,"onMouseLeave",(()=>{this.setState({tooltipVisible:!1})}))}render(){const{mxEvent:e,content:t,count:n,reactionEvents:a,myReactionEvent:i}=this.props,r=d()({mx_ReactionsRowButton:!0,mx_ReactionsRowButton_selected:!!i});let o;this.state.tooltipRendered&&(o=l.a.createElement(Ae,{mxEvent:this.props.mxEvent,content:t,reactionEvents:a,visible:this.state.tooltipVisible}));const s=this.context.getRoom(e.getRoomId());let c;if(s){const e=[];for(const t of a){const n=s.getMember(t.getSender());e.push((null==n?void 0:n.name)||t.getSender())}const n=Object(E.b)(e,6);c=t?Object(b.b)("%(reactors)s reacted with %(content)s",{reactors:n,content:t}):n}return l.a.createElement(O.a,{className:r,"aria-label":c,onClick:this.onClick,disabled:this.props.disabled,onMouseOver:this.onMouseOver,onMouseLeave:this.onMouseLeave},l.a.createElement("span",{className:"mx_ReactionsRowButton_content","aria-hidden":"true"},t),l.a.createElement("span",{className:"mx_ReactionsRowButton_count","aria-hidden":"true"},n),o)}}o()(Le,"contextType",Me.a);const Ue=({mxEvent:e,reactions:t})=>{const[n,a,r,o]=Object(L.q)();let s;if(n&&a.current){const n=a.current.getBoundingClientRect();s=l.a.createElement(L.n,i()({},Object(L.i)(n),{onFinished:o,managed:!1}),l.a.createElement(Se.a,{mxEvent:e,reactions:t,onFinished:o}))}return l.a.createElement(l.a.Fragment,null,l.a.createElement(Ne.a,{className:d()("mx_ReactionsRow_addReactionButton",{mx_ReactionsRow_addReactionButton_active:n}),title:Object(b.b)("Add reaction"),onClick:r,onContextMenu:e=>{e.preventDefault(),r()},isExpanded:n,inputRef:a}),s)};class Fe extends l.a.PureComponent{constructor(e,t){super(e,t),o()(this,"context",void 0),o()(this,"onDecrypted",(()=>{this.forceUpdate()})),o()(this,"onReactionsChange",(()=>{this.setState({myReactions:this.getMyReactions()}),this.forceUpdate()})),o()(this,"onShowAllClick",(()=>{this.setState({showAll:!0})})),this.context=t,this.state={myReactions:this.getMyReactions(),showAll:!1}}componentDidMount(){const{mxEvent:e,reactions:t}=this.props;(e.isBeingDecrypted()||e.shouldAttemptDecryption())&&e.once(u.MatrixEventEvent.Decrypted,this.onDecrypted),t&&(t.on(Te.b.Add,this.onReactionsChange),t.on(Te.b.Remove,this.onReactionsChange),t.on(Te.b.Redaction,this.onReactionsChange))}componentWillUnmount(){const{mxEvent:e,reactions:t}=this.props;e.off(u.MatrixEventEvent.Decrypted,this.onDecrypted),t&&(t.off(Te.b.Add,this.onReactionsChange),t.off(Te.b.Remove,this.onReactionsChange),t.off(Te.b.Redaction,this.onReactionsChange))}componentDidUpdate(e){this.props.reactions&&e.reactions!==this.props.reactions&&(this.props.reactions.on(Te.b.Add,this.onReactionsChange),this.props.reactions.on(Te.b.Remove,this.onReactionsChange),this.props.reactions.on(Te.b.Redaction,this.onReactionsChange),this.onReactionsChange())}getMyReactions(){var e,t;const n=this.props.reactions;if(!n)return null;const a=null===(e=this.context.room)||void 0===e?void 0:e.client.getUserId();if(!a)return null;const i=null===(t=n.getAnnotationsBySender())||void 0===t?void 0:t[a];return i?[...i.values()]:null}render(){var e,t;const{mxEvent:n,reactions:a}=this.props,{myReactions:i,showAll:r}=this.state;if(!a||!Object(pe.k)(n))return null;let o,s,c=null===(e=a.getSortedAnnotationsByKey())||void 0===e?void 0:e.map((([e,t])=>{if(!t.size)return null;const a=Object(Pe.uniqBy)([...t],(e=>e.getSender())),r=null==i?void 0:i.find((t=>{var n;return!t.isRedacted()&&(null===(n=t.getRelation())||void 0===n?void 0:n.key)===e}));return l.a.createElement(Le,{key:e,content:e,count:a.length,mxEvent:n,reactionEvents:a,myReactionEvent:r,disabled:!this.context.canReact||r&&!r.isRedacted()&&!this.context.canSelfRedact})})).filter((e=>!!e));return null!==(t=c)&&void 0!==t&&t.length?(c.length>9&&!r&&(c=c.slice(0,8),o=l.a.createElement(O.a,{kind:"link_inline",className:"mx_ReactionsRow_showAll",onClick:this.onShowAllClick},Object(b.b)("Show all"))),this.context.canReact&&(s=l.a.createElement(Ue,{mxEvent:n,reactions:a})),l.a.createElement("div",{className:"mx_ReactionsRow",role:"toolbar","aria-label":Object(b.b)("Reactions")},c,o,s)):null}}o()(Fe,"contextType",k.b);var Be=n(1354),Ve=n(253),We=n(131),ze=n(1398),He=n(463),Ge=n(113),Ke=n(11),qe=n(25),$e=n(272),Ye=n(467);class Je extends l.a.Component{constructor(e){super(e),o()(this,"onBugReport",(()=>{Ke.b.createDialog($e.a,{label:"react-soft-crash-tile",error:this.state.error})})),o()(this,"onViewSource",(()=>{Ke.b.createDialog(Ye.a,{mxEvent:this.props.mxEvent},"mx_Dialog_viewsource")})),this.state={}}static getDerivedStateFromError(e){return{error:e}}render(){if(this.state.error){const{mxEvent:e}=this.props,t={mx_EventTile:!0,mx_EventTile_info:!0,mx_EventTile_content:!0,mx_EventTile_tileError:!0};let n,a;return qe.b.get().bug_report_endpoint_url&&(n=l.a.createElement(l.a.Fragment,null," ",l.a.createElement(O.a,{kind:"link",onClick:this.onBugReport},Object(b.b)("Submit logs")))),e&&y.b.getValue("developerMode")&&(a=l.a.createElement(l.a.Fragment,null," ",l.a.createElement(O.a,{onClick:this.onViewSource,kind:"link"},Object(b.b)("View Source")))),l.a.createElement("li",{className:d()(t),"data-layout":this.props.layout},l.a.createElement("div",{className:"mx_EventTile_line"},l.a.createElement("span",null,Object(b.b)("Can't load this message"),e&&` (${e.getType()})`,n,a)))}return this.props.children}}var Qe=n(633),Xe=n(24),Ze=n.n(Xe),et=n(35),tt=n(147);const nt=["mxEvent","thread"],at=({thread:e,showDisplayname:t=!1})=>{var n,a,i;const r=Object(s.useContext)(Me.a),o=null!==(n=Object(et.d)(e,m.f.Update,(()=>e.replyToEvent)))&&void 0!==n?n:void 0,[c,d]=Object(s.useState)(null==o?void 0:o.getContent());Object(et.c)(o,u.MatrixEventEvent.Replaced,(()=>{d(o.getContent())}));const h=(null==o?void 0:o.shouldAttemptDecryption())||(null==o?void 0:o.isBeingDecrypted());Object(et.c)(h?o:void 0,u.MatrixEventEvent.Decrypted,(()=>{d(o.getContent())}));const p=Object(tt.a)((async()=>{if(o)return await r.decryptEventIfNeeded(o),Ve.a.instance.generatePreviewForEvent(o)}),[o,c]);return p&&o?l.a.createElement(l.a.Fragment,null,l.a.createElement(z.b,{member:o.sender,fallbackUserId:o.getSender(),width:24,height:24,className:"mx_ThreadSummary_avatar"}),t&&l.a.createElement("div",{className:"mx_ThreadSummary_sender"},null!==(a=null===(i=o.sender)||void 0===i?void 0:i.name)&&void 0!==a?a:o.getSender()),o.isDecryptionFailure()?l.a.createElement("div",{className:"mx_ThreadSummary_content mx_DecryptionFailureBody",title:Object(b.b)("Unable to decrypt message")},l.a.createElement("span",{className:"mx_ThreadSummary_message-preview"},Object(b.b)("Unable to decrypt message"))):l.a.createElement("div",{className:"mx_ThreadSummary_content",title:p},l.a.createElement("span",{className:"mx_ThreadSummary_message-preview"},p))):null};var it=e=>{let{mxEvent:t,thread:n}=e,a=Ze()(e,nt);const r=Object(s.useContext)(k.b),o=Object(s.useContext)(_e.a),c=Object(et.d)(n,m.f.Update,(()=>n.length));if(!c)return null;let d=c;return r.narrow||(d=Object(b.b)("%(count)s reply",{count:c})),l.a.createElement(O.a,i()({},a,{className:"mx_ThreadSummary",onClick:e=>{v.a.dispatch({action:w.a.ShowThread,rootEvent:t,push:o.isCard}),Ge.b.trackInteraction("WebRoomTimelineThreadSummaryButton",e)},"aria-label":Object(b.b)("Open thread")}),l.a.createElement("span",{className:"mx_ThreadSummary_replies_amount"},d),l.a.createElement(at,{thread:n,showDisplayname:!r.narrow}),l.a.createElement("div",{className:"mx_ThreadSummary_chevron"}))},rt=n(103),ot=n.n(rt);class st extends l.a.Component{constructor(e){super(e),o()(this,"nodes",{}),o()(this,"children",{}),this.updateChildren(this.props.children)}componentDidUpdate(){this.updateChildren(this.props.children)}applyStyles(e,t){Object.entries(t).forEach((([t,n])=>{e.style[t]=n}))}updateChildren(e){const t=this.children||{};this.children={},l.a.Children.toArray(e).forEach((e=>{if(function(e){return"object"==typeof e&&"type"in e}(e))if(t[e.key]){const n=t[e.key],a=ot.a.findDOMNode(this.nodes[n.key]);a&&a.style.left!==e.props.style.left&&this.applyStyles(a,{left:e.props.style.left}),this.children[e.key]=l.a.cloneElement(n,e.props,e.props.children)}else{const t={},n=e.props.style,a=this.props.startStyles;if(a.length>0){const e=a[0];t.style=e}t.ref=t=>this.collectNode(e.key,t,n),this.children[e.key]=l.a.cloneElement(e,t)}}))}collectNode(e,t,n){if(t&&void 0===this.nodes[e]&&this.props.startStyles.length>0){const e=this.props.startStyles,a=ot.a.findDOMNode(t);for(let t=1;t<e.length;++t)this.applyStyles(a,e[t]);window.setTimeout((()=>{this.applyStyles(a,n)}),0)}this.nodes[e]=t}render(){return l.a.createElement(l.a.Fragment,null,Object.values(this.children))}}o()(st,"defaultProps",{startStyles:[]});var lt=n(211);class ct extends l.a.PureComponent{constructor(e){super(e),o()(this,"avatar",Object(s.createRef)()),this.state={suppressDisplay:!this.props.suppressAnimation}}componentWillUnmount(){const e=this.props.readReceiptInfo;e&&(this.props.checkUnmounting&&this.props.checkUnmounting()||this.buildReadReceiptInfo(e))}componentDidMount(){this.state.suppressDisplay&&this.animateMarker()}componentDidUpdate(e){const t=e.offset!==this.props.offset,n=e.hidden!==this.props.hidden;(t||n)&&this.animateMarker()}buildReadReceiptInfo(e={}){const t=this.avatar.current,n=null==t?void 0:t.offsetParent;if(!(n&&n instanceof HTMLElement))return h.a.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no valid horizontalContainer`),e.top=0,e.right=0,e.parent=void 0,e;const a=n.offsetParent;return a&&a instanceof HTMLElement?(e.top=t.offsetTop,e.right=t.getBoundingClientRect().right-n.getBoundingClientRect().right,e.parent=a,e):(h.a.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no valid verticalContainer`),e.top=0,e.right=0,e.parent=void 0,e)}readReceiptPosition(e){var t;return e.parent?(null!==(t=e.top)&&void 0!==t?t:0)+e.parent.getBoundingClientRect().top:(h.a.warn(`ReadReceiptMarker for ${this.props.fallbackUserId} has no offsetParent`),0)}animateMarker(){const e=this.props.readReceiptInfo,t=this.buildReadReceiptInfo(),n=this.readReceiptPosition(t),a=e?this.readReceiptPosition(e):-mt,i=[];null!=e&&e.right&&i.push({top:a-n,right:e.right}),i.push({top:a-n,right:0}),this.setState({suppressDisplay:!1,startStyles:i})}render(){var e;if(this.state.suppressDisplay)return l.a.createElement("div",{ref:this.avatar});const t={right:Object(lt.a)(this.props.offset),top:"0px"};return l.a.createElement(st,{startStyles:this.state.startStyles},l.a.createElement(z.a,{member:null!==(e=this.props.member)&&void 0!==e?e:null,fallbackUserId:this.props.fallbackUserId,"aria-hidden":"true","aria-live":"off",width:14,height:14,resizeMethod:"crop",style:t,inputRef:this.avatar,hideTitle:!0,tabIndex:-1}))}}var dt=n(169);function ut(e){const[t,n]=Object(s.useState)(!1);return[{showTooltip:()=>n(!0),hideTooltip:()=>n(!1)},l.a.createElement(F.b,i()({},e,{visible:t}))]}const mt=16;function ht({readReceipts:e,readReceiptMap:t,checkUnmounting:n,suppressAnimation:a,isTwelveHour:r}){const[o,s,c,d]=Object(L.q)(),u=e.length>4,m=u?3:4,h=function(e,t){return t?Object(b.b)("%(members)s and more",{members:e.join(", ")}):e.length>1?Object(b.b)("%(members)s and %(last)s",{last:e.pop(),members:e.join(", ")}):e.length?e[0]:void 0}(e.slice(0,m).map((e=>{var t,n;return null!==(t=null===(n=e.roomMember)||void 0===n?void 0:n.name)&&void 0!==t?t:e.userId})),u),[{showTooltip:p,hideTooltip:g},v]=ut({label:l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},Object(b.b)("Seen by %(count)s people",{count:e.length})),l.a.createElement("div",{className:"mx_Tooltip_sub"},h)),alignment:F.a.TopRight});if(0===e.length)return l.a.createElement("div",{className:"mx_EventTile_msgOption"},l.a.createElement("div",{className:"mx_ReadReceiptGroup"},l.a.createElement("div",{className:"mx_ReadReceiptGroup_button"},l.a.createElement("span",{className:"mx_ReadReceiptGroup_container"}))));const f=e.map(((e,i)=>{const{hidden:o,position:s}=function(e,t){return e<t?{hidden:!1,position:e}:{hidden:!0,position:0}}(i,m),c=e.userId;let d;return t&&(d=t[c],d||(d={},t[c]=d)),l.a.createElement(ct,{key:c,member:e.roomMember,fallbackUserId:c,offset:10*s,hidden:o,readReceiptInfo:d,checkUnmounting:n,suppressAnimation:a,timestamp:e.ts,showTwelveHour:r})})).reverse();let y;const E=e.length-m;let w;if(E>0&&(y=l.a.createElement("span",{className:"mx_ReadReceiptGroup_remainder","aria-live":"off"},"+",E)),o&&s.current){const t=s.current.getBoundingClientRect();w=l.a.createElement(L.n,i()({menuClassName:"mx_ReadReceiptGroup_popup",onFinished:d},Object(L.i)(t)),l.a.createElement(dt.a,null,l.a.createElement(gt,{className:"mx_ReadReceiptGroup_title"},Object(b.b)("Seen by %(count)s people",{count:e.length})),e.map((e=>l.a.createElement(pt,i()({key:e.userId},e,{isTwelveHour:r,onAfterClick:d}))))))}return l.a.createElement("div",{className:"mx_EventTile_msgOption"},l.a.createElement("div",{className:"mx_ReadReceiptGroup",role:"group","aria-label":Object(b.b)("Read receipts")},l.a.createElement(O.a,{className:"mx_ReadReceiptGroup_button",inputRef:s,"aria-label":h,"aria-haspopup":"true",onClick:c,onMouseOver:p,onMouseLeave:g,onFocus:p,onBlur:g},y,l.a.createElement("span",{className:"mx_ReadReceiptGroup_container",style:{width:10*Math.min(m,e.length)+mt-10}},f)),v,w))}function pt({userId:e,roomMember:t,ts:n,isTwelveHour:a,onAfterClick:i}){var r,o;const[{showTooltip:s,hideTooltip:c},d]=ut({alignment:F.a.Top,tooltipClassName:"mx_ReadReceiptGroup_person--tooltip",label:l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_Tooltip_title"},null!==(r=null==t?void 0:t.rawDisplayName)&&void 0!==r?r:e),l.a.createElement("div",{className:"mx_Tooltip_sub"},e))});return l.a.createElement(L.d,{className:"mx_ReadReceiptGroup_person",onClick:()=>{v.a.dispatch({action:w.a.ViewUser,member:null!=t?t:{userId:e},push:!1}),null==i||i()},onMouseOver:s,onMouseLeave:c,onFocus:s,onBlur:c,onWheel:c},l.a.createElement(z.b,{member:t,fallbackUserId:e,width:24,height:24,"aria-hidden":"true","aria-live":"off",resizeMethod:"crop",hideTitle:!0}),l.a.createElement("div",{className:"mx_ReadReceiptGroup_name"},l.a.createElement("p",null,null!==(o=null==t?void 0:t.name)&&void 0!==o?o:e),l.a.createElement("p",{className:"mx_ReadReceiptGroup_secondary"},Object(P.a)(new Date(n),a))),d)}function gt({className:e,children:t}){const n=Object(s.useRef)(null),[a]=Object(be.i)(n);return l.a.createElement("h3",{className:e,role:"menuitem",onFocus:a,tabIndex:-1,ref:n},t)}var bt,vt=n(146),ft=n(56),yt=n(779),Et=n(587);function wt({room:e,threadId:t}){const{symbol:n,count:a,color:i}=Object(yt.a)(e,t);return l.a.createElement(Et.a,{symbol:n,count:a,color:i})}function St(){return St=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},St.apply(this,arguments)}function _t(e){return s.createElement("svg",St({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),bt||(bt=s.createElement("path",{d:"M12.528 6.54l.5-.498c1.377-1.378 3.598-1.391 4.96-.03 1.361 1.362 1.348 3.583-.03 4.96l-2.37 2.37c-1.378 1.378-3.599 1.391-4.96.03m.844 4.087l-.5.499c-1.377 1.378-3.598 1.391-4.96.03-1.361-1.362-1.348-3.583.03-4.96l2.37-2.37c1.378-1.378 3.599-1.391 4.96-.03",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round"})))}var Ct;function Ot(){return Ot=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ot.apply(this,arguments)}function xt(e){return s.createElement("svg",Ot({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0},e),Ct||(Ct=s.createElement("path",{fill:"currentColor",fillRule:"evenodd",d:"M1 2.75A.75.75 0 011.75 2h.005a.75.75 0 010 1.5H1.75A.75.75 0 011 2.75zm2.495 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.005a.75.75 0 010 1.5h-.005a.75.75 0 01-.75-.75zM1 6.75A.75.75 0 011.75 6h8.5a.75.75 0 010 1.5h-8.5A.75.75 0 011 6.75zm0 3A.75.75 0 011.75 9h4.5a.75.75 0 010 1.5h-4.5A.75.75 0 011 9.75zm0 4a.75.75 0 01.75-.75h.005a.75.75 0 010 1.5H1.75a.75.75 0 01-.75-.75zm2.495 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.01a.75.75 0 010 1.5h-.01a.75.75 0 01-.75-.75zm2.5 0a.75.75 0 01.75-.75h.005a.75.75 0 010 1.5h-.005a.75.75 0 01-.75-.75z",clipRule:"evenodd"})))}function kt({viewInRoom:e,copyLinkToThread:t}){return l.a.createElement(ge.a,{className:"mx_MessageActionBar","aria-label":Object(b.b)("Message Actions"),"aria-live":"off"},l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton",onClick:e,title:Object(b.b)("View in room"),key:"view_in_room"},l.a.createElement(xt,null)),l.a.createElement(be.b,{className:"mx_MessageActionBar_iconButton",onClick:t,title:Object(b.b)("Copy link to thread"),key:"copy_link_to_thread"},l.a.createElement(_t,null)))}function Rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function jt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Rt(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function It(e){return!(!Object(Qe.d)(e)&&e.getType()!==u.EventType.RoomMessageEncrypted)}class Tt extends l.a.Component{constructor(e,t){super(e,t),o()(this,"suppressReadReceiptAnimation",void 0),o()(this,"isListeningForReceipts",void 0),o()(this,"tile",Object(s.createRef)()),o()(this,"replyChain",Object(s.createRef)()),o()(this,"ref",Object(s.createRef)()),o()(this,"context",void 0),o()(this,"unmounted",!1),o()(this,"updateThread",(e=>{this.setState({thread:e})})),o()(this,"onNewThread",(e=>{if(e.id===this.props.mxEvent.getId()){this.updateThread(e);const t=R.a.safeGet().getRoom(this.props.mxEvent.getRoomId());null==t||t.off(m.f.New,this.onNewThread)}})),o()(this,"viewInRoom",(e=>{e.preventDefault(),e.stopPropagation(),v.a.dispatch({action:w.a.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:void 0})})),o()(this,"copyLinkToThread",(async e=>{e.preventDefault(),e.stopPropagation();const{permalinkCreator:t,mxEvent:n}=this.props;if(!t)return;const a=t.forEvent(n.getId());await Object(We.b)(a)})),o()(this,"onRoomReceipt",((e,t)=>{t===R.a.safeGet().getRoom(this.props.mxEvent.getRoomId())&&(this.shouldShowSentReceipt||this.shouldShowSendingReceipt||this.isListeningForReceipts)&&this.forceUpdate((()=>{this.shouldShowSentReceipt||this.shouldShowSendingReceipt||(R.a.safeGet().removeListener(u.RoomEvent.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!1)}))})),o()(this,"onDecrypted",(()=>{this.verifyEvent(),this.forceUpdate(this.props.onHeightChanged)})),o()(this,"onDeviceVerificationChanged",((e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent()})),o()(this,"onUserVerificationChanged",((e,t)=>{e===this.props.mxEvent.getSender()&&this.verifyEvent()})),o()(this,"onReplaced",(()=>{this.verifyEvent()})),o()(this,"onSenderProfileClick",(()=>{v.a.dispatch({action:w.a.ComposerInsert,userId:this.props.mxEvent.getSender(),timelineRenderingType:this.context.timelineRenderingType})})),o()(this,"onPermalinkClicked",(e=>{e.preventDefault(),v.a.dispatch({action:w.a.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:this.context.timelineRenderingType===k.a.Search?"MessageSearch":void 0})})),o()(this,"onActionBarFocusChange",(e=>{this.setState({actionBarFocused:e})})),o()(this,"getTile",(()=>this.tile.current)),o()(this,"getReplyChain",(()=>this.replyChain.current)),o()(this,"getReactions",(()=>{var e;if(!this.props.showReactions||!this.props.getRelationsForEvent)return null;const t=this.props.mxEvent.getId();return null!==(e=this.props.getRelationsForEvent(t,"m.annotation","m.reaction"))&&void 0!==e?e:null})),o()(this,"onReactionsCreated",((e,t)=>{"m.annotation"===e&&"m.reaction"===t&&this.setState({reactions:this.getReactions()})})),o()(this,"onContextMenu",(e=>{this.showContextMenu(e)})),o()(this,"onTimestampContextMenu",(e=>{var t;this.showContextMenu(e,null===(t=this.props.permalinkCreator)||void 0===t?void 0:t.forEvent(this.props.mxEvent.getId()))})),o()(this,"onCloseMenu",(()=>{this.setState({contextMenu:void 0,actionBarFocused:!1})})),o()(this,"setQuoteExpanded",(e=>{this.setState({isQuoteExpanded:e})}));const n=this.thread;this.state={actionBarFocused:!1,verified:null,reactions:this.getReactions(),hover:!1,thread:n},this.suppressReadReceiptAnimation=!0,this.isListeningForReceipts=!1}get isEligibleForSpecialReceipt(){if(this.props.readReceipts&&this.props.readReceipts.length>0)return!1;if(!this.props.mxEvent)return!1;if(!R.a.safeGet().getRoom(this.props.mxEvent.getRoomId()))return!1;const e=R.a.safeGet().getSafeUserId();return this.props.mxEvent.getSender()===e&&It(this.props.mxEvent)}get shouldShowSentReceipt(){if(!this.isEligibleForSpecialReceipt)return!1;if(!this.props.lastSuccessful)return!1;if(this.props.eventSendStatus&&this.props.eventSendStatus!==u.EventStatus.SENT)return!1;const e=this.props.readReceipts||[],t=R.a.safeGet().getUserId();return!e.some((e=>e.userId!==t))}get shouldShowSendingReceipt(){return!!this.isEligibleForSpecialReceipt&&!(!this.props.eventSendStatus||this.props.eventSendStatus===u.EventStatus.SENT)}componentDidMount(){this.suppressReadReceiptAnimation=!1;const e=R.a.safeGet();this.props.forExport||(e.on(g.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),e.on(g.b.UserTrustStatusChanged,this.onUserVerificationChanged),this.props.mxEvent.on(u.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.on(u.MatrixEventEvent.Replaced,this.onReplaced),ze.a.instance.addVisibleEvent(this.props.mxEvent),this.props.showReactions&&this.props.mxEvent.on(u.MatrixEventEvent.RelationsCreated,this.onReactionsCreated),(this.shouldShowSentReceipt||this.shouldShowSendingReceipt)&&(e.on(u.RoomEvent.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!0)),this.props.mxEvent.on(m.f.Update,this.updateThread),e.decryptEventIfNeeded(this.props.mxEvent);const t=e.getRoom(this.props.mxEvent.getRoomId());null==t||t.on(m.f.New,this.onNewThread),this.verifyEvent()}shouldComponentUpdate(e,t){return!!Object(U.d)(this.state,t)||!this.propsEqual(this.props,e)}componentWillUnmount(){const e=R.a.get();if(e){e.removeListener(g.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),e.removeListener(g.b.UserTrustStatusChanged,this.onUserVerificationChanged),e.removeListener(u.RoomEvent.Receipt,this.onRoomReceipt);const t=e.getRoom(this.props.mxEvent.getRoomId());null==t||t.off(m.f.New,this.onNewThread)}this.isListeningForReceipts=!1,this.props.mxEvent.removeListener(u.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.removeListener(u.MatrixEventEvent.Replaced,this.onReplaced),this.props.showReactions&&this.props.mxEvent.removeListener(u.MatrixEventEvent.RelationsCreated,this.onReactionsCreated),this.props.mxEvent.off(m.f.Update,this.updateThread),this.unmounted=!1}componentDidUpdate(e,t){t.verified!==this.state.verified&&this.props.onHeightChanged&&this.props.onHeightChanged(),this.isListeningForReceipts||!this.shouldShowSentReceipt&&!this.shouldShowSendingReceipt||(R.a.safeGet().on(u.RoomEvent.Receipt,this.onRoomReceipt),this.isListeningForReceipts=!0),e.eventSendStatus!==this.props.eventSendStatus&&this.verifyEvent()}get thread(){var e;let t=this.props.mxEvent.getThread();if(!t){var n;const e=R.a.safeGet().getRoom(this.props.mxEvent.getRoomId());t=null!==(n=null==e?void 0:e.findThreadForEvent(this.props.mxEvent))&&void 0!==n?n:void 0}return null!==(e=t)&&void 0!==e?e:null}renderThreadPanelSummary(){return this.state.thread?l.a.createElement("div",{className:"mx_ThreadPanel_replies"},l.a.createElement("span",{className:"mx_ThreadPanel_replies_amount"},this.state.thread.length),l.a.createElement(at,{thread:this.state.thread})):null}renderThreadInfo(){return this.state.thread&&this.state.thread.id===this.props.mxEvent.getId()?l.a.createElement(it,{mxEvent:this.props.mxEvent,thread:this.state.thread,"data-testid":"thread-summary"}):this.context.timelineRenderingType===k.a.Search&&this.props.mxEvent.threadRootId?this.props.highlightLink?l.a.createElement("a",{className:"mx_ThreadSummary_icon",href:this.props.highlightLink},Object(b.b)("From a thread")):l.a.createElement("p",{className:"mx_ThreadSummary_icon"},Object(b.b)("From a thread")):void 0}async verifyEvent(){var e,t;const n=null!==(e=this.props.mxEvent.replacingEvent())&&void 0!==e?e:this.props.mxEvent;if(!n.isEncrypted()||n.isRedacted())return void this.setState({verified:null});const a=R.a.safeGet().getEventEncryptionInfo(n),i=n.getSender();if(!i)return void this.setState({verified:D.a.Warning});const r=R.a.safeGet().checkUserTrust(i);if(a.mismatchedSender)return void this.setState({verified:D.a.Warning});if(!r.isCrossSigningVerified())return void this.setState({verified:a.authenticated?D.a.Normal:D.a.Unauthenticated});const o=i&&a.sender&&await(null===(t=R.a.safeGet().getCrypto())||void 0===t?void 0:t.getDeviceVerificationStatus(i,a.sender.deviceId));this.unmounted||(o?o.isVerified()?a.authenticated?this.setState({verified:D.a.Verified}):this.setState({verified:D.a.Unauthenticated}):this.setState({verified:D.a.Warning}):this.setState({verified:D.a.Unknown}))}propsEqual(e,t){const n=Object.keys(e),a=Object.keys(t);if(n.length!==a.length)return!1;for(let a=0;a<n.length;a++){const i=n[a];if(!t.hasOwnProperty(i))return!1;if("readReceipts"===i){const n=e[i],a=t[i];if(n===a)continue;if(!n||!a)return!1;if(n.length!==a.length)return!1;for(let e=0;e<n.length;e++){if(n[e].userId!==a[e].userId)return!1;if(n[e].roomMember!==a[e].roomMember)return!1}}else if(e[i]!==t[i])return!1}return!0}shouldHighlight(){if(this.props.forExport)return!1;if(this.context.timelineRenderingType===k.a.Notification)return!1;if(this.context.timelineRenderingType===k.a.ThreadsList)return!1;const e=R.a.safeGet(),t=e.getPushActionsForEvent(this.props.mxEvent.replacingEvent()||this.props.mxEvent),n=this.props.mxEvent.replacingEvent()?e.getPushActionsForEvent(this.props.mxEvent):void 0;return!!(null!=t&&t.tweaks||null!=n&&n.tweaks)&&(this.props.mxEvent.getSender()!==e.credentials.userId&&!!(null!=t&&t.tweaks.highlight||null!=n&&n.tweaks.highlight))}renderE2EPadlock(){var e;const t=null!==(e=this.props.mxEvent.replacingEvent())&&void 0!==e?e:this.props.mxEvent;return Object(vt.a)(t.getRoomId())?null:t.isDecryptionFailure()?l.a.createElement(Lt,null):t.isEncrypted()&&!t.isRedacted()?this.state.verified===D.a.Normal||this.state.verified===D.a.Verified?null:this.state.verified===D.a.Unauthenticated?l.a.createElement(At,null):this.state.verified===D.a.Unknown?l.a.createElement(Mt,null):l.a.createElement(Nt,null):R.a.safeGet().isRoomEncrypted(t.getRoomId())?t.status===u.EventStatus.ENCRYPTING||t.status===u.EventStatus.NOT_SENT||t.isState()||t.isRedacted()?null:l.a.createElement(Dt,null):null}showContextMenu(e,t){var n;const a=e.target,i=a instanceof HTMLAnchorElement?a:a.closest("a");a instanceof HTMLImageElement||(null!==(n=W.a.get())&&void 0!==n&&n.allowOverridingNativeContextMenus()||!Object(We.d)()&&!i)&&(this.props.editState||(e.preventDefault(),e.stopPropagation(),this.setState({contextMenu:{position:{left:e.clientX,top:e.clientY,bottom:e.clientY},link:(null==i?void 0:i.href)||t},actionBarFocused:!0})))}shouldHideEvent(){var e;return(null===(e=this.props.callEventGrouper)||void 0===e?void 0:e.hangupReason)===p.c.Replaced}renderContextMenu(){if(!this.state.contextMenu)return null;const e=this.getTile(),t=this.getReplyChain(),n=null!=e&&e.getEventTileOps?e.getEventTileOps():void 0,a=null!=t&&t.canCollapse()?t.collapse:void 0;return l.a.createElement(A.a,i()({},Object(L.j)(this.state.contextMenu.position),{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator,eventTileOps:n,collapseReplyChain:a,onFinished:this.onCloseMenu,rightClick:!0,reactions:this.state.reactions,link:this.state.contextMenu.link,getRelationsForEvent:this.props.getRelationsForEvent}))}render(){var e,t,n;const a=this.props.mxEvent.getContent().msgtype,i=this.props.mxEvent.getType(),{hasRenderer:r,isBubbleMessage:o,isInfoMessage:s,isLeftAlignedBubbleMessage:c,noBubbleEvent:m,isSeeingThroughMessageHiddenForModeration:p}=Object(Be.a)(R.a.safeGet(),this.props.mxEvent,this.context.showHiddenEvents,this.shouldHideEvent()),{isQuoteExpanded:g}=this.state;if(!r){const{mxEvent:e}=this.props;return h.a.warn(`Event type not supported: type:${i} isState:${e.isState()}`),l.a.createElement("div",{className:"mx_EventTile mx_EventTile_info mx_MNoticeBody"},l.a.createElement("div",{className:"mx_EventTile_line"},Object(b.b)("This event could not be displayed")))}const f=fe.a.isEligible(this.props.mxEvent),y=d()("mx_EventTile_line",{mx_EventTile_mediaLine:f,mx_EventTile_image:this.props.mxEvent.getType()===u.EventType.RoomMessage&&this.props.mxEvent.getContent().msgtype===u.MsgType.Image,mx_EventTile_sticker:this.props.mxEvent.getType()===u.EventType.Sticker,mx_EventTile_emote:this.props.mxEvent.getType()===u.EventType.RoomMessage&&this.props.mxEvent.getContent().msgtype===u.MsgType.Emote}),E=["sending","queued","encrypting"].includes(this.props.eventSendStatus),S=Object(Qe.d)(this.props.mxEvent)&&this.props.isRedacted,_=this.props.mxEvent.isDecryptionFailure();let C=this.props.continuation;this.context.timelineRenderingType!==k.a.Room&&this.context.timelineRenderingType!==k.a.Search&&this.context.timelineRenderingType!==k.a.Thread&&this.props.layout!==T.a.Bubble&&(C=!1);const O=this.context.timelineRenderingType===k.a.Notification,I=!!this.props.editState,A=d()({mx_EventTile_bubbleContainer:o,mx_EventTile_leftAlignedBubble:c,mx_EventTile:!0,mx_EventTile_isEditing:I,mx_EventTile_info:s,mx_EventTile_12hr:this.props.isTwelveHour,mx_EventTile_sending:!I&&E,mx_EventTile_highlight:this.shouldHighlight(),mx_EventTile_selected:this.props.isSelectedEvent||this.state.contextMenu,mx_EventTile_continuation:C||i===u.EventType.CallInvite||ft.d.CALL_EVENT_TYPE.matches(i),mx_EventTile_last:this.props.last,mx_EventTile_lastInSection:this.props.lastInSection,mx_EventTile_contextual:this.props.contextual,mx_EventTile_actionBarFocused:this.state.actionBarFocused,mx_EventTile_verified:!o&&this.state.verified===D.a.Verified,mx_EventTile_unverified:!o&&this.state.verified===D.a.Warning,mx_EventTile_unknown:!o&&this.state.verified===D.a.Unknown,mx_EventTile_bad:_,mx_EventTile_emote:a===u.MsgType.Emote,mx_EventTile_noSender:this.props.hideSender,mx_EventTile_clamp:this.context.timelineRenderingType===k.a.ThreadsList||O,mx_EventTile_noBubble:m}),L=null!==this.props.eventSendStatus?"off":void 0;let U="#";this.props.permalinkCreator&&(U=this.props.permalinkCreator.forEvent(this.props.mxEvent.getId()));const F=this.props.mxEvent.status?void 0:this.props.mxEvent.getId();let B,V,W=null,K=null;if(O?(B=24,V=!0):s?(B=14,V=!1):this.context.timelineRenderingType===k.a.ThreadsList||this.context.timelineRenderingType===k.a.Thread&&!this.props.continuation?(B=32,V=!0):i===u.EventType.RoomCreate||o?(B=0,V=!1):this.props.layout==T.a.IRC?(B=14,V=!0):this.props.continuation&&this.context.timelineRenderingType!==k.a.File||i===u.EventType.CallInvite||ft.d.CALL_EVENT_TYPE.matches(i)?(B=0,V=!1):(B=30,V=!0),this.props.mxEvent.sender&&B){let e=null;e=this.props.mxEvent.getContent().third_party_invite?this.props.mxEvent.target:this.props.mxEvent.sender;const t=!this.props.inhibitInteraction&&![k.a.ThreadsList,k.a.Notification].includes(this.context.timelineRenderingType);W=l.a.createElement("div",{className:"mx_EventTile_avatar"},l.a.createElement(z.b,{member:e,width:B,height:B,viewUserOnClick:t,forceHistorical:this.props.mxEvent.getType()===u.EventType.RoomMember}))}V&&!0!==this.props.hideSender&&(K=this.context.timelineRenderingType===k.a.Room||this.context.timelineRenderingType===k.a.Search||this.context.timelineRenderingType===k.a.Pinned||this.context.timelineRenderingType===k.a.Thread?l.a.createElement(H.a,{onClick:this.onSenderProfileClick,mxEvent:this.props.mxEvent}):this.context.timelineRenderingType===k.a.ThreadsList?l.a.createElement(H.a,{mxEvent:this.props.mxEvent,withTooltip:!0}):l.a.createElement(H.a,{mxEvent:this.props.mxEvent}));const q=!I&&!this.props.forExport?l.a.createElement(Ie,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,permalinkCreator:this.props.permalinkCreator,getTile:this.getTile,getReplyChain:this.getReplyChain,onFocusChange:this.onActionBarFocusChange,isQuoteExpanded:g,toggleThreadExpanded:()=>this.setQuoteExpanded(!g),getRelationsForEvent:this.props.getRelationsForEvent}):void 0,$=this.props.mxEvent.getTs()&&!this.props.hideTimestamp&&(this.props.alwaysShowTimestamps||this.props.last||this.state.hover||this.state.actionBarFocused||Boolean(this.state.contextMenu));let Y=this.context.timelineRenderingType!==k.a.ThreadsList?this.props.mxEvent.getTs():null===(e=this.state.thread)||void 0===e||null===(t=e.replyToEvent)||void 0===t?void 0:t.getTs();"number"!=typeof Y&&(Y=this.props.mxEvent.getTs());const J=l.a.createElement(G.a,{showRelative:this.context.timelineRenderingType===k.a.ThreadsList,showTwelveHour:this.props.isTwelveHour,ts:Y}),Q=$&&Y?J:null;let X;S||(X=l.a.createElement(Fe,{mxEvent:this.props.mxEvent,reactions:this.state.reactions,key:"mx_EventTile_reactionsRow"}));const Z=this.props.hideTimestamp?null:l.a.createElement("a",{href:U,onClick:this.onPermalinkClicked,"aria-label":Object(P.n)(new Date(this.props.mxEvent.getTs()),this.props.isTwelveHour),onContextMenu:this.onTimestampContextMenu},Q),ee=this.props.layout===T.a.IRC,te=ee?null:Z,ne=ee?Z:null,ae=this.props.layout===T.a.Bubble?J:void 0,ie=!ee&&!o&&this.renderE2EPadlock(),re=ee&&!o&&this.renderE2EPadlock();let oe;var se,le;this.props.showReadReceipts&&(oe=this.shouldShowSentReceipt||this.shouldShowSendingReceipt?l.a.createElement(Bt,{messageState:this.props.mxEvent.getAssociatedStatus()}):l.a.createElement(ht,{readReceipts:null!==(se=this.props.readReceipts)&&void 0!==se?se:[],readReceiptMap:null!==(le=this.props.readReceiptMap)&&void 0!==le?le:{},checkUnmounting:this.props.checkUnmounting,suppressAnimation:this.suppressReadReceiptAnimation,isTwelveHour:this.props.isTwelveHour}));let ce;Object(Qe.c)(this.props.mxEvent,R.a.safeGet(),this.context.showHiddenEvents)&&Object(x.c)(this.props.mxEvent)&&(ce=l.a.createElement(j,{parentEv:this.props.mxEvent,onHeightChanged:this.props.onHeightChanged,ref:this.replyChain,forExport:this.props.forExport,permalinkCreator:this.props.permalinkCreator,layout:this.props.layout,alwaysShowTimestamps:this.props.alwaysShowTimestamps||this.state.hover,isQuoteExpanded:g,setQuoteExpanded:this.setQuoteExpanded,getRelationsForEvent:this.props.getRelationsForEvent}));const de=(null===(n=this.props.mxEvent)||void 0===n?void 0:n.getSender())===R.a.safeGet().getUserId();switch(this.context.timelineRenderingType){case k.a.Thread:return l.a.createElement(this.props.as||"li",{ref:this.ref,className:A,"aria-live":L,"aria-atomic":!0,"data-scroll-tokens":F,"data-has-reply":!!ce,"data-layout":this.props.layout,"data-self":de,"data-event-id":this.props.mxEvent.getId(),onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},[l.a.createElement("div",{className:"mx_EventTile_senderDetails",key:"mx_EventTile_senderDetails"},W,K),l.a.createElement("div",{className:y,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),ce,Object(Qe.g)(k.a.Thread,jt(jt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:p,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:()=>this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents),q,l.a.createElement("a",{href:U,onClick:this.onPermalinkClicked},Q),oe),X]);case k.a.Notification:case k.a.ThreadsList:{const e=R.a.safeGet().getRoom(this.props.mxEvent.getRoomId());return l.a.createElement(this.props.as||"li",{ref:this.ref,className:A,tabIndex:-1,"aria-live":L,"aria-atomic":"true","data-scroll-tokens":F,"data-layout":this.props.layout,"data-shape":this.context.timelineRenderingType,"data-self":de,"data-has-reply":!!ce,onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1}),onClick:e=>{var t;const n=e.currentTarget;let a=-1;switch(n.parentElement&&(a=Array.from(n.parentElement.children).indexOf(n)),this.context.timelineRenderingType){case k.a.Notification:this.viewInRoom(e);break;case k.a.ThreadsList:v.a.dispatch({action:w.a.ShowThread,rootEvent:this.props.mxEvent,push:!0}),Ge.b.trackInteraction("WebThreadsPanelThreadItem",e,null!==(t=a)&&void 0!==t?t:-1)}}},l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"mx_EventTile_details"},K,O&&e?l.a.createElement("span",{className:"mx_EventTile_truncated"}," ",Object(b.b)(" in <strong>%(room)s</strong>",{room:e.name},{strong:e=>l.a.createElement("strong",null,e)})):"",Q),O&&e?l.a.createElement("div",{className:"mx_EventTile_avatar"},l.a.createElement(M.a,{room:e,width:28,height:28})):W,l.a.createElement("div",{className:y,key:"mx_EventTile_line"},l.a.createElement("div",{className:"mx_EventTile_body"},this.props.mxEvent.isRedacted()?l.a.createElement(He.a,{mxEvent:this.props.mxEvent}):this.props.mxEvent.isDecryptionFailure()?l.a.createElement(N.a,{mxEvent:this.props.mxEvent}):Ve.a.instance.generatePreviewForEvent(this.props.mxEvent)),this.renderThreadPanelSummary()),this.context.timelineRenderingType===k.a.ThreadsList&&l.a.createElement(kt,{viewInRoom:this.viewInRoom,copyLinkToThread:this.copyLinkToThread}),oe,l.a.createElement(wt,{room:e||void 0,threadId:this.props.mxEvent.getId()})))}case k.a.File:return l.a.createElement(this.props.as||"li",{className:A,"aria-live":L,"aria-atomic":!0,"data-scroll-tokens":F},[l.a.createElement("div",{className:y,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),Object(Qe.g)(k.a.File,jt(jt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:p,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents)),l.a.createElement("a",{className:"mx_EventTile_senderDetailsLink",key:"mx_EventTile_senderDetailsLink",href:U,onClick:this.onPermalinkClicked},l.a.createElement("div",{className:"mx_EventTile_senderDetails",onContextMenu:this.onTimestampContextMenu},K,Q))]);default:return l.a.createElement(this.props.as||"li",{ref:this.ref,className:A,tabIndex:-1,"aria-live":L,"aria-atomic":"true","data-scroll-tokens":F,"data-layout":this.props.layout,"data-self":de,"data-event-id":this.props.mxEvent.getId(),"data-has-reply":!!ce,onMouseEnter:()=>this.setState({hover:!0}),onMouseLeave:()=>this.setState({hover:!1})},l.a.createElement(l.a.Fragment,null,ne,K,re,W,l.a.createElement("div",{className:y,key:"mx_EventTile_line",onContextMenu:this.onContextMenu},this.renderContextMenu(),te,ie,ce,Object(Qe.g)(this.context.timelineRenderingType,jt(jt({},this.props),{},{ref:this.tile,isSeeingThroughMessageHiddenForModeration:p,timestamp:ae,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),this.context.showHiddenEvents),q,this.props.layout===T.a.IRC&&l.a.createElement(l.a.Fragment,null,X,this.renderThreadInfo())),this.props.layout!==T.a.IRC&&l.a.createElement(l.a.Fragment,null,X,this.renderThreadInfo()),oe))}}}o()(Tt,"defaultProps",{onHeightChanged:function(){},forExport:!1,layout:T.a.Group}),o()(Tt,"contextType",k.b);const Pt=Object(s.forwardRef)(((e,t)=>{var n;return l.a.createElement(l.a.Fragment,null,l.a.createElement(Je,{mxEvent:e.mxEvent,layout:null!==(n=e.layout)&&void 0!==n?n:T.a.Group},l.a.createElement(Tt,i()({ref:t},e))))}));t.b=Pt;function Nt(e){return l.a.createElement(Ft,i()({title:Object(b.b)("Encrypted by an unverified session"),icon:Ut.Warning},e))}function Dt(e){return l.a.createElement(Ft,i()({title:Object(b.b)("Unencrypted"),icon:Ut.Warning},e))}function Mt(e){return l.a.createElement(Ft,i()({title:Object(b.b)("Encrypted by a deleted session"),icon:Ut.Normal},e))}function At(e){return l.a.createElement(Ft,i()({title:Object(b.b)("The authenticity of this encrypted message can't be guaranteed on this device."),icon:Ut.Normal},e))}function Lt(e){return l.a.createElement(Ft,i()({title:Object(b.b)("This message could not be decrypted"),icon:Ut.DecryptionFailure},e))}var Ut=function(e){return e.Normal="normal",e.Warning="warning",e.DecryptionFailure="decryption_failure",e}(Ut||{});class Ft extends l.a.Component{constructor(e){super(e),o()(this,"onHoverStart",(()=>{this.setState({hover:!0})})),o()(this,"onHoverEnd",(()=>{this.setState({hover:!1})})),this.state={hover:!1}}render(){let e;this.state.hover&&(e=l.a.createElement(F.b,{className:"mx_EventTile_e2eIcon_tooltip",label:this.props.title}));const t=`mx_EventTile_e2eIcon mx_EventTile_e2eIcon_${this.props.icon}`;return l.a.createElement("div",{className:t,onMouseEnter:this.onHoverStart,onMouseLeave:this.onHoverEnd,"aria-label":this.props.title},e)}}function Bt({messageState:e}){const t=Object(s.useRef)(`mx_SentReceipt_${Math.random()}`).current,n=!e||"sent"===e,a="not_sent"===e,i=d()({mx_EventTile_receiptSent:n,mx_EventTile_receiptSending:!n&&!a});let r;a&&(r=l.a.createElement(V.a,{notification:B.a.RED_EXCLAMATION}));let o=Object(b.b)("Sending your message…");"encrypting"===e?o=Object(b.b)("Encrypting your message…"):n?o=Object(b.b)("Your message was sent"):a&&(o=Object(b.b)("Failed to send"));const[{showTooltip:c,hideTooltip:u},m]=ut({id:t,label:o,alignment:F.a.TopRight});return l.a.createElement("div",{className:"mx_EventTile_msgOption"},l.a.createElement("div",{className:"mx_ReadReceiptGroup"},l.a.createElement("div",{className:"mx_ReadReceiptGroup_button",onMouseOver:c,onMouseLeave:u,onFocus:c,onBlur:u,"aria-describedby":t},l.a.createElement("span",{className:"mx_ReadReceiptGroup_container"},l.a.createElement("span",{className:i},r))),m))}},1324:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(44);class i{static encodeActions(e){const t=e.notify,n=e.sound,i=e.highlight;if(t){const e=[a.d.Notify];return n&&e.push({set_tweak:"sound",value:n}),i?e.push({set_tweak:"highlight"}):e.push({set_tweak:"highlight",value:!1}),e}return[a.d.DontNotify]}static decodeActions(e){let t,n=!1,i=!1;for(const r of e)if(r===a.d.Notify)n=!0;else if(r===a.d.DontNotify)n=!1;else{if("object"!=typeof r)return null;if("sound"===r.set_tweak)t=r.value;else{if("highlight"!==r.set_tweak)return null;i=r.value}}void 0===i&&(i=!0);const r={notify:n,highlight:i};return void 0!==t&&(r.sound=t),r}}},1326:function(e,t,n){(function(n){var a,i,r;i=[],void 0===(r="function"==typeof(a=function(){"use strict";function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function a(e,t,n){var a=new XMLHttpRequest;a.open("GET",e),a.responseType="blob",a.onload=function(){l(a.response,t,n)},a.onerror=function(){console.error("could not download file")},a.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function r(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n&&n.global===n?n:void 0,s=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!s?function(e,t,n){var s=o.URL||o.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?r(l):i(l.href)?a(e,t,n):r(l,l.target="_blank")):(l.href=s.createObjectURL(e),setTimeout((function(){s.revokeObjectURL(l.href)}),4e4),setTimeout((function(){r(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,o){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,o),n);else if(i(e))a(e,n,o);else{var s=document.createElement("a");s.href=e,s.target="_blank",setTimeout((function(){r(s)}))}}:function(e,t,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return a(e,t,n);var r="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||r&&l||s)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},d.readAsDataURL(e)}else{var u=o.URL||o.webkitURL,m=u.createObjectURL(e);i?i.location=m:location.href=m,i=null,setTimeout((function(){u.revokeObjectURL(m)}),4e4)}});o.saveAs=l.saveAs=l,e.exports=l})?a.apply(t,i):a)||(e.exports=r)}).call(this,n(80))},1327:function(e,t,n){"use strict";(function(e){n.d(t,"h",(function(){return Z})),n.d(t,"b",(function(){return ee})),n.d(t,"a",(function(){return te})),n.d(t,"d",(function(){return ie})),n.d(t,"c",(function(){return re})),n.d(t,"j",(function(){return le})),n.d(t,"k",(function(){return ce})),n.d(t,"e",(function(){return de})),n.d(t,"i",(function(){return ge})),n.d(t,"l",(function(){return be})),n.d(t,"g",(function(){return ve})),n.d(t,"f",(function(){return fe})),n.d(t,"m",(function(){return Se}));var a=n(24),i=n.n(a),r=n(4),o=n(186),s=n(128),l=n(3),c=n(528),d=n(7),u=n(239),m=n(1314),h=n(816),p=n(336),g=n(667),b=n(1472),v=n(9),f=n(64),y=n(11),E=n(176),w=n(75),S=n(1344),_=n(647),C=n(5),O=n(228),x=n(337),k=n(575),R=n(1590),j=n(400),I=n(1316),T=n(1393),P=n(107),N=n(93),D=n(1474),M=n(31),A=n(2),L=n(1475),U=n(1476),F=n(1477),B=n(1478),V=n(660),W=n(25),z=n(1589),H=n(14),G=n(458),K=n(50),q=n(637),$=n(1441),Y=n(614);const J=["roomId"],Q="mx_hs_url",X="mx_is_url";async function Z(e={}){try{let t=e.enableGuest||!1;const n=e.guestHsUrl,a=e.guestIsUrl,i=e.fragmentQueryParams||{},o=e.defaultDeviceDisplayName;if(t&&!n&&(l.a.warn("Cannot enable guest access: can't determine HS URL to use"),t=!1),t&&n&&i.guest_user_id&&i.guest_access_token)return l.a.log("Using guest access credentials"),ue({userId:i.guest_user_id,accessToken:i.guest_access_token,homeserverUrl:n,identityServerUrl:a,guest:!0},!0).then((()=>!0));return!!await le({ignoreGuest:Boolean(e.ignoreGuest)})||!(!t||!n)&&function(e,t,n){l.a.log(`Doing guest login on ${e}`);return Object(r.createClient)({baseUrl:e}).registerGuest({body:{initial_device_display_name:n}}).then((n=>(l.a.log(`Registered as guest: ${n.user_id}`),ue({userId:n.user_id,deviceId:n.device_id,accessToken:n.access_token,homeserverUrl:e,identityServerUrl:t,guest:!0},!0).then((()=>!0)))),(e=>(l.a.error("Failed to register as guest",e),!1)))}(n,a,o)}catch(e){return!(e instanceof me)&&async function(e){l.a.error("Unable to load session",e);const t=y.b.createDialog(F.a,{error:e}),[n]=await t.finished;if(n)return await we(),!1;return Z()}(e)}}async function ee(){const{hsUrl:e,userId:t,hasAccessToken:n,isGuest:a}=await re();return e&&t&&n?[t,!!a]:[null,null]}async function te(e,t,n){return e.code&&e.state?async function(e){try{const{accessToken:t,homeserverUrl:n,identityServerUrl:a,clientId:i,issuer:o}=await Object($.a)(e),{user_id:s,device_id:c,is_guest:d}=await async function(e,t,n){try{const a=Object(r.createClient)({baseUrl:t,accessToken:e,idBaseUrl:n});return await a.whoami()}catch(e){throw l.a.error("Failed to retrieve userId using accessToken",e),new Error("Failed to retrieve userId using accessToken")}}(t,n,a),u={accessToken:t,homeserverUrl:n,identityServerUrl:a,deviceId:c,userId:s,isGuest:d};return l.a.debug("Logged in via OIDC native flow"),await ne(u),Object(Y.c)(i,o),!0}catch(e){return l.a.error("Failed to login via OIDC",e),await ae(Object(A.b)("Something went wrong.")),!1}}(e):function(e,t,n){var a;if(!e.loginToken)return Promise.resolve(!1);const i=localStorage.getItem(I.a),o=null!==(a=localStorage.getItem(I.c))&&void 0!==a?a:void 0;if(!i)return l.a.warn("Cannot log in with token: can't determine HS URL to use"),ae(Object(A.b)("We asked the browser to remember which homeserver you use to let you sign in, but unfortunately your browser has forgotten it. Go to the sign in page and try again.")),Promise.resolve(!1);return Object(S.b)(i,o,"m.login.token",{token:e.loginToken,initial_device_display_name:t}).then((async function(e){return l.a.log("Logged in with token"),await ne(e),!0})).catch((e=>{const t=()=>{var e;const t=Object(r.createClient)({baseUrl:i,idBaseUrl:o}),a=localStorage.getItem(I.b)||void 0;null===(e=w.a.get())||void 0===e||e.startSingleSignOn(t,"sso",n,a,c.c.LOGIN)};return ae(Object(q.c)(e,{hsUrl:i,hsName:i}),t),l.a.error("Failed to log in with login token:",e),!1}))}(e,t,n)}async function ne(e){await we(),await he(e),sessionStorage.setItem("mx_fresh_login",String(!0))}async function ae(e,t){y.b.createDialog(M.a,{title:Object(A.b)("We couldn't log you in"),description:e,button:Object(A.b)("Try again"),onFinished:t?e=>e&&t():void 0})}function ie(e){if(e.reason===o.c.TOGGLED_LAZY_LOADING)return Promise.resolve().then((()=>{const t=e.value;return new Promise(t?e=>{y.b.createDialog(L.a,{onFinished:e})}:e=>{y.b.createDialog(U.a,{onFinished:e,host:window.location.host})})})).then((()=>d.a.safeGet().store.deleteAllData())).then((()=>{var e;null===(e=w.a.get())||void 0===e||e.reload()}))}async function re(){var e,t,n,a;const i=null!==(e=localStorage.getItem(Q))&&void 0!==e?e:void 0,r=null!==(t=localStorage.getItem(X))&&void 0!==t?t:void 0;let o;try{o=await _.c("account","mx_access_token")}catch(e){l.a.error("StorageManager.idbLoad failed for account:mx_access_token",e)}var s;if(!o&&(o=null!==(s=localStorage.getItem("mx_access_token"))&&void 0!==s?s:void 0,o))try{await _.d("account","mx_access_token",o),localStorage.removeItem("mx_access_token")}catch(e){l.a.error("migration of access token to IndexedDB failed",e)}const c="true"===localStorage.getItem("mx_has_access_token")||!!o,d=null!==(n=localStorage.getItem("mx_user_id"))&&void 0!==n?n:void 0,u=null!==(a=localStorage.getItem("mx_device_id"))&&void 0!==a?a:void 0;let m;return m=null!==localStorage.getItem("mx_is_guest")?"true"===localStorage.getItem("mx_is_guest"):"true"===localStorage.getItem("matrix-is-guest"),{hsUrl:i,isUrl:r,hasAccessToken:c,accessToken:o,userId:d,deviceId:u,isGuest:m}}async function oe(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);const n=await window.crypto.subtle.importKey("raw",t,"HKDF",!1,["deriveBits"]);return t.fill(0),new Uint8Array(await window.crypto.subtle.deriveBits({name:"HKDF",hash:"SHA-256",salt:new Uint8Array(32),info:new Uint8Array(0)},n,256))}async function se(){if(await async function(){const{finished:e}=y.b.createDialog(B.a),[t]=await e;return!!t}())throw await we(),new me("Aborting login in progress because of storage inconsistency")}async function le(e){const t=null==e?void 0:e.ignoreGuest;if(!localStorage)return!1;const{hsUrl:n,isUrl:a,hasAccessToken:i,accessToken:r,userId:o,deviceId:c,isGuest:d}=await re();if(i&&!r&&await se(),r&&o&&n){var u;if(t&&d)return l.a.log("Ignoring stored guest account: "+o),!1;let e=r;const i=await(null===(u=w.a.get())||void 0===u?void 0:u.getPickleKey(o,null!=c?c:""));if(i){if(l.a.log("Got pickle key"),"string"!=typeof r){const t=await oe(i);e=await Object(s.b)(r,t,"access_token"),t.fill(0)}}else l.a.log("No pickle key available");const m="true"===sessionStorage.getItem("mx_fresh_login");return sessionStorage.removeItem("mx_fresh_login"),l.a.log(`Restoring session for ${o}`),await ue({userId:o,deviceId:c,accessToken:e,homeserverUrl:n,identityServerUrl:a,guest:d,pickleKey:null!=i?i:void 0,freshLogin:m},!1),!0}return l.a.log("No previous session found."),!1}async function ce(e){var t;e.freshLogin=!0,Se();const n=e.userId&&e.deviceId?await(null===(t=w.a.get())||void 0===t?void 0:t.createPickleKey(e.userId,e.deviceId)):null;return n?l.a.log("Created pickle key"):l.a.log("Pickle key not created"),ue(Object.assign({},e,{pickleKey:n}),!0)}async function de(e){const t=d.a.safeGet().getUserId(),n=d.a.safeGet().getDeviceId();Se(),localStorage.removeItem("mx_soft_logout"),pe=!1;const a=e.userId!==t||e.deviceId!==n;var i,r;(a&&l.a.warn("Clearing all data: Old session belongs to a different user/session"),e.pickleKey||void 0===e.deviceId)||(l.a.info("Lifecycle#hydrateSession: Pickle key not provided - trying to get one"),e.pickleKey=null!==(i=await(null===(r=w.a.get())||void 0===r?void 0:r.getPickleKey(e.userId,e.deviceId)))&&void 0!==i?i:void 0);return ue(e,a)}async function ue(e,t){e.guest=Boolean(e.guest);const n=ve();l.a.log("setLoggedIn: mxid: "+e.userId+" deviceId: "+e.deviceId+" guest: "+e.guest+" hs: "+e.homeserverUrl+" softLogout: "+n," freshLogin: "+e.freshLogin),t&&await we();const a=await _.a();a.dataInLocalStorage&&a.cryptoInited&&!a.dataInCryptoStore&&await se(),d.a.replaceUsingCreds(e);const i=d.a.safeGet();if(Object(V.c)(e.userId),P.a.instance.isEnabled()&&P.a.instance.startListeningToSettingsChanges(i),e.freshLogin&&C.b.getValue("feature_dehydration")){const t=await i.rehydrateDevice();t&&(e.deviceId=t),delete e.freshLogin}if(localStorage)try{await he(e),sessionStorage.removeItem("mx_fresh_login")}catch(e){l.a.warn("Error using local storage: can't persist session!",e)}else l.a.warn("No local storage available: can't persist session!");return v.a.fire(H.a.OnLoggedIn),await ye(i,!n),i}v.a.register((e=>{if(e.action===H.a.TriggerLogout)Ee();else if(e.action===H.a.OverwriteLogin){ue(e.credentials,!0)}}));class me extends Error{}async function he(e){var t;if(localStorage.setItem(Q,e.homeserverUrl),e.identityServerUrl&&localStorage.setItem(X,e.identityServerUrl),localStorage.setItem("mx_user_id",e.userId),localStorage.setItem("mx_is_guest",JSON.stringify(e.guest)),e.accessToken?localStorage.setItem("mx_has_access_token","true"):localStorage.removeItem("mx_has_access_token"),e.pickleKey){let t;try{const n=await oe(e.pickleKey);t=await Object(s.c)(e.accessToken,n,"access_token"),n.fill(0)}catch(e){l.a.warn("Could not encrypt access token",e)}try{await _.d("account","mx_access_token",t||e.accessToken)}catch(t){e.accessToken?localStorage.setItem("mx_access_token",e.accessToken):localStorage.removeItem("mx_access_token")}localStorage.setItem("mx_has_pickle_key",String(!0))}else{try{await _.d("account","mx_access_token",e.accessToken)}catch(t){e.accessToken?localStorage.setItem("mx_access_token",e.accessToken):localStorage.removeItem("mx_access_token")}"true"===localStorage.getItem("mx_has_pickle_key")&&l.a.error("Expected a pickle key, but none provided.  Encryption may not work.")}e.deviceId&&localStorage.setItem("mx_device_id",e.deviceId),null===(t=u.a.persistCredentials)||void 0===t||t.call(u.a,e),l.a.log(`Session persisted for ${e.userId}`)}let pe=!1;function ge(){var t,n;const a=d.a.get();a&&(P.a.instance.logout(),a.isGuest()?e((()=>Ee())):(pe=!0,null===(t=w.a.get())||void 0===t||t.destroyPickleKey(a.getSafeUserId(),null!==(n=a.getDeviceId())&&void 0!==n?n:""),a.logout(!0).then(Ee,(e=>{l.a.warn("Failed to call logout API: token will not be invalidated",e),Ee()}))))}function be(){d.a.get()&&(localStorage.setItem("mx_soft_logout","true"),l.a.log("Soft logout initiated"),pe=!0,v.a.dispatch({action:"on_client_not_viable"}),Se(!1))}function ve(){return"true"===localStorage.getItem("mx_soft_logout")}function fe(){return pe}async function ye(e,t=!0){l.a.log("Lifecycle: Starting MatrixClient"),v.a.dispatch({action:"will_start_client"},!0),K.b.instance.typingStore.reset(),O.a.sharedInstance().reset(),z.a.instance.prepare(e),p.default.start(),g.a.sharedInstance().start(),f.a.makeShared(e).start(),x.a.sharedInstance().startWatching(),E.b.instance.start(),N.b.instance.start(),k.a.sharedInstance().start(),t?(await m.a.init(),await d.a.start()):(l.a.warn("Caller requested only auxiliary services be started"),await d.a.assign()),C.b.runMigrations(),R.a.sharedInstance().start(e),C.b.getValue("lowBandwidth")||b.a.start(),j.a.getInstance().start(),v.a.dispatch({action:"client_started"}),ve()&&be()}async function Ee(){var e,t;v.a.fire(H.a.OnLoggedOut,!0),Se(),await we({deleteEverything:!0}),null===(e=D.a.onLoggedOutAndStorageCleared)||void 0===e||e.call(D.a),await(null===(t=w.a.get())||void 0===t?void 0:t.clearStorage()),W.b.get().logout_redirect_url&&(l.a.log("Redirecting to external provider to finish logout"),window.setTimeout((()=>{window.location.href=W.b.get().logout_redirect_url}),100)),pe=!1}async function we(e){var t;if(window.localStorage){const t=T.a.instance.getWireInvites(),n=window.localStorage.getItem("mx_registration_time");window.localStorage.clear(),G.a.clear();try{await _.b("account","mx_access_token")}catch(e){l.a.error("idbDelete failed for account:mx_access_token",e)}null!=e&&e.deleteEverything||(t.forEach((e=>{let{roomId:t}=e,n=i()(e,J);T.a.instance.storeInvite(t,n)})),n&&window.localStorage.setItem("mx_registration_time",n))}null===(t=window.sessionStorage)||void 0===t||t.clear();const n=Object(h.a)({baseUrl:""});await m.a.deleteEventIndex(),await n.clearStores()}function Se(e=!0){var t;p.default.stop(),N.b.instance.stop(),g.a.sharedInstance().stop(),K.b.instance.typingStore.reset(),b.a.stop(),E.b.instance.stop(),x.a.sharedInstance().stopWatching(),k.a.sharedInstance().stop(),R.a.sharedInstance().stop(),null===(t=f.a.shared())||void 0===t||t.stop(),m.a.stop();const n=d.a.get();n&&(n.stopClient(),n.removeAllListeners(),e&&(d.a.unset(),m.a.unset(),n.store.destroy()))}window.mxLoginWithAccessToken=async(e,t)=>{const n=Object(r.createClient)({baseUrl:e,accessToken:t}),{user_id:a}=await n.whoami();await ue({homeserverUrl:e,accessToken:t,userId:a},!0)}}).call(this,n(267).setImmediate)},1328:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(161);t.a=({value:e,label:t,byline:n,disabled:a,onChange:o})=>i.a.createElement("label",{className:"mx_LabelledCheckbox"},i.a.createElement(r.b,{disabled:a,checked:e,onChange:e=>o(e.target.checked)}),i.a.createElement("div",{className:"mx_LabelledCheckbox_labels"},i.a.createElement("span",{className:"mx_LabelledCheckbox_label"},t),n?i.a.createElement("span",{className:"mx_LabelledCheckbox_byline"},n):null))},1329:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"b",(function(){return l}));var a=n(0),i=n(4),r=n(100),o=n(35);const s=e=>{var t,n;const a=null==e||null===(t=e.currentState)||void 0===t||null===(n=t.getStateEvents(i.EventType.RoomTopic,""))||void 0===n?void 0:n.getContent();return a?Object(r.parseTopicContent)(a):null};function l(e){const[t,n]=Object(a.useState)(s(e));return Object(o.c)(null==e?void 0:e.currentState,i.RoomStateEvent.Events,(t=>{t.getType()===i.EventType.RoomTopic&&n(s(e))})),Object(a.useEffect)((()=>{n(s(e))}),[e]),t}},1330:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var a=n(3),i=n(200),r=n(258);function o(e,t){const n=new r.a(e).get("embedded_pages");let o=n?new r.a(n).get("home_url"):null;var s;(o||(o=e.welcomePageUrl,o&&a.a.warn("You are using a deprecated config option: `welcomePageUrl`. Please use `embedded_pages.home_url` instead, per https://github.com/vector-im/element-web/issues/21428")),o)||(o=null===(s=Object(i.d)(t))||void 0===s?void 0:s.home_url);return o}function s(e){const t=new r.a(e).get("embedded_pages");return!!t&&!0===new r.a(t).get("login_for_welcome")}},1331:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));let a=function(e){return e.PersonalMessaging="PersonalMessaging",e.WorkMessaging="WorkMessaging",e.CommunityMessaging="CommunityMessaging",e.Skip="Skip",e}({})},1332:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(46),l=n(2),c=n(229),d=n(421);class u extends r.PureComponent{constructor(...e){super(...e),i()(this,"validate",Object(c.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(l.b)(this.props.labelRequired)},{key:"email",test:({value:e})=>!e||d.a(e),invalid:()=>Object(l.b)(this.props.labelInvalid)}]})),i()(this,"onValidate",(async e=>{let t=this.validate;this.props.validationRules&&(t=this.props.validationRules);const n=await t(e);return this.props.onValidate&&this.props.onValidate(n),n}))}render(){return o.a.createElement(s.a,{id:this.props.id,ref:this.props.fieldRef,type:"text",label:Object(l.b)(this.props.label),value:this.props.value,autoFocus:this.props.autoFocus,onChange:this.props.onChange,onValidate:this.onValidate})}}i()(u,"defaultProps",{label:Object(l.d)("Email"),labelRequired:Object(l.d)("Enter email address"),labelInvalid:Object(l.d)("Doesn't look like a valid email address")}),t.a=u},1333:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(0),i=n.n(a),r=n(1566),o=n(1430);class s extends i.a.Component{render(){return i.a.createElement("div",{className:"mx_AuthHeader"},i.a.createElement(r.a,null),i.a.createElement(o.a,{disabled:this.props.disableLanguageSelector}))}}},1334:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(13),i=n.n(a),r=n(0),o=n.n(r);function s({flex:e,className:t,children:n}){return o.a.createElement("main",{className:i()("mx_AuthBody",t,{mx_AuthBody_flex:e})},n)}},1341:function(e,t,n){"use strict";n.d(t,"b",(function(){return st})),n.d(t,"a",(function(){return ct}));var a=n(0),i=n.n(a),r=n(4),o=n(35),s=n(21);var l=n(182),c=n(3),d=n(336),u=n(64);const m=5e3;function h(e,t){const[n,i]=Object(a.useState)(e),o=Object(s.b)(),l=function(e){const t=Object(a.useRef)(e);return t.current=e,Object(a.useCallback)(((...e)=>t.current(...e)),[])}(t);return Object(a.useEffect)((()=>{if(n)return;let e=null,t=!0;const a=async()=>{null!==e&&(clearTimeout(e),e=null),i(await l(o)),t&&(e=window.setTimeout(a,m))};return a().catch((e=>c.a.warn("could not update user onboarding context",e))),o.on(r.ClientEvent.AccountData,a),()=>{t=!1,o.off(r.ClientEvent.AccountData,a),null!==e&&(clearTimeout(e),e=null)}}),[o,l,n]),n}var p,g,b,v,f,y,E,w,S,_,C,O,x,k,R,j,I,T,P,N,D,M,A,L,U,F,B,V=n(1),W=n.n(V);function z(){return z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},z.apply(this,arguments)}function H(e){return a.createElement("svg",z({viewBox:"0 0 564 168",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),p||(p=a.createElement("defs",null,a.createElement("radialGradient",{id:"f-droid_svg__a",cx:113,cy:-12.89,r:59.662,gradientTransform:"matrix(0 1.9611 -1.9778 0 5.51 -198.6)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#fff",stopOpacity:.098,offset:0}),a.createElement("stop",{stopColor:"#fff",stopOpacity:0,offset:1})))),g||(g=a.createElement("path",{d:"M22 2h520c11.08 0 20 8.92 20 20v124c0 11.08-8.92 20-20 20H22c-11.08 0-20-8.92-20-20V22C2 10.92 10.92 2 22 2z",stroke:"#a6a6a6",strokeWidth:4})),b||(b=a.createElement("path",{d:"M199.26 45.46v-6.682h-5.499v-2.766h8.831v10.681q-1.949 1.383-4.299 2.1-2.349.7-5.015.7-5.832 0-9.131-3.4-3.283-3.415-3.283-9.497 0-6.099 3.283-9.498 3.3-3.416 9.131-3.416 2.433 0 4.616.6 2.2.6 4.049 1.766v3.583q-1.867-1.583-3.966-2.383-2.1-.8-4.416-.8-4.565 0-6.865 2.55-2.283 2.549-2.283 7.598 0 5.032 2.283 7.581 2.3 2.55 6.865 2.55 1.783 0 3.183-.3 1.4-.317 2.516-.967zm9.48-21.33h15.729v2.833h-12.364v7.365h11.847v2.832h-11.847v9.015h12.664v2.832H208.74zm18.12 0h21.045v2.833h-8.831v22.045h-3.383V26.963h-8.83zm35.14 0h3.366v24.877H262zm6.61 0h21.045v2.833h-8.831v22.045h-3.383V26.963h-8.83zm45.24 2.28q-3.666 0-5.832 2.733-2.15 2.732-2.15 7.448 0 4.699 2.15 7.431 2.166 2.733 5.832 2.733t5.799-2.733q2.15-2.732 2.15-7.431 0-4.716-2.15-7.448-2.133-2.733-5.799-2.733zm0-2.733q5.232 0 8.365 3.516 3.132 3.5 3.132 9.398 0 5.882-3.132 9.397-3.133 3.5-8.365 3.5-5.249 0-8.398-3.5-3.132-3.499-3.132-9.397t3.132-9.398q3.15-3.516 8.398-3.516zm16.76.453h4.532l11.031 20.812V24.13h3.266v24.877h-4.532l-11.031-20.812v20.812h-3.266z",fill:"#fff","aria-label":"GET IT ON"})),v||(v=a.createElement("path",{d:"M180.81 136v-8.118l7.19-1.391V78.017l-7.19-1.392v-8.164h53.762v18.508h-10.391l-.603-8.071h-22.034v18.6h23.657v10.438h-23.657v18.555l7.236 1.391V136zm62.16-23.66v-10.437h26.162v10.437zM277.29 136v-8.118l7.283-1.53v-48.15l-7.283-1.577v-8.164h29.641q9.045 0 15.957 4.268 6.912 4.221 10.762 11.736 3.897 7.468 3.897 17.163v1.252q0 9.602-3.85 17.117-3.804 7.468-10.67 11.736-6.865 4.268-15.91 4.268zm20.828-10.344h8.303q5.613 0 9.51-2.922 3.896-2.97 5.937-8.118 2.087-5.149 2.087-11.736v-1.299q0-6.68-2.087-11.782-2.041-5.149-5.938-8.025-3.896-2.922-9.509-2.922h-8.303zM344.79 136v-8.118l6.494-1.391V95.366l-7.19-1.392V85.81h19.807l.51 6.216.093 1.113q1.856-4.082 4.593-6.17 2.736-2.087 6.54-2.087 1.206 0 2.644.232 1.438.186 2.551.51l-1.438 12.478-6.726-.37q-2.876-.14-4.685.974-1.763 1.113-3.154 3.2v24.585l6.494 1.392V136zm63.08.98q-7.422 0-12.756-3.247t-8.164-9q-2.83-5.797-2.83-13.312v-.974q0-7.469 2.83-13.22 2.83-5.799 8.118-9.046 5.334-3.293 12.71-3.293 7.468 0 12.756 3.293 5.288 3.247 8.117 9t2.83 13.266v.974q0 7.515-2.83 13.313-2.83 5.752-8.117 9-5.289 3.247-12.664 3.247zm0-10.391q3.525 0 5.752-1.902t3.293-5.288q1.067-3.433 1.067-7.979v-.974q0-4.453-1.067-7.839-1.066-3.433-3.34-5.335-2.226-1.948-5.798-1.948-3.479 0-5.752 1.948-2.273 1.902-3.34 5.335-1.02 3.386-1.02 7.84v.973q0 4.546 1.02 7.979 1.067 3.433 3.34 5.334 2.273 1.856 5.845 1.856zM437.1 136v-8.118l6.54-1.391V95.366l-7.236-1.392V85.81h20.781v40.681l6.494 1.392V136zm6.077-60.813v-11.55h14.009v11.55zm44.293 61.793q-5.984 0-10.298-3.062-4.268-3.107-6.54-8.627-2.273-5.567-2.273-12.988v-.975q0-7.932 2.273-13.87 2.319-5.937 6.586-9.23 4.268-3.34 10.205-3.34 4.129 0 7.237 1.67 3.108 1.623 5.38 4.638V73.198l-7.236-1.391v-8.164h20.781v62.854l6.494 1.391v8.118h-18.23l-1.02-6.123q-2.366 3.479-5.66 5.288-3.246 1.81-7.7 1.81zm4.036-10.53q2.83 0 4.963-1.206 2.134-1.206 3.572-3.479v-21.292q-1.392-2.412-3.526-3.71-2.133-1.346-4.917-1.346-3.386 0-5.566 2.04-2.134 1.995-3.154 5.567-.974 3.572-.974 8.303v.975q0 6.587 2.226 10.39 2.227 3.758 7.376 3.758z",fill:"#fff","aria-label":"F-Droid"})),f||(f=a.createElement("path",{d:"M146.34 25.898l-11.184 14.474",fill:"#8ab000",stroke:"#769616",strokeLinecap:"round",strokeWidth:6.579})),y||(y=a.createElement("path",{d:"M146.29 22.477c1.192.032 2.003.497 2.579 1.182-5.332 6.34-6.232 7.344-13.513 16.37-2.684 3.472-5.479 1.677-2.795-1.794l11.184-14.474a3.26 3.26 0 012.545-1.284z",color:"#000",fill:"#fff",fillOpacity:.298})),E||(E=a.createElement("path",{d:"M148.89 23.793a3.29 3.29 0 01.058 4.095l-11.184 14.474c-2.684 3.474-3.026-1.61-3.026-1.61s9.829-11.87 14.153-16.959z",color:"#000",fill:"#263238",fillOpacity:.2})),w||(w=a.createElement("path",{d:"M147 23.003c1.153 0 2.526.374 2.168 2.103-.27 1.318-12.263 15.984-12.263 15.984-2.684 3.47-6.563 1.779-3.879-1.693l11.142-14.4c.685-.763 1.603-1.957 2.832-1.994z",color:"#000",fill:"#8ab000"})),S||(S=a.createElement("path",{d:"M33.653 25.898l11.184 14.474",fill:"#8ab000",stroke:"#769616",strokeLinecap:"round",strokeWidth:6.579})),_||(_=a.createElement("path",{d:"M33.711 22.477c-1.192.032-2.003.497-2.579 1.182 5.332 6.34 6.232 7.344 13.513 16.37 2.684 3.472 5.479 1.677 2.795-1.794L36.256 23.76a3.26 3.26 0 00-2.545-1.284z",color:"#000",fill:"#fff",fillOpacity:.298})),C||(C=a.createElement("path",{d:"M31.108 23.793a3.29 3.29 0 00-.058 4.095l11.184 14.474c2.684 3.474 3.026-1.61 3.026-1.61s-9.829-11.87-14.153-16.959z",color:"#000",fill:"#263238",fillOpacity:.2})),O||(O=a.createElement("path",{d:"M32.993 23.003c-1.153 0-2.526.374-2.168 2.103.27 1.318 12.263 15.984 12.263 15.984 2.684 3.47 6.563 1.779 3.879-1.693l-11.142-14.4c-.685-.763-1.603-1.957-2.832-1.994z",color:"#000",fill:"#8ab000"})),x||(x=a.createElement("path",{d:"M47.893 35.109h84.211a7.878 7.878 0 017.895 7.894v18.211a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895v-18.21a7.878 7.878 0 017.895-7.895z",fill:"#aeea00"})),k||(k=a.createElement("path",{d:"M47.893 42.74h84.211a7.878 7.878 0 017.895 7.895v10.526a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V50.635a7.878 7.878 0 017.895-7.895z",fill:"#263238",fillOpacity:.2})),R||(R=a.createElement("path",{d:"M47.893 35.109h84.211a7.878 7.878 0 017.895 7.894V53.53a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V43.003a7.878 7.878 0 017.895-7.894z",fill:"#fff",fillOpacity:.298})),j||(j=a.createElement("path",{d:"M47.893 38.003h84.211c4.374 0 7.895 2.883 7.895 6.462v15.079c0 3.58-3.521 6.462-7.895 6.462H47.893c-4.374 0-7.895-2.882-7.895-6.462V44.465c0-3.58 3.521-6.462 7.895-6.462z",fill:"#aeea00"})),I||(I=a.createElement("path",{d:"M47.893 71.944h84.211a7.878 7.878 0 017.895 7.895v52.211a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V79.839a7.878 7.878 0 017.895-7.895z",fill:"#1976d2"})),T||(T=a.createElement("path",{d:"M47.893 105.89h84.211a7.878 7.878 0 017.895 7.895v18.42a7.878 7.878 0 01-7.895 7.896H47.893a7.878 7.878 0 01-7.895-7.895v-18.421a7.878 7.878 0 017.895-7.895z",fill:"#263238",fillOpacity:.2})),P||(P=a.createElement("path",{d:"M47.893 71.681h84.211a7.878 7.878 0 017.895 7.895v18.421a7.878 7.878 0 01-7.895 7.895H47.893a7.878 7.878 0 01-7.895-7.895V79.576a7.878 7.878 0 017.895-7.895z",fill:"#fff",fillOpacity:.2})),N||(N=a.createElement("path",{d:"M47.893 75.102h84.211c4.374 0 7.895 3.19 7.895 7.154v47.693c0 3.963-3.521 7.153-7.895 7.153H47.893c-4.374 0-7.895-3.19-7.895-7.153V82.256c0-3.963 3.521-7.154 7.895-7.154z",fill:"#1976d2"})),D||(D=a.createElement("path",{d:"M89.998 89.714c-7.579 0-14 5.224-15.876 12.237h8.455a8.46 8.46 0 017.421-4.342 8.495 8.495 0 018.553 8.553 8.495 8.495 0 01-8.553 8.552 8.471 8.471 0 01-7.71-4.868h-8.3c1.69 7.279 8.242 12.763 16.01 12.763 9.038 0 16.449-7.41 16.449-16.448 0-9.037-7.41-16.448-16.448-16.448z",color:"#000",fill:"#0d47a1"})),M||(M=a.createElement("path",{d:"M115.13 106.16a25.132 25.132 0 01-25.132 25.132 25.132 25.132 0 01-25.131-25.132 25.132 25.132 0 0125.131-25.132 25.132 25.132 0 0125.132 25.132z",fill:"none",stroke:"#0d47a1",strokeLinecap:"round",strokeWidth:5})),A||(A=a.createElement("path",{d:"M73.55 52.477a8.882 10.197 0 01-8.88 10.198 8.882 10.197 0 01-8.882-10.198 8.882 10.197 0 018.881-10.197 8.882 10.197 0 018.882 10.197z",fill:"#263238",fillOpacity:.2})),L||(L=a.createElement("path",{d:"M73.55 53.793a8.882 8.882 0 01-8.88 8.882 8.882 8.882 0 01-8.882-8.882 8.882 8.882 0 018.881-8.882 8.882 8.882 0 018.882 8.882z",fill:"#fff"})),U||(U=a.createElement("path",{d:"M124.87 52.477a8.882 10.197 0 01-8.882 10.198 8.882 10.197 0 01-8.881-10.198 8.882 10.197 0 018.881-10.197 8.882 10.197 0 018.882 10.197z",fill:"#263238",fillOpacity:.2})),F||(F=a.createElement("path",{d:"M124.87 53.793a8.882 8.882 0 01-8.882 8.882 8.882 8.882 0 01-8.881-8.882 8.882 8.882 0 018.881-8.882 8.882 8.882 0 018.882 8.882z",fill:"#fff"})),B||(B=a.createElement("path",{d:"M33.71 22.47a3.29 3.29 0 00-2.662 5.336l9.474 12.262a7.894 7.894 0 00-.527 2.824v18.211a7.877 7.877 0 007.895 7.895h84.21a7.877 7.877 0 007.895-7.895v-18.21c0-1-.19-1.95-.525-2.827l9.472-12.26a3.29 3.29 0 00-2.433-5.334 3.29 3.29 0 00-2.772 1.31l-9.013 11.666a7.91 7.91 0 00-2.623-.45H47.89c-.922 0-1.8.163-2.621.45l-9.016-11.666a3.29 3.29 0 00-2.543-1.312zm14.18 49.527a7.877 7.877 0 00-7.894 7.894v52.211a7.877 7.877 0 007.894 7.895h84.211a7.877 7.877 0 007.894-7.895v-52.21a7.877 7.877 0 00-7.894-7.895z",color:"#000",fill:"url(#f-droid_svg__a)",fillRule:"evenodd"})))}var G,K,q,$,Y,J,Q,X,Z,ee,te,ne,ae,ie,re,oe,se,le,ce,de,ue,me;function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},he.apply(this,arguments)}function pe(e){return a.createElement("svg",he({viewBox:"0 0 180 53.332",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),G||(G=a.createElement("defs",null,a.createElement("linearGradient",{id:"google-play_svg__a",x2:1,gradientTransform:"scale(-31.64 31.64) rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#00a0ff",offset:0}),a.createElement("stop",{stopColor:"#00a1ff",offset:.007}),a.createElement("stop",{stopColor:"#00beff",offset:.26}),a.createElement("stop",{stopColor:"#00d2ff",offset:.512}),a.createElement("stop",{stopColor:"#00dfff",offset:.76}),a.createElement("stop",{stopColor:"#00e3ff",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__b",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#ffe000",offset:0}),a.createElement("stop",{stopColor:"#ffbd00",offset:.409}),a.createElement("stop",{stopColor:"orange",offset:.775}),a.createElement("stop",{stopColor:"#ff9c00",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__c",x2:1,gradientTransform:"scale(-42.903 42.903) rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#ff3a44",offset:0}),a.createElement("stop",{stopColor:"#c31162",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__d",x2:1,gradientTransform:"scale(19.156 -19.156) rotate(-44.998 .238 -.62)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#32a071",offset:0}),a.createElement("stop",{stopColor:"#2da771",offset:.069}),a.createElement("stop",{stopColor:"#15cf74",offset:.476}),a.createElement("stop",{stopColor:"#06e775",offset:.801}),a.createElement("stop",{stopColor:"#00f076",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__e",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#ccb300",offset:0}),a.createElement("stop",{stopColor:"#cc9700",offset:.409}),a.createElement("stop",{stopColor:"#cc8400",offset:.775}),a.createElement("stop",{stopColor:"#cc7d00",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__f",x2:1,gradientTransform:"scale(-42.903 42.903) rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#cc2e36",offset:0}),a.createElement("stop",{stopColor:"#9c0e4e",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__g",x2:1,gradientTransform:"scale(-31.64 31.64) rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#008de0",offset:0}),a.createElement("stop",{stopColor:"#008de0",offset:.007}),a.createElement("stop",{stopColor:"#00a7e0",offset:.26}),a.createElement("stop",{stopColor:"#00b8e0",offset:.512}),a.createElement("stop",{stopColor:"#00c4e0",offset:.76}),a.createElement("stop",{stopColor:"#00c7e0",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__h",x2:1,gradientTransform:"scale(-42.903 42.903) rotate(45 -1.222 -.585)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#e0333c",offset:0}),a.createElement("stop",{stopColor:"#ab0f56",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__i",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#e0c500",offset:0}),a.createElement("stop",{stopColor:"#e0a600",offset:.409}),a.createElement("stop",{stopColor:"#e09100",offset:.775}),a.createElement("stop",{stopColor:"#e08900",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__j",x2:1,gradientTransform:"matrix(-32.255 0 0 32.255 45.098 26.675)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#ffe840",offset:0}),a.createElement("stop",{stopColor:"#ffce40",offset:.409}),a.createElement("stop",{stopColor:"#ffbc40",offset:.775}),a.createElement("stop",{stopColor:"#ffb540",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__k",x2:1,gradientTransform:"scale(-31.64 31.64) rotate(45 -.903 -.925)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#40b8ff",offset:0}),a.createElement("stop",{stopColor:"#40b9ff",offset:.007}),a.createElement("stop",{stopColor:"#40ceff",offset:.26}),a.createElement("stop",{stopColor:"#40ddff",offset:.512}),a.createElement("stop",{stopColor:"#40e7ff",offset:.76}),a.createElement("stop",{stopColor:"#40eaff",offset:1})),a.createElement("linearGradient",{id:"google-play_svg__l",x2:1,gradientTransform:"scale(19.156 -19.156) rotate(-44.998 .238 -.62)",gradientUnits:"userSpaceOnUse"},a.createElement("stop",{stopColor:"#65b895",offset:0}),a.createElement("stop",{stopColor:"#62bd95",offset:.069}),a.createElement("stop",{stopColor:"#50db97",offset:.476}),a.createElement("stop",{stopColor:"#44ed98",offset:.801}),a.createElement("stop",{stopColor:"#40f498",offset:1})))),K||(K=a.createElement("path",{d:"M173.33 53.332H6.67c-3.667 0-6.667-3-6.667-6.667V6.668c0-3.667 3-6.667 6.667-6.667h166.66c3.667 0 6.667 3 6.667 6.667v39.997c0 3.666-3 6.666-6.667 6.666"})),q||(q=a.createElement("path",{d:"M101.93 17.465v-5.118l-.044-1.544-.202.074 4.107 6.588h1.28V9.199h-1.295v4.816l.044 1.544.202-.074-3.927-6.286h-1.458v8.266",fill:"#fff"})),$||($=a.createElement("path",{d:"M173.33 0H6.67C3.003 0 .003 3 .003 6.666v40c0 3.666 3 6.666 6.667 6.666h166.66c3.667 0 6.667-3 6.667-6.667V6.668c0-3.667-3-6.667-6.667-6.667m0 1.067c3.088 0 5.6 2.512 5.6 5.6v39.997c0 3.087-2.512 5.6-5.6 5.6H6.67a5.607 5.607 0 01-5.6-5.6v-40c0-3.087 2.512-5.6 5.6-5.6h166.66",fill:"#a6a6a6"})),Y||(Y=a.createElement("path",{d:"M63.356 13.657c0-.203-.02-.41-.058-.628l-.02-.11h-4.121v1.229h3.038v-.134l-.133-.011c-.058.67-.272 1.176-.632 1.537-.573.571-1.276.853-2.14.854-.81 0-1.499-.28-2.092-.85-.587-.568-.88-1.294-.881-2.212.001-.917.294-1.643.881-2.21.593-.571 1.281-.85 2.092-.851.902.002 1.582.3 2.088.901l.094.112.806-.807.086-.087-.079-.093c-.327-.39-.764-.7-1.3-.93a4.259 4.259 0 00-1.695-.347c-1.185-.001-2.208.416-3.038 1.24-.833.823-1.252 1.857-1.251 3.072-.001 1.215.418 2.25 1.252 3.073.829.824 1.852 1.24 3.037 1.24 1.234 0 2.258-.41 3.036-1.226l-.003.002c.691-.69 1.034-1.622 1.033-2.764M69.502 9.2h-4.937v8.265h4.937v-1.25h-3.643v-2.27h3.286v-1.227h-3.286v-2.27h3.643m4.335 0h2.234v-1.25h-5.764v1.25h2.235v7.017h1.295m7.239 0V9.199h-1.294v8.266m5.853-7.017h2.235v-1.25h-5.764v1.25h2.234v7.017h1.295m6.652-4.132c0-.903.284-1.627.85-2.203.57-.575 1.252-.858 2.078-.86.825.002 1.509.285 2.078.86.566.576.85 1.3.85 2.203s-.284 1.627-.85 2.202c-.57.576-1.253.858-2.078.86-.826-.002-1.508-.284-2.076-.86s-.852-1.3-.852-2.202zm5.957 3.058c.808-.83 1.217-1.86 1.216-3.058 0-1.193-.41-2.22-1.221-3.054-.813-.837-1.83-1.26-3.024-1.259-1.2-.001-2.221.42-3.028 1.254-.81.83-1.217 1.86-1.216 3.059-.001 1.199.406 2.228 1.214 3.06s1.83 1.253 3.03 1.251c1.2.002 2.22-.419 3.029-1.253m-7.387 12.612c-3.136 0-5.693 2.384-5.693 5.67 0 3.266 2.557 5.67 5.693 5.67s5.691-2.405 5.691-5.67c0-3.287-2.555-5.67-5.691-5.67zm0 2.232c1.719 0 3.2 1.397 3.2 3.438 0 2.019-1.481 3.435-3.2 3.435-1.718 0-3.201-1.416-3.201-3.435 0-2.041 1.483-3.438 3.201-3.438zm-12.422-2.232c-3.136 0-5.693 2.384-5.693 5.67 0 3.266 2.557 5.67 5.693 5.67s5.693-2.405 5.693-5.67c0-3.287-2.557-5.67-5.693-5.67zm0 2.232c1.718 0 3.201 1.397 3.201 3.438 0 2.019-1.483 3.435-3.201 3.435-1.719 0-3.2-1.416-3.2-3.435 0-2.041 1.481-3.438 3.2-3.438zm-14.772-.494v2.407h5.757c-.172 1.353-.623 2.34-1.31 3.028-.838.838-2.148 1.762-4.447 1.762-3.544 0-6.315-2.857-6.315-6.401s2.771-6.402 6.315-6.402c1.912 0 3.308.752 4.34 1.719l1.696-1.697c-1.439-1.375-3.35-2.427-6.036-2.427-4.854 0-8.935 3.952-8.935 8.807s4.08 8.806 8.935 8.806c2.621 0 4.597-.859 6.143-2.47 1.59-1.59 2.084-3.823 2.084-5.627 0-.56-.043-1.074-.129-1.504zm55.554-1.74c-2.921 0-5.348 2.3-5.348 5.672 0 3.179 2.405 5.67 5.627 5.67 2.6 0 4.105-1.59 4.727-2.514l-1.934-1.287c-.644.946-1.525 1.566-2.793 1.566-1.267 0-2.17-.578-2.75-1.716l7.582-3.137-.256-.645c-.472-1.268-1.912-3.609-4.855-3.609zm.086 2.191c.989 0 1.826.495 2.105 1.203l-5.068 2.106c-.065-2.191 1.696-3.309 2.963-3.309zm-9.126 8.807h2.493V23.332h-2.492zm-7.15-10.996c-2.835 0-5.434 2.49-5.434 5.691 0 3.18 2.599 5.65 5.434 5.65 1.353 0 2.428-.602 2.986-1.29h.086v.816c0 2.17-1.16 3.33-3.03 3.33-1.524 0-2.47-1.095-2.856-2.02l-2.17.903c.624 1.504 2.278 3.352 5.027 3.352 2.921 0 5.39-1.72 5.39-5.908v-10.18h-2.36v.921h-.087c-.558-.666-1.633-1.265-2.986-1.265zm.215 2.232c1.697 0 3.03 1.461 3.03 3.46 0 1.975-1.333 3.414-3.03 3.414-1.72 0-3.158-1.439-3.158-3.415 0-1.997 1.44-3.459 3.158-3.459zm26.545-7.904v16.668h2.486v-6.315h3.475c2.758 0 5.469-1.997 5.469-5.177s-2.711-5.176-5.47-5.176zm2.486 2.32h3.54c1.86 0 2.915 1.54 2.915 2.858 0 1.29-1.056 2.855-2.916 2.855h-3.539zm18.914 3.321c-1.8 0-3.667.792-4.44 2.55l2.21.923c.472-.922 1.349-1.223 2.273-1.223 1.286 0 2.594.773 2.615 2.144v.172c-.45-.257-1.414-.642-2.594-.642-2.38 0-4.804 1.308-4.804 3.752 0 2.23 1.951 3.668 4.138 3.668 1.673 0 2.596-.751 3.176-1.631h.084v1.287h2.402v-6.39c0-2.96-2.208-4.61-5.06-4.61zm.385 5.938c1.095 0 1.608.236 2.273.558-.193 1.544-1.52 2.639-2.957 2.639l-.002-.002c-.815 0-1.951-.405-1.951-1.414 0-1.286 1.416-1.781 2.637-1.781zm13.415-5.575l-2.852 7.227h-.085l-2.96-7.227h-2.68l4.438 10.1-2.53 5.619h2.596l6.84-15.719zm-22.4 10.664h2.488V23.331h-2.488z",fill:"#fff"})),J||(J=a.createElement("path",{d:"M14.007 43.191l-.099-.095c-.388-.41-.617-1.047-.617-1.873v.194V11.93v.203c0-.894.267-1.567.714-1.97l16.516 16.515-16.515 16.515m-.71-31.48v-.004.003m0-.01",fill:"url(#google-play_svg__a)"})),Q||(Q=a.createElement("path",{d:"M36.025 32.378l.126-.071 6.522-3.706c.622-.354 1.036-.782 1.243-1.236-.206.454-.621.883-1.243 1.236l-6.522 3.706-.126.071m.002-.195l-5.506-5.507 5.505-5.506 6.647 3.776c.844.48 1.318 1.098 1.397 1.73v.002c-.08.63-.553 1.248-1.397 1.728l-6.646 3.777",fill:"url(#google-play_svg__b)"})),X||(X=a.createElement("path",{d:"M15.184 43.819a1.723 1.723 0 00.002 0 2.515 2.515 0 00-.002 0m0-.195c-.46 0-.863-.15-1.177-.433l16.515-16.516 5.506 5.507L16.68 43.176c-.536.304-1.043.447-1.494.447m-1.182-.241a1.814 1.814 0 01-.086-.084l.086.084",fill:"url(#google-play_svg__c)"})),Z||(Z=a.createElement("path",{d:"M30.52 26.676L14.004 10.16a1.716 1.716 0 011.177-.433c.452 0 .96.145 1.496.449L36.025 21.17l-5.506 5.506m5.63-5.63L16.677 9.98c-.536-.304-1.044-.448-1.496-.448h-.005.007c.451 0 .959.144 1.494.448L36.15 21.045",fill:"url(#google-play_svg__d)"})),ee||(ee=a.createElement("path",{d:"M15.313 43.811c.42-.024.883-.168 1.371-.445l19.353-10.995-19.353 10.994c-.487.277-.952.42-1.371.445m-1.301-.43l-.004-.004a.038.038 0 01.004.004m-.09-.088l-.009-.008c.004.002.006.006.009.008"})),te||(te=a.createElement("path",{d:"M36.025 32.378l.126-.071-.126.071",fill:"url(#google-play_svg__e)"})),ne||(ne=a.createElement("path",{d:"M15.185 43.819c-.461 0-.864-.15-1.178-.434a.038.038 0 00-.005-.003l-.086-.084-.008-.008.099-.1c.314.284.716.434 1.177.434.451 0 .958-.144 1.494-.448l19.348-10.994.124.124-.126.072L16.677 43.37c-.488.276-.952.42-1.37.444a2.515 2.515 0 01-.123.004",fill:"url(#google-play_svg__f)"})),ae||(ae=a.createElement("path",{d:"M13.914 43.285c-.388-.411-.617-1.049-.617-1.874 0 .825.23 1.462.617 1.873"})),ie||(ie=a.createElement("path",{d:"M13.908 43.29c-.388-.41-.617-1.047-.617-1.873v-.194c0 .825.23 1.462.617 1.873l.099.095-.099.099",fill:"url(#google-play_svg__g)"})),re||(re=a.createElement("path",{d:"M13.908 43.29l.099-.1v.001l-.099.099",fill:"url(#google-play_svg__h)"})),oe||(oe=a.createElement("path",{d:"M36.151 32.307l-.124-.124 6.646-3.777c.844-.48 1.318-1.098 1.397-1.728 0 .231-.051.463-.154.688-.207.453-.62.882-1.243 1.235l-6.522 3.706",fill:"url(#google-play_svg__i)"})),se||(se=a.createElement("path",{d:"M44.083 26.667c0-.698-.467-1.395-1.398-1.924l-6.523-3.707 6.523 3.706c.932.53 1.399 1.228 1.398 1.925",fill:"#404040"})),le||(le=a.createElement("path",{d:"M44.07 26.675c-.08-.632-.553-1.25-1.397-1.73l-6.647-3.775.124-.124 6.523 3.706c.93.529 1.397 1.226 1.397 1.923",fill:"url(#google-play_svg__j)"})),ce||(ce=a.createElement("path",{d:"M13.297 11.917v-.002.002m.006-.217v-.003.003m0-.006v-.006.006m0-.008c.077-1.37.822-2.16 1.876-2.165a1.715 1.715 0 00-1.166.433l-.004.003c-.033.03-.064.061-.095.093-.35.37-.57.925-.61 1.636",fill:"#404040"})),de||(de=a.createElement("path",{d:"M13.291 12.132v-.204c0-.073.002-.145.006-.215V11.7c.04-.71.261-1.265.61-1.635l.098.097c-.447.404-.714 1.077-.714 1.97m.712-2.16l.003-.004-.003.003",fill:"url(#google-play_svg__k)"})),ue||(ue=a.createElement("path",{d:"M15.178 9.521h.004-.004",fill:"#404040"})),me||(me=a.createElement("path",{d:"M36.025 21.17L16.677 10.176c-.536-.304-1.044-.448-1.496-.448-.46 0-.863.15-1.177.432l-.097-.097a1.78 1.78 0 01.095-.094l.003-.003c.312-.28.71-.43 1.166-.433h.01c.452 0 .96.144 1.496.448l19.472 11.064-.125.125",fill:"url(#google-play_svg__l)"})))}var ge,be,ve;function fe(){return fe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},fe.apply(this,arguments)}function ye(e){return a.createElement("svg",fe({viewBox:"0 0 159.55 53.333",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),ge||(ge=a.createElement("path",{d:"M146.84.001H12.71c-.489 0-.972 0-1.46.003-.407.002-.812.01-1.224.016-.888.023-1.786.077-2.672.236a8.876 8.876 0 00-2.535.836A8.58 8.58 0 001.09 4.825a8.782 8.782 0 00-.833 2.538c-.16.883-.216 1.776-.24 2.669-.012.409-.013.82-.02 1.228v30.818c.007.414.008.815.02 1.23.024.893.08 1.786.24 2.669.155.893.418 1.73.833 2.539a8.28 8.28 0 001.571 2.152 8.356 8.356 0 002.158 1.571 8.95 8.95 0 002.535.842c.886.158 1.784.21 2.672.235.412.01.817.015 1.225.015.488.002.97.002 1.46.002h134.13c.48 0 .966 0 1.445-.002.408 0 .824-.006 1.23-.015.894-.025 1.79-.077 2.667-.235a9.083 9.083 0 002.544-.842 8.417 8.417 0 002.157-1.57 8.556 8.556 0 001.573-2.153c.41-.809.676-1.646.826-2.54.165-.882.216-1.775.249-2.669.004-.414.004-.815.004-1.229.01-.484.01-.966.01-1.458V12.715c0-.488 0-.972-.01-1.455 0-.409 0-.82-.004-1.228-.033-.893-.084-1.786-.25-2.67a8.763 8.763 0 00-.825-2.537 8.626 8.626 0 00-1.573-2.162 8.641 8.641 0 00-2.157-1.57 9.02 9.02 0 00-2.544-.837c-.877-.159-1.773-.213-2.667-.236-.406-.006-.822-.014-1.23-.016C147.807 0 147.322 0 146.84 0",fill:"#b2b1b1"})),be||(be=a.createElement("path",{d:"M11.267 52.166c-.407 0-.803-.005-1.206-.014-.745-.021-1.63-.062-2.492-.217a7.847 7.847 0 01-2.21-.731 7.214 7.214 0 01-1.862-1.355 7.092 7.092 0 01-1.36-1.862 7.616 7.616 0 01-.724-2.21c-.163-.897-.205-1.807-.222-2.5-.01-.28-.02-1.217-.02-1.217v-30.8s.012-.922.02-1.193c.017-.698.059-1.607.22-2.495.143-.818.38-1.54.725-2.216.354-.7.808-1.325 1.353-1.864a7.423 7.423 0 011.87-1.363 7.762 7.762 0 012.204-.726c.898-.16 1.808-.2 2.5-.219l1.204-.016h137.02l1.217.017c.684.017 1.595.057 2.48.217.802.14 1.53.38 2.227.73.684.35 1.31.808 1.855 1.354a7.38 7.38 0 011.365 1.873c.344.681.577 1.403.715 2.198.153.841.2 1.705.23 2.517.004.377.004.783.004 1.187.012.5.012.975.012 1.455V40.62c0 .485 0 .957-.012 1.434 0 .434 0 .831-.005 1.24-.028.785-.076 1.648-.228 2.47a7.664 7.664 0 01-.72 2.228 7.297 7.297 0 01-1.353 1.847 7.268 7.268 0 01-1.866 1.363 7.855 7.855 0 01-2.225.733c-.853.155-1.737.197-2.492.218-.39.009-.8.014-1.197.014l-1.445.003-135.58-.003",fill:"#040403"})),ve||(ve=a.createElement("path",{d:"M33.032 27.068c-.034-3.668 3.002-5.452 3.141-5.536-1.72-2.507-4.385-2.85-5.321-2.877-2.239-.235-4.41 1.34-5.551 1.34-1.162 0-2.92-1.317-4.81-1.278-2.436.038-4.715 1.448-5.964 3.638-2.579 4.464-.656 11.026 1.814 14.633 1.236 1.769 2.68 3.742 4.57 3.672 1.85-.077 2.54-1.18 4.773-1.18 2.212 0 2.86 1.18 4.788 1.135 1.984-.032 3.235-1.775 4.427-3.559 1.428-2.026 2.002-4.02 2.024-4.123-.046-.016-3.854-1.469-3.891-5.865m-3.643-10.786c.994-1.244 1.675-2.936 1.486-4.654-1.44.064-3.24.995-4.276 2.213-.918 1.072-1.738 2.83-1.526 4.481 1.618.12 3.278-.816 4.316-2.04m21.362 17.839h5.002l-2.466-7.261h-.068zm5.658 2.066h-6.312l-1.515 4.475h-2.673l5.977-16.557h2.778l5.977 16.557h-2.718l-1.514-4.475m14.596-1.56c0-2.444-1.263-4.05-3.19-4.05-1.893 0-3.166 1.64-3.166 4.05 0 2.432 1.273 4.061 3.166 4.061 1.927 0 3.19-1.595 3.19-4.061zm2.547 0c0 3.751-2.008 6.161-5.038 6.161-1.72 0-3.086-.77-3.798-2.112h-.057v5.98h-2.478V28.591h2.398v2.007h.046c.689-1.295 2.157-2.134 3.844-2.134 3.063 0 5.083 2.422 5.083 6.162m10.738.001c0-2.444-1.263-4.05-3.19-4.05-1.893 0-3.166 1.64-3.166 4.05 0 2.432 1.273 4.061 3.166 4.061 1.927 0 3.19-1.595 3.19-4.061zm2.547 0c0 3.751-2.008 6.161-5.038 6.161-1.72 0-3.086-.77-3.798-2.112h-.057v5.98h-2.478V28.591h2.398v2.007h.046c.689-1.295 2.157-2.134 3.844-2.134 3.063 0 5.083 2.422 5.083 6.162m8.78 1.422c.184 1.642 1.78 2.72 3.96 2.72 2.088 0 3.59-1.078 3.59-2.558 0-1.285-.906-2.055-3.052-2.582l-2.146-.517c-3.04-.735-4.451-2.157-4.451-4.463 0-2.857 2.489-4.82 6.024-4.82 3.499 0 5.897 1.963 5.978 4.82h-2.501c-.15-1.653-1.516-2.65-3.512-2.65s-3.362 1.01-3.362 2.477c0 1.171.873 1.86 3.007 2.387l1.824.448c3.397.804 4.808 2.168 4.808 4.59 0 3.097-2.467 5.038-6.392 5.038-3.671 0-6.15-1.895-6.31-4.89h2.536m15.514-10.314v2.857h2.296v1.962h-2.296v6.655c0 1.034.46 1.515 1.469 1.515.253 0 .655-.035.815-.057v1.95c-.274.07-.826.115-1.376.115-2.444 0-3.397-.918-3.397-3.26v-6.918h-1.755V28.59h1.755v-2.857h2.49m12.551 8.894c0-2.605-1.194-4.143-3.202-4.143-2.007 0-3.2 1.55-3.2 4.143 0 2.616 1.193 4.142 3.2 4.142 2.008 0 3.202-1.526 3.202-4.142zm-8.927 0c0-3.798 2.237-6.184 5.725-6.184 3.5 0 5.727 2.386 5.727 6.184 0 3.809-2.215 6.185-5.727 6.185-3.51 0-5.725-2.376-5.725-6.185m13.495-6.036h2.363v2.055h.058c.378-1.367 1.48-2.182 2.903-2.182.356 0 .653.047.85.093v2.318c-.197-.082-.633-.15-1.114-.15-1.595 0-2.582 1.079-2.582 2.777v7.16h-2.478V28.591m9.218 4.922h6.035c-.058-1.847-1.239-3.064-2.96-3.064-1.71 0-2.948 1.24-3.075 3.064zm8.376 3.603c-.333 2.192-2.467 3.696-5.197 3.696-3.512 0-5.692-2.353-5.692-6.128 0-3.786 2.192-6.242 5.588-6.242 3.34 0 5.44 2.294 5.44 5.954v.85h-8.527v.15c0 2.064 1.298 3.418 3.248 3.418 1.376 0 2.456-.654 2.788-1.698h2.352M48.803 18.473h1.5c1.664 0 2.623-1.037 2.623-2.862 0-1.797-.975-2.845-2.623-2.845h-1.5zm1.638-6.831c2.36 0 3.744 1.45 3.744 3.953 0 2.542-1.374 4.003-3.744 4.003h-2.873v-7.956h2.873m9.583 4.951c0-1.301-.584-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.026 0 1.61-.76 1.61-2.067zm-4.443 0c0-1.936 1.08-3.115 2.833-3.115 1.748 0 2.829 1.18 2.829 3.115 0 1.946-1.076 3.12-2.83 3.12-1.758 0-2.832-1.174-2.832-3.12m13.188 3.005H67.54l-1.24-4.422h-.095l-1.235 4.422h-1.218l-1.654-6.004h1.201l1.076 4.581h.088l1.234-4.58h1.138l1.234 4.58h.094l1.07-4.58h1.185l-1.649 6.003m3.042-6.004h1.14v.954h.089c.291-.667.888-1.07 1.791-1.07 1.34 0 2.078.805 2.078 2.233v3.887h-1.184v-3.59c0-.965-.42-1.444-1.296-1.444s-1.434.585-1.434 1.522v3.512h-1.184v-6.004m6.986-2.344h1.185v8.347h-1.185V11.25m7.276 5.343c0-1.301-.585-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.025 0 1.61-.76 1.61-2.067zm-4.444 0c0-1.936 1.08-3.115 2.833-3.115 1.749 0 2.83 1.18 2.83 3.115 0 1.946-1.076 3.12-2.83 3.12-1.758 0-2.833-1.174-2.833-3.12m10.769.794v-.501l-1.466.093c-.827.056-1.202.337-1.202.866 0 .54.47.855 1.113.855.894 0 1.555-.569 1.555-1.313zm-3.86.513c0-1.08.805-1.703 2.234-1.792l1.626-.094v-.518c0-.634-.42-.992-1.23-.992-.66 0-1.119.243-1.25.667h-1.147c.12-1.031 1.09-1.693 2.453-1.693 1.505 0 2.354.75 2.354 2.018v4.102h-1.14v-.844h-.095c-.357.601-1.014.943-1.803.943-1.158 0-2.001-.7-2.001-1.797m7.82-1.307c0 1.273.6 2.04 1.604 2.04 1 0 1.617-.778 1.617-2.035 0-1.251-.624-2.04-1.617-2.04-.997 0-1.604.772-1.604 2.035zm-1.224 0c0-1.897.976-3.1 2.492-3.1.822 0 1.516.392 1.842 1.054h.088V11.25h1.185v8.347h-1.135v-.948h-.094c-.358.656-1.058 1.047-1.886 1.047-1.527 0-2.492-1.201-2.492-3.103m14.953 0c0-1.301-.584-2.062-1.61-2.062-1.03 0-1.61.76-1.61 2.062 0 1.312.58 2.067 1.61 2.067 1.026 0 1.61-.76 1.61-2.067zm-4.443 0c0-1.936 1.08-3.115 2.833-3.115 1.748 0 2.829 1.18 2.829 3.115 0 1.946-1.076 3.12-2.83 3.12-1.757 0-2.832-1.174-2.832-3.12m7.252-2.999h1.141v.954h.089c.291-.667.888-1.07 1.791-1.07 1.34 0 2.078.805 2.078 2.233v3.887h-1.184v-3.59c0-.965-.42-1.444-1.296-1.444s-1.434.585-1.434 1.522v3.512h-1.184v-6.004m11.793-1.494v1.521h1.3v.999h-1.3v3.087c0 .629.258.904.849.904.182 0 .286-.011.451-.027v.987c-.193.032-.414.06-.644.06-1.318 0-1.843-.464-1.843-1.621v-3.39h-.953v-.999h.953V12.1h1.187m2.919-.85h1.175v3.308h.094c.291-.673.925-1.075 1.83-1.075 1.279 0 2.068.81 2.068 2.238v3.876h-1.186v-3.583c0-.96-.447-1.445-1.284-1.445-.972 0-1.512.612-1.512 1.522v3.506h-1.185V11.25m7.914 4.792h3.033c-.028-.943-.601-1.555-1.479-1.555-.876 0-1.488.617-1.554 1.555zm4.168 1.935c-.27 1.075-1.23 1.737-2.602 1.737-1.72 0-2.773-1.18-2.773-3.1 0-1.918 1.076-3.136 2.768-3.136 1.67 0 2.679 1.142 2.679 3.026v.414h-4.24v.067c.04 1.052.652 1.72 1.598 1.72.719 0 1.21-.26 1.43-.728h1.14",fill:"#fff"})))}var Ee=n(2),we=n(25),Se=n(10),_e=n(446),Ce=n(160),Oe=n(34);const xe="https://play.google.com/store/apps/details?id=im.vector.app",ke=({onFinished:e})=>{var t,n,a,r,o;const s=we.b.get("brand"),l=we.b.getObject("desktop_builds"),c=we.b.getObject("mobile_builds"),d=null!==(t=null==c?void 0:c.get("ios"))&&void 0!==t?t:"https://apps.apple.com/app/vector/id1083446067",u=null!==(n=null!==(a=null==c?void 0:c.get("android"))&&void 0!==a?a:null==c?void 0:c.get("fdroid"))&&void 0!==n?n:xe,m=null!==(r=null==c?void 0:c.get("android"))&&void 0!==r?r:xe,h=null!==(o=null==c?void 0:c.get("fdroid"))&&void 0!==o?o:"https://f-droid.org/repository/browse/?fdid=im.vector.app";return i.a.createElement(Oe.a,{title:Object(Ee.b)("Download %(brand)s",{brand:s}),className:"mx_AppDownloadDialog",fixedWidth:!0,onFinished:e},(null==l?void 0:l.get("available"))&&i.a.createElement("div",{className:"mx_AppDownloadDialog_desktop"},i.a.createElement(Ce.a,{size:"3"},Object(Ee.b)("Download %(brand)s Desktop",{brand:s})),i.a.createElement(Se.a,{kind:"primary",element:"a",href:null==l?void 0:l.get("url"),target:"_blank",onClick:()=>{}},Object(Ee.b)("Download %(brand)s Desktop",{brand:s}))),i.a.createElement("div",{className:"mx_AppDownloadDialog_mobile"},i.a.createElement("div",{className:"mx_AppDownloadDialog_app"},i.a.createElement(Ce.a,{size:"3"},Object(Ee.b)("iOS")),i.a.createElement(_e.a,{data:d,margin:0,width:172}),i.a.createElement("div",{className:"mx_AppDownloadDialog_info"},Object(Ee.b)("%(qrCode)s or %(appLinks)s",{appLinks:"",qrCode:""})),i.a.createElement("div",{className:"mx_AppDownloadDialog_links"},i.a.createElement(Se.a,{element:"a",href:d,target:"_blank","aria-label":Object(Ee.b)("Download on the App Store"),onClick:()=>{}},i.a.createElement(ye,null)))),i.a.createElement("div",{className:"mx_AppDownloadDialog_app"},i.a.createElement(Ce.a,{size:"3"},Object(Ee.b)("Android")),i.a.createElement(_e.a,{data:u,margin:0,width:172}),i.a.createElement("div",{className:"mx_AppDownloadDialog_info"},Object(Ee.b)("%(qrCode)s or %(appLinks)s",{appLinks:"",qrCode:""})),i.a.createElement("div",{className:"mx_AppDownloadDialog_links"},i.a.createElement(Se.a,{element:"a",href:m,target:"_blank","aria-label":Object(Ee.b)("Get it on Google Play"),onClick:()=>{}},i.a.createElement(pe,null)),i.a.createElement(Se.a,{element:"a",href:h,target:"_blank","aria-label":Object(Ee.b)("Get it on F-Droid"),onClick:()=>{}},i.a.createElement(H,null))))),i.a.createElement("div",{className:"mx_AppDownloadDialog_legal"},i.a.createElement("p",null,Object(Ee.b)("App Store® and the Apple logo® are trademarks of Apple Inc.")),i.a.createElement("p",null,Object(Ee.b)("Google Play and the Google Play logo are trademarks of Google LLC."))))};var Re=n(414),je=n(14),Ie=n(9),Te=n(11),Pe=n(113),Ne=n(1331);function De(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?De(Object(n),!0).forEach((function(t){W()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):De(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Ae=e=>{Pe.b.trackInteraction("WebUserOnboardingTaskSendDm",e),Ie.a.dispatch({action:"view_create_chat"})},Le=[{id:"create-account",title:Object(Ee.b)("Create account"),description:Object(Ee.b)("You made it!"),completed:()=>!0},{id:"find-friends",title:Object(Ee.b)("Find and invite your friends"),description:Object(Ee.b)("It’s what you’re here for, so lets get to it"),completed:e=>e.hasDmRooms,relevant:[Ne.a.PersonalMessaging,Ne.a.Skip],action:{label:Object(Ee.b)("Find friends"),onClick:Ae}},{id:"find-coworkers",title:Object(Ee.b)("Find and invite your co-workers"),description:Object(Ee.b)("Get stuff done by finding your teammates"),completed:e=>e.hasDmRooms,relevant:[Ne.a.WorkMessaging],action:{label:Object(Ee.b)("Find people"),onClick:Ae}},{id:"find-community-members",title:Object(Ee.b)("Find and invite your community members"),description:Object(Ee.b)("Get stuff done by finding your teammates"),completed:e=>e.hasDmRooms,relevant:[Ne.a.CommunityMessaging],action:{label:Object(Ee.b)("Find people"),onClick:Ae}},{id:"download-apps",title:()=>Object(Ee.b)("Download %(brand)s",{brand:we.b.get("brand")}),description:()=>Object(Ee.b)("Don’t miss a thing by taking %(brand)s with you",{brand:we.b.get("brand")}),completed:e=>e.hasDevices,action:{label:Object(Ee.b)("Download apps"),onClick:e=>{Pe.b.trackInteraction("WebUserOnboardingTaskDownloadApps",e),Te.b.createDialog(ke,{},"mx_AppDownloadDialog_wrapper",!1,!0)}}},{id:"setup-profile",title:Object(Ee.b)("Set up your profile"),description:Object(Ee.b)("Make sure people know it’s really you"),completed:e=>e.hasAvatar,action:{label:Object(Ee.b)("Your profile"),onClick:e=>{Pe.b.trackInteraction("WebUserOnboardingTaskSetupProfile",e),Ie.a.dispatch({action:je.a.ViewUserSettings,initialTabId:Re.a.General})}}},{id:"permission-notifications",title:Object(Ee.b)("Turn on notifications"),description:Object(Ee.b)("Don’t miss a reply or important message"),completed:e=>e.hasNotificationsEnabled,action:{label:Object(Ee.b)("Enable notifications"),onClick:e=>{Pe.b.trackInteraction("WebUserOnboardingTaskEnableNotifications",e),d.Notifier.setEnabled(!0)},hideOnComplete:!0}}];var Ue=n(7),Fe=n(1330),Be=n(169),Ve=n(1361),We=n(196),ze=n(1309),He=n(54),Ge=n(1415);const Ke=e=>{Pe.b.trackInteraction("WebHomeCreateChatButton",e),Ie.a.dispatch({action:"view_create_chat"})},qe=e=>{Pe.b.trackInteraction("WebHomeExploreRoomsButton",e),Ie.a.fire(je.a.ViewRoomDirectory)},$e=e=>{Pe.b.trackInteraction("WebHomeCreateRoomButton",e),Ie.a.dispatch({action:"view_create_room"})},Ye=e=>{var t;return{displayName:ze.a.instance.displayName||e,avatarUrl:null!==(t=ze.a.instance.getHttpAvatarUrl(Ge.a))&&void 0!==t?t:void 0}},Je=()=>{const e=Object(a.useContext)(s.a),t=e.getUserId(),[n,i]=Object(a.useState)(Ye(t));return Object(o.a)(ze.a.instance,He.b,(()=>{i(Ye(t))})),a.createElement("div",null,a.createElement(Ge.b,{hasAvatar:!!n.avatarUrl,hasAvatarLabel:Object(Ee.c)("Great, that'll help people know it's you"),noAvatarLabel:Object(Ee.c)("Add a photo so people know it's you."),setAvatarUrl:t=>e.setAvatarUrl(t),isUserAvatar:!0,onClick:e=>Pe.b.trackInteraction("WebHomeMiniAvatarUploadButton",e)},a.createElement(We.a,{idName:t,name:n.displayName,url:n.avatarUrl,width:Ge.a,height:Ge.a,resizeMethod:"crop"})),a.createElement("h1",null,Object(Ee.c)("Welcome %(name)s",{name:n.displayName})),a.createElement("h2",null,Object(Ee.c)("Now, let's help you get started")))};var Qe=({justRegistered:e=!1})=>{const t=Object(s.b)(),n=we.b.get(),i=Object(Fe.a)(n,t);if(i)return a.createElement(Ve.a,{className:"mx_HomePage",url:i,scrollbar:!0});let r;if(e||!ze.a.instance.getHttpAvatarUrl(Ge.a))r=a.createElement(Je,null);else{var o;const e=we.b.getObject("branding"),t=null!==(o=null==e?void 0:e.get("auth_header_logo_url"))&&void 0!==o?o:"themes/element/img/logos/element-logo.svg";r=a.createElement(a.Fragment,null,a.createElement("img",{src:t,alt:n.brand}),a.createElement("h1",null,Object(Ee.c)("Welcome to %(appName)s",{appName:n.brand})),a.createElement("h2",null,Object(Ee.c)("Own your conversations.")))}return a.createElement(Be.a,{className:"mx_HomePage mx_HomePage_default",element:"main"},a.createElement("div",{className:"mx_HomePage_default_wrapper"},r,a.createElement("div",{className:"mx_HomePage_default_buttons"},a.createElement(Se.a,{onClick:Ke,className:"mx_HomePage_button_sendDm"},Object(Ee.c)("Send a Direct Message")),a.createElement(Se.a,{onClick:qe,className:"mx_HomePage_button_explore"},Object(Ee.c)("Explore Public Rooms")),a.createElement(Se.a,{onClick:$e,className:"mx_HomePage_button_createGroup"},Object(Ee.c)("Create a Group Chat")))))};const Xe=e=>{Pe.b.trackInteraction("WebUserOnboardingHeaderSendDm",e),Ie.a.dispatch({action:"view_create_chat"})};function Ze({useCase:e}){let t,i,r,o;switch(e){case Ne.a.PersonalMessaging:t=Object(Ee.b)("Secure messaging for friends and family"),i=Object(Ee.b)("With free end-to-end encrypted messaging, and unlimited voice and video calls, %(brand)s is a great way to stay in touch.",{brand:we.b.get("brand")}),r=n(1416),o=Object(Ee.b)("Start your first chat");break;case Ne.a.WorkMessaging:t=Object(Ee.b)("Secure messaging for work"),i=Object(Ee.b)("With free end-to-end encrypted messaging, and unlimited voice and video calls, %(brand)s is a great way to stay in touch.",{brand:we.b.get("brand")}),r=n(1525),o=Object(Ee.b)("Find your co-workers");break;case Ne.a.CommunityMessaging:t=Object(Ee.b)("Community ownership"),i=Object(Ee.b)("Keep ownership and control of community discussion.\nScale to support millions, with powerful moderation and interoperability."),r=n(1526),o=Object(Ee.b)("Find your people");break;default:t=Object(Ee.b)("Welcome to %(brand)s",{brand:we.b.get("brand")}),i=Object(Ee.b)("With free end-to-end encrypted messaging, and unlimited voice and video calls, %(brand)s is a great way to stay in touch.",{brand:we.b.get("brand")}),r=n(1416),o=Object(Ee.b)("Start your first chat")}return a.createElement("div",{className:"mx_UserOnboardingHeader"},a.createElement("div",{className:"mx_UserOnboardingHeader_content"},a.createElement(Ce.a,{size:"1"},t,a.createElement("span",{className:"mx_UserOnboardingHeader_dot"},".")),a.createElement("p",null,i),a.createElement(Se.a,{onClick:Xe,kind:"primary"},o)),a.createElement("img",{className:"mx_UserOnboardingHeader_image",src:r,alt:""}))}var et=n(457),tt=n(13),nt=n.n(tt);function at({task:e,completed:t=!1}){var n;const i="function"==typeof e.title?e.title():e.title,r="function"==typeof e.description?e.description():e.description;return a.createElement("li",{"data-testid":"user-onboarding-task",className:nt()("mx_UserOnboardingTask",{mx_UserOnboardingTask_completed:t})},a.createElement("div",{className:"mx_UserOnboardingTask_number",role:"checkbox","aria-disabled":"true","aria-checked":t,"aria-labelledby":`mx_UserOnboardingTask_${e.id}`}),a.createElement("div",{id:`mx_UserOnboardingTask_${e.id}`,className:"mx_UserOnboardingTask_content"},a.createElement(Ce.a,{size:"4",className:"mx_UserOnboardingTask_title"},i),a.createElement("div",{className:"mx_UserOnboardingTask_description"},r)),e.action&&(!e.action.hideOnComplete||!t)&&a.createElement(Se.a,{element:"a",className:"mx_UserOnboardingTask_action",kind:"primary_outline",href:e.action.href,target:"_blank",onClick:null!==(n=e.action.onClick)&&void 0!==n?n:null},e.action.label))}const it=e=>{const t=e.filter((e=>!0===e.completed)).length,n=e.filter((e=>!1===e.completed)).length;return{completed:t,waiting:n,total:t+n}};function rt({tasks:e}){const{completed:t,waiting:n,total:i}=it(e);return a.createElement("div",{className:"mx_UserOnboardingList","data-testid":"user-onboarding-list"},a.createElement("div",{className:"mx_UserOnboardingList_header"},a.createElement(Ce.a,{size:"3",className:"mx_UserOnboardingList_title"},n>0?Object(Ee.b)("Only %(count)s steps to go",{count:n}):Object(Ee.b)("You did it!")),a.createElement("div",{className:"mx_UserOnboardingList_hint"},Object(Ee.b)("Complete these to get the most out of %(brand)s",{brand:we.b.get("brand")}))),a.createElement("div",{className:"mx_UserOnboardingList_progress"},a.createElement(et.a,{value:t,max:i,animated:!0})),a.createElement("ol",{className:"mx_UserOnboardingList_list"},e.map((e=>a.createElement(at,{key:e.id,completed:e.completed,task:e})))))}const ot=new Date(1656633600);function st(e){return null!==e||Ue.a.userRegisteredAfter(ot)}const lt=2800;function ct({justRegistered:e=!1}){const t=Object(s.b)(),n=we.b.get(),i=Object(Fe.a)(n,t),c=Object(l.b)("FTUE.useCaseSelection"),m=function(){const e=h(!1,(async e=>{const t=await e.getProfileInfo(e.getUserId());return Boolean(null==t?void 0:t.avatar_url)})),t=h(!1,(async e=>{const t=e.getDeviceId(),n=await e.getDevices();return Boolean(n.devices.find((e=>e.device_id!==t)))})),n=h(!1,(async()=>{var e;const t=null!==(e=u.a.shared().getUniqueRoomsWithIndividuals())&&void 0!==e?e:{};return Boolean(Object.keys(t).length)})),i=h(!1,(async()=>d.Notifier.isPossible()));return Object(a.useMemo)((()=>({hasAvatar:e,hasDevices:t,hasDmRooms:n,hasNotificationsEnabled:i})),[e,t,n,i])}(),p=function(e){var t;const n=null!==(t=Object(l.b)("FTUE.useCaseSelection"))&&void 0!==t?t:Ne.a.Skip;return Object(a.useMemo)((()=>Le.filter((e=>!e.relevant||e.relevant.includes(n))).map((t=>Me(Me({},t),{},{completed:t.completed(e)})))),[e,n])}(m),g=function(){const e=Object(s.b)();return Object(o.b)(e,r.ClientEvent.Sync,(()=>e.isInitialSyncComplete()))}(),[b,v]=Object(a.useState)(!1);return Object(a.useEffect)((()=>{if(g){const e=window.setTimeout((()=>{v(!0)}),lt);return()=>{clearTimeout(e)}}v(!1)}),[g,v]),st(c)?i?a.createElement(Ve.a,{className:"mx_HomePage",url:i,scrollbar:!0}):a.createElement(Be.a,{className:"mx_UserOnboardingPage"},a.createElement(Ze,{useCase:c}),b&&a.createElement(rt,{tasks:p})):a.createElement(Qe,{justRegistered:e})}},1342:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return g})),n.d(t,"d",(function(){return b}));var a=n(1),i=n.n(a),r=n(121),o=n(22),s=n(85),l=n(3),c=n(6),d=function(e){return e.Start="m.login.start",e.Finish="m.login.finish",e.Progress="m.login.progress",e}(d||{}),u=function(e){return e.Success="success",e.Failure="failure",e.Verified="verified",e.Declined="declined",e.Unsupported="unsupported",e}(u||{});const m=new r.UnstableValue("login_token","org.matrix.msc3906.login_token");class h{constructor(e,t,n){this.channel=e,this.client=t,this.onFailure=n,i()(this,"newDeviceId",void 0),i()(this,"newDeviceKey",void 0),i()(this,"ourIntent",b.RECIPROCATE_LOGIN_ON_EXISTING_DEVICE),i()(this,"_code",void 0)}get code(){return this._code}async generateCode(){this._code||(this._code=JSON.stringify(await this.channel.generateCode(this.ourIntent)))}async startAfterShowingCode(){const e=await this.channel.connect();l.a.info(`Connected to secure channel with checksum: ${e} our intent is ${this.ourIntent}`);const t=await this.client.getCapabilities(),n=await Object(s.c)(await this.client.getVersions()),a=o.k.findIn(t);if((null==a||!a.enabled)&&n.get(s.a.LoginTokenRequest)===s.b.Unsupported)return l.a.info("Server doesn't support MSC3882"),await this.send({type:d.Finish,outcome:u.Unsupported}),void await this.cancel(g.HomeserverLacksSupport);await this.send({type:d.Progress,protocols:[m.name]}),l.a.info("Waiting for other device to chose protocol");const{type:i,protocol:r,outcome:c}=await this.receive();if(i!==d.Finish)if(i===d.Progress){if(r&&m.matches(r))return e;await this.cancel(g.UnsupportedAlgorithm)}else await this.cancel(g.Unknown);else if("unsupported"===(null!=c?c:""))await this.cancel(g.UnsupportedAlgorithm);else await this.cancel(g.Unknown)}async receive(){return await this.channel.receive()}async send(e){await this.channel.send(e)}async declineLoginOnExistingDevice(){l.a.info("User declined sign in"),await this.send({type:d.Finish,outcome:u.Declined})}async approveLoginOnExistingDevice(e){await this.send({type:d.Progress,login_token:e,homeserver:this.client.baseUrl}),l.a.info("Waiting for outcome");const t=await this.receive();if(!t)return;const{outcome:n,device_id:a,device_key:i}=t;if("success"!==n)throw new Error("Linking failed");return this.newDeviceId=a,this.newDeviceKey=i,a}async verifyAndCrossSignDevice(e){if(!this.client.crypto)throw new Error("Crypto not available on client");if(!this.newDeviceId)throw new Error("No new device ID set");if(e.getFingerprint()!==this.newDeviceKey)throw new Error(`New device has different keys than expected: ${this.newDeviceKey} vs ${e.getFingerprint()}`);const t=this.client.getUserId();if(!t)throw new Error("No user ID set");l.a.info(`Marking device ${this.newDeviceId} as verified`);const n=await this.client.crypto.setDeviceVerification(t,this.newDeviceId,!0,!1,!0),a=this.client.crypto.crossSigningInfo.getId("master");return await this.send({type:d.Finish,outcome:u.Verified,verifying_device_id:this.client.getDeviceId(),verifying_device_key:this.client.getDeviceEd25519Key(),master_key:a}),n}async verifyNewDeviceOnExistingDevice(e=1e4){if(!this.newDeviceId)throw new Error("No new device to sign");if(!this.newDeviceKey)return void l.a.info("No new device key to sign");if(!this.client.crypto)throw new Error("Crypto not available on client");const t=this.client.getUserId();if(!t)throw new Error("No user ID set");let n=this.client.crypto.getStoredDevice(t,this.newDeviceId);if(n||(l.a.info("Going to wait for new device to be online"),await Object(c.N)(e),n=this.client.crypto.getStoredDevice(t,this.newDeviceId)),n)return await this.verifyAndCrossSignDevice(n);throw new Error("Device not online within timeout")}async cancel(e){var t;null===(t=this.onFailure)||void 0===t||t.call(this,e),await this.channel.cancel(e)}async close(){await this.channel.close()}}class p extends Error{constructor(e,t){super(e),this.code=t}}let g=function(e){return e.UserDeclined="user_declined",e.OtherDeviceNotSignedIn="other_device_not_signed_in",e.OtherDeviceAlreadySignedIn="other_device_already_signed_in",e.Unknown="unknown",e.Expired="expired",e.UserCancelled="user_cancelled",e.InvalidCode="invalid_code",e.UnsupportedAlgorithm="unsupported_algorithm",e.DataMismatch="data_mismatch",e.UnsupportedTransport="unsupported_transport",e.HomeserverLacksSupport="homeserver_lacks_support",e}({}),b=function(e){return e.LOGIN_ON_NEW_DEVICE="login.start",e.RECIPROCATE_LOGIN_ON_EXISTING_DEVICE="login.reciprocate",e}({})},1343:function(e,t,n){"use strict";n.d(t,"b",(function(){return a.a})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return l})),n.d(t,"d",(function(){return h})),n.d(t,"a",(function(){return p}));var a=n(1324),i=n(1),r=n.n(i),o=n(1365);let s=function(e){return e.Off="off",e.On="on",e.Loud="loud",e}({});class l{static actionsFor(e){return e===s.On?o.a.ACTION_NOTIFY:e===s.Loud?o.a.ACTION_HIGHLIGHT_DEFAULT_SOUND:[]}static contentRuleVectorStateKind(e){const t=a.a.decodeActions(e.actions);if(!t)return null;let n=0;t.sound&&n++,t.highlight&&n++;let i=null;switch(n){case 0:i=s.On;break;case 2:i=s.Loud}return i}}r()(l,"OFF",s.Off),r()(l,"ON",s.On),r()(l,"LOUD",s.Loud),r()(l,"states",s);var c=n(44),d=n(3),u=n(2);class m{constructor(e){r()(this,"description",void 0),r()(this,"vectorStateToActions",void 0),r()(this,"syncedRuleIds",void 0),this.description=e.description,this.vectorStateToActions=e.vectorStateToActions,this.syncedRuleIds=e.syncedRuleIds}ruleToVectorState(e){let t=!1;e&&(t=e.enabled);for(const n of Object.values(l.states)){const i=this.vectorStateToActions[n];if(i){if(t&&JSON.stringify(a.a.decodeActions(e.actions))===JSON.stringify(a.a.decodeActions(i)))return n}else if(!t)return n}d.a.error(`Cannot translate rule actions into Vector rule state. Rule: ${JSON.stringify(e)}, Expected: ${JSON.stringify(this.vectorStateToActions)}`)}}const h={".m.rule.contains_display_name":new m({description:Object(u.d)("Messages containing my display name"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_HIGHLIGHT_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DISABLED}}),".m.rule.contains_user_name":new m({description:Object(u.d)("Messages containing my username"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_HIGHLIGHT_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DISABLED}}),".m.rule.roomnotif":new m({description:Object(u.d)("Messages containing @room"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_HIGHLIGHT,[s.Off]:o.a.ACTION_DISABLED}}),".m.rule.room_one_to_one":new m({description:Object(u.d)("Messages in one-to-one chats"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_NOTIFY_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DONT_NOTIFY},syncedRuleIds:[c.f.PollStartOneToOne,c.f.PollStartOneToOneUnstable,c.f.PollEndOneToOne,c.f.PollEndOneToOneUnstable]}),".m.rule.encrypted_room_one_to_one":new m({description:Object(u.d)("Encrypted messages in one-to-one chats"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_NOTIFY_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DONT_NOTIFY}}),".m.rule.message":new m({description:Object(u.d)("Messages in group chats"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_NOTIFY_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DONT_NOTIFY},syncedRuleIds:[c.f.PollStart,c.f.PollStartUnstable,c.f.PollEnd,c.f.PollEndUnstable]}),".m.rule.encrypted":new m({description:Object(u.d)("Encrypted messages in group chats"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_NOTIFY_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DONT_NOTIFY}}),".m.rule.invite_for_me":new m({description:Object(u.d)("When I'm invited to a room"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_NOTIFY_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DISABLED}}),".m.rule.call":new m({description:Object(u.d)("Call invitation"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_NOTIFY_RING_SOUND,[s.Off]:o.a.ACTION_DISABLED}}),".m.rule.suppress_notices":new m({description:Object(u.d)("Messages sent by bot"),vectorStateToActions:{[s.On]:o.a.ACTION_DISABLED,[s.Loud]:o.a.ACTION_NOTIFY_DEFAULT_SOUND,[s.Off]:o.a.ACTION_DONT_NOTIFY}}),".m.rule.tombstone":new m({description:Object(u.d)("When rooms are upgraded"),vectorStateToActions:{[s.On]:o.a.ACTION_NOTIFY,[s.Loud]:o.a.ACTION_HIGHLIGHT,[s.Off]:o.a.ACTION_DISABLED}})};class p{static parseContentRules(e){const t=p.categoriseContentRules(e);return t.loud.length?{vectorState:s.Loud,rules:t.loud,externalRules:[...t.loud_but_disabled,...t.on,...t.on_but_disabled,...t.other]}:t.loud_but_disabled.length?{vectorState:s.Off,rules:t.loud_but_disabled,externalRules:[...t.on,...t.on_but_disabled,...t.other]}:t.on.length?{vectorState:s.On,rules:t.on,externalRules:[...t.on_but_disabled,...t.other]}:t.on_but_disabled.length?{vectorState:s.Off,rules:t.on_but_disabled,externalRules:t.other}:{vectorState:s.On,rules:[],externalRules:t.other}}static categoriseContentRules(e){const t={on:[],on_but_disabled:[],loud:[],loud_but_disabled:[],other:[]};for(const n in e.global)for(let a=0;a<Object.keys(e.global[n]).length;++a){const i=e.global[n][a];if("."!==i.rule_id[0]&&n===c.e.ContentSpecific)switch(i.kind=n,l.contentRuleVectorStateKind(i)){case s.On:i.enabled?t.on.push(i):t.on_but_disabled.push(i);break;case s.Loud:i.enabled?t.loud.push(i):t.loud_but_disabled.push(i);break;default:t.other.push(i)}}return t}}},1344:function(e,t,n){"use strict";n.d(t,"a",(function(){return h})),n.d(t,"b",(function(){return g}));var a=n(1),i=n.n(a),r=n(4),o=n(3),s=n(528),l=n(239),c=n(144),d=n(12);const u=async(e,t,n)=>{const a={clientName:t,clientUri:n,redirectUris:[n]};if(!e.registrationEndpoint)throw new Error(c.a.DynamicRegistrationNotSupported);const i=await(async(e,t)=>{const n={client_name:t.clientName,client_uri:t.clientUri,response_types:["code"],grant_types:["authorization_code","refresh_token"],redirect_uris:t.redirectUris,id_token_signed_response_alg:"RS256",token_endpoint_auth_method:"none",application_type:"web"},a={Accept:"application/json","Content-Type":"application/json"};try{const t=await fetch(e,{method:d.i.Post,headers:a,body:JSON.stringify(n)});if(t.status>=400)throw new Error(c.a.DynamicRegistrationFailed);const i=(await t.json()).client_id;if(!i||"string"!=typeof i)throw new Error(c.a.DynamicRegistrationInvalid);return i}catch(e){throw Object.values(c.a).includes(e.message)?e:(o.a.error("Dynamic registration request failed",e),new Error(c.a.DynamicRegistrationFailed))}})(e.registrationEndpoint,a);return i};var m=n(25);class h{constructor(e,t,n,a){this.hsUrl=e,this.isUrl=t,this.fallbackHsUrl=n,i()(this,"flows",[]),i()(this,"defaultDeviceDisplayName",void 0),i()(this,"delegatedAuthentication",void 0),i()(this,"tempClient",null),this.defaultDeviceDisplayName=a.defaultDeviceDisplayName,this.delegatedAuthentication=a.delegatedAuthentication}getHomeserverUrl(){return this.hsUrl}getIdentityServerUrl(){return this.isUrl}setHomeserverUrl(e){this.tempClient=null,this.hsUrl=e}setIdentityServerUrl(e){this.tempClient=null,this.isUrl=e}createTemporaryClient(){return this.tempClient||(this.tempClient=Object(r.createClient)({baseUrl:this.hsUrl,idBaseUrl:this.isUrl})),this.tempClient}async getFlows(){if(this.delegatedAuthentication)try{return[await p(this.delegatedAuthentication,m.b.get().brand,m.b.get().oidc_static_clients)]}catch(e){o.a.error(e)}const e=this.createTemporaryClient(),{flows:t}=await e.loginFlows(),n=t.find((e=>"m.login.sso"===e.type&&s.a.findIn(e)));return this.flows=n?[n]:t,this.flows}loginViaPassword(e,t,n,a){const i=!!e&&e.indexOf("@")>0;let r;r=t&&n?{type:"m.id.phone",country:t,phone:n,number:n}:i?{type:"m.id.thirdparty",medium:"email",address:e}:{type:"m.id.user",user:e};const s={password:a,identifier:r,initial_device_display_name:this.defaultDeviceDisplayName},l=e=>g(this.fallbackHsUrl,this.isUrl,"m.login.password",s).catch((t=>{throw o.a.log("fallback HS login failed",t),e}));let c=null;return g(this.hsUrl,this.isUrl,"m.login.password",s).catch((e=>{if(c=e,403===e.httpStatus&&this.fallbackHsUrl)return l(c);throw c})).catch((e=>{throw o.a.log("Login failed",e),e}))}}const p=async(e,t,n)=>{const a=await(async(e,t,n,a)=>{const i=((e,t)=>{var n;const a=e.endsWith("/")?e:e+"/";return null==t||null===(n=t[a])||void 0===n?void 0:n.client_id})(e.issuer,a);return i?(o.a.debug(`Using static clientId for issuer ${e.issuer}`),i):await u(e,t,n)})(e,t,window.location.origin,n);return{type:"oidcNativeFlow",clientId:a}};async function g(e,t,n,a){var i;const s=Object(r.createClient)({baseUrl:e,idBaseUrl:t}),c=await s.login(n,a),d=c.well_known;var u,m;d&&(null!==(u=d["m.homeserver"])&&void 0!==u&&u.base_url&&(e=d["m.homeserver"].base_url,o.a.log(`Overrode homeserver setting with ${e} from login response`)),null!==(m=d["m.identity_server"])&&void 0!==m&&m.base_url&&(t=d["m.identity_server"].base_url,o.a.log(`Overrode IS setting with ${t} from login response`)));const h={homeserverUrl:e,identityServerUrl:t,userId:c.user_id,deviceId:c.device_id,accessToken:c.access_token};return null===(i=l.a.examineLoginResponse)||void 0===i||i.call(l.a,c,h),h}},1347:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(0),i=n.n(a),r=n(16),o=n(20),s=n(2);const l=({name:e,last:t})=>{const n=r.g[e],a=r.a[e];return i.a.createElement(i.a.Fragment,null,i.a.createElement("kbd",null," ",n||a&&Object(s.b)(a)||e," "),!t&&"+")},c=({value:e,className:t="mx_KeyboardShortcut"})=>{if(!e)return null;const n=[];return e.ctrlOrCmdKey?n.push(i.a.createElement(l,{key:"ctrlOrCmdKey",name:o.a?o.b.META:o.b.CONTROL})):e.ctrlKey?n.push(i.a.createElement(l,{key:"ctrlKey",name:o.b.CONTROL})):e.metaKey&&n.push(i.a.createElement(l,{key:"metaKey",name:o.b.META})),e.altKey&&n.push(i.a.createElement(l,{key:"altKey",name:o.b.ALT})),e.shiftKey&&n.push(i.a.createElement(l,{key:"shiftKey",name:o.b.SHIFT})),i.a.createElement("div",{className:t},n,i.a.createElement(l,{name:e.key,last:!0}))}},1349:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(1388),l=n(34),c=n(2),d=n(1351);function u(e){return e===d.a.Done?n(1473).default:n(871).default}class m extends o.a.Component{constructor(e){super(e),i()(this,"store",void 0),i()(this,"onStoreUpdate",(()=>{this.setState({icon:u(this.store.phase)})})),this.store=d.b.sharedInstance(),this.state={icon:u(this.store.phase)}}componentDidMount(){this.store.on("update",this.onStoreUpdate)}componentWillUnmount(){this.store.removeListener("update",this.onStoreUpdate)}render(){return o.a.createElement(l.a,{headerImage:this.state.icon,onFinished:this.props.onFinished,title:Object(c.b)("Verify this session")},o.a.createElement(s.a,{onFinished:this.props.onFinished}))}}},1350:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(0),i=n.n(a),r=n(7),o=n(2),s=n(34),l=n(669);class c extends i.a.Component{constructor(e){var t;super(e),this.state={verificationRequest:this.props.verificationRequest},null===(t=this.props.verificationRequestPromise)||void 0===t||t.then((e=>{this.setState({verificationRequest:e})}))}render(){const e=this.state.verificationRequest,t=null==e?void 0:e.otherUserId,n=this.props.member||(t?r.a.safeGet().getUser(t):null),a=null!=e&&e.isSelfVerification?Object(o.b)("Verify other device"):Object(o.b)("Verification Request");return n?i.a.createElement(s.a,{className:"mx_InfoDialog",onFinished:this.props.onFinished,contentId:"mx_Dialog_content",title:a,hasCancel:!0},i.a.createElement(l.a,{layout:"dialog",verificationRequest:this.props.verificationRequest,verificationRequestPromise:this.props.verificationRequestPromise,onClose:this.props.onFinished,member:n,isRoomEncrypted:!1})):null}}},1351:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return f}));var a=n(1),i=n.n(a),r=n(67),o=n.n(r),s=n(55),l=n(3),c=n(47),d=n(7),u=n(271),m=n(11),h=n(416),p=n(2),g=n(50),b=n(29);let v=function(e){return e[e.Loading=0]="Loading",e[e.Intro=1]="Intro",e[e.Busy=2]="Busy",e[e.Done=3]="Done",e[e.ConfirmSkip=4]="ConfirmSkip",e[e.Finished=5]="Finished",e[e.ConfirmReset=6]="ConfirmReset",e}({});class f extends o.a{constructor(...e){super(...e),i()(this,"started",void 0),i()(this,"phase",void 0),i()(this,"verificationRequest",null),i()(this,"backupInfo",null),i()(this,"keyId",null),i()(this,"keyInfo",null),i()(this,"hasDevicesToVerifyAgainst",void 0),i()(this,"onUserTrustStatusChanged",(async e=>{var t;if(e!==d.a.safeGet().getSafeUserId())return;await(null===(t=d.a.safeGet().getCrypto())||void 0===t?void 0:t.getCrossSigningKeyId())&&(this.phase=v.Done,this.emit("update"))})),i()(this,"onVerificationRequest",(e=>{this.setActiveVerificationRequest(e)})),i()(this,"onVerificationRequestChange",(async()=>{var e,t;if((null===(e=this.verificationRequest)||void 0===e?void 0:e.phase)===s.VerificationPhase.Cancelled)this.verificationRequest.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.verificationRequest=null,this.emit("update");else if((null===(t=this.verificationRequest)||void 0===t?void 0:t.phase)===s.VerificationPhase.Done){var n;this.verificationRequest.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.verificationRequest=null;const e=await(null===(n=d.a.safeGet().getCrypto())||void 0===n?void 0:n.getCrossSigningKeyId());this.phase=e?v.Done:v.Busy,this.emit("update")}}))}static sharedInstance(){return window.mxSetupEncryptionStore||(window.mxSetupEncryptionStore=new f),window.mxSetupEncryptionStore}start(){if(this.started)return;this.started=!0,this.phase=v.Loading;const e=d.a.safeGet();e.on(c.b.VerificationRequestReceived,this.onVerificationRequest),e.on(c.b.UserTrustStatusChanged,this.onUserTrustStatusChanged);const t=e.getCrypto().getVerificationRequestsToDeviceInProgress(e.getUserId());t.length&&this.setActiveVerificationRequest(t[t.length-1]),this.fetchKeyInfo()}stop(){var e;if(!this.started)return;this.started=!1,null===(e=this.verificationRequest)||void 0===e||e.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange);const t=d.a.get();t&&(t.removeListener(c.b.VerificationRequestReceived,this.onVerificationRequest),t.removeListener(c.b.UserTrustStatusChanged,this.onUserTrustStatusChanged))}async fetchKeyInfo(){var e,t;if(!this.started)return;const n=d.a.safeGet(),a=await n.secretStorage.isStored("m.cross_signing.master");null===a||0===Object.keys(a).length?(this.keyId=null,this.keyInfo=null):(this.keyId=Object.keys(a)[0],this.keyInfo=a[this.keyId]);const i=await n.getDehydratedDevice(),r=n.getUserId(),o=n.getCrypto(),s=null!==(e=null===(t=(await o.getUserDeviceInfo([r])).get(r))||void 0===t?void 0:t.values())&&void 0!==e?e:[];this.hasDevicesToVerifyAgainst=await Object(b.k)(s,(async e=>{if(i&&e.deviceId==(null==i?void 0:i.device_id))return!1;if(!e.getIdentityKey())return!1;const t=await o.getDeviceVerificationStatus(r,e.deviceId);return!(null==t||!t.signedByOwner)})),this.phase=v.Intro,this.emit("update")}async usePassPhrase(){this.phase=v.Busy,this.emit("update");try{var e;const t=d.a.safeGet(),n=await t.getKeyBackupVersion();this.backupInfo=n,this.emit("update"),await new Promise(((e,a)=>{Object(u.b)((async()=>{await t.checkOwnCrossSigningTrust(),e(),n&&await t.restoreKeyBackupWithSecretStorage(n)})).catch(a)})),await(null===(e=t.getCrypto())||void 0===e?void 0:e.getCrossSigningKeyId())&&(this.phase=v.Done,this.emit("update"))}catch(e){e instanceof u.a||l.a.log(e),this.phase=v.Intro,this.emit("update")}}skip(){this.phase=v.ConfirmSkip,this.emit("update")}skipConfirm(){this.phase=v.Finished,this.emit("update")}returnAfterSkip(){this.phase=v.Intro,this.emit("update")}reset(){this.phase=v.ConfirmReset,this.emit("update")}async resetConfirm(){try{await Object(u.b)((async()=>{var e;const t=d.a.safeGet();await(null===(e=t.getCrypto())||void 0===e?void 0:e.bootstrapCrossSigning({authUploadDeviceSigningKeys:async e=>{const n=g.b.instance.accountPasswordStore.getPassword();if(n)return void await e({type:"m.login.password",identifier:{type:"m.id.user",user:t.getSafeUserId()},user:t.getSafeUserId(),password:n});const{finished:a}=m.b.createDialog(h.a,{title:Object(p.b)("Setting up keys"),matrixClient:t,makeRequest:e}),[i]=await a;if(!i)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:!0})),this.phase=v.Finished}),!0)}catch(e){l.a.error("Error resetting cross-signing",e),this.phase=v.Intro}this.emit("update")}returnAfterReset(){this.phase=v.Intro,this.emit("update")}done(){var e;this.phase=v.Finished,this.emit("update"),null===(e=d.a.safeGet().crypto)||void 0===e||e.cancelAndResendAllOutgoingKeyRequests()}async setActiveVerificationRequest(e){this.started&&e.otherUserId===d.a.safeGet().getUserId()&&(this.verificationRequest&&this.verificationRequest.off(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.verificationRequest=e,await e.accept(),e.on(s.VerificationRequestEvent.Change,this.onVerificationRequestChange),this.emit("update"))}lostKeys(){return!this.hasDevicesToVerifyAgainst&&!this.keyInfo}}},1352:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return s}));var a=n(1376),i=n.n(a);let r=function(e){return e.Desktop="Desktop",e.Mobile="Mobile",e.Web="Web",e.Unknown="Unknown",e}({});const o=(e,t)=>e&&[e,t].filter(Boolean).join(" "),s=e=>{if(!e)return{deviceType:r.Unknown};const t=new i.a(e),n=t.getBrowser(),a=t.getDevice(),s=t.getOS(),l=((e,t,n,a)=>{var i;return"Electron"===n.name?r.Desktop:n.name?r.Web:"mobile"===t.type||null!==(i=a.name)&&void 0!==i&&i.includes("Android")||e.indexOf("; iOS ")>-1?r.Mobile:r.Unknown})(e,a,n,s),c=l===r.Web||l===r.Desktop,d=o(s.name,c?void 0:s.version),u=o(a.vendor,a.model),m=o(n.name,n.version),{customDeviceModel:h,customDeviceOS:p}=l!==r.Unknown?(e=>{if(e.includes("Mozilla/"))return{};if(!e.includes("("))return{};const t=e.substring(e.indexOf("(")+1).split("; ");return{customDeviceModel:t[0]||void 0,customDeviceOS:t[1]||void 0}})(e):{};return{deviceType:l,deviceModel:u||h,deviceOperatingSystem:d||p,client:m}}},1353:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return l}));var a=n(1319);const i=7776e6,r=90,o=e=>!!e.last_seen_ts&&e.last_seen_ts<Date.now()-i,s={[a.a.Verified]:e=>!!e.isVerified,[a.a.Unverified]:e=>!e.isVerified,[a.a.Inactive]:o},l=(e,t)=>{const n=t.map((e=>s[e]));return n.length?e.filter((e=>n.every((t=>t(e))))):e}},1354:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(4),i=n(32),r=n(105),o=n(5),s=n(633),l=n(97),c=n(56),d=n(69);const u=(e,t,n,o)=>!(n||o||e===a.EventType.RoomMessage||e===a.EventType.RoomMessageEncrypted||e===a.EventType.Sticker||e===a.EventType.RoomCreate||i.e.matches(e)||i.a.matches(e)||r.b.matches(e)||e===d.g&&(null==t?void 0:t.state)===d.h.Started);function m(e,t,n,m){const h=t.getContent(),p=h.msgtype,g=t.getType();let b=!1;if(o.b.getValue("feature_msc3531_hide_messages_pending_moderation"))switch(Object(l.h)(t,e)){case l.a.VISIBLE_FOR_ALL:case l.a.HIDDEN_TO_CURRENT_USER:break;case l.a.SEE_THROUGH_FOR_CURRENT_USER:b=!0}let v=Object(s.e)(t,e,n),f=g.startsWith("m.key.verification")||g===a.EventType.RoomMessage&&(null==p?void 0:p.startsWith("m.key.verification"))||g===a.EventType.RoomCreate||g===a.EventType.RoomEncryption||v===s.b;const y=!f&&(g===a.EventType.CallInvite||c.d.CALL_EVENT_TYPE.matches(g));let E=u(g,h,f,y);const w=g===a.EventType.RoomMessage&&p===a.MsgType.Emote||i.e.matches(g)||r.b.matches(g)||Object(l.l)(t)||g===d.g;return!m&&Object(s.c)(t,e,n)||(v=Object(s.e)(t,e,n,!0),v===s.a&&(f=!1,E=!0)),{hasRenderer:!!v,isInfoMessage:E,isBubbleMessage:f,isLeftAlignedBubbleMessage:y,noBubbleEvent:w,isSeeingThroughMessageHiddenForModeration:b}}},1355:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a,i,r,o=n(0);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s.apply(this,arguments)}function l(e){return o.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),a||(a=o.createElement("circle",{cx:4.25,cy:9,r:1.25,fill:"currentColor"})),i||(i=o.createElement("circle",{cx:9,cy:9,r:1.25,fill:"currentColor"})),r||(r=o.createElement("circle",{cx:13.75,cy:9,r:1.25,fill:"currentColor"})))}},1356:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return v}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(13),l=n.n(s),c=n(10),d=n(2),u=n(237),m=n(196),h=n(774);let p=function(e){return e.Admin="admin",e.Moderator="moderator",e}({});const g={[p.Admin]:Object(d.d)("Admin"),[p.Moderator]:Object(d.d)("Mod")},b={offline:"mx_EntityTile_offline",online:"mx_EntityTile_online",unavailable:"mx_EntityTile_unavailable"};class v extends o.a.PureComponent{constructor(e){super(e),this.state={hover:!1}}render(){const e={mx_EntityTile:!0,mx_EntityTile_noHover:!!this.props.suppressOnHover};this.props.className&&(e[this.props.className]=!0);var t,a;let i;e[(t=this.props.presenceState,a=this.props.presenceLastActiveAgo,!1===this.props.showPresence?"mx_EntityTile_online_beenactive":"offline"===t?a?b.offline+"_beenactive":b.offline+"_neveractive":t?b[t]:b.offline+"_neveractive")]=!0;const r=this.props.nameJSX||this.props.name;if(this.props.suppressOnHover)i=this.props.subtextLabel?o.a.createElement("div",{className:"mx_EntityTile_details"},o.a.createElement("div",{className:"mx_EntityTile_name"},r),o.a.createElement("span",{className:"mx_EntityTile_subtext"},this.props.subtextLabel)):o.a.createElement("div",{className:"mx_EntityTile_name"},r);else{const e=this.props.presenceLastActiveAgo?Date.now()-(this.props.presenceLastTs-this.props.presenceLastActiveAgo):-1;let t;this.props.showPresence&&(t=o.a.createElement(h.a,{activeAgo:e,currentlyActive:this.props.presenceCurrentlyActive,presenceState:this.props.presenceState})),this.props.subtextLabel&&(t=o.a.createElement("span",{className:"mx_EntityTile_subtext"},this.props.subtextLabel)),i=o.a.createElement("div",{className:"mx_EntityTile_details"},o.a.createElement("div",{className:"mx_EntityTile_name"},r),t)}let s,p;this.props.showInviteButton&&(s=o.a.createElement("div",{className:"mx_EntityTile_invite"},o.a.createElement("img",{alt:Object(d.b)("Invite"),src:n(1479).default,width:"16",height:"16"})));const v=this.props.powerStatus;if(v){const e=Object(d.b)(g[v]);p=o.a.createElement("div",{className:"mx_EntityTile_power"},e)}let f;const{e2eStatus:y}=this.props;y&&(f=o.a.createElement(u.b,{status:y,isUser:!0,bordered:!0}));const E=this.props.avatarJsx||o.a.createElement(m.a,{name:this.props.name,width:36,height:36,"aria-hidden":"true"});return o.a.createElement("div",null,o.a.createElement(c.a,{className:l()(e),title:this.props.title,onClick:this.props.onClick},o.a.createElement("div",{className:"mx_EntityTile_avatar"},E,f),i,p,s))}}i()(v,"defaultProps",{onClick:()=>{},presenceState:"offline",presenceLastActiveAgo:0,presenceLastTs:0,showInviteButton:!1,suppressOnHover:!1,showPresence:!0})},1357:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(0);const i=e=>{const t=Object(a.useRef)(null);return[Object(a.useCallback)((e=>{t.current=e}),[]),Object(a.useCallback)(((n,a)=>{t.current===n&&e(a)}),[e])]}},1358:function(e,t,n){"use strict";var a=n(17),i=n.n(a),r=n(24),o=n.n(r),s=n(0),l=n.n(s),c=n(4),d=n(36),u=n(2),m=n(184),h=n(652),p=n(21),g=n(9),b=n(377),v=n(5),f=n(182),y=n(14),E=n(140),w=n(40),S=n(113);const _=["space","hideHeader","onFinished"];t.a=e=>{let{space:t,hideHeader:n,onFinished:a}=e,r=o()(e,_);const C=Object(s.useContext)(p.a).getSafeUserId(),O=Object(f.a)("feature_video_rooms"),x=Object(f.a)("feature_element_call_video_rooms");if(!t)return null;let k=null;if("public"===t.getJoinRule()||t.canInvite(C)){const e=e=>{e.preventDefault(),e.stopPropagation(),Object(m.i)(t),a()};k=l.a.createElement(d.b,{"data-testid":"invite-option",className:"mx_SpacePanel_contextMenu_inviteButton",iconClassName:"mx_SpacePanel_iconInvite",label:Object(u.b)("Invite"),onClick:e})}let R=null,j=null;if(Object(m.d)(t)){const e=e=>{e.preventDefault(),e.stopPropagation(),Object(m.k)(t),a()};R=l.a.createElement(d.b,{"data-testid":"settings-option",iconClassName:"mx_SpacePanel_iconSettings",label:Object(u.b)("Settings"),onClick:e})}else{const e=e=>{e.preventDefault(),e.stopPropagation(),Object(h.b)(t),a()};j=l.a.createElement(d.b,{"data-testid":"leave-option",iconClassName:"mx_SpacePanel_iconLeave",className:"mx_IconizedContextMenu_option_red",label:Object(u.b)("Leave space"),onClick:e})}let I=null;if(v.b.getValue("developerMode")){const e=e=>{e.preventDefault(),e.stopPropagation(),g.a.dispatch({action:y.a.ViewRoom,room_id:t.roomId,forceTimeline:!0,metricsTrigger:void 0}),a()};I=l.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconSettings",label:Object(u.b)("See room timeline (devtools)"),onClick:e})}const T=t.currentState.maySendStateEvent(c.EventType.SpaceChild,C),P=T&&Object(E.a)(w.a.CreateRooms),N=P&&O,D=T&&Object(E.a)(w.a.CreateSpaces);let M=null;if(P||D){const e=e=>{e.preventDefault(),e.stopPropagation(),S.b.trackInteraction("WebSpaceContextMenuNewRoomItem",e),Object(m.g)(t),a()},n=e=>{e.preventDefault(),e.stopPropagation(),Object(m.g)(t,x?c.RoomType.UnstableCall:c.RoomType.ElementVideo),a()},i=e=>{e.preventDefault(),e.stopPropagation(),Object(m.h)(t),a()};M=l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{"data-testid":"add-to-space-header",className:"mx_SpacePanel_contextMenu_separatorLabel"},Object(u.b)("Add")),P&&l.a.createElement(d.b,{"data-testid":"new-room-option",iconClassName:"mx_SpacePanel_iconPlus",label:Object(u.b)("Room"),onClick:e}),N&&l.a.createElement(d.b,{"data-testid":"new-video-room-option",iconClassName:"mx_SpacePanel_iconPlus",label:Object(u.b)("Video room"),onClick:n},l.a.createElement(b.a,null)),D&&l.a.createElement(d.b,{"data-testid":"new-subspace-option",iconClassName:"mx_SpacePanel_iconPlus",label:Object(u.b)("Space"),onClick:i},l.a.createElement(b.a,null)))}const A=e=>{e.preventDefault(),e.stopPropagation(),g.a.dispatch({action:y.a.ViewRoom,room_id:t.roomId,metricsTrigger:void 0}),a()};return l.a.createElement(d.e,i()({},r,{onFinished:a,className:"mx_SpacePanel_contextMenu",compact:!0}),!n&&l.a.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},t.name),l.a.createElement(d.c,{first:!0},l.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconHome",label:Object(u.b)("Space home"),onClick:e=>{S.b.trackInteraction("WebSpaceContextMenuHomeItem",e),A(e)}}),k,l.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconExplore",label:P?Object(u.b)("Manage & explore rooms"):Object(u.b)("Explore rooms"),onClick:e=>{S.b.trackInteraction("WebSpaceContextMenuExploreRoomsItem",e),A(e)}}),l.a.createElement(d.b,{iconClassName:"mx_SpacePanel_iconPreferences",label:Object(u.b)("Preferences"),onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(m.j)(t),a()}}),I,R,j,M))}},1359:function(e,t,n){"use strict";t.__esModule=!0,t.createSubscription=function(e,t){var n,r=i;function o(){l.onStateChange&&l.onStateChange()}function s(){var i,s,l;n||(n=t?t.addNestedSub(o):e.subscribe(o),i=(0,a.getBatch)(),s=null,l=null,r={clear:function(){s=null,l=null},notify:function(){i((function(){for(var e=s;e;)e.callback(),e=e.next}))},get:function(){for(var e=[],t=s;t;)e.push(t),t=t.next;return e},subscribe:function(e){var t=!0,n=l={callback:e,next:null,prev:l};return n.prev?n.prev.next=n:s=n,function(){t&&null!==s&&(t=!1,n.next?n.next.prev=n.prev:l=n.prev,n.prev?n.prev.next=n.next:s=n.next)}}})}var l={addNestedSub:function(e){return s(),r.subscribe(e)},notifyNestedSubs:function(){r.notify()},handleChangeWrapper:o,isSubscribed:function(){return Boolean(n)},trySubscribe:s,tryUnsubscribe:function(){n&&(n(),n=void 0,r.clear(),r=i)},getListeners:function(){return r}};return l};var a=n(1407);var i={notify:function(){},get:function(){return[]}}},1360:function(e,t,n){"use strict";t.__esModule=!0,t.useIsomorphicLayoutEffect=void 0;var a=n(0),i="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?a.useLayoutEffect:a.useEffect;t.useIsomorphicLayoutEffect=i},1361:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(260),l=n.n(s),c=n(13),d=n.n(c),u=n(3),m=n(2),h=n(9),p=n(7),g=n(21),b=n(169);class v extends o.a.PureComponent{constructor(e,t){super(e,t),i()(this,"unmounted",!1),i()(this,"dispatcherRef",null),i()(this,"onAction",(e=>{"client_started"===e.action&&this.forceUpdate()})),this.state={page:""}}translate(e){return l()(Object(m.b)(e))}async fetchEmbed(){let e;try{e=await fetch(this.props.url,{method:"GET"})}catch(e){if(this.unmounted)return;return u.a.warn(`Error loading page: ${e}`),void this.setState({page:Object(m.b)("Couldn't load page")})}if(this.unmounted)return;if(!e.ok)return u.a.warn(`Error loading page: ${e.status}`),void this.setState({page:Object(m.b)("Couldn't load page")});let t=(await e.text()).replace(/_t\(['"]([\s\S]*?)['"]\)/gm,((e,t)=>this.translate(t)));this.props.replaceMap&&Object.keys(this.props.replaceMap).forEach((e=>{t=t.split(e).join(this.props.replaceMap[e])})),this.setState({page:t})}componentDidMount(){this.unmounted=!1,this.props.url&&(this.fetchEmbed(),this.dispatcherRef=h.a.register(this.onAction))}componentWillUnmount(){this.unmounted=!0,null!==this.dispatcherRef&&h.a.unregister(this.dispatcherRef)}render(){const e=this.context||p.a.get(),t=!e||e.isGuest(),n=this.props.className,a=d()(n,{[`${n}_guest`]:t,[`${n}_loggedIn`]:!!e}),i=o.a.createElement("div",{className:`${n}_body`,dangerouslySetInnerHTML:{__html:this.state.page}});return this.props.scrollbar?o.a.createElement(b.a,{className:a},i):o.a.createElement("div",{className:a},i)}}i()(v,"contextType",g.a)},1362:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.WidgetLifecycle=void 0,t.WidgetLifecycle=a,function(e){e.CapabilitiesRequest="capabilities_request",e.PreLoadRequest="preload_request",e.IdentityRequest="identity_request"}(a||(t.WidgetLifecycle=a={}))},1363:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(1),i=n.n(a),r=n(4),o=n(1326),s=n(3),l=n(1535),c=n.n(l),d=n(1417),u=n(300),m=n(63),h=n(71),p=n(97),g=n(2),b=n(25);class v{constructor(e,t,n,a){if(this.room=e,this.exportType=t,this.exportOptions=n,this.setProgressText=a,i()(this,"files",[]),i()(this,"cancelled",!1),n.maxSize<1048576||n.maxSize>8388608e3||n.numberOfMessages&&n.numberOfMessages>10**8||t===d.b.LastNMessages&&!n.numberOfMessages)throw new Error("Invalid export options");window.addEventListener("beforeunload",this.onBeforeUnload)}get destinationFileName(){return this.makeFileNameNoExtension(b.b.get().brand)+".zip"}onBeforeUnload(e){return e.preventDefault(),e.returnValue=Object(g.b)("Are you sure you want to exit during this export?")}updateProgress(e,t=!0,n=!0){t&&s.a.log(e),n&&this.setProgressText(e)}addFile(e,t){const n={name:e,blob:t};this.files.push(n)}makeFileNameNoExtension(e="matrix"){var t;const n=c()(null!==(t=this.room.name)&&void 0!==t?t:Object(g.b)("Unnamed Room")).trim()||"Unnamed Room",a=Object(h.f)(new Date).replace(/:/g,"-");return`${c()(e)} - ${n} - Chat Export - ${a}`}async downloadZIP(){const e=this.destinationFileName,t=e.substring(0,e.lastIndexOf(".")),{default:a}=await n.e(44).then(n.t.bind(null,1584,7)),i=new a;if(this.cancelled)return this.cleanUp();this.updateProgress(Object(g.b)("Generating a ZIP"));for(const e of this.files)i.file(t+"/"+e.name,e.blob);const r=await i.generateAsync({type:"blob"});Object(o.saveAs)(r,t+".zip")}cleanUp(){return s.a.log("Cleaning up..."),window.removeEventListener("beforeunload",this.onBeforeUnload),""}async cancelExport(){s.a.log("Cancelling export..."),this.cancelled=!0}downloadPlainText(e,t){const n=new Blob([t],{type:"text/plain"});Object(o.saveAs)(n,e)}setEventMetadata(e){const t=this.room.currentState,n=e.getSender();var a;(e.sender=!!n&&(null==t?void 0:t.getSentinelMember(n))||null,"m.room.member"===e.getType())&&(e.target=null!==(a=null==t?void 0:t.getSentinelMember(e.getStateKey()))&&void 0!==a?a:null);return e}getLimit(){let e;switch(this.exportType){case d.b.LastNMessages:e=this.exportOptions.numberOfMessages;break;case d.b.Timeline:e=40;break;default:e=10**8}return e}async getRequiredEvents(){const e=this.room.client.getEventMapper();let t=null,n=this.getLimit();const a=[];for(;n;){var i;const o=Math.min(n,1e3),s=await this.room.client.createMessagesRequest(this.room.roomId,t,o,r.Direction.Backward);if(this.cancelled)return this.cleanUp(),[];if(0===s.chunk.length)break;n-=s.chunk.length;const l=s.chunk.map(e);for(const e of l)a.push(e);this.exportType===d.b.LastNMessages?this.updateProgress(Object(g.b)("Fetched %(count)s events out of %(total)s",{count:a.length,total:this.exportOptions.numberOfMessages})):this.updateProgress(Object(g.b)("Fetched %(count)s events so far",{count:a.length})),t=null!==(i=s.end)&&void 0!==i?i:null}for(let e=0;e<Math.floor(a.length/2);e++)[a[e],a[a.length-e-1]]=[a[a.length-e-1],a[e]];const o=a.filter((e=>e.isEncrypted())).map((e=>this.room.client.decryptEventIfNeeded(e,{isRetry:!0,emit:!1})));await Promise.all(o);for(let e=0;e<a.length;e++)this.setEventMetadata(a[e]);return a}async getMediaBlob(e){let t;try{const n=e.isEncrypted(),a=e.getContent();if(n&&a.hasOwnProperty("file")&&"m.sticker"!==e.getType())t=await Object(u.c)(a.file);else{const e=Object(m.a)(a);if(!e.srcHttp)throw new Error("Cannot fetch without srcHttp");const n=await fetch(e.srcHttp);t=await n.blob()}}catch(e){s.a.log("Error decrypting media")}if(!t)throw new Error("Unable to fetch file");return t}splitFileName(e){const t=e.lastIndexOf(".");if(-1===t)return[e,""];return[e.slice(0,t),"."+e.slice(t+1)]}getFilePath(e){let t;switch(e.getContent().msgtype){case"m.image":t="images";break;case"m.video":t="videos";break;case"m.audio":t="audio";break;default:t="m.sticker"===e.getType()?"stickers":"files"}const n=Object(h.e)(new Date(e.getTs()));let[a,i]=this.splitFileName(e.getContent().body);return"m.sticker"===e.getType()&&(i=".png"),Object(p.m)(e)&&(i=".ogg"),t+"/"+a+"-"+n+i}isReply(e){const t=(e.isEncrypted()?e.event.content:e.getContent())["m.relates_to"];return!(!t||!t["m.in_reply_to"])}isAttachment(e){const t=["m.sticker","m.image","m.file","m.video","m.audio"];return e.getType()===t[0]||t.includes(e.getContent().msgtype)}}},1364:function(e,t,n){"use strict";(function(e){var a=n(0),i=n.n(a),r=n(4),o=n(21),s=n(28),l=n(64),c=n(2),d=n(10),u=n(1415),m=n(92),h=n(9),p=n(14),g=n(51),b=n(184),v=n(163),f=n(429),y=n(7),E=n(140),w=n(40),S=n(240),_=n(174),C=n(1418);t.a=()=>{var t;const n=Object(a.useContext)(o.a),{room:O,roomId:x}=Object(a.useContext)(s.b);if(!O||!x)throw new Error("Unable to create a NewRoomIntro without room and roomId");const k=O instanceof _.b,R=k?null===(t=O.targets[0])||void 0===t?void 0:t.userId:l.a.shared().getUserIdForRoomId(x);let j;if(R){const{shouldEncrypt:e}=Object(C.a)(O),t=((e,t)=>e instanceof _.b?Object(c.d)("Send your first message to invite <displayName/> to chat"):t?Object(c.d)("Once everyone has joined, you’ll be able to chat"):Object(c.d)("This is the beginning of your direct message history with <displayName/>."))(O,e);let n;O instanceof _.b||e||O.getJoinedMemberCount()+O.getInvitedMemberCount()!==2||(n=Object(c.b)("Only the two of you are in this conversation, unless either of you invites anyone to join."));const a=null==O?void 0:O.getMember(R),r=(null==O?void 0:O.name)||(null==a?void 0:a.rawDisplayName)||R;j=i.a.createElement(i.a.Fragment,null,i.a.createElement(m.a,{room:O,width:u.a,height:u.a,onClick:()=>{h.a.dispatch({action:p.a.ViewUser,member:a||{userId:R}})}}),i.a.createElement("h2",null,O.name),i.a.createElement("p",null,Object(c.b)(t,{},{displayName:()=>i.a.createElement("b",null,r)})),n&&i.a.createElement("p",null,n))}else{var I,T,P,N,D,M,A;const t=O&&"join"===O.getMyMembership(),a=null===(I=O.currentState.getStateEvents(r.EventType.RoomTopic,""))||void 0===I||null===(T=I.getContent())||void 0===T?void 0:T.topic,o=t&&O.currentState.maySendStateEvent(r.EventType.RoomTopic,n.getSafeUserId()),s=()=>{h.a.dispatch({action:"open_room_settings",room_id:x},!0),e((()=>{var e;null===(e=window.document.getElementById("profileTopic"))||void 0===e||e.focus()}))};let l;o&&a?l=Object(c.b)("Topic: %(topic)s (<a>edit</a>)",{topic:a},{a:e=>i.a.createElement(d.a,{element:"a",kind:"link_inline",onClick:s},e)}):a?l=Object(c.b)("Topic: %(topic)s ",{topic:a}):o&&(l=Object(c.b)("<a>Add a topic</a> to help people know what it is about.",{},{a:e=>i.a.createElement(d.a,{element:"a",kind:"link_inline",onClick:s},e)}));const p=null===(P=O.currentState.getStateEvents(r.EventType.RoomCreate,""))||void 0===P?void 0:P.getSender(),v=p&&(null==O||null===(N=O.getMember(p))||void 0===N?void 0:N.rawDisplayName)||p;let f,y,S;f=p===n.getUserId()?Object(c.b)("You created this room."):Object(c.b)("%(displayName)s created this room.",{displayName:v}),null!==(D=g.a.instance.activeSpaceRoom)&&void 0!==D&&D.canInvite(n.getSafeUserId())&&g.a.instance.isRoomInSpace(g.a.instance.activeSpace,O.roomId)&&(y=g.a.instance.activeSpaceRoom),y&&Object(E.a)(w.a.InviteUsers)?S=i.a.createElement("div",{className:"mx_NewRoomIntro_buttons"},i.a.createElement(d.a,{className:"mx_NewRoomIntro_inviteButton",kind:"primary",onClick:()=>{Object(b.i)(y)}},Object(c.b)("Invite to %(spaceName)s",{spaceName:y.name})),O.canInvite(n.getSafeUserId())&&i.a.createElement(d.a,{className:"mx_NewRoomIntro_inviteButton",kind:"primary_outline",onClick:()=>{h.a.dispatch({action:"view_invite",roomId:x})}},Object(c.b)("Invite to just this room"))):O.canInvite(n.getSafeUserId())&&Object(E.a)(w.a.InviteUsers)&&(S=i.a.createElement("div",{className:"mx_NewRoomIntro_buttons"},i.a.createElement(d.a,{className:"mx_NewRoomIntro_inviteButton",kind:"primary",onClick:()=>{h.a.dispatch({action:"view_invite",roomId:x})}},Object(c.b)("Invite to this room"))));const _=null===(M=O.currentState.getStateEvents(r.EventType.RoomAvatar,""))||void 0===M||null===(A=M.getContent())||void 0===A?void 0:A.url;let C=i.a.createElement(m.a,{room:O,width:u.a,height:u.a,viewAvatarOnClick:!!_});_||(C=i.a.createElement(u.b,{hasAvatar:!1,noAvatarLabel:Object(c.b)("Add a photo, so people can easily spot your room."),setAvatarUrl:e=>n.sendStateEvent(x,r.EventType.RoomAvatar,{url:e},"")},C)),j=i.a.createElement(i.a.Fragment,null,C,i.a.createElement("h2",null,O.name),i.a.createElement("p",null,f," ",Object(c.b)("This is the start of <roomName/>.",{},{roomName:()=>i.a.createElement("b",null,O.name)})),i.a.createElement("p",null,l),S)}const L=Object(c.b)("Your private messages are normally encrypted, but this room isn't. Usually this is due to an unsupported device or method being used, like email invites.");let U;O.currentState.mayClientSendStateEvent(r.EventType.RoomEncryption,y.a.safeGet())&&!k&&(U=i.a.createElement(d.a,{kind:"link_inline",onClick:function(e){e.preventDefault(),h.a.dispatch({action:"open_room_settings",initial_tab_id:f.a.Security})}},Object(c.b)("Enable encryption in settings.")));const F=i.a.createElement("span",null," ",L," ",U," ");return i.a.createElement("li",{className:"mx_NewRoomIntro"},!function(e,t){const n=e.isRoomEncrypted(t.roomId);return"public"===t.getJoinRule()||!Object(S.a)(e)||n}(n,O)&&i.a.createElement(v.a,{className:"mx_cryptoEvent mx_cryptoEvent_icon_warning",title:Object(c.b)("End-to-end encryption isn't enabled"),subtitle:F}),j)}}).call(this,n(267).setImmediate)},1365:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(1),i=n.n(a);const r=n(1324).a.encodeActions;class o{}i()(o,"ACTION_NOTIFY",r({notify:!0})),i()(o,"ACTION_NOTIFY_DEFAULT_SOUND",r({notify:!0,sound:"default"})),i()(o,"ACTION_NOTIFY_RING_SOUND",r({notify:!0,sound:"ring"})),i()(o,"ACTION_HIGHLIGHT",r({notify:!0,highlight:!0})),i()(o,"ACTION_HIGHLIGHT_DEFAULT_SOUND",r({notify:!0,sound:"default",highlight:!0})),i()(o,"ACTION_DONT_NOTIFY",r({notify:!1})),i()(o,"ACTION_DISABLED",void 0)},1366:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(1426),l=n(25),c=n(2),d=n(417);const u={};for(const e of s.a)u[e.iso2]=e;function m(e,t){return"+"===e[0]&&(e=e.slice(1)),0==t.name.toUpperCase().indexOf(e.toUpperCase())||(t.iso2==e.toUpperCase()||-1!==t.prefix.indexOf(e))}class h extends o.a.Component{constructor(e){var t;let n;super(e),i()(this,"onSearchChange",(e=>{this.setState({searchQuery:e})})),i()(this,"onOptionChange",(e=>{this.props.onOptionChange(u[e])})),i()(this,"getShortOption",(e=>{if(!this.props.isSmall)return;let t;return this.props.showPrefix&&(t="+"+u[e].prefix),o.a.createElement("span",{className:"mx_CountryDropdown_shortOption"},this.flagImgForIso2(e),t)}));const a=l.b.get("default_country_code");if(a){const e=s.a.find((e=>e.iso2===a.toUpperCase()));e&&(n=e)}if(!n)try{var r,c,d,m;const e=new Intl.Locale(null!==(r=navigator.language)&&void 0!==r?r:navigator.languages[0]),t=null!==(c=null!==(d=e.region)&&void 0!==d?d:e.language)&&void 0!==c?c:e.baseName,a=null===(m=new Intl.DisplayNames(["en"],{type:"region"}).of(t))||void 0===m?void 0:m.toUpperCase();n=s.a.find((e=>e.iso2===t.toUpperCase()||e.name.toUpperCase()===a))}catch(e){console.warn("Failed to detect default locale",e)}this.state={searchQuery:"",defaultCountry:null!==(t=n)&&void 0!==t?t:s.a[0]}}componentDidMount(){this.props.value||this.props.onOptionChange(this.state.defaultCountry)}flagImgForIso2(e){return o.a.createElement("div",{className:"mx_Dropdown_option_emoji"},Object(s.b)(e))}render(){let e;if(this.state.searchQuery){if(e=s.a.filter(m.bind(this,this.state.searchQuery)),2==this.state.searchQuery.length&&u[this.state.searchQuery.toUpperCase()]){const t=u[this.state.searchQuery.toUpperCase()];e=e.filter((e=>e.iso2!=t.iso2)),e.unshift(t)}}else e=s.a;const t=e.map((e=>o.a.createElement("div",{className:"mx_CountryDropdown_option",key:e.iso2},this.flagImgForIso2(e.iso2),Object(c.b)(e.name)," (+",e.prefix,")"))),n=this.props.value||this.state.defaultCountry.iso2;return o.a.createElement(d.a,{id:"mx_CountryDropdown",className:this.props.className+" mx_CountryDropdown",onOptionChange:this.onOptionChange,onSearchChange:this.onSearchChange,menuWidth:298,getShortOption:this.getShortOption,value:n,searchEnabled:!0,disabled:this.props.disabled,label:Object(c.b)("Country Dropdown"),autoComplete:"tel-country-code"},t)}}},1367:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(46),l=n(229),c=n(2);class d extends r.PureComponent{constructor(...e){super(...e),i()(this,"validate",Object(l.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(c.b)(this.props.labelRequired)},{key:"match",test:({value:e})=>!e||e===this.props.password,invalid:()=>Object(c.b)(this.props.labelInvalid)}]})),i()(this,"onValidate",(async e=>{const t=await this.validate(e);return this.props.onValidate&&this.props.onValidate(t),t}))}render(){return o.a.createElement(s.a,{id:this.props.id,ref:this.props.fieldRef,type:"password",label:Object(c.b)(this.props.label),autoComplete:this.props.autoComplete,value:this.props.value,onChange:this.props.onChange,onValidate:this.onValidate})}}i()(d,"defaultProps",{label:Object(c.d)("Confirm password"),labelRequired:Object(c.d)("Confirm password"),labelInvalid:Object(c.d)("Passwords don't match")}),t.a=d},1368:function(e,t,n){"use strict";var a=n(17),i=n.n(a),r=n(24),o=n.n(r),s=n(0),l=n.n(s),c=n(39),d=n(13),u=n.n(d),m=n(528),h=n(75),p=n(10),g=n(2),b=n(62),v=n(63),f=n(107);const y=["matrixClient","loginType","fragmentAfterLogin","idp","primary","mini","action","flow"],E=e=>{let t,{matrixClient:a,loginType:r,fragmentAfterLogin:s,idp:c,primary:d,mini:E,action:w,flow:S}=e,_=o()(e,y);t=c?Object(g.b)("Continue with %(provider)s",{provider:c.name}):m.a.findIn(S)?Object(g.b)("Continue"):Object(g.b)("Sign in with single sign-on");const C=()=>{var e,t;const n=(e=>{switch(e){case m.b.Apple:return"Apple";case m.b.Facebook:return"Facebook";case m.b.Github:return"GitHub";case m.b.Gitlab:return"GitLab";case m.b.Google:return"Google";default:return"SSO"}})(null!==(e=null==c?void 0:c.brand)&&void 0!==e?e:"");f.a.instance.setAuthenticationType(n),null===(t=h.a.get())||void 0===t||t.startSingleSignOn(a,r,s,null==c?void 0:c.id,w)};let O,x;const k=null!=c&&c.brand?(e=>{switch(e){case m.b.Apple:return n(1567).default;case m.b.Facebook:return n(1568).default;case m.b.Github:return n(1569).default;case m.b.Gitlab:return n(1570).default;case m.b.Google:return n(1571).default;case m.b.Twitter:return n(1572).default;default:return null}})(c.brand):null;if(null!=c&&c.brand&&k){const e=c.brand.split(".").pop();x=`mx_SSOButton_brand_${e}`,O=l.a.createElement("img",{src:k,height:"24",width:"24",alt:e})}else if("string"==typeof(null==c?void 0:c.icon)&&c.icon.startsWith("mxc://")){var R;const e=null!==(R=Object(v.b)(c.icon,a).getSquareThumbnailHttp(24))&&void 0!==R?R:void 0;O=l.a.createElement("img",{src:e,height:"24",width:"24",alt:c.name})}const j=x?{[x]:x}:void 0,I=u()("mx_SSOButton",{mx_SSOButton_mini:E,mx_SSOButton_default:!c,mx_SSOButton_primary:d},j);return E?l.a.createElement(b.a,i()({},_,{title:t,className:I,onClick:C}),O):l.a.createElement(p.a,i()({},_,{className:I,onClick:C}),O,t)};t.a=({matrixClient:e,flow:t,loginType:n,fragmentAfterLogin:a,primary:i,action:r})=>{const o=t.identity_providers||[];if(o.length<2)return l.a.createElement("div",{className:"mx_SSOButtons"},l.a.createElement(E,{matrixClient:e,loginType:n,fragmentAfterLogin:a,idp:o[0],primary:i,action:r,flow:t}));const s=Math.ceil(o.length/6),d=Math.ceil(o.length/s);return l.a.createElement("div",{className:"mx_SSOButtons"},Object(c.chunk)(o,d).map((o=>l.a.createElement("div",{key:o[0].id,className:"mx_SSOButtons_row"},o.map((o=>l.a.createElement(E,{key:o.id,matrixClient:e,loginType:n,fragmentAfterLogin:a,idp:o,mini:!0,primary:i,action:r,flow:t})))))))}},1373:function(e,t,n){"use strict";n.d(t,"b",(function(){return le})),n.d(t,"a",(function(){return ce}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(103),l=n.n(s),c=n(13),d=n.n(c),u=n(4),m=n(3),h=n(105),p=n(6),g=n(425),b=n(71),v=n(7),f=n(5),y=n(28),E=n(256),w=n(2),S=n(1320),_=n(202);class C extends o.a.Component{constructor(e){super(e),i()(this,"onMouseDown",(e=>{this.setState({location:{currentX:e.clientX,currentY:e.clientY}}),document.addEventListener("mousemove",this.state.onMouseMove),document.addEventListener("mouseup",this.state.onMouseUp)})),i()(this,"onMouseUp",(e=>{document.removeEventListener("mousemove",this.state.onMouseMove),document.removeEventListener("mouseup",this.state.onMouseUp),this.props.onMouseUp(e)})),this.state={onMouseMove:this.onMouseMove.bind(this),onMouseUp:this.onMouseUp.bind(this),location:{currentX:0,currentY:0}}}onMouseMove(e){const t=this.props.dragFunc(this.state.location,e);this.setState({location:t})}render(){return o.a.createElement("div",{className:this.props.className,onMouseDown:this.onMouseDown})}}var O=n(15);class x extends o.a.Component{constructor(e){super(e),i()(this,"dragFunc",((e,t)=>{const n=t.clientX-e.currentX,a=this.state.width+n;return a<this.props.minWidth||a>this.props.maxWidth?e:(this.setState({width:a}),this.updateCSSWidth.bind(this)(a),{currentX:t.clientX,currentY:e.currentY})})),i()(this,"onMoueUp",(()=>{this.props.roomId&&f.b.setValue("ircDisplayNameWidth",this.props.roomId,O.a.ROOM_DEVICE,this.state.width)})),this.state={width:f.b.getValue("ircDisplayNameWidth",this.props.roomId),IRCLayoutRoot:null}}componentDidMount(){this.setState({IRCLayoutRoot:document.querySelector(".mx_IRCLayout")},(()=>this.updateCSSWidth(this.state.width)))}updateCSSWidth(e){var t;null===(t=this.state.IRCLayoutRoot)||void 0===t||t.style.setProperty("--name-width",e+"px")}render(){return o.a.createElement(C,{className:"mx_ProfileResizer",dragFunc:this.dragFunc,onMouseUp:this.onMoueUp})}}var k=n(64),R=n(1364),j=n(163);var I=()=>{var e;const{room:t}=Object(r.useContext)(y.b),n=null==t?void 0:t.getLiveTimeline().getState(u.EventTimeline.BACKWARDS),a=null==n?void 0:n.getStateEvents("m.room.encryption")[0],i=null==n||null===(e=n.getStateEvents("m.room.history_visibility")[0])||void 0===e?void 0:e.getContent().history_visibility;let s;return"invited"==i?s=Object(w.b)("You don't have permission to view messages from before you were invited."):"joined"==i?s=Object(w.b)("You don't have permission to view messages from before you joined."):a&&(s=Object(w.b)("Encrypted messages before this point are unavailable.")),o.a.createElement(j.a,{className:"mx_HistoryTile",title:Object(w.b)("You can't see earlier messages"),subtitle:s})},T=n(9);function P(e,t=[]){const n=[],a=Object.keys(e.currentState.members);for(const i of a)e.currentState.members[i].typing&&-1===t.indexOf(i)&&n.push(e.currentState.members[i]);return n}var N=n(281),D=n(116);class M extends o.a.Component{constructor(...e){var t;super(...e),i()(this,"state",{usersTyping:(t=this.props.room,P(t,[t.client.getSafeUserId()])),delayedStopTypingTimers:{}}),i()(this,"isVisible",(()=>M.isVisible(this.state))),i()(this,"onRoomTimeline",((e,t)=>{if((null==t?void 0:t.roomId)===this.props.room.roomId){const t=e.getSender(),n=this.state.usersTyping.filter((e=>e.userId!==t));n.length!==this.state.usersTyping.length&&this.setState({usersTyping:n}),this.abortUserTimer(t)}})),i()(this,"onRoomMemberTyping",(()=>{const e=function(e){return P(e,[e.client.getSafeUserId()].concat(e.client.getIgnoredUsers()))}(this.props.room);this.setState({delayedStopTypingTimers:this.updateDelayedStopTypingTimers(e),usersTyping:e})}))}componentDidMount(){v.a.safeGet().on(u.RoomMemberEvent.Typing,this.onRoomMemberTyping),v.a.safeGet().on(u.RoomEvent.Timeline,this.onRoomTimeline)}componentDidUpdate(e,t){const n=M.isVisible(t),a=M.isVisible(this.state);this.props.onShown&&!n&&a?this.props.onShown():this.props.onHidden&&n&&!a&&this.props.onHidden()}componentWillUnmount(){const e=v.a.get();e&&(e.removeListener(u.RoomMemberEvent.Typing,this.onRoomMemberTyping),e.removeListener(u.RoomEvent.Timeline,this.onRoomTimeline)),Object.values(this.state.delayedStopTypingTimers).forEach((e=>e.abort()))}static isVisible(e){return 0!==e.usersTyping.length||0!==Object.keys(e.delayedStopTypingTimers).length}updateDelayedStopTypingTimers(e){const t=this.state.usersTyping.filter((t=>!e.some((e=>t.userId===e.userId)))),n=e.filter((e=>!this.state.usersTyping.some((t=>e.userId===t.userId))));n.forEach((e=>{const t=this.state.delayedStopTypingTimers[e.userId];t&&t.abort()}));let a=Object.assign({},this.state.delayedStopTypingTimers);return a=n.reduce(((e,t)=>(delete e[t.userId],e)),a),a=t.reduce(((e,t)=>{if(!e[t.userId]){const n=new N.a(5e3);e[t.userId]=n,n.start(),n.finished().then((()=>this.removeUserTimer(t.userId)),(()=>{}))}return e}),a),a}abortUserTimer(e){const t=this.state.delayedStopTypingTimers[e];t&&(t.abort(),this.removeUserTimer(e))}removeUserTimer(e){if(this.state.delayedStopTypingTimers[e]){const t=Object.assign({},this.state.delayedStopTypingTimers);delete t[e],this.setState({delayedStopTypingTimers:t})}}renderTypingIndicatorAvatars(e,t){let n=0;e.length>t&&(n=e.length-t+1,e=e.slice(0,t-1));const a=e.map((e=>o.a.createElement(D.b,{key:e.userId,member:e,width:24,height:24,resizeMethod:"crop",viewUserOnClick:!0,"aria-live":"off"})));return n>0&&a.push(o.a.createElement("span",{className:"mx_WhoIsTypingTile_remainingAvatarPlaceholder",key:"others"},"+",n)),a}render(){const e=[...this.state.usersTyping];for(const t in this.state.delayedStopTypingTimers){const n=this.props.room.getMember(t);n&&e.push(n)}e.sort(((e,t)=>Object(p.h)(e.name,t.name)));const t=function(e,t){let n=0;if(e.length>t&&(n=e.length-t+1),0===e.length)return"";if(1===e.length)return Object(w.b)("%(displayName)s is typing …",{displayName:e[0].name});const a=e.map((e=>e.name));if(n>=1)return Object(w.b)("%(names)s and %(count)s others are typing …",{names:a.slice(0,t-1).join(", "),count:n});{const e=a.pop();return Object(w.b)("%(names)s and %(lastPerson)s are typing …",{names:a.join(", "),lastPerson:e})}}(e,this.props.whoIsTypingLimit);return t?o.a.createElement("li",{className:"mx_WhoIsTypingTile","aria-atomic":"true"},o.a.createElement("div",{className:"mx_WhoIsTypingTile_avatars"},this.renderTypingIndicatorAvatars(e,this.props.whoIsTypingLimit)),o.a.createElement("div",{className:"mx_WhoIsTypingTile_label"},t)):null}}i()(M,"defaultProps",{whoIsTypingLimit:3});var A=n(644),L=n(39),U=n(645),F=n(10);var B=({events:e,children:t,threshold:n=3,onToggle:a,startExpanded:i=!1,summaryMembers:s=[],summaryText:l,layout:c=E.a.Group,"data-testid":d})=>{const[u,h]=Object(U.a)(i);Object(r.useEffect)((()=>{a&&a()}),[u]);const p=e.map((e=>e.getId())).join(",");if(e.length<n)return o.a.createElement("li",{className:"mx_GenericEventListSummary","data-scroll-tokens":p,"data-expanded":!0,"data-layout":c},o.a.createElement("ol",{className:"mx_GenericEventListSummary_unstyledList"},t));let g;if(u)g=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_GenericEventListSummary_spacer"}," "),o.a.createElement("ol",{className:"mx_GenericEventListSummary_unstyledList"},t));else{const e=Object(L.uniqBy)(s.filter((e=>!(null==e||!e.getMxcAvatarUrl)||(m.a.error("EventListSummary given null summaryMember, termites may be afoot eating event senders",s),!1))),(e=>e.getMxcAvatarUrl())).map((e=>o.a.createElement(D.b,{key:e.userId,member:e,width:14,height:14})));g=o.a.createElement("div",{className:"mx_EventTile_line"},o.a.createElement("div",{className:"mx_EventTile_info"},o.a.createElement("span",{className:"mx_GenericEventListSummary_avatars",onClick:h},e),o.a.createElement("span",{className:"mx_TextualEvent mx_GenericEventListSummary_summary"},l)))}return o.a.createElement("li",{className:"mx_GenericEventListSummary","data-scroll-tokens":p,"data-expanded":u+"","data-layout":c,"data-testid":d},o.a.createElement(F.a,{kind:"link_inline",className:"mx_GenericEventListSummary_toggle",onClick:h,"aria-expanded":u},u?Object(w.b)("collapse"):Object(w.b)("expand")),g)},V=n(230),W=n(219),z=n(74),H=n(726),G=n(123);const K=()=>{G.a.instance.setCard({phase:z.a.PinnedMessages},!1)},q=[u.EventType.RoomMember];var $=function(e){return e.Joined="joined",e.Left="left",e.JoinedAndLeft="joined_and_left",e.LeftAndJoined="left_and_joined",e.InviteReject="invite_reject",e.InviteWithdrawal="invite_withdrawal",e.Invited="invited",e.Banned="banned",e.Unbanned="unbanned",e.Kicked="kicked",e.ChangedName="changed_name",e.ChangedAvatar="changed_avatar",e.NoChange="no_change",e.ServerAcl="server_acl",e.ChangedPins="pinned_messages",e.MessageRemoved="message_removed",e.HiddenEvent="hidden_event",e}($||{});class Y extends o.a.Component{constructor(...e){super(...e),i()(this,"context",void 0)}shouldComponentUpdate(e){return e.events.length!==this.props.events.length||e.events.length<this.props.threshold||e.layout!==this.props.layout}generateSummary(e,t){const n=t.map((t=>{const n=e[t],a=this.renderNameList(n),i=t.split(","),r=Y.getCanonicalTransitions(i),o=Y.coalesceRepeatedTransitions(r).map((e=>Y.getDescriptionForTransition(e.transitionType,n.length,e.repeats))),s=Object(V.b)(o);return Object(w.b)("%(nameList)s %(transitionList)s",{nameList:a,transitionList:s})}));return n?Object(H.a)(n,", "):null}renderNameList(e){return Object(V.b)(e,this.props.summaryLength)}static getCanonicalTransitions(e){const t={[$.Joined]:{after:$.Left,newTransition:$.JoinedAndLeft},[$.Left]:{after:$.Joined,newTransition:$.LeftAndJoined}},n=[];for(let a=0;a<e.length;a++){const i=e[a],r=e[a+1];let o=i;a<e.length-1&&t[i]&&t[i].after===r&&(o=t[i].newTransition,a++),n.push(o)}return n}static coalesceRepeatedTransitions(e){const t=[];for(const n of e)t.length>0&&t[t.length-1].transitionType===n?t[t.length-1].repeats+=1:t.push({transitionType:n,repeats:1});return t}static getDescriptionForTransition(e,t,n){var a;let i;switch(e){case $.Joined:i=t>1?Object(w.b)("%(severalUsers)sjoined %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)sjoined %(count)s times",{oneUser:"",count:n});break;case $.Left:i=t>1?Object(w.b)("%(severalUsers)sleft %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)sleft %(count)s times",{oneUser:"",count:n});break;case $.JoinedAndLeft:i=t>1?Object(w.b)("%(severalUsers)sjoined and left %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)sjoined and left %(count)s times",{oneUser:"",count:n});break;case $.LeftAndJoined:i=t>1?Object(w.b)("%(severalUsers)sleft and rejoined %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)sleft and rejoined %(count)s times",{oneUser:"",count:n});break;case $.InviteReject:i=t>1?Object(w.b)("%(severalUsers)srejected their invitations %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)srejected their invitation %(count)s times",{oneUser:"",count:n});break;case $.InviteWithdrawal:i=t>1?Object(w.b)("%(severalUsers)shad their invitations withdrawn %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)shad their invitation withdrawn %(count)s times",{oneUser:"",count:n});break;case $.Invited:i=t>1?Object(w.b)("were invited %(count)s times",{count:n}):Object(w.b)("was invited %(count)s times",{count:n});break;case $.Banned:i=t>1?Object(w.b)("were banned %(count)s times",{count:n}):Object(w.b)("was banned %(count)s times",{count:n});break;case $.Unbanned:i=t>1?Object(w.b)("were unbanned %(count)s times",{count:n}):Object(w.b)("was unbanned %(count)s times",{count:n});break;case $.Kicked:i=t>1?Object(w.b)("were removed %(count)s times",{count:n}):Object(w.b)("was removed %(count)s times",{count:n});break;case $.ChangedName:i=t>1?Object(w.b)("%(severalUsers)schanged their name %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)schanged their name %(count)s times",{oneUser:"",count:n});break;case $.ChangedAvatar:i=t>1?Object(w.b)("%(severalUsers)schanged their profile picture %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)schanged their profile picture %(count)s times",{oneUser:"",count:n});break;case $.NoChange:i=t>1?Object(w.b)("%(severalUsers)smade no changes %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)smade no changes %(count)s times",{oneUser:"",count:n});break;case $.ServerAcl:i=t>1?Object(w.b)("%(severalUsers)schanged the server ACLs %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)schanged the server ACLs %(count)s times",{oneUser:"",count:n});break;case $.ChangedPins:i=t>1?Object(w.b)("%(severalUsers)schanged the <a>pinned messages</a> for the room %(count)s times",{severalUsers:"",count:n},{a:e=>o.a.createElement(F.a,{kind:"link_inline",onClick:K},e)}):Object(w.b)("%(oneUser)schanged the <a>pinned messages</a> for the room %(count)s times",{oneUser:"",count:n},{a:e=>o.a.createElement(F.a,{kind:"link_inline",onClick:K},e)});break;case $.MessageRemoved:i=t>1?Object(w.b)("%(severalUsers)sremoved a message %(count)s times",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)sremoved a message %(count)s times",{oneUser:"",count:n});break;case $.HiddenEvent:i=t>1?Object(w.b)("%(severalUsers)ssent %(count)s hidden messages",{severalUsers:"",count:n}):Object(w.b)("%(oneUser)ssent %(count)s hidden messages",{oneUser:"",count:n})}return null!==(a=i)&&void 0!==a?a:null}static getTransitionSequence(e){return e.map(Y.getTransition)}static getTransition(e){if(e.mxEvent.isRedacted())return $.MessageRemoved;switch(e.mxEvent.getType()){case u.EventType.RoomThirdPartyInvite:return Object(W.c)(e.mxEvent)?$.Invited:$.InviteWithdrawal;case u.EventType.RoomServerAcl:return $.ServerAcl;case u.EventType.RoomPinnedEvents:return $.ChangedPins;case u.EventType.RoomMember:switch(e.mxEvent.getContent().membership){case"invite":return $.Invited;case"ban":return $.Banned;case"join":return"join"===e.mxEvent.getPrevContent().membership?e.mxEvent.getContent().displayname!==e.mxEvent.getPrevContent().displayname?$.ChangedName:e.mxEvent.getContent().avatar_url!==e.mxEvent.getPrevContent().avatar_url?$.ChangedAvatar:$.NoChange:$.Joined;case"leave":if(e.mxEvent.getSender()===e.mxEvent.getStateKey())return"invite"===e.mxEvent.getPrevContent().membership?$.InviteReject:$.Left;switch(e.mxEvent.getPrevContent().membership){case"invite":return $.InviteWithdrawal;case"ban":return $.Unbanned;default:return $.Kicked}default:return null}default:return $.HiddenEvent}}getAggregate(e){const t={},n={};return Object.keys(e).forEach((a=>{const i=e[a][0],r=i.displayName,o=Y.getTransitionSequence(e[a]).join(",");t[o]||(t[o]=[],n[o]=-1),t[o].push(r),(-1===n[o]||i.index<n[o])&&(n[o]=i.index)})),{names:t,indices:n}}render(){const e=this.props.events,t=new Map,n={};e.forEach(((e,a)=>{var i;const r=e.getType();let o=e.getSender();e.isState()&&r===u.EventType.RoomThirdPartyInvite?o=e.getContent().display_name:e.isState()&&r===u.EventType.RoomMember?o=e.getStateKey():e.isRedacted()&&null!==(i=e.getUnsigned())&&void 0!==i&&i.redacted_because&&(o=e.getUnsigned().redacted_because.sender),n[o]||(n[o]=[]);let s=o;if(e.isRedacted()){var l,c;const e=null===(l=this.context)||void 0===l||null===(c=l.room)||void 0===c?void 0:c.getMember(o);e&&(s=e.name,t.set(o,e))}else e.target&&q.includes(r)?(s=e.target.name,t.set(o,e.target)):e.sender&&r!==u.EventType.RoomThirdPartyInvite&&(s=e.sender.name,t.set(o,e.sender));n[o].push({mxEvent:e,displayName:s,index:a})}));const a=this.getAggregate(n),i=Object.keys(a.names).sort(((e,t)=>a.indices[e]-a.indices[t]));return o.a.createElement(B,{"data-testid":this.props["data-testid"],events:this.props.events,threshold:this.props.threshold,onToggle:this.props.onToggle,startExpanded:this.props.startExpanded,children:this.props.children,summaryMembers:[...t.values()],layout:this.props.layout,summaryText:this.generateSummary(a.names,i)})}}i()(Y,"contextType",y.b),i()(Y,"defaultProps",{summaryLength:1,threshold:3,avatarsMaxLength:5,layout:E.a.Group});var J=n(653),Q=n(640),X=n(38),Z=n(14),ee=n(1354),te=n(633),ne=n(615),ae=n(97),ie=n(69);const re=3e5,oe=[u.EventType.Sticker,u.EventType.RoomMessage],se=[u.EventType.RoomMember,u.EventType.RoomThirdPartyInvite,u.EventType.RoomServerAcl,u.EventType.RoomPinnedEvents];function le(e,t,n,a,i){return i!==y.a.ThreadsList&&(!(null==e||!e.sender||!t.sender)&&(!(t.getTs()-e.getTs()>re)&&(t.isRedacted()===e.isRedacted()&&(!!(t.getType()===e.getType()||oe.includes(t.getType())&&oe.includes(e.getType()))&&(t.sender.userId===e.sender.userId&&t.sender.name===e.sender.name&&t.sender.getMxcAvatarUrl()===e.sender.getMxcAvatarUrl()&&((!Object(ae.i)(t)&&!Object(ae.i)(e)||i===y.a.Thread)&&!!Object(te.c)(e,n,a)))))))}class ce extends o.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"readReceiptMap",{}),i()(this,"readReceiptsByEvent",new Map),i()(this,"readReceiptsByUserId",new Map),i()(this,"_showHiddenEvents",void 0),i()(this,"isMounted",!1),i()(this,"readMarkerNode",Object(r.createRef)()),i()(this,"whoIsTyping",Object(r.createRef)()),i()(this,"scrollPanel",Object(r.createRef)()),i()(this,"showTypingNotificationsWatcherRef",void 0),i()(this,"eventTiles",{}),i()(this,"grouperKeyMap",new WeakMap),i()(this,"calculateRoomMembersCount",(()=>{this.setState({hideSender:this.shouldHideSender()})})),i()(this,"onShowTypingNotificationsChange",(()=>{this.setState({showTypingNotifications:f.b.getValue("showTypingNotifications")})})),i()(this,"isUnmounting",(()=>!this.isMounted)),i()(this,"collectGhostReadMarker",(e=>{e&&requestAnimationFrame((()=>{e.style.width="10%",e.style.opacity="0"}))})),i()(this,"onGhostTransitionEnd",(e=>{const t=e.target.dataset.eventid;this.setState({ghostReadMarkers:this.state.ghostReadMarkers.filter((e=>e!==t))})})),i()(this,"collectEventTile",((e,t)=>{this.eventTiles[e]=t})),i()(this,"onHeightChanged",(()=>{const e=this.scrollPanel.current;e&&e.checkScroll()})),i()(this,"onTypingShown",(()=>{const e=this.scrollPanel.current;null==e||e.checkScroll(),e&&e.getScrollState().stuckAtBottom&&e.preventShrinking()})),i()(this,"onTypingHidden",(()=>{const e=this.scrollPanel.current;e&&(e.updatePreventShrinking(),e.checkScroll())})),this.state={ghostReadMarkers:[],showTypingNotifications:f.b.getValue("showTypingNotifications"),hideSender:this.shouldHideSender()},this._showHiddenEvents=f.b.getValue("showHiddenEventsInTimeline"),this.showTypingNotificationsWatcherRef=f.b.watchSetting("showTypingNotifications",null,this.onShowTypingNotificationsChange)}componentDidMount(){var e;this.calculateRoomMembersCount(),null===(e=this.props.room)||void 0===e||e.currentState.on(u.RoomStateEvent.Update,this.calculateRoomMembersCount),this.isMounted=!0}componentWillUnmount(){var e;this.isMounted=!1,null===(e=this.props.room)||void 0===e||e.currentState.off(u.RoomStateEvent.Update,this.calculateRoomMembersCount),f.b.unwatchSetting(this.showTypingNotificationsWatcherRef),this.readReceiptMap={}}componentDidUpdate(e,t){if(e.layout!==this.props.layout&&this.calculateRoomMembersCount(),e.readMarkerVisible&&e.readMarkerEventId&&this.props.readMarkerEventId!==e.readMarkerEventId){const t=this.state.ghostReadMarkers;t.push(e.readMarkerEventId),this.setState({ghostReadMarkers:t})}const n=this.pendingEditItem;if(!this.props.editState&&this.props.room&&n){const e=this.props.room.findEventById(n);T.a.dispatch({action:Z.a.EditEvent,event:null!=e&&e.isRedacted()?null:e,timelineRenderingType:this.context.timelineRenderingType})}}shouldHideSender(){return!!this.props.room&&this.props.room.getInvitedAndJoinedMemberCount()<=2&&this.props.layout===E.a.Bubble}getNodeForEventId(e){var t,n,a;if(this.eventTiles)return null!==(t=null===(n=this.eventTiles[e])||void 0===n||null===(a=n.ref)||void 0===a?void 0:a.current)&&void 0!==t?t:void 0}getTileForEventId(e){if(this.eventTiles&&e)return this.eventTiles[e]}isAtBottom(){var e;return null===(e=this.scrollPanel.current)||void 0===e?void 0:e.isAtBottom()}getScrollState(){var e,t;return null!==(e=null===(t=this.scrollPanel.current)||void 0===t?void 0:t.getScrollState())&&void 0!==e?e:null}getReadMarkerPosition(){const e=this.readMarkerNode.current,t=this.scrollPanel.current;if(!e||!t)return null;const n=l.a.findDOMNode(t).getBoundingClientRect(),a=e.getBoundingClientRect();return a.bottom+2<n.top?-1:a.top<n.bottom?0:1}scrollToTop(){var e;null===(e=this.scrollPanel.current)||void 0===e||e.scrollToTop()}scrollToBottom(){var e;null===(e=this.scrollPanel.current)||void 0===e||e.scrollToBottom()}handleScrollKey(e){var t;null===(t=this.scrollPanel.current)||void 0===t||t.handleScrollKey(e)}scrollToEvent(e,t,n){var a;null===(a=this.scrollPanel.current)||void 0===a||a.scrollToToken(e,t,n)}scrollToEventIfNeeded(e){const t=this.getNodeForEventId(e);t&&t.scrollIntoView({block:"nearest",behavior:"instant"})}get showHiddenEvents(){var e,t;return null!==(e=null===(t=this.context)||void 0===t?void 0:t.showHiddenEvents)&&void 0!==e?e:this._showHiddenEvents}shouldShowEvent(e,t=!1){if(this.props.hideThreadedMessages&&this.props.room){const{shouldLiveInRoom:t}=this.props.room.eventShouldLiveIn(e,this.props.events);if(!t)return!1}return!v.a.safeGet().isUserIgnored(e.getSender())&&(!(!this.showHiddenEvents||t)||!!Object(te.c)(e,v.a.safeGet(),this.showHiddenEvents)&&(this.props.highlightedEventId===e.getId()||!Object(g.a)(e,this.context)))}readMarkerForEvent(e,t){const n=!t&&this.props.readMarkerVisible;if(this.props.readMarkerEventId===e){let t;return n&&(t=o.a.createElement("hr",{style:{opacity:1,width:"99%"}})),o.a.createElement("li",{key:"readMarker_"+e,ref:this.readMarkerNode,className:"mx_MessagePanel_myReadMarker","data-scroll-tokens":e},t)}if(this.state.ghostReadMarkers.includes(e)){const t=o.a.createElement("hr",{ref:this.collectGhostReadMarker,onTransitionEnd:this.onGhostTransitionEnd,"data-eventid":e});return o.a.createElement("li",{key:"_readuptoghost_"+e,className:"mx_MessagePanel_myReadMarker"},t)}return null}getNextEventInfo(e,t){const n=t<e.length-1?e[t+1]:null,a=function(e,t){for(let n=e+1;n<t.length;n++){const{event:e,shouldShow:a}=t[n];if(a)return e}return null}(t,e);return{nextEventAndShouldShow:n,nextTile:a}}get pendingEditItem(){if(!this.props.room)return null;try{return localStorage.getItem(Object(ne.a)(this.props.room.roomId,this.context.timelineRenderingType))}catch(e){return m.a.error(e),null}}isSentState(e){const t=e.getAssociatedStatus();return!t||t===u.EventStatus.SENT}getEventTiles(){let e;const t=this.props.events.map((e=>({event:e,shouldShow:this.shouldShowEvent(e)}))),n=v.a.safeGet().getSafeUserId();let a=!1,i=-1;for(let r=t.length-1;r>=0;r--){const{event:o,shouldShow:s}=t[r];if(s&&(void 0===e&&(e=o),!a&&this.isSentState(o)&&Object(S.c)(o)&&(a=!0,o.getSender()===n&&(t[r].lastSuccessfulWeSent=!0)),i<0&&!o.status&&(i=r),i>=0&&a))break}const r=[];let o=null;this.readReceiptsByEvent=new Map,this.props.showReadReceipts&&(this.readReceiptsByEvent=this.getReadReceiptsByShownEvent(t));let s=null;for(let n=0;n<t.length;n++){const a=t[n],{event:l,shouldShow:c}=a,d=l.getId(),u=l===e,{nextEventAndShouldShow:m,nextTile:h}=this.getNextEventInfo(t,n);if(s){if(s.shouldGroup(a)){s.add(a);continue}r.push(...s.getTiles()),o=s.getNewPrevEvent(),s=null}for(const t of he)if(t.canStartGroup(this,a)&&!this.props.disableGrouping){s=new t(this,a,o,e,m,h);break}if(!s){c&&(r.push(...this.getTilesForEvent(o,a,u,!1,m,h)),o=l);const e=this.readMarkerForEvent(d,n>=i);e&&r.push(e)}}return s&&r.push(...s.getTiles()),r}getTilesForEvent(e,t,n=!1,a=!1,i=null,r=null){var s,l;const c=t.event,d=[],u=(null===(s=this.props.editState)||void 0===s?void 0:s.getEvent().getId())===c.getId();let m=c.getTs(),h=c.getDate();c.status&&(h=new Date,m=h.getTime());const p=this.wantsDateSeparator(e,h);if(p&&!a&&this.props.room){const e=o.a.createElement("li",{key:m},o.a.createElement(J.a,{key:m,roomId:this.props.room.roomId,ts:m}));d.push(e)}const g=v.a.safeGet();let b=!0;if(r){const e=r;b=this.wantsDateSeparator(c,e.getDate()||new Date)||c.getSender()!==e.getSender()||Object(ee.a)(g,e,this.showHiddenEvents).isInfoMessage||!le(c,e,g,this.showHiddenEvents,this.context.timelineRenderingType)}const f=!p&&le(e,c,g,this.showHiddenEvents,this.context.timelineRenderingType),y=c.getId(),E=y===this.props.highlightedEventId,w=this.readReceiptsByEvent.get(y),_=this.props.callEventGroupers.get(c.getContent().call_id);return d.push(o.a.createElement(S.b,{key:c.getTxnId()||y,as:"li",ref:this.collectEventTile.bind(this,y),alwaysShowTimestamps:this.props.alwaysShowTimestamps,mxEvent:c,continuation:f,isRedacted:c.isRedacted(),replacingEventId:c.replacingEventId(),editState:u?this.props.editState:void 0,onHeightChanged:this.onHeightChanged,readReceipts:w,readReceiptMap:this.readReceiptMap,showUrlPreview:this.props.showUrlPreview,checkUnmounting:this.isUnmounting,eventSendStatus:null!==(l=c.getAssociatedStatus())&&void 0!==l?l:void 0,isTwelveHour:this.props.isTwelveHour,permalinkCreator:this.props.permalinkCreator,last:n,lastInSection:b,lastSuccessful:t.lastSuccessfulWeSent,isSelectedEvent:E,getRelationsForEvent:this.props.getRelationsForEvent,showReactions:this.props.showReactions,layout:this.props.layout,showReadReceipts:this.props.showReadReceipts,callEventGrouper:_,hideSender:this.state.hideSender})),d}wantsDateSeparator(e,t){return this.context.timelineRenderingType!==y.a.ThreadsList&&(null==e?!this.props.canBackPaginate:Object(b.p)(e.getDate()||void 0,t))}getReadReceiptsForEvent(e){const t=v.a.safeGet().credentials.userId,{room:n}=this.props;if(!n)return null;const a=this.context.threadId?n.getThread(this.context.threadId):n,i=[];return a?(a.getReceiptsForEvent(e).forEach((e=>{if(!e.userId||!Object(p.w)(e.type)||e.userId===t)return;if(v.a.safeGet().isUserIgnored(e.userId))return;const a=n.getMember(e.userId);i.push({userId:e.userId,roomMember:a,ts:e.data?e.data.ts:0})})),i):(m.a.debug("Discarding request, could not find the receiptDestination for event: "+this.context.threadId),i)}getReadReceiptsByShownEvent(e){const t=new Map,n=new Map;let a;for(const e of this.props.events){if(this.shouldShowEvent(e)&&(a=e.getId()),!a)continue;const i=t.get(a)||[],r=this.getReadReceiptsForEvent(e);if(r){t.set(a,i.concat(r));for(const e of r)n.set(e.userId,{lastShownEventId:a,receipt:e})}}for(const e of this.readReceiptsByUserId.keys()){if(n.get(e))continue;const{lastShownEventId:a,receipt:i}=this.readReceiptsByUserId.get(e),r=t.get(a)||[];t.set(a,r.concat(i)),n.set(e,{lastShownEventId:a,receipt:i})}this.readReceiptsByUserId=n;for(const e of t.values())e.sort(((e,t)=>t.ts-e.ts));return t}updateTimelineMinHeight(){const e=this.scrollPanel.current;if(e){const t=e.isAtBottom(),n=this.whoIsTyping.current,a=n&&n.isVisible();t&&a&&e.preventShrinking()}}onTimelineReset(){const e=this.scrollPanel.current;e&&e.clearPreventShrinking()}render(){let e,t;this.props.backPaginating&&(e=o.a.createElement("li",{key:"_topSpinner"},o.a.createElement(X.a,null))),this.props.forwardPaginating&&(t=o.a.createElement("li",{key:"_bottomSpinner"},o.a.createElement(X.a,null)));const n=this.props.hidden?{display:"none"}:{};let a,i;var r,s;(this.props.room&&this.state.showTypingNotifications&&this.context.timelineRenderingType===y.a.Room&&(a=o.a.createElement(M,{room:this.props.room,onShown:this.onTypingShown,onHidden:this.onTypingHidden,ref:this.whoIsTyping})),this.props.layout==E.a.IRC)&&(i=o.a.createElement(x,{minWidth:20,maxWidth:600,roomId:null!==(r=null===(s=this.props.room)||void 0===s?void 0:s.roomId)&&void 0!==r?r:null}));const l=d()(this.props.className,{mx_MessagePanel_narrow:this.context.narrow});return o.a.createElement(Q.a,null,o.a.createElement(A.a,{ref:this.scrollPanel,className:l,onScroll:this.props.onScroll,onFillRequest:this.props.onFillRequest,onUnfillRequest:this.props.onUnfillRequest,style:n,stickyBottom:this.props.stickyBottom,resizeNotifier:this.props.resizeNotifier,fixedChildren:i},e,this.getEventTiles(),a,t))}}i()(ce,"contextType",y.b),i()(ce,"defaultProps",{disableGrouping:!1});class de{constructor(e,t,n,a,r,o){this.panel=e,this.firstEventAndShouldShow=t,this.prevEvent=n,this.lastShownEvent=a,this.nextEvent=r,this.nextEventTile=o,i()(this,"events",[]),i()(this,"ejectedEvents",[]),i()(this,"readMarker",void 0),this.readMarker=e.readMarkerForEvent(t.event.getId(),t.event===a)}}i()(de,"canStartGroup",((e,t)=>!0));class ue extends de{shouldGroup({event:e,shouldShow:t}){const n=this.panel,a=this.firstEventAndShouldShow.event;if(!t)return!0;if(n.wantsDateSeparator(this.firstEventAndShouldShow.event,e.getDate()))return!1;const i=e.getType();return(i!==u.EventType.RoomMember||e.getStateKey()===a.getSender()&&"join"===e.getContent().membership)&&(!h.b.matches(i)&&(ie.g!==i&&!(!e.isState()||e.getSender()!==a.getSender())))}add(e){const{event:t,shouldShow:n}=e,a=this.panel;this.readMarker=this.readMarker||a.readMarkerForEvent(t.getId(),t===this.lastShownEvent),n&&(t.getType()===u.EventType.RoomEncryption?this.ejectedEvents.push(e):this.events.push(e))}getTiles(){var e,t;if(!this.events||!this.events.length)return[];const n=this.panel,a=[],i=this.firstEventAndShouldShow,r=this.lastShownEvent;if(n.wantsDateSeparator(this.prevEvent,i.event.getDate())){const e=i.event.getTs();a.push(o.a.createElement("li",{key:e+"~"},o.a.createElement(J.a,{roomId:i.event.getRoomId(),ts:e})))}i.shouldShow&&a.push(...n.getTilesForEvent(i.event,i));for(const e of this.ejectedEvents)a.push(...n.getTilesForEvent(i.event,e,i.event===r,true));const s=this.events.map((e=>n.getTilesForEvent(e.event,e,e.event===r,true))).reduce(((e,t)=>e.concat(t)),[]),l=this.events[this.events.length-1].event;let c;const d=l.getRoomId(),u=null!==(e=null===(t=l.sender)||void 0===t?void 0:t.name)&&void 0!==e?e:l.getSender();return c=d&&k.a.shared().getUserIdForRoomId(d)?Object(w.b)("%(creator)s created this DM.",{creator:u}):Object(w.b)("%(creator)s created and configured the room.",{creator:u}),a.push(o.a.createElement(R.a,{key:"newroomintro"})),a.push(o.a.createElement(B,{key:"roomcreationsummary",events:this.events.map((e=>e.event)),onToggle:n.onHeightChanged,summaryMembers:l.sender?[l.sender]:void 0,summaryText:c,layout:this.panel.props.layout},s)),this.readMarker&&a.push(this.readMarker),a}getNewPrevEvent(){return this.firstEventAndShouldShow.event}}i()(ue,"canStartGroup",(function(e,{event:t}){return t.getType()===u.EventType.RoomCreate}));class me extends de{constructor(e,t,n,a,i,r){super(e,t,n,a,i,r),this.panel=e,this.firstEventAndShouldShow=t,this.prevEvent=n,this.lastShownEvent=a,this.events=[t]}shouldGroup({event:e,shouldShow:t}){return!t||!this.panel.wantsDateSeparator(this.events[0].event,e.getDate())&&(!(!e.isState()||!se.includes(e.getType()))||(!!e.isRedacted()||!(!this.panel.showHiddenEvents||this.panel.shouldShowEvent(e,!0))))}add(e){const{event:t,shouldShow:n}=e;(t.getType()!==u.EventType.RoomMember||Object(_.a)(t,v.a.safeGet(),this.panel.showHiddenEvents))&&(this.readMarker=this.readMarker||this.panel.readMarkerForEvent(t.getId(),t===this.lastShownEvent),(this.panel.showHiddenEvents||n)&&this.events.push(e))}generateKey(){return"eventlistsummary-"+this.events[0].event.getId()}getTiles(){var e;if(null===(e=this.events)||void 0===e||!e.length)return[];const t=this.panel,n=this.lastShownEvent,a=[];if(t.wantsDateSeparator(this.prevEvent,this.events[0].event.getDate())){const e=this.events[0].event.getTs();a.push(o.a.createElement("li",{key:e+"~"},o.a.createElement(J.a,{roomId:this.events[0].event.getRoomId(),ts:e})))}const i=this.events.find((e=>this.panel.grouperKeyMap.get(e.event))),r=i&&this.panel.grouperKeyMap.has(i.event)?this.panel.grouperKeyMap.get(i.event):this.generateKey();i||this.panel.grouperKeyMap.set(this.events[0].event,r);let s=!1,l=this.events.map(((e,a)=>(e.event.getId()===t.props.highlightedEventId&&(s=!0),t.getTilesForEvent(0===a?this.prevEvent:this.events[a-1].event,e,e.event===n,true,this.nextEvent,this.nextEventTile)))).reduce(((e,t)=>e.concat(t)),[]);return 0===l.length&&(l=null),this.panel.props.canBackPaginate||this.prevEvent||a.push(o.a.createElement(I,{key:"historytile"})),a.push(o.a.createElement(Y,{key:r,"data-testid":r,events:this.events.map((e=>e.event)),onToggle:t.onHeightChanged,startExpanded:s,layout:this.panel.props.layout},l)),this.readMarker&&a.push(this.readMarker),a}getNewPrevEvent(){return this.events[this.events.length-1].event}}i()(me,"canStartGroup",(function(e,{event:t,shouldShow:n}){return!!n&&(!(!t.isState()||!se.includes(t.getType()))||(!!t.isRedacted()||!(!e.showHiddenEvents||e.shouldShowEvent(t,!0))))}));const he=[ue,me]},1375:function(e,t,n){"use strict";n.d(t,"a",(function(){return P})),n.d(t,"b",(function(){return N}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3),l=n(4),c=n(421),d=n(1426),u=n(11),m=n(2),h=n(25),p=n(1400),g=n(229),b=n(1332),v=n(1317),f=n(46),y=n(34),E=n(60);var w=({onFinished:e})=>{const[t,n]=Object(r.useState)(""),a=Object(r.useRef)(null),i=async n=>{if(n.preventDefault(),a.current){if(t){if(!await a.current.validate({}))return a.current.focus(),void a.current.validate({focused:!0})}e(!0,t)}};return r.createElement(y.a,{title:Object(m.b)("Continuing without email"),className:"mx_RegistrationEmailPromptDialog",contentId:"mx_RegistrationEmailPromptDialog",onFinished:()=>e(!1),fixedWidth:!1},r.createElement("div",{className:"mx_Dialog_content",id:"mx_RegistrationEmailPromptDialog"},r.createElement("p",null,Object(m.b)("Just a heads up, if you don't add an email and forget your password, you could <b>permanently lose access to your account</b>.",{},{b:e=>r.createElement("b",null,e)})),r.createElement("form",{onSubmit:i},r.createElement(b.a,{fieldRef:a,autoFocus:!0,label:Object(m.d)("Email (optional)"),value:t,onChange:e=>{const t=e.target;n(t.value)}}))),r.createElement(E.a,{primaryButton:Object(m.b)("Continue"),onPrimaryButtonClick:i,hasCancel:!1}))},S=n(1366),_=n(1367),C=n(107);let O,x,k,R,j;var I=function(e){return e.Email="field_email",e.PhoneNumber="field_phone_number",e.Username="field_username",e.Password="field_password",e.PasswordConfirm="field_password_confirm",e}(I||{}),T=function(e){return e[e.Unknown=0]="Unknown",e[e.Available=1]="Available",e[e.Unavailable=2]="Unavailable",e[e.Error=3]="Error",e[e.Invalid=4]="Invalid",e}(T||{});const P=3;O=I.Email,x=I.Password,k=I.PasswordConfirm,R=I.Username,j=I.PhoneNumber;class N extends o.a.PureComponent{constructor(e){super(e),i()(this,O,null),i()(this,x,null),i()(this,k,null),i()(this,R,null),i()(this,j,null),i()(this,"onSubmit",(async e=>{if(e.preventDefault(),e.persist(),!this.props.canSubmit)return;if(await this.verifyFieldsBeforeSubmit())if(""===this.state.email){if(!this.showEmail())return void this.doSubmit(e);u.b.createDialog(w,{onFinished:async(t,n)=>{t&&void 0!==n&&this.setState({email:n},(()=>{this.doSubmit(e)}))}})}else this.doSubmit(e)})),i()(this,"onEmailChange",(e=>{this.setState({email:e.target.value.trim()})})),i()(this,"onEmailValidate",(e=>{this.markFieldValid(I.Email,!!e.valid)})),i()(this,"validateEmailRules",Object(g.a)({description:()=>Object(m.b)("Use an email address to recover your account"),hideDescriptionIfValid:!0,rules:[{key:"required",test({value:e,allowEmpty:t}){return t||!this.authStepIsRequired("m.login.email.identity")||!!e},invalid:()=>Object(m.b)("Enter email address (required on this homeserver)")},{key:"email",test:({value:e})=>!e||c.a(e),invalid:()=>Object(m.b)("Doesn't look like a valid email address")}]})),i()(this,"onPasswordChange",(e=>{this.setState({password:e.target.value})})),i()(this,"onPasswordValidate",(e=>{this.markFieldValid(I.Password,!!e.valid)})),i()(this,"onPasswordConfirmChange",(e=>{this.setState({passwordConfirm:e.target.value})})),i()(this,"onPasswordConfirmValidate",(e=>{this.markFieldValid(I.PasswordConfirm,!!e.valid)})),i()(this,"onPhoneCountryChange",(e=>{this.setState({phoneCountry:e.iso2})})),i()(this,"onPhoneNumberChange",(e=>{this.setState({phoneNumber:e.target.value})})),i()(this,"onPhoneNumberValidate",(async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(I.PhoneNumber,!!t.valid),t})),i()(this,"validatePhoneNumberRules",Object(g.a)({description:()=>Object(m.b)("Other users can invite you to rooms using your contact details"),hideDescriptionIfValid:!0,rules:[{key:"required",test({value:e,allowEmpty:t}){return t||!this.authStepIsRequired("m.login.msisdn")||!!e},invalid:()=>Object(m.b)("Enter phone number (required on this homeserver)")},{key:"email",test:({value:e})=>!e||Object(d.c)(e),invalid:()=>Object(m.b)("That phone number doesn't look quite right, please check and try again")}]})),i()(this,"onUsernameChange",(e=>{this.setState({username:e.target.value})})),i()(this,"onUsernameValidate",(async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(I.Username,!!t.valid),t})),i()(this,"validateUsernameRules",Object(g.a)({description:(e,t)=>t.every((({key:e,valid:t})=>"available"===e||t))?null:Object(m.b)("Use lowercase letters, numbers, dashes and underscores only"),hideDescriptionIfValid:!0,async deriveData({value:e}){if(!e)return T.Unknown;try{return await this.props.matrixClient.isUsernameAvailable(e)?T.Available:T.Unavailable}catch(e){return e instanceof l.MatrixError&&"M_INVALID_USERNAME"===e.errcode?T.Invalid:T.Error}},rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(m.b)("Enter username")},{key:"safeLocalpart",test:({value:e},t)=>(!e||p.a.test(e))&&t!==T.Invalid,invalid:()=>Object(m.b)("Some characters not allowed")},{key:"available",final:!0,test:async({value:e},t)=>!e||t===T.Available,invalid:e=>e===T.Error?Object(m.b)("Unable to check if username has been taken. Try again later."):Object(m.b)("Someone already has that username. Try another or if it is you, sign in below.")}]})),this.state={fieldValid:{},phoneCountry:this.props.defaultPhoneCountry,username:this.props.defaultUsername||"",email:this.props.defaultEmail||"",phoneNumber:this.props.defaultPhoneNumber||"",password:this.props.defaultPassword||"",passwordConfirm:this.props.defaultPassword||""}}doSubmit(e){C.a.instance.setAuthenticationType("Password");const t=this.state.email.trim(),n=this.props.onRegisterClick({username:this.state.username.trim(),password:this.state.password.trim(),email:t,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber});n&&(e.target.disabled=!0,n.finally((function(){e.target.disabled=!1})))}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[I.Username,I.Password,I.PasswordConfirm,I.Email,I.PhoneNumber];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise((e=>this.setState({},e))),this.allFieldsValid())return!0;const n=this.findFirstInvalidField(t);return!n||(n.focus(),n.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){return Object.values(this.state.fieldValid).every(Boolean)}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:n}=this.state;n[e]=t,this.setState({fieldValid:n})}authStepIsRequired(e){return this.props.flows.every((t=>t.stages.includes(e)))}authStepIsUsed(e){return this.props.flows.some((t=>t.stages.includes(e)))}showEmail(){return!(h.b.get().disable_3pid_login||!this.authStepIsUsed("m.login.email.identity"))}showPhoneNumber(){return!(h.b.get().disable_3pid_login||!this.authStepIsUsed("m.login.msisdn"))}renderEmail(){if(!this.showEmail())return null;const e=this.authStepIsRequired("m.login.email.identity")?Object(m.d)("Email"):Object(m.d)("Email (optional)");return o.a.createElement(b.a,{fieldRef:e=>this[I.Email]=e,label:e,value:this.state.email,validationRules:this.validateEmailRules.bind(this),onChange:this.onEmailChange,onValidate:this.onEmailValidate})}renderPassword(){return o.a.createElement(v.a,{id:"mx_RegistrationForm_password",fieldRef:e=>this[I.Password]=e,minScore:P,value:this.state.password,onChange:this.onPasswordChange,onValidate:this.onPasswordValidate,userInputs:[this.state.username]})}renderPasswordConfirm(){return o.a.createElement(_.a,{id:"mx_RegistrationForm_passwordConfirm",fieldRef:e=>this[I.PasswordConfirm]=e,autoComplete:"new-password",value:this.state.passwordConfirm,password:this.state.password,onChange:this.onPasswordConfirmChange,onValidate:this.onPasswordConfirmValidate})}renderPhoneNumber(){if(!this.showPhoneNumber())return null;const e=this.authStepIsRequired("m.login.msisdn")?Object(m.b)("Phone"):Object(m.b)("Phone (optional)"),t=o.a.createElement(S.a,{value:this.state.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChange});return o.a.createElement(f.a,{ref:e=>this[I.PhoneNumber]=e,type:"text",label:e,value:this.state.phoneNumber,prefixComponent:t,onChange:this.onPhoneNumberChange,onValidate:this.onPhoneNumberValidate})}renderUsername(){return o.a.createElement(f.a,{id:"mx_RegistrationForm_username",ref:e=>this[I.Username]=e,type:"text",autoFocus:!0,label:Object(m.b)("Username"),placeholder:Object(m.b)("Username").toLocaleLowerCase(),value:this.state.username,onChange:this.onUsernameChange,onValidate:this.onUsernameValidate})}render(){const e=o.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(m.b)("Register"),disabled:!this.props.canSubmit});let t;return this.showEmail()&&(t=this.showPhoneNumber()?o.a.createElement("div",null,Object(m.b)("Add an email to be able to reset your password.")," ",Object(m.b)("Use email or phone to optionally be discoverable by existing contacts.")):o.a.createElement("div",null,Object(m.b)("Add an email to be able to reset your password.")," ",Object(m.b)("Use email to optionally be discoverable by existing contacts."))),o.a.createElement("div",null,o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderUsername()),o.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderPassword(),this.renderPasswordConfirm()),o.a.createElement("div",{className:"mx_AuthBody_fieldRow"},this.renderEmail(),this.renderPhoneNumber()),t,e))}}i()(N,"defaultProps",{onValidationChange:s.a.error,canSubmit:!0})},1388:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3),l=n(2),c=n(7),d=n(11),u=n(1350),m=n(1351),h=n(669),p=n(10),g=n(38);class b extends o.a.Component{constructor(e){super(e),i()(this,"onStoreUpdate",(()=>{const e=m.b.sharedInstance();e.phase!==m.a.Finished?this.setState({phase:e.phase,verificationRequest:e.verificationRequest,backupInfo:e.backupInfo,lostKeys:e.lostKeys()}):this.props.onFinished()})),i()(this,"onUsePassphraseClick",(async()=>{m.b.sharedInstance().usePassPhrase()})),i()(this,"onVerifyClick",(()=>{var e;const t=c.a.safeGet(),n=t.getSafeUserId(),a=t.getCrypto().requestOwnUserVerification();this.props.onFinished(),d.b.createDialog(u.a,{verificationRequestPromise:a,member:null!==(e=t.getUser(n))&&void 0!==e?e:void 0,onFinished:async()=>{(await a).cancel(),this.props.onFinished()}})})),i()(this,"onSkipConfirmClick",(()=>{m.b.sharedInstance().skipConfirm()})),i()(this,"onSkipBackClick",(()=>{m.b.sharedInstance().returnAfterSkip()})),i()(this,"onResetClick",(e=>{e.preventDefault();m.b.sharedInstance().reset()})),i()(this,"onResetConfirmClick",(()=>{this.props.onFinished();m.b.sharedInstance().resetConfirm()})),i()(this,"onResetBackClick",(()=>{m.b.sharedInstance().returnAfterReset()})),i()(this,"onDoneClick",(()=>{m.b.sharedInstance().done()})),i()(this,"onEncryptionPanelClose",(()=>{this.props.onFinished()}));const t=m.b.sharedInstance();t.on("update",this.onStoreUpdate),t.start(),this.state={phase:t.phase,verificationRequest:t.verificationRequest,backupInfo:t.backupInfo,lostKeys:t.lostKeys()}}componentWillUnmount(){const e=m.b.sharedInstance();e.off("update",this.onStoreUpdate),e.stop()}render(){const e=c.a.safeGet(),{phase:t,lostKeys:n}=this.state;if(this.state.verificationRequest&&e.getUser(this.state.verificationRequest.otherUserId))return o.a.createElement(h.a,{layout:"dialog",verificationRequest:this.state.verificationRequest,onClose:this.onEncryptionPanelClose,member:e.getUser(this.state.verificationRequest.otherUserId),isRoomEncrypted:!1});if(t===m.a.Intro){if(n)return o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("It looks like you don't have a Security Key or any other devices you can verify against.  This device will not be able to access old encrypted messages. In order to verify your identity on this device, you'll need to reset your verification keys.")),o.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},o.a.createElement(p.a,{kind:"primary",onClick:this.onResetConfirmClick},Object(l.b)("Proceed with reset"))));{const e=m.b.sharedInstance();let t,n,i;return e.keyInfo&&(a=e.keyInfo,Boolean(a.passphrase&&a.passphrase.salt&&a.passphrase.iterations))?t=Object(l.b)("Verify with Security Key or Phrase"):e.keyInfo&&(t=Object(l.b)("Verify with Security Key")),t&&(n=o.a.createElement(p.a,{kind:"primary",onClick:this.onUsePassphraseClick},t)),e.hasDevicesToVerifyAgainst&&(i=o.a.createElement(p.a,{kind:"primary",onClick:this.onVerifyClick},Object(l.b)("Verify with another device"))),o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("Verify your identity to access encrypted messages and prove your identity to others.")),o.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},i,n),o.a.createElement("div",{className:"mx_SetupEncryptionBody_reset"},Object(l.b)("Forgotten or lost all recovery methods? <a>Reset all</a>",void 0,{a:e=>o.a.createElement(p.a,{kind:"link_inline",className:"mx_SetupEncryptionBody_reset_link",onClick:this.onResetClick},e)})))}}if(t===m.a.Done){let e;return e=this.state.backupInfo?o.a.createElement("p",null,Object(l.b)("Your new device is now verified. It has access to your encrypted messages, and other users will see it as trusted.")):o.a.createElement("p",null,Object(l.b)("Your new device is now verified. Other users will see it as trusted.")),o.a.createElement("div",null,o.a.createElement("div",{className:"mx_CompleteSecurity_heroIcon mx_E2EIcon_verified"}),e,o.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},o.a.createElement(p.a,{kind:"primary",onClick:this.onDoneClick},Object(l.b)("Done"))))}return t===m.a.ConfirmSkip?o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("Without verifying, you won't have access to all your messages and may appear as untrusted to others.")),o.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},o.a.createElement(p.a,{kind:"danger_outline",onClick:this.onSkipConfirmClick},Object(l.b)("I'll verify later")),o.a.createElement(p.a,{kind:"primary",onClick:this.onSkipBackClick},Object(l.b)("Go Back")))):t===m.a.ConfirmReset?o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("Resetting your verification keys cannot be undone. After resetting, you won't have access to old encrypted messages, and any friends who have previously verified you will see security warnings until you re-verify with them.")),o.a.createElement("p",null,Object(l.b)("Please only proceed if you're sure you've lost all of your other devices and your Security Key.")),o.a.createElement("div",{className:"mx_CompleteSecurity_actionRow"},o.a.createElement(p.a,{kind:"danger_outline",onClick:this.onResetConfirmClick},Object(l.b)("Proceed with reset")),o.a.createElement(p.a,{kind:"primary",onClick:this.onResetBackClick},Object(l.b)("Go Back")))):t===m.a.Busy||t===m.a.Loading?o.a.createElement(g.a,null):void s.a.log(`SetupEncryptionBody: Unknown phase ${t}`);var a}}},1389:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));const a=async(e,t)=>{var n;const a=await(null===(n=e.getCrypto())||void 0===n?void 0:n.getDeviceVerificationStatus(e.getSafeUserId(),t));return a?a.crossSigningVerified:null}},1390:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(0),i=n.n(a),r=n(1391),o=n(1353),s=n(71),l=n(2);const c=(e,t=(new Date).getTime())=>{if(e+5184e5>=t){const t=new Date(e);return Object(s.a)(t)}return Object(s.l)(new Date(e))},d=({value:e,id:t})=>e?i.a.createElement("span",{"data-testid":`device-metadata-${t}`},e):null,u=({device:e})=>{const t=(e=>{if(Object(o.c)(e)&&e.last_seen_ts)return{id:"inactive",value:i.a.createElement(i.a.Fragment,null,i.a.createElement(r.a,{className:"mx_DeviceTile_inactiveIcon"}),Object(l.b)("Inactive for %(inactiveAgeDays)s+ days",{inactiveAgeDays:o.a})+` (${c(e.last_seen_ts)})`)}})(e),n=e.last_seen_ts&&`${Object(l.b)("Last activity")} ${c(e.last_seen_ts)}`,s=e.isVerified?Object(l.b)("Verified"):Object(l.b)("Unverified"),u=t?[t,{id:"lastSeenIp",value:e.last_seen_ip}]:[{id:"isVerified",value:s},{id:"lastActivity",value:n},{id:"lastSeenIp",value:e.last_seen_ip},{id:"deviceId",value:e.device_id}];return i.a.createElement(i.a.Fragment,null,u.map((({id:e,value:t},n)=>t?i.a.createElement(a.Fragment,{key:e},!!n&&" · ",i.a.createElement(d,{id:e,value:t})):null)))}},1391:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 14",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{d:"M1.333.333C.6.333 0 .933 0 1.666l.007 2.12c0 .354.14.687.386.94L2.667 7 .393 9.286a1.332 1.332 0 00-.386.94L0 12.333c0 .733.6 1.333 1.333 1.333h5.334c.733 0 1.333-.6 1.333-1.333v-2.107c0-.353-.14-.693-.387-.94L5.333 7l2.274-2.267C7.86 4.48 8 4.14 8 3.786v-2.12C8 .933 7.4.333 6.667.333H1.333zm5.334 9.94v1.393c0 .367-.3.667-.667.667H2a.669.669 0 01-.667-.667v-1.393c0-.18.074-.347.194-.473L4 7.333l2.473 2.473c.12.12.194.294.194.467z",fill:"currentColor"})))}},1392:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"a",(function(){return c}));const a="io.element.matrix_client_information.",i=e=>`${a}${e}`,r=async(e,t,n)=>{const a=e.getDeviceId(),{brand:r}=t,o=await(null==n?void 0:n.getAppVersion()),s=i(a),l=(()=>{if(window.electron)return;const e=new URL(window.location.href);return[e.host,e.pathname.replace(/\/$/,"")].join("")})();await e.setAccountData(s,{name:r,version:o,url:l})},o=(e,t)=>{Array.from(t.store.accountData.values()).forEach((n=>{if(!n.getType().startsWith(a))return;const[,i]=n.getType().split(a);i&&!e.includes(i)&&t.deleteAccountData(n.getType())}))},s=async e=>{const t=e.getDeviceId(),n=i(t),a=c(e,t);(a.name||a.version||a.url)&&await e.deleteAccountData(n)},l=e=>e&&"string"==typeof e?e:void 0,c=(e,t)=>{const n=e.getAccountData(i(t));if(!n)return{};const{name:a,version:r,url:o}=n.getContent();return{name:l(a),version:l(r),url:l(o)}}},1393:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var a=n(1),i=n.n(a),r=n(67),o=n.n(r),s=n(722);function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const c="mx_threepid_invite_";class d extends o.a{static get instance(){return d._instance||(d._instance=new d),d._instance}storeInvite(e,t){const n=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({roomId:e},t),a=this.generateIdOf(n);return localStorage.setItem(`${c}${a}`,JSON.stringify(n)),this.translateInvite(n)}getWireInvites(){const e=[];for(let t=0;t<localStorage.length;t++){const n=localStorage.key(t);if(null!=n&&n.startsWith(c))try{e.push(JSON.parse(localStorage.getItem(n)))}catch(e){console.warn("Failed to parse 3pid invite",e)}}return e}getInvites(){return this.getWireInvites().map((e=>this.translateInvite(e)))}pickBestInvite(){return this.getInvites()[0]}resolveInvite(e){localStorage.removeItem(`${c}${e.id}`)}generateIdOf(t){return s.base32.stringify(e.from(JSON.stringify(t)))}translateInvite(e){return{id:this.generateIdOf(e),roomId:e.roomId,toEmail:e.email,signUrl:e.signurl,roomName:e.room_name,roomAvatarUrl:e.room_avatar_url,inviterName:e.inviter_name}}translateToWireFormat(e){return{email:e.toEmail,signurl:e.signUrl,room_name:e.roomName,room_avatar_url:e.roomAvatarUrl,inviter_name:e.inviterName}}}i()(d,"_instance",void 0)}).call(this,n(195).Buffer)},1394:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),i=n.n(a),r=n(4),o=n(1395),s=n(700);function l({mxEvent:e,onClick:t,withTooltip:n}){var a;const l=Object(s.a)({userId:e.getSender(),member:e.sender});return e.getContent().msgtype!==r.MsgType.Emote?i.a.createElement(o.a,{fallbackName:null!==(a=e.getSender())&&void 0!==a?a:"",onClick:t,member:l,colored:!0,emphasizeDisplayName:!0,withTooltip:n}):i.a.createElement(i.a.Fragment,null)}},1395:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(0),i=n.n(a),r=n(13),o=n.n(r),s=n(2),l=n(230),c=n(201);class d extends i.a.Component{render(){const{fallbackName:e,member:t,colored:n,emphasizeDisplayName:a,withTooltip:r,onClick:d}=this.props,u=(null==t?void 0:t.rawDisplayName)||e,m=null==t?void 0:t.userId;let h,p,g;if(n&&(h=Object(l.f)(e)),m){var b,v;const e=null!==(b=null===(v=c.a.getDisplayUserIdentifier)||void 0===v?void 0:v.call(c.a,m,{withDisplayName:!0,roomId:t.roomId}))&&void 0!==b?b:m;null!=t&&t.disambiguate&&(p=i.a.createElement("span",{className:"mx_DisambiguatedProfile_mxid"},e)),g=Object(s.b)("%(displayName)s (%(matrixId)s)",{displayName:u,matrixId:e})}const f=o()(h,{mx_DisambiguatedProfile_displayName:a});return i.a.createElement("div",{className:"mx_DisambiguatedProfile",title:r?g:void 0,onClick:d},i.a.createElement("span",{className:f,dir:"auto"},u),p)}}},1396:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M20 1a1 1 0 00-1 1v2h-2a1 1 0 100 2h2v2a1 1 0 102 0V6h2a1 1 0 100-2h-2V2a1 1 0 00-1-1zM7 9.5C7 8.67 7.67 8 8.5 8s1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5zm8.5 1.5c.83 0 1.5-.67 1.5-1.5S16.33 8 15.5 8 14 8.67 14 9.5s.67 1.5 1.5 1.5zM12 17.5c2.33 0 4.31-1.46 5.11-3.5H6.89c.8 2.04 2.78 3.5 5.11 3.5zM4 12a8 8 0 019.774-7.803 1 1 0 10.442-1.95A10.03 10.03 0 0012 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10c0-.212-.007-.423-.02-.632a1 1 0 10-1.996.125A8 8 0 114 12z",fill:"currentColor"})))}},1397:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a,i,r=n(0);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function s(e){return r.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),a||(a=r.createElement("path",{d:"M10.066 14.25h1.57c1.858 0 3.364-1.567 3.364-3.5s-1.506-3.5-3.364-3.5H4.534",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round"})),i||(i=r.createElement("path",{d:"M6.524 3.75L3 7.286l3.524 3.535",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}},1398:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(1),i=n.n(a),r=n(107);class o{constructor(e,t){this.failedEventId=e,this.errorCode=t,i()(this,"ts",void 0),this.ts=Date.now()}}class s{constructor(e,t){if(this.fn=e,this.errorCodeMapFn=t,i()(this,"failures",new Map),i()(this,"visibleEvents",new Set),i()(this,"visibleFailures",new Map),i()(this,"failureCounts",{}),i()(this,"trackedEvents",new Set),i()(this,"checkInterval",null),i()(this,"trackInterval",null),!e||"function"!=typeof e)throw new Error("DecryptionFailureTracker requires tracking function");if("function"!=typeof t)throw new Error("DecryptionFailureTracker second constructor argument should be a function")}static get instance(){return s.internalInstance}eventDecrypted(e,t){"m.megolm.v1.aes-sha2"==e.getWireContent().algorithm&&(t?this.addDecryptionFailure(new o(e.getId(),t.code)):this.removeDecryptionFailuresForEvent(e))}addVisibleEvent(e){const t=e.getId();this.trackedEvents.has(t)||(this.visibleEvents.add(t),this.failures.has(t)&&!this.visibleFailures.has(t)&&this.visibleFailures.set(t,this.failures.get(t)))}addDecryptionFailure(e){const t=e.failedEventId;this.trackedEvents.has(t)||(this.failures.set(t,e),this.visibleEvents.has(t)&&!this.visibleFailures.has(t)&&this.visibleFailures.set(t,e))}removeDecryptionFailuresForEvent(e){const t=e.getId();this.failures.delete(t),this.visibleFailures.delete(t)}start(){this.checkInterval=window.setInterval((()=>this.checkFailures(Date.now())),s.CHECK_INTERVAL_MS),this.trackInterval=window.setInterval((()=>this.trackFailures()),s.TRACK_INTERVAL_MS)}stop(){this.checkInterval&&clearInterval(this.checkInterval),this.trackInterval&&clearInterval(this.trackInterval),this.failures=new Map,this.visibleEvents=new Set,this.visibleFailures=new Map,this.failureCounts={}}checkFailures(e){const t=new Set,n=new Map;for(const[a,i]of this.visibleFailures)e>i.ts+s.GRACE_PERIOD_MS?(t.add(i),this.trackedEvents.add(a)):n.set(a,i);this.visibleFailures=n,this.aggregateFailures(t)}aggregateFailures(e){for(const t of e){const e=t.errorCode;this.failureCounts[e]=(this.failureCounts[e]||0)+1}}trackFailures(){for(const e of Object.keys(this.failureCounts))if(this.failureCounts[e]>0){const t=this.errorCodeMapFn(e);this.fn(this.failureCounts[e],t,e),this.failureCounts[e]=0}}}i()(s,"internalInstance",new s(((e,t,n)=>{for(let a=0;a<e;a++)r.a.instance.trackEvent({eventName:"Error",domain:"E2EE",name:t,context:`mxc_crypto_error_type_${n}`})}),(e=>{switch(e){case"MEGOLM_UNKNOWN_INBOUND_SESSION_ID":return"OlmKeysNotSentError";case"OLM_UNKNOWN_MESSAGE_INDEX":return"OlmIndexError";case void 0:return"OlmUnspecifiedError";default:return"UnknownError"}}))),i()(s,"TRACK_INTERVAL_MS",6e4),i()(s,"CHECK_INTERVAL_MS",5e3),i()(s,"GRACE_PERIOD_MS",4e3)},1399:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("g",{fill:"none",fillRule:"evenodd"},i.createElement("path",{fill:"#ECECEC",d:"M0 0h24v24H0z"}),i.createElement("path",{d:"M7.338 13.154c.504 0 .826-.378.826-.882 0-.518-.322-.882-.826-.882-.49 0-.826.364-.826.882-.014.504.336.882.826.882zm4.662 0c.504 0 .84-.378.84-.882-.014-.518-.336-.882-.826-.882-.49 0-.84.364-.84.882-.014.504.336.882.826.882zm4.662 0c.518 0 .84-.378.84-.882 0-.518-.336-.882-.826-.882-.49 0-.84.364-.84.882 0 .504.336.882.826.882z",fill:"#454545"}))))}t.default="img/ellipsis.429f53e.svg"},1400:function(e,t,n){"use strict";n.d(t,"a",(function(){return m})),n.d(t,"b",(function(){return h}));var a=n(0),i=n.n(a),r=n(9),o=n(11),s=n(2),l=n(77),c=n(14),d=n(5),u=n(40);const m=/^[a-z0-9=_\-./]+$/;async function h(e={}){const t=o.b.createDialog(l.a,{hasCancelButton:!0,quitOnly:!0,title:d.b.getValue(u.b.Registration)?Object(s.b)("Sign In or Create Account"):Object(s.b)("Sign In"),description:d.b.getValue(u.b.Registration)?Object(s.b)("Use your account or create a new one to continue."):Object(s.b)("Use your account to continue."),button:Object(s.b)("Sign In"),extraButtons:d.b.getValue(u.b.Registration)?[i.a.createElement("button",{key:"register",onClick:()=>{t.close(),r.a.dispatch({action:"start_registration",screenAfterLogin:e.screen_after})}},Object(s.b)("Create Account"))]:[],onFinished:t=>{t?r.a.dispatch({action:"start_login",screenAfterLogin:e.screen_after}):e.go_home_on_cancel?r.a.dispatch({action:c.a.ViewHomePage}):e.go_welcome_on_cancel&&r.a.dispatch({action:"view_welcome_page"})}})}},1401:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return pe}));var a=n(17),i=n.n(a),r=n(13),o=n.n(r),s=n(39),l=n(4),c=n(6),d=n(0),u=n.n(d),m=n(260),h=n.n(m),p=n(16),g=n(68),b=n(63),v=n(14),f=n(9),y=n(1486),E=n(1487),w=n(1488),S=n(1489),_=n(1490),C=n(1491),O=n(43),x=n(2),k=n(7),R=n(107),j=n(317),I=n(219),T=n(15),P=n(5),N=n(1325),D=n(130),M=n(439),A=n(50),L=n(23),U=n(51),F=n(159),B=n(64),V=n(45),W=n(498),z=n(131),H=n(196),G=n(419),K=n(798),q=n(1599),$=n(10),Y=n(1328),J=n(38),Q=n(233),X=n(34),Z=n(1492),ee=n(1493),te=n(1494),ne=n(1442),ae=n(1495),ie=n(146),re=n(92),oe=n(182),se=n(29),le=n(1496);const ce=50,de=24;function ue(e){var t,n;return!0===(null==e||null===(t=e.current)||void 0===t||null===(n=t.id)||void 0===n?void 0:n.startsWith("mx_SpotlightDialog_button_recentlyViewed_"))}function me(e,t){const n=new Set;return e&&n.add(null),t&&n.add(l.RoomType.Space),n}var he=function(e){return e[e.People=0]="People",e[e.Rooms=1]="Rooms",e[e.Spaces=2]="Spaces",e[e.Suggestions=3]="Suggestions",e[e.PublicRooms=4]="PublicRooms",e}(he||{});let pe=function(e){return e[e.People=0]="People",e[e.PublicRooms=1]="PublicRooms",e}({});function ge(e){switch(e){case pe.People:return Object(x.b)("People");case pe.PublicRooms:return Object(x.b)("Public rooms")}}const be=e=>!(null==e||!e.room),ve=e=>!(null==e||!e.publicRoom),fe=e=>!(null==e||!e.member),ye=e=>{var t,n,a,i,r;return{publicRoom:e,section:he.PublicRooms,filter:[pe.PublicRooms],query:Object(se.m)([e.room_id.toLowerCase(),null===(t=e.canonical_alias)||void 0===t?void 0:t.toLowerCase(),null===(n=e.name)||void 0===n?void 0:n.toLowerCase(),h()(null!==(a=null===(i=e.topic)||void 0===i?void 0:i.toLowerCase())&&void 0!==a?a:"",{allowedTags:[]}),...(null===(r=e.aliases)||void 0===r?void 0:r.map((e=>e.toLowerCase())))||[]])}},Ee=e=>{const t=k.a.safeGet().getUserId();if(B.a.shared().getUserIdForRoomId(e.roomId)){const n=e.getMembers().filter((e=>e.userId!==t)),a=[...n.map((e=>e.name.toLowerCase())),...n.map((e=>e.userId.toLowerCase()))].filter(Boolean);return{room:e,section:he.People,filter:[pe.People],query:a}}return e.isSpaceRoom()?{room:e,section:he.Spaces,filter:[]}:{room:e,section:he.Rooms,filter:[]}},we=(e,t)=>({alreadyFiltered:t,member:e,section:he.Suggestions,filter:[pe.People],query:[e.userId.toLowerCase(),e.name.toLowerCase()].filter(Boolean)}),Se=new M.a,_e=(e,t)=>t.hasMentions?Object(x.b)("%(count)s unread messages including mentions.",{count:t.count}):t.hasUnreadCount?Object(x.b)("%(count)s unread messages.",{count:t.count}):t.isUnread?Object(x.b)("Unread messages."):void 0,Ce=({initialText:t="",initialFilter:n=null,onFinished:a})=>{var r,m;const h=Object(d.useRef)(null),M=Object(d.useRef)(null),se=k.a.safeGet(),Ce=Object(d.useContext)(g.c),[Oe,xe]=Object(d.useState)(t),[ke,Re]=Object(E.a)(),[je,Ie]=Object(d.useState)(n),Te=Object(d.useCallback)((e=>{var t,n,a;Ie(e),null===(t=h.current)||void 0===t||t.focus(),null===(n=M.current)||void 0===n||null===(a=n.scrollTo)||void 0===a||a.call(n,{top:0})}),[]),Pe=Object(d.useMemo)((()=>{const e=Object(W.a)(se),t=Object(W.b)(se);return Object(W.c)(e,t)}),[se]),Ne=Object(oe.a)("feature_dynamic_room_predecessors"),De=Object(V.g)(se.getUserId()),[Me,Ae]=Object(d.useState)(!1),Le=Object(d.useMemo)((()=>Oe.trim()),[Oe]),Ue=Object(oe.a)("feature_exploring_public_spaces"),{loading:Fe,publicRooms:Be,protocols:Ve,config:We,setConfig:ze,search:He}=Object(S.a)(),[Ge,Ke]=Object(d.useState)(!0),[qe,$e]=Object(d.useState)(!1),{loading:Ye,users:Je,search:Qe}=Object(C.a)(),{loading:Xe,profile:Ze,search:et}=Object(w.a)(),tt=Object(d.useMemo)((()=>[{query:Le,roomTypes:me(Ge,qe),limit:ce}]),[Le,Ge,qe]);Object(y.a)(je===pe.PublicRooms,He,tt),Object(y.a)(je===pe.People,Qe,tt),Object(y.a)(je===pe.People,et,tt);const nt=Object(d.useMemo)((()=>{const e=((e,t)=>e.getVisibleRooms(t).filter((e=>!Object(ie.a)(e)&&("join"===e.getMyMembership()||"invite"==e.getMyMembership()))))(se,Ne),t=e.map(Ee),n=[],a=t.reduce(((e,t)=>{const n=B.a.shared().getUserIdForRoomId(t.room.roomId);return n?(t.room.getJoinedMemberCount()>2||e.set(n,t),e):e}),new Map);function i(e,t){for(const i of e){if(a.has(i.userId)){const e=a.get(i.userId);t&&fe(e)&&!e.alreadyFiltered&&(e.alreadyFiltered=!0);continue}const e=we(i,t);a.set(i.userId,e),n.push(e)}}return i(((e,t,n=!0)=>Object.values(e.filter((e=>!n||!B.a.shared().getUserIdForRoomId(e.roomId))).reduce(((e,t)=>{for(const n of t.getJoinedMembers())e[n.userId]=n;return e}),{})).filter((e=>e.userId!==t.getUserId())))(e,se),!1),i(Je,!0),Ze&&i([new F.a(Ze)],!0),[...U.a.instance.enabledMetaSpaces.map((e=>({section:he.Spaces,filter:[],avatar:u.a.createElement("div",{className:o()("mx_SpotlightDialog_metaspaceResult",`mx_SpotlightDialog_metaspaceResult_${e}`)}),name:Object(L.g)(e,U.a.instance.allRoomsInHome),onClick(){U.a.instance.setActiveSpace(e)}}))),...t,...n,...Be.map(ye)].filter((e=>null===je||e.filter.includes(je)))}),[se,Je,Ze,Be,je,Ne]),at=Object(d.useMemo)((()=>{const e={[he.People]:[],[he.Rooms]:[],[he.Spaces]:[],[he.Suggestions]:[],[he.PublicRooms]:[]};if(Le){const t=Le.toLowerCase(),n=Object(c.B)(Le);nt.forEach((a=>{var i,r,o;if(be(a)){if(!(null!==(i=a.room.normalizedName)&&void 0!==i&&i.includes(n)||null!==(r=a.room.getCanonicalAlias())&&void 0!==r&&r.toLowerCase().includes(t)||null!==(o=a.query)&&void 0!==o&&o.some((e=>e.includes(t)))))return}else if(fe(a)){var s;if(!(a.alreadyFiltered||null!==(s=a.query)&&void 0!==s&&s.some((e=>e.includes(t)))))return}else if(ve(a)){var l;if(null===(l=a.query)||void 0===l||!l.some((e=>e.includes(t))))return}else{var c;if(!(a.name.toLowerCase().includes(t)||null!==(c=a.query)&&void 0!==c&&c.some((e=>e.includes(t)))))return}e[a.section].push(a)}))}else je===pe.PublicRooms?nt.forEach((t=>{ve(t)&&e[t.section].push(t)})):je===pe.People&&nt.forEach((t=>{fe(t)&&e[t.section].push(t)}));const t=se.getSafeUserId();for(const n of Object.values(e))n.sort(((e,n)=>be(e)||be(n)?be(n)&&be(e)?Se.getLastTs(n.room,t)-Se.getLastTs(e.room,t):-1:fe(e)||fe(n)?fe(n)&&fe(e)?Pe(e.member,n.member):-1:0));return e}),[Le,je,se,nt,Pe]);((e,t,n)=>{Object(d.useEffect)((()=>{if(!t)return;const a=window.setTimeout((()=>{R.a.instance.trackEvent({eventName:"WebSearch",viaSpotlight:n,numResults:e,queryLength:t})}),1e3);return()=>{clearTimeout(a)}}),[e,t,n])})(Object(s.sum)(Object.values(at).map((e=>e.length))),Oe.length,!0);const it=U.a.instance.activeSpaceRoom,[rt,ot]=Object(_.a)(null!=it?it:void 0,Oe);Object(d.useEffect)((()=>{e((()=>{const e=Ce.state.refs[0];var t,n;e&&(Ce.dispatch({type:g.f.SetFocus,payload:{ref:e}}),null===(t=e.current)||void 0===t||null===(n=t.scrollIntoView)||void 0===n||n.call(t,{block:"nearest"}))}))}),[at,je]);const st=(e,t=!1,n=!1)=>{if(t){const t=new Set(P.b.getValue("SpotlightSearch.recentSearches",null).reverse());t.delete(e.roomId),t.add(e.roomId),P.b.setValue("SpotlightSearch.recentSearches",null,T.a.ACCOUNT,Array.from(t).reverse().slice(0,10))}f.a.dispatch({action:v.a.ViewRoom,metricsTrigger:"WebUnifiedSearch",metricsViaKeyboard:n,room_id:e.roomId,room_alias:e.roomAlias,auto_join:e.autoJoin,should_peek:e.shouldPeek,via_servers:e.viaServers}),a()};let lt,ct;if((Le||je!==pe.PublicRooms)&&(lt=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_otherSearches"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_otherSearches"},Le?Object(x.b)('Use "%(query)s" to search',{query:Oe}):Object(x.b)("Search for")),u.a.createElement("div",null,je!==pe.PublicRooms&&u.a.createElement(Z.a,{id:"mx_SpotlightDialog_button_explorePublicRooms",className:"mx_SpotlightDialog_explorePublicRooms",onClick:()=>Te(pe.PublicRooms)},ge(pe.PublicRooms)),je!==pe.People&&u.a.createElement(Z.a,{id:"mx_SpotlightDialog_button_startChat",className:"mx_SpotlightDialog_startChat",onClick:()=>Te(pe.People)},ge(pe.People))))),Le||null!==je){const e=e=>{var t;if(be(e)){const t=D.a.instance.getRoomState(e.room),n=_e(e.room,t),a={"aria-label":n?`${e.room.name} ${n}`:e.room.name,"aria-describedby":`mx_SpotlightDialog_button_result_${e.room.roomId}_details`};return u.a.createElement(Z.a,i()({id:`mx_SpotlightDialog_button_result_${e.room.roomId}`,key:`${he[e.section]}-${e.room.roomId}`,onClick:t=>{st({roomId:e.room.roomId},!0,"click"!==(null==t?void 0:t.type))},endAdornment:u.a.createElement(te.a,{room:e.room})},a),u.a.createElement(G.a,{room:e.room,avatarSize:de,tooltipProps:{tabIndex:-1}}),e.room.name,u.a.createElement(Q.a,{notification:t}),u.a.createElement(ne.a,{id:`mx_SpotlightDialog_button_result_${e.room.roomId}_details`,className:"mx_SpotlightDialog_result_details",room:e.room}))}if(fe(e))return u.a.createElement(Z.a,{id:`mx_SpotlightDialog_button_result_${e.member.userId}`,key:`${he[e.section]}-${e.member.userId}`,onClick:()=>{Object(F.e)(se,[e.member]),a()},"aria-label":e.member instanceof l.RoomMember?e.member.rawDisplayName:e.member.name,"aria-describedby":`mx_SpotlightDialog_button_result_${e.member.userId}_details`},u.a.createElement(K.a,{user:e.member,size:de}),e.member instanceof l.RoomMember?e.member.rawDisplayName:e.member.name,u.a.createElement("div",{id:`mx_SpotlightDialog_button_result_${e.member.userId}_details`,className:"mx_SpotlightDialog_result_details"},e.member.userId));if(ve(e)){const t=se.getRoom(e.publicRoom.room_id),n="join"===(null==t?void 0:t.getMyMembership())||e.publicRoom.world_readable||se.isGuest(),a=t=>{var n;t.stopPropagation();const{publicRoom:a}=e;st({roomAlias:a.canonical_alias||(null===(n=a.aliases)||void 0===n?void 0:n[0]),roomId:a.room_id,autoJoin:!e.publicRoom.world_readable&&!se.isGuest(),shouldPeek:e.publicRoom.world_readable||se.isGuest(),viaServers:We?[We.roomServer]:void 0},!0,"click"!==t.type)};return u.a.createElement(Z.a,{id:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}`,className:"mx_SpotlightDialog_result_multiline",key:`${he[e.section]}-${e.publicRoom.room_id}`,onClick:a,endAdornment:u.a.createElement($.a,{kind:n?"primary_outline":"primary",onClick:a,tabIndex:-1},n?Object(x.b)("View"):Object(x.b)("Join")),"aria-labelledby":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_name`,"aria-describedby":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_alias`,"aria-details":`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_details`},u.a.createElement(re.a,{className:"mx_SearchResultAvatar",oobData:{roomId:e.publicRoom.room_id,name:e.publicRoom.name,avatarUrl:e.publicRoom.avatar_url,roomType:e.publicRoom.room_type},width:de,height:de}),u.a.createElement(ee.a,{room:e.publicRoom,labelId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_name`,descriptionId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_alias`,detailsId:`mx_SpotlightDialog_button_result_${e.publicRoom.room_id}_details`}))}return u.a.createElement(Z.a,{id:`mx_SpotlightDialog_button_result_${e.name}`,key:`${he[e.section]}-${e.name}`,onClick:null!==(t=e.onClick)&&void 0!==t?t:null},e.avatar,e.name,e.description)};let t,n,r,o,c,d,m,h,p,g;at[he.People].length&&(t=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_people"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_people"},Object(x.b)("Recent Conversations")),u.a.createElement("div",null,at[he.People].slice(0,ce).map(e)))),at[he.Suggestions].length&&je===pe.People&&(n=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_suggestions"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_suggestions"},Object(x.b)("Suggestions")),u.a.createElement("div",null,at[he.Suggestions].slice(0,ce).map(e)))),at[he.Rooms].length&&(r=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_rooms"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_rooms"},Object(x.b)("Rooms")),u.a.createElement("div",null,at[he.Rooms].slice(0,ce).map(e)))),at[he.Spaces].length&&(o=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_spaces"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_spaces"},Object(x.b)("Spaces you're in")),u.a.createElement("div",null,at[he.Spaces].slice(0,ce).map(e)))),je===pe.PublicRooms&&(c=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_publicRooms"},u.a.createElement("div",{className:"mx_SpotlightDialog_sectionHeader"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_publicRooms"},Object(x.b)("Suggestions")),u.a.createElement("div",{className:"mx_SpotlightDialog_options"},Ue&&u.a.createElement(u.a.Fragment,null,u.a.createElement(Y.a,{label:Object(x.b)("Show rooms"),value:Ge,onChange:Ke}),u.a.createElement(Y.a,{label:Object(x.b)("Show spaces"),value:qe,onChange:$e})),u.a.createElement(q.a,{protocols:Ve,config:null!=We?We:null,setConfig:ze}))),u.a.createElement("div",null," ",Ge||qe?at[he.PublicRooms].slice(0,ce).map(e):u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(x.b)("You cannot search for rooms that are neither a room nor a space"))," "))),rt.length&&it&&null===je&&(d=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_results",role:"group","aria-labelledby":"mx_SpotlightDialog_section_spaceRooms"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_spaceRooms"},Object(x.b)("Other rooms in %(spaceName)s",{spaceName:it.name})),u.a.createElement("div",null,rt.slice(0,ce).map((e=>u.a.createElement(Z.a,{id:`mx_SpotlightDialog_button_result_${e.room_id}`,key:e.room_id,onClick:t=>{st({roomId:e.room_id},!0,"click"!==(null==t?void 0:t.type))}},u.a.createElement(H.a,{name:e.name,idName:e.room_id,url:e.avatar_url?Object(b.b)(e.avatar_url).getSquareThumbnailHttp(de):null,width:de,height:de}),e.name||e.canonical_alias,e.name&&e.canonical_alias&&u.a.createElement("div",{className:"mx_SpotlightDialog_result_details"},e.canonical_alias)))),ot&&u.a.createElement(J.a,null)))),!Le.startsWith("#")||!Le.includes(":")||Object(j.a)(Le)&&se.getRoom(Object(j.a)(Le))||(m=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group"},u.a.createElement("div",null,u.a.createElement(Z.a,{id:"mx_SpotlightDialog_button_joinRoomAlias",className:"mx_SpotlightDialog_joinRoomAlias",onClick:e=>{f.a.dispatch({action:v.a.ViewRoom,room_alias:Le,auto_join:!0,metricsTrigger:"WebUnifiedSearch",metricsViaKeyboard:"click"!==(null==e?void 0:e.type)}),a()}},Object(x.b)("Join %(roomAddress)s",{roomAddress:Le}))))),je===pe.People?h=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_hiddenResults",role:"group"},u.a.createElement("h4",null,Object(x.b)("Some results may be hidden for privacy")),u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(x.b)("If you can't see who you're looking for, send them your invite link.")),u.a.createElement(ae.a,{id:"mx_SpotlightDialog_button_inviteLink",className:"mx_SpotlightDialog_inviteLink",onClick:()=>{Ae(!0),Object(z.b)(De)},onHideTooltip:()=>Ae(!1),title:Me?Object(x.b)("Copied!"):Object(x.b)("Copy")},u.a.createElement("span",{className:"mx_AccessibleButton mx_AccessibleButton_hasKind mx_AccessibleButton_kind_primary_outline"},Object(x.b)("Copy invite link")))):Le&&je===pe.PublicRooms&&(h=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_hiddenResults",role:"group"},u.a.createElement("h4",null,Object(x.b)("Some results may be hidden")),u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(x.b)("If you can't find the room you're looking for, ask for an invite or create a new room.")),u.a.createElement(Z.a,{id:"mx_SpotlightDialog_button_createNewRoom",className:"mx_SpotlightDialog_createRoom",onClick:()=>f.a.dispatch({action:"view_create_room",public:!0,defaultName:Object(s.capitalize)(Le)})},u.a.createElement("span",{className:"mx_AccessibleButton mx_AccessibleButton_hasKind mx_AccessibleButton_kind_primary_outline"},Object(x.b)("Create new room"))))),je===pe.People&&(p=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_groupChat"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_groupChat"},Object(x.b)("Other options")),u.a.createElement(Z.a,{id:"mx_SpotlightDialog_button_startGroupChat",className:"mx_SpotlightDialog_startGroupChat",onClick:()=>Object(I.f)(Le)},Object(x.b)("Start a group chat")))),null===je&&(g=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_otherSearches",role:"group","aria-labelledby":"mx_SpotlightDialog_section_messageSearch"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_messageSearch"},Object(x.b)("Other searches")),u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchText"},Object(x.b)("To search messages, look for this icon at the top of a room <icon/>",{},{icon:()=>u.a.createElement("div",{className:"mx_SpotlightDialog_otherSearches_messageSearchIcon"})})))),ct=u.a.createElement(u.a.Fragment,null,t,n,r,o,d,c,m,h,lt,p,g)}else{let e;ke.length&&(e=u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_recentSearches",role:"group",tabIndex:-1,"aria-labelledby":"mx_SpotlightDialog_section_recentSearches"},u.a.createElement("h4",null,u.a.createElement("span",{id:"mx_SpotlightDialog_section_recentSearches"},Object(x.b)("Recent searches")),u.a.createElement($.a,{kind:"link",onClick:Re},Object(x.b)("Clear"))),u.a.createElement("div",null,ke.map((e=>{const t=D.a.instance.getRoomState(e),n=_e(0,t),a={"aria-label":n?`${e.name} ${n}`:e.name,"aria-describedby":`mx_SpotlightDialog_button_recentSearch_${e.roomId}_details`};return u.a.createElement(Z.a,i()({id:`mx_SpotlightDialog_button_recentSearch_${e.roomId}`,key:e.roomId,onClick:t=>{st({roomId:e.roomId},!0,"click"!==(null==t?void 0:t.type))},endAdornment:u.a.createElement(te.a,{room:e})},a),u.a.createElement(G.a,{room:e,avatarSize:de,tooltipProps:{tabIndex:-1}}),e.name,u.a.createElement(Q.a,{notification:t}),u.a.createElement(ne.a,{id:`mx_SpotlightDialog_button_recentSearch_${e.roomId}_details`,className:"mx_SpotlightDialog_result_details",room:e}))}))))),ct=u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{className:"mx_SpotlightDialog_section mx_SpotlightDialog_recentlyViewed",role:"group","aria-labelledby":"mx_SpotlightDialog_section_recentlyViewed"},u.a.createElement("h4",{id:"mx_SpotlightDialog_section_recentlyViewed"},Object(x.b)("Recently viewed")),u.a.createElement("div",null,N.a.instance.rooms.filter((e=>e.roomId!==A.b.instance.roomViewStore.getRoomId())).map((e=>u.a.createElement(ae.a,{id:`mx_SpotlightDialog_button_recentlyViewed_${e.roomId}`,title:e.name,key:e.roomId,onClick:t=>{st({roomId:e.roomId},!1,"click"!==t.type)}},u.a.createElement(G.a,{room:e,avatarSize:32,tooltipProps:{tabIndex:-1}}),e.name))))),e,lt)}const dt=null===(r=Ce.state.activeRef)||void 0===r||null===(m=r.current)||void 0===m?void 0:m.id;return u.a.createElement(u.a.Fragment,null,u.a.createElement("div",{id:"mx_SpotlightDialog_keyboardPrompt"},Object(x.b)("Use <arrows/> to scroll",{},{arrows:()=>u.a.createElement(u.a.Fragment,null,u.a.createElement("kbd",null,"↓"),u.a.createElement("kbd",null,"↑"),null!==!je&&!Oe&&u.a.createElement("kbd",null,"←"),null!==!je&&!Oe&&u.a.createElement("kbd",null,"→"))})),u.a.createElement(X.a,{className:"mx_SpotlightDialog",onFinished:a,hasCancel:!1,onKeyDown:e=>{if(Object(O.a)().getNavigationAction(e)===p.h.FilterRooms)e.stopPropagation(),e.preventDefault(),a();let t;const n=Object(O.a)().getAccessibilityAction(e);switch(n){case p.h.Escape:e.stopPropagation(),e.preventDefault(),a();break;case p.h.ArrowUp:case p.h.ArrowDown:if(e.stopPropagation(),e.preventDefault(),Ce.state.activeRef&&Ce.state.refs.length>0){let e=Ce.state.refs;if(!Oe&&null!==!je){const t=ue(Ce.state.activeRef)?Ce.state.activeRef:e.find(ue);e=e.filter((e=>e===t||!ue(e)))}const a=e.indexOf(Ce.state.activeRef);t=Object(g.h)(e,a+(n===p.h.ArrowUp?-1:1))}break;case p.h.ArrowLeft:case p.h.ArrowRight:if(!Oe&&null!==!je&&Ce.state.activeRef&&Ce.state.refs.length>0&&ue(Ce.state.activeRef)){e.stopPropagation(),e.preventDefault();const a=Ce.state.refs.filter(ue),i=a.indexOf(Ce.state.activeRef);t=Object(g.h)(a,i+(n===p.h.ArrowLeft?-1:1))}}var i;t&&(Ce.dispatch({type:g.f.SetFocus,payload:{ref:t}}),null===(i=t.current)||void 0===i||i.scrollIntoView({block:"nearest"}))},screenName:"UnifiedSearch","aria-label":Object(x.b)("Search Dialog")},u.a.createElement("div",{className:"mx_SpotlightDialog_searchBox mx_textinput"},null!==je&&u.a.createElement("div",{className:o()("mx_SpotlightDialog_filter",{mx_SpotlightDialog_filterPeople:je===pe.People,mx_SpotlightDialog_filterPublicRooms:je===pe.PublicRooms})},u.a.createElement("span",null,ge(je)),u.a.createElement($.a,{tabIndex:-1,alt:Object(x.b)("Remove search filter for %(filter)s",{filter:ge(je)}),className:"mx_SpotlightDialog_filter--close",onClick:()=>Te(null)})),u.a.createElement("input",{ref:h,autoFocus:!0,type:"text",autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",spellCheck:"false",placeholder:Object(x.b)("Search"),value:Oe,onChange:e=>{const t=Object(le.a)(e.currentTarget.value);xe(t)},onKeyDown:e=>{var t,n;switch(Object(O.a)().getAccessibilityAction(e)){case p.h.Backspace:Oe||null===je||(e.stopPropagation(),e.preventDefault(),Te(null));break;case p.h.Enter:e.stopPropagation(),e.preventDefault(),null===(t=Ce.state.activeRef)||void 0===t||null===(n=t.current)||void 0===n||n.click()}},"aria-owns":"mx_SpotlightDialog_content","aria-activedescendant":dt,"aria-label":Object(x.b)("Search"),"aria-describedby":"mx_SpotlightDialog_keyboardPrompt"}),(Fe||Ye||Xe)&&u.a.createElement(J.a,{w:24,h:24})),u.a.createElement("div",{ref:M,id:"mx_SpotlightDialog_content",role:"listbox","aria-activedescendant":dt,"aria-describedby":"mx_SpotlightDialog_keyboardPrompt"},ct)))};t.b=e=>u.a.createElement(g.d,null,(()=>u.a.createElement(Ce,e)))}).call(this,n(267).setImmediate)},1402:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(1),i=n.n(a),r=n(8);class o{constructor(e,t,n,a=!1){this.root=e,this.pageSize=t,this.maxDepth=n,this.suggestedOnly=a,i()(this,"viaMap",new Map),i()(this,"backRefs",new Map),i()(this,"roomMap",new Map),i()(this,"loadRequest",void 0),i()(this,"nextBatch",void 0),i()(this,"_rooms",void 0),i()(this,"serverSupportError",void 0)}get noSupport(){return!!this.serverSupportError}get canLoadMore(){return!!this.serverSupportError||!!this.nextBatch||!this._rooms}get loading(){return!!this.loadRequest}get rooms(){return this._rooms}async load(e=this.pageSize){if(this.loadRequest)return this.loadRequest.then((e=>e.rooms));let t;this.loadRequest=this.root.client.getRoomHierarchy(this.root.roomId,e,this.maxDepth,this.suggestedOnly,this.nextBatch);try{({rooms:t,next_batch:this.nextBatch}=await this.loadRequest)}catch(e){if("M_UNRECOGNIZED"!==e.errcode)throw e;return this.serverSupportError=e,[]}finally{this.loadRequest=void 0}return this._rooms?this._rooms=this._rooms.concat(t):this._rooms=t,t.forEach((e=>{this.roomMap.set(e.room_id,e),e.children_state.forEach((t=>{if(t.type!==r.b.SpaceChild)return;const n=t.state_key;if(this.backRefs.has(n)||this.backRefs.set(n,[]),this.backRefs.get(n).push(e.room_id),Array.isArray(t.content.via)){this.viaMap.has(n)||this.viaMap.set(n,new Set);const e=this.viaMap.get(n);t.content.via.forEach((t=>e.add(t)))}}))})),t}getRelation(e,t){var n;return null===(n=this.roomMap.get(e))||void 0===n?void 0:n.children_state.find((e=>e.state_key===t))}isSuggested(e,t){var n;return null===(n=this.getRelation(e,t))||void 0===n?void 0:n.content.suggested}removeRelation(e,t){const n=this.backRefs.get(t);1===(null==n?void 0:n.length)?this.backRefs.delete(t):null!=n&&n.length&&this.backRefs.set(t,n.filter((t=>t!==e)));const a=this.roomMap.get(e);a&&(a.children_state=a.children_state.filter((e=>e.state_key!==t)))}}},1403:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{d:"M8.414 1.432c.178-.576.994-.576 1.172 0l1.585 5.131h5.215c.586 0 .838.745.372 1.1l-4.244 3.243 1.604 5.194c.177.57-.483 1.03-.958.668L9 13.59l-4.16 3.178c-.475.363-1.135-.098-.959-.668l1.606-5.194-4.245-3.242c-.466-.356-.214-1.1.372-1.1H6.83l1.585-5.132z",fill:"currentColor"})))}},1404:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a,i,r,o=n(0);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s.apply(this,arguments)}function l(e){return o.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=o.createElement("mask",{id:"members_svg__a",fill:"#fff"},o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.591 20.292A9.954 9.954 0 0112 22a9.956 9.956 0 01-6-2 9.985 9.985 0 01-4-8C2 6.477 6.477 2 12 2s10 4.477 10 10a9.99 9.99 0 01-4.409 8.292zM12 12.5c1.657 0 3-1.455 3-3.25S13.657 6 12 6 9 7.455 9 9.25s1.343 3.25 3 3.25zm0 7.5a7.974 7.974 0 005.563-2.251 6.002 6.002 0 00-11.126 0A7.973 7.973 0 0012 20z"}))),i||(i=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M17.591 20.292A9.954 9.954 0 0112 22a9.956 9.956 0 01-6-2 9.985 9.985 0 01-4-8C2 6.477 6.477 2 12 2s10 4.477 10 10a9.99 9.99 0 01-4.409 8.292zM12 12.5c1.657 0 3-1.455 3-3.25S13.657 6 12 6 9 7.455 9 9.25s1.343 3.25 3 3.25zm0 7.5a7.974 7.974 0 005.563-2.251 6.002 6.002 0 00-11.126 0A7.973 7.973 0 0012 20z",fill:"currentColor"})),r||(r=o.createElement("path",{d:"M17.591 20.292l-1.12-1.657 1.12 1.657zM6 20.001L4.799 21.6 6 20zm11.563-2.252l1.391 1.437.97-.938-.507-1.25-1.854.75zm-11.126 0l-1.854-.751-.506 1.25.969.938 1.39-1.437zM12 24c2.482 0 4.794-.756 6.71-2.05l-2.239-3.315A7.954 7.954 0 0112 20v4zm-7.201-2.4A11.956 11.956 0 0012 24v-4a7.955 7.955 0 01-4.799-1.598L4.8 21.6zM0 12c0 3.927 1.889 7.414 4.799 9.6L7.2 18.402A7.985 7.985 0 014 12H0zM12 0C5.373 0 0 5.373 0 12h4a8 8 0 018-8V0zm12 12c0-6.627-5.373-12-12-12v4a8 8 0 018 8h4zm-5.29 9.95A11.99 11.99 0 0024 12h-4a7.99 7.99 0 01-3.529 6.635l2.24 3.314zM13 9.25c0 .844-.595 1.25-1 1.25v4c2.91 0 5-2.504 5-5.25h-4zM12 8c.405 0 1 .406 1 1.25h4C17 6.504 14.91 4 12 4v4zm-1 1.25c0-.844.595-1.25 1-1.25V4C9.09 4 7 6.504 7 9.25h4zm1 1.25c-.405 0-1-.406-1-1.25H7c0 2.746 2.09 5.25 5 5.25v-4zm4.172 5.812A5.974 5.974 0 0112 18v4a9.973 9.973 0 006.954-2.814l-2.782-2.874zM12 16a4.002 4.002 0 013.71 2.5l3.707-1.502A8.002 8.002 0 0012 12v4zm-3.71 2.5A4.002 4.002 0 0112 16v-4a8.002 8.002 0 00-7.417 4.998L8.29 18.5zM12 18a5.974 5.974 0 01-4.172-1.688l-2.782 2.874A9.973 9.973 0 0012 22v-4z",fill:"currentColor",mask:"url(#members_svg__a)"})))}},1405:function(e,t,n){"use strict";n.d(t,"a",(function(){return _}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3),l=n(2),c=n(5),d=n(339),u=n(650),m=n(10),h=n(9),p=n(14),g=n(161),b=n(46),v=n(280),f=n(15),y=n(113),E=n(218);function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class _ extends o.a.Component{constructor(e){super(e),i()(this,"themeTimer",void 0),i()(this,"onThemeChange",(e=>{if(this.state.theme===e)return;y.b.trackInteraction("WebSettingsAppearanceTabThemeSelector");const t=c.b.getValue("theme");c.b.setValue("theme",null,f.a.DEVICE,e).catch((()=>{h.a.dispatch({action:p.a.RecheckTheme}),this.setState({theme:t})})),this.setState({theme:e}),h.a.dispatch({action:p.a.RecheckTheme,forceTheme:e})})),i()(this,"onUseSystemThemeChanged",(e=>{this.setState({useSystemTheme:e}),c.b.setValue("use_system_theme",null,f.a.DEVICE,e),h.a.dispatch({action:p.a.RecheckTheme})})),i()(this,"onAddCustomTheme",(async()=>{let e=c.b.getValue("custom_themes");e||(e=[]),e=e.map((e=>e)),this.themeTimer&&clearTimeout(this.themeTimer);try{const t=await fetch(this.state.customThemeUrl),n=await t.json();if(!n||"string"!=typeof n.name||"object"!=typeof n.colors)return void this.setState({customThemeMessage:{text:Object(l.b)("Invalid theme schema."),isError:!0}});e.push(n)}catch(e){return s.a.error(e),void this.setState({customThemeMessage:{text:Object(l.b)("Error downloading theme information."),isError:!0}})}await c.b.setValue("custom_themes",null,f.a.ACCOUNT,e),this.setState({customThemeUrl:"",customThemeMessage:{text:Object(l.b)("Theme added!"),isError:!1}}),this.themeTimer=window.setTimeout((()=>{this.setState({customThemeMessage:{text:"",isError:!1}})}),3e3)})),i()(this,"onCustomThemeChange",(e=>{this.setState({customThemeUrl:e.target.value})})),this.state=S(S({},_.calculateThemeState()),{},{customThemeUrl:"",customThemeMessage:{isError:!1,text:""}})}static calculateThemeState(){const e=c.b.getValue("theme"),t=c.b.getValueAt(f.a.DEVICE,"use_system_theme",null,!1,!0),n=c.b.getValueAt(f.a.DEVICE,"theme",null,!1,!0);return t?{theme:e,useSystemTheme:!0}:n?{theme:e,useSystemTheme:!1}:{theme:e,useSystemTheme:c.b.getValueAt(f.a.DEVICE,"use_system_theme")}}renderHighContrastCheckbox(){if(!this.state.useSystemTheme&&(Object(d.c)(this.state.theme)||Object(d.g)(this.state.theme)))return o.a.createElement("div",null,o.a.createElement(g.b,{checked:Object(d.g)(this.state.theme),onChange:e=>this.highContrastThemeChanged(e.target.checked)},Object(l.b)("Use high contrast")))}highContrastThemeChanged(e){let t;t=e?Object(d.c)(this.state.theme):Object(d.d)(this.state.theme),t&&this.onThemeChange(t)}render(){let e,t;if((new u.a).isSystemThemeSupported()&&(e=o.a.createElement("div",{"data-testid":"checkbox-use-system-theme"},o.a.createElement(g.b,{checked:this.state.useSystemTheme,onChange:e=>this.onUseSystemThemeChanged(e.target.checked)},c.b.getDisplayName("use_system_theme")))),c.b.getValue("feature_custom_themes")){let e;this.state.customThemeMessage.text&&(e=this.state.customThemeMessage.isError?o.a.createElement("div",{className:"text-error"},this.state.customThemeMessage.text):o.a.createElement("div",{className:"text-success"},this.state.customThemeMessage.text)),t=o.a.createElement("div",{className:"mx_SettingsTab_section"},o.a.createElement("form",{onSubmit:this.onAddCustomTheme},o.a.createElement(b.a,{label:Object(l.b)("Custom theme URL"),type:"text",id:"mx_GeneralUserSettingsTab_customThemeInput",autoComplete:"off",onChange:this.onCustomThemeChange,value:this.state.customThemeUrl}),o.a.createElement(m.a,{onClick:this.onAddCustomTheme,type:"submit",kind:"primary_sm",disabled:!this.state.customThemeUrl.trim()},Object(l.b)("Add theme")),e))}const n=Object(d.f)();return o.a.createElement(E.b,{heading:Object(l.b)("Theme"),"data-testid":"mx_ThemeChoicePanel"},e,o.a.createElement("div",{className:"mx_ThemeChoicePanel_themeSelectors","data-testid":"theme-choice-panel-selectors"},o.a.createElement(v.a,{name:"theme",definitions:n.map((e=>({value:e.id,label:e.name,disabled:this.state.useSystemTheme,className:"mx_ThemeSelector_"+e.id}))),onChange:this.onThemeChange,value:this.apparentSelectedThemeId(),outlined:!0})),this.renderHighContrastCheckbox(),t)}apparentSelectedThemeId(){if(this.state.useSystemTheme)return;const e=Object(d.d)(this.state.theme);return e||this.state.theme}}},1406:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3),l=n(11),c=n(9),d=n(2),u=n(7),m=n(643),h=n(77),p=n(34),g=n(38),b=n(60);class v extends o.a.Component{constructor(e){super(e),i()(this,"onExportE2eKeysClicked",(()=>{l.b.createDialogAsync(n.e(7).then(n.bind(null,1583)),{matrixClient:u.a.safeGet()})})),i()(this,"onFinished",(e=>{e&&c.a.dispatch({action:"logout"}),this.props.onFinished(!!e)})),i()(this,"onSetRecoveryMethodClick",(()=>{this.state.backupInfo?l.b.createDialog(m.a,void 0,void 0,!1,!0):l.b.createDialogAsync(n.e(8).then(n.bind(null,1433)),void 0,void 0,!1,!0),this.props.onFinished(!0)})),i()(this,"onLogoutConfirm",(()=>{c.a.dispatch({action:"logout"}),this.props.onFinished(!0)}));const t=u.a.safeGet(),a=t.isCryptoEnabled()&&!t.getKeyBackupEnabled();this.state={shouldLoadBackupStatus:a,loading:a,backupInfo:null},a&&this.loadBackupStatus()}async loadBackupStatus(){try{const e=await u.a.safeGet().getKeyBackupVersion();this.setState({loading:!1,backupInfo:e})}catch(e){s.a.log("Unable to fetch key backup status",e),this.setState({loading:!1})}}render(){if(this.state.shouldLoadBackupStatus){const e=o.a.createElement("div",null,o.a.createElement("p",null,Object(d.b)("Encrypted messages are secured with end-to-end encryption. Only you and the recipient(s) have the keys to read these messages.")),o.a.createElement("p",null,Object(d.b)("When you sign out, these keys will be deleted from this device, which means you won't be able to read encrypted messages unless you have the keys for them on your other devices, or backed them up to the server.")),o.a.createElement("p",null,Object(d.b)("Back up your keys before signing out to avoid losing them.")));let t;if(this.state.loading)t=o.a.createElement(g.a,null);else{let n;n=this.state.backupInfo?Object(d.b)("Connect this session to Key Backup"):Object(d.b)("Start using Key Backup"),t=o.a.createElement("div",null,o.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},e),o.a.createElement(b.a,{primaryButton:n,hasCancel:!1,onPrimaryButtonClick:this.onSetRecoveryMethodClick,focus:!0},o.a.createElement("button",{onClick:this.onLogoutConfirm},Object(d.b)("I don't want my encrypted messages"))),o.a.createElement("details",null,o.a.createElement("summary",null,Object(d.b)("Advanced")),o.a.createElement("p",null,o.a.createElement("button",{onClick:this.onExportE2eKeysClicked},Object(d.b)("Manually export keys")))))}return o.a.createElement(p.a,{title:Object(d.b)("You'll lose access to your encrypted messages"),contentId:"mx_Dialog_content",hasCancel:!0,onFinished:this.onFinished},t)}return o.a.createElement(h.a,{hasCancelButton:!0,title:Object(d.b)("Sign out"),description:Object(d.b)("Are you sure you want to sign out?"),button:Object(d.b)("Sign out"),onFinished:this.onFinished})}}i()(v,"defaultProps",{onFinished:function(){}})},1407:function(e,t,n){"use strict";t.__esModule=!0,t.setBatch=t.getBatch=void 0;var a=function(e){e()};t.setBatch=function(e){return a=e};t.getBatch=function(){return a}},1408:function(e,t,n){"use strict";var a=n(194).default,i=n(268).default;t.__esModule=!0,t.default=function(e,t){void 0===t&&(t={});var n=t,a=n.getDisplayName,i=void 0===a?function(e){return"ConnectAdvanced("+e+")"}:a,u=n.methodName,S=void 0===u?"connectAdvanced":u,_=n.renderCountProp,C=void 0===_?void 0:_,O=n.shouldHandleStateChanges,x=void 0===O||O,k=n.storeKey,R=void 0===k?"store":k,j=(n.withRef,n.forwardRef),I=void 0!==j&&j,T=n.context,P=void 0===T?m.ReactReduxContext:T,N=(0,o.default)(n,h);0;var D=P;return function(t){var n=t.displayName||t.name||"Component",a=i(n),u=(0,r.default)({},N,{getDisplayName:i,methodName:S,renderCountProp:C,shouldHandleStateChanges:x,storeKey:R,displayName:a,wrappedComponentName:n,WrappedComponent:t}),m=N.pure;var h=m?l.useMemo:function(e){return e()};function _(n){var a=(0,l.useMemo)((function(){var e=n.reactReduxForwardedRef,t=(0,o.default)(n,p);return[n.context,e,t]}),[n]),i=a[0],s=a[1],m=a[2],S=(0,l.useMemo)((function(){return i&&i.Consumer&&(0,c.isContextConsumer)(l.default.createElement(i.Consumer,null))?i:D}),[i,D]),_=(0,l.useContext)(S),C=Boolean(n.store)&&Boolean(n.store.getState)&&Boolean(n.store.dispatch);Boolean(_)&&Boolean(_.store);var O=C?n.store:_.store,k=(0,l.useMemo)((function(){return function(t){return e(t.dispatch,u)}(O)}),[O]),R=(0,l.useMemo)((function(){if(!x)return b;var e=(0,d.createSubscription)(O,C?null:_.subscription),t=e.notifyNestedSubs.bind(e);return[e,t]}),[O,C,_]),j=R[0],I=R[1],T=(0,l.useMemo)((function(){return C?_:(0,r.default)({},_,{subscription:j})}),[C,_,j]),P=(0,l.useReducer)(v,g,w),N=P[0][0],M=P[1];if(N&&N.error)throw N.error;var A=(0,l.useRef)(),L=(0,l.useRef)(m),U=(0,l.useRef)(),F=(0,l.useRef)(!1),B=h((function(){return U.current&&m===L.current?U.current:k(O.getState(),m)}),[O,N,m]);f(y,[L,A,F,m,B,U,I]),f(E,[x,O,j,k,L,A,F,U,I,M],[O,j,k]);var V=(0,l.useMemo)((function(){return l.default.createElement(t,(0,r.default)({},B,{ref:s}))}),[s,t,B]);return(0,l.useMemo)((function(){return x?l.default.createElement(S.Provider,{value:T},V):V}),[S,V,T])}var O=m?l.default.memo(_):_;if(O.WrappedComponent=t,O.displayName=_.displayName=a,I){var k=l.default.forwardRef((function(e,t){return l.default.createElement(O,(0,r.default)({},e,{reactReduxForwardedRef:t}))}));return k.displayName=a,k.WrappedComponent=t,(0,s.default)(k,t)}return(0,s.default)(O,t)}};var r=a(n(17)),o=a(n(868)),s=a(n(1504)),l=i(n(0)),c=n(1507),d=n(1359),u=n(1360),m=n(1313),h=["getDisplayName","methodName","renderCountProp","shouldHandleStateChanges","storeKey","withRef","forwardRef","context"],p=["reactReduxForwardedRef"],g=[],b=[null,null];function v(e,t){var n=e[1];return[t.payload,n+1]}function f(e,t,n){(0,u.useIsomorphicLayoutEffect)((function(){return e.apply(void 0,t)}),n)}function y(e,t,n,a,i,r,o){e.current=a,t.current=i,n.current=!1,r.current&&(r.current=null,o())}function E(e,t,n,a,i,r,o,s,l,c){if(e){var d=!1,u=null,m=function(){if(!d){var e,n,m=t.getState();try{e=a(m,i.current)}catch(e){n=e,u=e}n||(u=null),e===r.current?o.current||l():(r.current=e,s.current=e,o.current=!0,c({type:"STORE_UPDATED",payload:{error:n}}))}};n.onStateChange=m,n.trySubscribe(),m();return function(){if(d=!0,n.tryUnsubscribe(),n.onStateChange=null,u)throw u}}}var w=function(){return[null,0]}},1409:function(e,t,n){"use strict";function a(e,t){return e===t?0!==e||0!==t||1/e==1/t:e!=e&&t!=t}t.__esModule=!0,t.default=function(e,t){if(a(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var r=0;r<n.length;r++)if(!Object.prototype.hasOwnProperty.call(t,n[r])||!a(e[n[r]],t[n[r]]))return!1;return!0}},1410:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.getDependsOnOwnProps=i,t.wrapMapToPropsConstant=function(e){return function(t,n){var a=e(t,n);function i(){return a}return i.dependsOnOwnProps=!1,i}},t.wrapMapToPropsFunc=function(e,t){return function(t,n){n.displayName;var a=function(e,t){return a.dependsOnOwnProps?a.mapToProps(e,t):a.mapToProps(e)};return a.dependsOnOwnProps=!0,a.mapToProps=function(t,n){a.mapToProps=e,a.dependsOnOwnProps=i(e);var r=a(t,n);return"function"==typeof r&&(a.mapToProps=r,a.dependsOnOwnProps=i(r),r=a(t,n)),r},a}};a(n(1411));function i(e){return null!==e.dependsOnOwnProps&&void 0!==e.dependsOnOwnProps?Boolean(e.dependsOnOwnProps):1!==e.length}},1411:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.default=function(e,t,n){(0,i.default)(e)||(0,r.default)(n+"() in "+t+" must return a plain object. Instead received "+e+".")};var i=a(n(1512)),r=a(n(1412))},1412:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},1413:function(e,t,n){"use strict";t.__esModule=!0,t.createStoreHook=o,t.useStore=void 0;var a=n(0),i=n(1313),r=n(1414);function o(e){void 0===e&&(e=i.ReactReduxContext);var t=e===i.ReactReduxContext?r.useReduxContext:function(){return(0,a.useContext)(e)};return function(){return t().store}}var s=o();t.useStore=s},1414:function(e,t,n){"use strict";t.__esModule=!0,t.useReduxContext=function(){0;return(0,a.useContext)(i.ReactReduxContext)};var a=n(0),i=n(1313)},1415:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(13),i=n.n(a),r=n(4),o=n(0),s=n.n(o),l=n(21),c=n(28),d=n(663),u=n(279),m=n(10),h=n(38);const p=52;t.b=({hasAvatar:e,hasAvatarLabel:t,noAvatarLabel:n,setAvatarUrl:a,isUserAvatar:p,children:g,onClick:b})=>{var v;const f=Object(o.useContext)(l.a),[y,E]=Object(o.useState)(!1),[w,S]=Object(o.useState)(!1),[_,C]=Object(o.useState)(!1);Object(d.c)((()=>{C(!0)}),3e3),Object(d.c)((()=>{C(!1)}),13e3);const O=Object(o.useRef)(null),x=e||y?t:n,{room:k}=Object(o.useContext)(c.b);if(!(p||(null==k||null===(v=k.currentState)||void 0===v?void 0:v.maySendStateEvent(r.EventType.RoomAvatar,f.getSafeUserId()))))return s.a.createElement(s.a.Fragment,null,g);const R=!!x&&(w||_);return s.a.createElement(s.a.Fragment,null,s.a.createElement("input",{type:"file",ref:O,className:"mx_MiniAvatarUploader_input",onClick:e=>{Object(u.a)(e),null==b||b(e)},onChange:async e=>{var t;if(null===(t=e.target.files)||void 0===t||!t.length)return;E(!0);const n=e.target.files[0],{content_uri:i}=await f.uploadContent(n);await a(i),E(!1)},accept:"image/*"}),s.a.createElement(m.a,{className:i()("mx_MiniAvatarUploader",{mx_MiniAvatarUploader_busy:y,mx_MiniAvatarUploader_hasAvatar:e}),disabled:y,onClick:()=>{var e;null===(e=O.current)||void 0===e||e.click()},onMouseOver:()=>S(!0),onMouseLeave:()=>S(!1)},g,s.a.createElement("div",{className:"mx_MiniAvatarUploader_indicator"},y?s.a.createElement(h.a,{w:20,h:20}):s.a.createElement("div",{className:"mx_MiniAvatarUploader_cameraIcon"})),s.a.createElement("div",{className:i()("mx_Tooltip",{mx_Tooltip_visible:R,mx_Tooltip_invisible:!R})},s.a.createElement("div",{className:"mx_Tooltip_chevron"}),x)))}},1416:function(e,t){e.exports="img/user-onboarding/PersonalMessaging.b5ba3c4.png"},1417:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return s}));var a=n(2);let i=function(e){return e.Html="Html",e.PlainText="PlainText",e.Json="Json",e}({}),r=function(e){return e.Timeline="Timeline",e.Beginning="Beginning",e.LastNMessages="LastNMessages",e}({});const o=e=>{switch(e){case i.Html:return Object(a.b)("HTML");case i.Json:return Object(a.b)("JSON");case i.PlainText:return Object(a.b)("Plain Text");default:throw new Error("Unknown format")}},s=e=>{switch(e){case r.Beginning:return Object(a.b)("From the beginning");case r.LastNMessages:return Object(a.b)("Specify a number of messages");case r.Timeline:return Object(a.b)("Current Timeline");default:throw new Error("Unknown type: "+e)}}},1418:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(64),i=n(240);const r=e=>{if(!Object(i.a)(e.client))return{shouldEncrypt:!1};if(!a.a.shared().getRoomIds().has(e.roomId))return{shouldEncrypt:!1};if(1!==e.getInvitedAndJoinedMemberCount())return{shouldEncrypt:!1};const t=e.currentState.getStateEvents("m.room.third_party_invite")||[];return 1===t.length?{shouldEncrypt:!0,inviteEvent:t[0]}:{shouldEncrypt:!1}}},1419:function(e,t,n){var a=n(0);function i(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}function r(...e){return t=>e.forEach((e=>function(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}(e,t)))}function o(...e){return a.useCallback(r(...e),e)}i(e.exports,"composeRefs",(()=>r)),i(e.exports,"useComposedRefs",(()=>o))},1420:function(e,t,n){var a=n(17),i=n(0),r=n(103),o=n(1554);function s(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}s(e.exports,"Primitive",(()=>l)),s(e.exports,"Root",(()=>d)),s(e.exports,"dispatchDiscreteCustomEvent",(()=>c));const l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce(((e,t)=>{const n=i.forwardRef(((e,n)=>{const{asChild:r,...s}=e,l=r?o.Slot:t;return i.useEffect((()=>{window[Symbol.for("radix-ui")]=!0}),[]),i.createElement(l,((c=a)&&c.__esModule?c.default:c)({},s,{ref:n}));var c}));return n.displayName=`Primitive.${t}`,{...e,[t]:n}}),{});function c(e,t){e&&r.flushSync((()=>e.dispatchEvent(t)))}const d=l},1421:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 14",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{d:"M17 7H1m0 0l6 6M1 7l6-6",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"})))}},1422:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return r}));var a=n(221);const i=async(e,t,n,a)=>{a?(await e.setPushRuleActions("global",n,t,a),await e.setPushRuleEnabled("global",n,t,!0)):await e.setPushRuleEnabled("global",n,t,!1)},r=async(e,t,n)=>{const r=new a.a(e),o=null==t?void 0:t.map((e=>r.getPushRuleAndKindById(e))).filter((e=>Boolean(e)));if(null!=o&&o.length)for(const{kind:t,rule:a}of o)await i(e,a.rule_id,t,n)}},1423:function(e,t,n){"use strict";n.d(t,"a",(function(){return y})),n.d(t,"c",(function(){return E})),n.d(t,"b",(function(){return w}));var a=n(0),i=n.n(a),r=n(2),o=n(25),s=n(9),l=n(10),c=n(631),d=n(228),u=n(1424),m=n(14),h=n(5);const p=()=>{s.a.dispatch({action:m.a.PseudonymousAnalyticsAccept})},g=()=>{s.a.dispatch({action:m.a.PseudonymousAnalyticsReject})},b=()=>{Object(u.b)({onFinished:e=>{e===u.a.Primary&&p()},primaryButton:Object(r.b)("Enable")})},v=()=>{Object(u.b)({onFinished:e=>{e===u.a.Primary?p():e===u.a.Cancel&&g()},primaryButton:Object(r.b)("That's fine"),cancelButton:Object(r.b)("Stop")})},f="analytics";function y(){return o.b.get("privacy_policy_url")}const E=()=>{var e;const t=h.b.getValue("analyticsOptIn",null,!0);let n;if(t)n={description:Object(r.b)("You previously consented to share anonymous usage data with us. We're updating how that works."),acceptLabel:Object(r.b)("That's fine"),onAccept:p,rejectLabel:Object(r.b)("Learn more"),onReject:v};else{if(null!=t)return;{const e=e=>i.a.createElement(l.a,{kind:"link_inline",onClick:b},e);n={description:Object(r.b)("Share anonymous data to help us identify issues. Nothing personal. No third parties. <LearnMoreLink>Learn More</LearnMoreLink>",{},{LearnMoreLink:e}),acceptLabel:Object(r.b)("Yes"),onAccept:p,rejectLabel:Object(r.b)("No"),onReject:g}}}const a=null!==(e=o.b.get("analytics_owner"))&&void 0!==e?e:o.b.get().brand;d.a.sharedInstance().addOrReplaceToast({key:f,title:Object(r.b)("Help improve %(analyticsOwner)s",{analyticsOwner:a}),props:n,component:c.a,className:"mx_AnalyticsToast",priority:10})},w=()=>{d.a.sharedInstance().dismissToast(f)}},1424:function(e,t,n){"use strict";n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return v}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(34),l=n(2),c=n(60),d=n(11),u=n(25),m=n(1423),h=n(269);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}let g=function(e){return e[e.Primary=0]="Primary",e[e.Cancel=1]="Cancel",e}({});const b=({onFinished:e,analyticsOwner:t,privacyPolicyUrl:n,primaryButton:a,cancelButton:i,hasCancel:r})=>{const d=n?o.a.createElement("span",null,Object(l.b)("You can read all our terms <PrivacyPolicyUrl>here</PrivacyPolicyUrl>",{},{PrivacyPolicyUrl:e=>o.a.createElement(h.a,{href:n,rel:"norefferer noopener",target:"_blank"},e)})):"";return o.a.createElement(s.a,{className:"mx_AnalyticsLearnMoreDialog",contentId:"mx_AnalyticsLearnMore",title:Object(l.b)("Help improve %(analyticsOwner)s",{analyticsOwner:t}),onFinished:e},o.a.createElement("div",{className:"mx_Dialog_content"},o.a.createElement("div",{className:"mx_AnalyticsLearnMore_image_holder"}),o.a.createElement("div",{className:"mx_AnalyticsLearnMore_copy"},Object(l.b)("Help us identify issues and improve %(analyticsOwner)s by sharing anonymous usage data. To understand how people use multiple devices, we'll generate a random identifier, shared by your devices.",{analyticsOwner:t})),o.a.createElement("ul",{className:"mx_AnalyticsLearnMore_bullets"},o.a.createElement("li",null,Object(l.b)("We <Bold>don't</Bold> record or profile any account data",{},{Bold:e=>o.a.createElement("b",null,e)})),o.a.createElement("li",null,Object(l.b)("We <Bold>don't</Bold> share information with third parties",{},{Bold:e=>o.a.createElement("b",null,e)})),o.a.createElement("li",null,Object(l.b)("You can turn this off anytime in settings"))),d),o.a.createElement(c.a,{primaryButton:a,cancelButton:i,onPrimaryButtonClick:()=>e(g.Primary),onCancel:()=>e(g.Cancel),hasCancel:r}))},v=e=>{var t;const n=Object(m.a)(),a=null!==(t=u.b.get("analytics_owner"))&&void 0!==t?t:u.b.get("brand");d.b.createDialog(b,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({privacyPolicyUrl:n,analyticsOwner:a},e),"mx_AnalyticsLearnMoreDialog_wrapper")}},1425:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(2),l=n(5),c=n(38),d=n(417);class u extends o.a.Component{constructor(e){super(e),i()(this,"onSearchChange",(e=>{this.setState({searchQuery:e})})),this.state={searchQuery:"",langs:null}}componentDidMount(){if(s.e().then((e=>{e.sort((function(e,t){return e.label<t.label?-1:e.label>t.label?1:0})),this.setState({langs:e})})).catch((()=>{this.setState({langs:[{value:"en",label:"English"}]})})),!this.props.value){const e=s.i();this.props.onOptionChange(e)}}render(){if(null===this.state.langs)return o.a.createElement(c.a,null);let e;e=this.state.searchQuery?this.state.langs.filter((e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e))):this.state.langs;const t=e.map((e=>o.a.createElement("div",{key:e.value},e.label)));let n,a=l.b.getValue("language",null,!0);return a||(a=navigator.language||navigator.userLanguage),n=this.props.value||a,o.a.createElement(d.a,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this.onSearchChange,searchEnabled:!0,value:n,label:Object(s.b)("Language Dropdown"),disabled:this.props.disabled},t)}}},1426:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"b",(function(){return l})),n.d(t,"a",(function(){return c}));var a=n(2);const i=/^[0-9 -.]+$/;function r(e){return i.test(e)}const o=127462-"A".charCodeAt(0),s=/^[A-Z]{2}$/,l=e=>s.test(e)?String.fromCodePoint(...e.split("").map((e=>o+e.charCodeAt(0)))):"",c=[{iso2:"GB",name:Object(a.d)("United Kingdom"),prefix:"44"},{iso2:"US",name:Object(a.d)("United States"),prefix:"1"},{iso2:"AF",name:Object(a.d)("Afghanistan"),prefix:"93"},{iso2:"AX",name:Object(a.d)("Åland Islands"),prefix:"358"},{iso2:"AL",name:Object(a.d)("Albania"),prefix:"355"},{iso2:"DZ",name:Object(a.d)("Algeria"),prefix:"213"},{iso2:"AS",name:Object(a.d)("American Samoa"),prefix:"1"},{iso2:"AD",name:Object(a.d)("Andorra"),prefix:"376"},{iso2:"AO",name:Object(a.d)("Angola"),prefix:"244"},{iso2:"AI",name:Object(a.d)("Anguilla"),prefix:"1"},{iso2:"AQ",name:Object(a.d)("Antarctica"),prefix:"672"},{iso2:"AG",name:Object(a.d)("Antigua & Barbuda"),prefix:"1"},{iso2:"AR",name:Object(a.d)("Argentina"),prefix:"54"},{iso2:"AM",name:Object(a.d)("Armenia"),prefix:"374"},{iso2:"AW",name:Object(a.d)("Aruba"),prefix:"297"},{iso2:"AU",name:Object(a.d)("Australia"),prefix:"61"},{iso2:"AT",name:Object(a.d)("Austria"),prefix:"43"},{iso2:"AZ",name:Object(a.d)("Azerbaijan"),prefix:"994"},{iso2:"BS",name:Object(a.d)("Bahamas"),prefix:"1"},{iso2:"BH",name:Object(a.d)("Bahrain"),prefix:"973"},{iso2:"BD",name:Object(a.d)("Bangladesh"),prefix:"880"},{iso2:"BB",name:Object(a.d)("Barbados"),prefix:"1"},{iso2:"BY",name:Object(a.d)("Belarus"),prefix:"375"},{iso2:"BE",name:Object(a.d)("Belgium"),prefix:"32"},{iso2:"BZ",name:Object(a.d)("Belize"),prefix:"501"},{iso2:"BJ",name:Object(a.d)("Benin"),prefix:"229"},{iso2:"BM",name:Object(a.d)("Bermuda"),prefix:"1"},{iso2:"BT",name:Object(a.d)("Bhutan"),prefix:"975"},{iso2:"BO",name:Object(a.d)("Bolivia"),prefix:"591"},{iso2:"BA",name:Object(a.d)("Bosnia"),prefix:"387"},{iso2:"BW",name:Object(a.d)("Botswana"),prefix:"267"},{iso2:"BV",name:Object(a.d)("Bouvet Island"),prefix:"47"},{iso2:"BR",name:Object(a.d)("Brazil"),prefix:"55"},{iso2:"IO",name:Object(a.d)("British Indian Ocean Territory"),prefix:"246"},{iso2:"VG",name:Object(a.d)("British Virgin Islands"),prefix:"1"},{iso2:"BN",name:Object(a.d)("Brunei"),prefix:"673"},{iso2:"BG",name:Object(a.d)("Bulgaria"),prefix:"359"},{iso2:"BF",name:Object(a.d)("Burkina Faso"),prefix:"226"},{iso2:"BI",name:Object(a.d)("Burundi"),prefix:"257"},{iso2:"KH",name:Object(a.d)("Cambodia"),prefix:"855"},{iso2:"CM",name:Object(a.d)("Cameroon"),prefix:"237"},{iso2:"CA",name:Object(a.d)("Canada"),prefix:"1"},{iso2:"CV",name:Object(a.d)("Cape Verde"),prefix:"238"},{iso2:"BQ",name:Object(a.d)("Caribbean Netherlands"),prefix:"599"},{iso2:"KY",name:Object(a.d)("Cayman Islands"),prefix:"1"},{iso2:"CF",name:Object(a.d)("Central African Republic"),prefix:"236"},{iso2:"TD",name:Object(a.d)("Chad"),prefix:"235"},{iso2:"CL",name:Object(a.d)("Chile"),prefix:"56"},{iso2:"CN",name:Object(a.d)("China"),prefix:"86"},{iso2:"CX",name:Object(a.d)("Christmas Island"),prefix:"61"},{iso2:"CC",name:Object(a.d)("Cocos (Keeling) Islands"),prefix:"61"},{iso2:"CO",name:Object(a.d)("Colombia"),prefix:"57"},{iso2:"KM",name:Object(a.d)("Comoros"),prefix:"269"},{iso2:"CG",name:Object(a.d)("Congo - Brazzaville"),prefix:"242"},{iso2:"CD",name:Object(a.d)("Congo - Kinshasa"),prefix:"243"},{iso2:"CK",name:Object(a.d)("Cook Islands"),prefix:"682"},{iso2:"CR",name:Object(a.d)("Costa Rica"),prefix:"506"},{iso2:"HR",name:Object(a.d)("Croatia"),prefix:"385"},{iso2:"CU",name:Object(a.d)("Cuba"),prefix:"53"},{iso2:"CW",name:Object(a.d)("Curaçao"),prefix:"599"},{iso2:"CY",name:Object(a.d)("Cyprus"),prefix:"357"},{iso2:"CZ",name:Object(a.d)("Czech Republic"),prefix:"420"},{iso2:"CI",name:Object(a.d)("Côte d’Ivoire"),prefix:"225"},{iso2:"DK",name:Object(a.d)("Denmark"),prefix:"45"},{iso2:"DJ",name:Object(a.d)("Djibouti"),prefix:"253"},{iso2:"DM",name:Object(a.d)("Dominica"),prefix:"1"},{iso2:"DO",name:Object(a.d)("Dominican Republic"),prefix:"1"},{iso2:"EC",name:Object(a.d)("Ecuador"),prefix:"593"},{iso2:"EG",name:Object(a.d)("Egypt"),prefix:"20"},{iso2:"SV",name:Object(a.d)("El Salvador"),prefix:"503"},{iso2:"GQ",name:Object(a.d)("Equatorial Guinea"),prefix:"240"},{iso2:"ER",name:Object(a.d)("Eritrea"),prefix:"291"},{iso2:"EE",name:Object(a.d)("Estonia"),prefix:"372"},{iso2:"ET",name:Object(a.d)("Ethiopia"),prefix:"251"},{iso2:"FK",name:Object(a.d)("Falkland Islands"),prefix:"500"},{iso2:"FO",name:Object(a.d)("Faroe Islands"),prefix:"298"},{iso2:"FJ",name:Object(a.d)("Fiji"),prefix:"679"},{iso2:"FI",name:Object(a.d)("Finland"),prefix:"358"},{iso2:"FR",name:Object(a.d)("France"),prefix:"33"},{iso2:"GF",name:Object(a.d)("French Guiana"),prefix:"594"},{iso2:"PF",name:Object(a.d)("French Polynesia"),prefix:"689"},{iso2:"TF",name:Object(a.d)("French Southern Territories"),prefix:"262"},{iso2:"GA",name:Object(a.d)("Gabon"),prefix:"241"},{iso2:"GM",name:Object(a.d)("Gambia"),prefix:"220"},{iso2:"GE",name:Object(a.d)("Georgia"),prefix:"995"},{iso2:"DE",name:Object(a.d)("Germany"),prefix:"49"},{iso2:"GH",name:Object(a.d)("Ghana"),prefix:"233"},{iso2:"GI",name:Object(a.d)("Gibraltar"),prefix:"350"},{iso2:"GR",name:Object(a.d)("Greece"),prefix:"30"},{iso2:"GL",name:Object(a.d)("Greenland"),prefix:"299"},{iso2:"GD",name:Object(a.d)("Grenada"),prefix:"1"},{iso2:"GP",name:Object(a.d)("Guadeloupe"),prefix:"590"},{iso2:"GU",name:Object(a.d)("Guam"),prefix:"1"},{iso2:"GT",name:Object(a.d)("Guatemala"),prefix:"502"},{iso2:"GG",name:Object(a.d)("Guernsey"),prefix:"44"},{iso2:"GN",name:Object(a.d)("Guinea"),prefix:"224"},{iso2:"GW",name:Object(a.d)("Guinea-Bissau"),prefix:"245"},{iso2:"GY",name:Object(a.d)("Guyana"),prefix:"592"},{iso2:"HT",name:Object(a.d)("Haiti"),prefix:"509"},{iso2:"HM",name:Object(a.d)("Heard & McDonald Islands"),prefix:"672"},{iso2:"HN",name:Object(a.d)("Honduras"),prefix:"504"},{iso2:"HK",name:Object(a.d)("Hong Kong"),prefix:"852"},{iso2:"HU",name:Object(a.d)("Hungary"),prefix:"36"},{iso2:"IS",name:Object(a.d)("Iceland"),prefix:"354"},{iso2:"IN",name:Object(a.d)("India"),prefix:"91"},{iso2:"ID",name:Object(a.d)("Indonesia"),prefix:"62"},{iso2:"IR",name:Object(a.d)("Iran"),prefix:"98"},{iso2:"IQ",name:Object(a.d)("Iraq"),prefix:"964"},{iso2:"IE",name:Object(a.d)("Ireland"),prefix:"353"},{iso2:"IM",name:Object(a.d)("Isle of Man"),prefix:"44"},{iso2:"IL",name:Object(a.d)("Israel"),prefix:"972"},{iso2:"IT",name:Object(a.d)("Italy"),prefix:"39"},{iso2:"JM",name:Object(a.d)("Jamaica"),prefix:"1"},{iso2:"JP",name:Object(a.d)("Japan"),prefix:"81"},{iso2:"JE",name:Object(a.d)("Jersey"),prefix:"44"},{iso2:"JO",name:Object(a.d)("Jordan"),prefix:"962"},{iso2:"KZ",name:Object(a.d)("Kazakhstan"),prefix:"7"},{iso2:"KE",name:Object(a.d)("Kenya"),prefix:"254"},{iso2:"KI",name:Object(a.d)("Kiribati"),prefix:"686"},{iso2:"XK",name:Object(a.d)("Kosovo"),prefix:"383"},{iso2:"KW",name:Object(a.d)("Kuwait"),prefix:"965"},{iso2:"KG",name:Object(a.d)("Kyrgyzstan"),prefix:"996"},{iso2:"LA",name:Object(a.d)("Laos"),prefix:"856"},{iso2:"LV",name:Object(a.d)("Latvia"),prefix:"371"},{iso2:"LB",name:Object(a.d)("Lebanon"),prefix:"961"},{iso2:"LS",name:Object(a.d)("Lesotho"),prefix:"266"},{iso2:"LR",name:Object(a.d)("Liberia"),prefix:"231"},{iso2:"LY",name:Object(a.d)("Libya"),prefix:"218"},{iso2:"LI",name:Object(a.d)("Liechtenstein"),prefix:"423"},{iso2:"LT",name:Object(a.d)("Lithuania"),prefix:"370"},{iso2:"LU",name:Object(a.d)("Luxembourg"),prefix:"352"},{iso2:"MO",name:Object(a.d)("Macau"),prefix:"853"},{iso2:"MK",name:Object(a.d)("Macedonia"),prefix:"389"},{iso2:"MG",name:Object(a.d)("Madagascar"),prefix:"261"},{iso2:"MW",name:Object(a.d)("Malawi"),prefix:"265"},{iso2:"MY",name:Object(a.d)("Malaysia"),prefix:"60"},{iso2:"MV",name:Object(a.d)("Maldives"),prefix:"960"},{iso2:"ML",name:Object(a.d)("Mali"),prefix:"223"},{iso2:"MT",name:Object(a.d)("Malta"),prefix:"356"},{iso2:"MH",name:Object(a.d)("Marshall Islands"),prefix:"692"},{iso2:"MQ",name:Object(a.d)("Martinique"),prefix:"596"},{iso2:"MR",name:Object(a.d)("Mauritania"),prefix:"222"},{iso2:"MU",name:Object(a.d)("Mauritius"),prefix:"230"},{iso2:"YT",name:Object(a.d)("Mayotte"),prefix:"262"},{iso2:"MX",name:Object(a.d)("Mexico"),prefix:"52"},{iso2:"FM",name:Object(a.d)("Micronesia"),prefix:"691"},{iso2:"MD",name:Object(a.d)("Moldova"),prefix:"373"},{iso2:"MC",name:Object(a.d)("Monaco"),prefix:"377"},{iso2:"MN",name:Object(a.d)("Mongolia"),prefix:"976"},{iso2:"ME",name:Object(a.d)("Montenegro"),prefix:"382"},{iso2:"MS",name:Object(a.d)("Montserrat"),prefix:"1"},{iso2:"MA",name:Object(a.d)("Morocco"),prefix:"212"},{iso2:"MZ",name:Object(a.d)("Mozambique"),prefix:"258"},{iso2:"MM",name:Object(a.d)("Myanmar"),prefix:"95"},{iso2:"NA",name:Object(a.d)("Namibia"),prefix:"264"},{iso2:"NR",name:Object(a.d)("Nauru"),prefix:"674"},{iso2:"NP",name:Object(a.d)("Nepal"),prefix:"977"},{iso2:"NL",name:Object(a.d)("Netherlands"),prefix:"31"},{iso2:"NC",name:Object(a.d)("New Caledonia"),prefix:"687"},{iso2:"NZ",name:Object(a.d)("New Zealand"),prefix:"64"},{iso2:"NI",name:Object(a.d)("Nicaragua"),prefix:"505"},{iso2:"NE",name:Object(a.d)("Niger"),prefix:"227"},{iso2:"NG",name:Object(a.d)("Nigeria"),prefix:"234"},{iso2:"NU",name:Object(a.d)("Niue"),prefix:"683"},{iso2:"NF",name:Object(a.d)("Norfolk Island"),prefix:"672"},{iso2:"KP",name:Object(a.d)("North Korea"),prefix:"850"},{iso2:"MP",name:Object(a.d)("Northern Mariana Islands"),prefix:"1"},{iso2:"NO",name:Object(a.d)("Norway"),prefix:"47"},{iso2:"OM",name:Object(a.d)("Oman"),prefix:"968"},{iso2:"PK",name:Object(a.d)("Pakistan"),prefix:"92"},{iso2:"PW",name:Object(a.d)("Palau"),prefix:"680"},{iso2:"PS",name:Object(a.d)("Palestine"),prefix:"970"},{iso2:"PA",name:Object(a.d)("Panama"),prefix:"507"},{iso2:"PG",name:Object(a.d)("Papua New Guinea"),prefix:"675"},{iso2:"PY",name:Object(a.d)("Paraguay"),prefix:"595"},{iso2:"PE",name:Object(a.d)("Peru"),prefix:"51"},{iso2:"PH",name:Object(a.d)("Philippines"),prefix:"63"},{iso2:"PN",name:Object(a.d)("Pitcairn Islands"),prefix:"870"},{iso2:"PL",name:Object(a.d)("Poland"),prefix:"48"},{iso2:"PT",name:Object(a.d)("Portugal"),prefix:"351"},{iso2:"PR",name:Object(a.d)("Puerto Rico"),prefix:"1"},{iso2:"QA",name:Object(a.d)("Qatar"),prefix:"974"},{iso2:"RO",name:Object(a.d)("Romania"),prefix:"40"},{iso2:"RU",name:Object(a.d)("Russia"),prefix:"7"},{iso2:"RW",name:Object(a.d)("Rwanda"),prefix:"250"},{iso2:"RE",name:Object(a.d)("Réunion"),prefix:"262"},{iso2:"WS",name:Object(a.d)("Samoa"),prefix:"685"},{iso2:"SM",name:Object(a.d)("San Marino"),prefix:"378"},{iso2:"SA",name:Object(a.d)("Saudi Arabia"),prefix:"966"},{iso2:"SN",name:Object(a.d)("Senegal"),prefix:"221"},{iso2:"RS",name:Object(a.d)("Serbia"),prefix:"381 p"},{iso2:"SC",name:Object(a.d)("Seychelles"),prefix:"248"},{iso2:"SL",name:Object(a.d)("Sierra Leone"),prefix:"232"},{iso2:"SG",name:Object(a.d)("Singapore"),prefix:"65"},{iso2:"SX",name:Object(a.d)("Sint Maarten"),prefix:"1"},{iso2:"SK",name:Object(a.d)("Slovakia"),prefix:"421"},{iso2:"SI",name:Object(a.d)("Slovenia"),prefix:"386"},{iso2:"SB",name:Object(a.d)("Solomon Islands"),prefix:"677"},{iso2:"SO",name:Object(a.d)("Somalia"),prefix:"252"},{iso2:"ZA",name:Object(a.d)("South Africa"),prefix:"27"},{iso2:"GS",name:Object(a.d)("South Georgia & South Sandwich Islands"),prefix:"500"},{iso2:"KR",name:Object(a.d)("South Korea"),prefix:"82"},{iso2:"SS",name:Object(a.d)("South Sudan"),prefix:"211"},{iso2:"ES",name:Object(a.d)("Spain"),prefix:"34"},{iso2:"LK",name:Object(a.d)("Sri Lanka"),prefix:"94"},{iso2:"BL",name:Object(a.d)("St. Barthélemy"),prefix:"590"},{iso2:"SH",name:Object(a.d)("St. Helena"),prefix:"290 n"},{iso2:"KN",name:Object(a.d)("St. Kitts & Nevis"),prefix:"1"},{iso2:"LC",name:Object(a.d)("St. Lucia"),prefix:"1"},{iso2:"MF",name:Object(a.d)("St. Martin"),prefix:"590"},{iso2:"PM",name:Object(a.d)("St. Pierre & Miquelon"),prefix:"508"},{iso2:"VC",name:Object(a.d)("St. Vincent & Grenadines"),prefix:"1"},{iso2:"SD",name:Object(a.d)("Sudan"),prefix:"249"},{iso2:"SR",name:Object(a.d)("Suriname"),prefix:"597"},{iso2:"SJ",name:Object(a.d)("Svalbard & Jan Mayen"),prefix:"47"},{iso2:"SZ",name:Object(a.d)("Swaziland"),prefix:"268"},{iso2:"SE",name:Object(a.d)("Sweden"),prefix:"46"},{iso2:"CH",name:Object(a.d)("Switzerland"),prefix:"41"},{iso2:"SY",name:Object(a.d)("Syria"),prefix:"963"},{iso2:"ST",name:Object(a.d)("São Tomé & Príncipe"),prefix:"239"},{iso2:"TW",name:Object(a.d)("Taiwan"),prefix:"886"},{iso2:"TJ",name:Object(a.d)("Tajikistan"),prefix:"992"},{iso2:"TZ",name:Object(a.d)("Tanzania"),prefix:"255"},{iso2:"TH",name:Object(a.d)("Thailand"),prefix:"66"},{iso2:"TL",name:Object(a.d)("Timor-Leste"),prefix:"670"},{iso2:"TG",name:Object(a.d)("Togo"),prefix:"228"},{iso2:"TK",name:Object(a.d)("Tokelau"),prefix:"690"},{iso2:"TO",name:Object(a.d)("Tonga"),prefix:"676"},{iso2:"TT",name:Object(a.d)("Trinidad & Tobago"),prefix:"1"},{iso2:"TN",name:Object(a.d)("Tunisia"),prefix:"216"},{iso2:"TR",name:Object(a.d)("Turkey"),prefix:"90"},{iso2:"TM",name:Object(a.d)("Turkmenistan"),prefix:"993"},{iso2:"TC",name:Object(a.d)("Turks & Caicos Islands"),prefix:"1"},{iso2:"TV",name:Object(a.d)("Tuvalu"),prefix:"688"},{iso2:"VI",name:Object(a.d)("U.S. Virgin Islands"),prefix:"1"},{iso2:"UG",name:Object(a.d)("Uganda"),prefix:"256"},{iso2:"UA",name:Object(a.d)("Ukraine"),prefix:"380"},{iso2:"AE",name:Object(a.d)("United Arab Emirates"),prefix:"971"},{iso2:"UY",name:Object(a.d)("Uruguay"),prefix:"598"},{iso2:"UZ",name:Object(a.d)("Uzbekistan"),prefix:"998"},{iso2:"VU",name:Object(a.d)("Vanuatu"),prefix:"678"},{iso2:"VA",name:Object(a.d)("Vatican City"),prefix:"39"},{iso2:"VE",name:Object(a.d)("Venezuela"),prefix:"58"},{iso2:"VN",name:Object(a.d)("Vietnam"),prefix:"84"},{iso2:"WF",name:Object(a.d)("Wallis & Futuna"),prefix:"681"},{iso2:"EH",name:Object(a.d)("Western Sahara"),prefix:"212"},{iso2:"YE",name:Object(a.d)("Yemen"),prefix:"967"},{iso2:"ZM",name:Object(a.d)("Zambia"),prefix:"260"},{iso2:"ZW",name:Object(a.d)("Zimbabwe"),prefix:"263"}]},1427:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var a=n(1),i=n.n(a),r=n(121),o=n(3),s=n(6),l=n(1342),c=n(12);const d=new r.UnstableValue("http.v1","org.matrix.msc3886.http.v1");class u{constructor({onFailure:e,client:t,fallbackRzServer:n,fetchFn:a}){i()(this,"uri",void 0),i()(this,"etag",void 0),i()(this,"expiresAt",void 0),i()(this,"client",void 0),i()(this,"fallbackRzServer",void 0),i()(this,"fetchFn",void 0),i()(this,"cancelled",!1),i()(this,"_ready",!1),i()(this,"onFailure",void 0),this.fetchFn=a,this.onFailure=e,this.client=t,this.fallbackRzServer=n}get ready(){return this._ready}async details(){if(!this.uri)throw new Error("Rendezvous not set up");return{type:d.name,uri:this.uri}}fetch(t,n){return this.fetchFn?this.fetchFn(t,n):e.fetch(t,n)}async getPostEndpoint(){try{if(await this.client.doesServerSupportUnstableFeature("org.matrix.msc3886"))return`${this.client.baseUrl}${c.a.Unstable}/org.matrix.msc3886/rendezvous`}catch(e){o.a.warn("Failed to get unstable features",e)}return this.fallbackRzServer}async send(e){var t,n;if(this.cancelled)return;const a=this.uri?"PUT":"POST",i=null!==(t=this.uri)&&void 0!==t?t:await this.getPostEndpoint();if(!i)throw new Error("Invalid rendezvous URI");const r={"content-type":"application/json"};this.etag&&(r["if-match"]=this.etag);const o=await this.fetch(i,{method:a,headers:r,body:JSON.stringify(e)});if(404===o.status)return this.cancel(l.c.Unknown);if(this.etag=null!==(n=o.headers.get("etag"))&&void 0!==n?n:void 0,"POST"===a){var s;const e=o.headers.get("location");if(!e)throw new Error("No rendezvous URI given");const t=o.headers.get("expires");t&&(this.expiresAt=new Date(t));const n=null!==(s=o.url)&&void 0!==s?s:i;this.uri=new URL(e,`${n}${n.endsWith("/")?"":"/"}`).href,this._ready=!0}}async receive(){if(!this.uri)throw new Error("Rendezvous not set up");for(;;){if(this.cancelled)return;const n={};this.etag&&(n["if-none-match"]=this.etag);const a=await this.fetch(this.uri,{method:"GET",headers:n});if(404===a.status)return void this.cancel(l.c.Unknown);var e;if("application/json"!==a.headers.get("content-type"))this.etag=null!==(e=a.headers.get("etag"))&&void 0!==e?e:void 0;else if(200===a.status){var t;return this.etag=null!==(t=a.headers.get("etag"))&&void 0!==t?t:void 0,a.json()}await Object(s.N)(1e3)}}async cancel(e){var t;if(e===l.c.Unknown&&this.expiresAt&&this.expiresAt.getTime()<Date.now()&&(e=l.c.Expired),this.cancelled=!0,this._ready=!1,null===(t=this.onFailure)||void 0===t||t.call(this,e),this.uri&&e===l.c.UserDeclined)try{await this.fetch(this.uri,{method:"DELETE"})}catch(e){o.a.warn(e)}}}}).call(this,n(80))},1428:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var a=n(1),i=n.n(a),r=n(1342),o=n(26),s=n(118),l=n(683);const c=new(n(59).c)("m.rendezvous.v2.curve25519-aes-sha256","org.matrix.msc3903.rendezvous.v2.curve25519-aes-sha256");class d{constructor(t,n,a){this.transport=t,this.theirPublicKey=n,this.onFailure=a,i()(this,"olmSAS",void 0),i()(this,"ourPublicKey",void 0),i()(this,"aesKey",void 0),i()(this,"connected",!1),this.olmSAS=new e.Olm.SAS,this.ourPublicKey=Object(o.decodeBase64)(this.olmSAS.get_pubkey())}async generateCode(e){if(this.transport.ready)throw new Error("Code already generated");await this.transport.send({algorithm:c.name});return{rendezvous:{algorithm:c.name,key:Object(o.encodeUnpaddedBase64)(this.ourPublicKey),transport:await this.transport.details()},intent:e}}async connect(){if(this.connected)throw new Error("Channel already connected");if(!this.olmSAS)throw new Error("Channel closed");const e=!this.theirPublicKey;if(e){const e=await this.transport.receive();if(!e)throw new Error("No response from other device");const t=e,{key:n,algorithm:a}=t;if(!a||!c.matches(a)||!n)throw new r.b("Unsupported algorithm: "+a,r.c.UnsupportedAlgorithm);this.theirPublicKey=Object(o.decodeBase64)(n)}else await this.transport.send({algorithm:c.name,key:Object(o.encodeUnpaddedBase64)(this.ourPublicKey)});this.connected=!0,this.olmSAS.set_their_key(Object(o.encodeUnpaddedBase64)(this.theirPublicKey));const t=e?this.ourPublicKey:this.theirPublicKey,n=e?this.theirPublicKey:this.ourPublicKey;let a=c.name;a+=`|${Object(o.encodeUnpaddedBase64)(t)}`,a+=`|${Object(o.encodeUnpaddedBase64)(n)}`;const i=this.olmSAS.generate_bytes(a,32);this.aesKey=await async function(e){if(!s.c)throw new Error("Web Crypto is not available");return s.c.importKey("raw",e,{name:"AES-GCM"},!1,["encrypt","decrypt"])}(i),i.fill(0);const d=this.olmSAS.generate_bytes(a,5);return Object(l.a)(Array.from(d)).join("-")}async encrypt(e){if(!s.c)throw new Error("Web Crypto is not available");const t=new Uint8Array(32);s.b.getRandomValues(t);const n=(new s.a).encode(JSON.stringify(e)),a=await s.c.encrypt({name:"AES-GCM",iv:t,tagLength:128},this.aesKey,n);return{iv:Object(o.encodeUnpaddedBase64)(t),ciphertext:Object(o.encodeUnpaddedBase64)(a)}}async send(e){if(!this.olmSAS)throw new Error("Channel closed");if(!this.aesKey)throw new Error("Shared secret not set up");return this.transport.send(await this.encrypt(e))}async decrypt({iv:e,ciphertext:t}){if(!t||!e)throw new Error("Missing ciphertext and/or iv");const n=Object(o.decodeBase64)(t);if(!s.c)throw new Error("Web Crypto is not available");const a=await s.c.decrypt({name:"AES-GCM",iv:Object(o.decodeBase64)(e),tagLength:128},this.aesKey,n);return JSON.parse((new TextDecoder).decode(new Uint8Array(a)))}async receive(){if(!this.olmSAS)throw new Error("Channel closed");if(!this.aesKey)throw new Error("Shared secret not set up");const e=await this.transport.receive();if(!e)return;const t=e;if(t.ciphertext&&t.iv)return this.decrypt(t);throw new Error("Data received but no ciphertext")}async close(){this.olmSAS&&(this.olmSAS.free(),this.olmSAS=void 0)}async cancel(e){try{await this.transport.cancel(e)}finally{await this.close()}}}}).call(this,n(80))},1429:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(0),i=n.n(a);class r extends i.a.PureComponent{render(){return i.a.createElement("div",{className:"mx_CompleteSecurityBody"},this.props.children)}}},1430:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(0),i=n.n(a),r=n(25),o=n(2),s=n(5),l=n(75),c=n(15),d=n(1425);function u(e){var t;Object(o.f)()!==e&&(s.b.setValue("language",null,c.a.DEVICE,e),null===(t=l.a.get())||void 0===t||t.reload())}function m({disabled:e}){return r.b.get("disable_login_language_selector")?i.a.createElement("div",null):i.a.createElement(d.a,{className:"mx_AuthBody_language",onOptionChange:u,value:Object(o.f)(),disabled:e})}},1437:function(e,t,n){"use strict";n.d(t,"b",(function(){return v})),n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return y})),n.d(t,"d",(function(){return E}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(1342),l=n(1427),c=n(1428),d=n(3),u=n(2),m=n(11),h=n(416);function p(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?p(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):p(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var b=n(1560);let v=function(e){return e.Show="show",e}({}),f=function(e){return e[e.Loading=0]="Loading",e[e.ShowingQR=1]="ShowingQR",e[e.Connecting=2]="Connecting",e[e.Connected=3]="Connected",e[e.WaitingForDevice=4]="WaitingForDevice",e[e.Verifying=5]="Verifying",e[e.Error=6]="Error",e}({}),y=function(e){return e[e.Cancel=0]="Cancel",e[e.Decline=1]="Decline",e[e.Approve=2]="Approve",e[e.TryAgain=3]="TryAgain",e[e.Back=4]="Back",e}({});class E extends o.a.Component{constructor(e){super(e),i()(this,"approveLogin",(async()=>{if(!this.state.rendezvous)throw new Error("Rendezvous not found");this.setState({phase:f.Loading});try{d.a.info("Requesting login token");const{login_token:n}=await(e=this.props.client.requestLoginToken,t={matrixClient:this.props.client,title:Object(u.b)("Sign in new device")},async function(...n){return new Promise(((a,i)=>{const r=e.bind(t.matrixClient);r(void 0,...n).then((e=>a(e))).catch((e=>{var o;if(401!==e.httpStatus||null===(o=e.data)||void 0===o||!o.flows)return i(e);m.b.createDialog(h.a,g(g({},t),{},{authData:e.data,makeRequest:e=>r(e,...n),onFinished:(e,t)=>{e?a(t):i(t)}}))}))}))})();this.setState({phase:f.WaitingForDevice});if(!await this.state.rendezvous.approveLoginOnExistingDevice(n))return;if(!this.props.client.crypto)return void this.props.onFinished(!0);this.setState({phase:f.Verifying}),await this.state.rendezvous.verifyNewDeviceOnExistingDevice(),this.props.onFinished(!0)}catch(e){d.a.error("Error whilst approving sign in",e),this.setState({phase:f.Error,failureReason:s.c.Unknown})}var e,t})),i()(this,"generateCode",(async()=>{let e;try{const t=new l.a({onFailure:this.onFailure,client:this.props.client}),n=new c.a(t,void 0,this.onFailure);e=new s.a(n,this.props.client,this.onFailure),await e.generateCode(),this.setState({phase:f.ShowingQR,rendezvous:e,failureReason:void 0})}catch(e){return d.a.error("Error whilst generating QR code",e),void this.setState({phase:f.Error,failureReason:s.c.HomeserverLacksSupport})}try{const t=await e.startAfterShowingCode();this.setState({phase:f.Connected,confirmationDigits:t})}catch(e){d.a.error("Error whilst doing QR login",e),this.state.phase!==f.Error&&this.setState({phase:f.Error,failureReason:s.c.Unknown})}})),i()(this,"onFailure",(e=>{d.a.info(`Rendezvous failed: ${e}`),this.setState({phase:f.Error,failureReason:e})})),i()(this,"onClick",(async e=>{var t,n,a;switch(e){case y.Cancel:await(null===(t=this.state.rendezvous)||void 0===t?void 0:t.cancel(s.c.UserCancelled)),this.reset(),this.props.onFinished(!1);break;case y.Approve:await this.approveLogin();break;case y.Decline:await(null===(n=this.state.rendezvous)||void 0===n?void 0:n.declineLoginOnExistingDevice()),this.reset(),this.props.onFinished(!1);break;case y.TryAgain:this.reset(),await this.updateMode(this.props.mode);break;case y.Back:await(null===(a=this.state.rendezvous)||void 0===a?void 0:a.cancel(s.c.UserCancelled)),this.props.onFinished(!1)}})),this.state={phase:f.Loading}}componentDidMount(){this.updateMode(this.props.mode).then((()=>{}))}componentDidUpdate(e){e.mode!==this.props.mode&&this.updateMode(this.props.mode).then((()=>{}))}async updateMode(e){if(this.setState({phase:f.Loading}),this.state.rendezvous){const e=this.state.rendezvous;e.onFailure=void 0,await e.cancel(s.c.UserCancelled),this.setState({rendezvous:void 0})}e===v.Show&&await this.generateCode()}componentWillUnmount(){this.state.rendezvous&&(this.state.rendezvous.onFailure=void 0,this.state.rendezvous.cancel(s.c.UserCancelled).then((()=>{})))}reset(){this.setState({rendezvous:void 0,confirmationDigits:void 0,failureReason:void 0})}render(){var e;return o.a.createElement(b.a,{onClick:this.onClick,phase:this.state.phase,code:this.state.phase===f.ShowingQR?null===(e=this.state.rendezvous)||void 0===e?void 0:e.code:void 0,confirmationDigits:this.state.phase===f.Connected?this.state.confirmationDigits:void 0,failureReason:this.state.phase===f.Error?this.state.failureReason:void 0})}}},1438:function(e,t,n){"use strict";n.d(t,"b",(function(){return j}));var a,i=n(1),r=n.n(i),o=n(0),s=n.n(o);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}function c(e){return o.createElement("svg",l({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=o.createElement("path",{d:"M20.28 7.9l-7-5.833a2 2 0 00-2.56 0l-7 5.833A2 2 0 003 9.437V20.5a2 2 0 002 2h2a2 2 0 002-2V16a2 2 0 012-2h2a2 2 0 012 2v4.5a2 2 0 002 2h2a2 2 0 002-2V9.437a2 2 0 00-.72-1.537z",fill:"currentColor"})))}var d,u,m,h=n(1403),p=n(1404);function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},g.apply(this,arguments)}function b(e){return o.createElement("svg",g({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),d||(d=o.createElement("mask",{id:"hash-circle_svg__a",fill:"#fff"},o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 17A8 8 0 109 1a8 8 0 000 16zM8.34 5.156A.75.75 0 006.848 5l-.16 1.531H5.656a.75.75 0 000 1.5h.875L6.328 9.97h-.937a.75.75 0 000 1.5h.78l-.151 1.453a.75.75 0 101.492.156l.168-1.61H9.5l-.152 1.454a.75.75 0 101.492.156l.168-1.61h1.289a.75.75 0 000-1.5h-1.132l.202-1.937h.93a.75.75 0 000-1.5h-.773l.144-1.375A.75.75 0 1010.176 5l-.16 1.531h-1.82l.144-1.375zM9.657 9.97h-1.82l.202-1.938h1.82L9.657 9.97z"}))),u||(u=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M9 17A8 8 0 109 1a8 8 0 000 16zM8.34 5.156A.75.75 0 006.848 5l-.16 1.531H5.656a.75.75 0 000 1.5h.875L6.328 9.97h-.937a.75.75 0 000 1.5h.78l-.151 1.453a.75.75 0 101.492.156l.168-1.61H9.5l-.152 1.454a.75.75 0 101.492.156l.168-1.61h1.289a.75.75 0 000-1.5h-1.132l.202-1.937h.93a.75.75 0 000-1.5h-.773l.144-1.375A.75.75 0 1010.176 5l-.16 1.531h-1.82l.144-1.375zM9.657 9.97h-1.82l.202-1.938h1.82L9.657 9.97z",fill:"currentColor"})),m||(m=o.createElement("path",{d:"M7.672 4.332l-.139 1.326.139-1.326zm.668.824l1.326.139-1.326-.139zM6.848 5l-1.326-.138L6.848 5zm-.16 1.531v1.334h1.201l.125-1.195-1.326-.139zm-.157 1.5l1.326.139.154-1.472H6.53v1.333zM6.328 9.97v1.333H7.53l.125-1.195-1.327-.138zm-.156 1.5l1.326.138.154-1.471h-1.48v1.333zm-.152 1.453l-1.326-.139 1.326.14zm.668.824l.138-1.326-.138 1.326zm.824-.668l1.326.139-1.326-.139zm.168-1.61v-1.332H6.479l-.125 1.194 1.326.139zm1.82 0l1.326.14.154-1.473H9.5v1.334zm-.152 1.454l1.326.139-1.326-.139zm.668.824l.138-1.326-.138 1.326zm.824-.668l1.326.139-1.326-.139zm.168-1.61v-1.332H9.807l-.125 1.194 1.326.139zm.157-1.5L9.839 9.83l-.154 1.472h1.48V9.97zm.202-1.937V6.698h-1.201l-.125 1.195 1.326.138zm.157-1.5l-1.326-.138-.154 1.472h1.48V6.53zm.144-1.375l-1.326-.138 1.326.138zM11 4.332l.139-1.326-.14 1.326zM10.176 5L8.85 4.862 10.176 5zm-.16 1.531v1.334h1.201l.125-1.195-1.326-.139zm-1.82 0L6.87 6.393l-.154 1.472h1.48V6.53zm-.36 3.438L6.51 9.83l-.153 1.472h1.48V9.97zm1.82 0v1.333h1.202l.125-1.195-1.326-.138zM8.04 8.03V6.698H6.838l-.125 1.195 1.326.138zm1.82 0l1.326.139.154-1.472H9.86v1.333zM15.667 9A6.667 6.667 0 019 15.667v2.666A9.333 9.333 0 0018.333 9h-2.666zM9 2.333A6.667 6.667 0 0115.667 9h2.666A9.333 9.333 0 009-.333v2.666zM2.333 9A6.667 6.667 0 019 2.333V-.333A9.333 9.333 0 00-.333 9h2.666zM9 15.667A6.667 6.667 0 012.333 9H-.333A9.333 9.333 0 009 18.333v-2.666zM7.533 5.658a.583.583 0 01-.52-.64l2.653.277A2.083 2.083 0 007.81 3.006l-.277 2.652zm.64-.52a.583.583 0 01-.64.52l.277-2.652a2.083 2.083 0 00-2.288 1.856l2.652.277zm-.16 1.532l.16-1.531-2.651-.277-.16 1.53 2.652.278zM5.657 7.865h1.032V5.198H5.656v2.667zm.584-.584a.583.583 0 01-.584.584V5.198c-1.15 0-2.083.933-2.083 2.083H6.24zm-.584-.583c.322 0 .584.261.584.583H3.573c0 1.15.933 2.084 2.083 2.084V6.698zm.875 0h-.875v2.667h.875V6.698zm1.124 3.41l.202-1.938-2.652-.277-.203 1.937 2.653.277zM5.39 11.301h.937V8.635h-.937v2.667zm.583-.583a.583.583 0 01-.583.583V8.635c-1.151 0-2.084.933-2.084 2.084h2.667zm-.583-.583c.322 0 .583.26.583.583H3.307c0 1.15.933 2.083 2.084 2.083v-2.666zm.78 0h-.78v2.666h.78v-2.666zm1.175 2.925l.152-1.454-2.652-.277-.152 1.454 2.652.277zm-.52-.641c.32.033.553.32.52.64l-2.652-.277a2.083 2.083 0 001.855 2.29l.277-2.653zm-.64.52a.583.583 0 01.64-.52l-.277 2.652a2.083 2.083 0 002.289-1.855l-2.653-.278zm.168-1.61l-.169 1.61 2.653.277.168-1.61-2.652-.277zM9.5 10.136H7.68v2.666H9.5v-2.666zm1.174 2.925l.152-1.454-2.652-.277-.152 1.454 2.652.277zm-.52-.641c.32.033.553.32.52.64l-2.652-.277a2.083 2.083 0 001.855 2.29l.277-2.653zm-.64.52a.583.583 0 01.64-.52l-.277 2.652a2.083 2.083 0 002.289-1.855l-2.652-.278zm.168-1.61l-.168 1.61 2.652.277.168-1.61-2.652-.277zm2.615-1.194h-1.29v2.666h1.29v-2.666zm-.584.583c0-.322.262-.583.584-.583v2.666c1.15 0 2.083-.933 2.083-2.083h-2.667zm.584.583a.583.583 0 01-.584-.583h2.667c0-1.15-.933-2.084-2.083-2.084v2.667zm-1.132 0h1.132V8.635h-1.132v2.667zm-1.124-3.41L9.84 9.83l2.652.277.202-1.937-2.652-.277zm2.256-1.194h-.93v2.667h.93V6.698zm-.584.583c0-.322.262-.583.584-.583v2.667c1.15 0 2.083-.933 2.083-2.084h-2.667zm.584.584a.583.583 0 01-.584-.584h2.667c0-1.15-.933-2.083-2.083-2.083v2.667zm-.773 0h.773V5.198h-.773v2.667zm-1.182-2.847l-.144 1.375 2.652.277.144-1.375-2.652-.277zm.52.64a.583.583 0 01-.52-.64l2.652.277a2.083 2.083 0 00-1.855-2.289l-.278 2.652zm.64-.52a.583.583 0 01-.64.52l.277-2.652a2.083 2.083 0 00-2.29 1.856l2.653.277zm-.16 1.532l.16-1.531-2.652-.277-.16 1.53 2.652.278zM8.196 7.865h1.82V5.198h-1.82v2.667zM7.014 5.018L6.87 6.393l2.652.277.144-1.375-2.652-.277zm.823 6.284h1.82V8.635h-1.82v2.667zm-1.124-3.41L6.51 9.83l2.653.277.202-1.937-2.652-.277zm3.146-1.194H8.04v2.667h1.82V6.698zm1.124 3.41l.202-1.938-2.652-.277L8.33 9.83l2.653.277z",fill:"currentColor",mask:"url(#hash-circle_svg__a)"})))}var v=n(2),f=n(5),y=n(15),E=n(161),w=n(182),S=n(23),_=n(113),C=n(168),O=n(154),x=n(218);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function R(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){r()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const j=(e,t)=>async n=>{const a=f.b.getValue("Spaces.enabledMetaSpaces");await f.b.setValue("Spaces.enabledMetaSpaces",null,y.a.ACCOUNT,R(R({},a),{},{[e]:n.target.checked})),_.b.trackInteraction(t,n,[S.a.Home,null,S.a.Favourites,S.a.People,S.a.Orphans].indexOf(e))};t.a=()=>{const{[S.a.Home]:e,[S.a.Favourites]:t,[S.a.People]:n,[S.a.Orphans]:a}=Object(w.b)("Spaces.enabledMetaSpaces"),i=Object(w.b)("Spaces.allRoomsInHome");return s.a.createElement(C.a,null,s.a.createElement(O.a,{heading:Object(v.b)("Sidebar")},s.a.createElement(x.b,{heading:Object(v.b)("Spaces to show"),description:Object(v.b)("Spaces are ways to group rooms and people. Alongside the spaces you're in, you can use some pre-built ones too.")},s.a.createElement(E.b,{checked:!!e,onChange:j(S.a.Home,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox",disabled:e},s.a.createElement(x.a,null,s.a.createElement(c,null),Object(v.b)("Home")),s.a.createElement(x.a,null,Object(v.b)("Home is useful for getting an overview of everything."))),s.a.createElement(E.b,{checked:i,disabled:!e,onChange:async e=>{await f.b.setValue("Spaces.allRoomsInHome",null,y.a.ACCOUNT,e.target.checked),_.b.trackInteraction("WebSettingsSidebarTabSpacesCheckbox",e,1)},className:"mx_SidebarUserSettingsTab_checkbox mx_SidebarUserSettingsTab_homeAllRoomsCheckbox","data-testid":"mx_SidebarUserSettingsTab_homeAllRoomsCheckbox"},s.a.createElement(x.a,null,Object(v.b)("Show all rooms")),s.a.createElement(x.a,null,Object(v.b)("Show all your rooms in Home, even if they're in a space."))),s.a.createElement(E.b,{checked:!!t,onChange:j(S.a.Favourites,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},s.a.createElement(x.a,null,s.a.createElement(h.a,null),Object(v.b)("Favourites")),s.a.createElement(x.a,null,Object(v.b)("Group all your favourite rooms and people in one place."))),s.a.createElement(E.b,{checked:!!n,onChange:j(S.a.People,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},s.a.createElement(x.a,null,s.a.createElement(p.a,null),Object(v.b)("People")),s.a.createElement(x.a,null,Object(v.b)("Group all your people in one place."))),s.a.createElement(E.b,{checked:!!a,onChange:j(S.a.Orphans,"WebSettingsSidebarTabSpacesCheckbox"),className:"mx_SidebarUserSettingsTab_checkbox"},s.a.createElement(x.a,null,s.a.createElement(b,null),Object(v.b)("Rooms outside of a space")),s.a.createElement(x.a,null,Object(v.b)("Group all your rooms that aren't part of a space in one place."))))))}},1441:function(e,t,n){"use strict";n.d(t,"b",(function(){return h})),n.d(t,"a",(function(){return p}));var a=n(1),i=n.n(a),r=n(398),o=(n(118),n(3)),s=n(94),l=n(144),c=n(325);function d(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?d(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):d(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const m=()=>`openid urn:matrix:org.matrix.msc2967.client:api:* urn:matrix:org.matrix.msc2967.client:device:${Object(s.b)(10)}`,h=async(e,t,n,a)=>{const i=window.location.origin,o=Object(s.b)(10),l=await(async({metadata:e,redirectUri:t,clientId:n,homeserverUrl:a,identityServerUrl:i,nonce:o})=>{const s=await m(),l=new r.OidcClient(u(u({},e),{},{client_id:n,redirect_uri:t,authority:e.issuer,response_mode:"query",response_type:"code",scope:s,stateStore:new r.WebStorageStateStore({prefix:"mx_oidc_",store:window.sessionStorage})})),c={homeserverUrl:a,nonce:o,identityServerUrl:i};return(await l.createSigninRequest({state:c,nonce:o})).url})({metadata:e.metadata,redirectUri:i,clientId:t,homeserverUrl:n,identityServerUrl:a,nonce:o});window.location.href=l},p=async e=>{const{code:t,state:n}=(e=>{const t=e.code,n=e.state;if(!t||"string"!=typeof t||!n||"string"!=typeof n)throw new Error("Invalid query parameters for OIDC native login. `code` and `state` are required.");return{code:t,state:n}})(e),{homeserverUrl:a,tokenResponse:i,identityServerUrl:s,oidcClientSettings:d}=await(async(e,t)=>{const n=new URL(window.location.origin);n.searchParams.append("code",e),n.searchParams.append("state",t),r.Log.setLogger(o.a);try{const e=new r.SigninResponse(n.searchParams),t=new r.WebStorageStateStore({prefix:"mx_oidc_",store:window.sessionStorage}),a=await t.get(e.state);if(!a)throw new Error(l.a.MissingOrInvalidStoredState);const i=r.SigninState.fromStorageString(a),o=new r.OidcClient(u(u({},i),{},{stateStore:t})),s=await o.processSigninResponse(n.href),d=s.userState;Object(c.e)(d),Object(c.b)(s),Object(c.c)(s.id_token,o.settings.authority,o.settings.client_id,d.nonce);const m=(e=>({id_token:e.id_token,scope:e.scope,expires_at:e.expires_at,refresh_token:e.refresh_token,access_token:e.access_token,token_type:"Bearer"}))(s);return{oidcClientSettings:{clientId:o.settings.client_id,issuer:o.settings.authority},tokenResponse:m,homeserverUrl:d.homeserverUrl,identityServerUrl:d.identityServerUrl}}catch(e){o.a.error("Oidc login failed",e);const t=e.message;if(Object.values(l.a).includes(t))throw e;throw new Error(l.a.CodeExchangeFailed)}})(t,n);return{homeserverUrl:a,identityServerUrl:s,accessToken:i.access_token,clientId:d.clientId,issuer:d.issuer}}},1442:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(1),i=n.n(a),r=n(24),o=n.n(r),s=n(0),l=n.n(s),c=n(51),d=n(2),u=n(64);const m=["room","component"];function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e){let{room:t,component:n}=e,a=o()(e,m);const i=function(e){const t=u.a.shared().getUserIdForRoomId(e.roomId),n=e.getMembers().length>2;if(!e.isSpaceRoom()&&t&&!n)return{details:t};const[a,i,...r]=c.a.instance.getKnownParents(e.roomId);if(i&&(null==r||!r.length)){var o,s;const t=null===(o=e.client.getRoom(a))||void 0===o?void 0:o.name,n=null===(s=e.client.getRoom(i))||void 0===s?void 0:s.name;return{details:Object(d.b)("%(space1Name)s and %(space2Name)s",{space1Name:t,space2Name:n}),ariaLabel:Object(d.b)("In spaces %(space1Name)s and %(space2Name)s.",{space1Name:t,space2Name:n})}}if(a){var l;const t=null===(l=e.client.getRoom(a))||void 0===l?void 0:l.name,n=r.length;return{details:Object(d.b)("%(spaceName)s and %(count)s others",{spaceName:t,count:n}),ariaLabel:Object(d.b)("In %(spaceName)s and %(count)s other spaces.",{spaceName:t,count:n})}}return{details:e.getCanonicalAlias()}}(t);return i?l.a.createElement(null!=n?n:"div",p(p({},a),{},{"aria-label":i.ariaLabel}),[i.details]):l.a.createElement(l.a.Fragment,null)}},1443:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(10),o=n(2),s=n(270),l=n(25),c=n(11),d=n(1),u=n.n(d),m=n(420),h=n(3),p=n(1318),g=n(34),b=n(46),v=n(335),f=n(229),y=n(269);class E extends i.a.PureComponent{constructor(e){super(e),u()(this,"defaultServer",void 0),u()(this,"fieldRef",Object(a.createRef)()),u()(this,"validatedConf",void 0),u()(this,"onDefaultChosen",(()=>{this.setState({defaultChosen:!0})})),u()(this,"onOtherChosen",(()=>{this.setState({defaultChosen:!1})})),u()(this,"onHomeserverChange",(e=>{this.setState({otherHomeserver:e.target.value})})),u()(this,"validate",Object(f.a)({deriveData:async({value:e})=>{let t=(null!=e?e:"").trim();if(!t.includes("://"))try{const e=await m.a.findClientConfig(t);return this.validatedConf=p.a.buildValidatedConfigFromDiscovery(t,e),{}}catch(e){h.a.error(`Attempted ${t} as a server_name but it failed`,e)}t.includes("://")||(t="https://"+t);try{return this.validatedConf=await p.a.validateServerConfigWithStaticUrls(t),{}}catch(e){h.a.error(e);if(p.a.authComponentStateForError(e).serverErrorIsFatal){let t=Object(o.b)("Unable to validate homeserver");return e instanceof o.a&&e.translatedMessage&&(t=e.translatedMessage),{error:t}}try{return this.validatedConf=await p.a.validateServerConfigWithStaticUrls(t,void 0,!0),{}}catch(e){return h.a.error(e),{error:Object(o.b)("Invalid URL")}}}},rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(o.b)("Specify a homeserver")},{key:"valid",test:async function({value:e},{error:t}){return!e||!t},invalid:function({error:e}){return null!=e?e:null}}]})),u()(this,"onHomeserverValidate",(e=>this.validate(e))),u()(this,"onSubmit",(async e=>{var t;if(e.preventDefault(),this.state.defaultChosen)return void this.props.onFinished(this.defaultServer);var n,a;if(!await(null===(t=this.fieldRef.current)||void 0===t?void 0:t.validate({allowEmpty:!1})))return null===(n=this.fieldRef.current)||void 0===n||n.focus(),void(null===(a=this.fieldRef.current)||void 0===a||a.validate({allowEmpty:!1,focused:!0}));this.props.onFinished(this.validatedConf)}));const t=l.b.get();this.defaultServer=t.validated_server_config;const{serverConfig:n}=this.props;let i="";n.isDefault||(i=n.isNameResolvable&&n.hsName?n.hsName:n.hsUrl),this.state={defaultChosen:n.isDefault,otherHomeserver:i}}render(){let e;"matrix.org"===this.defaultServer.hsName&&(e=Object(o.b)("Matrix.org is the biggest public homeserver in the world, so it's a good place for many."));let t=this.defaultServer.hsName;return this.defaultServer.hsNameIsDifferent&&(t=i.a.createElement(s.a,{class:"mx_Login_underlinedServerName",tooltip:this.defaultServer.hsUrl},this.defaultServer.hsName)),i.a.createElement(g.a,{title:this.props.title||Object(o.b)("Sign into your homeserver"),className:"mx_ServerPickerDialog",contentId:"mx_ServerPickerDialog",onFinished:this.props.onFinished,fixedWidth:!1,hasCancel:!0},i.a.createElement("form",{className:"mx_Dialog_content",id:"mx_ServerPickerDialog",onSubmit:this.onSubmit},i.a.createElement("p",null,Object(o.b)("We call the places where you can host your account 'homeservers'.")," ",e),i.a.createElement(v.a,{name:"defaultChosen",value:"true",checked:this.state.defaultChosen,onChange:this.onDefaultChosen,"data-testid":"defaultHomeserver"},t),i.a.createElement(v.a,{name:"defaultChosen",value:"false",className:"mx_ServerPickerDialog_otherHomeserverRadio",checked:!this.state.defaultChosen,onChange:this.onOtherChosen,childrenInLabel:!1,"aria-label":Object(o.b)("Other homeserver")},i.a.createElement(b.a,{type:"text",className:"mx_ServerPickerDialog_otherHomeserver",label:Object(o.b)("Other homeserver"),onChange:this.onHomeserverChange,onFocus:this.onOtherChosen,ref:this.fieldRef,onValidate:this.onHomeserverValidate,value:this.state.otherHomeserver,validateOnChange:!1,validateOnFocus:!1,autoFocus:!0,id:"mx_homeserverInput"})),i.a.createElement("p",null,Object(o.b)("Use your preferred Matrix homeserver if you have one, or host your own.")),i.a.createElement(r.a,{className:"mx_ServerPickerDialog_continue",kind:"primary",onClick:this.onSubmit},Object(o.b)("Continue")),i.a.createElement("h2",null,Object(o.b)("Learn more")),i.a.createElement(y.a,{href:"https://matrix.org/faq/#what-is-a-homeserver%3F",target:"_blank",rel:"noreferrer noopener"},Object(o.b)("About homeservers"))))}}var w=n(129);const S=()=>{const e=l.b.get().brand;c.b.createDialog(w.a,{title:Object(o.b)("Server Options"),description:Object(o.b)("You can use the custom server options to sign into other Matrix servers by specifying a different homeserver URL. This allows you to use %(brand)s with an existing Matrix account on a different homeserver.",{brand:e}),button:Object(o.b)("Dismiss"),hasCloseButton:!1,fixedWidth:!1},"mx_ServerPicker_helpDialog")};t.a=({title:e,dialogTitle:t,serverConfig:n,onServerConfigChange:a})=>{const d=l.b.get("disable_custom_urls");let u;if(!d&&a){const e=()=>{((e,t,n)=>{c.b.createDialog(E,{title:e,serverConfig:t,onFinished:n})})(t,n,(e=>{e&&a(e)}))};u=i.a.createElement(r.a,{className:"mx_ServerPicker_change",kind:"link",onClick:e},Object(o.b)("Edit"))}let m,h=n.isNameResolvable?n.hsName:n.hsUrl;return n.hsNameIsDifferent&&(h=i.a.createElement(s.a,{class:"mx_Login_underlinedServerName",tooltip:n.hsUrl},n.hsName)),"matrix.org"===n.hsName&&(m=i.a.createElement("span",{className:"mx_ServerPicker_desc"},Object(o.b)("Join millions for free on the largest public server"))),i.a.createElement("div",{className:"mx_ServerPicker"},i.a.createElement("h2",null,e||Object(o.b)("Homeserver")),d?null:i.a.createElement(r.a,{className:"mx_ServerPicker_help",onClick:S,"aria-label":Object(o.b)("Help")}),i.a.createElement("span",{className:"mx_ServerPicker_server",title:"string"==typeof h?h:void 0},h),u,m)}},1444:function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(13),l=n.n(s),c=n(4),d=n(3),u=n(2),m=n(9),h=n(14),p=n(1394),g=n(484);class b extends g.a{constructor(...e){super(...e),i()(this,"onClick",(e=>{e.preventDefault()}))}wrapImage(e,t){return t}render(){if(this.state.error)return super.render();const e=this.props.mxEvent.getContent(),t=this.state.contentUrl?this.messageContent(this.state.contentUrl,this.state.thumbUrl,e,44):void 0;return o.a.createElement("div",{className:"mx_MImageReplyBody"},t)}}var v=n(97),f=n(1354),y=n(241),E=n(116),w=n(790),S=n(633),_=n(7);function C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?C(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):C(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class x extends o.a.PureComponent{constructor(...e){super(...e),i()(this,"anchorElement",Object(r.createRef)()),i()(this,"onDecrypted",(()=>{this.forceUpdate(),this.props.onHeightChanged&&this.props.onHeightChanged()})),i()(this,"onEventRequiresUpdate",(()=>{this.forceUpdate()})),i()(this,"onClick",(e=>{const t=e.target;"a"===t.tagName.toLowerCase()&&null!==t.closest("a")&&t!==this.anchorElement.current||(e.preventDefault(),this.props.toggleExpandedQuote&&e.shiftKey?this.props.toggleExpandedQuote():m.a.dispatch({action:h.a.ViewRoom,event_id:this.props.mxEvent.getId(),highlighted:!0,room_id:this.props.mxEvent.getRoomId(),metricsTrigger:void 0}))}))}componentDidMount(){this.props.mxEvent.on(c.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.on(c.MatrixEventEvent.BeforeRedaction,this.onEventRequiresUpdate),this.props.mxEvent.on(c.MatrixEventEvent.Replaced,this.onEventRequiresUpdate)}componentWillUnmount(){this.props.mxEvent.removeListener(c.MatrixEventEvent.Decrypted,this.onDecrypted),this.props.mxEvent.removeListener(c.MatrixEventEvent.BeforeRedaction,this.onEventRequiresUpdate),this.props.mxEvent.removeListener(c.MatrixEventEvent.Replaced,this.onEventRequiresUpdate)}render(){const e=this.props.mxEvent,t=e.getContent().msgtype,n=e.getType(),{hasRenderer:a,isInfoMessage:i,isSeeingThroughMessageHiddenForModeration:r}=Object(f.a)(_.a.safeGet(),e,!1);if(!a){const{mxEvent:e}=this.props;return d.a.warn(`Event type not supported: type:${e.getType()} isState:${e.isState()}`),o.a.createElement("div",{className:"mx_ReplyTile mx_ReplyTile_info mx_MNoticeBody"},Object(u.b)("This event could not be displayed"))}const s=l()("mx_ReplyTile",{mx_ReplyTile_inline:t===c.MsgType.Emote,mx_ReplyTile_info:i&&!e.isRedacted(),mx_ReplyTile_audio:t===c.MsgType.Audio,mx_ReplyTile_video:t===c.MsgType.Video});let m,h="#";this.props.permalinkCreator&&(h=this.props.permalinkCreator.forEvent(e.getId()));i||n===c.EventType.RoomCreate||(m=o.a.createElement("div",{className:"mx_ReplyTile_sender"},o.a.createElement(E.b,{member:e.sender,fallbackUserId:e.getSender(),width:16,height:16}),o.a.createElement(p.a,{mxEvent:e})));const g={[c.MsgType.Image]:b,[c.MsgType.Audio]:Object(v.m)(e)?w.a:y.a,[c.MsgType.Video]:y.a},C={[c.EventType.Sticker]:b};return o.a.createElement("div",{className:s},o.a.createElement("a",{href:h,onClick:this.onClick,ref:this.anchorElement},m,Object(S.f)(O(O({},this.props),{},{ref:void 0,showUrlPreview:!1,overrideBodyTypes:g,overrideEventTypes:C,maxImageHeight:96,isSeeingThroughMessageHiddenForModeration:r,highlights:this.props.highlights,highlightLink:this.props.highlightLink,onHeightChanged:this.props.onHeightChanged,permalinkCreator:this.props.permalinkCreator}),!1)))}}i()(x,"defaultProps",{onHeightChanged:()=>{}})},1471:function(e,t,n){"use strict";(function(e){var t=n(4);if(e.__js_sdk_entrypoint)throw new Error("Multiple matrix-js-sdk entrypoints detected!");let a;e.__js_sdk_entrypoint=!0;try{a=e.indexedDB}catch(e){}a&&t.setCryptoStoreFactory((()=>new t.IndexedDBCryptoStore(a,"matrix-js-sdk:crypto")));e.matrixcs=t}).call(this,n(80))},1472:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(3),o=n(7),s=n(9),l=n(281);var c=function(e){return e.Online="online",e.Offline="offline",e.Unavailable="unavailable",e}(c||{});t.a=new class{constructor(){i()(this,"unavailableTimer",null),i()(this,"dispatcherRef",null),i()(this,"state",null),i()(this,"onAction",(e=>{var t;"user_activity"===e.action&&(this.setState(c.Online),null===(t=this.unavailableTimer)||void 0===t||t.restart())}))}async start(){for(this.unavailableTimer=new l.a(18e4),this.dispatcherRef=s.a.register(this.onAction);this.unavailableTimer;)try{await this.unavailableTimer.finished(),this.setState(c.Unavailable)}catch(e){}}stop(){this.dispatcherRef&&(s.a.unregister(this.dispatcherRef),this.dispatcherRef=null),this.unavailableTimer&&(this.unavailableTimer.abort(),this.unavailableTimer=null)}getState(){return this.state}async setState(e){if(e===this.state)return;const t=this.state;if(this.state=e,!o.a.safeGet().isGuest())try{await o.a.safeGet().setPresence({presence:this.state}),r.a.debug("Presence:",e)}catch(e){r.a.error("Failed to set presence:",e),this.state=t}}}},1473:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 3.05v6.22C2 15.63 9 17 9 17s7-1.37 7-7.73V3.05L9 1 2 3.05zm9.94 2.47c.19-.18.49-.17.67.02.16.18.16.45.02.63l-4.22 5.11-.03.04c-.28.34-.79.39-1.13.11a.29.29 0 01-.077-.067.912.912 0 00-.023-.023L5.34 9.26c-.2-.24-.18-.6.06-.8.2-.18.49-.18.7-.04l1.57 1.1 4.27-4z",fill:"#010101"})))}t.default="img/e2e/verified-deprecated.85c94e6.svg"},1474:function(e,t,n){"use strict";t.a={}},1475:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(77),o=n(2),s=n(25);t.a=e=>{const t=s.b.get().brand,n=Object(o.b)("%(brand)s now uses 3-5x less memory, by only loading information about other users when needed. Please wait whilst we resynchronise with the server!",{brand:t});return i.a.createElement(r.a,{hasCancelButton:!1,title:Object(o.b)("Updating %(brand)s",{brand:t}),description:i.a.createElement("div",null,n),button:Object(o.b)("OK"),onFinished:e.onFinished})}},1476:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(77),o=n(2),s=n(25);t.a=e=>{const t=s.b.get().brand,n=Object(o.b)("You've previously used %(brand)s on %(host)s with lazy loading of members enabled. In this version lazy loading is disabled. As the local cache is not compatible between these two settings, %(brand)s needs to resync your account.",{brand:t,host:e.host}),a=Object(o.b)("If the other version of %(brand)s is still open in another tab, please close it as using %(brand)s on the same host with both lazy loading enabled and disabled simultaneously will cause issues.",{brand:t});return i.a.createElement(r.a,{hasCancelButton:!1,title:Object(o.b)("Incompatible local cache"),description:i.a.createElement("div",null,i.a.createElement("p",null,n),i.a.createElement("p",null,a)),button:Object(o.b)("Clear cache and resync"),onFinished:e.onFinished})}},1477:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(25),l=n(11),c=n(2),d=n(77),u=n(272),m=n(34),h=n(60);class p extends o.a.Component{constructor(...e){super(...e),i()(this,"sendBugReport",(()=>{l.b.createDialog(u.a,{error:this.props.error})})),i()(this,"onClearStorageClick",(()=>{l.b.createDialog(d.a,{title:Object(c.b)("Sign out"),description:o.a.createElement("div",null,Object(c.b)("Sign out and remove encryption keys?")),button:Object(c.b)("Sign out"),danger:!0,onFinished:this.props.onFinished})})),i()(this,"onRefreshClick",(()=>{window.location.reload()}))}render(){const e=s.b.get().brand,t=o.a.createElement("button",{onClick:this.onClearStorageClick,className:"danger"},Object(c.b)("Clear Storage and Sign Out"));let n;return n=s.b.get().bug_report_endpoint_url?o.a.createElement(h.a,{primaryButton:Object(c.b)("Send Logs"),onPrimaryButtonClick:this.sendBugReport,focus:!0,hasCancel:!1},t):o.a.createElement(h.a,{primaryButton:Object(c.b)("Refresh"),onPrimaryButtonClick:this.onRefreshClick,focus:!0,hasCancel:!1},t),o.a.createElement(m.a,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:Object(c.b)("Unable to restore session"),contentId:"mx_Dialog_content",hasCancel:!1},o.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},o.a.createElement("p",null,Object(c.b)("We encountered an error trying to restore your previous session.")),o.a.createElement("p",null,Object(c.b)("If you have previously used a more recent version of %(brand)s, your session may be incompatible with this version. Close this window and return to the more recent version.",{brand:e})),o.a.createElement("p",null,Object(c.b)("Clearing your browser's storage may fix the problem, but will sign you out and cause any encrypted chat history to become unreadable."))),n)}}},1478:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(25),l=n(11),c=n(2),d=n(34),u=n(60),m=n(272),h=n(10);class p extends o.a.Component{constructor(...e){super(...e),i()(this,"sendBugReport",(e=>{e.preventDefault(),l.b.createDialog(m.a,{})})),i()(this,"onSignOutClick",(()=>{this.props.onFinished(!0)}))}render(){let e;return s.b.get().bug_report_endpoint_url&&(e=Object(c.b)("To help us prevent this in future, please <a>send us logs</a>.",{},{a:e=>o.a.createElement(h.a,{kind:"link_inline",onClick:this.sendBugReport},e)})),o.a.createElement(d.a,{className:"mx_ErrorDialog",onFinished:this.props.onFinished,title:Object(c.b)("Missing session data"),contentId:"mx_Dialog_content",hasCancel:!1},o.a.createElement("div",{className:"mx_Dialog_content",id:"mx_Dialog_content"},o.a.createElement("p",null,Object(c.b)("Some session data, including encrypted message keys, is missing. Sign out and sign in to fix this, restoring keys from backup.")),o.a.createElement("p",null,Object(c.b)("Your browser likely removed this data when running low on disk space.")," ",e)),o.a.createElement(u.a,{primaryButton:Object(c.b)("Sign out"),onPrimaryButtonClick:this.onSignOutClick,focus:!0,hasCancel:!1}))}}},1479:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({viewBox:"-1 -1 13 13",xmlns:"http://www.w3.org/2000/svg",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("g",{stroke:"#4A4A4A",strokeWidth:2.82,strokeLinecap:"square",fill:"none",fillRule:"evenodd"},i.createElement("path",{d:"M6 2.229V9.77M2.229 6H9.77"}))))}t.default="img/plus.e8a5e12.svg"},1480:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return Ye}));var a=n(17),i=n.n(a),r=n(1),o=n.n(r),s=n(0),l=n.n(s),c=n(4),d=n(65),u=n(186),m=n(6),h=n(3),p=n(39),g=n(47),b=(n(1481),n(1482),n(113)),v=n(1398),f=n(7),y=n(75),E=n(25),w=n(9),S=n(336),_=n(11),C=n(219),O=n(238),x=n(1327),k=(n(1483),n(1484),n(435)),R=n(117),j=n(2),I=n(5),T=n(480),P=n(1400),N=n(637),D=n(1485),M=n(1318),A=n(64),L=n(650),U=n(456),F=n(317),B=n(228),V=n(647),W=n(1586),z=n(14),H=n(1423),G=n(666),K=n(31),q=n(130),$=n(15),Y=n(1393),J=n(40),Q=n(1558),X=n(1559),Z=n(1330),ee=n(61),te=n(19),ne=n(239),ae=n(38),ie=n(77),re=n(1587),oe=n(466),se=n(1563),le=n(1591),ce=n(1564),de=n(1593),ue=n(1588),me=n(1594),he=n(1595),pe=n(1596),ge=n(640),be=n(1573),ve=n(1597),fe=n(119),ye=n(1598),Ee=n(45),we=n(131),Se=n(107),_e=n(660),Ce=n(93),Oe=n(184),xe=n(10),ke=n(207),Re=n(258),je=n(652),Ie=n(133),Te=n(74),Pe=n(123),Ne=n(28),De=n(1592),Me=n(146),Ae=n(50),Le=n(1574),Ue=n(69),Fe=n(631),Be=n(1401),Ve=n(175),We=n(98),ze=n(49),He=n(1575);function Ge(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ge(Object(n),!0).forEach((function(t){o()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ge(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const qe=["register","login","forgot_password","start_sso","start_cas","welcome"],$e=[z.a.ViewUserSettings,"view_create_chat","view_create_room"];class Ye extends l.a.PureComponent{constructor(t){if(super(t),o()(this,"firstSyncComplete",!1),o()(this,"firstSyncPromise",void 0),o()(this,"screenAfterLogin",void 0),o()(this,"tokenLogin",void 0),o()(this,"focusComposer",void 0),o()(this,"subTitleStatus",void 0),o()(this,"prevWindowWidth",void 0),o()(this,"voiceBroadcastResumer",void 0),o()(this,"loggedInView",void 0),o()(this,"dispatcherRef",void 0),o()(this,"themeWatcher",void 0),o()(this,"fontWatcher",void 0),o()(this,"stores",void 0),o()(this,"onWindowResized",(()=>{this.warnInConsole()})),o()(this,"warnInConsole",Object(p.throttle)((()=>{const t="15px",n=Object(j.b)("Wait!"),a=Object(j.b)("If someone told you to copy/paste something here, there is a high likelihood you're being scammed!"),i=Object(j.b)("If you know what you're doing, Element is open-source, be sure to check out our GitHub (https://github.com/vector-im/element-web/) and contribute!");e.mx_rage_logger.bypassRageshake("log",`%c${n}\n%c${a}\n%c${i}`,"font-size:50px; color:blue;",`font-size:${t}; color:red;`,`font-size:${t};`)}),1e3)),o()(this,"onAction",(e=>{var t;if(null!==(t=f.a.get())&&void 0!==t&&t.isGuest()&&$e.includes(e.action))return w.a.dispatch({action:z.a.DoAfterSyncPrepared,deferred_action:e}),void w.a.dispatch({action:"require_registration"});switch(e.action){case"MatrixActions.accountData":if("m.identity_server"===e.event_type){const t=e.event_content?e.event_content.base_url:null;t?(f.a.safeGet().setIdentityServerUrl(t),localStorage.removeItem("mx_is_access_token"),localStorage.setItem("mx_is_url",t)):(f.a.safeGet().setIdentityServerUrl(void 0),localStorage.removeItem("mx_is_access_token"),localStorage.removeItem("mx_is_url")),w.a.dispatch({action:"id_server_changed"})}break;case"logout":Ce.b.instance.hangupAllCalls(),Promise.all([...[...Ie.a.instance.activeCalls].map((e=>e.disconnect())),Object(Ue.D)(this.stores)]).finally((()=>x.i()));break;case"require_registration":Object(P.b)(e);break;case"start_registration":if(x.g()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.startRegistration(e.params||{});break;case"start_login":if(x.g()){this.onSoftLogout();break}e.screenAfterLogin&&(this.screenAfterLogin=e.screenAfterLogin),this.viewLogin();break;case"start_password_recovery":this.setStateForNewView({view:ke.a.FORGOT_PASSWORD}),this.notifyNewScreen("forgot_password");break;case"start_chat":Object(R.c)(f.a.safeGet(),{dmUserId:e.user_id});break;case"leave_room":this.leaveRoom(e.room_id);break;case"forget_room":this.forgetRoom(e.room_id);break;case"copy_room":this.copyRoom(e.room_id);break;case"reject_invite":_.b.createDialog(ie.a,{title:Object(j.b)("Reject invitation"),description:Object(j.b)("Are you sure you want to reject the invitation?"),onFinished:t=>{if(t){const t=_.b.createDialog(ae.a,void 0,"mx_Dialog_spinner");f.a.safeGet().leave(e.room_id).then((()=>{t.close(),this.state.currentRoomId===e.room_id&&w.a.dispatch({action:z.a.ViewHomePage})}),(e=>{t.close(),_.b.createDialog(K.a,{title:Object(j.b)("Failed to reject invitation"),description:e.toString()})}))}}});break;case"view_user_info":this.viewUser(e.userId,e.subAction);break;case"MatrixActions.RoomState.events":{const t=e.event;t.getType()===c.EventType.RoomCanonicalAlias&&t.getRoomId()===this.state.currentRoomId&&this.viewRoom({action:z.a.ViewRoom,room_id:this.state.currentRoomId,metricsTrigger:void 0});break}case z.a.ViewRoom:{const t=this.viewRoom(e);e.deferred_action&&t.then((()=>{w.a.dispatch(e.deferred_action)}));break}case z.a.ViewUserDeviceSettings:Object(Le.a)();break;case z.a.ViewUserSettings:{const t=e;_.b.createDialog(re.a,{initialTabId:t.initialTabId},void 0,!1,!0),this.viewSomethingBehindModal();break}case"view_create_room":this.createRoom(e.public,e.defaultName,e.type),this.viewSomethingBehindModal();break;case z.a.ViewRoomDirectory:_.b.createDialog(Be.b,{initialText:e.initialText,initialFilter:Be.a.PublicRooms},"mx_SpotlightDialog_wrapper",!1,!0),this.viewSomethingBehindModal();break;case"view_welcome_page":this.viewWelcome();break;case z.a.ViewHomePage:this.viewHome(e.justRegistered);break;case z.a.ViewStartChatOrReuse:this.chatCreateOrReuse(e.user_id);break;case"view_create_chat":Object(C.f)(e.initialText||""),this.viewSomethingBehindModal();break;case"view_invite":{const t=f.a.safeGet().getRoom(e.roomId);null!=t&&t.isSpaceRoom()?Object(Oe.i)(t):Object(C.e)(e.roomId);break}case"view_last_screen":this.showScreenAfterLogin();break;case"hide_left_panel":this.setState({collapseLhs:!0},(()=>{this.state.resizeNotifier.notifyLeftHandleResized()}));break;case"show_left_panel":this.setState({collapseLhs:!1},(()=>{this.state.resizeNotifier.notifyLeftHandleResized()}));break;case z.a.OpenDialPad:_.b.createDialog(Q.a,{},"mx_Dialog_dialPadWrapper");break;case z.a.OnLoggedIn:this.stores.client=f.a.safeGet(),this.tokenLogin||x.g()||this.state.view===ke.a.LOGIN||this.state.view===ke.a.REGISTER||this.state.view===ke.a.COMPLETE_SECURITY||this.state.view===ke.a.E2E_SETUP||this.state.view===ke.a.USE_CASE_SELECTION||this.onLoggedIn();break;case"on_client_not_viable":this.onSoftLogout();break;case z.a.OnLoggedOut:this.onLoggedOut();break;case"will_start_client":this.setState({ready:!1},(()=>{this.onWillStartClient()}));break;case"client_started":this.onClientStarted();break;case"send_event":this.onSendEvent(e.room_id,e.event);break;case"aria_hide_main_app":this.setState({hideToSRUsers:!0});break;case"aria_unhide_main_app":this.setState({hideToSRUsers:!1});break;case z.a.PseudonymousAnalyticsAccept:Object(H.b)(),I.b.setValue("pseudonymousAnalyticsOptIn",null,$.a.ACCOUNT,!0);break;case z.a.PseudonymousAnalyticsReject:Object(H.b)(),I.b.setValue("pseudonymousAnalyticsOptIn",null,$.a.ACCOUNT,!1);break;case z.a.ShowThread:{const{rootEvent:t,initialEvent:n,highlighted:a,scrollIntoView:i,push:r}=e,o={phase:Te.a.ThreadView,state:{threadHeadEvent:t,initialEvent:n,isInitialEventHighlighted:a,initialEventScrollIntoView:i}};null!=r&&r?Pe.a.instance.pushCard(o):Pe.a.instance.setCards([{phase:Te.a.ThreadPanel},o]),w.a.dispatch({action:z.a.FocusSendMessageComposer,context:Ne.a.Thread});break}}})),o()(this,"handleResize",(()=>{const e=1e3,t=fe.b.instance.windowWidth;this.prevWindowWidth<e&&t>=e&&w.a.dispatch({action:"show_left_panel"}),this.prevWindowWidth>=e&&t<e&&w.a.dispatch({action:"hide_left_panel"}),this.prevWindowWidth=t,this.state.resizeNotifier.notifyWindowResized()})),o()(this,"onRegisterClick",(()=>{this.showScreen("register")})),o()(this,"onLoginClick",(()=>{this.showScreen("login")})),o()(this,"onForgotPasswordClick",(()=>{this.showScreen("forgot_password")})),o()(this,"onRegisterFlowComplete",((e,t)=>this.onUserCompletedLoginFlow(e,t))),o()(this,"onUpdateStatusIndicator",((e,t)=>{const n=e.numUnreadStates;y.a.get()&&(y.a.get().setErrorStatus(t===d.c.Error),y.a.get().setNotificationCount(n)),this.subTitleStatus="",t===d.c.Error&&(this.subTitleStatus+=`[${Object(j.b)("Offline")}] `),n>0?this.subTitleStatus+=`[${n}]`:e.color>=ze.a.Bold&&(this.subTitleStatus+="*"),this.setPageSubtitle()})),o()(this,"onServerConfigChange",(e=>{this.setState({serverConfig:e})})),o()(this,"makeRegistrationUrl",(e=>{var t;return null!==(t=this.props.startingFragmentQueryParams)&&void 0!==t&&t.referrer&&(e.referrer=this.props.startingFragmentQueryParams.referrer),this.props.makeRegistrationUrl(e)})),o()(this,"onUserCompletedLoginFlow",(async(e,t)=>{this.stores.accountPasswordStore.setPassword(t),await x.k(e),await this.postLoginSetup(),ve.b.instance.stop(ve.a.LOGIN),ve.b.instance.stop(ve.a.REGISTER)})),o()(this,"onCompleteSecurityE2eSetupFinished",(()=>{this.onLoggedIn()})),this.stores=Ae.b.instance,this.stores.constructEagerStores(),this.state={view:ke.a.LOADING,collapseLhs:!1,currentRoomId:null,currentUserId:null,hideToSRUsers:!1,syncError:null,resizeNotifier:new D.a,ready:!1},this.loggedInView=Object(s.createRef)(),E.b.put(this.props.config),this.firstSyncComplete=!1,this.firstSyncPromise=Object(m.m)(),this.props.config.sync_timeline_limit&&(f.a.opts.initialSyncLimit=this.props.config.sync_timeline_limit),this.screenAfterLogin=this.props.initialScreenAfterLogin,this.screenAfterLogin){const e=this.screenAfterLogin.params||{};if(this.screenAfterLogin.screen.startsWith("room/")&&e.signurl&&e.email){const t=this.screenAfterLogin.screen.substring(5);Y.a.instance.storeInvite(t,e)}}this.prevWindowWidth=fe.b.instance.windowWidth||1e3,fe.b.instance.on(fe.a.Resize,this.handleResize),this.state.resizeNotifier.on("middlePanelResized",this.dispatchTimelineResize),q.a.instance.on(q.b,this.onUpdateStatusIndicator),x.g()&&x.h(),this.dispatcherRef=w.a.register(this.onAction),this.themeWatcher=new L.a,this.fontWatcher=new U.a,this.themeWatcher.start(),this.fontWatcher.start(),this.focusComposer=!1,this.subTitleStatus="",x.g()||x.a(this.props.realQueryParams,this.props.defaultDeviceDisplayName,this.getFragmentAfterLogin()).then((async e=>{var t,n,a;if((null!==(t=this.props.realQueryParams)&&void 0!==t&&t.loginToken||null!==(n=this.props.realQueryParams)&&void 0!==n&&n.code||null!==(a=this.props.realQueryParams)&&void 0!==a&&a.state)&&this.props.onTokenLoginCompleted(),e)return this.tokenLogin=!0,await x.j({ignoreGuest:!0}),this.postLoginSetup();const i=this.screenAfterLogin?this.screenAfterLogin.screen:null;return!!await this.loadSession()||("login"!==i&&"register"!==i&&"forgot_password"!==i||this.showScreenAfterLogin(),!1)})),Object(_e.a)(E.b.get("sentry"))}async postLoginSetup(){const e=f.a.safeGet(),t=e.isCryptoEnabled();t||this.onLoggedIn();const n=[this.firstSyncPromise.promise];let a=!1;t&&n.push((async()=>{a=await e.userHasCrossSigningKeys()})()),this.setState({pendingInitialSync:!0}),await Promise.all(n),t?(a?!1===ne.a.SHOW_ENCRYPTION_SETUP_UI?this.onLoggedIn():this.setStateForNewView({view:ke.a.COMPLETE_SECURITY}):await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing")&&!Object(He.a)(e)?this.setStateForNewView({view:ke.a.E2E_SETUP}):this.onLoggedIn(),this.setState({pendingInitialSync:!1})):this.setState({pendingInitialSync:!1})}setState(e,t){this.shouldTrackPageChange(this.state,Ke(Ke({},this.state),e))&&this.startPageChangeTimer(),super.setState(e,t)}componentDidMount(){window.addEventListener("resize",this.onWindowResized)}componentDidUpdate(e,t){if(this.shouldTrackPageChange(t,this.state)){const e=this.stopPageChangeTimer();null!=e&&b.b.instance.trackPageChange(this.state.view,this.state.page_type,e)}this.focusComposer&&(w.a.fire(z.a.FocusSendMessageComposer),this.focusComposer=!1)}componentWillUnmount(){var e;x.m(),w.a.unregister(this.dispatcherRef),this.themeWatcher.stop(),this.fontWatcher.stop(),fe.b.destroy(),this.state.resizeNotifier.removeListener("middlePanelResized",this.dispatchTimelineResize),window.removeEventListener("resize",this.onWindowResized),this.stores.accountPasswordStore.clearPassword(),null===(e=this.voiceBroadcastResumer)||void 0===e||e.destroy()}getFallbackHsUrl(){var e;if(null!==(e=this.getServerProperties().serverConfig)&&void 0!==e&&e.isDefault)return this.props.config.fallback_hs_url}getServerProperties(){return{serverConfig:this.state.serverConfig||E.b.get("validated_server_config")}}loadSession(){return Promise.resolve().then((()=>x.h({fragmentQueryParams:this.props.startingFragmentQueryParams,enableGuest:this.props.enableGuest,guestHsUrl:this.getServerProperties().serverConfig.hsUrl,guestIsUrl:this.getServerProperties().serverConfig.isUrl,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName}))).then((e=>(e||(Y.a.instance.pickBestInvite()?w.a.dispatch({action:"start_registration"}):w.a.dispatch({action:"view_welcome_page"})),e)))}startPageChangeTimer(){ve.b.instance.start(ve.a.PAGE_CHANGE)}stopPageChangeTimer(){const e=ve.b.instance;e.stop(ve.a.PAGE_CHANGE);const t=e.getEntries({name:ve.a.PAGE_CHANGE}).pop();return t?t.duration:null}shouldTrackPageChange(e,t){return e.currentRoomId!==t.currentRoomId||e.view!==t.view||e.page_type!==t.page_type}setStateForNewView(e){if(void 0===e.view)throw new Error("setStateForNewView with no view!");this.setState(Ke({currentUserId:void 0,justRegistered:!1},e))}setPage(e){this.setState({page_type:e})}async startRegistration(e){const t={view:ke.a.REGISTER};if(e.client_secret&&e.session_id&&e.hs_url&&e.is_url&&e.sid){t.serverConfig=await M.a.validateServerConfigWithStaticUrls(e.hs_url,e.is_url);const n=E.b.get("validated_server_config");n&&n.hsUrl===t.serverConfig.hsUrl&&(t.serverConfig.hsName=n.hsName,t.serverConfig.hsNameIsDifferent=n.hsNameIsDifferent,t.serverConfig.isDefault=n.isDefault,t.serverConfig.isNameResolvable=n.isNameResolvable),t.register_client_secret=e.client_secret,t.register_session_id=e.session_id,t.register_id_sid=e.sid}this.setStateForNewView(t),T.a.isLogin=!0,this.themeWatcher.recheck(),this.notifyNewScreen("register")}async viewRoom(e){var t;if(this.focusComposer=!0,e.room_alias?h.a.log(`Switching to room alias ${e.room_alias} at event ${e.event_id}`):h.a.log(`Switching to room id ${e.room_id} at event ${e.event_id}`),!this.firstSyncComplete){if(!this.firstSyncPromise)return void h.a.warn("Cannot view a room before first sync. room_id:",e.room_id);await this.firstSyncPromise.promise}let n=e.room_alias||e.room_id;const a=f.a.safeGet().getRoom(e.room_id);if(a){var i;a.decryptAllEvents();const e=O.b(a);e&&(n=e,Object(F.b)(e,a.roomId)),null===(i=localStorage)||void 0===i||i.setItem("mx_last_room_id",a.roomId)}let r="#"===n[0]&&e.room_id===this.state.currentRoomId;var o,s,l,c;(Object(Me.a)(this.state.currentRoomId)&&(r=!0),e.room_id===this.state.currentRoomId)&&(e.threepid_invite=null!==(o=e.threepid_invite)&&void 0!==o?o:this.state.threepidInvite,e.oob_data=null!==(s=e.oob_data)&&void 0!==s?s:this.state.roomOobData,e.forceTimeline=null!==(l=e.forceTimeline)&&void 0!==l?l:this.state.forceTimeline,e.justCreatedOpts=null!==(c=e.justCreatedOpts)&&void 0!==c?c:this.state.roomJustCreatedOpts);e.event_id&&e.highlighted&&(n+="/"+e.event_id),this.setState({view:ke.a.LOGGED_IN,currentRoomId:null!==(t=e.room_id)&&void 0!==t?t:null,page_type:k.a.RoomView,threepidInvite:e.threepid_invite,roomOobData:e.oob_data,forceTimeline:e.forceTimeline,ready:!0,roomJustCreatedOpts:e.justCreatedOpts},(()=>{T.a.isLogin=!1,this.themeWatcher.recheck(),this.notifyNewScreen("room/"+n,r)}))}viewSomethingBehindModal(){this.state.view===ke.a.LOGGED_IN?this.state.currentRoomId||this.state.currentUserId||this.viewHome():this.viewWelcome()}viewWelcome(){if(Object(Z.b)(E.b.get()))return this.viewLogin();this.setStateForNewView({view:ke.a.WELCOME}),this.notifyNewScreen("welcome"),T.a.isLogin=!0,this.themeWatcher.recheck()}viewLogin(e){this.setStateForNewView(Ke({view:ke.a.LOGIN},e)),this.notifyNewScreen("login"),T.a.isLogin=!0,this.themeWatcher.recheck()}viewHome(e=!1){this.setStateForNewView({view:ke.a.LOGGED_IN,justRegistered:e,currentRoomId:null}),this.setPage(k.a.HomePage),this.notifyNewScreen("home"),T.a.isLogin=!1,this.themeWatcher.recheck()}viewUser(e,t){(this.firstSyncPromise?this.firstSyncPromise.promise:Promise.resolve()).then((()=>{"chat"!==t?(this.notifyNewScreen("user/"+e),this.setState({currentUserId:e}),this.setPage(k.a.UserView)):this.chatCreateOrReuse(e)}))}async createRoom(e=!1,t,n){const a=_.b.createDialog(oe.a,{type:n,defaultPublic:e,defaultName:t}),[i,r]=await a.finished;i&&Object(R.c)(f.a.safeGet(),r)}chatCreateOrReuse(e){const t=new Re.a(this.props.config);if(f.a.safeGet().isGuest())return e!==t.get("welcome_user_id")&&w.a.dispatch({action:z.a.DoAfterSyncPrepared,deferred_action:{action:z.a.ViewStartChatOrReuse,user_id:e}}),void w.a.dispatch({action:"require_registration",go_welcome_on_cancel:!0,screen_after:{screen:`user/${t.get("welcome_user_id")}`,params:{action:"chat"}}});const n=f.a.safeGet(),a=Object(Ve.a)(n,e);a?w.a.dispatch({action:z.a.ViewRoom,room_id:a.roomId,metricsTrigger:"MessageUser"}):w.a.dispatch({action:"start_chat",user_id:e})}leaveRoomWarnings(e){const t=f.a.safeGet().getRoom(e),n=null==t?void 0:t.isSpaceRoom(),a=[];if(1===(null==t?void 0:t.currentState.getJoinedMemberCount()))return a.push(l.a.createElement("span",{className:"warning",key:"only_member_warning"}," ",Object(j.b)("You are the only person here. If you leave, no one will be able to join in the future, including you."))),a;const i=null==t?void 0:t.currentState.getStateEvents("m.room.join_rules","");if(i){"public"!==i.getContent().join_rule&&a.push(l.a.createElement("span",{className:"warning",key:"non_public_warning"}," ",n?Object(j.b)("This space is not public. You will not be able to rejoin without an invite."):Object(j.b)("This room is not public. You will not be able to rejoin without an invite.")))}return a}leaveRoom(e){var t,n;const a=f.a.safeGet(),i=a.getRoom(e),r=this.leaveRoomWarnings(e),o=null==i?void 0:i.isSpaceRoom();_.b.createDialog(ie.a,{title:o?Object(j.b)("Leave space"):Object(j.b)("Leave room"),description:l.a.createElement("span",null,o?Object(j.b)("Are you sure you want to leave the space '%(spaceName)s'?",{spaceName:null!==(t=null==i?void 0:i.name)&&void 0!==t?t:Object(j.b)("Unnamed Space")}):Object(j.b)("Are you sure you want to leave the room '%(roomName)s'?",{roomName:null!==(n=null==i?void 0:i.name)&&void 0!==n?n:Object(j.b)("Unnamed Room")}),r),button:Object(j.b)("Leave"),onFinished:async t=>{t&&(await Object(je.a)(a,e),w.a.dispatch({action:z.a.AfterLeaveRoom,room_id:e}))}})}forgetRoom(e){const t=f.a.safeGet().getRoom(e);f.a.safeGet().forget(e).then((()=>{this.state.currentRoomId===e&&w.a.dispatch({action:z.a.ViewHomePage}),t&&ee.c.instance.manualRoomUpdate(t,te.c.RoomRemoved)})).catch((e=>{const t=e.errcode||Object(j.d)("unknown error code");_.b.createDialog(K.a,{title:Object(j.b)("Failed to forget room %(errCode)s",{errCode:t}),description:e&&e.message?e.message:Object(j.b)("Operation failed")})}))}async copyRoom(e){const t=Object(Ee.f)(f.a.safeGet(),e);await Object(we.b)(t)||_.b.createDialog(K.a,{title:Object(j.b)("Unable to copy room link"),description:Object(j.b)("Unable to copy a link to the room to the clipboard.")})}async startWelcomeUserChat(){const e=new Re.a(this.props.config),t=e.get("welcome_user_id");if(!t)return null;let n;n=this.firstSyncComplete?Promise.resolve():this.firstSyncPromise.promise,await n;if(0===A.a.shared().getDMRoomsForUserId(t).length){const n=await Object(R.c)(f.a.safeGet(),{dmUserId:e.get("welcome_user_id"),andView:!this.state.currentRoomId,spinner:!1}),a=e=>{e.getType()===c.EventType.Direct&&e.getContent()[t]&&(f.a.safeGet().store.save(!0),f.a.safeGet().removeListener(c.ClientEvent.AccountData,a))};return f.a.safeGet().on(c.ClientEvent.AccountData,a),n}return null}async onLoggedIn(){if(T.a.isLogin=!1,this.themeWatcher.recheck(),V.f(),!f.a.currentUserIsJustRegistered()||null!==I.b.getValue("FTUE.useCaseSelection"))return this.onShowPostLoginScreen();this.setStateForNewView({view:ke.a.USE_CASE_SELECTION}),I.b.watchSetting("FTUE.useCaseSelection",null,((e,t,n,a,i)=>{null!==i&&this.state.view===ke.a.USE_CASE_SELECTION&&this.onShowPostLoginScreen()}))}async onShowPostLoginScreen(e){var t;if(e&&(Se.a.instance.setProperty("ftueUseCaseSelection",e),I.b.setValue("FTUE.useCaseSelection",null,$.a.ACCOUNT,e)),this.setStateForNewView({view:ke.a.LOGGED_IN}),null!==(t=this.screenAfterLogin)&&void 0!==t&&t.screen)this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=void 0;else if(f.a.currentUserIsJustRegistered()){f.a.setJustRegisteredUserId(null);if(new Re.a(this.props.config).get("welcome_user_id")&&Object(j.f)().startsWith("en")){null===await this.startWelcomeUserChat()&&w.a.dispatch({action:z.a.ViewHomePage,justRegistered:!0})}else if(Y.a.instance.pickBestInvite()){const e=Y.a.instance.pickBestInvite(),t=Y.a.instance.translateToWireFormat(e);this.showScreen(`room/${e.roomId}`,t)}else w.a.dispatch({action:z.a.ViewHomePage,justRegistered:!0})}else this.showScreenAfterLogin();E.b.get("mobile_guide_toast")&&Object(X.a)();const n=E.b.get("user_notice");if(n){const e="user_notice_"+n.title;n.show_once&&localStorage.getItem(e)||B.a.sharedInstance().addOrReplaceToast({key:e,title:n.title,props:{description:l.a.createElement(We.a,null,n.description),acceptLabel:Object(j.b)("OK"),onAccept:()=>{B.a.sharedInstance().dismissToast(e),localStorage.setItem(e,"1")}},component:Fe.a,className:"mx_AnalyticsToast",priority:100})}}initPosthogAnalyticsToast(){null===I.b.getValue("pseudonymousAnalyticsOptIn")&&Object(H.c)(),I.b.watchSetting("pseudonymousAnalyticsOptIn",null,((e,t,n,a,i)=>{null===i?Object(H.c)():Object(H.b)()}))}showScreenAfterLogin(){this.screenAfterLogin&&this.screenAfterLogin.screen?(this.showScreen(this.screenAfterLogin.screen,this.screenAfterLogin.params),this.screenAfterLogin=void 0):localStorage&&localStorage.getItem("mx_last_room_id")?this.viewLastRoom():f.a.safeGet().isGuest()?w.a.dispatch({action:"view_welcome_page"}):w.a.dispatch({action:z.a.ViewHomePage})}viewLastRoom(){var e;w.a.dispatch({action:z.a.ViewRoom,room_id:null!==(e=localStorage.getItem("mx_last_room_id"))&&void 0!==e?e:void 0,metricsTrigger:void 0})}onLoggedOut(){this.viewLogin({ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle(),this.stores.onLoggedOut()}onSoftLogout(){this.notifyNewScreen("soft_logout"),this.setStateForNewView({view:ke.a.SOFT_LOGOUT,ready:!1,collapseLhs:!1,currentRoomId:null}),this.subTitleStatus="",this.setPageSubtitle()}onWillStartClient(){this.firstSyncComplete=!1,this.firstSyncPromise=Object(m.m)();const e=f.a.safeGet();e.setCanResetTimelineCallback((e=>(h.a.log("Request to reset timeline in room ",e," viewing:",this.state.currentRoomId),e!==this.state.currentRoomId||(!this.loggedInView.current||this.loggedInView.current.canResetTimelineInRoom(e))))),e.on(c.ClientEvent.Sync,((e,t,n)=>{var a;e===d.c.Error||e===d.c.Reconnecting?((null==n?void 0:n.error)instanceof u.c&&x.d(n.error),this.setState({syncError:null!==(a=null==n?void 0:n.error)&&void 0!==a?a:null})):this.state.syncError&&this.setState({syncError:null});e===d.c.Syncing&&t===d.c.Syncing||(h.a.debug(`MatrixClient sync state => ${e}`),e===d.c.Prepared&&(this.firstSyncComplete=!0,this.firstSyncPromise.resolve(),S.default.shouldShowPrompt()&&!f.a.userRegisteredWithinLastHours(24)&&Object(G.b)(!1),w.a.fire(z.a.FocusSendMessageComposer),this.setState({ready:!0})))})),e.on(c.HttpApiEvent.SessionLoggedOut,(function(e){if(!x.f()){if(_.b.closeCurrentModal("Session.logged_out"),401===e.httpStatus&&e.data&&e.data.soft_logout)return h.a.warn("Soft logout issued by server - avoiding data deletion"),void x.l();_.b.createDialog(K.a,{title:Object(j.b)("Signed Out"),description:Object(j.b)("For security, this session has been signed out. Please sign in again.")}),w.a.dispatch({action:"logout"})}})),e.on(c.HttpApiEvent.NoConsent,(function(t,n){_.b.createDialog(ie.a,{title:Object(j.b)("Terms and Conditions"),description:l.a.createElement("div",null,l.a.createElement("p",null," ",Object(j.b)("To continue using the %(homeserverDomain)s homeserver you must review and agree to our terms and conditions.",{homeserverDomain:e.getDomain()}))),button:Object(j.b)("Review terms and conditions"),cancelButton:Object(j.b)("Dismiss"),onFinished:e=>{if(e){window.open(n,"_blank").opener=null}}},void 0,!0)}));const t=v.a.instance;t.start(),e.on(c.HttpApiEvent.SessionLoggedOut,(()=>t.stop())),e.on(c.MatrixEventEvent.Decrypted,((e,n)=>t.eventDecrypted(e,n))),e.on(c.ClientEvent.Room,(t=>{if(e.isCryptoEnabled()){const e=I.b.getValueAt($.a.ROOM_DEVICE,"blacklistUnverifiedDevices",t.roomId,!0);t.setBlacklistUnverifiedDevices(e)}})),e.on(g.b.Warning,(e=>{if("CRYPTO_WARNING_OLD_VERSION_DETECTED"===e)_.b.createDialog(K.a,{title:Object(j.b)("Old cryptography data detected"),description:Object(j.b)("Data from an older version of %(brand)s has been detected. This will have caused end-to-end cryptography to malfunction in the older version. End-to-end encrypted messages exchanged recently whilst using the older version may not be decryptable in this version. This may also cause messages exchanged with this version to fail. If you experience problems, log out and back in again. To retain message history, export and re-import your keys.",{brand:E.b.get().brand})})})),e.on(g.b.KeyBackupFailed,(async t=>{let a,i=null;if(e.getKeyBackupEnabled())a=!0;else try{i=await e.getKeyBackupVersion(),null!==i&&(a=!0)}catch(e){return void h.a.error("Saw key backup error but failed to check backup version!",e)}a?_.b.createDialogAsync(n.e(41).then(n.bind(null,1581)),{newVersionInfo:i}):_.b.createDialogAsync(n.e(42).then(n.bind(null,1582)))})),e.on(g.b.KeySignatureUploadFailure,((e,t,n)=>{_.b.createDialog(se.a,{failures:e,source:t,continuation:n})})),e.on(g.b.VerificationRequestReceived,(e=>{e.verifier?_.b.createDialog(le.a,{verifier:e.verifier},void 0,!1,!0):e.pending&&B.a.sharedInstance().addOrReplaceToast({key:"verifreq_"+e.transactionId,title:Object(j.b)("Verification requested"),icon:"verification",props:{request:e},component:be.a,priority:90})})),this.voiceBroadcastResumer=new Ue.z(e)}onClientStarted(){const e=f.a.safeGet();if(e.isCryptoEnabled()){const t=I.b.getValueAt($.a.DEVICE,"blacklistUnverifiedDevices");e.setGlobalBlacklistUnverifiedDevices(t),e.setGlobalErrorOnUnknownDevices(!1)}Se.a.instance.isEnabled()&&I.b.isLevelSupported($.a.ACCOUNT)&&this.initPosthogAnalyticsToast()}showScreen(e,t){const n=f.a.get();if(!n||n.isGuest()||!qe.includes(e))if("register"===e)w.a.dispatch({action:"start_registration",params:t}),ve.b.instance.start(ve.a.REGISTER);else if("login"===e)w.a.dispatch({action:"start_login",params:t}),ve.b.instance.start(ve.a.LOGIN);else if("forgot_password"===e)w.a.dispatch({action:"start_password_recovery",params:t});else if("soft_logout"===e)null!=n&&n.getUserId()&&!x.g()?this.viewLastRoom():w.a.dispatch({action:"start_login",params:t});else if("new"===e)w.a.dispatch({action:"view_create_room"});else if("dm"===e)w.a.dispatch({action:"view_create_chat"});else if("settings"===e)w.a.fire(z.a.ViewUserSettings);else if("welcome"===e)w.a.dispatch({action:"view_welcome_page"});else if("home"===e)w.a.dispatch({action:z.a.ViewHomePage});else if("start"===e)this.showScreen("home"),w.a.dispatch({action:"require_registration"});else if("directory"===e)w.a.fire(z.a.ViewRoomDirectory);else if("start_sso"===e||"start_cas"===e){var a;let t=f.a.get();if(!t){const{hsUrl:e,isUrl:n}=this.getServerProperties().serverConfig;t=Object(c.createClient)({baseUrl:e,idBaseUrl:n})}const n="start_sso"===e?"sso":"cas";null===(a=y.a.get())||void 0===a||a.startSingleSignOn(t,n,this.getFragmentAfterLogin())}else if(0===e.indexOf("room/")){var i,r,o;const n=e.substring(5),a=n.indexOf(":")+1;let s=n.length;n.substring(a).indexOf("/")>-1&&(s=a+n.substring(a).indexOf("/"));const l=n.substring(0,s);let c,d=n.substring(s+1);if(d||(d=void 0),null!=t&&t.signurl&&null!=t&&t.email&&(c=Y.a.instance.storeInvite(l,t)),!c){c=Y.a.instance.getInvites().find((e=>e.roomId===l))}let u=[];null!=t&&t.via&&(u="string"==typeof t.via?[t.via]:t.via);const m={action:z.a.ViewRoom,event_id:d,via_servers:u,highlighted:Boolean(d),threepid_invite:c,oob_data:{name:null===(i=c)||void 0===i?void 0:i.roomName,avatarUrl:null===(r=c)||void 0===r?void 0:r.roomAvatarUrl,inviterName:null===(o=c)||void 0===o?void 0:o.inviterName},room_alias:void 0,room_id:void 0,metricsTrigger:void 0};"#"===l[0]?m.room_alias=l:m.room_id=l,w.a.dispatch(m)}else if(0===e.indexOf("user/")){const n=e.substring(5);w.a.dispatch({action:"view_user_info",userId:n,subAction:null==t?void 0:t.action})}else h.a.info(`Ignoring showScreen for '${e}'`);else w.a.dispatch({action:z.a.ViewHomePage})}notifyNewScreen(e,t=!1){this.props.onNewScreen&&this.props.onNewScreen(e,t),this.setPageSubtitle()}onLogoutClick(e){w.a.dispatch({action:"logout"}),e.stopPropagation(),e.preventDefault()}dispatchTimelineResize(){w.a.dispatch({action:"timeline_resize"})}onRegistered(e){return x.k(e)}onSendEvent(e,t){const n=f.a.get();n&&n.sendEvent(e,t.getType(),t.getContent()).then((()=>{w.a.dispatch({action:"message_sent"})}))}setPageSubtitle(e=""){if(this.state.currentRoomId){const t=f.a.get(),n=null==t?void 0:t.getRoom(this.state.currentRoomId);n&&(e=`${this.subTitleStatus} | ${n.name} ${e}`)}else e=`${this.subTitleStatus} ${e}`;const t=`${E.b.get().brand} ${e}`;document.title!==t&&(document.title=t)}getFragmentAfterLogin(){let e="";const t=this.props.initialScreenAfterLogin;return t&&!["welcome","login","register","start_sso","start_cas"].includes(t.screen)&&(e=`/${t.screen}`),e}render(){const e=this.getFragmentAfterLogin();let t;if(this.state.view===ke.a.LOADING)t=l.a.createElement("div",{className:"mx_MatrixChat_splash"},l.a.createElement(ae.a,null));else if(this.state.view===ke.a.COMPLETE_SECURITY)t=l.a.createElement(ce.a,{onFinished:this.onCompleteSecurityE2eSetupFinished});else if(this.state.view===ke.a.E2E_SETUP)t=l.a.createElement(me.a,{onFinished:this.onCompleteSecurityE2eSetupFinished,accountPassword:this.stores.accountPasswordStore.getPassword(),tokenLogin:!!this.tokenLogin});else if(this.state.view===ke.a.LOGGED_IN){const e=this.state.syncError&&this.state.syncError instanceof u.c;if(this.state.ready&&this.state.page_type&&!e)t=l.a.createElement(W.a,i()({},this.props,this.state,{ref:this.loggedInView,matrixClient:f.a.safeGet(),onRegistered:this.onRegistered,currentRoomId:this.state.currentRoomId}));else{let n;this.state.syncError&&!e&&(n=l.a.createElement("div",{className:"mx_MatrixChat_syncError"},Object(N.e)(this.state.syncError))),t=l.a.createElement("div",{className:"mx_MatrixChat_splash"},n,l.a.createElement(ae.a,null),l.a.createElement("div",{className:"mx_MatrixChat_splashButtons"},l.a.createElement(xe.a,{kind:"link_inline",onClick:this.onLogoutClick},Object(j.b)("Logout"))))}}else if(this.state.view===ke.a.WELCOME)t=l.a.createElement(de.a,null);else if(this.state.view===ke.a.REGISTER&&I.b.getValue(J.b.Registration)){var n;const a=null===(n=Y.a.instance.pickBestInvite())||void 0===n?void 0:n.toEmail;t=l.a.createElement(he.a,i()({clientSecret:this.state.register_client_secret,sessionId:this.state.register_session_id,idSid:this.state.register_id_sid,email:a,brand:this.props.config.brand,makeRegistrationUrl:this.makeRegistrationUrl,onLoggedIn:this.onRegisterFlowComplete,onLoginClick:this.onLoginClick,onServerConfigChange:this.onServerConfigChange,defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,fragmentAfterLogin:e},this.getServerProperties()))}else if(this.state.view===ke.a.FORGOT_PASSWORD&&I.b.getValue(J.b.PasswordReset))t=l.a.createElement(ue.a,i()({onComplete:this.onLoginClick,onLoginClick:this.onLoginClick},this.getServerProperties()));else if(this.state.view===ke.a.LOGIN){var a;const n=I.b.getValue(J.b.PasswordReset);t=l.a.createElement(pe.a,i()({isSyncing:this.state.pendingInitialSync,onLoggedIn:this.onUserCompletedLoginFlow,onRegisterClick:this.onRegisterClick,fallbackHsUrl:this.getFallbackHsUrl(),defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,onForgotPasswordClick:n?this.onForgotPasswordClick:void 0,onServerConfigChange:this.onServerConfigChange,fragmentAfterLogin:e,defaultUsername:null===(a=this.props.startingFragmentQueryParams)||void 0===a?void 0:a.defaultUsername},this.getServerProperties()))}else if(this.state.view===ke.a.SOFT_LOGOUT)t=l.a.createElement(ye.a,{realQueryParams:this.props.realQueryParams,onTokenLoginCompleted:this.props.onTokenLoginCompleted,fragmentAfterLogin:e});else{if(this.state.view!==ke.a.USE_CASE_SELECTION)return h.a.error(`Unknown view ${this.state.view}`),null;t=l.a.createElement(De.a,{onFinished:e=>this.onShowPostLoginScreen(e)})}return l.a.createElement(ge.a,null,l.a.createElement(Ae.a.Provider,{value:this.stores},t))}}o()(Ye,"displayName","MatrixChat"),o()(Ye,"defaultProps",{realQueryParams:{},startingFragmentQueryParams:{},config:{},onTokenLoginCompleted:()=>{}})}).call(this,n(80))},1481:function(e,t,n){!function(){"use strict";function e(e){var t=!0,n=!1,a=null,i={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function r(e){return!!(e&&e!==document&&"HTML"!==e.nodeName&&"BODY"!==e.nodeName&&"classList"in e&&"contains"in e.classList)}function o(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!i[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}function s(e){e.classList.contains("focus-visible")||(e.classList.add("focus-visible"),e.setAttribute("data-focus-visible-added",""))}function l(e){e.hasAttribute("data-focus-visible-added")&&(e.classList.remove("focus-visible"),e.removeAttribute("data-focus-visible-added"))}function c(n){n.metaKey||n.altKey||n.ctrlKey||(r(e.activeElement)&&s(e.activeElement),t=!0)}function d(e){t=!1}function u(e){r(e.target)&&(t||o(e.target))&&s(e.target)}function m(e){r(e.target)&&(e.target.classList.contains("focus-visible")||e.target.hasAttribute("data-focus-visible-added"))&&(n=!0,window.clearTimeout(a),a=window.setTimeout((function(){n=!1}),100),l(e.target))}function h(e){"hidden"===document.visibilityState&&(n&&(t=!0),p())}function p(){document.addEventListener("mousemove",b),document.addEventListener("mousedown",b),document.addEventListener("mouseup",b),document.addEventListener("pointermove",b),document.addEventListener("pointerdown",b),document.addEventListener("pointerup",b),document.addEventListener("touchmove",b),document.addEventListener("touchstart",b),document.addEventListener("touchend",b)}function g(){document.removeEventListener("mousemove",b),document.removeEventListener("mousedown",b),document.removeEventListener("mouseup",b),document.removeEventListener("pointermove",b),document.removeEventListener("pointerdown",b),document.removeEventListener("pointerup",b),document.removeEventListener("touchmove",b),document.removeEventListener("touchstart",b),document.removeEventListener("touchend",b)}function b(e){e.target.nodeName&&"html"===e.target.nodeName.toLowerCase()||(t=!1,g())}document.addEventListener("keydown",c,!0),document.addEventListener("mousedown",d,!0),document.addEventListener("pointerdown",d,!0),document.addEventListener("touchstart",d,!0),document.addEventListener("visibilitychange",h,!0),p(),e.addEventListener("focus",u,!0),e.addEventListener("blur",m,!0),e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&e.host?e.host.setAttribute("data-js-focus-visible",""):e.nodeType===Node.DOCUMENT_NODE&&(document.documentElement.classList.add("js-focus-visible"),document.documentElement.setAttribute("data-js-focus-visible",""))}if("undefined"!=typeof window&&"undefined"!=typeof document){var t;window.applyFocusVisiblePolyfill=e;try{t=new CustomEvent("focus-visible-polyfill-ready")}catch(e){(t=document.createEvent("CustomEvent")).initCustomEvent("focus-visible-polyfill-ready",!1,!1,{})}window.dispatchEvent(t)}"undefined"!=typeof document&&e(document)}()},1482:function(e,t,n){var a;a=function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var i=t[a]={exports:{},id:a,loaded:!1};return e[a].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}return n.m=e,n.c=t,n.p="",n(0)}([function(e,t){"use strict";e.exports=function(){if("undefined"==typeof document||"undefined"==typeof window)return{ask:function(){return"initial"},element:function(){return null},ignoreKeys:function(){},specificKeys:function(){},registerOnChange:function(){},unRegisterOnChange:function(){}};var e=document.documentElement,t=null,n="initial",a=n,i=Date.now(),r=!1,o=["button","input","select","textarea"],s=[],l=[16,17,18,91,93],c=[],d={keydown:"keyboard",keyup:"keyboard",mousedown:"mouse",mousemove:"mouse",MSPointerDown:"pointer",MSPointerMove:"pointer",pointerdown:"pointer",pointermove:"pointer",touchstart:"touch",touchend:"touch"},u=!1,m={x:null,y:null},h={2:"touch",3:"touch",4:"mouse"},p=!1;try{var g=Object.defineProperty({},"passive",{get:function(){p=!0}});window.addEventListener("test",null,g)}catch(e){}var b=function(){var e=!p||{passive:!0,capture:!0};document.addEventListener("DOMContentLoaded",v,!0),window.PointerEvent?(window.addEventListener("pointerdown",f,!0),window.addEventListener("pointermove",E,!0)):window.MSPointerEvent?(window.addEventListener("MSPointerDown",f,!0),window.addEventListener("MSPointerMove",E,!0)):(window.addEventListener("mousedown",f,!0),window.addEventListener("mousemove",E,!0),"ontouchstart"in window&&(window.addEventListener("touchstart",f,e),window.addEventListener("touchend",f,!0))),window.addEventListener(x(),E,e),window.addEventListener("keydown",f,!0),window.addEventListener("keyup",f,!0),window.addEventListener("focusin",w,!0),window.addEventListener("focusout",S,!0)},v=function(){if(r=!("false"===e.getAttribute("data-whatpersist")||"false"===document.body.getAttribute("data-whatpersist")))try{window.sessionStorage.getItem("what-input")&&(n=window.sessionStorage.getItem("what-input")),window.sessionStorage.getItem("what-intent")&&(a=window.sessionStorage.getItem("what-intent"))}catch(e){}y("input"),y("intent")},f=function(e){var t=e.which,i=d[e.type];"pointer"===i&&(i=C(e));var r=!c.length&&-1===l.indexOf(t),s=c.length&&-1!==c.indexOf(t),u="keyboard"===i&&t&&(r||s)||"mouse"===i||"touch"===i;if(O(i)&&(u=!1),u&&n!==i&&(_("input",n=i),y("input")),u&&a!==i){var m=document.activeElement;m&&m.nodeName&&(-1===o.indexOf(m.nodeName.toLowerCase())||"button"===m.nodeName.toLowerCase()&&!j(m,"form"))&&(_("intent",a=i),y("intent"))}},y=function(t){e.setAttribute("data-what"+t,"input"===t?n:a),k(t)},E=function(e){var t=d[e.type];"pointer"===t&&(t=C(e)),R(e),(!u&&!O(t)||u&&"wheel"===e.type||"mousewheel"===e.type||"DOMMouseScroll"===e.type)&&a!==t&&(_("intent",a=t),y("intent"))},w=function(n){n.target.nodeName?(t=n.target.nodeName.toLowerCase(),e.setAttribute("data-whatelement",t),n.target.classList&&n.target.classList.length&&e.setAttribute("data-whatclasses",n.target.classList.toString().replace(" ",","))):S()},S=function(){t=null,e.removeAttribute("data-whatelement"),e.removeAttribute("data-whatclasses")},_=function(e,t){if(r)try{window.sessionStorage.setItem("what-"+e,t)}catch(e){}},C=function(e){return"number"==typeof e.pointerType?h[e.pointerType]:"pen"===e.pointerType?"touch":e.pointerType},O=function(e){var t=Date.now(),a="mouse"===e&&"touch"===n&&t-i<200;return i=t,a},x=function(){return"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},k=function(e){for(var t=0,i=s.length;t<i;t++)s[t].type===e&&s[t].fn.call(void 0,"input"===e?n:a)},R=function(e){m.x!==e.screenX||m.y!==e.screenY?(u=!1,m.x=e.screenX,m.y=e.screenY):u=!0},j=function(e,t){var n=window.Element.prototype;if(n.matches||(n.matches=n.msMatchesSelector||n.webkitMatchesSelector),n.closest)return e.closest(t);do{if(e.matches(t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null};return"addEventListener"in window&&Array.prototype.indexOf&&(d[x()]="mouse",b()),{ask:function(e){return"intent"===e?a:n},element:function(){return t},ignoreKeys:function(e){l=e},specificKeys:function(e){c=e},registerOnChange:function(e,t){s.push({fn:e,type:t||"input"})},unRegisterOnChange:function(e){var t=function(e){for(var t=0,n=s.length;t<n;t++)if(s[t].fn===e)return t}(e);(t||0===t)&&s.splice(t,1)},clearStorage:function(){window.sessionStorage.clear()}}}()}])},e.exports=a()},1483:function(e,t,n){"use strict";var a=n(14),i=n(9),r=n(54);const o={deferredAction:null};class s extends r.a{constructor(){super(i.a,o)}onDispatch(e){switch(e.action){case a.a.DoAfterSyncPrepared:this.updateState({deferredAction:e.deferred_action});break;case"cancel_after_sync_prepared":this.updateState({deferredAction:null});break;case"MatrixActions.sync":{if("PREPARED"!==e.state)break;if(!this.state.deferredAction)break;const t=Object.assign({},this.state.deferredAction);this.updateState({deferredAction:null}),i.a.dispatch(t);break}case"on_client_not_viable":case a.a.OnLoggedOut:this.reset()}}}let l=null;l||(l=new s)},1484:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(4),o=n(6),s=n(25),l=n(392),c=n(9),d=n(120),u=n(5),m=n(14);function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function p(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const g="im.vector.auto_rs_request";class b extends d.a{constructor(){super(c.a,{reportedSessionIds:new Set,lastRageshakeTime:0,initialSyncCompleted:!1}),this.onDecryptionAttempt=this.onDecryptionAttempt.bind(this),this.onDeviceMessage=this.onDeviceMessage.bind(this),this.onSyncStateChange=this.onSyncStateChange.bind(this)}static get instance(){return b.internalInstance}async onAction(e){if(e.action===m.a.ReportKeyBackupNotEnabled)this.onReportKeyBackupNotEnabled()}async onReady(){u.b.getValue("automaticDecryptionErrorReporting")&&this.matrixClient&&(this.matrixClient.on(r.MatrixEventEvent.Decrypted,this.onDecryptionAttempt),this.matrixClient.on(r.ClientEvent.ToDeviceEvent,this.onDeviceMessage),this.matrixClient.on(r.ClientEvent.Sync,this.onSyncStateChange))}async onNotReady(){this.matrixClient&&(this.matrixClient.removeListener(r.ClientEvent.ToDeviceEvent,this.onDeviceMessage),this.matrixClient.removeListener(r.MatrixEventEvent.Decrypted,this.onDecryptionAttempt),this.matrixClient.removeListener(r.ClientEvent.Sync,this.onSyncStateChange))}async onDecryptionAttempt(e){if(!this.state.initialSyncCompleted)return;const t=e.getWireContent(),n=t.session_id;if(e.isDecryptionFailure()&&!this.state.reportedSessionIds.has(n)){var a;if(await Object(o.N)(5e3),!e.isDecryptionFailure())return;const i=new Set(this.state.reportedSessionIds);await this.updateState({reportedSessionIds:i.add(n)});const r=(new Date).getTime();if(r-this.state.lastRageshakeTime<6e4)return;await this.updateState({lastRageshakeTime:r});const c={event_id:e.getId(),room_id:e.getRoomId(),session_id:n,device_id:t.device_id,user_id:e.getSender(),sender_key:t.sender_key},d=await Object(l.a)(s.b.get().bug_report_endpoint_url,{userText:"Auto-reporting decryption error (recipient)",sendLogs:!0,labels:["Z-UISI","web","uisi-recipient"],customApp:s.b.get().uisi_autorageshake_app,customFields:{auto_uisi:JSON.stringify(c)}}),u=p(p({},c),{},{recipient_rageshake:d});null===(a=this.matrixClient)||void 0===a||a.sendToDevice(g,new Map([["messageContent.user_id",new Map([[u.device_id,u]])]]))}}async onSyncStateChange(e,t,n){this.state.initialSyncCompleted||await this.updateState({initialSyncCompleted:!(null==n||!n.nextSyncToken)})}async onDeviceMessage(e){if(e.getType()!==g)return;const t=e.getContent(),n=t.recipient_rageshake||"",a=(new Date).getTime();a-this.state.lastRageshakeTime>6e4&&(await this.updateState({lastRageshakeTime:a}),await Object(l.a)(s.b.get().bug_report_endpoint_url,{userText:`Auto-reporting decryption error (sender)\nRecipient rageshake: ${n}`,sendLogs:!0,labels:["Z-UISI","web","uisi-sender"],customApp:s.b.get().uisi_autorageshake_app,customFields:{recipient_rageshake:n,auto_uisi:JSON.stringify(t)}}))}async onReportKeyBackupNotEnabled(){u.b.getValue("automaticKeyBackNotEnabledReporting")&&await Object(l.a)(s.b.get().bug_report_endpoint_url,{userText:"Auto-reporting key backup not enabled",sendLogs:!0,labels:["web",m.a.ReportKeyBackupNotEnabled]})}}i()(b,"internalInstance",(()=>{const e=new b;return e.start(),e})()),window.mxAutoRageshakeStore=b.instance},1485:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(1),i=n.n(a),r=n(67),o=n(39);class s extends r.EventEmitter{constructor(...e){super(...e),i()(this,"_isResizing",!1),i()(this,"throttledMiddlePanel",Object(o.throttle)((()=>this.emit("middlePanelResized")),200))}get isResizing(){return this._isResizing}startResizing(){this._isResizing=!0,this.emit("isResizing",!0)}stopResizing(){this._isResizing=!1,this.emit("isResizing",!1)}noisyMiddlePanel(){this.emit("middlePanelResizedNoisy")}updateMiddlePanel(){this.throttledMiddlePanel(),this.noisyMiddlePanel()}notifyLeftHandleResized(){this.updateMiddlePanel()}notifyRightHandleResized(){this.updateMiddlePanel()}notifyTimelineHeightChanged(){this.updateMiddlePanel()}notifyWindowResized(){this.updateMiddlePanel()}}},1486:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(0);const i=100;function r(e,t,n){Object(a.useEffect)((()=>{let a=null;const r=()=>{a=null,t(...n)};if(!1!==e)return a=window.setTimeout(r,i),()=>{a&&clearTimeout(a)}}),[e,t,n])}},1487:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),i=n(7),r=n(15),o=n(5),s=n(29);const l=()=>{const[e,t]=Object(a.useState)((()=>{const e=i.a.safeGet(),t=o.b.getValue("SpotlightSearch.recentSearches",null);return Object(s.m)(t.map((t=>e.getRoom(t))))}));return[e,()=>{o.b.setValue("SpotlightSearch.recentSearches",null,r.a.ACCOUNT,[]),t([])}]}},1488:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(0),i=n(7),r=n(1357);const o=()=>{const[e,t]=Object(a.useState)(null),[n,o]=Object(a.useState)(!1),[s,l]=Object(r.a)(t);return{ready:!0,loading:n,profile:e,search:Object(a.useCallback)((async({query:e})=>{if(s(e),null==e||!e.length||!e.startsWith("@")||!e.includes(":"))return t(null),!0;o(!0);try{const t=await i.a.safeGet().getProfileInfo(e);return l(e,{user_id:e,avatar_url:t.avatar_url,display_name:t.displayname}),!0}catch(t){return console.error("Could not fetch profile info for params",{term:e},t),l(e,null),!1}finally{o(!1)}}),[s,l])}}},1489:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(0),i=n(7),r=n(25),o=n(5),s=n(1357),l=n(182);const c="ALL_ROOMS",d="mx_last_room_directory_server",u="mx_last_room_directory_instance";let m;const h="nsfw",p=e=>{var t,n;return!(null!==(t=e.name)&&void 0!==t&&t.toLocaleLowerCase().includes(h)||null!==(n=e.topic)&&void 0!==n&&n.toLocaleLowerCase().includes(h))},g=()=>{const[e,t]=Object(a.useState)([]),[n,h]=Object(a.useState)(void 0),[g,b]=Object(a.useState)(null),[v,f]=Object(a.useState)(!1),[y,E]=Object(a.useState)(!1),[w,S]=Object(s.a)(t),_=Object(l.b)("SpotlightSearch.showNsfwPublicRooms");const C=Object(a.useCallback)((async({limit:e=20,query:t,roomTypes:a})=>{const r={limit:e};(null==n?void 0:n.roomServer)!=i.a.getHomeserverName()&&(r.server=null==n?void 0:n.roomServer),(null==n?void 0:n.instanceId)===c?r.include_all_networks=!0:null!=n&&n.instanceId&&(r.third_party_instance_id=n.instanceId),(t||a)&&(r.filter={generic_search_term:t,room_types:a&&await i.a.safeGet().doesServerSupportUnstableFeature("org.matrix.msc3827.stable")?Array.from(a):void 0}),w(r);try{E(!0);const{chunk:e}=await i.a.safeGet().publicRooms(r);return S(r,_?e:e.filter(p)),!0}catch(e){return console.error("Could not fetch public rooms for params",r,e),S(r,[]),!1}finally{E(!1)}}),[n,w,S,_]);return Object(a.useEffect)((()=>{!async function(){if(i.a.get())if(m)b(m);else{const e=await i.a.safeGet().getThirdpartyProtocols();m=e,b(e)}else f(!0)}()}),[]),Object(a.useEffect)((()=>{var e,t,n,a;if(null===g)return;const s=i.a.getHomeserverName(),l=localStorage.getItem(d),m=null!==(e=localStorage.getItem(u))&&void 0!==e?e:void 0;let p,b=s;l&&(null!==(t=r.b.getObject("room_directory"))&&void 0!==t&&null!==(n=t.get("servers"))&&void 0!==n&&n.includes(l)||null!==(a=o.b.getValue("room_directory_servers"))&&void 0!==a&&a.includes(l))&&(b=l),b!==s||m!==c&&!Object.values(g).some((e=>{e.instances.some((e=>e.instance_id===m))}))||(p=m),f(!0),h({roomServer:b,instanceId:p})}),[g]),Object(a.useEffect)((()=>{n&&(localStorage.setItem(d,n.roomServer),n.instanceId?localStorage.setItem(u,n.instanceId):localStorage.removeItem(u))}),[n]),{ready:v,loading:y,publicRooms:e,protocols:g,config:n,search:C,setConfig:function(e){if(!v)throw new Error("public room configuration not initialised yet");h(e)}}}},1490:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(0),i=n(4),r=n(1402),o=n(6),s=n(7);const l=(e,t)=>{var n;const[l,c]=Object(a.useState)([]),[d,u]=Object(a.useState)(),m=Object(a.useCallback)((()=>{u(e?new r.a(e,50):void 0)}),[e]);Object(a.useEffect)(m,[m]),Object(a.useEffect)((()=>{if(!e||!d)return;let t=!1;return(async()=>{for(;null!=d&&d.canLoadMore&&!t&&e===d.root;)await d.load(),d.canLoadMore&&d.load(),c(d.rooms)})(),()=>{t=!0}}),[e,d]);return[Object(a.useMemo)((()=>{const e=t.trim(),n=e.toLowerCase(),a=Object(o.B)(e),r=s.a.safeGet();return null==l?void 0:l.filter((e=>{var t;return e.room_type!==i.RoomType.Space&&"join"!==(null===(t=r.getRoom(e.room_id))||void 0===t?void 0:t.getMyMembership())&&(Object(o.B)(e.name||"").includes(a)||(e.canonical_alias||"").includes(n))}))}),[l,t]),null!==(n=null==d?void 0:d.loading)&&void 0!==n&&n]}},1491:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(0),i=n(7),r=n(159),o=n(1357);const s=()=>{const[e,t]=Object(a.useState)([]),[n,s]=Object(a.useState)(!1),[l,c]=Object(o.a)(t);return{ready:!0,loading:n,users:e,search:Object(a.useCallback)((async({limit:e=20,query:n})=>{const a={limit:e,term:n};if(l(a),null==n||!n.length)return t([]),!0;try{s(!0);const{results:e}=await i.a.safeGet().searchUserDirectory(a);return c(a,e.map((e=>new r.a(e)))),!0}catch(t){return console.error("Could not fetch user in user directory for params",{limit:e,term:n},t),c(a,[]),!1}finally{s(!1)}}),[l,c])}}},1492:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(17),i=n.n(a),r=n(24),o=n.n(r),s=n(13),l=n.n(s),c=n(0),d=n.n(c),u=n(68),m=n(10);const h=["inputRef","children","endAdornment","className"],p=e=>{let{inputRef:t,children:n,endAdornment:a,className:r}=e,s=o()(e,h);const[c,p,g]=Object(u.i)(t);return d.a.createElement(m.a,i()({},s,{className:l()(r,"mx_SpotlightDialog_option"),onFocus:c,inputRef:g,tabIndex:-1,"aria-selected":p,role:"option",element:"li"}),n,d.a.createElement("div",{className:"mx_SpotlightDialog_option--endAdornment"},d.a.createElement("kbd",{className:"mx_SpotlightDialog_enterPrompt","aria-hidden":!0},"↵"),a))}},1493:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(0),i=n.n(a),r=n(98),o=n(2),s=n(238);const l=80,c=800;function d({room:e,labelId:t,descriptionId:n,detailsId:a}){var d,u,m;let h=e.name||Object(s.a)(null!==(d=e.canonical_alias)&&void 0!==d?d:"",null!==(u=e.aliases)&&void 0!==u?u:[])||Object(o.b)("Unnamed room");h.length>l&&(h=`${h.substring(0,l)}...`);let p=e.topic||"";return p.length>c&&(p=`${p.substring(0,c)}...`),i.a.createElement("div",{className:"mx_SpotlightDialog_result_publicRoomDetails"},i.a.createElement("div",{className:"mx_SpotlightDialog_result_publicRoomHeader"},i.a.createElement("span",{id:t,className:"mx_SpotlightDialog_result_publicRoomName"},h),i.a.createElement("span",{id:n,className:"mx_SpotlightDialog_result_publicRoomAlias"},null!==(m=e.canonical_alias)&&void 0!==m?m:e.room_id)),i.a.createElement("div",{id:a,className:"mx_SpotlightDialog_result_publicRoomDescription"},i.a.createElement("span",{className:"mx_SpotlightDialog_result_publicRoomMemberCount"},Object(o.b)("%(count)s Members",{count:e.num_joined_members})),p&&i.a.createElement(i.a.Fragment,null," · ",i.a.createElement("span",{className:"mx_SpotlightDialog_result_publicRoomTopic",dangerouslySetInnerHTML:{__html:Object(r.f)(p)}}))))}},1494:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n(17),i=n.n(a),r=n(13),o=n.n(r),s=n(0),l=n.n(s),c=n(422),d=n(472),u=n(2),m=n(84),h=n(778),p=n(777),g=n(1358),b=n(447),v=n(140),f=n(40);function y({room:e}){const[t]=Object(d.a)(e),[n,a]=Object(s.useState)(null),[r,y]=Object(s.useState)(null);let E,w;null!==n&&(E=e.isSpaceRoom()?l.a.createElement(g.a,i()({},Object(b.a)(n),{space:e,onFinished:()=>a(null)})):l.a.createElement(h.a,i()({},Object(b.a)(n),{room:e,onFinished:()=>a(null)}))),null!==r&&(w=l.a.createElement(p.a,i()({},Object(b.a)(r),{room:e,onFinished:()=>y(null)})));const S=o()("mx_SpotlightDialog_option--notifications",{mx_RoomNotificationContextMenu_iconBell:t===m.a.AllMessages,mx_RoomNotificationContextMenu_iconBellDot:t===m.a.AllMessagesLoud,mx_RoomNotificationContextMenu_iconBellMentions:t===m.a.MentionsOnly,mx_RoomNotificationContextMenu_iconBellCrossed:t===m.a.Mute});return l.a.createElement(s.Fragment,null,Object(v.a)(f.a.RoomOptionsMenu)&&l.a.createElement(c.a,{className:"mx_SpotlightDialog_option--menu",onClick:e=>{e.preventDefault(),e.stopPropagation();const t=e.target;a(t.getBoundingClientRect())},title:e.isSpaceRoom()?Object(u.b)("Space options"):Object(u.b)("Room options"),isExpanded:null!==n}),!e.isSpaceRoom()&&l.a.createElement(c.a,{className:S,onClick:e=>{e.preventDefault(),e.stopPropagation();const t=e.target;y(t.getBoundingClientRect())},title:Object(u.b)("Notification options"),isExpanded:null!==r}),E,w)}},1495:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var a=n(17),i=n.n(a),r=n(24),o=n.n(r),s=n(13),l=n.n(s),c=n(0),d=n.n(c),u=n(68),m=n(62);const h=["inputRef","className"],p=e=>{let{inputRef:t,className:n}=e,a=o()(e,h);const[r,s,c]=Object(u.i)(t);return d.a.createElement(m.a,i()({},a,{className:l()(n,"mx_SpotlightDialog_option"),onFocus:r,inputRef:c,tabIndex:-1,"aria-selected":s,role:"option"}))}},1496:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(45);function i(e){var t;const n=Object(a.h)(e);return null!==(t=null==n?void 0:n.primaryEntityId)&&void 0!==t?t:e}},1497:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 9a6 6 0 01-6 6v-2a4 4 0 000-8V3a6 6 0 016 6zM9 5a4 4 0 100 8V5zm8 4A8 8 0 111 9a8 8 0 0116 0z",fill:"#000"})))}t.default="img/element-icons/roomlist/dark-light-mode.87d7411.svg"},1498:function(e,t,n){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(t,"__esModule",{value:!0});var i=n(0),r=a(i),o=a(n(870)),s=a(n(17)),l=n(1499),c=n(1501),d=n(1520),u=n(1521),m=a(n(1523)),h=a(n(1524)),p=a(n(103));function g(e,t){}g.bind(null,"warn"),g.bind(null,"error");function b(){}function v(e,t,n){var a=t.map((function(t){var a=function(e,t){return s({},e,{},t)}(n,t.options);return e.addEventListener(t.eventName,t.fn,a),function(){e.removeEventListener(t.eventName,t.fn,a)}}));return function(){a.forEach((function(e){e()}))}}var f=!0,y="Invariant failed";function E(e){this.message=e}function w(e,t){if(!e)throw new E(f?y:y+": "+(t||""))}E.prototype.toString=function(){return this.message};var S=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).callbacks=null,t.unbind=b,t.onWindowError=function(e){var n=t.getCallbacks();n.isDragging()&&n.tryAbort(),e.error instanceof E&&e.preventDefault()},t.getCallbacks=function(){if(!t.callbacks)throw new Error("Unable to find AppCallbacks in <ErrorBoundary/>");return t.callbacks},t.setCallbacks=function(e){t.callbacks=e},t}o(t,e);var n=t.prototype;return n.componentDidMount=function(){this.unbind=v(window,[{eventName:"error",fn:this.onWindowError}])},n.componentDidCatch=function(e){if(!(e instanceof E))throw e;this.setState({})},n.componentWillUnmount=function(){this.unbind()},n.render=function(){return this.props.children(this.setCallbacks)},t}(r.Component),_=function(e){return e+1},C=function(e,t){var n=e.droppableId===t.droppableId,a=_(e.index),i=_(t.index);return n?"\n      You have moved the item from position "+a+"\n      to position "+i+"\n    ":"\n    You have moved the item from position "+a+"\n    in list "+e.droppableId+"\n    to list "+t.droppableId+"\n    in position "+i+"\n  "},O=function(e,t,n){return t.droppableId===n.droppableId?"\n      The item "+e+"\n      has been combined with "+n.draggableId:"\n      The item "+e+"\n      in list "+t.droppableId+"\n      has been combined with "+n.draggableId+"\n      in list "+n.droppableId+"\n    "},x=function(e){return"\n  The item has returned to its starting position\n  of "+_(e.index)+"\n"},k="\n  Press space bar to start a drag.\n  When dragging you can use the arrow keys to move the item around and escape to cancel.\n  Some screen readers may require you to be in focus mode or to use your pass through key\n",R=function(e){return"\n  You have lifted an item in position "+_(e.source.index)+"\n"},j=function(e){var t=e.destination;if(t)return C(e.source,t);var n=e.combine;return n?O(e.draggableId,e.source,n):"You are over an area that cannot be dropped on"},I=function(e){if("CANCEL"===e.reason)return"\n      Movement cancelled.\n      "+x(e.source)+"\n    ";var t=e.destination,n=e.combine;return t?"\n      You have dropped the item.\n      "+C(e.source,t)+"\n    ":n?"\n      You have dropped the item.\n      "+O(e.draggableId,e.source,n)+"\n    ":"\n    The item has been dropped while not over a drop area.\n    "+x(e.source)+"\n  "},T={x:0,y:0},P=function(e,t){return{x:e.x+t.x,y:e.y+t.y}},N=function(e,t){return{x:e.x-t.x,y:e.y-t.y}},D=function(e,t){return e.x===t.x&&e.y===t.y},M=function(e){return{x:0!==e.x?-e.x:0,y:0!==e.y?-e.y:0}},A=function(e,t,n){var a;return void 0===n&&(n=0),(a={})[e]=t,a["x"===e?"y":"x"]=n,a},L=function(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))},U=function(e,t){return Math.min.apply(Math,t.map((function(t){return L(e,t)})))},F=function(e){return function(t){return{x:e(t.x),y:e(t.y)}}},B=function(e,t){return{top:e.top+t.y,left:e.left+t.x,bottom:e.bottom+t.y,right:e.right+t.x}},V=function(e){return[{x:e.left,y:e.top},{x:e.right,y:e.top},{x:e.left,y:e.bottom},{x:e.right,y:e.bottom}]},W=function(e,t){return t&&t.shouldClipSubject?function(e,t){var n=u.getRect({top:Math.max(t.top,e.top),right:Math.min(t.right,e.right),bottom:Math.min(t.bottom,e.bottom),left:Math.max(t.left,e.left)});return n.width<=0||n.height<=0?null:n}(t.pageMarginBox,e):u.getRect(e)},z=function(e){var t=e.page,n=e.withPlaceholder,a=e.axis,i=e.frame,r=function(e,t){return t?B(e,t.scroll.diff.displacement):e}(t.marginBox,i),o=function(e,t,n){var a;return n&&n.increasedBy?s({},e,((a={})[t.end]=e[t.end]+n.increasedBy[t.line],a)):e}(r,a,n);return{page:t,withPlaceholder:n,active:W(o,i)}},H=function(e,t){e.frame||w(!1);var n=e.frame,a=N(t,n.scroll.initial),i=M(a),r=s({},n,{scroll:{initial:n.scroll.initial,current:t,diff:{value:a,displacement:i},max:n.scroll.max}}),o=z({page:e.subject.page,withPlaceholder:e.subject.withPlaceholder,axis:e.axis,frame:r});return s({},e,{frame:r,subject:o})};function G(e){return Object.values?Object.values(e):Object.keys(e).map((function(t){return e[t]}))}function K(e,t){if(e.findIndex)return e.findIndex(t);for(var n=0;n<e.length;n++)if(t(e[n]))return n;return-1}function q(e,t){if(e.find)return e.find(t);var n=K(e,t);return-1!==n?e[n]:void 0}function $(e){return Array.prototype.slice.call(e)}var Y=m((function(e){return e.reduce((function(e,t){return e[t.descriptor.id]=t,e}),{})})),J=m((function(e){return e.reduce((function(e,t){return e[t.descriptor.id]=t,e}),{})})),Q=m((function(e){return G(e)})),X=m((function(e){return G(e)})),Z=m((function(e,t){var n=X(t).filter((function(t){return e===t.descriptor.droppableId})).sort((function(e,t){return e.descriptor.index-t.descriptor.index}));return n}));function ee(e){return e.at&&"REORDER"===e.at.type?e.at.destination:null}function te(e){return e.at&&"COMBINE"===e.at.type?e.at.combine:null}var ne=m((function(e,t){return t.filter((function(t){return t.descriptor.id!==e.descriptor.id}))})),ae=function(e,t){return e.descriptor.droppableId===t.descriptor.id},ie={point:T,value:0},re={invisible:{},visible:{},all:[]},oe={displaced:re,displacedBy:ie,at:null},se=function(e,t){return function(n){return e<=n&&n<=t}},le=function(e){var t=se(e.top,e.bottom),n=se(e.left,e.right);return function(a){if(t(a.top)&&t(a.bottom)&&n(a.left)&&n(a.right))return!0;var i=t(a.top)||t(a.bottom),r=n(a.left)||n(a.right);if(i&&r)return!0;var o=a.top<e.top&&a.bottom>e.bottom,s=a.left<e.left&&a.right>e.right;return!(!o||!s)||(o&&r||s&&i)}},ce=function(e){var t=se(e.top,e.bottom),n=se(e.left,e.right);return function(e){return t(e.top)&&t(e.bottom)&&n(e.left)&&n(e.right)}},de={direction:"vertical",line:"y",crossAxisLine:"x",start:"top",end:"bottom",size:"height",crossAxisStart:"left",crossAxisEnd:"right",crossAxisSize:"width"},ue={direction:"horizontal",line:"x",crossAxisLine:"y",start:"left",end:"right",size:"width",crossAxisStart:"top",crossAxisEnd:"bottom",crossAxisSize:"height"},me=function(e){var t=e.target,n=e.destination,a=e.viewport,i=e.withDroppableDisplacement,r=e.isVisibleThroughFrameFn,o=i?function(e,t){var n=t.frame?t.frame.scroll.diff.displacement:T;return B(e,n)}(t,n):t;return function(e,t,n){return!!t.subject.active&&n(t.subject.active)(e)}(o,n,r)&&function(e,t,n){return n(t)(e)}(o,a,r)},he=function(e){return me(s({},e,{isVisibleThroughFrameFn:le}))},pe=function(e){return me(s({},e,{isVisibleThroughFrameFn:ce}))},ge=function(e,t,n){if("boolean"==typeof n)return n;if(!t)return!0;var a=t.invisible,i=t.visible;if(a[e])return!1;var r=i[e];return!r||r.shouldAnimate};function be(e){var t=e.afterDragging,n=e.destination,a=e.displacedBy,i=e.viewport,r=e.forceShouldAnimate,o=e.last;return t.reduce((function(e,t){var s=function(e,t){var n=e.page.marginBox,a={top:t.point.y,right:0,bottom:0,left:t.point.x};return u.getRect(u.expand(n,a))}(t,a),l=t.descriptor.id;if(e.all.push(l),!he({target:s,destination:n,viewport:i,withDroppableDisplacement:!0}))return e.invisible[t.descriptor.id]=!0,e;var c={draggableId:l,shouldAnimate:ge(l,o,r)};return e.visible[l]=c,e}),{all:[],visible:{},invisible:{}})}function ve(e){var t=e.insideDestination,n=e.inHomeList,a=e.displacedBy,i=e.destination,r=function(e,t){if(!e.length)return 0;var n=e[e.length-1].descriptor.index;return t.inHomeList?n:n+1}(t,{inHomeList:n});return{displaced:re,displacedBy:a,at:{type:"REORDER",destination:{droppableId:i.descriptor.id,index:r}}}}function fe(e){var t=e.draggable,n=e.insideDestination,a=e.destination,i=e.viewport,r=e.displacedBy,o=e.last,s=e.index,l=e.forceShouldAnimate,c=ae(t,a);if(null==s)return ve({insideDestination:n,inHomeList:c,displacedBy:r,destination:a});var d=q(n,(function(e){return e.descriptor.index===s}));if(!d)return ve({insideDestination:n,inHomeList:c,displacedBy:r,destination:a});var u=ne(t,n),m=n.indexOf(d);return{displaced:be({afterDragging:u.slice(m),destination:a,displacedBy:r,last:o,viewport:i.frame,forceShouldAnimate:l}),displacedBy:r,at:{type:"REORDER",destination:{droppableId:a.descriptor.id,index:s}}}}function ye(e,t){return Boolean(t.effected[e])}var Ee=function(e){var t=e.isMovingForward,n=e.isInHomeList,a=e.draggable,i=e.draggables,r=e.destination,o=e.insideDestination,s=e.previousImpact,l=e.viewport,c=e.afterCritical,d=s.at;if(d||w(!1),"REORDER"===d.type){var u=function(e){var t=e.isMovingForward,n=e.isInHomeList,a=e.insideDestination,i=e.location;if(!a.length)return null;var r=i.index,o=t?r+1:r-1,s=a[0].descriptor.index,l=a[a.length-1].descriptor.index;return o<s||o>(n?l:l+1)?null:o}({isMovingForward:t,isInHomeList:n,location:d.destination,insideDestination:o});return null==u?null:fe({draggable:a,insideDestination:o,destination:r,viewport:l,last:s.displaced,displacedBy:s.displacedBy,index:u})}var m=function(e){var t=e.isMovingForward,n=e.destination,a=e.draggables,i=e.combine,r=e.afterCritical;if(!n.isCombineEnabled)return null;var o=i.draggableId,s=a[o].descriptor.index;return ye(o,r)?t?s:s-1:t?s+1:s}({isMovingForward:t,destination:r,displaced:s.displaced,draggables:i,combine:d.combine,afterCritical:c});return null==m?null:fe({draggable:a,insideDestination:o,destination:r,viewport:l,last:s.displaced,displacedBy:s.displacedBy,index:m})},we=function(e){var t=e.afterCritical,n=e.impact,a=e.draggables,i=te(n);i||w(!1);var r=i.draggableId,o=a[r].page.borderBox.center,s=function(e){var t=e.displaced,n=e.afterCritical,a=e.combineWith,i=e.displacedBy,r=Boolean(t.visible[a]||t.invisible[a]);return ye(a,n)?r?T:M(i.point):r?i.point:T}({displaced:n.displaced,afterCritical:t,combineWith:r,displacedBy:n.displacedBy});return P(o,s)},Se=function(e,t){return t.margin[e.start]+t.borderBox[e.size]/2},_e=function(e,t,n){return t[e.crossAxisStart]+n.margin[e.crossAxisStart]+n.borderBox[e.crossAxisSize]/2},Ce=function(e){var t=e.axis,n=e.moveRelativeTo,a=e.isMoving;return A(t.line,n.marginBox[t.end]+Se(t,a),_e(t,n.marginBox,a))},Oe=function(e){var t=e.axis,n=e.moveRelativeTo,a=e.isMoving;return A(t.line,n.marginBox[t.start]-function(e,t){return t.margin[e.end]+t.borderBox[e.size]/2}(t,a),_e(t,n.marginBox,a))},xe=function(e){var t=e.impact,n=e.draggable,a=e.draggables,i=e.droppable,r=e.afterCritical,o=Z(i.descriptor.id,a),s=n.page,l=i.axis;if(!o.length)return function(e){var t=e.axis,n=e.moveInto,a=e.isMoving;return A(t.line,n.contentBox[t.start]+Se(t,a),_e(t,n.contentBox,a))}({axis:l,moveInto:i.page,isMoving:s});var c=t.displaced,d=t.displacedBy,m=c.all[0];if(m){var h=a[m];if(ye(m,r))return Oe({axis:l,moveRelativeTo:h.page,isMoving:s});var p=u.offset(h.page,d.point);return Oe({axis:l,moveRelativeTo:p,isMoving:s})}var g=o[o.length-1];if(g.descriptor.id===n.descriptor.id)return s.borderBox.center;if(ye(g.descriptor.id,r)){var b=u.offset(g.page,M(r.displacedBy.point));return Ce({axis:l,moveRelativeTo:b,isMoving:s})}return Ce({axis:l,moveRelativeTo:g.page,isMoving:s})},ke=function(e,t){var n=e.frame;return n?P(t,n.scroll.diff.displacement):t},Re=function(e){var t=function(e){var t=e.impact,n=e.draggable,a=e.droppable,i=e.draggables,r=e.afterCritical,o=n.page.borderBox.center,s=t.at;return a&&s?"REORDER"===s.type?xe({impact:t,draggable:n,draggables:i,droppable:a,afterCritical:r}):we({impact:t,draggables:i,afterCritical:r}):o}(e),n=e.droppable;return n?ke(n,t):t},je=function(e,t){var n=N(t,e.scroll.initial),a=M(n);return{frame:u.getRect({top:t.y,bottom:t.y+e.frame.height,left:t.x,right:t.x+e.frame.width}),scroll:{initial:e.scroll.initial,max:e.scroll.max,current:t,diff:{value:n,displacement:a}}}};function Ie(e,t){return e.map((function(e){return t[e]}))}var Te=function(e){var t=e.pageBorderBoxCenter,n=e.draggable,a=function(e,t){return P(e.scroll.diff.displacement,t)}(e.viewport,t),i=N(a,n.page.borderBox.center);return P(n.client.borderBox.center,i)},Pe=function(e){var t=e.draggable,n=e.destination,a=e.newPageBorderBoxCenter,i=e.viewport,r=e.withDroppableDisplacement,o=e.onlyOnMainAxis,l=void 0!==o&&o,c=N(a,t.page.borderBox.center),d={target:B(t.page.borderBox,c),destination:n,withDroppableDisplacement:r,viewport:i};return l?function(e){return me(s({},e,{isVisibleThroughFrameFn:(t=e.destination.axis,function(e){var n=se(e.top,e.bottom),a=se(e.left,e.right);return function(e){return t===de?n(e.top)&&n(e.bottom):a(e.left)&&a(e.right)}})}));var t}(d):pe(d)},Ne=function(e){var t=e.isMovingForward,n=e.draggable,a=e.destination,i=e.draggables,r=e.previousImpact,o=e.viewport,l=e.previousPageBorderBoxCenter,c=e.previousClientSelection,d=e.afterCritical;if(!a.isEnabled)return null;var u=Z(a.descriptor.id,i),m=ae(n,a),h=function(e){var t=e.isMovingForward,n=e.draggable,a=e.destination,i=e.insideDestination,r=e.previousImpact;if(!a.isCombineEnabled)return null;if(!ee(r))return null;function o(e){var t={type:"COMBINE",combine:{draggableId:e,droppableId:a.descriptor.id}};return s({},r,{at:t})}var l=r.displaced.all,c=l.length?l[0]:null;if(t)return c?o(c):null;var d=ne(n,i);if(!c)return d.length?o(d[d.length-1].descriptor.id):null;var u=K(d,(function(e){return e.descriptor.id===c}));-1===u&&w(!1);var m=u-1;return m<0?null:o(d[m].descriptor.id)}({isMovingForward:t,draggable:n,destination:a,insideDestination:u,previousImpact:r})||Ee({isMovingForward:t,isInHomeList:m,draggable:n,draggables:i,destination:a,insideDestination:u,previousImpact:r,viewport:o,afterCritical:d});if(!h)return null;var p=Re({impact:h,draggable:n,droppable:a,draggables:i,afterCritical:d});if(Pe({draggable:n,destination:a,newPageBorderBoxCenter:p,viewport:o.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0}))return{clientSelection:Te({pageBorderBoxCenter:p,draggable:n,viewport:o}),impact:h,scrollJumpRequest:null};var g=N(p,l),b=function(e){var t=e.impact,n=e.viewport,a=e.destination,i=e.draggables,r=e.maxScrollChange,o=je(n,P(n.scroll.current,r)),l=a.frame?H(a,P(a.frame.scroll.current,r)):a,c=t.displaced,d=be({afterDragging:Ie(c.all,i),destination:a,displacedBy:t.displacedBy,viewport:o.frame,last:c,forceShouldAnimate:!1}),u=be({afterDragging:Ie(c.all,i),destination:l,displacedBy:t.displacedBy,viewport:n.frame,last:c,forceShouldAnimate:!1}),m={},h={},p=[c,d,u];return c.all.forEach((function(e){var t=function(e,t){for(var n=0;n<t.length;n++){var a=t[n].visible[e];if(a)return a}return null}(e,p);t?h[e]=t:m[e]=!0})),s({},t,{displaced:{all:c.all,invisible:m,visible:h}})}({impact:h,viewport:o,destination:a,draggables:i,maxScrollChange:g});return{clientSelection:c,impact:b,scrollJumpRequest:g}},De=function(e){var t=e.subject.active;return t||w(!1),t},Me=function(e,t){var n=e.page.borderBox.center;return ye(e.descriptor.id,t)?N(n,t.displacedBy.point):n},Ae=function(e,t){var n=e.page.borderBox;return ye(e.descriptor.id,t)?B(n,M(t.displacedBy.point)):n},Le=m((function(e,t){var n=t[e.line];return{value:n,point:A(e.line,n)}})),Ue=function(e,t){return s({},e,{scroll:s({},e.scroll,{max:t})})},Fe=function(e,t,n){var a=e.frame;ae(t,e)&&w(!1),e.subject.withPlaceholder&&w(!1);var i=Le(e.axis,t.displaceBy).point,r=function(e,t,n){var a=e.axis;if("virtual"===e.descriptor.mode)return A(a.line,t[a.line]);var i=e.subject.page.contentBox[a.size],r=Z(e.descriptor.id,n).reduce((function(e,t){return e+t.client.marginBox[a.size]}),0)+t[a.line]-i;return r<=0?null:A(a.line,r)}(e,i,n),o={placeholderSize:i,increasedBy:r,oldFrameMaxScroll:e.frame?e.frame.scroll.max:null};if(!a){var l=z({page:e.subject.page,withPlaceholder:o,axis:e.axis,frame:e.frame});return s({},e,{subject:l})}var c=r?P(a.scroll.max,r):a.scroll.max,d=Ue(a,c),u=z({page:e.subject.page,withPlaceholder:o,axis:e.axis,frame:d});return s({},e,{subject:u,frame:d})},Be=function(e){var t=e.isMovingForward,n=e.previousPageBorderBoxCenter,a=e.draggable,i=e.isOver,r=e.draggables,o=e.droppables,s=e.viewport,l=e.afterCritical,c=function(e){var t=e.isMovingForward,n=e.pageBorderBoxCenter,a=e.source,i=e.droppables,r=e.viewport,o=a.subject.active;if(!o)return null;var s=a.axis,l=se(o[s.start],o[s.end]),c=Q(i).filter((function(e){return e!==a})).filter((function(e){return e.isEnabled})).filter((function(e){return Boolean(e.subject.active)})).filter((function(e){return le(r.frame)(De(e))})).filter((function(e){var n=De(e);return t?o[s.crossAxisEnd]<n[s.crossAxisEnd]:n[s.crossAxisStart]<o[s.crossAxisStart]})).filter((function(e){var t=De(e),n=se(t[s.start],t[s.end]);return l(t[s.start])||l(t[s.end])||n(o[s.start])||n(o[s.end])})).sort((function(e,n){var a=De(e)[s.crossAxisStart],i=De(n)[s.crossAxisStart];return t?a-i:i-a})).filter((function(e,t,n){return De(e)[s.crossAxisStart]===De(n[0])[s.crossAxisStart]}));if(!c.length)return null;if(1===c.length)return c[0];var d=c.filter((function(e){return se(De(e)[s.start],De(e)[s.end])(n[s.line])}));return 1===d.length?d[0]:d.length>1?d.sort((function(e,t){return De(e)[s.start]-De(t)[s.start]}))[0]:c.sort((function(e,t){var a=U(n,V(De(e))),i=U(n,V(De(t)));return a!==i?a-i:De(e)[s.start]-De(t)[s.start]}))[0]}({isMovingForward:t,pageBorderBoxCenter:n,source:i,droppables:o,viewport:s});if(!c)return null;var d=Z(c.descriptor.id,r),u=function(e){var t=e.pageBorderBoxCenter,n=e.viewport,a=e.destination,i=e.insideDestination,r=e.afterCritical,o=i.filter((function(e){return pe({target:Ae(e,r),destination:a,viewport:n.frame,withDroppableDisplacement:!0})})).sort((function(e,n){var i=L(t,ke(a,Me(e,r))),o=L(t,ke(a,Me(n,r)));return i<o?-1:o<i?1:e.descriptor.index-n.descriptor.index}));return o[0]||null}({pageBorderBoxCenter:n,viewport:s,destination:c,insideDestination:d,afterCritical:l}),m=function(e){var t=e.previousPageBorderBoxCenter,n=e.moveRelativeTo,a=e.insideDestination,i=e.draggable,r=e.draggables,o=e.destination,s=e.viewport,l=e.afterCritical;if(!n){if(a.length)return null;var c={displaced:re,displacedBy:ie,at:{type:"REORDER",destination:{droppableId:o.descriptor.id,index:0}}},d=Re({impact:c,draggable:i,droppable:o,draggables:r,afterCritical:l}),u=ae(i,o)?o:Fe(o,i,r);return Pe({draggable:i,destination:u,newPageBorderBoxCenter:d,viewport:s.frame,withDroppableDisplacement:!1,onlyOnMainAxis:!0})?c:null}var m,h=Boolean(t[o.axis.line]<=n.page.borderBox.center[o.axis.line]),p=(m=n.descriptor.index,n.descriptor.id===i.descriptor.id||h?m:m+1),g=Le(o.axis,i.displaceBy);return fe({draggable:i,insideDestination:a,destination:o,viewport:s,displacedBy:g,last:re,index:p})}({previousPageBorderBoxCenter:n,destination:c,draggable:a,draggables:r,moveRelativeTo:u,insideDestination:d,viewport:s,afterCritical:l});if(!m)return null;var h=Re({impact:m,draggable:a,droppable:c,draggables:r,afterCritical:l});return{clientSelection:Te({pageBorderBoxCenter:h,draggable:a,viewport:s}),impact:m,scrollJumpRequest:null}},Ve=function(e){var t=e.at;return t?"REORDER"===t.type?t.destination.droppableId:t.combine.droppableId:null},We=function(e){var t=e.state,n=e.type,a=function(e,t){var n=Ve(e);return n?t[n]:null}(t.impact,t.dimensions.droppables),i=Boolean(a),r=t.dimensions.droppables[t.critical.droppable.id],o=a||r,s=o.axis.direction,l="vertical"===s&&("MOVE_UP"===n||"MOVE_DOWN"===n)||"horizontal"===s&&("MOVE_LEFT"===n||"MOVE_RIGHT"===n);if(l&&!i)return null;var c="MOVE_DOWN"===n||"MOVE_RIGHT"===n,d=t.dimensions.draggables[t.critical.draggable.id],u=t.current.page.borderBoxCenter,m=t.dimensions,h=m.draggables,p=m.droppables;return l?Ne({isMovingForward:c,previousPageBorderBoxCenter:u,draggable:d,destination:o,draggables:h,viewport:t.viewport,previousClientSelection:t.current.client.selection,previousImpact:t.impact,afterCritical:t.afterCritical}):Be({isMovingForward:c,previousPageBorderBoxCenter:u,draggable:d,isOver:o,draggables:h,droppables:p,viewport:t.viewport,afterCritical:t.afterCritical})};function ze(e){return"DRAGGING"===e.phase||"COLLECTING"===e.phase}function He(e){var t=se(e.top,e.bottom),n=se(e.left,e.right);return function(e){return t(e.y)&&n(e.x)}}function Ge(e){var t=e.pageBorderBox,n=e.draggable,a=e.droppables,i=Q(a).filter((function(e){if(!e.isEnabled)return!1;var n,a,i=e.subject.active;if(!i)return!1;if(a=i,!((n=t).left<a.right&&n.right>a.left&&n.top<a.bottom&&n.bottom>a.top))return!1;if(He(i)(t.center))return!0;var r=e.axis,o=i.center[r.crossAxisLine],s=t[r.crossAxisStart],l=t[r.crossAxisEnd],c=se(i[r.crossAxisStart],i[r.crossAxisEnd]),d=c(s),u=c(l);return!d&&!u||(d?s<o:l>o)}));return i.length?1===i.length?i[0].descriptor.id:function(e){var t=e.pageBorderBox,n=e.draggable,a=e.candidates,i=n.page.borderBox.center,r=a.map((function(e){var n=e.axis,a=A(e.axis.line,t.center[n.line],e.page.borderBox.center[n.crossAxisLine]);return{id:e.descriptor.id,distance:L(i,a)}})).sort((function(e,t){return t.distance-e.distance}));return r[0]?r[0].id:null}({pageBorderBox:t,draggable:n,candidates:i}):null}var Ke=function(e,t){return u.getRect(B(e,t))};function qe(e){var t=e.displaced,n=e.id;return Boolean(t.visible[n]||t.invisible[n])}var $e=function(e){var t=e.pageOffset,n=e.draggable,a=e.draggables,i=e.droppables,r=e.previousImpact,o=e.viewport,s=e.afterCritical,l=Ke(n.page.borderBox,t),c=Ge({pageBorderBox:l,draggable:n,droppables:i});if(!c)return oe;var d=i[c],u=Z(d.descriptor.id,a),m=function(e,t){var n=e.frame;return n?Ke(t,n.scroll.diff.value):t}(d,l);return function(e){var t=e.draggable,n=e.pageBorderBoxWithDroppableScroll,a=e.previousImpact,i=e.destination,r=e.insideDestination,o=e.afterCritical;if(!i.isCombineEnabled)return null;var s=i.axis,l=Le(i.axis,t.displaceBy),c=l.value,d=n[s.start],u=n[s.end],m=q(ne(t,r),(function(e){var t=e.descriptor.id,n=e.page.borderBox,i=n[s.size]/4,r=ye(t,o),l=qe({displaced:a.displaced,id:t});return r?l?u>n[s.start]+i&&u<n[s.end]-i:d>n[s.start]-c+i&&d<n[s.end]-c-i:l?u>n[s.start]+c+i&&u<n[s.end]+c-i:d>n[s.start]+i&&d<n[s.end]-i}));return m?{displacedBy:l,displaced:a.displaced,at:{type:"COMBINE",combine:{draggableId:m.descriptor.id,droppableId:i.descriptor.id}}}:null}({pageBorderBoxWithDroppableScroll:m,draggable:n,previousImpact:r,destination:d,insideDestination:u,afterCritical:s})||function(e){var t=e.pageBorderBoxWithDroppableScroll,n=e.draggable,a=e.destination,i=e.insideDestination,r=e.last,o=e.viewport,s=e.afterCritical,l=a.axis,c=Le(a.axis,n.displaceBy),d=c.value,u=t[l.start],m=t[l.end],h=function(e){var t=e.draggable,n=e.closest,a=e.inHomeList;return n?a&&n.descriptor.index>t.descriptor.index?n.descriptor.index-1:n.descriptor.index:null}({draggable:n,closest:q(ne(n,i),(function(e){var t=e.descriptor.id,n=e.page.borderBox.center[l.line],a=ye(t,s),i=qe({displaced:r,id:t});return a?i?m<=n:u<n-d:i?m<=n+d:u<n})),inHomeList:ae(n,a)});return fe({draggable:n,insideDestination:i,destination:a,viewport:o,last:r,displacedBy:c,index:h})}({pageBorderBoxWithDroppableScroll:m,draggable:n,destination:d,insideDestination:u,last:r.displaced,viewport:o,afterCritical:s})},Ye=function(e,t){var n;return s({},e,((n={})[t.descriptor.id]=t,n))},Je=function(e){var t=e.previousImpact,n=e.impact,a=e.droppables,i=Ve(t),r=Ve(n);if(!i)return a;if(i===r)return a;var o=a[i];if(!o.subject.withPlaceholder)return a;var l=function(e){var t=e.subject.withPlaceholder;t||w(!1);var n=e.frame;if(!n){var a=z({page:e.subject.page,axis:e.axis,frame:null,withPlaceholder:null});return s({},e,{subject:a})}var i=t.oldFrameMaxScroll;i||w(!1);var r=Ue(n,i),o=z({page:e.subject.page,axis:e.axis,frame:r,withPlaceholder:null});return s({},e,{subject:o,frame:r})}(o);return Ye(a,l)},Qe=function(e){var t=e.state,n=e.clientSelection,a=e.dimensions,i=e.viewport,r=e.impact,o=e.scrollJumpRequest,l=i||t.viewport,c=a||t.dimensions,d=n||t.current.client.selection,u=N(d,t.initial.client.selection),m={offset:u,selection:d,borderBoxCenter:P(t.initial.client.borderBoxCenter,u)},h={selection:P(m.selection,l.scroll.current),borderBoxCenter:P(m.borderBoxCenter,l.scroll.current),offset:P(m.offset,l.scroll.diff.value)},p={client:m,page:h};if("COLLECTING"===t.phase)return s({phase:"COLLECTING"},t,{dimensions:c,viewport:l,current:p});var g=c.draggables[t.critical.draggable.id],b=r||$e({pageOffset:h.offset,draggable:g,draggables:c.draggables,droppables:c.droppables,previousImpact:t.impact,viewport:l,afterCritical:t.afterCritical}),v=function(e){var t=e.draggable,n=e.draggables,a=e.droppables,i=e.previousImpact,r=e.impact,o=Je({previousImpact:i,impact:r,droppables:a}),s=Ve(r);if(!s)return o;var l=a[s];if(ae(t,l))return o;if(l.subject.withPlaceholder)return o;var c=Fe(l,t,n);return Ye(o,c)}({draggable:g,impact:b,previousImpact:t.impact,draggables:c.draggables,droppables:c.droppables});return s({},t,{current:p,dimensions:{draggables:c.draggables,droppables:v},impact:b,viewport:l,scrollJumpRequest:o||null,forceShouldAnimate:!o&&null})};var Xe=function(e){var t=e.impact,n=e.viewport,a=e.draggables,i=e.destination,r=e.forceShouldAnimate,o=t.displaced,l=function(e,t){return e.map((function(e){return t[e]}))}(o.all,a),c=be({afterDragging:l,destination:i,displacedBy:t.displacedBy,viewport:n.frame,forceShouldAnimate:r,last:o});return s({},t,{displaced:c})},Ze=function(e){var t=e.impact,n=e.draggable,a=e.droppable,i=e.draggables,r=e.viewport,o=e.afterCritical,s=Re({impact:t,draggable:n,draggables:i,droppable:a,afterCritical:o});return Te({pageBorderBoxCenter:s,draggable:n,viewport:r})},et=function(e){var t=e.state,n=e.dimensions,a=e.viewport;"SNAP"!==t.movementMode&&w(!1);var i=t.impact,r=a||t.viewport,o=n||t.dimensions,s=o.draggables,l=o.droppables,c=s[t.critical.draggable.id],d=Ve(i);d||w(!1);var u=l[d],m=Xe({impact:i,viewport:r,destination:u,draggables:s}),h=Ze({impact:m,draggable:c,droppable:u,draggables:s,viewport:r,afterCritical:t.afterCritical});return Qe({impact:m,clientSelection:h,state:t,dimensions:o,viewport:r})},tt=function(e){var t=e.draggable,n=e.home,a=e.draggables,i=e.viewport,r=Le(n.axis,t.displaceBy),o=Z(n.descriptor.id,a),s=o.indexOf(t);-1===s&&w(!1);var l,c=o.slice(s+1),d=c.reduce((function(e,t){return e[t.descriptor.id]=!0,e}),{}),u={inVirtualList:"virtual"===n.descriptor.mode,displacedBy:r,effected:d};return{impact:{displaced:be({afterDragging:c,destination:n,displacedBy:r,last:null,viewport:i.frame,forceShouldAnimate:!1}),displacedBy:r,at:{type:"REORDER",destination:(l=t.descriptor,{index:l.index,droppableId:l.droppableId})}},afterCritical:u}},nt=function(e){0},at=function(e){0},it=function(e){var t=e.additions,n=e.updatedDroppables,a=e.viewport,i=a.scroll.diff.value;return t.map((function(e){var t=e.descriptor.droppableId,r=function(e){var t=e.frame;return t||w(!1),t}(n[t]),o=r.scroll.diff.value,l=function(e){var t=e.draggable,n=e.offset,a=e.initialWindowScroll,i=u.offset(t.client,n),r=u.withScroll(i,a);return s({},t,{placeholder:s({},t.placeholder,{client:i}),client:i,page:r})}({draggable:e,offset:P(i,o),initialWindowScroll:a.scroll.initial});return l}))},rt=function(e){return"SNAP"===e.movementMode},ot=function(e,t,n){var a=function(e,t){return{draggables:e.draggables,droppables:Ye(e.droppables,t)}}(e.dimensions,t);return!rt(e)||n?Qe({state:e,dimensions:a}):et({state:e,dimensions:a})};function st(e){return e.isDragging&&"SNAP"===e.movementMode?s({phase:"DRAGGING"},e,{scrollJumpRequest:null}):e}var lt={phase:"IDLE",completed:null,shouldFlush:!1},ct=function(e,t){if(void 0===e&&(e=lt),"FLUSH"===t.type)return s({},lt,{shouldFlush:!0});if("INITIAL_PUBLISH"===t.type){"IDLE"!==e.phase&&w(!1);var n=t.payload,a=n.critical,i=n.clientSelection,r=n.viewport,o=n.dimensions,l=n.movementMode,c=o.draggables[a.draggable.id],d=o.droppables[a.droppable.id],u={selection:i,borderBoxCenter:c.client.borderBox.center,offset:T},m={client:u,page:{selection:P(u.selection,r.scroll.initial),borderBoxCenter:P(u.selection,r.scroll.initial),offset:P(u.selection,r.scroll.diff.value)}},h=Q(o.droppables).every((function(e){return!e.isFixedOnPage})),p=tt({draggable:c,home:d,draggables:o.draggables,viewport:r}),g=p.impact;return{phase:"DRAGGING",isDragging:!0,critical:a,movementMode:l,dimensions:o,initial:m,current:m,isWindowScrollAllowed:h,impact:g,afterCritical:p.afterCritical,onLiftImpact:g,viewport:r,scrollJumpRequest:null,forceShouldAnimate:null}}if("COLLECTION_STARTING"===t.type)return"COLLECTING"===e.phase||"DROP_PENDING"===e.phase?e:("DRAGGING"!==e.phase&&w(!1),s({phase:"COLLECTING"},e,{phase:"COLLECTING"}));if("PUBLISH_WHILE_DRAGGING"===t.type)return"COLLECTING"!==e.phase&&"DROP_PENDING"!==e.phase&&w(!1),function(e){var t=e.state,n=e.published;nt();var a=n.modified.map((function(e){var n=t.dimensions.droppables[e.droppableId];return H(n,e.scroll)})),i=s({},t.dimensions.droppables,{},Y(a)),r=J(it({additions:n.additions,updatedDroppables:i,viewport:t.viewport})),o=s({},t.dimensions.draggables,{},r);n.removals.forEach((function(e){delete o[e]}));var l={droppables:i,draggables:o},c=Ve(t.impact),d=c?l.droppables[c]:null,u=l.draggables[t.critical.draggable.id],m=l.droppables[t.critical.droppable.id],h=tt({draggable:u,home:m,draggables:o,viewport:t.viewport}),p=h.impact,g=h.afterCritical,b=d&&d.isCombineEnabled?t.impact:p,v=$e({pageOffset:t.current.page.offset,draggable:l.draggables[t.critical.draggable.id],draggables:l.draggables,droppables:l.droppables,previousImpact:b,viewport:t.viewport,afterCritical:g});at();var f=s({phase:"DRAGGING"},t,{phase:"DRAGGING",impact:v,onLiftImpact:p,dimensions:l,afterCritical:g,forceShouldAnimate:!1});return"COLLECTING"===t.phase?f:s({phase:"DROP_PENDING"},f,{phase:"DROP_PENDING",reason:t.reason,isWaiting:!1})}({state:e,published:t.payload});if("MOVE"===t.type){if("DROP_PENDING"===e.phase)return e;ze(e)||w(!1);var b=t.payload.client;return D(b,e.current.client.selection)?e:Qe({state:e,clientSelection:b,impact:rt(e)?e.impact:null})}if("UPDATE_DROPPABLE_SCROLL"===t.type){if("DROP_PENDING"===e.phase)return st(e);if("COLLECTING"===e.phase)return st(e);ze(e)||w(!1);var v=t.payload,f=v.id,y=v.newScroll,E=e.dimensions.droppables[f];if(!E)return e;var S=H(E,y);return ot(e,S,!1)}if("UPDATE_DROPPABLE_IS_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;ze(e)||w(!1);var _=t.payload,C=_.id,O=_.isEnabled,x=e.dimensions.droppables[C];x||w(!1),x.isEnabled===O&&w(!1);var k=s({},x,{isEnabled:O});return ot(e,k,!0)}if("UPDATE_DROPPABLE_IS_COMBINE_ENABLED"===t.type){if("DROP_PENDING"===e.phase)return e;ze(e)||w(!1);var R=t.payload,j=R.id,I=R.isCombineEnabled,N=e.dimensions.droppables[j];N||w(!1),N.isCombineEnabled===I&&w(!1);var M=s({},N,{isCombineEnabled:I});return ot(e,M,!0)}if("MOVE_BY_WINDOW_SCROLL"===t.type){if("DROP_PENDING"===e.phase||"DROP_ANIMATING"===e.phase)return e;ze(e)||w(!1),e.isWindowScrollAllowed||w(!1);var A=t.payload.newScroll;if(D(e.viewport.scroll.current,A))return st(e);var L=je(e.viewport,A);return rt(e)?et({state:e,viewport:L}):Qe({state:e,viewport:L})}if("UPDATE_VIEWPORT_MAX_SCROLL"===t.type){if(!ze(e))return e;var U=t.payload.maxScroll;if(D(U,e.viewport.scroll.max))return e;var F=s({},e.viewport,{scroll:s({},e.viewport.scroll,{max:U})});return s({phase:"DRAGGING"},e,{viewport:F})}if("MOVE_UP"===t.type||"MOVE_DOWN"===t.type||"MOVE_LEFT"===t.type||"MOVE_RIGHT"===t.type){if("COLLECTING"===e.phase||"DROP_PENDING"===e.phase)return e;"DRAGGING"!==e.phase&&w(!1);var B=We({state:e,type:t.type});return B?Qe({state:e,impact:B.impact,clientSelection:B.clientSelection,scrollJumpRequest:B.scrollJumpRequest}):e}if("DROP_PENDING"===t.type){var V=t.payload.reason;return"COLLECTING"!==e.phase&&w(!1),s({phase:"DROP_PENDING"},e,{phase:"DROP_PENDING",isWaiting:!0,reason:V})}if("DROP_ANIMATE"===t.type){var W=t.payload,z=W.completed,G=W.dropDuration,K=W.newHomeClientOffset;return"DRAGGING"!==e.phase&&"DROP_PENDING"!==e.phase&&w(!1),{phase:"DROP_ANIMATING",completed:z,dropDuration:G,newHomeClientOffset:K,dimensions:e.dimensions}}return"DROP_COMPLETE"===t.type?{phase:"IDLE",completed:t.payload.completed,shouldFlush:!1}:e},dt=function(e){return{type:"LIFT",payload:e}},ut=function(e){return{type:"PUBLISH_WHILE_DRAGGING",payload:e}},mt=function(){return{type:"COLLECTION_STARTING",payload:null}},ht=function(e){return{type:"UPDATE_DROPPABLE_SCROLL",payload:e}},pt=function(e){return{type:"UPDATE_DROPPABLE_IS_ENABLED",payload:e}},gt=function(e){return{type:"UPDATE_DROPPABLE_IS_COMBINE_ENABLED",payload:e}},bt=function(e){return{type:"MOVE",payload:e}},vt=function(){return{type:"MOVE_UP",payload:null}},ft=function(){return{type:"MOVE_DOWN",payload:null}},yt=function(){return{type:"MOVE_RIGHT",payload:null}},Et=function(){return{type:"MOVE_LEFT",payload:null}},wt=function(){return{type:"FLUSH",payload:null}},St=function(e){return{type:"DROP_COMPLETE",payload:e}},_t=function(e){return{type:"DROP",payload:e}},Ct=function(){return{type:"DROP_ANIMATION_FINISHED",payload:null}};var Ot="cubic-bezier(.2,1,.1,1)",xt={drop:0,combining:.7},kt={drop:.75},Rt=.2+"s "+"cubic-bezier(0.2, 0, 0, 1)",jt={fluid:"opacity "+Rt,snap:"transform "+Rt+", opacity "+Rt,drop:function(e){var t=e+"s "+Ot;return"transform "+t+", opacity "+t},outOfTheWay:"transform "+Rt,placeholder:"height "+Rt+", width "+Rt+", margin "+Rt},It=function(e){return D(e,T)?null:"translate("+e.x+"px, "+e.y+"px)"},Tt={moveTo:It,drop:function(e,t){var n=It(e);return n?t?n+" scale("+kt.drop+")":n:null}},Pt=.33,Nt=.55,Dt=Nt-Pt,Mt=function(e){var t=e.getState,n=e.dispatch;return function(e){return function(a){if("DROP"===a.type){var i=t(),r=a.payload.reason;if("COLLECTING"!==i.phase){if("IDLE"!==i.phase){"DROP_PENDING"===i.phase&&i.isWaiting&&w(!1),"DRAGGING"!==i.phase&&"DROP_PENDING"!==i.phase&&w(!1);var o=i.critical,l=i.dimensions,c=l.draggables[i.critical.draggable.id],d=function(e){var t=e.draggables,n=e.reason,a=e.lastImpact,i=e.home,r=e.viewport,o=e.onLiftImpact;return a.at&&"DROP"===n?"REORDER"===a.at.type?{impact:a,didDropInsideDroppable:!0}:{impact:s({},a,{displaced:re}),didDropInsideDroppable:!0}:{impact:Xe({draggables:t,impact:o,destination:i,viewport:r,forceShouldAnimate:!0}),didDropInsideDroppable:!1}}({reason:r,lastImpact:i.impact,afterCritical:i.afterCritical,onLiftImpact:i.onLiftImpact,home:i.dimensions.droppables[i.critical.droppable.id],viewport:i.viewport,draggables:i.dimensions.draggables}),u=d.impact,m=d.didDropInsideDroppable,h=m?ee(u):null,p=m?te(u):null,g={index:o.draggable.index,droppableId:o.droppable.id},b={draggableId:c.descriptor.id,type:c.descriptor.type,source:g,reason:r,mode:i.movementMode,destination:h,combine:p},v=function(e){var t=e.impact,n=e.draggable,a=e.dimensions,i=e.viewport,r=e.afterCritical,o=a.draggables,s=a.droppables,l=Ve(t),c=l?s[l]:null,d=s[n.descriptor.droppableId],u=Ze({impact:t,draggable:n,draggables:o,afterCritical:r,droppable:c||d,viewport:i});return N(u,n.client.borderBox.center)}({impact:u,draggable:c,dimensions:l,viewport:i.viewport,afterCritical:i.afterCritical}),f={critical:i.critical,afterCritical:i.afterCritical,result:b,impact:u};if(!D(i.current.client.offset,v)||Boolean(b.combine)){var y=function(e){var t=e.current,n=e.destination,a=e.reason,i=L(t,n);if(i<=0)return Pt;if(i>=1500)return Nt;var r=Pt+Dt*(i/1500);return Number(("CANCEL"===a?.6*r:r).toFixed(2))}({current:i.current.client.offset,destination:v,reason:r});n(function(e){return{type:"DROP_ANIMATE",payload:e}}({newHomeClientOffset:v,dropDuration:y,completed:f}))}else n(St({completed:f}))}}else n(function(e){return{type:"DROP_PENDING",payload:e}}({reason:r}))}else e(a)}}},At=function(){return{x:window.pageXOffset,y:window.pageYOffset}};function Lt(e){var t=e.onWindowScroll;var n=h((function(){t(At())})),a=function(e){return{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(t){t.target!==window&&t.target!==window.document||e()}}}(n),i=b;function r(){return i!==b}return{start:function(){r()&&w(!1),i=v(window,[a])},stop:function(){r()||w(!1),n.cancel(),i(),i=b},isActive:r}}var Ut=function(e){var t=Lt({onWindowScroll:function(t){e.dispatch({type:"MOVE_BY_WINDOW_SCROLL",payload:{newScroll:t}})}});return function(e){return function(n){t.isActive()||"INITIAL_PUBLISH"!==n.type||t.start(),t.isActive()&&function(e){return"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type}(n)&&t.stop(),e(n)}}},Ft=function(){var e=[];return{add:function(t){var n=setTimeout((function(){return function(t){var n=K(e,(function(e){return e.timerId===t}));-1===n&&w(!1),e.splice(n,1)[0].callback()}(n)})),a={timerId:n,callback:t};e.push(a)},flush:function(){if(e.length){var t=[].concat(e);e.length=0,t.forEach((function(e){clearTimeout(e.timerId),e.callback()}))}}}},Bt=function(e,t){nt(),t(),at()},Vt=function(e,t){return{draggableId:e.draggable.id,type:e.droppable.type,source:{droppableId:e.droppable.id,index:e.draggable.index},mode:t}},Wt=function(e,t,n,a){if(e){var i=function(e){var t=!1,n=!1,a=setTimeout((function(){n=!0})),i=function(i){t||n||(t=!0,e(i),clearTimeout(a))};return i.wasCalled=function(){return t},i}(n);e(t,{announce:i}),i.wasCalled()||n(a(t))}else n(a(t))},zt=function(e,t){var n=function(e,t){var n=Ft(),a=null,i=function(n){a||w(!1),a=null,Bt(0,(function(){return Wt(e().onDragEnd,n,t,I)}))};return{beforeCapture:function(t,n){a&&w(!1),Bt(0,(function(){var a=e().onBeforeCapture;a&&a({draggableId:t,mode:n})}))},beforeStart:function(t,n){a&&w(!1),Bt(0,(function(){var a=e().onBeforeDragStart;a&&a(Vt(t,n))}))},start:function(i,r){a&&w(!1);var o=Vt(i,r);a={mode:r,lastCritical:i,lastLocation:o.source,lastCombine:null},n.add((function(){Bt(0,(function(){return Wt(e().onDragStart,o,t,R)}))}))},update:function(i,r){var o=ee(r),l=te(r);a||w(!1);var c=!function(e,t){if(e===t)return!0;var n=e.draggable.id===t.draggable.id&&e.draggable.droppableId===t.draggable.droppableId&&e.draggable.type===t.draggable.type&&e.draggable.index===t.draggable.index,a=e.droppable.id===t.droppable.id&&e.droppable.type===t.droppable.type;return n&&a}(i,a.lastCritical);c&&(a.lastCritical=i);var d,u,m=(u=o,!(null==(d=a.lastLocation)&&null==u||null!=d&&null!=u&&d.droppableId===u.droppableId&&d.index===u.index));m&&(a.lastLocation=o);var h=!function(e,t){return null==e&&null==t||null!=e&&null!=t&&e.draggableId===t.draggableId&&e.droppableId===t.droppableId}(a.lastCombine,l);if(h&&(a.lastCombine=l),c||m||h){var p=s({},Vt(i,a.mode),{combine:l,destination:o});n.add((function(){Bt(0,(function(){return Wt(e().onDragUpdate,p,t,j)}))}))}},flush:function(){a||w(!1),n.flush()},drop:i,abort:function(){if(a){var e=s({},Vt(a.lastCritical,a.mode),{combine:null,destination:null,reason:"CANCEL"});i(e)}}}}(e,t);return function(e){return function(t){return function(a){if("BEFORE_INITIAL_CAPTURE"!==a.type){if("INITIAL_PUBLISH"===a.type){var i=a.payload.critical;return n.beforeStart(i,a.payload.movementMode),t(a),void n.start(i,a.payload.movementMode)}if("DROP_COMPLETE"===a.type){var r=a.payload.completed.result;return n.flush(),t(a),void n.drop(r)}if(t(a),"FLUSH"!==a.type){var o=e.getState();"DRAGGING"===o.phase&&n.update(o.critical,o.impact)}else n.abort()}else n.beforeCapture(a.payload.draggableId,a.payload.movementMode)}}}},Ht=function(e){return function(t){return function(n){if("DROP_ANIMATION_FINISHED"===n.type){var a=e.getState();"DROP_ANIMATING"!==a.phase&&w(!1),e.dispatch(St({completed:a.completed}))}else t(n)}}},Gt=function(e){var t=null,n=null;return function(a){return function(i){if("FLUSH"!==i.type&&"DROP_COMPLETE"!==i.type&&"DROP_ANIMATION_FINISHED"!==i.type||(n&&(cancelAnimationFrame(n),n=null),t&&(t(),t=null)),a(i),"DROP_ANIMATE"===i.type){var r={eventName:"scroll",options:{capture:!0,passive:!1,once:!0},fn:function(){"DROP_ANIMATING"===e.getState().phase&&e.dispatch({type:"DROP_ANIMATION_FINISHED",payload:null})}};n=requestAnimationFrame((function(){n=null,t=v(window,[r])}))}}}},Kt=function(e){return function(t){return function(n){if(t(n),"PUBLISH_WHILE_DRAGGING"===n.type){var a=e.getState();"DROP_PENDING"===a.phase&&(a.isWaiting||e.dispatch(_t({reason:a.reason})))}}}},qt=l.compose,$t=function(e){var t,n=e.dimensionMarshal,a=e.focusMarshal,i=e.styleMarshal,r=e.getResponders,o=e.announce,s=e.autoScroller;return l.createStore(ct,qt(l.applyMiddleware((t=i,function(){return function(e){return function(n){"INITIAL_PUBLISH"===n.type&&t.dragging(),"DROP_ANIMATE"===n.type&&t.dropping(n.payload.completed.result.reason),"FLUSH"!==n.type&&"DROP_COMPLETE"!==n.type||t.resting(),e(n)}}}),function(e){return function(){return function(t){return function(n){"DROP_COMPLETE"!==n.type&&"FLUSH"!==n.type&&"DROP_ANIMATE"!==n.type||e.stopPublishing(),t(n)}}}}(n),function(e){return function(t){var n=t.getState,a=t.dispatch;return function(t){return function(i){if("LIFT"===i.type){var r=i.payload,o=r.id,s=r.clientSelection,l=r.movementMode,c=n();"DROP_ANIMATING"===c.phase&&a(St({completed:c.completed})),"IDLE"!==n().phase&&w(!1),a(wt()),a({type:"BEFORE_INITIAL_CAPTURE",payload:{draggableId:o,movementMode:l}});var d={draggableId:o,scrollOptions:{shouldPublishImmediately:"SNAP"===l}},u=e.startPublishing(d),m=u.critical,h=u.dimensions,p=u.viewport;a({type:"INITIAL_PUBLISH",payload:{critical:m,dimensions:h,clientSelection:s,movementMode:l,viewport:p}})}else t(i)}}}}(n),Mt,Ht,Gt,Kt,function(e){return function(t){return function(n){return function(a){if(function(e){return"DROP_COMPLETE"===e.type||"DROP_ANIMATE"===e.type||"FLUSH"===e.type}(a))return e.stop(),void n(a);if("INITIAL_PUBLISH"===a.type){n(a);var i=t.getState();return"DRAGGING"!==i.phase&&w(!1),void e.start(i)}n(a),e.scroll(t.getState())}}}}(s),Ut,function(e){var t=!1;return function(){return function(n){return function(a){if("INITIAL_PUBLISH"===a.type)return t=!0,e.tryRecordFocus(a.payload.critical.draggable.id),n(a),void e.tryRestoreFocusRecorded();if(n(a),t){if("FLUSH"===a.type)return t=!1,void e.tryRestoreFocusRecorded();if("DROP_COMPLETE"===a.type){t=!1;var i=a.payload.completed.result;i.combine&&e.tryShiftRecord(i.draggableId,i.combine.draggableId),e.tryRestoreFocusRecorded()}}}}}}(a),zt(r,o))))};var Yt=function(e){var t=e.scrollHeight,n=e.scrollWidth,a=e.height,i=e.width,r=N({x:n,y:t},{x:i,y:a});return{x:Math.max(0,r.x),y:Math.max(0,r.y)}},Jt=function(){var e=document.documentElement;return e||w(!1),e},Qt=function(){var e=Jt();return Yt({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,width:e.clientWidth,height:e.clientHeight})},Xt=function(e){var t=e.critical,n=e.scrollOptions,a=e.registry;nt();var i=function(){var e=At(),t=Qt(),n=e.y,a=e.x,i=Jt(),r=a+i.clientWidth,o=n+i.clientHeight;return{frame:u.getRect({top:n,left:a,right:r,bottom:o}),scroll:{initial:e,current:e,max:t,diff:{value:T,displacement:T}}}}(),r=i.scroll.current,o=t.droppable,s=a.droppable.getAllByType(o.type).map((function(e){return e.callbacks.getDimensionAndWatchScroll(r,n)})),l=a.draggable.getAllByType(t.draggable.type).map((function(e){return e.getDimension(r)})),c={draggables:J(l),droppables:Y(s)};return at(),{dimensions:c,critical:t,viewport:i}};function Zt(e,t,n){return n.descriptor.id!==t.id&&(n.descriptor.type===t.type&&"virtual"===e.droppable.getById(n.descriptor.droppableId).descriptor.mode)}var en,tn,nn=function(e,t){var n=null,a=function(e){var t=e.registry,n=e.callbacks,a={additions:{},removals:{},modified:{}},i=null,r=function(){i||(n.collectionStarting(),i=requestAnimationFrame((function(){i=null,nt();var e=a,r=e.additions,o=e.removals,s=e.modified,l=Object.keys(r).map((function(e){return t.draggable.getById(e).getDimension(T)})).sort((function(e,t){return e.descriptor.index-t.descriptor.index})),c=Object.keys(s).map((function(e){return{droppableId:e,scroll:t.droppable.getById(e).callbacks.getScrollWhileDragging()}})),d={additions:l,removals:Object.keys(o),modified:c};a={additions:{},removals:{},modified:{}},at(),n.publish(d)})))};return{add:function(e){var t=e.descriptor.id;a.additions[t]=e,a.modified[e.descriptor.droppableId]=!0,a.removals[t]&&delete a.removals[t],r()},remove:function(e){var t=e.descriptor;a.removals[t.id]=!0,a.modified[t.droppableId]=!0,a.additions[t.id]&&delete a.additions[t.id],r()},stop:function(){i&&(cancelAnimationFrame(i),i=null,a={additions:{},removals:{},modified:{}})}}}({callbacks:{publish:t.publishWhileDragging,collectionStarting:t.collectionStarting},registry:e}),i=function(t){n||w(!1);var i=n.critical.draggable;"ADDITION"===t.type&&Zt(e,i,t.value)&&a.add(t.value),"REMOVAL"===t.type&&Zt(e,i,t.value)&&a.remove(t.value)},r={updateDroppableIsEnabled:function(a,i){e.droppable.exists(a)||w(!1),n&&t.updateDroppableIsEnabled({id:a,isEnabled:i})},updateDroppableIsCombineEnabled:function(a,i){n&&(e.droppable.exists(a)||w(!1),t.updateDroppableIsCombineEnabled({id:a,isCombineEnabled:i}))},scrollDroppable:function(t,a){n&&e.droppable.getById(t).callbacks.scroll(a)},updateDroppableScroll:function(a,i){n&&(e.droppable.exists(a)||w(!1),t.updateDroppableScroll({id:a,newScroll:i}))},startPublishing:function(t){n&&w(!1);var a=e.draggable.getById(t.draggableId),r=e.droppable.getById(a.descriptor.droppableId),o={draggable:a.descriptor,droppable:r.descriptor},s=e.subscribe(i);return n={critical:o,unsubscribe:s},Xt({critical:o,registry:e,scrollOptions:t.scrollOptions})},stopPublishing:function(){if(n){a.stop();var t=n.critical.droppable;e.droppable.getAllByType(t.type).forEach((function(e){return e.callbacks.dragStopped()})),n.unsubscribe(),n=null}}};return r},an=function(e,t){return"IDLE"===e.phase||"DROP_ANIMATING"===e.phase&&(e.completed.result.draggableId!==t&&"DROP"===e.completed.result.reason)},rn=function(e){window.scrollBy(e.x,e.y)},on=m((function(e){return Q(e).filter((function(e){return!!e.isEnabled&&!!e.frame}))})),sn=function(e){var t=e.center,n=e.destination,a=e.droppables;if(n){var i=a[n];return i.frame?i:null}var r=function(e,t){var n=q(on(t),(function(t){return t.frame||w(!1),He(t.frame.pageMarginBox)(e)}));return n}(t,a);return r},ln=.25,cn=.05,dn=28,un=function(e){return Math.pow(e,2)},mn={stopDampeningAt:1200,accelerateAt:360},hn=function(e){var t=e.startOfRange,n=e.endOfRange,a=e.current,i=n-t;return 0===i?0:(a-t)/i},pn=mn.accelerateAt,gn=mn.stopDampeningAt,bn=function(e){var t=e.distanceToEdge,n=e.thresholds,a=e.dragStartTime,i=e.shouldUseTimeDampening,r=function(e,t){if(e>t.startScrollingFrom)return 0;if(e<=t.maxScrollValueAt)return dn;if(e===t.startScrollingFrom)return 1;var n=hn({startOfRange:t.maxScrollValueAt,endOfRange:t.startScrollingFrom,current:e}),a=dn*un(1-n);return Math.ceil(a)}(t,n);return 0===r?0:i?Math.max(function(e,t){var n=t,a=gn,i=Date.now()-n;if(i>=gn)return e;if(i<pn)return 1;var r=hn({startOfRange:pn,endOfRange:a,current:i}),o=e*un(r);return Math.ceil(o)}(r,a),1):r},vn=function(e){var t=e.container,n=e.distanceToEdges,a=e.dragStartTime,i=e.axis,r=e.shouldUseTimeDampening,o=function(e,t){return{startScrollingFrom:e[t.size]*ln,maxScrollValueAt:e[t.size]*cn}}(t,i);return n[i.end]<n[i.start]?bn({distanceToEdge:n[i.end],thresholds:o,dragStartTime:a,shouldUseTimeDampening:r}):-1*bn({distanceToEdge:n[i.start],thresholds:o,dragStartTime:a,shouldUseTimeDampening:r})},fn=F((function(e){return 0===e?0:e})),yn=function(e){var t=e.dragStartTime,n=e.container,a=e.subject,i=e.center,r=e.shouldUseTimeDampening,o={top:i.y-n.top,right:n.right-i.x,bottom:n.bottom-i.y,left:i.x-n.left},s=vn({container:n,distanceToEdges:o,dragStartTime:t,axis:de,shouldUseTimeDampening:r}),l=vn({container:n,distanceToEdges:o,dragStartTime:t,axis:ue,shouldUseTimeDampening:r}),c=fn({x:l,y:s});if(D(c,T))return null;var d=function(e){var t=e.container,n=e.subject,a=e.proposedScroll,i=n.height>t.height,r=n.width>t.width;return r||i?r&&i?null:{x:r?0:a.x,y:i?0:a.y}:a}({container:n,subject:a,proposedScroll:c});return d?D(d,T)?null:d:null},En=F((function(e){return 0===e?0:e>0?1:-1})),wn=(en=function(e,t){return e<0?e:e>t?e-t:0},function(e){var t=e.current,n=e.max,a=e.change,i=P(t,a),r={x:en(i.x,n.x),y:en(i.y,n.y)};return D(r,T)?null:r}),Sn=function(e){var t=e.max,n=e.current,a=e.change,i={x:Math.max(n.x,t.x),y:Math.max(n.y,t.y)},r=En(a),o=wn({max:i,current:n,change:r});return!o||(0!==r.x&&0===o.x||0!==r.y&&0===o.y)},_n=function(e,t){return Sn({current:e.scroll.current,max:e.scroll.max,change:t})},Cn=function(e,t){var n=e.frame;return!!n&&Sn({current:n.scroll.current,max:n.scroll.max,change:t})},On=function(e){var t=e.state,n=e.dragStartTime,a=e.shouldUseTimeDampening,i=e.scrollWindow,r=e.scrollDroppable,o=t.current.page.borderBoxCenter,s=t.dimensions.draggables[t.critical.draggable.id].page.marginBox;if(t.isWindowScrollAllowed){var l=function(e){var t=e.viewport,n=e.subject,a=e.center,i=e.dragStartTime,r=e.shouldUseTimeDampening,o=yn({dragStartTime:i,container:t.frame,subject:n,center:a,shouldUseTimeDampening:r});return o&&_n(t,o)?o:null}({dragStartTime:n,viewport:t.viewport,subject:s,center:o,shouldUseTimeDampening:a});if(l)return void i(l)}var c=sn({center:o,destination:Ve(t.impact),droppables:t.dimensions.droppables});if(c){var d=function(e){var t=e.droppable,n=e.subject,a=e.center,i=e.dragStartTime,r=e.shouldUseTimeDampening,o=t.frame;if(!o)return null;var s=yn({dragStartTime:i,container:o.pageMarginBox,subject:n,center:a,shouldUseTimeDampening:r});return s&&Cn(t,s)?s:null}({dragStartTime:n,droppable:c,subject:s,center:o,shouldUseTimeDampening:a});d&&r(c.descriptor.id,d)}},xn=function(e){var t=e.move,n=e.scrollDroppable,a=e.scrollWindow,i=function(e,t){if(!Cn(e,t))return t;var a=function(e,t){var n=e.frame;return n&&Cn(e,t)?wn({current:n.scroll.current,max:n.scroll.max,change:t}):null}(e,t);if(!a)return n(e.descriptor.id,t),null;var i=N(t,a);return n(e.descriptor.id,i),N(t,i)},r=function(e,t,n){if(!e)return n;if(!_n(t,n))return n;var i=function(e,t){if(!_n(e,t))return null;var n=e.scroll.max,a=e.scroll.current;return wn({current:a,max:n,change:t})}(t,n);if(!i)return a(n),null;var r=N(n,i);return a(r),N(n,r)};return function(e){var n=e.scrollJumpRequest;if(n){var a=Ve(e.impact);a||w(!1);var o=i(e.dimensions.droppables[a],n);if(o){var s=e.viewport,l=r(e.isWindowScrollAllowed,s,o);l&&function(e,n){var a=P(e.current.client.selection,n);t({client:a})}(e,l)}}}},kn=function(e){var t=e.scrollDroppable,n=e.scrollWindow,a=e.move,i=function(e){var t=e.scrollWindow,n=e.scrollDroppable,a=h(t),i=h(n),r=null,o=function(e){r||w(!1);var t=r,n=t.shouldUseTimeDampening,o=t.dragStartTime;On({state:e,scrollWindow:a,scrollDroppable:i,dragStartTime:o,shouldUseTimeDampening:n})};return{start:function(e){nt(),r&&w(!1);var t=Date.now(),n=!1,a=function(){n=!0};On({state:e,dragStartTime:0,shouldUseTimeDampening:!1,scrollWindow:a,scrollDroppable:a}),r={dragStartTime:t,shouldUseTimeDampening:n},at(),n&&o(e)},stop:function(){r&&(a.cancel(),i.cancel(),r=null)},scroll:o}}({scrollWindow:n,scrollDroppable:t}),r=xn({move:a,scrollWindow:n,scrollDroppable:t});return{scroll:function(e){"DRAGGING"===e.phase&&("FLUID"!==e.movementMode?e.scrollJumpRequest&&r(e):i.scroll(e))},start:i.start,stop:i.stop}},Rn="data-rbd",jn={base:tn=Rn+"-drag-handle",draggableId:tn+"-draggable-id",contextId:tn+"-context-id"},In=function(){var e=Rn+"-draggable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),Tn=function(){var e=Rn+"-droppable";return{base:e,contextId:e+"-context-id",id:e+"-id"}}(),Pn={contextId:Rn+"-scroll-container-context-id"},Nn=function(e,t){return e.map((function(e){var n=e.styles[t];return n?e.selector+" { "+n+" }":""})).join(" ")},Dn=function(e){var t,n,a,i=(t=e,function(e){return"["+e+'="'+t+'"]'}),r=(n="\n      cursor: -webkit-grab;\n      cursor: grab;\n    ",{selector:i(jn.contextId),styles:{always:"\n          -webkit-touch-callout: none;\n          -webkit-tap-highlight-color: rgba(0,0,0,0);\n          touch-action: manipulation;\n        ",resting:n,dragging:"pointer-events: none;",dropAnimating:n}}),o=[(a="\n      transition: "+jt.outOfTheWay+";\n    ",{selector:i(In.contextId),styles:{dragging:a,dropAnimating:a,userCancel:a}}),r,{selector:i(Tn.contextId),styles:{always:"overflow-anchor: none;"}},{selector:"body",styles:{dragging:"\n        cursor: grabbing;\n        cursor: -webkit-grabbing;\n        user-select: none;\n        -webkit-user-select: none;\n        -moz-user-select: none;\n        -ms-user-select: none;\n        overflow-anchor: none;\n      "}}];return{always:Nn(o,"always"),resting:Nn(o,"resting"),dragging:Nn(o,"dragging"),dropAnimating:Nn(o,"dropAnimating"),userCancel:Nn(o,"userCancel")}},Mn="undefined"!=typeof window&&void 0!==window.document&&void 0!==window.document.createElement?i.useLayoutEffect:i.useEffect,An=function(){var e=document.querySelector("head");return e||w(!1),e},Ln=function(e){var t=document.createElement("style");return e&&t.setAttribute("nonce",e),t.type="text/css",t};var Un=function(e){return e&&e.ownerDocument?e.ownerDocument.defaultView:window};function Fn(e){return e instanceof Un(e).HTMLElement}function Bn(e,t){var n="["+jn.contextId+'="'+e+'"]',a=$(document.querySelectorAll(n));if(!a.length)return null;var i=q(a,(function(e){return e.getAttribute(jn.draggableId)===t}));return i&&Fn(i)?i:null}function Vn(){var e={draggables:{},droppables:{}},t=[];function n(e){t.length&&t.forEach((function(t){return t(e)}))}function a(t){return e.draggables[t]||null}function i(t){return e.droppables[t]||null}return{draggable:{register:function(t){e.draggables[t.descriptor.id]=t,n({type:"ADDITION",value:t})},update:function(t,n){var a=e.draggables[n.descriptor.id];a&&a.uniqueId===t.uniqueId&&(delete e.draggables[n.descriptor.id],e.draggables[t.descriptor.id]=t)},unregister:function(t){var i=t.descriptor.id,r=a(i);r&&t.uniqueId===r.uniqueId&&(delete e.draggables[i],n({type:"REMOVAL",value:t}))},getById:function(e){var t=a(e);return t||w(!1),t},findById:a,exists:function(e){return Boolean(a(e))},getAllByType:function(t){return G(e.draggables).filter((function(e){return e.descriptor.type===t}))}},droppable:{register:function(t){e.droppables[t.descriptor.id]=t},unregister:function(t){var n=i(t.descriptor.id);n&&t.uniqueId===n.uniqueId&&delete e.droppables[t.descriptor.id]},getById:function(e){var t=i(e);return t||w(!1),t},findById:i,exists:function(e){return Boolean(i(e))},getAllByType:function(t){return G(e.droppables).filter((function(e){return e.descriptor.type===t}))}},subscribe:function(e){return t.push(e),function(){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},clean:function(){e.draggables={},e.droppables={},t.length=0}}}var Wn=r.createContext(null),zn=function(){var e=document.body;return e||w(!1),e},Hn={position:"absolute",width:"1px",height:"1px",margin:"-1px",border:"0",padding:"0",overflow:"hidden",clip:"rect(0 0 0 0)","clip-path":"inset(100%)"},Gn=function(e){return"rbd-announcement-"+e};var Kn=0,qn={separator:"::"};function $n(e,t){return void 0===t&&(t=qn),d.useMemo((function(){return""+e+t.separator+Kn++}),[t.separator,e])}var Yn=r.createContext(null);function Jn(e){0}function Qn(e,t){Jn()}function Xn(e){var t=i.useRef(e);return i.useEffect((function(){t.current=e})),t}var Zn,ea=27,ta=32,na=37,aa=38,ia=39,ra=40,oa=((Zn={})[13]=!0,Zn[9]=!0,Zn),sa=function(e){oa[e.keyCode]&&e.preventDefault()},la=function(){var e="visibilitychange";return"undefined"==typeof document?e:q([e,"ms"+e,"webkit"+e,"moz"+e,"o"+e],(function(e){return"on"+e in document}))||e}(),ca=0,da=5;var ua,ma={type:"IDLE"};function ha(e){var t=e.cancel,n=e.completed,a=e.getPhase,i=e.setPhase;return[{eventName:"mousemove",fn:function(e){var t=e.button,n=e.clientX,r=e.clientY;if(t===ca){var o={x:n,y:r},s=a();if("DRAGGING"===s.type)return e.preventDefault(),void s.actions.move(o);"PENDING"!==s.type&&w(!1);var l=s.point;if(c=l,d=o,Math.abs(d.x-c.x)>=da||Math.abs(d.y-c.y)>=da){var c,d;e.preventDefault();var u=s.actions.fluidLift(o);i({type:"DRAGGING",actions:u})}}}},{eventName:"mouseup",fn:function(e){var i=a();"DRAGGING"===i.type?(e.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),n()):t()}},{eventName:"mousedown",fn:function(e){"DRAGGING"===a().type&&e.preventDefault(),t()}},{eventName:"keydown",fn:function(e){if("PENDING"!==a().type)return e.keyCode===ea?(e.preventDefault(),void t()):void sa(e);t()}},{eventName:"resize",fn:t},{eventName:"scroll",options:{passive:!0,capture:!1},fn:function(){"PENDING"===a().type&&t()}},{eventName:"webkitmouseforcedown",fn:function(e){var n=a();"IDLE"===n.type&&w(!1),n.actions.shouldRespectForcePress()?t():e.preventDefault()}},{eventName:la,fn:t}]}function pa(e){var t=i.useRef(ma),n=i.useRef(b),a=d.useMemo((function(){return{eventName:"mousedown",fn:function(t){if(!t.defaultPrevented&&t.button===ca&&!(t.ctrlKey||t.metaKey||t.shiftKey||t.altKey)){var a=e.findClosestDraggableId(t);if(a){var i=e.tryGetLock(a,s,{sourceEvent:t});if(i){t.preventDefault();var r={x:t.clientX,y:t.clientY};n.current(),u(i,r)}}}}}}),[e]),r=d.useMemo((function(){return{eventName:"webkitmouseforcewillbegin",fn:function(t){if(!t.defaultPrevented){var n=e.findClosestDraggableId(t);if(n){var a=e.findOptionsForDraggable(n);a&&(a.shouldRespectForcePress||e.canGetLock(n)&&t.preventDefault())}}}}}),[e]),o=d.useCallback((function(){n.current=v(window,[r,a],{passive:!1,capture:!0})}),[r,a]),s=d.useCallback((function(){"IDLE"!==t.current.type&&(t.current=ma,n.current(),o())}),[o]),l=d.useCallback((function(){var e=t.current;s(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[s]),c=d.useCallback((function(){var e=ha({cancel:l,completed:s,getPhase:function(){return t.current},setPhase:function(e){t.current=e}});n.current=v(window,e,{capture:!0,passive:!1})}),[l,s]),u=d.useCallback((function(e,n){"IDLE"!==t.current.type&&w(!1),t.current={type:"PENDING",point:n,actions:e},c()}),[c]);Mn((function(){return o(),function(){n.current()}}),[o])}function ga(){}var ba=((ua={})[34]=!0,ua[33]=!0,ua[36]=!0,ua[35]=!0,ua);function va(e,t){function n(){t(),e.cancel()}return[{eventName:"keydown",fn:function(a){return a.keyCode===ea?(a.preventDefault(),void n()):a.keyCode===ta?(a.preventDefault(),t(),void e.drop()):a.keyCode===ra?(a.preventDefault(),void e.moveDown()):a.keyCode===aa?(a.preventDefault(),void e.moveUp()):a.keyCode===ia?(a.preventDefault(),void e.moveRight()):a.keyCode===na?(a.preventDefault(),void e.moveLeft()):void(ba[a.keyCode]?a.preventDefault():sa(a))}},{eventName:"mousedown",fn:n},{eventName:"mouseup",fn:n},{eventName:"click",fn:n},{eventName:"touchstart",fn:n},{eventName:"resize",fn:n},{eventName:"wheel",fn:n,options:{passive:!0}},{eventName:la,fn:n}]}function fa(e){var t=i.useRef(ga),n=d.useMemo((function(){return{eventName:"keydown",fn:function(n){if(!n.defaultPrevented&&n.keyCode===ta){var i=e.findClosestDraggableId(n);if(i){var r=e.tryGetLock(i,l,{sourceEvent:n});if(r){n.preventDefault();var o=!0,s=r.snapLift();t.current(),t.current=v(window,va(s,l),{capture:!0,passive:!1})}}}function l(){o||w(!1),o=!1,t.current(),a()}}}}),[e]),a=d.useCallback((function(){t.current=v(window,[n],{passive:!1,capture:!0})}),[n]);Mn((function(){return a(),function(){t.current()}}),[a])}var ya={type:"IDLE"},Ea=.15;function wa(e){var t=i.useRef(ya),n=i.useRef(b),a=d.useCallback((function(){return t.current}),[]),r=d.useCallback((function(e){t.current=e}),[]),o=d.useMemo((function(){return{eventName:"touchstart",fn:function(t){if(!t.defaultPrevented){var a=e.findClosestDraggableId(t);if(a){var i=e.tryGetLock(a,l,{sourceEvent:t});if(i){var r=t.touches[0],o={x:r.clientX,y:r.clientY};n.current(),h(i,o)}}}}}}),[e]),s=d.useCallback((function(){n.current=v(window,[o],{capture:!0,passive:!1})}),[o]),l=d.useCallback((function(){var e=t.current;"IDLE"!==e.type&&("PENDING"===e.type&&clearTimeout(e.longPressTimerId),r(ya),n.current(),s())}),[s,r]),c=d.useCallback((function(){var e=t.current;l(),"DRAGGING"===e.type&&e.actions.cancel({shouldBlockNextClick:!0}),"PENDING"===e.type&&e.actions.abort()}),[l]),u=d.useCallback((function(){var e={capture:!0,passive:!1},t={cancel:c,completed:l,getPhase:a},i=v(window,function(e){var t=e.cancel,n=e.completed,a=e.getPhase;return[{eventName:"touchmove",options:{capture:!1},fn:function(e){var n=a();if("DRAGGING"===n.type){n.hasMoved=!0;var i=e.touches[0],r={x:i.clientX,y:i.clientY};e.preventDefault(),n.actions.move(r)}else t()}},{eventName:"touchend",fn:function(e){var i=a();"DRAGGING"===i.type?(e.preventDefault(),i.actions.drop({shouldBlockNextClick:!0}),n()):t()}},{eventName:"touchcancel",fn:function(e){"DRAGGING"===a().type?(e.preventDefault(),t()):t()}},{eventName:"touchforcechange",fn:function(e){var n=a();"IDLE"===n.type&&w(!1);var i=e.touches[0];if(i&&i.force>=Ea){var r=n.actions.shouldRespectForcePress();if("PENDING"!==n.type)return r?n.hasMoved?void e.preventDefault():void t():void e.preventDefault();r&&t()}}},{eventName:la,fn:t}]}(t),e),r=v(window,function(e){var t=e.cancel,n=e.getPhase;return[{eventName:"orientationchange",fn:t},{eventName:"resize",fn:t},{eventName:"contextmenu",fn:function(e){e.preventDefault()}},{eventName:"keydown",fn:function(e){"DRAGGING"===n().type?(e.keyCode===ea&&e.preventDefault(),t()):t()}},{eventName:la,fn:t}]}(t),e);n.current=function(){i(),r()}}),[c,a,l]),m=d.useCallback((function(){var e=a();"PENDING"!==e.type&&w(!1);var t=e.actions.fluidLift(e.point);r({type:"DRAGGING",actions:t,hasMoved:!1})}),[a,r]),h=d.useCallback((function(e,t){"IDLE"!==a().type&&w(!1);var n=setTimeout(m,120);r({type:"PENDING",point:t,actions:e,longPressTimerId:n}),u()}),[u,a,r,m]);Mn((function(){return s(),function(){n.current();var e=a();"PENDING"===e.type&&(clearTimeout(e.longPressTimerId),r(ya))}}),[a,s,r]),Mn((function(){return v(window,[{eventName:"touchmove",fn:function(){},options:{capture:!1,passive:!1}}])}),[])}var Sa={input:!0,button:!0,textarea:!0,select:!0,option:!0,optgroup:!0,video:!0,audio:!0};function _a(e,t){if(null==t)return!1;if(Boolean(Sa[t.tagName.toLowerCase()]))return!0;var n=t.getAttribute("contenteditable");return"true"===n||""===n||t!==e&&_a(e,t.parentElement)}function Ca(e,t){var n=t.target;return!!Fn(n)&&_a(e,n)}var Oa=function(e){return u.getRect(e.getBoundingClientRect()).center};var xa=function(){var e="matches";return"undefined"==typeof document?e:q([e,"msMatchesSelector","webkitMatchesSelector"],(function(e){return e in Element.prototype}))||e}();function ka(e,t){return null==e?null:e[xa](t)?e:ka(e.parentElement,t)}function Ra(e,t){return e.closest?e.closest(t):ka(e,t)}function ja(e,t){var n,a=t.target;if(!((n=a)instanceof Un(n).Element))return null;var i=function(e){return"["+jn.contextId+'="'+e+'"]'}(e),r=Ra(a,i);return r&&Fn(r)?r:null}function Ia(e){e.preventDefault()}function Ta(e){var t=e.expected,n=e.phase,a=e.isLockActive;e.shouldWarn;return!!a()&&t===n}function Pa(e){var t=e.lockAPI,n=e.store,a=e.registry,i=e.draggableId;if(t.isClaimed())return!1;var r=a.draggable.findById(i);return!!r&&(!!r.options.isEnabled&&!!an(n.getState(),i))}function Na(e){var t=e.lockAPI,n=e.contextId,a=e.store,i=e.registry,r=e.draggableId,o=e.forceSensorStop,l=e.sourceEvent;if(!Pa({lockAPI:t,store:a,registry:i,draggableId:r}))return null;var c=i.draggable.getById(r),d=function(e,t){var n="["+In.contextId+'="'+e+'"]',a=q($(document.querySelectorAll(n)),(function(e){return e.getAttribute(In.id)===t}));return a&&Fn(a)?a:null}(n,c.descriptor.id);if(!d)return null;if(l&&!c.options.canDragInteractiveElements&&Ca(d,l))return null;var u=t.claim(o||b),m="PRE_DRAG";function p(){return c.options.shouldRespectForcePress}function g(){return t.isActive(u)}var f=function(e,t){Ta({expected:e,phase:m,isLockActive:g,shouldWarn:!0})&&a.dispatch(t())}.bind(null,"DRAGGING");function y(e){function n(){t.release(),m="COMPLETED"}function i(t,i){if(void 0===i&&(i={shouldBlockNextClick:!1}),e.cleanup(),i.shouldBlockNextClick){var r=v(window,[{eventName:"click",fn:Ia,options:{once:!0,passive:!1,capture:!0}}]);setTimeout(r)}n(),a.dispatch(_t({reason:t}))}return"PRE_DRAG"!==m&&(n(),"PRE_DRAG"!==m&&w(!1)),a.dispatch(dt(e.liftActionArgs)),m="DRAGGING",s({isActive:function(){return Ta({expected:"DRAGGING",phase:m,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:p,drop:function(e){return i("DROP",e)},cancel:function(e){return i("CANCEL",e)}},e.actions)}return{isActive:function(){return Ta({expected:"PRE_DRAG",phase:m,isLockActive:g,shouldWarn:!1})},shouldRespectForcePress:p,fluidLift:function(e){var t=h((function(e){f((function(){return bt({client:e})}))})),n=y({liftActionArgs:{id:r,clientSelection:e,movementMode:"FLUID"},cleanup:function(){return t.cancel()},actions:{move:t}});return s({},n,{move:t})},snapLift:function(){var e={moveUp:function(){return f(vt)},moveRight:function(){return f(yt)},moveDown:function(){return f(ft)},moveLeft:function(){return f(Et)}};return y({liftActionArgs:{id:r,clientSelection:Oa(d),movementMode:"SNAP"},cleanup:b,actions:e})},abort:function(){Ta({expected:"PRE_DRAG",phase:m,isLockActive:g,shouldWarn:!0})&&t.release()}}}var Da=[pa,fa,wa];function Ma(e){var t=e.contextId,n=e.store,a=e.registry,r=e.customSensors,o=e.enableDefaultSensors,s=[].concat(o?Da:[],r||[]),l=i.useState((function(){return function(){var e=null;function t(){e||w(!1),e=null}return{isClaimed:function(){return Boolean(e)},isActive:function(t){return t===e},claim:function(t){e&&w(!1);var n={abandon:t};return e=n,n},release:t,tryAbandon:function(){e&&(e.abandon(),t())}}}()}))[0],c=d.useCallback((function(e,t){e.isDragging&&!t.isDragging&&l.tryAbandon()}),[l]);Mn((function(){var e=n.getState();return n.subscribe((function(){var t=n.getState();c(e,t),e=t}))}),[l,n,c]),Mn((function(){return l.tryAbandon}),[l.tryAbandon]);var u=d.useCallback((function(e){return Pa({lockAPI:l,registry:a,store:n,draggableId:e})}),[l,a,n]),m=d.useCallback((function(e,i,r){return Na({lockAPI:l,registry:a,contextId:t,store:n,draggableId:e,forceSensorStop:i,sourceEvent:r&&r.sourceEvent?r.sourceEvent:null})}),[t,l,a,n]),h=d.useCallback((function(e){return function(e,t){var n=ja(e,t);return n?n.getAttribute(jn.draggableId):null}(t,e)}),[t]),p=d.useCallback((function(e){var t=a.draggable.findById(e);return t?t.options:null}),[a.draggable]),g=d.useCallback((function(){l.isClaimed()&&(l.tryAbandon(),"IDLE"!==n.getState().phase&&n.dispatch(wt()))}),[l,n]),b=d.useCallback(l.isClaimed,[l]),v=d.useMemo((function(){return{canGetLock:u,tryGetLock:m,findClosestDraggableId:h,findOptionsForDraggable:p,tryReleaseLock:g,isLockClaimed:b}}),[u,m,h,p,g,b]);Jn();for(var f=0;f<s.length;f++)s[f](v)}var Aa=function(e){return{onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragEnd:e.onDragEnd,onDragUpdate:e.onDragUpdate}};function La(e){return e.current||w(!1),e.current}function Ua(e){var t=e.contextId,n=e.setCallbacks,a=e.sensors,o=e.nonce,u=e.dragHandleUsageInstructions,h=i.useRef(null);Qn();var p=Xn(e),g=d.useCallback((function(){return Aa(p.current)}),[p]),b=function(e){var t=d.useMemo((function(){return Gn(e)}),[e]),n=i.useRef(null);return i.useEffect((function(){var e=document.createElement("div");return n.current=e,e.id=t,e.setAttribute("aria-live","assertive"),e.setAttribute("aria-atomic","true"),s(e.style,Hn),zn().appendChild(e),function(){setTimeout((function(){var t=zn();t.contains(e)&&t.removeChild(e),e===n.current&&(n.current=null)}))}}),[t]),d.useCallback((function(e){var t=n.current;t&&(t.textContent=e)}),[])}(t),v=function(e){var t=e.contextId,n=e.text,a=$n("hidden-text",{separator:"-"}),r=d.useMemo((function(){return"rbd-hidden-text-"+(e={contextId:t,uniqueId:a}).contextId+"-"+e.uniqueId;var e}),[a,t]);return i.useEffect((function(){var e=document.createElement("div");return e.id=r,e.textContent=n,e.style.display="none",zn().appendChild(e),function(){var t=zn();t.contains(e)&&t.removeChild(e)}}),[r,n]),r}({contextId:t,text:u}),f=function(e,t){var n=d.useMemo((function(){return Dn(e)}),[e]),a=i.useRef(null),r=i.useRef(null),o=d.useCallback(m((function(e){var t=r.current;t||w(!1),t.textContent=e})),[]),s=d.useCallback((function(e){var t=a.current;t||w(!1),t.textContent=e}),[]);Mn((function(){(a.current||r.current)&&w(!1);var i=Ln(t),l=Ln(t);return a.current=i,r.current=l,i.setAttribute(Rn+"-always",e),l.setAttribute(Rn+"-dynamic",e),An().appendChild(i),An().appendChild(l),s(n.always),o(n.resting),function(){var e=function(e){var t=e.current;t||w(!1),An().removeChild(t),e.current=null};e(a),e(r)}}),[t,s,o,n.always,n.resting,e]);var l=d.useCallback((function(){return o(n.dragging)}),[o,n.dragging]),c=d.useCallback((function(e){o("DROP"!==e?n.userCancel:n.dropAnimating)}),[o,n.dropAnimating,n.userCancel]),u=d.useCallback((function(){r.current&&o(n.resting)}),[o,n.resting]);return d.useMemo((function(){return{dragging:l,dropping:c,resting:u}}),[l,c,u])}(t,o),y=d.useCallback((function(e){La(h).dispatch(e)}),[]),E=d.useMemo((function(){return l.bindActionCreators({publishWhileDragging:ut,updateDroppableScroll:ht,updateDroppableIsEnabled:pt,updateDroppableIsCombineEnabled:gt,collectionStarting:mt},y)}),[y]),S=function(){var e=d.useMemo(Vn,[]);return i.useEffect((function(){return function(){requestAnimationFrame(e.clean)}}),[e]),e}(),_=d.useMemo((function(){return nn(S,E)}),[S,E]),C=d.useMemo((function(){return kn(s({scrollWindow:rn,scrollDroppable:_.scrollDroppable},l.bindActionCreators({move:bt},y)))}),[_.scrollDroppable,y]),O=function(e){var t=i.useRef({}),n=i.useRef(null),a=i.useRef(null),r=i.useRef(!1),o=d.useCallback((function(e,n){var a={id:e,focus:n};return t.current[e]=a,function(){var n=t.current;n[e]!==a&&delete n[e]}}),[]),s=d.useCallback((function(t){var n=Bn(e,t);n&&n!==document.activeElement&&n.focus()}),[e]),l=d.useCallback((function(e,t){n.current===e&&(n.current=t)}),[]),c=d.useCallback((function(){a.current||r.current&&(a.current=requestAnimationFrame((function(){a.current=null;var e=n.current;e&&s(e)})))}),[s]),u=d.useCallback((function(e){n.current=null;var t=document.activeElement;t&&t.getAttribute(jn.draggableId)===e&&(n.current=e)}),[]);return Mn((function(){return r.current=!0,function(){r.current=!1;var e=a.current;e&&cancelAnimationFrame(e)}}),[]),d.useMemo((function(){return{register:o,tryRecordFocus:u,tryRestoreFocusRecorded:c,tryShiftRecord:l}}),[o,u,c,l])}(t),x=d.useMemo((function(){return $t({announce:b,autoScroller:C,dimensionMarshal:_,focusMarshal:O,getResponders:g,styleMarshal:f})}),[b,C,_,O,g,f]);h.current=x;var k=d.useCallback((function(){var e=La(h);"IDLE"!==e.getState().phase&&e.dispatch(wt())}),[]),R=d.useCallback((function(){var e=La(h).getState();return e.isDragging||"DROP_ANIMATING"===e.phase}),[]);n(d.useMemo((function(){return{isDragging:R,tryAbort:k}}),[R,k]));var j=d.useCallback((function(e){return an(La(h).getState(),e)}),[]),I=d.useCallback((function(){return ze(La(h).getState())}),[]),T=d.useMemo((function(){return{marshal:_,focus:O,contextId:t,canLift:j,isMovementAllowed:I,dragHandleUsageInstructionsId:v,registry:S}}),[t,_,v,O,j,I,S]);return Ma({contextId:t,store:x,registry:S,customSensors:a,enableDefaultSensors:!1!==e.enableDefaultSensors}),i.useEffect((function(){return k}),[k]),r.createElement(Yn.Provider,{value:T},r.createElement(c.Provider,{context:Wn,store:x},e.children))}var Fa=0;var Ba=function(e){return function(t){return e===t}},Va=Ba("scroll"),Wa=Ba("auto"),za=(Ba("visible"),function(e,t){return t(e.overflowX)||t(e.overflowY)}),Ha=function(e){var t=window.getComputedStyle(e),n={overflowX:t.overflowX,overflowY:t.overflowY};return za(n,Va)||za(n,Wa)},Ga=function e(t){return null==t||t===document.body||t===document.documentElement?null:Ha(t)?t:e(t.parentElement)},Ka=function(e){return{x:e.scrollLeft,y:e.scrollTop}},qa=function e(t){return!!t&&("fixed"===window.getComputedStyle(t).position||e(t.parentElement))},$a=function(e){return{closestScrollable:Ga(e),isFixedOnPage:qa(e)}},Ya=function(e){var t=e.ref,n=e.descriptor,a=e.env,i=e.windowScroll,r=e.direction,o=e.isDropDisabled,s=e.isCombineEnabled,l=e.shouldClipSubject,c=a.closestScrollable,d=function(e,t){var n=u.getBox(e);if(!t)return n;if(e!==t)return n;var a=n.paddingBox.top-t.scrollTop,i=n.paddingBox.left-t.scrollLeft,r=a+t.scrollHeight,o={top:a,right:i+t.scrollWidth,bottom:r,left:i},s=u.expand(o,n.border);return u.createBox({borderBox:s,margin:n.margin,border:n.border,padding:n.padding})}(t,c),m=u.withScroll(d,i),h=function(){if(!c)return null;var e=u.getBox(c),t={scrollHeight:c.scrollHeight,scrollWidth:c.scrollWidth};return{client:e,page:u.withScroll(e,i),scroll:Ka(c),scrollSize:t,shouldClipSubject:l}}(),p=function(e){var t=e.descriptor,n=e.isEnabled,a=e.isCombineEnabled,i=e.isFixedOnPage,r=e.direction,o=e.client,s=e.page,l=e.closest,c=function(){if(!l)return null;var e=l.scrollSize,t=l.client,n=Yt({scrollHeight:e.scrollHeight,scrollWidth:e.scrollWidth,height:t.paddingBox.height,width:t.paddingBox.width});return{pageMarginBox:l.page.marginBox,frameClient:t,scrollSize:e,shouldClipSubject:l.shouldClipSubject,scroll:{initial:l.scroll,current:l.scroll,max:n,diff:{value:T,displacement:T}}}}(),d="vertical"===r?de:ue;return{descriptor:t,isCombineEnabled:a,isFixedOnPage:i,axis:d,isEnabled:n,client:o,page:s,frame:c,subject:z({page:s,withPlaceholder:null,axis:d,frame:c})}}({descriptor:n,isEnabled:!o,isCombineEnabled:s,isFixedOnPage:a.isFixedOnPage,direction:r,client:d,page:m,closest:h});return p},Ja={passive:!1},Qa={passive:!0},Xa=function(e){return e.shouldPublishImmediately?Ja:Qa};function Za(e){var t=i.useContext(e);return t||w(!1),t}var ei=function(e){return e&&e.env.closestScrollable||null};function ti(){}var ni={width:0,height:0,margin:{top:0,right:0,bottom:0,left:0}},ai=function(e){var t=e.isAnimatingOpenOnMount,n=e.placeholder,a=e.animate,i=function(e){var t=e.isAnimatingOpenOnMount,n=e.placeholder,a=e.animate;return t||"close"===a?ni:{height:n.client.borderBox.height,width:n.client.borderBox.width,margin:n.client.margin}}({isAnimatingOpenOnMount:t,placeholder:n,animate:a});return{display:n.display,boxSizing:"border-box",width:i.width,height:i.height,marginTop:i.margin.top,marginRight:i.margin.right,marginBottom:i.margin.bottom,marginLeft:i.margin.left,flexShrink:"0",flexGrow:"0",pointerEvents:"none",transition:"none"!==a?jt.placeholder:null}};var ii=r.memo((function(e){var t=i.useRef(null),n=d.useCallback((function(){t.current&&(clearTimeout(t.current),t.current=null)}),[]),a=e.animate,o=e.onTransitionEnd,s=e.onClose,l=e.contextId,c=i.useState("open"===e.animate),u=c[0],m=c[1];i.useEffect((function(){return u?"open"!==a?(n(),m(!1),ti):t.current?ti:(t.current=setTimeout((function(){t.current=null,m(!1)})),n):ti}),[a,u,n]);var h=d.useCallback((function(e){"height"===e.propertyName&&(o(),"close"===a&&s())}),[a,s,o]),p=ai({isAnimatingOpenOnMount:u,animate:e.animate,placeholder:e.placeholder});return r.createElement(e.placeholder.tagName,{style:p,"data-rbd-placeholder-context-id":l,onTransitionEnd:h,ref:e.innerRef})})),ri=r.createContext(null);var oi=function(e){function t(){for(var t,n=arguments.length,a=new Array(n),i=0;i<n;i++)a[i]=arguments[i];return(t=e.call.apply(e,[this].concat(a))||this).state={isVisible:Boolean(t.props.on),data:t.props.on,animate:t.props.shouldAnimate&&t.props.on?"open":"none"},t.onClose=function(){"close"===t.state.animate&&t.setState({isVisible:!1})},t}return o(t,e),t.getDerivedStateFromProps=function(e,t){return e.shouldAnimate?e.on?{isVisible:!0,data:e.on,animate:"open"}:t.isVisible?{isVisible:!0,data:t.data,animate:"close"}:{isVisible:!1,animate:"close",data:null}:{isVisible:Boolean(e.on),data:e.on,animate:"none"}},t.prototype.render=function(){if(!this.state.isVisible)return null;var e={onClose:this.onClose,data:this.state.data,animate:this.state.animate};return this.props.children(e)},t}(r.PureComponent),si={dragging:5e3,dropAnimating:4500},li=function(e,t){return t?jt.drop(t.duration):e?jt.snap:jt.fluid},ci=function(e,t){return e?t?xt.drop:xt.combining:null},di=function(e){return null!=e.forceShouldAnimate?e.forceShouldAnimate:"SNAP"===e.mode};function ui(e){return"DRAGGING"===e.type?(a=(n=e).dimension.client,i=n.offset,r=n.combineWith,o=n.dropping,s=Boolean(r),l=di(n),c=Boolean(o),d=c?Tt.drop(i,s):Tt.moveTo(i),{position:"fixed",top:a.marginBox.top,left:a.marginBox.left,boxSizing:"border-box",width:a.borderBox.width,height:a.borderBox.height,transition:li(l,o),transform:d,opacity:ci(s,c),zIndex:c?si.dropAnimating:si.dragging,pointerEvents:"none"}):(t=e,{transform:Tt.moveTo(t.offset),transition:t.shouldAnimateDisplacement?null:"none"});var t,n,a,i,r,o,s,l,c,d}function mi(e){var t=$n("draggable"),n=e.descriptor,a=e.registry,r=e.getDraggableRef,o=e.canDragInteractiveElements,s=e.shouldRespectForcePress,l=e.isEnabled,c=d.useMemo((function(){return{canDragInteractiveElements:o,shouldRespectForcePress:s,isEnabled:l}}),[o,l,s]),m=d.useCallback((function(e){var t=r();return t||w(!1),function(e,t,n){void 0===n&&(n=T);var a=window.getComputedStyle(t),i=t.getBoundingClientRect(),r=u.calculateBox(i,a),o=u.withScroll(r,n);return{descriptor:e,placeholder:{client:r,tagName:t.tagName.toLowerCase(),display:a.display},displaceBy:{x:r.marginBox.width,y:r.marginBox.height},client:r,page:o}}(n,t,e)}),[n,r]),h=d.useMemo((function(){return{uniqueId:t,descriptor:n,options:c,getDimension:m}}),[n,m,c,t]),p=i.useRef(h),g=i.useRef(!0);Mn((function(){return a.draggable.register(p.current),function(){return a.draggable.unregister(p.current)}}),[a.draggable]),Mn((function(){if(g.current)g.current=!1;else{var e=p.current;p.current=h,a.draggable.update(h,e)}}),[h,a.draggable])}function hi(e,t,n){Qn()}function pi(e){e.preventDefault()}var gi=function(e,t){return e===t},bi=function(e){var t=e.combine,n=e.destination;return n?n.droppableId:t?t.droppableId:null};function vi(e){return{isDragging:!1,isDropAnimating:!1,isClone:!1,dropAnimation:null,mode:null,draggingOver:null,combineTargetFor:e,combineWith:null}}var fi={mapped:{type:"SECONDARY",offset:T,combineTargetFor:null,shouldAnimateDisplacement:!0,snapshot:vi(null)}};var yi={dropAnimationFinished:Ct},Ei=c.connect((function(){var e,t,n,a=(e=m((function(e,t){return{x:e,y:t}})),t=m((function(e,t,n,a,i){return{isDragging:!0,isClone:t,isDropAnimating:Boolean(i),dropAnimation:i,mode:e,draggingOver:n,combineWith:a,combineTargetFor:null}})),n=m((function(e,n,a,i,r,o,s){return{mapped:{type:"DRAGGING",dropping:null,draggingOver:r,combineWith:o,mode:n,offset:e,dimension:a,forceShouldAnimate:s,snapshot:t(n,i,r,o,null)}}})),function(a,i){if(a.isDragging){if(a.critical.draggable.id!==i.draggableId)return null;var r=a.current.client.offset,o=a.dimensions.draggables[i.draggableId],s=Ve(a.impact),l=(d=a.impact).at&&"COMBINE"===d.at.type?d.at.combine.draggableId:null,c=a.forceShouldAnimate;return n(e(r.x,r.y),a.movementMode,o,i.isClone,s,l,c)}var d;if("DROP_ANIMATING"===a.phase){var u=a.completed;if(u.result.draggableId!==i.draggableId)return null;var m=i.isClone,h=a.dimensions.draggables[i.draggableId],p=u.result,g=p.mode,b=bi(p),v=function(e){return e.combine?e.combine.draggableId:null}(p),f={duration:a.dropDuration,curve:Ot,moveTo:a.newHomeClientOffset,opacity:v?xt.drop:null,scale:v?kt.drop:null};return{mapped:{type:"DRAGGING",offset:a.newHomeClientOffset,dimension:h,dropping:f,draggingOver:b,combineWith:v,mode:g,forceShouldAnimate:null,snapshot:t(g,m,b,v,f)}}}return null}),i=function(){var e=m((function(e,t){return{x:e,y:t}})),t=m(vi),n=m((function(e,n,a){return void 0===n&&(n=null),{mapped:{type:"SECONDARY",offset:e,combineTargetFor:n,shouldAnimateDisplacement:a,snapshot:t(n)}}})),a=function(e){return e?n(T,e,!0):null},i=function(t,i,r,o){var s=r.displaced.visible[t],l=Boolean(o.inVirtualList&&o.effected[t]),c=te(r),d=c&&c.draggableId===t?i:null;if(!s){if(!l)return a(d);if(r.displaced.invisible[t])return null;var u=M(o.displacedBy.point),m=e(u.x,u.y);return n(m,d,!0)}if(l)return a(d);var h=r.displacedBy.point,p=e(h.x,h.y);return n(p,d,s.shouldAnimate)};return function(e,t){if(e.isDragging)return e.critical.draggable.id===t.draggableId?null:i(t.draggableId,e.critical.draggable.id,e.impact,e.afterCritical);if("DROP_ANIMATING"===e.phase){var n=e.completed;return n.result.draggableId===t.draggableId?null:i(t.draggableId,n.result.draggableId,n.impact,n.afterCritical)}return null}}();return function(e,t){return a(e,t)||i(e,t)||fi}}),yi,null,{context:Wn,pure:!0,areStatePropsEqual:gi})((function(e){var t=i.useRef(null),n=d.useCallback((function(e){t.current=e}),[]),a=d.useCallback((function(){return t.current}),[]),r=Za(Yn),o=r.contextId,s=r.dragHandleUsageInstructionsId,l=r.registry,c=Za(ri),u=c.type,m=c.droppableId,h=d.useMemo((function(){return{id:e.draggableId,index:e.index,type:u,droppableId:m}}),[e.draggableId,e.index,u,m]),p=e.children,g=e.draggableId,b=e.isEnabled,v=e.shouldRespectForcePress,f=e.canDragInteractiveElements,y=e.isClone,E=e.mapped,w=e.dropAnimationFinished;hi(),Jn(),y||mi(d.useMemo((function(){return{descriptor:h,registry:l,getDraggableRef:a,canDragInteractiveElements:f,shouldRespectForcePress:v,isEnabled:b}}),[h,l,a,f,v,b]));var S=d.useMemo((function(){return b?{tabIndex:0,role:"button","aria-describedby":s,"data-rbd-drag-handle-draggable-id":g,"data-rbd-drag-handle-context-id":o,draggable:!1,onDragStart:pi}:null}),[o,s,g,b]),_=d.useCallback((function(e){"DRAGGING"===E.type&&E.dropping&&"transform"===e.propertyName&&w()}),[w,E]),C=d.useMemo((function(){var e=ui(E),t="DRAGGING"===E.type&&E.dropping?_:null;return{innerRef:n,draggableProps:{"data-rbd-draggable-context-id":o,"data-rbd-draggable-id":g,style:e,onTransitionEnd:t},dragHandleProps:S}}),[o,S,g,E,_,n]),O=d.useMemo((function(){return{draggableId:h.id,type:h.type,source:{index:h.index,droppableId:h.droppableId}}}),[h.droppableId,h.id,h.index,h.type]);return p(C,E.snapshot,O)}));function wi(e){return Za(ri).isUsingCloneFor!==e.draggableId||e.isClone?r.createElement(Ei,e):null}var Si=function(e,t){return e===t.droppable.type},_i=function(e,t){return t.draggables[e.draggable.id]},Ci={updateViewportMaxScroll:function(e){return{type:"UPDATE_VIEWPORT_MAX_SCROLL",payload:e}}};var Oi={mode:"standard",type:"DEFAULT",direction:"vertical",isDropDisabled:!1,isCombineEnabled:!1,ignoreContainerClipping:!1,renderClone:null,getContainerForClone:function(){return document.body||w(!1),document.body}},xi=c.connect((function(){var e={placeholder:null,shouldAnimatePlaceholder:!0,snapshot:{isDraggingOver:!1,draggingOverWith:null,draggingFromThisWith:null,isUsingPlaceholder:!1},useClone:null},t=s({},e,{shouldAnimatePlaceholder:!1}),n=m((function(e){return{draggableId:e.id,type:e.type,source:{index:e.index,droppableId:e.droppableId}}})),a=m((function(a,i,r,o,s,l){var c=s.descriptor.id;if(s.descriptor.droppableId===a){var d=l?{render:l,dragging:n(s.descriptor)}:null,u={isDraggingOver:r,draggingOverWith:r?c:null,draggingFromThisWith:c,isUsingPlaceholder:!0};return{placeholder:s.placeholder,shouldAnimatePlaceholder:!1,snapshot:u,useClone:d}}if(!i)return t;if(!o)return e;var m={isDraggingOver:r,draggingOverWith:c,draggingFromThisWith:null,isUsingPlaceholder:!0};return{placeholder:s.placeholder,shouldAnimatePlaceholder:!0,snapshot:m,useClone:null}}));return function(n,i){var r=i.droppableId,o=i.type,s=!i.isDropDisabled,l=i.renderClone;if(n.isDragging){var c=n.critical;if(!Si(o,c))return t;var d=_i(c,n.dimensions),u=Ve(n.impact)===r;return a(r,s,u,u,d,l)}if("DROP_ANIMATING"===n.phase){var m=n.completed;if(!Si(o,m.critical))return t;var h=_i(m.critical,n.dimensions);return a(r,s,bi(m.result)===r,Ve(m.impact)===r,h,l)}if("IDLE"===n.phase&&n.completed&&!n.shouldFlush){var p=n.completed;if(!Si(o,p.critical))return t;var g=Ve(p.impact)===r,b=Boolean(p.impact.at&&"COMBINE"===p.impact.at.type),v=p.critical.droppable.id===r;return g?b?e:t:v?e:t}return t}}),Ci,null,{context:Wn,pure:!0,areStatePropsEqual:gi})((function(e){var t=i.useContext(Yn);t||w(!1);var n=t.contextId,a=t.isMovementAllowed,o=i.useRef(null),s=i.useRef(null),l=e.children,c=e.droppableId,u=e.type,g=e.mode,b=e.direction,v=e.ignoreContainerClipping,f=e.isDropDisabled,y=e.isCombineEnabled,E=e.snapshot,S=e.useClone,_=e.updateViewportMaxScroll,C=e.getContainerForClone,O=d.useCallback((function(){return o.current}),[]),x=d.useCallback((function(e){o.current=e}),[]),k=(d.useCallback((function(){return s.current}),[]),d.useCallback((function(e){s.current=e}),[]));Qn();var R=d.useCallback((function(){a()&&_({maxScroll:Qt()})}),[a,_]);!function(e){var t=i.useRef(null),n=Za(Yn),a=$n("droppable"),r=n.registry,o=n.marshal,s=Xn(e),l=d.useMemo((function(){return{id:e.droppableId,type:e.type,mode:e.mode}}),[e.droppableId,e.mode,e.type]),c=i.useRef(l),u=d.useMemo((function(){return m((function(e,n){t.current||w(!1);var a={x:e,y:n};o.updateDroppableScroll(l.id,a)}))}),[l.id,o]),p=d.useCallback((function(){var e=t.current;return e&&e.env.closestScrollable?Ka(e.env.closestScrollable):T}),[]),g=d.useCallback((function(){var e=p();u(e.x,e.y)}),[p,u]),b=d.useMemo((function(){return h(g)}),[g]),v=d.useCallback((function(){var e=t.current,n=ei(e);e&&n||w(!1),e.scrollOptions.shouldPublishImmediately?g():b()}),[b,g]),f=d.useCallback((function(e,a){t.current&&w(!1);var i=s.current,r=i.getDroppableRef();r||w(!1);var o=$a(r),c={ref:r,descriptor:l,env:o,scrollOptions:a};t.current=c;var d=Ya({ref:r,descriptor:l,env:o,windowScroll:e,direction:i.direction,isDropDisabled:i.isDropDisabled,isCombineEnabled:i.isCombineEnabled,shouldClipSubject:!i.ignoreContainerClipping}),u=o.closestScrollable;return u&&(u.setAttribute(Pn.contextId,n.contextId),u.addEventListener("scroll",v,Xa(c.scrollOptions))),d}),[n.contextId,l,v,s]),y=d.useCallback((function(){var e=t.current,n=ei(e);return e&&n||w(!1),Ka(n)}),[]),E=d.useCallback((function(){var e=t.current;e||w(!1);var n=ei(e);t.current=null,n&&(b.cancel(),n.removeAttribute(Pn.contextId),n.removeEventListener("scroll",v,Xa(e.scrollOptions)))}),[v,b]),S=d.useCallback((function(e){var n=t.current;n||w(!1);var a=ei(n);a||w(!1),a.scrollTop+=e.y,a.scrollLeft+=e.x}),[]),_=d.useMemo((function(){return{getDimensionAndWatchScroll:f,getScrollWhileDragging:y,dragStopped:E,scroll:S}}),[E,f,y,S]),C=d.useMemo((function(){return{uniqueId:a,descriptor:l,callbacks:_}}),[_,l,a]);Mn((function(){return c.current=C.descriptor,r.droppable.register(C),function(){t.current&&E(),r.droppable.unregister(C)}}),[_,l,E,C,o,r.droppable]),Mn((function(){t.current&&o.updateDroppableIsEnabled(c.current.id,!e.isDropDisabled)}),[e.isDropDisabled,o]),Mn((function(){t.current&&o.updateDroppableIsCombineEnabled(c.current.id,e.isCombineEnabled)}),[e.isCombineEnabled,o])}({droppableId:c,type:u,mode:g,direction:b,isDropDisabled:f,isCombineEnabled:y,ignoreContainerClipping:v,getDroppableRef:O});var j=r.createElement(oi,{on:e.placeholder,shouldAnimate:e.shouldAnimatePlaceholder},(function(e){var t=e.onClose,a=e.data,i=e.animate;return r.createElement(ii,{placeholder:a,onClose:t,innerRef:k,animate:i,contextId:n,onTransitionEnd:R})})),I=d.useMemo((function(){return{innerRef:x,placeholder:j,droppableProps:{"data-rbd-droppable-id":c,"data-rbd-droppable-context-id":n}}}),[n,c,j,x]),P=S?S.dragging.draggableId:null,N=d.useMemo((function(){return{droppableId:c,type:u,isUsingCloneFor:P}}),[c,P,u]);return r.createElement(ri.Provider,{value:N},l(I,E),function(){if(!S)return null;var e=S.dragging,t=S.render,n=r.createElement(wi,{draggableId:e.draggableId,index:e.source.index,isClone:!0,isEnabled:!0,shouldRespectForcePress:!1,canDragInteractiveElements:!0},(function(n,a){return t(n,a,e)}));return p.createPortal(n,C())}())}));xi.defaultProps=Oi,t.DragDropContext=function(e){var t=d.useMemo((function(){return""+Fa++}),[]),n=e.dragHandleUsageInstructions||k;return r.createElement(S,null,(function(a){return r.createElement(Ua,{nonce:e.nonce,contextId:t,setCallbacks:a,dragHandleUsageInstructions:n,enableDefaultSensors:e.enableDefaultSensors,sensors:e.sensors,onBeforeCapture:e.onBeforeCapture,onBeforeDragStart:e.onBeforeDragStart,onDragStart:e.onDragStart,onDragUpdate:e.onDragUpdate,onDragEnd:e.onDragEnd},e.children)}))},t.Draggable=function(e){var t="boolean"!=typeof e.isDragDisabled||!e.isDragDisabled,n=Boolean(e.disableInteractiveElementBlocking),a=Boolean(e.shouldRespectForcePress);return r.createElement(wi,s({},e,{isClone:!1,isEnabled:t,canDragInteractiveElements:n,shouldRespectForcePress:a}))},t.Droppable=xi,t.resetServerContext=function(){Fa=0,Kn=0},t.useKeyboardSensor=fa,t.useMouseSensor=pa,t.useTouchSensor=wa},1499:function(e,t,n){"use strict";function a(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(n(1500));function r(e){return"Minified Redux error #"+e+"; visit https://redux.js.org/Errors?code="+e+" for the full message or use the non-minified dev environment for full errors. "}var o="function"==typeof Symbol&&Symbol.observable||"@@observable",s=function(){return Math.random().toString(36).substring(7).split("").join(".")},l={INIT:"@@redux/INIT"+s(),REPLACE:"@@redux/REPLACE"+s(),PROBE_UNKNOWN_ACTION:function(){return"@@redux/PROBE_UNKNOWN_ACTION"+s()}};function c(e){if("object"!=typeof e||null===e)return!1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function d(e,t,n){var a;if("function"==typeof t&&"function"==typeof n||"function"==typeof n&&"function"==typeof arguments[3])throw new Error(r(0));if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error(r(1));return n(d)(e,t)}if("function"!=typeof e)throw new Error(r(2));var i=e,s=t,u=[],m=u,h=!1;function p(){m===u&&(m=u.slice())}function g(){if(h)throw new Error(r(3));return s}function b(e){if("function"!=typeof e)throw new Error(r(4));if(h)throw new Error(r(5));var t=!0;return p(),m.push(e),function(){if(t){if(h)throw new Error(r(6));t=!1,p();var n=m.indexOf(e);m.splice(n,1),u=null}}}function v(e){if(!c(e))throw new Error(r(7));if(void 0===e.type)throw new Error(r(8));if(h)throw new Error(r(9));try{h=!0,s=i(s,e)}finally{h=!1}for(var t=u=m,n=0;n<t.length;n++){(0,t[n])()}return e}return v({type:l.INIT}),(a={dispatch:v,subscribe:b,getState:g,replaceReducer:function(e){if("function"!=typeof e)throw new Error(r(10));i=e,v({type:l.REPLACE})}})[o]=function(){var e,t=b;return(e={subscribe:function(e){if("object"!=typeof e||null===e)throw new Error(r(11));function n(){e.next&&e.next(g())}return n(),{unsubscribe:t(n)}}})[o]=function(){return this},e},a}var u=d;function m(e,t){return function(){return t(e.apply(this,arguments))}}function h(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return 0===t.length?function(e){return e}:1===t.length?t[0]:t.reduce((function(e,t){return function(){return e(t.apply(void 0,arguments))}}))}t.__DO_NOT_USE__ActionTypes=l,t.applyMiddleware=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(){var n=e.apply(void 0,arguments),a=function(){throw new Error(r(15))},o={getState:n.getState,dispatch:function(){return a.apply(void 0,arguments)}},s=t.map((function(e){return e(o)}));return a=h.apply(void 0,s)(n.dispatch),i.default(i.default({},n),{},{dispatch:a})}}},t.bindActionCreators=function(e,t){if("function"==typeof e)return m(e,t);if("object"!=typeof e||null===e)throw new Error(r(16));var n={};for(var a in e){var i=e[a];"function"==typeof i&&(n[a]=m(i,t))}return n},t.combineReducers=function(e){for(var t=Object.keys(e),n={},a=0;a<t.length;a++){var i=t[a];0,"function"==typeof e[i]&&(n[i]=e[i])}var o,s=Object.keys(n);try{!function(e){Object.keys(e).forEach((function(t){var n=e[t];if(void 0===n(void 0,{type:l.INIT}))throw new Error(r(12));if(void 0===n(void 0,{type:l.PROBE_UNKNOWN_ACTION()}))throw new Error(r(13))}))}(n)}catch(e){o=e}return function(e,t){if(void 0===e&&(e={}),o)throw o;for(var a=!1,i={},l=0;l<s.length;l++){var c=s[l],d=n[c],u=e[c],m=d(u,t);if(void 0===m){t&&t.type;throw new Error(r(14))}i[c]=m,a=a||m!==u}return(a=a||s.length!==Object.keys(e).length)?i:e}},t.compose=h,t.createStore=d,t.legacy_createStore=u},1500:function(e,t,n){var a=n(1);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}e.exports=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e},e.exports.__esModule=!0,e.exports.default=e.exports},1501:function(e,t,n){"use strict";t.__esModule=!0;var a={batch:!0},i=n(1502);Object.keys(i).forEach((function(e){"default"!==e&&"__esModule"!==e&&(Object.prototype.hasOwnProperty.call(a,e)||e in t&&t[e]===i[e]||(t[e]=i[e]))}));var r=n(1519);t.batch=r.unstable_batchedUpdates,(0,n(1407).setBatch)(r.unstable_batchedUpdates)},1502:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0;var i=a(n(1503));t.Provider=i.default;var r=a(n(1408));t.connectAdvanced=r.default;var o=n(1313);t.ReactReduxContext=o.ReactReduxContext;var s=a(n(1509));t.connect=s.default;var l=n(1517);t.useDispatch=l.useDispatch,t.createDispatchHook=l.createDispatchHook;var c=n(1518);t.useSelector=c.useSelector,t.createSelectorHook=c.createSelectorHook;var d=n(1413);t.useStore=d.useStore,t.createStoreHook=d.createStoreHook;var u=a(n(1409));t.shallowEqual=u.default},1503:function(e,t,n){"use strict";var a=n(194).default,i=n(268).default;t.__esModule=!0,t.default=void 0;var r=i(n(0)),o=(a(n(197)),n(1313)),s=n(1359),l=n(1360);var c=function(e){var t=e.store,n=e.context,a=e.children,i=(0,r.useMemo)((function(){var e=(0,s.createSubscription)(t);return{store:t,subscription:e}}),[t]),c=(0,r.useMemo)((function(){return t.getState()}),[t]);(0,l.useIsomorphicLayoutEffect)((function(){var e=i.subscription;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),c!==t.getState()&&e.notifyNestedSubs(),function(){e.tryUnsubscribe(),e.onStateChange=null}}),[i,c]);var d=n||o.ReactReduxContext;return r.default.createElement(d.Provider,{value:i},a)};t.default=c},1504:function(e,t,n){"use strict";var a=n(1505),i={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},r={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function l(e){return a.isMemo(e)?o:s[e.$$typeof]||i}s[a.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[a.Memo]=o;var c=Object.defineProperty,d=Object.getOwnPropertyNames,u=Object.getOwnPropertySymbols,m=Object.getOwnPropertyDescriptor,h=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,a){if("string"!=typeof n){if(p){var i=h(n);i&&i!==p&&e(t,i,a)}var o=d(n);u&&(o=o.concat(u(n)));for(var s=l(t),g=l(n),b=0;b<o.length;++b){var v=o[b];if(!(r[v]||a&&a[v]||g&&g[v]||s&&s[v])){var f=m(n,v);try{c(t,v,f)}catch(e){}}}}return t}},1505:function(e,t,n){"use strict";e.exports=n(1506)},1506:function(e,t,n){"use strict";var a="function"==typeof Symbol&&Symbol.for,i=a?Symbol.for("react.element"):60103,r=a?Symbol.for("react.portal"):60106,o=a?Symbol.for("react.fragment"):60107,s=a?Symbol.for("react.strict_mode"):60108,l=a?Symbol.for("react.profiler"):60114,c=a?Symbol.for("react.provider"):60109,d=a?Symbol.for("react.context"):60110,u=a?Symbol.for("react.async_mode"):60111,m=a?Symbol.for("react.concurrent_mode"):60111,h=a?Symbol.for("react.forward_ref"):60112,p=a?Symbol.for("react.suspense"):60113,g=a?Symbol.for("react.suspense_list"):60120,b=a?Symbol.for("react.memo"):60115,v=a?Symbol.for("react.lazy"):60116,f=a?Symbol.for("react.block"):60121,y=a?Symbol.for("react.fundamental"):60117,E=a?Symbol.for("react.responder"):60118,w=a?Symbol.for("react.scope"):60119;function S(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case i:switch(e=e.type){case u:case m:case o:case l:case s:case p:return e;default:switch(e=e&&e.$$typeof){case d:case h:case v:case b:case c:return e;default:return t}}case r:return t}}}function _(e){return S(e)===m}t.AsyncMode=u,t.ConcurrentMode=m,t.ContextConsumer=d,t.ContextProvider=c,t.Element=i,t.ForwardRef=h,t.Fragment=o,t.Lazy=v,t.Memo=b,t.Portal=r,t.Profiler=l,t.StrictMode=s,t.Suspense=p,t.isAsyncMode=function(e){return _(e)||S(e)===u},t.isConcurrentMode=_,t.isContextConsumer=function(e){return S(e)===d},t.isContextProvider=function(e){return S(e)===c},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},t.isForwardRef=function(e){return S(e)===h},t.isFragment=function(e){return S(e)===o},t.isLazy=function(e){return S(e)===v},t.isMemo=function(e){return S(e)===b},t.isPortal=function(e){return S(e)===r},t.isProfiler=function(e){return S(e)===l},t.isStrictMode=function(e){return S(e)===s},t.isSuspense=function(e){return S(e)===p},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===o||e===m||e===l||e===s||e===p||e===g||"object"==typeof e&&null!==e&&(e.$$typeof===v||e.$$typeof===b||e.$$typeof===c||e.$$typeof===d||e.$$typeof===h||e.$$typeof===y||e.$$typeof===E||e.$$typeof===w||e.$$typeof===f)},t.typeOf=S},1507:function(e,t,n){"use strict";e.exports=n(1508)},1508:function(e,t,n){"use strict";var a=60103,i=60106,r=60107,o=60108,s=60114,l=60109,c=60110,d=60112,u=60113,m=60120,h=60115,p=60116,g=60121,b=60122,v=60117,f=60129,y=60131;if("function"==typeof Symbol&&Symbol.for){var E=Symbol.for;a=E("react.element"),i=E("react.portal"),r=E("react.fragment"),o=E("react.strict_mode"),s=E("react.profiler"),l=E("react.provider"),c=E("react.context"),d=E("react.forward_ref"),u=E("react.suspense"),m=E("react.suspense_list"),h=E("react.memo"),p=E("react.lazy"),g=E("react.block"),b=E("react.server.block"),v=E("react.fundamental"),f=E("react.debug_trace_mode"),y=E("react.legacy_hidden")}function w(e){if("object"==typeof e&&null!==e){var t=e.$$typeof;switch(t){case a:switch(e=e.type){case r:case s:case o:case u:case m:return e;default:switch(e=e&&e.$$typeof){case c:case d:case p:case h:case l:return e;default:return t}}case i:return t}}}var S=l,_=a,C=d,O=r,x=p,k=h,R=i,j=s,I=o,T=u;t.ContextConsumer=c,t.ContextProvider=S,t.Element=_,t.ForwardRef=C,t.Fragment=O,t.Lazy=x,t.Memo=k,t.Portal=R,t.Profiler=j,t.StrictMode=I,t.Suspense=T,t.isAsyncMode=function(){return!1},t.isConcurrentMode=function(){return!1},t.isContextConsumer=function(e){return w(e)===c},t.isContextProvider=function(e){return w(e)===l},t.isElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===a},t.isForwardRef=function(e){return w(e)===d},t.isFragment=function(e){return w(e)===r},t.isLazy=function(e){return w(e)===p},t.isMemo=function(e){return w(e)===h},t.isPortal=function(e){return w(e)===i},t.isProfiler=function(e){return w(e)===s},t.isStrictMode=function(e){return w(e)===o},t.isSuspense=function(e){return w(e)===u},t.isValidElementType=function(e){return"string"==typeof e||"function"==typeof e||e===r||e===s||e===f||e===o||e===u||e===m||e===y||"object"==typeof e&&null!==e&&(e.$$typeof===p||e.$$typeof===h||e.$$typeof===l||e.$$typeof===c||e.$$typeof===d||e.$$typeof===v||e.$$typeof===g||e[0]===b)},t.typeOf=w},1509:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.createConnect=g,t.default=void 0;var i=a(n(17)),r=a(n(868)),o=a(n(1408)),s=a(n(1409)),l=a(n(1510)),c=a(n(1513)),d=a(n(1514)),u=a(n(1515)),m=["pure","areStatesEqual","areOwnPropsEqual","areStatePropsEqual","areMergedPropsEqual"];function h(e,t,n){for(var a=t.length-1;a>=0;a--){var i=t[a](e);if(i)return i}return function(t,a){throw new Error("Invalid value of type "+typeof e+" for "+n+" argument when connecting component "+a.wrappedComponentName+".")}}function p(e,t){return e===t}function g(e){var t=void 0===e?{}:e,n=t.connectHOC,a=void 0===n?o.default:n,g=t.mapStateToPropsFactories,b=void 0===g?c.default:g,v=t.mapDispatchToPropsFactories,f=void 0===v?l.default:v,y=t.mergePropsFactories,E=void 0===y?d.default:y,w=t.selectorFactory,S=void 0===w?u.default:w;return function(e,t,n,o){void 0===o&&(o={});var l=o,c=l.pure,d=void 0===c||c,u=l.areStatesEqual,g=void 0===u?p:u,v=l.areOwnPropsEqual,y=void 0===v?s.default:v,w=l.areStatePropsEqual,_=void 0===w?s.default:w,C=l.areMergedPropsEqual,O=void 0===C?s.default:C,x=(0,r.default)(l,m),k=h(e,b,"mapStateToProps"),R=h(t,f,"mapDispatchToProps"),j=h(n,E,"mergeProps");return a(S,(0,i.default)({methodName:"connect",getDisplayName:function(e){return"Connect("+e+")"},shouldHandleStateChanges:Boolean(e),initMapStateToProps:k,initMapDispatchToProps:R,initMergeProps:j,pure:d,areStatesEqual:g,areOwnPropsEqual:y,areStatePropsEqual:_,areMergedPropsEqual:O},x))}}var b=g();t.default=b},1510:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.default=void 0,t.whenMapDispatchToPropsIsFunction=o,t.whenMapDispatchToPropsIsMissing=s,t.whenMapDispatchToPropsIsObject=l;var i=a(n(1511)),r=n(1410);function o(e){return"function"==typeof e?(0,r.wrapMapToPropsFunc)(e,"mapDispatchToProps"):void 0}function s(e){return e?void 0:(0,r.wrapMapToPropsConstant)((function(e){return{dispatch:e}}))}function l(e){return e&&"object"==typeof e?(0,r.wrapMapToPropsConstant)((function(t){return(0,i.default)(e,t)})):void 0}var c=[o,s,l];t.default=c},1511:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){var n={},a=function(a){var i=e[a];"function"==typeof i&&(n[a]=function(){return t(i.apply(void 0,arguments))})};for(var i in e)a(i);return n}},1512:function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e){if("object"!=typeof e||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}},1513:function(e,t,n){"use strict";t.__esModule=!0,t.default=void 0,t.whenMapStateToPropsIsFunction=i,t.whenMapStateToPropsIsMissing=r;var a=n(1410);function i(e){return"function"==typeof e?(0,a.wrapMapToPropsFunc)(e,"mapStateToProps"):void 0}function r(e){return e?void 0:(0,a.wrapMapToPropsConstant)((function(){return{}}))}var o=[i,r];t.default=o},1514:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.default=void 0,t.defaultMergeProps=r,t.whenMergePropsIsFunction=s,t.whenMergePropsIsOmitted=l,t.wrapMergePropsFunc=o;var i=a(n(17));a(n(1411));function r(e,t,n){return(0,i.default)({},n,e,t)}function o(e){return function(t,n){n.displayName;var a,i=n.pure,r=n.areMergedPropsEqual,o=!1;return function(t,n,s){var l=e(t,n,s);return o?i&&r(l,a)||(a=l):(o=!0,a=l),a}}}function s(e){return"function"==typeof e?o(e):void 0}function l(e){return e?void 0:function(){return r}}var c=[s,l];t.default=c},1515:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.default=function(e,t){var n=t.initMapStateToProps,a=t.initMapDispatchToProps,l=t.initMergeProps,c=(0,i.default)(t,r),d=n(e,c),u=a(e,c),m=l(e,c);0;return(c.pure?s:o)(d,u,m,e,c)},t.impureFinalPropsSelectorFactory=o,t.pureFinalPropsSelectorFactory=s;var i=a(n(868)),r=(a(n(1516)),["initMapStateToProps","initMapDispatchToProps","initMergeProps"]);function o(e,t,n,a){return function(i,r){return n(e(i,r),t(a,r),r)}}function s(e,t,n,a,i){var r,o,s,l,c,d=i.areStatesEqual,u=i.areOwnPropsEqual,m=i.areStatePropsEqual,h=!1;function p(i,h){var p,g,b=!u(h,o),v=!d(i,r,h,o);return r=i,o=h,b&&v?(s=e(r,o),t.dependsOnOwnProps&&(l=t(a,o)),c=n(s,l,o)):b?(e.dependsOnOwnProps&&(s=e(r,o)),t.dependsOnOwnProps&&(l=t(a,o)),c=n(s,l,o)):v?(p=e(r,o),g=!m(p,s),s=p,g&&(c=n(s,l,o)),c):c}return function(i,d){return h?p(i,d):(s=e(r=i,o=d),l=t(a,o),c=n(s,l,o),h=!0,c)}}},1516:function(e,t,n){"use strict";var a=n(194).default;t.__esModule=!0,t.default=function(e,t,n,a){r(e,"mapStateToProps",a),r(t,"mapDispatchToProps",a),r(n,"mergeProps",a)};var i=a(n(1412));function r(e,t,n){if(!e)throw new Error("Unexpected value for "+t+" in "+n+".");"mapStateToProps"!==t&&"mapDispatchToProps"!==t||Object.prototype.hasOwnProperty.call(e,"dependsOnOwnProps")||(0,i.default)("The selector for "+t+" of "+n+" did not specify a value for dependsOnOwnProps.")}},1517:function(e,t,n){"use strict";t.__esModule=!0,t.createDispatchHook=r,t.useDispatch=void 0;var a=n(1313),i=n(1413);function r(e){void 0===e&&(e=a.ReactReduxContext);var t=e===a.ReactReduxContext?i.useStore:(0,i.createStoreHook)(e);return function(){return t().dispatch}}var o=r();t.useDispatch=o},1518:function(e,t,n){"use strict";t.__esModule=!0,t.createSelectorHook=c,t.useSelector=void 0;var a=n(0),i=n(1414),r=n(1359),o=n(1360),s=n(1313),l=function(e,t){return e===t};function c(e){void 0===e&&(e=s.ReactReduxContext);var t=e===s.ReactReduxContext?i.useReduxContext:function(){return(0,a.useContext)(e)};return function(e,n){void 0===n&&(n=l);var i=t(),s=function(e,t,n,i){var s,l=(0,a.useReducer)((function(e){return e+1}),0)[1],c=(0,a.useMemo)((function(){return(0,r.createSubscription)(n,i)}),[n,i]),d=(0,a.useRef)(),u=(0,a.useRef)(),m=(0,a.useRef)(),h=(0,a.useRef)(),p=n.getState();try{if(e!==u.current||p!==m.current||d.current){var g=e(p);s=void 0!==h.current&&t(g,h.current)?h.current:g}else s=h.current}catch(e){throw d.current&&(e.message+="\nThe error may be correlated with this previous error:\n"+d.current.stack+"\n\n"),e}return(0,o.useIsomorphicLayoutEffect)((function(){u.current=e,m.current=p,h.current=s,d.current=void 0})),(0,o.useIsomorphicLayoutEffect)((function(){function e(){try{var e=n.getState();if(e===m.current)return;var a=u.current(e);if(t(a,h.current))return;h.current=a,m.current=e}catch(e){d.current=e}l()}return c.onStateChange=e,c.trySubscribe(),e(),function(){return c.tryUnsubscribe()}}),[n,c]),s}(e,n,i.store,i.subscription);return(0,a.useDebugValue)(s),s}}var d=c();t.useSelector=d},1519:function(e,t,n){"use strict";t.__esModule=!0,t.unstable_batchedUpdates=void 0;var a=n(103);t.unstable_batchedUpdates=a.unstable_batchedUpdates},1520:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n(0);function i(e,t){var n=a.useState((function(){return{inputs:t,result:e()}}))[0],i=a.useRef(!0),r=a.useRef(n),o=i.current||Boolean(t&&r.current.inputs&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,r.current.inputs))?r.current:{inputs:t,result:e()};return a.useEffect((function(){i.current=!1,r.current=o}),[o]),o.result}function r(e,t){return i((function(){return e}),t)}var o=i,s=r;t.useCallback=s,t.useCallbackOne=r,t.useMemo=o,t.useMemoOne=i},1521:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a,i=(a=n(1522))&&"object"==typeof a&&"default"in a?a.default:a,r=function(e){var t=e.top,n=e.right,a=e.bottom,i=e.left;return{top:t,right:n,bottom:a,left:i,width:n-i,height:a-t,x:i,y:t,center:{x:(n+i)/2,y:(a+t)/2}}},o=function(e,t){return{top:e.top-t.top,left:e.left-t.left,bottom:e.bottom+t.bottom,right:e.right+t.right}},s=function(e,t){return{top:e.top+t.top,left:e.left+t.left,bottom:e.bottom-t.bottom,right:e.right-t.right}},l={top:0,right:0,bottom:0,left:0},c=function(e){var t=e.borderBox,n=e.margin,a=void 0===n?l:n,i=e.border,c=void 0===i?l:i,d=e.padding,u=void 0===d?l:d,m=r(o(t,a)),h=r(s(t,c)),p=r(s(h,u));return{marginBox:m,borderBox:r(t),paddingBox:h,contentBox:p,margin:a,border:c,padding:u}},d=function(e){var t=e.slice(0,-2);if("px"!==e.slice(-2))return 0;var n=Number(t);return isNaN(n)&&i(!1),n},u=function(e,t){var n,a,i=e.borderBox,r=e.border,o=e.margin,s=e.padding,l=(a=t,{top:(n=i).top+a.y,left:n.left+a.x,bottom:n.bottom+a.y,right:n.right+a.x});return c({borderBox:l,border:r,margin:o,padding:s})},m=function(e,t){var n={top:d(t.marginTop),right:d(t.marginRight),bottom:d(t.marginBottom),left:d(t.marginLeft)},a={top:d(t.paddingTop),right:d(t.paddingRight),bottom:d(t.paddingBottom),left:d(t.paddingLeft)},i={top:d(t.borderTopWidth),right:d(t.borderRightWidth),bottom:d(t.borderBottomWidth),left:d(t.borderLeftWidth)};return c({borderBox:e,margin:n,padding:a,border:i})};t.calculateBox=m,t.createBox=c,t.expand=o,t.getBox=function(e){var t=e.getBoundingClientRect(),n=window.getComputedStyle(e);return m(t,n)},t.getRect=r,t.offset=u,t.shrink=s,t.withScroll=function(e,t){return void 0===t&&(t={x:window.pageXOffset,y:window.pageYOffset}),u(e,t)}},1522:function(e,t,n){"use strict";var a="Invariant failed";e.exports=function(e,t){if(!e)throw new Error(a)}},1523:function(e,t,n){"use strict";var a=Number.isNaN||function(e){return"number"==typeof e&&e!=e};function i(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(i=e[n],r=t[n],!(i===r||a(i)&&a(r)))return!1;var i,r;return!0}e.exports=function(e,t){var n;void 0===t&&(t=i);var a,r=[],o=!1;return function(){for(var i=[],s=0;s<arguments.length;s++)i[s]=arguments[s];return o&&n===this&&t(i,r)||(a=e.apply(this,i),o=!0,n=this,r=i),a}}},1524:function(e,t,n){"use strict";e.exports=function(e){var t=[],n=null,a=function(){for(var a=arguments.length,i=new Array(a),r=0;r<a;r++)i[r]=arguments[r];t=i,n||(n=requestAnimationFrame((function(){n=null,e.apply(void 0,t)})))};return a.cancel=function(){n&&(cancelAnimationFrame(n),n=null)},a}},1525:function(e,t){e.exports="img/user-onboarding/WorkMessaging.f3c8ccf.png"},1526:function(e,t){e.exports="img/user-onboarding/CommunityMessaging.85955ea.png"},1527:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return l}));var a,i,r,o=n(0);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s.apply(this,arguments)}function l(e){return o.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),o.createElement("g",{clipPath:"url(#default_app_svg__clip0)"},a||(a=o.createElement("rect",{width:20,height:20,rx:4,fill:"url(#default_app_svg__paint0_linear)"})),o.createElement("path",{d:"M2.496 0v20M20 2.5H0M20 10H0M20 17.5H0M10 0v20M17.496 0v20",stroke:"#fff",strokeOpacity:.5,style:{mixBlendMode:"lighten"}}),i||(i=o.createElement("circle",{opacity:.8,cx:10,cy:10,r:7.5,stroke:"#fff"}))),r||(r=o.createElement("defs",null,o.createElement("linearGradient",{id:"default_app_svg__paint0_linear",x1:10,y1:0,x2:10,y2:20,gradientUnits:"userSpaceOnUse"},o.createElement("stop",{stopColor:"#60A6FF"}),o.createElement("stop",{offset:1,stopColor:"#418DED"})),o.createElement("clipPath",{id:"default_app_svg__clip0"},o.createElement("rect",{width:20,height:20,rx:4,fill:"#fff"})))))}t.default="img/element-icons/room/default_app.63bac9a.svg"},1528:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return s}));var a,i,r=n(0);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function s(e){return r.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),a||(a=r.createElement("rect",{width:20,height:20,rx:4,fill:"#5ABFF2"})),i||(i=r.createElement("path",{d:"M3 7.875C3 6.839 3.84 6 4.875 6h6.313c1.035 0 1.874.84 1.874 1.875v5c0 1.036-.839 1.875-1.874 1.875H4.875A1.875 1.875 0 013 12.875v-5zM14.375 8.446l1.746-1.336a.547.547 0 01.879.435v5.495c0 .48-.575.727-.923.396l-1.702-1.615V8.446z",fill:"#fff"})))}t.default="img/element-icons/room/default_video.6afce87.svg"},1529:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return c}));var a,i,r,o,s=n(0);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}function c(e){return s.createElement("svg",l({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),a||(a=s.createElement("rect",{width:20,height:20,rx:4,fill:"#FF5B55"})),i||(i=s.createElement("path",{d:"M2 7h16v9a2 2 0 01-2 2H4a2 2 0 01-2-2V7z",fill:"#fff"})),r||(r=s.createElement("rect",{x:3.968,y:9,width:2.997,height:3,rx:.25,fill:"#FF5B55"})),o||(o=s.createElement("rect",{x:10.961,y:13,width:2.997,height:3,rx:.25,fill:"#FF5B55"})))}t.default="img/element-icons/room/default_cal.68352c5.svg"},1530:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return s}));var a,i,r=n(0);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function s(e){return r.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),a||(a=r.createElement("rect",{width:20,height:20,rx:4,fill:"#FCC639"})),i||(i=r.createElement("path",{d:"M2 7h16v9a2 2 0 01-2 2H4a2 2 0 01-2-2V7z",fill:"#fff"})))}t.default="img/element-icons/room/default_doc.6a6092c.svg"},1531:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return l}));var a,i,r,o=n(0);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s.apply(this,arguments)}function l(e){return o.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),a||(a=o.createElement("rect",{x:1,y:1,width:18,height:18,rx:3,fill:"#17191C",stroke:"#17191C",strokeWidth:2})),i||(i=o.createElement("path",{d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0z",fill:"#fff"})),r||(r=o.createElement("path",{d:"M10 6v3.813l2.5 1.687",stroke:"#000",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}t.default="img/element-icons/room/default_clock.312a340.svg"},1532:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return I}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(103),l=n.n(s),c=n(4),d=n(1533),u=n(3),m=n(352),h=n.n(m),p=n(1363),g=n(63),b=n(256),v=n(1373),f=n(71),y=n(45),E=n(2),w=n(162),S=n(1320),_=n(653),C=n(196),O=n(21),x=n(1539),k=n(202),R=n(633),j=n(1541);class I extends p.a{constructor(e,t,n,a){super(e,t,n,a),i()(this,"avatars",void 0),i()(this,"permalinkCreator",void 0),i()(this,"totalSize",void 0),i()(this,"mediaOmitText",void 0),this.avatars=new Map,this.permalinkCreator=new y.a(this.room),this.totalSize=0,this.mediaOmitText=this.exportOptions.attachmentsIncluded?Object(E.b)("Media omitted - file size limit exceeded"):Object(E.b)("Media omitted")}async getRoomAvatar(){let e;const t=w.b(this.room,32,32,"crop"),n="room.png";if(t)try{const a=await fetch(t);e=await a.blob(),this.totalSize+=e.size,this.addFile(n,e)}catch(e){u.a.log("Failed to fetch room's avatar"+e)}const a=o.a.createElement(C.a,{width:32,height:32,name:this.room.name,title:this.room.name,url:e?n:"",resizeMethod:"crop"});return Object(d.renderToStaticMarkup)(a)}async wrapHTML(e,t,n){var a,i,r,s,l;const u=await this.getRoomAvatar(),m=Object(f.g)(new Date),p=null===(a=this.room.currentState.getStateEvents(c.EventType.RoomCreate,""))||void 0===a?void 0:a.getSender(),g=(p?null===(i=this.room.getMember(p))||void 0===i?void 0:i.rawDisplayName:p)||p,b=this.room.client.getSafeUserId(),v=null===(r=this.room.getMember(b))||void 0===r?void 0:r.rawDisplayName,y=(null===(s=this.room.currentState.getStateEvents(c.EventType.RoomTopic,""))||void 0===s||null===(l=s.getContent())||void 0===l?void 0:l.topic)||"",w=h()(Object(E.b)("%(creatorName)s created this room.",{creatorName:g})),S=h()(b),_=h()(this.room.name),C=h()(y),O=Object(d.renderToStaticMarkup)(o.a.createElement("p",null,Object(E.b)("This is the start of export of <roomName/>. Exported by <exporterDetails/> at %(exportDate)s.",{exportDate:m},{roomName:()=>o.a.createElement("b",null,_),exporterDetails:()=>o.a.createElement("a",{href:`https://matrix.to/#/${encodeURIComponent(b)}`,target:"_blank",rel:"noopener noreferrer"},v?o.a.createElement(o.a.Fragment,null,o.a.createElement("b",null,h()(v)),"I "," ("+S+")"):o.a.createElement("b",null,S))}))),x=y?Object(E.b)("Topic: %(topic)s",{topic:C}):"",k=Object(d.renderToStaticMarkup)(0!==t?o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("a",{href:`./messages${1===t?"":t}.html`,style:{fontWeight:"bold"}},Object(E.b)("Previous group of messages"))):o.a.createElement(o.a.Fragment,null)),R=Object(d.renderToStaticMarkup)(t<n-1?o.a.createElement("div",{style:{textAlign:"center",margin:"10px"}},o.a.createElement("a",{href:"./messages"+(t+2)+".html",style:{fontWeight:"bold"}},Object(E.b)("Next group of messages"))):o.a.createElement(o.a.Fragment,null));return`\n          <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8" />\n                <meta http-equiv="X-UA-Compatible" content="IE=edge" />\n                <meta name="viewport" content="width=device-width, initial-scale=1.0" />\n                <link href="css/style.css" rel="stylesheet" />\n                <script src="js/script.js"><\/script>\n                <title>${Object(E.b)("Exported Data")}</title>\n            </head>\n            <body style="height: 100vh;">\n                <section\n                id="matrixchat"\n                style="height: 100%; overflow: auto"\n                class="notranslate"\n                >\n                <div class="mx_MatrixChat_wrapper" aria-hidden="false">\n                    <div class="mx_MatrixChat">\n                    <main class="mx_RoomView">\n                        <div class="mx_LegacyRoomHeader light-panel">\n                        <div class="mx_LegacyRoomHeader_wrapper" aria-owns="mx_RightPanel">\n                            <div class="mx_LegacyRoomHeader_avatar">\n                            <div class="mx_DecoratedRoomAvatar">\n                               ${u}\n                            </div>\n                            </div>\n                            <div class="mx_LegacyRoomHeader_name">\n                            <div\n                                dir="auto"\n                                class="mx_LegacyRoomHeader_nametext"\n                                title="${_}"\n                            >\n                                ${_}\n                            </div>\n                            </div>\n                            <div class="mx_LegacyRoomHeader_topic" dir="auto"> ${C} </div>\n                        </div>\n                        </div>\n                        ${k}\n                        <div class="mx_MainSplit">\n                        <div class="mx_RoomView_body">\n                            <div\n                            class="mx_RoomView_timeline mx_RoomView_timeline_rr_enabled"\n                            >\n                            <div\n                                class="\n                                mx_AutoHideScrollbar\n                                mx_ScrollPanel\n                                mx_RoomView_messagePanel\n                                "\n                            >\n                                <div class="mx_RoomView_messageListWrapper">\n                                <ol\n                                    class="mx_RoomView_MessageList"\n                                    aria-live="polite"\n                                    role="list"\n                                >\n                                ${0==t?`<div class="mx_NewRoomIntro">\n                                        ${u}\n                                        <h2> ${_} </h2>\n                                        <p> ${w} <br/><br/> ${O} </p>\n                                        <br/>\n                                        <p> ${x} </p>\n                                    </div>`:""}\n                                ${e}\n                                </ol>\n                                </div>\n                            </div>\n                            </div>\n                            <div class="mx_RoomView_statusArea">\n                            <div class="mx_RoomView_statusAreaBox">\n                                <div class="mx_RoomView_statusAreaBox_line"></div>\n                            </div>\n                            </div>\n                        </div>\n                        </div>\n                        ${R}\n                    </main>\n                    </div>\n                </div>\n                </section>\n                <div id="snackbar"/>\n            </body>\n        </html>`}getAvatarURL(e){const t=e.sender,n=null==t?void 0:t.getMxcAvatarUrl();return n?Object(g.b)(n).getThumbnailOfSourceHttp(30,30,"crop"):null}async saveAvatarIfNeeded(e){const t=e.sender;if(!this.avatars.has(t.userId))try{const n=this.getAvatarURL(e);this.avatars.set(t.userId,!0);const a=await fetch(n),i=await a.blob();this.addFile(`users/${t.userId.replace(/:/g,"-")}.png`,i)}catch(e){u.a.log("Failed to fetch user's avatar"+e)}}getDateSeparator(e){const t=e.getTs(),n=o.a.createElement("li",{key:t},o.a.createElement(_.a,{forExport:!0,key:t,roomId:e.getRoomId(),ts:t}));return Object(d.renderToStaticMarkup)(n)}needsDateSeparator(e,t){return!t||Object(f.p)(t.getDate()||void 0,e.getDate()||void 0)}getEventTile(e,t){return o.a.createElement("div",{className:"mx_Export_EventWrapper",id:e.getId()},o.a.createElement(O.a.Provider,{value:this.room.client},o.a.createElement(S.b,{mxEvent:e,continuation:t,isRedacted:e.isRedacted(),replacingEventId:e.replacingEventId(),forExport:!0,alwaysShowTimestamps:!0,showUrlPreview:!1,checkUnmounting:()=>!1,isTwelveHour:!1,last:!1,lastInSection:!1,permalinkCreator:this.permalinkCreator,lastSuccessful:!1,isSelectedEvent:!1,showReactions:!1,layout:b.a.Group,showReadReceipts:!1})))}async getEventTileMarkup(e,t,n){const a=this.getAvatarURL(e),i=!!a;i&&await this.saveAvatarIfNeeded(e);const r=this.getEventTile(e,t);let o;if(e.getContent().msgtype==c.MsgType.Emote||e.getContent().msgtype==c.MsgType.Notice||e.getContent().msgtype===c.MsgType.Text){const e=document.createElement("div");l.a.render(r,e),o=e.innerHTML}else o=Object(d.renderToStaticMarkup)(r);if(n){var s,u;const t=null!==(s=e.getContent().url)&&void 0!==s?s:null===(u=e.getContent().file)||void 0===u?void 0:u.url;o=o.split(t).join(n)}return o=o.replace(/<span class="mx_MFileBody_info_icon".*?>.*?<\/span>/,""),i&&(o=o.replace(encodeURI(a).replace(/&/g,"&amp;"),`users/${e.sender.userId.replace(/:/g,"-")}.png`)),o}createModifiedEvent(e,t,n=!0){const a={msgtype:c.MsgType.Text,body:`${e}`,format:"org.matrix.custom.html",formatted_body:`${e}`};n&&(a.formatted_body="<em>"+a.formatted_body+"</em>",a.body="*"+a.body+"*");const i=new c.MatrixEvent;return i.event=t.event,i.sender=t.sender,i.event.type="m.room.message",i.event.content=a,i}async createMessageBody(e,t=!1){let n;try{if(this.isAttachment(e))if(this.exportOptions.attachmentsIncluded)try{const a=await this.getMediaBlob(e);if(this.totalSize+a.size>this.exportOptions.maxSize)n=await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText,e),t);else{this.totalSize+=a.size;const i=this.getFilePath(e);n=await this.getEventTileMarkup(e,t,i),this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1),this.addFile(i,a)}}catch(a){u.a.log("Error while fetching file"+a),n=await this.getEventTileMarkup(this.createModifiedEvent(Object(E.b)("Error fetching file"),e),t)}else n=await this.getEventTileMarkup(this.createModifiedEvent(this.mediaOmitText,e),t);else n=await this.getEventTileMarkup(e,t)}catch(a){u.a.error(a),n=await this.getEventTileMarkup(this.createModifiedEvent(Object(k.b)(e,this.room.client),e,!1),t)}return n}async createHTML(t,n,a,i){let r="",o=null;for(let a=n;a<Math.min(n+1e3,t.length);a++){const n=t[a];if(this.updateProgress(Object(E.b)("Processing event %(number)s out of %(total)s",{number:a+1,total:t.length}),!1,!0),this.cancelled)return this.cleanUp();if(!Object(R.c)(n,this.room.client,!1))continue;r+=this.needsDateSeparator(n,o)?this.getDateSeparator(n):"";const i=!this.needsDateSeparator(n,o)&&Object(v.b)(o,n,this.room.client,!1),s=await this.createMessageBody(n,i);this.totalSize+=e.byteLength(s),r+=s,o=n}return this.wrapHTML(r,a,i)}async export(){this.updateProgress(Object(E.b)("Starting export…"));const e=performance.now(),t=await this.getRequiredEvents(),n=performance.now();this.updateProgress(Object(E.b)("Fetched %(count)s events in %(seconds)ss",{count:t.length,seconds:(n-e)/1e3}),!0,!1),this.updateProgress(Object(E.b)("Creating HTML…"));const a=new Set;for(let e=0;e<t.length/1e3;e++){const n=await this.createHTML(t,1e3*e,e,t.length/1e3);(new DOMParser).parseFromString(n,"text/html").querySelectorAll("*").forEach((e=>{e.classList.forEach((e=>a.add(e)))})),this.addFile(`messages${e?e+1:""}.html`,new Blob([n]))}const i=await Object(x.a)(a);this.addFile("css/style.css",new Blob([i])),this.addFile("js/script.js",new Blob([j.a])),await this.downloadZIP();const r=performance.now();this.cancelled?u.a.info("Export cancelled successfully"):(this.updateProgress(Object(E.b)("Export successful!")),this.updateProgress(Object(E.b)("Exported %(count)s events in %(seconds)s seconds",{count:t.length,seconds:(r-e)/1e3}))),this.cleanUp()}}}).call(this,n(195).Buffer)},1533:function(e,t,n){"use strict";e.exports=n(1534)},1534:function(e,t,n){"use strict";var a=n(646),i=n(0);function r(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=60106,s=60107,l=60108,c=60114,d=60109,u=60110,m=60112,h=60113,p=60120,g=60115,b=60116,v=60121,f=60117,y=60119,E=60129,w=60131;if("function"==typeof Symbol&&Symbol.for){var S=Symbol.for;o=S("react.portal"),s=S("react.fragment"),l=S("react.strict_mode"),c=S("react.profiler"),d=S("react.provider"),u=S("react.context"),m=S("react.forward_ref"),h=S("react.suspense"),p=S("react.suspense_list"),g=S("react.memo"),b=S("react.lazy"),v=S("react.block"),f=S("react.fundamental"),y=S("react.scope"),E=S("react.debug_trace_mode"),w=S("react.legacy_hidden")}function _(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case s:return"Fragment";case o:return"Portal";case c:return"Profiler";case l:return"StrictMode";case h:return"Suspense";case p:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case u:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case m:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case g:return _(e.type);case v:return _(e._render);case b:t=e._payload,e=e._init;try{return _(e(t))}catch(e){}}return null}var C=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,O={};function x(e,t){for(var n=0|e._threadCount;n<=t;n++)e[n]=e._currentValue2,e._threadCount=n+1}for(var k=new Uint16Array(16),R=0;15>R;R++)k[R]=R+1;k[15]=0;var j=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I=Object.prototype.hasOwnProperty,T={},P={};function N(e){return!!I.call(P,e)||!I.call(T,e)&&(j.test(e)?P[e]=!0:(T[e]=!0,!1))}function D(e,t,n,a,i,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=a,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=o}var M={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){M[e]=new D(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];M[t]=new D(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){M[e]=new D(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){M[e]=new D(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){M[e]=new D(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){M[e]=new D(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){M[e]=new D(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){M[e]=new D(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){M[e]=new D(e,5,!1,e.toLowerCase(),null,!1,!1)}));var A=/[\-:]([a-z])/g;function L(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(A,L);M[t]=new D(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(A,L);M[t]=new D(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(A,L);M[t]=new D(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){M[e]=new D(e,1,!1,e.toLowerCase(),null,!1,!1)})),M.xlinkHref=new D("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){M[e]=new D(e,1,!1,e.toLowerCase(),null,!0,!0)}));var U=/["'&<>]/;function F(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=U.exec(e);if(t){var n,a="",i=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}i!==n&&(a+=e.substring(i,n)),i=n+1,a+=t}e=i!==n?a+e.substring(i,n):a}return e}function B(e,t){var n,a=M.hasOwnProperty(e)?M[e]:null;return(n="style"!==e)&&(n=null!==a?0===a.type:2<e.length&&("o"===e[0]||"O"===e[0])&&("n"===e[1]||"N"===e[1])),n||function(e,t,n,a){if(null==t||function(e,t,n,a){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!a&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,a))return!0;if(a)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(e,t,a,!1)?"":null!==a?(e=a.attributeName,3===(n=a.type)||4===n&&!0===t?e+'=""':(a.sanitizeURL&&(t=""+t),e+'="'+F(t)+'"')):N(e)?e+'="'+F(t)+'"':""}var V="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},W=null,z=null,H=null,G=!1,K=!1,q=null,$=0;function Y(){if(null===W)throw Error(r(321));return W}function J(){if(0<$)throw Error(r(312));return{memoizedState:null,queue:null,next:null}}function Q(){return null===H?null===z?(G=!1,z=H=J()):(G=!0,H=z):null===H.next?(G=!1,H=H.next=J()):(G=!0,H=H.next),H}function X(e,t,n,a){for(;K;)K=!1,$+=1,H=null,n=e(t,a);return Z(),n}function Z(){W=null,K=!1,z=null,$=0,H=q=null}function ee(e,t){return"function"==typeof t?t(e):t}function te(e,t,n){if(W=Y(),H=Q(),G){var a=H.queue;if(t=a.dispatch,null!==q&&void 0!==(n=q.get(a))){q.delete(a),a=H.memoizedState;do{a=e(a,n.action),n=n.next}while(null!==n);return H.memoizedState=a,[a,t]}return[H.memoizedState,t]}return e=e===ee?"function"==typeof t?t():t:void 0!==n?n(t):t,H.memoizedState=e,e=(e=H.queue={last:null,dispatch:null}).dispatch=ae.bind(null,W,e),[H.memoizedState,e]}function ne(e,t){if(W=Y(),t=void 0===t?null:t,null!==(H=Q())){var n=H.memoizedState;if(null!==n&&null!==t){var a=n[1];e:if(null===a)a=!1;else{for(var i=0;i<a.length&&i<t.length;i++)if(!V(t[i],a[i])){a=!1;break e}a=!0}if(a)return n[0]}}return e=e(),H.memoizedState=[e,t],e}function ae(e,t,n){if(!(25>$))throw Error(r(301));if(e===W)if(K=!0,e={action:n,next:null},null===q&&(q=new Map),void 0===(n=q.get(t)))q.set(t,e);else{for(t=n;null!==t.next;)t=t.next;t.next=e}}function ie(){}var re=null,oe={readContext:function(e){var t=re.threadID;return x(e,t),e[t]},useContext:function(e){Y();var t=re.threadID;return x(e,t),e[t]},useMemo:ne,useReducer:te,useRef:function(e){W=Y();var t=(H=Q()).memoizedState;return null===t?(e={current:e},H.memoizedState=e):t},useState:function(e){return te(ee,e)},useLayoutEffect:function(){},useCallback:function(e,t){return ne((function(){return e}),t)},useImperativeHandle:ie,useEffect:ie,useDebugValue:ie,useDeferredValue:function(e){return Y(),e},useTransition:function(){return Y(),[function(e){e()},!1]},useOpaqueIdentifier:function(){return(re.identifierPrefix||"")+"R:"+(re.uniqueID++).toString(36)},useMutableSource:function(e,t){return Y(),t(e._source)}},se="http://www.w3.org/1999/xhtml";function le(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}var ce={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},de=a({menuitem:!0},ce),ue={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},me=["Webkit","ms","Moz","O"];Object.keys(ue).forEach((function(e){me.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),ue[t]=ue[e]}))}));var he=/([A-Z])/g,pe=/^ms-/,ge=i.Children.toArray,be=C.ReactCurrentDispatcher,ve={listing:!0,pre:!0,textarea:!0},fe=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,ye={},Ee={};var we=Object.prototype.hasOwnProperty,Se={children:null,dangerouslySetInnerHTML:null,suppressContentEditableWarning:null,suppressHydrationWarning:null};function _e(e,t){if(void 0===e)throw Error(r(152,_(t)||"Component"))}function Ce(e,t,n){function o(i,o){var s=o.prototype&&o.prototype.isReactComponent,l=function(e,t,n,a){if(a&&"object"==typeof(a=e.contextType)&&null!==a)return x(a,n),a[n];if(e=e.contextTypes){for(var i in n={},e)n[i]=t[i];t=n}else t=O;return t}(o,t,n,s),c=[],d=!1,u={isMounted:function(){return!1},enqueueForceUpdate:function(){if(null===c)return null},enqueueReplaceState:function(e,t){d=!0,c=[t]},enqueueSetState:function(e,t){if(null===c)return null;c.push(t)}};if(s){if(s=new o(i.props,l,u),"function"==typeof o.getDerivedStateFromProps){var m=o.getDerivedStateFromProps.call(null,i.props,s.state);null!=m&&(s.state=a({},s.state,m))}}else if(W={},s=o(i.props,l,u),null==(s=X(o,i.props,s,l))||null==s.render)return void _e(e=s,o);if(s.props=i.props,s.context=l,s.updater=u,void 0===(u=s.state)&&(s.state=u=null),"function"==typeof s.UNSAFE_componentWillMount||"function"==typeof s.componentWillMount)if("function"==typeof s.componentWillMount&&"function"!=typeof o.getDerivedStateFromProps&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&"function"!=typeof o.getDerivedStateFromProps&&s.UNSAFE_componentWillMount(),c.length){u=c;var h=d;if(c=null,d=!1,h&&1===u.length)s.state=u[0];else{m=h?u[0]:s.state;var p=!0;for(h=h?1:0;h<u.length;h++){var g=u[h];null!=(g="function"==typeof g?g.call(s,m,i.props,l):g)&&(p?(p=!1,m=a({},m,g)):a(m,g))}s.state=m}}else c=null;if(_e(e=s.render(),o),"function"==typeof s.getChildContext&&"object"==typeof(i=o.childContextTypes)){var b=s.getChildContext();for(var v in b)if(!(v in i))throw Error(r(108,_(o)||"Unknown",v))}b&&(t=a({},t,b))}for(;i.isValidElement(e);){var s=e,l=s.type;if("function"!=typeof l)break;o(s,l)}return{child:e,context:t}}var Oe=function(){function e(e,t,n){i.isValidElement(e)?e.type!==s?e=[e]:(e=e.props.children,e=i.isValidElement(e)?[e]:ge(e)):e=ge(e),e={type:null,domNamespace:se,children:e,childIndex:0,context:O,footer:""};var a=k[0];if(0===a){var o=k,l=2*(a=o.length);if(!(65536>=l))throw Error(r(304));var c=new Uint16Array(l);for(c.set(o),(k=c)[0]=a+1,o=a;o<l-1;o++)k[o]=o+1;k[l-1]=0}else k[0]=k[a];this.threadID=a,this.stack=[e],this.exhausted=!1,this.currentSelectValue=null,this.previousWasTextNode=!1,this.makeStaticMarkup=t,this.suspenseDepth=0,this.contextIndex=-1,this.contextStack=[],this.contextValueStack=[],this.uniqueID=0,this.identifierPrefix=n&&n.identifierPrefix||""}var t=e.prototype;return t.destroy=function(){if(!this.exhausted){this.exhausted=!0,this.clearProviders();var e=this.threadID;k[e]=k[0],k[0]=e}},t.pushProvider=function(e){var t=++this.contextIndex,n=e.type._context,a=this.threadID;x(n,a);var i=n[a];this.contextStack[t]=n,this.contextValueStack[t]=i,n[a]=e.props.value},t.popProvider=function(){var e=this.contextIndex,t=this.contextStack[e],n=this.contextValueStack[e];this.contextStack[e]=null,this.contextValueStack[e]=null,this.contextIndex--,t[this.threadID]=n},t.clearProviders=function(){for(var e=this.contextIndex;0<=e;e--)this.contextStack[e][this.threadID]=this.contextValueStack[e]},t.read=function(e){if(this.exhausted)return null;var t=re;re=this;var n=be.current;be.current=oe;try{for(var a=[""],i=!1;a[0].length<e;){if(0===this.stack.length){this.exhausted=!0;var o=this.threadID;k[o]=k[0],k[0]=o;break}var s=this.stack[this.stack.length-1];if(i||s.childIndex>=s.children.length){var l=s.footer;if(""!==l&&(this.previousWasTextNode=!1),this.stack.pop(),"select"===s.type)this.currentSelectValue=null;else if(null!=s.type&&null!=s.type.type&&s.type.type.$$typeof===d)this.popProvider(s.type);else if(s.type===h){this.suspenseDepth--;var c=a.pop();if(i){i=!1;var u=s.fallbackFrame;if(!u)throw Error(r(303));this.stack.push(u),a[this.suspenseDepth]+="\x3c!--$!--\x3e";continue}a[this.suspenseDepth]+=c}a[this.suspenseDepth]+=l}else{var m=s.children[s.childIndex++],p="";try{p+=this.render(m,s.context,s.domNamespace)}catch(e){if(null!=e&&"function"==typeof e.then)throw Error(r(294));throw e}a.length<=this.suspenseDepth&&a.push(""),a[this.suspenseDepth]+=p}}return a[0]}finally{be.current=n,re=t,Z()}},t.render=function(e,t,n){if("string"==typeof e||"number"==typeof e)return""===(n=""+e)?"":this.makeStaticMarkup?F(n):this.previousWasTextNode?"\x3c!-- --\x3e"+F(n):(this.previousWasTextNode=!0,F(n));if(e=(t=Ce(e,t,this.threadID)).child,t=t.context,null===e||!1===e)return"";if(!i.isValidElement(e)){if(null!=e&&null!=e.$$typeof){if((n=e.$$typeof)===o)throw Error(r(257));throw Error(r(258,n.toString()))}return e=ge(e),this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),""}var v=e.type;if("string"==typeof v)return this.renderDOM(e,t,n);switch(v){case w:case E:case l:case c:case p:case s:return e=ge(e.props.children),this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),"";case h:throw Error(r(294));case y:throw Error(r(343))}if("object"==typeof v&&null!==v)switch(v.$$typeof){case m:W={};var S=v.render(e.props,e.ref);return S=X(v.render,e.props,S,e.ref),S=ge(S),this.stack.push({type:null,domNamespace:n,children:S,childIndex:0,context:t,footer:""}),"";case g:return e=[i.createElement(v.type,a({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),"";case d:return n={type:e,domNamespace:n,children:v=ge(e.props.children),childIndex:0,context:t,footer:""},this.pushProvider(e),this.stack.push(n),"";case u:v=e.type,S=e.props;var _=this.threadID;return x(v,_),v=ge(S.children(v[_])),this.stack.push({type:e,domNamespace:n,children:v,childIndex:0,context:t,footer:""}),"";case f:throw Error(r(338));case b:return v=(S=(v=e.type)._init)(v._payload),e=[i.createElement(v,a({ref:e.ref},e.props))],this.stack.push({type:null,domNamespace:n,children:e,childIndex:0,context:t,footer:""}),""}throw Error(r(130,null==v?v:typeof v,""))},t.renderDOM=function(e,t,n){var o=e.type.toLowerCase();if(n===se&&le(o),!ye.hasOwnProperty(o)){if(!fe.test(o))throw Error(r(65,o));ye[o]=!0}var s=e.props;if("input"===o)s=a({type:void 0},s,{defaultChecked:void 0,defaultValue:void 0,value:null!=s.value?s.value:s.defaultValue,checked:null!=s.checked?s.checked:s.defaultChecked});else if("textarea"===o){var l=s.value;if(null==l){l=s.defaultValue;var c=s.children;if(null!=c){if(null!=l)throw Error(r(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(r(93));c=c[0]}l=""+c}null==l&&(l="")}s=a({},s,{value:void 0,children:""+l})}else if("select"===o)this.currentSelectValue=null!=s.value?s.value:s.defaultValue,s=a({},s,{value:void 0});else if("option"===o){c=this.currentSelectValue;var d=function(e){if(null==e)return e;var t="";return i.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(s.children);if(null!=c){var u=null!=s.value?s.value+"":d;if(l=!1,Array.isArray(c)){for(var m=0;m<c.length;m++)if(""+c[m]===u){l=!0;break}}else l=""+c===u;s=a({selected:void 0,children:void 0},s,{selected:l,children:d})}}if(l=s){if(de[o]&&(null!=l.children||null!=l.dangerouslySetInnerHTML))throw Error(r(137,o));if(null!=l.dangerouslySetInnerHTML){if(null!=l.children)throw Error(r(60));if("object"!=typeof l.dangerouslySetInnerHTML||!("__html"in l.dangerouslySetInnerHTML))throw Error(r(61))}if(null!=l.style&&"object"!=typeof l.style)throw Error(r(62))}l=s,c=this.makeStaticMarkup,d=1===this.stack.length,u="<"+e.type;e:if(-1===o.indexOf("-"))m="string"==typeof l.is;else switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":m=!1;break e;default:m=!0}for(w in l)if(we.call(l,w)){var h=l[w];if(null!=h){if("style"===w){var p=void 0,g="",b="";for(p in h)if(h.hasOwnProperty(p)){var v=0===p.indexOf("--"),f=h[p];if(null!=f){if(v)var y=p;else if(y=p,Ee.hasOwnProperty(y))y=Ee[y];else{var E=y.replace(he,"-$1").toLowerCase().replace(pe,"-ms-");y=Ee[y]=E}g+=b+y+":",b=p,g+=v=null==f||"boolean"==typeof f||""===f?"":v||"number"!=typeof f||0===f||ue.hasOwnProperty(b)&&ue[b]?(""+f).trim():f+"px",b=";"}}h=g||null}p=null,m?Se.hasOwnProperty(w)||(p=N(p=w)&&null!=h?p+'="'+F(h)+'"':""):p=B(w,h),p&&(u+=" "+p)}}c||d&&(u+=' data-reactroot=""');var w=u;l="",ce.hasOwnProperty(o)?w+="/>":(w+=">",l="</"+e.type+">");e:{if(null!=(c=s.dangerouslySetInnerHTML)){if(null!=c.__html){c=c.__html;break e}}else if("string"==typeof(c=s.children)||"number"==typeof c){c=F(c);break e}c=null}return null!=c?(s=[],ve.hasOwnProperty(o)&&"\n"===c.charAt(0)&&(w+="\n"),w+=c):s=ge(s.children),e=e.type,n=null==n||"http://www.w3.org/1999/xhtml"===n?le(e):"http://www.w3.org/2000/svg"===n&&"foreignObject"===e?"http://www.w3.org/1999/xhtml":n,this.stack.push({domNamespace:n,type:o,children:s,childIndex:0,context:t,footer:l}),this.previousWasTextNode=!1,w},e}();t.renderToNodeStream=function(){throw Error(r(207))},t.renderToStaticMarkup=function(e,t){e=new Oe(e,!0,t);try{return e.read(1/0)}finally{e.destroy()}},t.renderToStaticNodeStream=function(){throw Error(r(208))},t.renderToString=function(e,t){e=new Oe(e,!1,t);try{return e.read(1/0)}finally{e.destroy()}},t.version="17.0.2"},1535:function(e,t,n){"use strict";var a=n(1536),i=/[\/\?<>\\:\*\|"]/g,r=/[\x00-\x1f\x80-\x9f]/g,o=/^\.+$/,s=/^(con|prn|aux|nul|com[0-9]|lpt[0-9])(\..*)?$/i,l=/[\. ]+$/;function c(e,t){if("string"!=typeof e)throw new Error("Input must be string");var n=e.replace(i,t).replace(r,t).replace(o,t).replace(s,t).replace(l,t);return a(n,255)}e.exports=function(e,t){var n=t&&t.replacement||"",a=c(e,n);return""===n?a:c(a,"")}},1536:function(e,t,n){"use strict";var a=n(1537),i=n(1538);e.exports=a.bind(null,i)},1537:function(e,t,n){"use strict";function a(e){return e>=55296&&e<=56319}function i(e){return e>=56320&&e<=57343}e.exports=function(e,t,n){if("string"!=typeof t)throw new Error("Input must be string");for(var r,o,s=t.length,l=0,c=0;c<s;c+=1){if(r=t.charCodeAt(c),o=t[c],a(r)&&i(t.charCodeAt(c+1))&&(o+=t[c+=1]),(l+=e(o))===n)return t.slice(0,c+1);if(l>n)return t.slice(0,c-o.length+1)}return t}},1538:function(e,t,n){"use strict";function a(e){return e>=55296&&e<=56319}function i(e){return e>=56320&&e<=57343}e.exports=function(e){if("string"!=typeof e)throw new Error("Input must be string");for(var t=e.length,n=0,r=null,o=null,s=0;s<t;s++)i(r=e.charCodeAt(s))?null!=o&&a(o)?n+=1:n+=3:r<=127?n+=1:r>=128&&r<=2047?n+=2:r>=2048&&r<=65535&&(n+=3),o=r;return n}},1539:function(e,t,n){"use strict";var a=n(1540);const i=/\.[\w-]+/g;function r(e){return e.replace(/font-family: ?(Inter|'Inter'|"Inter")/g,"font-family: -apple-system, BlinkMacSystemFont, avenir next,\n            avenir, segoe ui, helvetica neue, helvetica, Ubuntu, roboto, noto, arial, sans-serif").replace(/font-family: ?Inconsolata/g,"font-family: Menlo, Consolas, Monaco, Liberation Mono, Lucida Console, monospace")}function o(e){var t;return"light"===(null===(t=e.ownerNode.dataset.mxTheme)||void 0===t?void 0:t.toLowerCase())}t.a=async e=>{const t=Array.from(document.styleSheets).filter((e=>{var t;return(null===(t=e.href)||void 0===t?void 0:t.endsWith("bundle.css"))||o(e)}));if(!t.some(o)){var n;const e=null===(n=document.querySelector('link[rel="stylesheet"][href$="theme-light.css"]'))||void 0===n?void 0:n.href;e&&t.push(await async function(e){const t=document.implementation.createHTMLDocument(""),n=document.createElement("style"),a=await fetch(e);return n.textContent=await a.text(),t.body.appendChild(n),n.sheet}(e))}let s="";for(const n of t)for(const t of n.cssRules){if(t instanceof CSSFontFaceRule)continue;const n=t.selectorText;null!=n&&n.split(",").every((t=>{const n=t.match(i);if(n&&!n.every((t=>e.has(t.substring(1)))))return!0}))||(s+=r(t.cssText)+"\n")}return s+a.a}},1541:function(e,t,n){"use strict";t.a='/*\nCopyright 2021 The Matrix.org Foundation C.I.C.\n\nLicensed under the Apache License, Version 2.0 (the "License");\nyou may not use this file except in compliance with the License.\nYou may obtain a copy of the License at\n\nhttp://www.apache.org/licenses/LICENSE-2.0\n\nUnless required by applicable law or agreed to in writing, software\ndistributed under the License is distributed on an "AS IS" BASIS,\nWITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\nSee the License for the specific language governing permissions and\nlimitations under the License.\n*/\n\n// This file is raw-imported (imported as plain text) for the export bundle, which is why this is in JS\nfunction showToastIfNeeded(replyId) {\n    const el = document.getElementById(replyId);\n    if (!el) {\n        showToast("The message you\'re looking for wasn\'t exported");\n        return;\n    }\n}\n\nfunction showToast(text) {\n    const el = document.getElementById("snackbar");\n    el.innerHTML = text;\n    el.className = "mx_show";\n    window.setTimeout(() => {\n        el.className = el.className.replace("mx_show", "");\n    }, 2000);\n}\n\nwindow.onload = () => {\n    document.querySelectorAll(".mx_reply_anchor").forEach((element) => {\n        element.addEventListener("click", (event) => {\n            showToastIfNeeded(event.target.dataset.scrollTo);\n        });\n    });\n};\n'},1542:function(e,t){e.exports="img/stickerpack-placeholder.c50e1de.png"},1543:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return p}));var a,i,r,o,s,l,c,d,u,m=n(0);function h(){return h=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},h.apply(this,arguments)}function p(e){return m.createElement("svg",h({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 31 31",role:"presentation","aria-hidden":!0},e),a||(a=m.createElement("path",{fill:"none",d:"M0 0h31v31H0z"})),i||(i=m.createElement("circle",{cx:15.5,cy:15.5,r:15.5,fill:"#A2A2A2"})),r||(r=m.createElement("path",{d:"M22.855 15.5a7.355 7.355 0 11-14.71 0 7.355 7.355 0 0114.71 0zM15.5 24.25a8.75 8.75 0 100-17.5 8.75 8.75 0 000 17.5z",fill:"#fff",stroke:"#fff",strokeWidth:.5})),o||(o=m.createElement("path",{fill:"#A2A2A2",d:"M16.266 30.503h-1.5L14.76 1.1h1.5z"})),s||(s=m.createElement("path",{fill:"#A2A2A2",d:"M8.894 28.844l-1.294-.76L22.605 2.503l1.294.759z"})),l||(l=m.createElement("path",{fill:"#A2A2A2",d:"M2.88 24.495l-.786-1.278L27.71 7.46l.786 1.277z"})),c||(c=m.createElement("path",{fill:"#A2A2A2",d:"M2.163 23.341L1.49 22l26.51-13.264.671 1.341z"})),d||(d=m.createElement("path",{fill:"#A2A2A2",d:"M1.551 22.134L1 20.74 28.433 9.887l.552 1.394z"})),u||(u=m.createElement("path",{d:"M9.5 17l-2 3-2-3h4zM21.5 15l2-3 2 3h-4z",fill:"#fff",stroke:"#fff"})))}t.default="img/room_replaced.97416ee.svg"},1544:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16 0C7.163 0 0 7.163 0 16s7.163 16 16 16 16-7.163 16-16S24.837 0 16 0zm1.251 6.974a1.496 1.496 0 00-2.051-.129 1.495 1.495 0 00-.13.12l-6.274 6.589a1.5 1.5 0 102.173 2.069l3.688-3.873V23.06a1.5 1.5 0 103 0V11.75l3.688 3.873a1.5 1.5 0 102.173-2.07L17.25 6.975z",fill:"#0DBD8B"})))}t.default="img/upload-big.dcf3fb1.svg"},1545:function(e,t,n){"use strict";var a;Object.defineProperty(t,"__esModule",{value:!0}),t.RoomViewLifecycle=void 0,t.RoomViewLifecycle=a,function(e){e.PreviewRoomNotLoggedIn="preview_not_logged_in",e.JoinFromRoomPreview="try_join_not_logged_in"}(a||(t.RoomViewLifecycle=a={}))},1546:function(e,t,n){"use strict";e.exports=n(1547)},1547:function(e,t,n){"use strict";n(646);var a=n(0),i=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var r=Symbol.for;i=r("react.element"),t.Fragment=r("react.fragment")}var o=a.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var a,r={},c=null,d=null;for(a in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)s.call(t,a)&&!l.hasOwnProperty(a)&&(r[a]=t[a]);if(e&&e.defaultProps)for(a in t=e.defaultProps)void 0===r[a]&&(r[a]=t[a]);return{$$typeof:i,type:e,key:c,ref:d,props:r,_owner:o.current}}t.jsx=c,t.jsxs=c},1548:function(e,t,n){var a=n(17),i=n(0),r=n(1549),o=n(1419),s=n(1550),l=n(1551),c=n(1553),d=n(1420);function u(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}function m(e){return e&&e.__esModule?e.default:e}u(e.exports,"createFormScope",(()=>p)),u(e.exports,"Form",(()=>E)),u(e.exports,"FormField",(()=>C)),u(e.exports,"FormLabel",(()=>x)),u(e.exports,"FormControl",(()=>R)),u(e.exports,"FormMessage",(()=>P)),u(e.exports,"FormValidityState",(()=>L)),u(e.exports,"FormSubmit",(()=>U)),u(e.exports,"Root",(()=>K)),u(e.exports,"Field",(()=>q)),u(e.exports,"Label",(()=>$)),u(e.exports,"Control",(()=>Y)),u(e.exports,"Message",(()=>J)),u(e.exports,"ValidityState",(()=>Q)),u(e.exports,"Submit",(()=>X));const[h,p]=s.createContextScope("Form"),g="Form",[b,v]=h(g),[f,y]=h(g),E=i.forwardRef(((e,t)=>{const{__scopeForm:n,onClearServerErrors:s=(()=>{}),...l}=e,c=i.useRef(null),u=o.useComposedRefs(t,c),[h,p]=i.useState({}),g=i.useCallback((e=>h[e]),[h]),v=i.useCallback(((e,t)=>p((n=>{var a;return{...n,[e]:{...null!==(a=n[e])&&void 0!==a?a:{},...t}}}))),[]),y=i.useCallback((e=>{p((t=>({...t,[e]:void 0}))),x((t=>({...t,[e]:{}})))}),[]),[E,w]=i.useState({}),S=i.useCallback((e=>{var t;return null!==(t=E[e])&&void 0!==t?t:[]}),[E]),_=i.useCallback(((e,t)=>{w((n=>{var a;return{...n,[e]:[...null!==(a=n[e])&&void 0!==a?a:[],t]}}))}),[]),C=i.useCallback(((e,t)=>{w((n=>{var a;return{...n,[e]:(null!==(a=n[e])&&void 0!==a?a:[]).filter((e=>e.id!==t))}}))}),[]),[O,x]=i.useState({}),k=i.useCallback((e=>{var t;return null!==(t=O[e])&&void 0!==t?t:{}}),[O]),R=i.useCallback(((e,t)=>{x((n=>{var a;return{...n,[e]:{...null!==(a=n[e])&&void 0!==a?a:{},...t}}}))}),[]),[j,I]=i.useState({}),T=i.useCallback(((e,t)=>{I((n=>{const a=new Set(n[e]).add(t);return{...n,[e]:a}}))}),[]),P=i.useCallback(((e,t)=>{I((n=>{const a=new Set(n[e]);return a.delete(t),{...n,[e]:a}}))}),[]),N=i.useCallback((e=>{var t;return Array.from(null!==(t=j[e])&&void 0!==t?t:[]).join(" ")||void 0}),[j]);return i.createElement(b,{scope:n,getFieldValidity:g,onFieldValidityChange:v,getFieldCustomMatcherEntries:S,onFieldCustomMatcherEntryAdd:_,onFieldCustomMatcherEntryRemove:C,getFieldCustomErrors:k,onFieldCustomErrorsChange:R,onFieldValiditionClear:y},i.createElement(f,{scope:n,onFieldMessageIdAdd:T,onFieldMessageIdRemove:P,getFieldDescription:N},i.createElement(d.Primitive.form,m(a)({},l,{ref:u,onInvalid:r.composeEventHandlers(e.onInvalid,(e=>{const t=W(e.currentTarget);t===e.target&&t.focus(),e.preventDefault()})),onSubmit:r.composeEventHandlers(e.onSubmit,s,{checkForDefaultPrevented:!1}),onReset:r.composeEventHandlers(e.onReset,s)}))))})),w="FormField",[S,_]=h(w),C=i.forwardRef(((e,t)=>{const{__scopeForm:n,name:r,serverInvalid:o=!1,...s}=e,c=v(w,n).getFieldValidity(r),u=l.useId();return i.createElement(S,{scope:n,id:u,name:r,serverInvalid:o},i.createElement(d.Primitive.div,m(a)({"data-valid":H(c,o),"data-invalid":G(c,o)},s,{ref:t})))})),O="FormLabel",x=i.forwardRef(((e,t)=>{const{__scopeForm:n,...r}=e,o=v(O,n),s=_(O,n),l=r.htmlFor||s.id,d=o.getFieldValidity(s.name);return i.createElement(c.Label,m(a)({"data-valid":H(d,s.serverInvalid),"data-invalid":G(d,s.serverInvalid)},r,{ref:t,htmlFor:l}))})),k="FormControl",R=i.forwardRef(((e,t)=>{const{__scopeForm:n,...s}=e,l=v(k,n),c=_(k,n),u=y(k,n),h=i.useRef(null),p=o.useComposedRefs(t,h),g=s.name||c.name,b=s.id||c.id,f=l.getFieldCustomMatcherEntries(g),{onFieldValidityChange:E,onFieldCustomErrorsChange:w,onFieldValiditionClear:S}=l,C=i.useCallback((async e=>{if(z(e.validity)){const t=F(e.validity);return void E(g,t)}const t=e.form?new FormData(e.form):new FormData,n=[e.value,t],a=[],i=[];f.forEach((e=>{var t,r;r=n,"AsyncFunction"===(t=e).match.constructor.name||function(e,t){return e(...t)instanceof Promise}(t.match,r)?i.push(e):function(e){return"Function"===e.match.constructor.name}(e)&&a.push(e)}));const r=a.map((({id:e,match:t})=>[e,t(...n)])),o=Object.fromEntries(r),s=Object.values(o).some(Boolean),l=s;e.setCustomValidity(l?j:"");const c=F(e.validity);if(E(g,c),w(g,o),!s&&i.length>0){const t=i.map((({id:e,match:t})=>t(...n).then((t=>[e,t])))),a=await Promise.all(t),r=Object.fromEntries(a),o=Object.values(r).some(Boolean);e.setCustomValidity(o?j:"");const s=F(e.validity);E(g,s),w(g,r)}}),[f,g,w,E]);i.useEffect((()=>{const e=h.current;if(e){const t=()=>C(e);return e.addEventListener("change",t),()=>e.removeEventListener("change",t)}}),[C]);const O=i.useCallback((()=>{const e=h.current;e&&(e.setCustomValidity(""),S(g))}),[g,S]);i.useEffect((()=>{var e;const t=null===(e=h.current)||void 0===e?void 0:e.form;if(t)return t.addEventListener("reset",O),()=>t.removeEventListener("reset",O)}),[O]),i.useEffect((()=>{const e=h.current,t=null==e?void 0:e.closest("form");if(t&&c.serverInvalid){const n=W(t);n===e&&n.focus()}}),[c.serverInvalid]);const x=l.getFieldValidity(g);return i.createElement(d.Primitive.input,m(a)({"data-valid":H(x,c.serverInvalid),"data-invalid":G(x,c.serverInvalid),"aria-invalid":!!c.serverInvalid||void 0,"aria-describedby":u.getFieldDescription(g),title:""},s,{ref:p,id:b,name:g,onInvalid:r.composeEventHandlers(e.onInvalid,(e=>{const t=e.currentTarget;C(t)})),onChange:r.composeEventHandlers(e.onChange,(e=>{O()}))}))})),j="This value is not valid",I={badInput:j,patternMismatch:"This value does not match the required pattern",rangeOverflow:"This value is too large",rangeUnderflow:"This value is too small",stepMismatch:"This value does not match the required step",tooLong:"This value is too long",tooShort:"This value is too short",typeMismatch:"This value does not match the required type",valid:void 0,valueMissing:"This value is missing"},T="FormMessage",P=i.forwardRef(((e,t)=>{const{match:n,name:r,...o}=e,s=_(T,e.__scopeForm),l=null!=r?r:s.name;return void 0===n?i.createElement(M,m(a)({},o,{ref:t,name:l}),e.children||j):"function"==typeof n?i.createElement(D,m(a)({match:n},o,{ref:t,name:l})):i.createElement(N,m(a)({match:n},o,{ref:t,name:l}))})),N=i.forwardRef(((e,t)=>{const{match:n,forceMatch:r=!1,name:o,children:s,...l}=e,c=v(T,l.__scopeForm).getFieldValidity(o);return r||(null==c?void 0:c[n])?i.createElement(M,m(a)({ref:t},l,{name:o}),null!=s?s:I[n]):null})),D=i.forwardRef(((e,t)=>{const{match:n,forceMatch:r=!1,name:s,id:c,children:d,...u}=e,h=v(T,u.__scopeForm),p=i.useRef(null),g=o.useComposedRefs(t,p),b=l.useId(),f=null!=c?c:b,y=i.useMemo((()=>({id:f,match:n})),[f,n]),{onFieldCustomMatcherEntryAdd:E,onFieldCustomMatcherEntryRemove:w}=h;i.useEffect((()=>(E(s,y),()=>w(s,y.id))),[y,s,E,w]);const S=h.getFieldValidity(s),_=h.getFieldCustomErrors(s)[f];return r||S&&!z(S)&&_?i.createElement(M,m(a)({id:f,ref:g},u,{name:s}),null!=d?d:j):null})),M=i.forwardRef(((e,t)=>{const{__scopeForm:n,id:r,name:o,...s}=e,c=y(T,n),u=l.useId(),h=null!=r?r:u,{onFieldMessageIdAdd:p,onFieldMessageIdRemove:g}=c;return i.useEffect((()=>(p(o,h),()=>g(o,h))),[o,h,p,g]),i.createElement(d.Primitive.span,m(a)({id:h},s,{ref:t}))})),A="FormValidityState",L=e=>{const{__scopeForm:t,name:n,children:a}=e,r=v(A,t),o=_(A,t),s=null!=n?n:o.name,l=r.getFieldValidity(s);return i.createElement(i.Fragment,null,a(l))},U=i.forwardRef(((e,t)=>{const{__scopeForm:n,...r}=e;return i.createElement(d.Primitive.button,m(a)({type:"submit"},r,{ref:t}))}));function F(e){const t={};for(const n in e)t[n]=e[n];return t}function B(e){return e instanceof HTMLElement}function V(e){return"validity"in e&&(!1===e.validity.valid||"true"===e.getAttribute("aria-invalid"))}function W(e){const t=e.elements,[n]=Array.from(t).filter(B).filter(V);return n}function z(e){let t=!1;for(const n in e){if("valid"!==n&&"customError"!==n&&e[n]){t=!0;break}}return t}function H(e,t){if(!0===(null==e?void 0:e.valid)&&!t)return!0}function G(e,t){if(!1===(null==e?void 0:e.valid)||t)return!0}const K=E,q=C,$=x,Y=R,J=P,Q=L,X=U},1549:function(e,t){var n,a,i,r;function o(e,t,{checkForDefaultPrevented:n=!0}={}){return function(a){if(null==e||e(a),!1===n||!a.defaultPrevented)return null==t?void 0:t(a)}}n=e.exports,a="composeEventHandlers",i=()=>o,Object.defineProperty(n,a,{get:i,set:r,enumerable:!0,configurable:!0})},1550:function(e,t,n){var a=n(0);function i(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}function r(e,t){const n=a.createContext(t);function i(e){const{children:t,...i}=e,r=a.useMemo((()=>i),Object.values(i));return a.createElement(n.Provider,{value:r},t)}return i.displayName=e+"Provider",[i,function(i){const r=a.useContext(n);if(r)return r;if(void 0!==t)return t;throw new Error(`\`${i}\` must be used within \`${e}\``)}]}function o(e,t=[]){let n=[];const i=()=>{const t=n.map((e=>a.createContext(e)));return function(n){const i=(null==n?void 0:n[e])||t;return a.useMemo((()=>({[`__scope${e}`]:{...n,[e]:i}})),[n,i])}};return i.scopeName=e,[function(t,i){const r=a.createContext(i),o=n.length;function s(t){const{scope:n,children:i,...s}=t,l=(null==n?void 0:n[e][o])||r,c=a.useMemo((()=>s),Object.values(s));return a.createElement(l.Provider,{value:c},i)}return n=[...n,i],s.displayName=t+"Provider",[s,function(n,s){const l=(null==s?void 0:s[e][o])||r,c=a.useContext(l);if(c)return c;if(void 0!==i)return i;throw new Error(`\`${n}\` must be used within \`${t}\``)}]},s(i,...t)]}function s(...e){const t=e[0];if(1===e.length)return t;const n=()=>{const n=e.map((e=>({useScope:e(),scopeName:e.scopeName})));return function(e){const i=n.reduce(((t,{useScope:n,scopeName:a})=>({...t,...n(e)[`__scope${a}`]})),{});return a.useMemo((()=>({[`__scope${t.scopeName}`]:i})),[i])}};return n.scopeName=t.scopeName,n}i(e.exports,"createContext",(()=>r)),i(e.exports,"createContextScope",(()=>o))},1551:function(e,t,n){var a,i,r,o,s=n(0),l=n(1552);a=e.exports,i="useId",r=()=>u,Object.defineProperty(a,i,{get:r,set:o,enumerable:!0,configurable:!0});const c=s["useId".toString()]||(()=>{});let d=0;function u(e){const[t,n]=s.useState(c());return l.useLayoutEffect((()=>{e||n((e=>null!=e?e:String(d++)))}),[e]),e||(t?`radix-${t}`:"")}},1552:function(e,t,n){var a,i,r,o,s=n(0);a=e.exports,i="useLayoutEffect",r=()=>l,Object.defineProperty(a,i,{get:r,set:o,enumerable:!0,configurable:!0});const l=Boolean(null===globalThis||void 0===globalThis?void 0:globalThis.document)?s.useLayoutEffect:()=>{}},1553:function(e,t,n){var a=n(17),i=n(0),r=n(1420);function o(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}o(e.exports,"Label",(()=>s)),o(e.exports,"Root",(()=>l));const s=i.forwardRef(((e,t)=>{return i.createElement(r.Primitive.label,((n=a)&&n.__esModule?n.default:n)({},e,{ref:t,onMouseDown:t=>{var n;null===(n=e.onMouseDown)||void 0===n||n.call(e,t),!t.defaultPrevented&&t.detail>1&&t.preventDefault()}}));var n})),l=s},1554:function(e,t,n){var a=n(17),i=n(0),r=n(1419);function o(e,t,n,a){Object.defineProperty(e,t,{get:n,set:a,enumerable:!0,configurable:!0})}function s(e){return e&&e.__esModule?e.default:e}o(e.exports,"Slot",(()=>l)),o(e.exports,"Slottable",(()=>d)),o(e.exports,"Root",(()=>h));const l=i.forwardRef(((e,t)=>{const{children:n,...r}=e,o=i.Children.toArray(n),l=o.find(u);if(l){const e=l.props.children,n=o.map((t=>t===l?i.Children.count(e)>1?i.Children.only(null):i.isValidElement(e)?e.props.children:null:t));return i.createElement(c,s(a)({},r,{ref:t}),i.isValidElement(e)?i.cloneElement(e,void 0,n):null)}return i.createElement(c,s(a)({},r,{ref:t}),n)}));l.displayName="Slot";const c=i.forwardRef(((e,t)=>{const{children:n,...a}=e;return i.isValidElement(n)?i.cloneElement(n,{...m(a,n.props),ref:t?r.composeRefs(t,n.ref):n.ref}):i.Children.count(n)>1?i.Children.only(null):null}));c.displayName="SlotClone";const d=({children:e})=>i.createElement(i.Fragment,null,e);function u(e){return i.isValidElement(e)&&e.type===d}function m(e,t){const n={...t};for(const a in t){const i=e[a],r=t[a];/^on[A-Z]/.test(a)?i&&r?n[a]=(...e)=>{r(...e),i(...e)}:i&&(n[a]=i):"style"===a?n[a]={...i,...r}:"className"===a&&(n[a]=[i,r].filter(Boolean).join(" "))}return{...e,...n}}const h=l},1556:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return p}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(119),l=n(1557),c=n(428);const d=58,u=58,m=76,h=8;class p extends o.a.Component{constructor(...t){super(...t),i()(this,"callViewWrapper",Object(r.createRef)()),i()(this,"initX",0),i()(this,"initY",0),i()(this,"desiredTranslationX",s.b.instance.windowWidth-h-336),i()(this,"desiredTranslationY",s.b.instance.windowHeight-u-232),i()(this,"translationX",this.desiredTranslationX),i()(this,"translationY",this.desiredTranslationY),i()(this,"mouseHeld",!1),i()(this,"scheduledUpdate",new c.a((()=>this.animationCallback()),(()=>requestAnimationFrame((()=>this.scheduledUpdate.trigger()))))),i()(this,"startingPositionX",0),i()(this,"startingPositionY",0),i()(this,"_moving",!1),i()(this,"animationCallback",(()=>{var e,t;if(!this.moving&&Math.abs(this.translationX-this.desiredTranslationX)<=1&&Math.abs(this.translationY-this.desiredTranslationY)<=1)this.translationX=this.desiredTranslationX,this.translationY=this.desiredTranslationY,this.setStyle();else{const e=this.moving?.2:.1;this.translationX=Object(l.a)(this.translationX,this.desiredTranslationX,e),this.translationY=Object(l.a)(this.translationY,this.desiredTranslationY,e),this.setStyle(),this.scheduledUpdate.mark()}null===(e=(t=this.props).onMove)||void 0===e||e.call(t)})),i()(this,"setStyle",(()=>{this.callViewWrapper.current&&(this.callViewWrapper.current.style.transform=`translateX(${this.translationX}px) translateY(${this.translationY}px)`)})),i()(this,"onResize",(()=>{this.snap(!1)})),i()(this,"snap",((e=!1)=>{var t,n;const a=this.desiredTranslationX,i=this.desiredTranslationY,r=s.b.instance.windowWidth-((null===(t=this.callViewWrapper.current)||void 0===t?void 0:t.clientWidth)||336),o=s.b.instance.windowHeight-((null===(n=this.callViewWrapper.current)||void 0===n?void 0:n.clientHeight)||232);a>=r/2&&i>=o/2?(this.desiredTranslationX=r-h,this.desiredTranslationY=o-u):a>=r/2&&i<=o/2?(this.desiredTranslationX=r-h,this.desiredTranslationY=d):a<=r/2&&i>=o/2?(this.desiredTranslationX=m,this.desiredTranslationY=o-u):(this.desiredTranslationX=m,this.desiredTranslationY=d),e||(this.translationX=this.desiredTranslationX,this.translationY=this.desiredTranslationY),this.scheduledUpdate.mark()})),i()(this,"onStartMoving",(e=>{e.preventDefault(),e.stopPropagation(),this.mouseHeld=!0,this.startingPositionX=e.clientX,this.startingPositionY=e.clientY})),i()(this,"onMoving",(e=>{this.mouseHeld&&(Math.abs(this.startingPositionX-e.clientX)<5&&Math.abs(this.startingPositionY-e.clientY)<5||(e.preventDefault(),e.stopPropagation(),this.moving||(this.moving=!0,this.initX=e.pageX-this.desiredTranslationX,this.initY=e.pageY-this.desiredTranslationY,this.scheduledUpdate.mark()),this.setTranslation(e.pageX-this.initX,e.pageY-this.initY)))})),i()(this,"onEndMoving",(t=>{this.mouseHeld&&(t.preventDefault(),t.stopPropagation(),this.mouseHeld=!1,e((()=>this.moving=!1)),this.snap(!0))})),i()(this,"onClickCapture",(e=>{this.moving&&(e.preventDefault(),e.stopPropagation())}))}get moving(){return this._moving}set moving(e){this._moving=e}componentDidMount(){document.addEventListener("mousemove",this.onMoving),document.addEventListener("mouseup",this.onEndMoving),s.b.instance.on(s.a.Resize,this.onResize),this.snap()}componentWillUnmount(){document.removeEventListener("mousemove",this.onMoving),document.removeEventListener("mouseup",this.onEndMoving),s.b.instance.off(s.a.Resize,this.onResize)}componentDidUpdate(e){e.children!==this.props.children&&this.snap(!0)}setTranslation(e,t){var n,a;const i=(null===(n=this.callViewWrapper.current)||void 0===n?void 0:n.clientWidth)||336,r=(null===(a=this.callViewWrapper.current)||void 0===a?void 0:a.clientHeight)||232;e+i>=s.b.instance.windowWidth?this.desiredTranslationX=s.b.instance.windowWidth-i:this.desiredTranslationX=e<=0?0:e,t+r>=s.b.instance.windowHeight?this.desiredTranslationY=s.b.instance.windowHeight-r:this.desiredTranslationY=t<=0?0:t}render(){const e={transform:`translateX(${this.translationX}px) translateY(${this.translationY}px)`},t=this.props.children.map((e=>e({onStartMoving:this.onStartMoving,onResize:this.onResize})));return o.a.createElement("aside",{className:this.props.className,style:e,ref:this.callViewWrapper,onClickCapture:this.onClickCapture,onDoubleClick:this.props.onDoubleClick},t)}}}).call(this,n(267).setImmediate)},1557:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(39);function i(e,t,n){return(1-(n=Object(a.clamp)(n,0,1)))*e+n*t}},1558:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(10),l=n(46),c=n(665),d=n(799),u=n(93);class m extends o.a.PureComponent{constructor(e){super(e),i()(this,"numberEntryFieldRef",Object(r.createRef)()),i()(this,"onCancelClick",(()=>{this.props.onFinished(!1)})),i()(this,"onChange",(e=>{this.setState({value:e.target.value})})),i()(this,"onFormSubmit",(e=>{e.preventDefault(),this.onDialPress()})),i()(this,"onDigitPress",((e,t)=>{var n;(this.setState({value:this.state.value+e}),"click"===t.type)&&(null===(n=this.numberEntryFieldRef.current)||void 0===n||n.focus())})),i()(this,"onDeletePress",(e=>{var t;0!==this.state.value.length&&(this.setState({value:this.state.value.slice(0,-1)}),"click"===e.type&&(null===(t=this.numberEntryFieldRef.current)||void 0===t||t.focus()))})),i()(this,"onDialPress",(async()=>{u.b.instance.dialNumber(this.state.value),this.props.onFinished(!0)})),this.state={value:""}}render(){const e=o.a.createElement(d.a,{onBackspacePress:this.onDeletePress});let t;return t=0!==this.state.value.length?o.a.createElement(l.a,{ref:this.numberEntryFieldRef,className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange,postfixComponent:e}):o.a.createElement(l.a,{ref:this.numberEntryFieldRef,className:"mx_DialPadModal_field",id:"dialpad_number",value:this.state.value,autoFocus:!0,onChange:this.onChange}),o.a.createElement("div",{className:"mx_DialPadModal"},o.a.createElement("div",null,o.a.createElement(s.a,{className:"mx_DialPadModal_cancel",onClick:this.onCancelClick})),o.a.createElement("div",{className:"mx_DialPadModal_header"},o.a.createElement("form",{onSubmit:this.onFormSubmit},t)),o.a.createElement("div",{className:"mx_DialPadModal_dialPad"},o.a.createElement(c.a,{hasDial:!0,onDigitPress:this.onDigitPress,onDeletePress:this.onDeletePress,onDialPress:this.onDialPress})))}}},1559:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(2),i=n(631),r=n(228),o=n(25);const s=()=>{window.location.href="mobile_guide/"},l=()=>{document.cookie="element_mobile_redirect_to_guide=false;path=/;max-age=14400",u()},c="mobileguide",d=()=>{const e=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,t=/Android/.test(navigator.userAgent),n=o.b.get().brand;(e||t)&&(document.cookie.includes("element_mobile_redirect_to_guide=false")||r.a.sharedInstance().addOrReplaceToast({key:c,title:Object(a.b)("Use app for a better experience"),props:{description:Object(a.b)("%(brand)s is experimental on a mobile web browser. For a better experience and the latest features, use our free native app.",{brand:n}),acceptLabel:Object(a.b)("Use app"),onAccept:s,rejectLabel:Object(a.b)("Dismiss"),onReject:l},component:i.a,priority:99}))},u=()=>{r.a.sharedInstance().dismissToast(c)}},1560:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return v}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(1342),l=n(2),c=n(10),d=n(446),u=n(38),m=n(1421),h=n(1561),p=n(529),g=n(1562),b=n(1437);class v extends o.a.Component{constructor(e){super(e),i()(this,"handleClick",(e=>async t=>{t.preventDefault(),await this.props.onClick(e)})),i()(this,"cancelButton",(()=>o.a.createElement(c.a,{"data-testid":"cancel-button",kind:"primary_outline",onClick:this.handleClick(b.a.Cancel)},Object(l.b)("Cancel")))),i()(this,"simpleSpinner",(e=>o.a.createElement("div",{className:"mx_LoginWithQR_spinner"},o.a.createElement("div",null,o.a.createElement(u.a,null),e&&o.a.createElement("p",null,e)))))}render(){let t,n,a,i,r="",u=!0,v=!1;switch(this.props.phase){case b.c.Error:switch(this.props.failureReason){case s.c.Expired:i=Object(l.b)("The linking wasn't completed in the required time.");break;case s.c.InvalidCode:i=Object(l.b)("The scanned code is invalid.");break;case s.c.UnsupportedAlgorithm:i=Object(l.b)("Linking with this device is not supported.");break;case s.c.UserDeclined:i=Object(l.b)("The request was declined on the other device.");break;case s.c.OtherDeviceAlreadySignedIn:i=Object(l.b)("The other device is already signed in.");break;case s.c.OtherDeviceNotSignedIn:i=Object(l.b)("The other device isn't signed in.");break;case s.c.UserCancelled:i=Object(l.b)("The request was cancelled.");break;case s.c.Unknown:i=Object(l.b)("An unexpected error occurred.");break;case s.c.HomeserverLacksSupport:i=Object(l.b)("The homeserver doesn't support signing in another device.");break;default:i=Object(l.b)("The request was cancelled.")}r=Object(l.b)("Connection failed"),v=!0,t=o.a.createElement(p.Icon,{className:"error"}),u=!1,n=o.a.createElement("p",{"data-testid":"cancellation-message"},i),a=o.a.createElement(o.a.Fragment,null,o.a.createElement(c.a,{"data-testid":"try-again-button",kind:"primary",onClick:this.handleClick(b.a.TryAgain)},Object(l.b)("Try again")),this.cancelButton());break;case b.c.Connected:r=Object(l.b)("Devices connected"),t=o.a.createElement(h.a,{className:"normal"}),u=!1,n=o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("Check that the code below matches with your other device:")),o.a.createElement("div",{className:"mx_LoginWithQR_confirmationDigits"},this.props.confirmationDigits),o.a.createElement("div",{className:"mx_LoginWithQR_confirmationAlert"},o.a.createElement("div",null,o.a.createElement(g.a,null)),o.a.createElement("div",null,Object(l.b)("By approving access for this device, it will have full access to your account.")))),a=o.a.createElement(o.a.Fragment,null,o.a.createElement(c.a,{"data-testid":"decline-login-button",kind:"primary_outline",onClick:this.handleClick(b.a.Decline)},Object(l.b)("Cancel")),o.a.createElement(c.a,{"data-testid":"approve-login-button",kind:"primary",onClick:this.handleClick(b.a.Approve)},Object(l.b)("Approve")));break;case b.c.ShowingQR:if(r=Object(l.b)("Sign in with QR code"),this.props.code){var f;const t=o.a.createElement("div",{className:"mx_LoginWithQR_qrWrapper"},o.a.createElement(d.a,{data:[{data:e.from(null!==(f=this.props.code)&&void 0!==f?f:""),mode:"byte"}],className:"mx_QRCode"}));n=o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("Scan the QR code below with your device that's signed out.")),o.a.createElement("ol",null,o.a.createElement("li",null,Object(l.b)("Start at the sign in screen")),o.a.createElement("li",null,Object(l.b)("Select '%(scanQRCode)s'",{scanQRCode:Object(l.b)("Scan QR code")})),o.a.createElement("li",null,Object(l.b)("Review and approve the sign in"))),t)}else n=this.simpleSpinner(),a=this.cancelButton();break;case b.c.Loading:n=this.simpleSpinner();break;case b.c.Connecting:n=this.simpleSpinner(Object(l.b)("Connecting…")),a=this.cancelButton();break;case b.c.WaitingForDevice:n=this.simpleSpinner(Object(l.b)("Waiting for device to sign in")),a=this.cancelButton();break;case b.c.Verifying:r=Object(l.b)("Success"),v=!0,n=this.simpleSpinner(Object(l.b)("Completing set up of your new device"))}return o.a.createElement("div",{"data-testid":"login-with-qr",className:"mx_LoginWithQR"},o.a.createElement("div",{className:v?"mx_LoginWithQR_centreTitle":""},u?o.a.createElement(c.a,{"data-testid":"back-button",className:"mx_LoginWithQR_BackButton",onClick:this.handleClick(b.a.Back),title:"Back"},o.a.createElement(m.a,null)):null,o.a.createElement("h1",null,t,r)),o.a.createElement("div",{className:"mx_LoginWithQR_main"},n),o.a.createElement("div",{className:"mx_LoginWithQR_buttons"},a))}}}).call(this,n(195).Buffer)},1561:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a,i,r=n(0);function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o.apply(this,arguments)}function s(e){return r.createElement("svg",o({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0},e),a||(a=r.createElement("g",{clipPath:"url(#devices_svg__clip0_721_35674)"},r.createElement("path",{d:"M5.333 9.333C5.333 8.6 5.933 8 6.667 8H28c.733 0 1.333-.6 1.333-1.334 0-.733-.6-1.333-1.333-1.333H5.333A2.675 2.675 0 002.667 8v14.666H2c-1.107 0-2 .894-2 2 0 1.107.893 2 2 2h16.667v-4H5.333V9.333zm25.334 1.333h-8c-.734 0-1.334.6-1.334 1.334v13.333c0 .734.6 1.334 1.334 1.334h8c.733 0 1.333-.6 1.333-1.334V12c0-.733-.6-1.334-1.333-1.334zm-1.334 12H24v-9.333h5.333v9.333z",fill:"currentColor"}))),i||(i=r.createElement("defs",null,r.createElement("clipPath",{id:"devices_svg__clip0_721_35674"},r.createElement("path",{fill:"#fff",d:"M0 0h32v32H0z"})))))}},1562:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 10a1.5 1.5 0 100-3 1.5 1.5 0 000 3zm-1 3a1 1 0 110-2h1a1 1 0 011 1v3.5h.5a1 1 0 110 2H12a1 1 0 01-1-1V13z",fill:"#000"})))}},1563:function(e,t,n){"use strict";var a=n(0),i=n.n(a),r=n(2),o=n(25),s=n(34),l=n(60),c=n(38);t.a=({failures:e,source:t,continuation:n,onFinished:d})=>{const[u,m]=Object(a.useState)(2),[h,p]=Object(a.useState)(!1),[g,b]=Object(a.useState)(!1),[v,f]=Object(a.useState)(!1),y=Object(a.useRef)(d),E=new Map([["_afterCrossSigningLocalKeyChange",Object(r.b)("a new master key signature")],["checkOwnCrossSigningTrust",Object(r.b)("a new cross-signing key signature")],["setDeviceVerification",Object(r.b)("a device cross-signing signature")]]),w=Object(r.b)("a key signature"),S=Object(a.useCallback)((async()=>{try{b(!0);const e=new Promise(((e,t)=>{y.current=t})).finally((()=>{p(!0)}));await Promise.race([n({shouldEmit:!1}),e]),f(!0)}catch(e){m((e=>e-1))}finally{y.current=d,b(!1)}}),[n,d]);let _;if(!v&&!h&&u>0){const n=E.get(t)||w,a=o.b.get().brand;_=i.a.createElement("div",null,i.a.createElement("p",null,Object(r.b)("%(brand)s encountered an error during upload of:",{brand:a})),i.a.createElement("p",null,n),g&&i.a.createElement(c.a,null),i.a.createElement("pre",null,JSON.stringify(e,null,2)),i.a.createElement(l.a,{primaryButton:"Retry",hasCancel:!0,onPrimaryButtonClick:S,onCancel:y.current,primaryDisabled:g}))}else{let e=Object(r.b)("Upload completed");v||(e=h?Object(r.b)("Cancelled signature upload"):Object(r.b)("Unable to upload")),_=i.a.createElement("div",null,i.a.createElement("span",null,e),i.a.createElement(l.a,{primaryButton:Object(r.b)("OK"),hasCancel:!1,onPrimaryButtonClick:d}))}return i.a.createElement(s.a,{title:v?Object(r.b)("Signature upload success"):Object(r.b)("Signature upload failed"),fixedWidth:!1,onFinished:()=>{}},_)}},1564:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(2),l=n(1351),c=n(1388),d=n(10),u=n(1429),m=n(1315);class h extends o.a.Component{constructor(e){super(e),i()(this,"onStoreUpdate",(()=>{const e=l.b.sharedInstance();this.setState({phase:e.phase,lostKeys:e.lostKeys()})})),i()(this,"onSkipClick",(()=>{l.b.sharedInstance().skip()}));const t=l.b.sharedInstance();t.on("update",this.onStoreUpdate),t.start(),this.state={phase:t.phase,lostKeys:t.lostKeys()}}componentWillUnmount(){const e=l.b.sharedInstance();e.off("update",this.onStoreUpdate),e.stop()}render(){const{phase:e,lostKeys:t}=this.state;let n,a,i;if(e===l.a.Loading)return null;if(e===l.a.Intro)t?(n=o.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),a=Object(s.b)("Unable to verify this device")):(n=o.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),a=Object(s.b)("Verify this device"));else if(e===l.a.Done)n=o.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_verified"}),a=Object(s.b)("Device verified");else if(e===l.a.ConfirmSkip)n=o.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),a=Object(s.b)("Are you sure?");else if(e===l.a.Busy)n=o.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),a=Object(s.b)("Verify this device");else if(e===l.a.ConfirmReset)n=o.a.createElement("span",{className:"mx_CompleteSecurity_headerIcon mx_E2EIcon_warning"}),a=Object(s.b)("Really reset verification keys?");else if(e!==l.a.Finished)throw new Error(`Unknown phase ${e}`);return e!==l.a.Intro&&e!==l.a.ConfirmReset||(i=o.a.createElement(d.a,{onClick:this.onSkipClick,className:"mx_CompleteSecurity_skip","aria-label":Object(s.b)("Skip verification for now")})),o.a.createElement(m.a,null,o.a.createElement(u.a,null,o.a.createElement("h1",{className:"mx_CompleteSecurity_header"},n,a,i),o.a.createElement("div",{className:"mx_CompleteSecurity_body"},o.a.createElement(c.a,{onFinished:this.props.onFinished}))))}}},1565:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return g}));var a,i,r,o,s,l,c,d,u,m,h=n(0);function p(){return p=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},p.apply(this,arguments)}function g(e){return h.createElement("svg",p({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 793.322 340.809",role:"presentation","aria-hidden":!0},e),a||(a=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M34.004 340.809H2a2 2 0 01-2-2V2a2 2 0 012-2h32.004a2 2 0 012 2v7.71a2 2 0 01-2 2h-21.13v317.386h21.13a2 2 0 012 2.001v7.712a2 2 0 01-2 2z"})),i||(i=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M10.875 9.711v321.386h23.13v7.711H1.999V2.001h32.006v7.71h-23.13zM252.402 233.711h-32.993a2 2 0 01-2-2v-68.073c0-3.949-.154-7.722-.457-11.213-.289-3.282-1.074-6.153-2.332-8.53-1.204-2.276-3.017-4.119-5.384-5.476-2.393-1.362-5.775-2.056-10.042-2.056-4.238 0-7.674.798-10.213 2.371-2.565 1.596-4.604 3.701-6.053 6.258-1.498 2.643-2.51 5.694-3.013 9.067a72.757 72.757 0 00-.793 10.741v66.91a2 2 0 01-2 2h-32.991a2 2 0 01-2-2v-67.373c0-3.435-.078-6.964-.228-10.485-.148-3.251-.767-6.278-1.841-8.995-1.018-2.571-2.667-4.584-5.047-6.153-2.372-1.552-6.029-2.341-10.865-2.341-1.372 0-3.265.328-5.629.976-2.28.624-4.536 1.826-6.705 3.577-2.152 1.732-4.036 4.306-5.605 7.655-1.569 3.356-2.367 7.877-2.367 13.438v69.701a2 2 0 01-2 2H68.857a2 2 0 01-2-2V111.594a2 2 0 012-1.999h31.13a2 2 0 012 1.999v11.007c3.834-4.499 8.248-8.152 13.173-10.896 6.396-3.559 13.799-5.362 22.002-5.362 7.846 0 15.127 1.548 21.642 4.604 5.794 2.722 10.424 7.26 13.791 13.52 3.449-4.362 7.833-8.306 13.071-11.752 6.422-4.228 14.102-6.371 22.824-6.371 6.499 0 12.625.807 18.209 2.399 5.686 1.628 10.635 4.271 14.712 7.857 4.088 3.605 7.318 8.357 9.601 14.123 2.25 5.719 3.391 12.649 3.391 20.604v80.384a2.002 2.002 0 01-2.001 2z"})),r||(r=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M99.988 111.595v16.264h.463c4.338-6.191 9.563-10.998 15.684-14.406 6.117-3.402 13.129-5.11 21.027-5.11 7.588 0 14.521 1.475 20.793 4.415 6.274 2.945 11.038 8.131 14.291 15.567 3.56-5.265 8.4-9.913 14.521-13.94 6.117-4.025 13.358-6.042 21.724-6.042 6.351 0 12.234.776 17.66 2.325 5.418 1.549 10.065 4.027 13.938 7.434 3.869 3.41 6.889 7.863 9.062 13.357 2.167 5.504 3.253 12.122 3.253 19.869v80.385H219.41v-68.074c0-4.025-.154-7.82-.465-11.385-.313-3.56-1.161-6.656-2.555-9.293-1.395-2.631-3.45-4.724-6.157-6.274-2.711-1.543-6.391-2.322-11.037-2.322s-8.403.896-11.269 2.671c-2.868 1.784-5.112 4.109-6.737 6.971-1.626 2.869-2.711 6.12-3.252 9.762a74.395 74.395 0 00-.814 11.035v66.91h-32.991v-67.375c0-3.562-.081-7.087-.23-10.57-.158-3.487-.814-6.7-1.978-9.645-1.162-2.94-3.099-5.304-5.809-7.088-2.711-1.775-6.699-2.671-11.965-2.671-1.551 0-3.603.349-6.156 1.048-2.556.697-5.036 2.016-7.435 3.949-2.404 1.938-4.454 4.726-6.158 8.363-1.705 3.642-2.556 8.402-2.556 14.287v69.701h-32.99V111.595h31.132zM304.909 236.733c-5.883 0-11.46-.729-16.574-2.163-5.192-1.464-9.806-3.774-13.713-6.871-3.944-3.117-7.068-7.111-9.282-11.871-2.205-4.733-3.324-10.412-3.324-16.876 0-7.13 1.293-13.117 3.846-17.797 2.542-4.674 5.877-8.464 9.912-11.263 3.97-2.752 8.556-4.842 13.63-6.209a142.954 142.954 0 0114.961-3.184 261.677 261.677 0 0114.754-1.872c4.679-.452 8.88-1.139 12.489-2.039 3.412-.854 6.118-2.09 8.042-3.672 1.666-1.37 2.416-3.384 2.292-6.151-.002-3.289-.502-5.816-1.492-7.595-.998-1.798-2.283-3.15-3.927-4.138-1.703-1.02-3.725-1.713-6.012-2.062-2.47-.37-5.146-.557-7.947-.557-6.034 0-10.789 1.271-14.135 3.783-3.233 2.424-5.155 6.64-5.714 12.527a2.003 2.003 0 01-1.992 1.812h-32.992a2.006 2.006 0 01-1.457-.629 2.013 2.013 0 01-.54-1.491c.485-8.073 2.55-14.894 6.142-20.272a41.725 41.725 0 0113.661-12.931c5.424-3.191 11.612-5.498 18.392-6.857a103.675 103.675 0 0120.26-2.013c6.096 0 12.365.437 18.626 1.296 6.377.88 12.285 2.622 17.562 5.177 5.376 2.604 9.845 6.29 13.282 10.951 3.498 4.744 5.271 11.048 5.271 18.731v62.494c0 5.307.306 10.462.915 15.319.576 4.64 1.572 8.116 2.963 10.338.385.616.407 1.395.055 2.031a2.002 2.002 0 01-1.75 1.03h-33.457c-.861 0-1.624-.55-1.898-1.367a49.145 49.145 0 01-1.572-5.936 49.182 49.182 0 01-.38-2.12 44.922 44.922 0 01-16.474 9.105 77.066 77.066 0 01-22.423 3.342zm37.032-60.072c-.809.409-1.676.768-2.596 1.074-2.161.72-4.511 1.326-6.988 1.807-2.442.475-5.033.872-7.699 1.186-2.631.311-5.251.697-7.784 1.146a56.995 56.995 0 00-7.051 1.792c-2.194.711-4.114 1.667-5.699 2.842-1.531 1.128-2.785 2.587-3.731 4.335-.917 1.709-1.385 3.97-1.385 6.719 0 2.598.465 4.778 1.385 6.481.928 1.722 2.142 3.035 3.716 4.018 1.644 1.026 3.601 1.757 5.816 2.17 2.344.439 4.799.663 7.297.663 6.105 0 10.836-.996 14.063-2.961 3.244-1.973 5.666-4.349 7.199-7.062 1.568-2.78 2.542-5.62 2.892-8.436.376-3.019.565-5.436.565-7.187v-8.587z"})),o||(o=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M273.544 129.255c3.405-5.113 7.744-9.215 13.012-12.316 5.264-3.097 11.186-5.303 17.771-6.621a101.17 101.17 0 0119.865-1.976c6.042 0 12.158.428 18.354 1.277 6.195.855 11.85 2.522 16.962 4.997 5.111 2.477 9.292 5.926 12.546 10.338 3.253 4.414 4.879 10.262 4.879 17.543v62.494c0 5.428.31 10.611.931 15.567.615 4.959 1.701 8.676 3.251 11.153H347.66a46.656 46.656 0 01-1.511-5.693 48.292 48.292 0 01-.813-5.923c-5.267 5.422-11.465 9.217-18.585 11.386a74.81 74.81 0 01-21.842 3.251c-5.733 0-11.077-.698-16.033-2.09-4.958-1.395-9.293-3.562-13.01-6.51-3.718-2.938-6.622-6.656-8.713-11.147s-3.138-9.84-3.138-16.033c0-6.813 1.199-12.43 3.604-16.84 2.399-4.417 5.495-7.939 9.295-10.575 3.793-2.632 8.129-4.607 13.01-5.923a140.326 140.326 0 0114.752-3.137 253.631 253.631 0 0114.638-1.857c4.801-.466 9.062-1.164 12.779-2.093 3.718-.929 6.658-2.282 8.829-4.065 2.165-1.781 3.172-4.375 3.02-7.785 0-3.56-.58-6.389-1.742-8.479-1.161-2.09-2.711-3.719-4.646-4.88-1.937-1.161-4.183-1.936-6.737-2.325-2.557-.382-5.309-.58-8.248-.58-6.506 0-11.617 1.395-15.335 4.183-3.716 2.788-5.889 7.437-6.506 13.94h-32.991c.462-7.742 2.395-14.173 5.807-19.281zm65.169 46.583a53.802 53.802 0 01-6.736 1.741c-2.402.465-4.918.853-7.551 1.161-2.635.313-5.268.698-7.899 1.163a59.302 59.302 0 00-7.317 1.857c-2.404.779-4.495 1.822-6.274 3.138-1.784 1.317-3.216 2.985-4.3 4.994-1.085 2.014-1.626 4.571-1.626 7.668 0 2.94.541 5.422 1.626 7.431 1.084 2.017 2.558 3.604 4.416 4.765s4.025 1.976 6.507 2.438c2.475.466 5.031.698 7.665.698 6.505 0 11.537-1.082 15.103-3.253 3.561-2.166 6.192-4.762 7.899-7.785 1.702-3.019 2.749-6.072 3.137-9.174.384-3.097.58-5.576.58-7.434V172.93c-1.396 1.243-3.138 2.21-5.23 2.908zM444.542 234.874c-5.187 0-10.173-.361-14.823-1.069-4.802-.732-9.104-2.183-12.779-4.313-3.789-2.185-6.821-5.341-9.006-9.375-2.163-3.986-3.26-9.232-3.26-15.59v-68.859h-17.981a2 2 0 01-2-1.999v-22.073a2 2 0 012-1.999h17.981V75.582a2 2 0 012-2h32.992a2 2 0 012 2v34.014h22.162a2 2 0 012 1.999v22.073a2 2 0 01-2 1.999h-22.162v57.479c0 6.229 1.198 8.731 2.202 9.733 1.004 1.007 3.506 2.205 9.738 2.205 1.804 0 3.542-.076 5.161-.225a44.198 44.198 0 004.669-.665 1.994 1.994 0 011.661.415c.463.379.73.946.73 1.546v25.555a2 2 0 01-1.672 1.974c-2.834.472-6.041.794-9.527.957-3.613.157-6.91.233-10.086.233z"})),s||(s=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M463.825 111.595v22.072h-24.161v59.479c0 5.573.928 9.292 2.788 11.149 1.856 1.859 5.576 2.788 11.152 2.788 1.859 0 3.638-.076 5.343-.232a45.912 45.912 0 004.878-.696v25.557c-2.788.465-5.887.773-9.293.931-3.407.149-6.737.23-9.99.23-5.111 0-9.953-.35-14.521-1.048-4.571-.695-8.597-2.047-12.081-4.063-3.486-2.011-6.236-4.88-8.248-8.597-2.016-3.714-3.021-8.595-3.021-14.639v-70.859h-19.98v-22.072h19.98V75.583h32.992v36.012h24.162zM512.613 233.711h-32.991a2 2 0 01-2-2V111.594a2 2 0 012-1.999h31.366a2 2 0 012 1.999v15.069a43.465 43.465 0 013.199-4.382 43.541 43.541 0 019.496-8.522 46.77 46.77 0 0111.415-5.462c4.056-1.298 8.327-1.954 12.691-1.954 2.341 0 4.953.418 7.766 1.243a2 2 0 011.437 1.92v30.67a2 2 0 01-2.395 1.96c-1.484-.3-3.299-.565-5.392-.787a57.416 57.416 0 00-6.062-.339c-5.706 0-10.572.95-14.467 2.823-3.862 1.86-7.012 4.428-9.361 7.629-2.389 3.263-4.115 7.12-5.127 11.47-1.043 4.479-1.574 9.409-1.574 14.647v54.132a2.002 2.002 0 01-2.001 2z"})),l||(l=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M510.988 111.595V133.9h.465c1.546-3.72 3.636-7.163 6.272-10.341a41.182 41.182 0 019.06-8.131 44.466 44.466 0 0110.923-5.228c3.868-1.237 7.898-1.859 12.081-1.859 2.168 0 4.566.39 7.202 1.163v30.67c-1.551-.312-3.41-.584-5.576-.814a58.79 58.79 0 00-6.274-.35c-6.041 0-11.152 1.01-15.332 3.021-4.182 2.014-7.55 4.761-10.107 8.247-2.555 3.487-4.379 7.55-5.462 12.198-1.083 4.645-1.625 9.682-1.625 15.102v54.133h-32.991V111.595h31.364zM603.923 233.711H570.93a2 2 0 01-2-2V111.594a2 2 0 012-1.999h32.994a2 2 0 012 1.999v120.117a2.002 2.002 0 01-2.001 2zm0-138.705H570.93a2 2 0 01-2-1.999V65.825a2 2 0 012-2h32.994a2 2 0 012 2v27.182a2.002 2.002 0 01-2.001 1.999z"})),c||(c=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M570.93 93.007V65.824h32.994v27.183H570.93zm32.994 18.588v120.117H570.93V111.595h32.994zM742.163 233.711h-37.64a1.995 1.995 0 01-1.667-.896l-23.426-35.352-23.426 35.352a1.992 1.992 0 01-1.667.896h-36.938a2.003 2.003 0 01-1.77-1.067 2.002 2.002 0 01.118-2.061l42.435-62.055-38.71-55.793a2.001 2.001 0 011.643-3.14h37.636c.665 0 1.287.33 1.658.882l19.477 28.893 19.255-28.884a2.004 2.004 0 011.665-.891h36.475c.746 0 1.43.415 1.776 1.078.343.66.289 1.46-.139 2.071l-38.69 55.082 43.578 62.744c.424.61.474 1.408.128 2.066a1.992 1.992 0 01-1.771 1.075z"})),d||(d=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M621.115 111.595h37.637l21.144 31.365 20.911-31.365h36.476l-39.496 56.226 44.377 63.892h-37.64l-25.093-37.87-25.094 37.87h-36.938l43.213-63.193-39.497-56.925zM791.322 340.809h-32.008a2 2 0 01-2-2v-7.712a2 2 0 012-2.001h21.13V11.71h-21.13a2 2 0 01-2-2V2a2 2 0 012-2h32.008a2 2 0 012 2v336.809a2 2 0 01-2 2z"})),u||(u=h.createElement("path",{opacity:.5,fill:"#FFF",d:"M782.443 331.097V9.711h-23.13v-7.71h32.008v336.807h-32.008v-7.711h23.13z"})),m||(m=h.createElement("path",{d:"M10.875 9.711v321.386h23.13v7.711H1.999V2.001h32.006v7.71h-23.13zM99.988 111.595v16.264h.463c4.338-6.191 9.563-10.998 15.684-14.406 6.117-3.402 13.129-5.11 21.027-5.11 7.588 0 14.521 1.475 20.793 4.415 6.274 2.945 11.038 8.131 14.291 15.567 3.56-5.265 8.4-9.913 14.521-13.94 6.117-4.025 13.358-6.042 21.724-6.042 6.351 0 12.234.776 17.66 2.325 5.418 1.549 10.065 4.027 13.938 7.434 3.869 3.41 6.889 7.863 9.062 13.357 2.167 5.504 3.253 12.122 3.253 19.869v80.385H219.41v-68.074c0-4.025-.154-7.82-.465-11.385-.313-3.56-1.161-6.656-2.555-9.293-1.395-2.631-3.45-4.724-6.157-6.274-2.711-1.543-6.391-2.322-11.037-2.322s-8.403.896-11.269 2.671c-2.868 1.784-5.112 4.109-6.737 6.971-1.626 2.869-2.711 6.12-3.252 9.762a74.395 74.395 0 00-.814 11.035v66.91h-32.991v-67.375c0-3.562-.081-7.087-.23-10.57-.158-3.487-.814-6.7-1.978-9.645-1.162-2.94-3.099-5.304-5.809-7.088-2.711-1.775-6.699-2.671-11.965-2.671-1.551 0-3.603.349-6.156 1.048-2.556.697-5.036 2.016-7.435 3.949-2.404 1.938-4.454 4.726-6.158 8.363-1.705 3.642-2.556 8.402-2.556 14.287v69.701h-32.99V111.595h31.132zM273.544 129.255c3.405-5.113 7.744-9.215 13.012-12.316 5.264-3.097 11.186-5.303 17.771-6.621a101.17 101.17 0 0119.865-1.976c6.042 0 12.158.428 18.354 1.277 6.195.855 11.85 2.522 16.962 4.997 5.111 2.477 9.292 5.926 12.546 10.338 3.253 4.414 4.879 10.262 4.879 17.543v62.494c0 5.428.31 10.611.931 15.567.615 4.959 1.701 8.676 3.251 11.153H347.66a46.656 46.656 0 01-1.511-5.693 48.292 48.292 0 01-.813-5.923c-5.267 5.422-11.465 9.217-18.585 11.386a74.81 74.81 0 01-21.842 3.251c-5.733 0-11.077-.698-16.033-2.09-4.958-1.395-9.293-3.562-13.01-6.51-3.718-2.938-6.622-6.656-8.713-11.147s-3.138-9.84-3.138-16.033c0-6.813 1.199-12.43 3.604-16.84 2.399-4.417 5.495-7.939 9.295-10.575 3.793-2.632 8.129-4.607 13.01-5.923a140.326 140.326 0 0114.752-3.137 253.631 253.631 0 0114.638-1.857c4.801-.466 9.062-1.164 12.779-2.093 3.718-.929 6.658-2.282 8.829-4.065 2.165-1.781 3.172-4.375 3.02-7.785 0-3.56-.58-6.389-1.742-8.479-1.161-2.09-2.711-3.719-4.646-4.88-1.937-1.161-4.183-1.936-6.737-2.325-2.557-.382-5.309-.58-8.248-.58-6.506 0-11.617 1.395-15.335 4.183-3.716 2.788-5.889 7.437-6.506 13.94h-32.991c.462-7.742 2.395-14.173 5.807-19.281zm65.169 46.583a53.802 53.802 0 01-6.736 1.741c-2.402.465-4.918.853-7.551 1.161-2.635.313-5.268.698-7.899 1.163a59.302 59.302 0 00-7.317 1.857c-2.404.779-4.495 1.822-6.274 3.138-1.784 1.317-3.216 2.985-4.3 4.994-1.085 2.014-1.626 4.571-1.626 7.668 0 2.94.541 5.422 1.626 7.431 1.084 2.017 2.558 3.604 4.416 4.765s4.025 1.976 6.507 2.438c2.475.466 5.031.698 7.665.698 6.505 0 11.537-1.082 15.103-3.253 3.561-2.166 6.192-4.762 7.899-7.785 1.702-3.019 2.749-6.072 3.137-9.174.384-3.097.58-5.576.58-7.434V172.93c-1.396 1.243-3.138 2.21-5.23 2.908zM463.825 111.595v22.072h-24.161v59.479c0 5.573.928 9.292 2.788 11.149 1.856 1.859 5.576 2.788 11.152 2.788 1.859 0 3.638-.076 5.343-.232a45.912 45.912 0 004.878-.696v25.557c-2.788.465-5.887.773-9.293.931-3.407.149-6.737.23-9.99.23-5.111 0-9.953-.35-14.521-1.048-4.571-.695-8.597-2.047-12.081-4.063-3.486-2.011-6.236-4.88-8.248-8.597-2.016-3.714-3.021-8.595-3.021-14.639v-70.859h-19.98v-22.072h19.98V75.583h32.992v36.012h24.162zM510.988 111.595V133.9h.465c1.546-3.72 3.636-7.163 6.272-10.341a41.182 41.182 0 019.06-8.131 44.466 44.466 0 0110.923-5.228c3.868-1.237 7.898-1.859 12.081-1.859 2.168 0 4.566.39 7.202 1.163v30.67c-1.551-.312-3.41-.584-5.576-.814a58.79 58.79 0 00-6.274-.35c-6.041 0-11.152 1.01-15.332 3.021-4.182 2.014-7.55 4.761-10.107 8.247-2.555 3.487-4.379 7.55-5.462 12.198-1.083 4.645-1.625 9.682-1.625 15.102v54.133h-32.991V111.595h31.364zM570.93 93.007V65.824h32.994v27.183H570.93zm32.994 18.588v120.117H570.93V111.595h32.994zM621.115 111.595h37.637l21.144 31.365 20.911-31.365h36.476l-39.496 56.226 44.377 63.892h-37.64l-25.093-37.87-25.094 37.87h-36.938l43.213-63.193-39.497-56.925zM782.443 331.097V9.711h-23.13v-7.71h32.008v336.807h-32.008v-7.711h23.13z"})))}t.default="img/matrix.d1fcad6.svg"},1567:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.98 1.28a4.872 4.872 0 01-1.114 3.49 4.099 4.099 0 01-3.237 1.53 4.636 4.636 0 011.144-3.36 4.957 4.957 0 013.207-1.66zm3.974 7.428a4.949 4.949 0 00-2.357 4.152 4.782 4.782 0 002.92 4.4 10.963 10.963 0 01-1.519 3.092c-.894 1.338-1.832 2.645-3.32 2.669-.708.016-1.186-.187-1.684-.4-.52-.22-1.06-.451-1.907-.451-.899 0-1.464.238-2.01.467-.47.198-.927.39-1.57.417-1.417.053-2.5-1.428-3.427-2.753-1.853-2.707-3.296-7.628-1.362-10.976a5.315 5.315 0 014.473-2.728c.804-.017 1.576.293 2.252.565.517.208.979.393 1.357.393.332 0 .78-.178 1.304-.386.824-.326 1.832-.727 2.859-.619 1.596.05 3.075.85 3.99 2.158z",fill:"#17191C"})))}t.default="img/element-icons/brands/apple.3f29900.svg"},1568:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return l}));var a,i,r,o=n(0);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s.apply(this,arguments)}function l(e){return o.createElement("svg",s({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),a||(a=o.createElement("mask",{id:"facebook_svg__a",maskUnits:"userSpaceOnUse",x:2,y:1,width:22,height:22},o.createElement("path",{d:"M2.102 1.5H23.1v20.872H2.102V1.5z",fill:"#fff"}))),i||(i=o.createElement("g",{mask:"url(#facebook_svg__a)"},o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M23.1 11.999c0-5.799-4.701-10.5-10.5-10.5S2.1 6.2 2.1 11.999c0 5.24 3.84 9.585 8.86 10.373v-7.338H8.292V12h2.666V9.686c0-2.632 1.568-4.085 3.966-4.085 1.15 0 2.35.205 2.35.205V8.39h-1.323c-1.305 0-1.711.809-1.711 1.64v1.969h2.912l-.466 3.035h-2.446v7.338c5.02-.788 8.859-5.132 8.859-10.373z",fill:"#1877F2"}))),r||(r=o.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M16.687 15.034L17.153 12H14.24v-1.97c0-.83.406-1.64 1.71-1.64h1.325V5.807s-1.202-.205-2.35-.205c-2.4 0-3.967 1.453-3.967 4.085v2.313H8.293v3.035h2.666v7.338a10.588 10.588 0 003.282 0v-7.338h2.446z",fill:"#fff"})))}t.default="img/element-icons/brands/facebook.d149f4a.svg"},1569:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{d:"M20.842 7.106a9.707 9.707 0 00-3.548-3.548C15.8 2.686 14.169 2.25 12.4 2.25c-1.769 0-3.4.436-4.894 1.308a9.707 9.707 0 00-3.548 3.548C3.086 8.6 2.65 10.23 2.65 12c0 2.124.62 4.035 1.86 5.732 1.24 1.696 2.841 2.87 4.805 3.522.228.043.398.013.508-.088a.497.497 0 00.165-.381l-.007-.686c-.004-.431-.006-.808-.006-1.13l-.292.051a3.725 3.725 0 01-.705.045 5.354 5.354 0 01-.882-.09 1.97 1.97 0 01-.85-.38 1.611 1.611 0 01-.56-.78l-.126-.293a3.174 3.174 0 00-.4-.647c-.182-.237-.366-.398-.552-.482l-.089-.064a.928.928 0 01-.165-.152.696.696 0 01-.114-.178c-.026-.06-.005-.108.063-.146.068-.039.19-.057.368-.057l.254.038c.17.034.379.135.629.304.25.17.454.39.615.66.195.348.43.612.705.794.275.182.552.273.831.273.28 0 .52-.021.724-.063.203-.043.393-.107.571-.191.076-.567.284-1.003.622-1.308a8.696 8.696 0 01-1.301-.228 5.18 5.18 0 01-1.193-.496 3.419 3.419 0 01-1.022-.85c-.271-.339-.493-.783-.667-1.333-.173-.55-.26-1.185-.26-1.904 0-1.025.335-1.896 1.003-2.616-.313-.77-.284-1.633.089-2.59.245-.076.61-.018 1.092.172.482.19.835.354 1.06.489.224.135.404.25.54.343.787-.22 1.599-.33 2.437-.33.838 0 1.65.11 2.438.33l.482-.305c.33-.203.72-.39 1.168-.559.448-.169.791-.215 1.028-.14.381.957.415 1.82.102 2.59.668.72 1.003 1.592 1.003 2.616 0 .72-.087 1.356-.26 1.91-.174.555-.398.999-.673 1.333a3.55 3.55 0 01-1.028.845c-.411.228-.809.393-1.194.495a8.69 8.69 0 01-1.301.229c.44.38.66.981.66 1.802v2.678c0 .153.053.28.159.381.105.102.273.131.501.089 1.964-.652 3.566-1.826 4.805-3.523 1.24-1.697 1.86-3.607 1.86-5.732 0-1.768-.436-3.4-1.308-4.893z",fill:"#000"})))}t.default="img/element-icons/brands/github.de3b60e.svg"},1570:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return u}));var a,i,r,o,s,l,c=n(0);function d(){return d=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d.apply(this,arguments)}function u(e){return c.createElement("svg",d({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=c.createElement("path",{d:"M12 20.33l3.317-10.2H8.689l3.312 10.2z",fill:"#E24329"})),i||(i=c.createElement("path",{d:"M4.043 10.13l-1.01 3.098a.687.687 0 00.25.768L12 20.33l-7.957-10.2z",fill:"#FCA326"})),r||(r=c.createElement("path",{d:"M4.042 10.129h4.645L6.688 3.986c-.102-.315-.548-.315-.654 0l-1.992 6.143z",fill:"#E24329"})),o||(o=c.createElement("path",{d:"M19.96 10.13l1.006 3.098a.687.687 0 01-.248.768l-8.719 6.334 7.961-10.2z",fill:"#FCA326"})),s||(s=c.createElement("path",{d:"M19.962 10.129h-4.645l1.995-6.143c.102-.315.548-.315.654 0l1.996 6.143z",fill:"#E24329"})),l||(l=c.createElement("path",{d:"M12 20.33l3.315-10.2h4.645L12 20.33zM11.998 20.33l-7.956-10.2h4.645L12 20.33z",fill:"#FC6D26"})))}t.default="img/element-icons/brands/gitlab.e075acd.svg"},1571:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return c}));var a,i,r,o,s=n(0);function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},l.apply(this,arguments)}function c(e){return s.createElement("svg",l({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),a||(a=s.createElement("path",{d:"M22.501 12.233c0-.863-.071-1.493-.226-2.146h-10.06v3.896h5.905c-.119.969-.762 2.427-2.19 3.407l-.02.13 3.18 2.415.22.022c2.024-1.832 3.191-4.527 3.191-7.724z",fill:"#4285F4"})),i||(i=s.createElement("path",{d:"M12.215 22.5c2.893 0 5.321-.933 7.095-2.543l-3.381-2.567c-.905.618-2.12 1.05-3.714 1.05a6.438 6.438 0 01-6.096-4.363l-.125.01-3.307 2.509-.044.117c1.762 3.43 5.381 5.787 9.572 5.787z",fill:"#34A853"})),r||(r=s.createElement("path",{d:"M6.12 14.077A6.347 6.347 0 015.763 12c0-.723.131-1.423.345-2.077l-.006-.139-3.348-2.548-.11.05A10.339 10.339 0 001.501 12c0 1.692.417 3.29 1.143 4.713l3.476-2.636z",fill:"#FBBC05"})),o||(o=s.createElement("path",{d:"M12.215 5.56c2.012 0 3.369.852 4.143 1.563L19.38 4.23c-1.857-1.692-4.273-2.73-7.166-2.73-4.19 0-7.81 2.357-9.572 5.787l3.465 2.636a6.465 6.465 0 016.107-4.363z",fill:"#EB4335"})))}t.default="img/element-icons/brands/google.44aaf41.svg"},1572:function(e,t,n){"use strict";n.r(t),n.d(t,"Icon",(function(){return o}));var a,i=n(0);function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r.apply(this,arguments)}function o(e){return i.createElement("svg",r({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 25 24",role:"presentation","aria-hidden":!0},e),a||(a=i.createElement("path",{d:"M9.042 21c-2.427 0-4.688-.706-6.592-1.923 1.616.104 4.469-.146 6.243-1.838-2.67-.123-3.873-2.17-4.03-3.045.227.088 1.308.193 1.919-.052-3.07-.77-3.541-3.464-3.436-4.286.575.402 1.552.542 1.936.507-2.86-2.047-1.832-5.126-1.326-5.79 2.053 2.843 5.13 4.44 8.936 4.53a4.398 4.398 0 01-.11-.98 4.367 4.367 0 014.361-4.373c1.259 0 2.393.535 3.189 1.39.84-.197 2.106-.659 2.725-1.058-.312 1.12-1.283 2.054-1.87 2.4.005.012-.005-.012 0 0 .516-.078 1.912-.346 2.463-.72-.273.629-1.302 1.675-2.147 2.26C21.46 14.953 16.157 21 9.042 21z",fill:"#1D9BF0"})))}t.default="img/element-icons/brands/twitter.43b393b.svg"},1573:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(55),l=n(3),c=n(2),d=n(7),u=n(74),m=n(213),h=n(9),p=n(228),g=n(11),b=n(631),v=n(14),f=n(1350),y=n(123),E=n(427);class w extends o.a.PureComponent{constructor(e){var t;super(e),i()(this,"intervalHandle",void 0),i()(this,"checkRequestIsPending",(()=>{const{request:e}=this.props;Object(s.canAcceptVerificationRequest)(e)||p.a.sharedInstance().dismissToast(this.props.toastKey)})),i()(this,"cancel",(()=>{p.a.sharedInstance().dismissToast(this.props.toastKey);try{this.props.request.cancel()}catch(e){l.a.error("Error while cancelling verification request",e)}})),i()(this,"accept",(async()=>{p.a.sharedInstance().dismissToast(this.props.toastKey);const{request:e}=this.props,t=d.a.safeGet();try{if(e.roomId){var n;h.a.dispatch({action:v.a.ViewRoom,room_id:e.roomId,should_peek:!1,metricsTrigger:"VerificationRequest"});const a=null!==(n=t.getUser(e.otherUserId))&&void 0!==n?n:void 0;y.a.instance.setCards([{phase:u.a.RoomSummary},{phase:u.a.RoomMemberInfo,state:{member:a}},{phase:u.a.EncryptionPanel,state:{verificationRequest:e,member:a}}],void 0,e.roomId)}else g.b.createDialog(f.a,{verificationRequest:e,onFinished:()=>{e.cancel()}},void 0,!1,!0);await e.accept()}catch(e){l.a.error("Failed to accept verification request",e)}})),this.state={counter:Math.ceil((null!==(t=e.request.timeout)&&void 0!==t?t:0)/1e3)}}async componentDidMount(){const{request:e}=this.props;e.timeout&&e.timeout>0&&(this.intervalHandle=window.setInterval((()=>{let{counter:e}=this.state;e=Math.max(0,e-1),this.setState({counter:e})}),1e3)),e.on(s.VerificationRequestEvent.Change,this.checkRequestIsPending),this.checkRequestIsPending();const t=e.otherDeviceId;if(e.isSelfVerification&&t){const e=d.a.safeGet(),n=await e.getDevice(t);this.setState({ip:n.last_seen_ip,device:await Object(E.a)(e,e.getSafeUserId(),t)})}}componentWillUnmount(){clearInterval(this.intervalHandle);const{request:e}=this.props;e.off(s.VerificationRequestEvent.Change,this.checkRequestIsPending)}render(){const{request:e}=this.props;let t,n;if(e.isSelfVerification)this.state.device&&(t=this.state.device.displayName,n=Object(c.b)("%(deviceId)s from %(ip)s",{deviceId:this.state.device.deviceId,ip:this.state.ip}));else{const n=d.a.safeGet(),a=e.otherUserId,i=e.roomId;if(t=i?Object(m.b)(n,a,i):a,t===a){const e=n.getUser(a);e&&e.displayName&&(t=Object(c.b)("%(name)s (%(userId)s)",{name:e.displayName,userId:a}))}}const a=0===this.state.counter?Object(c.b)("Ignore"):Object(c.b)("Ignore (%(counter)s)",{counter:this.state.counter});return o.a.createElement(b.a,{description:t,detail:n,acceptLabel:Object(c.b)("Verify Session"),onAccept:this.accept,rejectLabel:a,onReject:this.cancel})}}},1574:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(414),i=n(14),r=n(9);const o=()=>{r.a.dispatch({action:i.a.ViewUserSettings,initialTabId:a.a.SessionManager})}},1575:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(353);const i=e=>Object(a.a)(e)&&!e.getRooms().some((t=>e.isRoomEncrypted(t.roomId)))},1586:function(e,t,n){"use strict";var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(22),l=n(4),c=n(13),d=n.n(c),u=n(65),m=n(20),h=n(435),p=n(132),g=n(772),b=n(9),v=n(5),f=n(15);var y=({vertical:e,reverse:t,id:n,passRef:a})=>{const i=["mx_ResizeHandle"];return e?i.push("mx_ResizeHandle--vertical"):i.push("mx_ResizeHandle--horizontal"),t&&i.push("mx_ResizeHandle_reverse"),o.a.createElement("div",{ref:a,className:i.join(" "),"data-id":n},o.a.createElement("div",null))};class E{constructor(e,t,n,a){this.resizer=t,this.sizer=n,this.container=a,i()(this,"domNode",void 0),i()(this,"id",void 0),i()(this,"reverse",void 0),this.reverse=t.isReverseResizeHandle(e),this.domNode=a||(this.reverse?e.nextElementSibling:e.previousElementSibling),this.id=e.getAttribute("data-id")}copyWith(e,t,n,a){return new(0,this.constructor)(e,t,n,a)}advance(e){let t=this.reverse?this.domNode.previousElementSibling:this.domNode.nextElementSibling;const n=e!==this.reverse;do{var a,i;if(n)t=null===(a=t)||void 0===a?void 0:a.nextElementSibling;else t=null===(i=t)||void 0===i?void 0:i.previousElementSibling}while(t&&!this.resizer.isResizeHandle(t));if(t){const e=this.copyWith(t,this.resizer,this.sizer);return e.reverse=this.reverse,e}}next(){return this.advance(!0)}previous(){return this.advance(!1)}size(){return this.sizer.getItemSize(this.domNode)}offset(){return this.sizer.getItemOffset(this.domNode)}start(){this.sizer.start(this.domNode)}finish(){this.sizer.finish(this.domNode)}getSize(){return this.sizer.getDesiredItemSize(this.domNode)}setRawSize(e){this.sizer.setItemSize(this.domNode,e)}setSize(e){var t,n;this.setRawSize(`${Math.round(e)}px`),null===(t=this.resizer.config)||void 0===t||null===(n=t.onResized)||void 0===n||n.call(t,e,this.id,this.domNode)}clearSize(){var e,t;this.sizer.clearItemSize(this.domNode),null===(e=this.resizer.config)||void 0===e||null===(t=e.onResized)||void 0===t||t.call(e,null,this.id,this.domNode)}first(){var e;if(null===(e=this.domNode.parentElement)||void 0===e||!e.children)return;const t=Array.from(this.domNode.parentElement.children).find((e=>this.resizer.isResizeHandle(e)));return t?this.copyWith(t,this.resizer,this.sizer):void 0}last(){var e;if(null===(e=this.domNode.parentElement)||void 0===e||!e.children)return;const t=Array.from(this.domNode.parentElement.children).reverse().find((e=>this.resizer.isResizeHandle(e)));return t?this.copyWith(t,this.resizer,this.sizer):void 0}}class w{constructor(e,t,n){this.container=e,this.vertical=t,this.reverse=n}getItemOffset(e){const t=(this.vertical?e.offsetTop:e.offsetLeft)-this.getOffset();return this.reverse?this.getTotalSize()-(t+this.getItemSize(e)):t}getItemSize(e){return this.vertical?e.offsetHeight:e.offsetWidth}getTotalSize(){return this.vertical?this.container.offsetHeight:this.container.offsetWidth}getOffset(){return this.vertical?this.container.offsetTop:this.container.offsetLeft}getPageOffset(){let e=this.container,t=0;for(;e;){t+=this.vertical?e.offsetTop:e.offsetLeft,e=e.offsetParent}return t}getDesiredItemSize(e){return this.vertical?e.style.height:e.style.width}setItemSize(e,t){this.vertical?e.style.height=t:e.style.width=t}clearItemSize(e){this.vertical?e.style.removeProperty("height"):e.style.removeProperty("width")}start(e){}finish(e){}offsetFromEvent(e){const t=this.vertical?e.pageY:e.pageX;return this.reverse?this.getPageOffset()+this.getTotalSize()-t:t-this.getPageOffset()}}class S{static createSizer(e,t,n){return new w(e,t,n)}constructor(e){this.item=e,i()(this,"beforeOffset",void 0),this.beforeOffset=e.offset()}get size(){return this.item.getSize()}set size(e){this.item.setRawSize(e)}resize(e){this.item.setSize(e)}resizeFromContainerOffset(e){this.resize(e-this.beforeOffset)}start(){this.item.start()}finish(){this.item.finish()}}class _ extends S{static createItem(e,t,n){return new E(e,t,n)}}class C extends w{start(e){this.vertical?e.style.minHeight="":e.style.minWidth=""}finish(e){const t=e.offsetParent;if(t)if(this.vertical){const n=(e.offsetHeight/t.offsetHeight*100).toFixed(2)+"%";e.style.minHeight=n,e.style.height=n}else{const n=(e.offsetWidth/t.offsetWidth*100).toFixed(2)+"%";e.style.minWidth=n,e.style.width=n}}}class O extends _{static createSizer(e,t,n){return new C(e,t,n)}}class x extends E{notifyCollapsed(e){var t,n;null===(t=this.resizer.config)||void 0===t||null===(n=t.onCollapsed)||void 0===n||n.call(t,e,this.id,this.domNode)}get isCollapsed(){var e,t,n;return null!==(e=null===(t=this.resizer.config)||void 0===t||null===(n=t.isItemCollapsed)||void 0===n?void 0:n.call(t,this.domNode))&&void 0!==e&&e}}class k extends S{static createItem(e,t,n,a){return new x(e,t,n,a)}constructor(e){var t,n;super(e),i()(this,"toggleSize",void 0),i()(this,"isCollapsed",void 0),this.toggleSize=null===(t=e.resizer)||void 0===t||null===(n=t.config)||void 0===n?void 0:n.toggleSize,this.isCollapsed=e.isCollapsed}resize(e){const t=!!this.toggleSize&&e<this.toggleSize;t!==this.isCollapsed&&(this.isCollapsed=t,this.item.notifyCollapsed(t)),t||super.resize(e)}}var R=n(39);class j{constructor(e,t,n){this.container=e,this.distributorCtor=t,this.config=n,i()(this,"classNames",void 0),i()(this,"onMouseDown",(e=>{var t,n,a;if(0!==e.button)return;const i=e.target&&e.target.closest(`.${this.classNames.handle}`),r=null==this||null===(t=this.config)||void 0===t?void 0:t.handler;if(!i||!r&&i.parentElement!==this.container||r&&i!==r)return;var o,s;(e.preventDefault(),this.classNames.resizing)&&(null===(o=this.container)||void 0===o||null===(s=o.classList)||void 0===s||s.add(this.classNames.resizing));null===(n=this.config)||void 0===n||null===(a=n.onResizeStart)||void 0===a||a.call(n);const{sizer:l,distributor:c}=this.createSizerAndDistributor(i);c.start();const d=e=>{const t=l.offsetFromEvent(e);c.resizeFromContainerOffset(t)},u=document.body,m=()=>{var e,t,n,a;this.classNames.resizing&&(null===(n=this.container)||void 0===n||null===(a=n.classList)||void 0===a||a.remove(this.classNames.resizing));c.finish(),null===(e=this.config)||void 0===e||null===(t=e.onResizeStop)||void 0===t||t.call(e),u.removeEventListener("mouseup",m,!1),document.removeEventListener("mouseleave",m,!1),u.removeEventListener("mousemove",d,!1)};u.addEventListener("mouseup",m,!1),document.addEventListener("mouseleave",m,!1),u.addEventListener("mousemove",d,!1)})),i()(this,"onResize",Object(R.throttle)((()=>{const e=this.getDistributors();e.forEach((e=>e.start())),e.forEach((e=>e.finish()))}),100,{trailing:!0,leading:!0})),i()(this,"getDistributors",(()=>this.getResizeHandles().map((e=>{const{distributor:t}=this.createSizerAndDistributor(e);return t})))),this.classNames={handle:"resizer-handle",reverse:"resizer-reverse",vertical:"resizer-vertical",resizing:"resizer-resizing"}}setClassNames(e){this.classNames=e}attach(){var e,t,n;const a=null!==(e=null==this||null===(t=this.config)||void 0===t||null===(n=t.handler)||void 0===n?void 0:n.parentElement)&&void 0!==e?e:this.container;null==a||a.addEventListener("mousedown",this.onMouseDown,!1),window.addEventListener("resize",this.onResize)}detach(){var e,t,n;const a=null!==(e=null==this||null===(t=this.config)||void 0===t||null===(n=t.handler)||void 0===n?void 0:n.parentElement)&&void 0!==e?e:this.container;null==a||a.removeEventListener("mousedown",this.onMouseDown,!1),window.removeEventListener("resize",this.onResize)}forHandleAt(e){const t=this.getResizeHandles()[e];if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}forHandleWithId(e){const t=this.getResizeHandles().find((t=>t.getAttribute("data-id")===e));if(t){const{distributor:e}=this.createSizerAndDistributor(t);return e}}isReverseResizeHandle(e){return e.classList.contains(this.classNames.reverse)}isResizeHandle(e){return e.classList.contains(this.classNames.handle)}createSizerAndDistributor(e){var t;const n=e.classList.contains(this.classNames.vertical),a=this.isReverseResizeHandle(e),i=this.distributorCtor,r=null!==(t=this.config)&&void 0!==t&&t.handler?this.container:void 0,o=i.createSizer(this.container,n,a),s=i.createItem(e,this,o,null!=r?r:void 0);return{sizer:o,distributor:new i(s)}}getResizeHandles(){var e,t;return null!=this&&null!==(e=this.config)&&void 0!==e&&e.handler?[this.config.handler]:null!==(t=this.container)&&void 0!==t&&t.children?Array.from(this.container.querySelectorAll(`.${this.classNames.handle}`)):[]}}var I=n(21),T=n(75),P=n(19),N=n(2),D=n(631),M=n(228),A=n(637);const L="serverlimit",U=()=>{M.a.sharedInstance().dismissToast(L)};var F=n(14),B=n(622),V=n(93),W=n(737),z=n(16),H=n(11),G=n(1401),K=n(10);class q extends r.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",(e=>{"focus_room_filter"===e.action&&this.openSpotlight()})),this.dispatcherRef=b.a.register(this.onAction)}componentWillUnmount(){b.a.unregister(this.dispatcherRef)}openSpotlight(){H.b.createDialog(G.b,{},"mx_SpotlightDialog_wrapper",!1,!0)}render(){const e=d()({mx_RoomSearch:!0,mx_RoomSearch_minimized:this.props.isMinimized},"mx_RoomSearch_spotlightTrigger"),t=r.createElement("div",{className:"mx_RoomSearch_icon"}),n=r.createElement("kbd",{className:"mx_RoomSearch_shortcutPrompt"},m.a?"⌘ K":Object(N.b)(z.a[m.b.CONTROL])+" K");return r.createElement(K.a,{onClick:this.openSpotlight,className:e},t,!this.props.isMinimized&&r.createElement("div",{className:"mx_RoomSearch_spotlightTriggerText"},Object(N.b)("Search")),n)}}var $=n(62),Y=n(51),J=n(23),Q=n(43),X=n(119),Z=n(17),ee=n.n(Z),te=n(140),ne=n(632),ae=n(35),ie=n(182),re=n(113),oe=n(40),se=n(184),le=n(70),ce=n(377),de=n(36),ue=n(1358),me=n(183),he=n(170),pe=n(24),ge=n.n(pe),be=n(1498),ve=n(611),fe=n(92);const ye=(e,t)=>{let n="";if(t)for(const e of t.entries())n+=e+"/";return`mx_space_collapsed_${n+e}`};class Ee{static get instance(){return Ee.internalInstance||(Ee.internalInstance=new Ee),Ee.internalInstance}setSpaceCollapsedState(e,t,n){localStorage.setItem(ye(e,t),n.toString())}getSpaceCollapsedState(e,t,n){const a=localStorage.getItem(ye(e,t));return a?"true"===a:n}}i()(Ee,"internalInstance",void 0);var we=n(233),Se=n(422),_e=n(638),Ce=n(49),Oe=n(68);const xe=["space","spaceKey","className","selected","label","contextMenuTooltip","notificationState","avatarSize","isNarrow","children","innerRef","ContextMenuComponent"],ke=["space","activeSpaces","isNested","isPanelCollapsed","onExpand","parents","innerRef","dragHandleProps"],Re=["tabIndex"],je=e=>{var t;let{space:n,spaceKey:a,className:i,selected:r,label:s,contextMenuTooltip:l,notificationState:c,avatarSize:u,isNarrow:m,children:h,innerRef:p,ContextMenuComponent:g}=e,v=ge()(e,xe);const[f,y,E,w]=Object(le.q)(p),[S,_]=Object(Oe.i)(y),C=_?0:-1,O=null!=a?a:null==n?void 0:n.roomId;let x,k,R=o.a.createElement("div",{className:"mx_SpaceButton_avatarPlaceholder"},o.a.createElement("div",{className:"mx_SpaceButton_icon"}));if(n&&(R=o.a.createElement(fe.a,{width:u,height:u,room:n})),O&&c){let e=Object(N.b)("Jump to first unread room.");"invite"===(null==n?void 0:n.getMyMembership())&&(e=Object(N.b)("Jump to first invite."));const t=e=>{e.stopPropagation(),e.preventDefault(),Y.a.instance.setActiveRoomInSpace(O)};x=o.a.createElement("div",{className:"mx_SpacePanel_badgeContainer"},o.a.createElement(we.a,{onClick:t,forceCount:!1,notification:c,"aria-label":e,tabIndex:C,showUnsentTooltip:!0}))}f&&y.current&&g&&(k=o.a.createElement(g,ee()({},Object(le.p)(y.current.getBoundingClientRect(),0),{space:n,onFinished:w})));const j=null!==(t=v.onClick)&&void 0!==t?t:r&&n?()=>b.a.dispatch({action:F.a.ViewRoom,room_id:n.roomId}):()=>{O&&Y.a.instance.setActiveSpace(O)};return o.a.createElement($.a,ee()({},v,{className:d()("mx_SpaceButton",i,{mx_SpaceButton_active:r,mx_SpaceButton_hasMenuOpen:f,mx_SpaceButton_narrow:m}),title:s,onClick:j,onContextMenu:E,forceHide:!m||f,inputRef:y,tabIndex:C,onFocus:S}),h,o.a.createElement("div",{className:"mx_SpaceButton_selectionWrapper"},o.a.createElement("div",{className:"mx_SpaceButton_avatarWrapper"},R,x),!m&&o.a.createElement("span",{className:"mx_SpaceButton_name"},s),g&&o.a.createElement(Se.a,{className:"mx_SpaceButton_menuButton",onClick:E,title:l,isExpanded:f}),k))};class Ie extends o.a.PureComponent{constructor(e){super(e),i()(this,"buttonRef",Object(r.createRef)()),i()(this,"onSpaceUpdate",(()=>{this.setState({childSpaces:this.childSpaces})})),i()(this,"onRoomNameChange",(()=>{this.setState({name:this.props.space.name})})),i()(this,"toggleCollapse",(e=>{this.props.onExpand&&this.isCollapsed&&this.props.onExpand();const t=!this.isCollapsed;Ee.instance.setSpaceCollapsedState(this.props.space.roomId,this.props.parents,t),this.setState({collapsed:t}),e.stopPropagation()})),i()(this,"onKeyDown",(e=>{var t;let n=!0;const a=Object(Q.a)().getRoomListAction(e),i=null===(t=this.state.childSpaces)||void 0===t?void 0:t.length;switch(a){case z.h.CollapseRoomListSection:if(i&&!this.isCollapsed)this.toggleCollapse(e);else{var r,o,s;const e=null===(r=this.buttonRef)||void 0===r||null===(o=r.current)||void 0===o||null===(s=o.parentElement)||void 0===s?void 0:s.parentElement,t=null==e?void 0:e.previousElementSibling;null==t||t.focus()}break;case z.h.ExpandRoomListSection:if(i)if(this.isCollapsed)this.toggleCollapse(e);else{var l,c,d;const e=null===(l=this.buttonRef)||void 0===l||null===(c=l.current)||void 0===c?void 0:c.nextElementSibling,t=null==e?void 0:e.querySelector(".mx_SpaceItem");null==t||null===(d=t.querySelector(".mx_SpaceButton"))||void 0===d||d.focus()}break;default:n=!1}n&&(e.stopPropagation(),e.preventDefault())}));const t=Ee.instance.getSpaceCollapsedState(e.space.roomId,this.props.parents,!e.isNested);this.state={name:this.props.space.name,collapsed:t,childSpaces:this.childSpaces},Y.a.instance.on(this.props.space.roomId,this.onSpaceUpdate),this.props.space.on(l.RoomEvent.Name,this.onRoomNameChange)}componentWillUnmount(){Y.a.instance.off(this.props.space.roomId,this.onSpaceUpdate),this.props.space.off(l.RoomEvent.Name,this.onRoomNameChange)}get childSpaces(){return Y.a.instance.getChildSpaces(this.props.space.roomId).filter((e=>{var t;return!(null!==(t=this.props.parents)&&void 0!==t&&t.has(e.roomId))}))}get isCollapsed(){return this.state.collapsed||!!this.props.isPanelCollapsed}render(){var e,t;const n=this.props,{space:a,activeSpaces:i,isNested:r,isPanelCollapsed:s,onExpand:l,parents:c,innerRef:u,dragHandleProps:m}=n,h=ge()(n,ke),p=this.isCollapsed,g=d()(this.props.className,{mx_SpaceItem:!0,mx_SpaceItem_narrow:s,collapsed:p,hasSubSpaces:null===(e=this.state.childSpaces)||void 0===e?void 0:e.length}),b="invite"===a.getMyMembership(),v=b?_e.a.forSymbol("!",Ce.a.Red):Y.a.instance.getNotificationState(a.roomId),f=null===(t=this.state.childSpaces)||void 0===t?void 0:t.length;let y;f&&!p&&(y=o.a.createElement(Te,{spaces:this.state.childSpaces,activeSpaces:i,isNested:!0,parents:new Set(c).add(a.roomId)}));const E=f?o.a.createElement(K.a,{className:"mx_SpaceButton_toggleCollapse",onClick:this.toggleCollapse,tabIndex:-1,"aria-label":p?Object(N.b)("Expand"):Object(N.b)("Collapse")}):null,w=m||{},{tabIndex:S}=w,_=ge()(w,Re),C=i.includes(a.roomId);return o.a.createElement("li",ee()({},h,{className:g,ref:u,"aria-expanded":f?!p:void 0,"aria-selected":C,role:"treeitem"}),o.a.createElement(je,ee()({},_,{space:a,className:b?"mx_SpaceButton_invite":void 0,selected:C,label:this.state.name,contextMenuTooltip:Object(N.b)("Space options"),notificationState:v,isNarrow:s,avatarSize:r?24:32,onKeyDown:this.onKeyDown,ContextMenuComponent:"join"===this.props.space.getMyMembership()?ue.a:void 0}),E),y)}}i()(Ie,"contextType",I.a);const Te=({spaces:e,activeSpaces:t,isNested:n,parents:a})=>o.a.createElement("ul",{className:"mx_SpaceTreeLevel",role:"group"},e.map((e=>o.a.createElement(Ie,{key:e.roomId,activeSpaces:t,space:e,isNested:n,parents:a}))));var Pe=n(130),Ne=n(161),De=n(1438),Me=n(414),Ae=n(339),Le=n(417),Ue=n(1405);const Fe="MATCH_SYSTEM_THEME_ID";var Be,Ve,We=({requestClose:e})=>{const t=Object(r.useMemo)(Ae.f,[]),n=Ue.a.calculateThemeState(),a=Object(Ae.d)(n.theme),i=a||n.theme,{useSystemTheme:s}=n,l=[{id:Fe,name:Object(N.b)("Match system")},...t],c=s?Fe:i;return o.a.createElement("div",{className:"mx_QuickThemeSwitcher"},o.a.createElement("h4",{className:"mx_QuickThemeSwitcher_heading"},Object(N.b)("Theme")),o.a.createElement(Le.a,{id:"mx_QuickSettingsButton_themePickerDropdown",onOptionChange:async t=>{re.b.trackInteraction("WebQuickSettingsThemeDropdown");try{t===Fe?await v.b.setValue("use_system_theme",null,f.a.DEVICE,!0):(b.a.dispatch({action:F.a.RecheckTheme,forceTheme:t}),await Promise.all([v.b.setValue("theme",null,f.a.DEVICE,t),v.b.setValue("use_system_theme",null,f.a.DEVICE,!1)]))}catch(e){b.a.dispatch({action:F.a.RecheckTheme})}e()},value:c,label:Object(N.b)("Space selection")},l.map((e=>o.a.createElement("div",{key:e.id},e.name)))))};function ze(){return ze=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ze.apply(this,arguments)}function He(e){return r.createElement("svg",ze({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),Be||(Be=r.createElement("path",{d:"M11 18.598V15h2v3.598C13 20.5 12.238 22 12 22s-1-1.5-1-3.402zM9.5 6c-.325-.167-1.714-.8-2.883-2s-.495-2 .513-2H12v4H9.5zM14.5 6c.325-.167 1.714-.8 2.883-2s.495-2-.513-2H12v4h2.5zM9.429 6h5.142L15 10H9l.429-4z",fill:"#000"})),Ve||(Ve=r.createElement("path",{d:"M12 9c-3.069 0-5.676 1.693-6.621 4.048C4.967 14.073 5.895 15 7 15h10c1.105 0 2.032-.927 1.621-1.952C17.677 10.693 15.07 9 12 9z",fill:"#000"})))}var Ge,Ke,qe;function $e(){return $e=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},$e.apply(this,arguments)}function Ye(e){return r.createElement("svg",$e({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",role:"presentation","aria-hidden":!0},e),Ge||(Ge=r.createElement("circle",{cx:15.5,cy:10,r:1.5,transform:"rotate(180 15.5 10)",fill:"currentColor"})),Ke||(Ke=r.createElement("circle",{cx:10,cy:10,r:1.5,transform:"rotate(180 10 10)",fill:"currentColor"})),qe||(qe=r.createElement("circle",{cx:4.5,cy:10,r:1.5,transform:"rotate(180 4.5 10)",fill:"currentColor"})))}var Je=n(1404),Qe=n(1403),Xe=n(481),Ze=n(50);var et=({isPanelCollapsed:e=!1})=>{const[t,n,a,i]=Object(le.q)(),{[J.a.Favourites]:r,[J.a.People]:s}=Object(ie.b)("Spaces.enabledMetaSpaces"),l=Ze.b.instance.roomViewStore.getRoomId(),c=Object(ie.b)("developerMode");let u;return t&&n.current&&(u=o.a.createElement(le.n,ee()({},Object(le.k)(n.current.getBoundingClientRect(),le.a.None,16),{wrapperClassName:"mx_QuickSettingsButton_ContextMenuWrapper",onFinished:i,managed:!1,focusLock:!0}),o.a.createElement("h2",null,Object(N.b)("Quick settings")),o.a.createElement(K.a,{onClick:()=>{i(),b.a.dispatch({action:F.a.ViewUserSettings})},kind:"primary_outline"},Object(N.b)("All settings")),l&&c&&o.a.createElement(K.a,{onClick:()=>{i(),H.b.createDialog(Xe.a,{roomId:l},"mx_DevtoolsDialog_wrapper")},kind:"danger_outline"},Object(N.b)("Developer tools")),o.a.createElement("h4",{className:"mx_QuickSettingsButton_pinToSidebarHeading"},o.a.createElement(He,{className:"mx_QuickSettingsButton_icon"}),Object(N.b)("Pin to sidebar")),o.a.createElement(Ne.b,{className:"mx_QuickSettingsButton_favouritesCheckbox",checked:!!r,onChange:Object(De.b)(J.a.Favourites,"WebQuickSettingsPinToSidebarCheckbox")},o.a.createElement(Qe.a,{className:"mx_QuickSettingsButton_icon"}),Object(N.b)("Favourites")),o.a.createElement(Ne.b,{className:"mx_QuickSettingsButton_peopleCheckbox",checked:!!s,onChange:Object(De.b)(J.a.People,"WebQuickSettingsPinToSidebarCheckbox")},o.a.createElement(Je.a,{className:"mx_QuickSettingsButton_icon"}),Object(N.b)("People")),o.a.createElement(K.a,{className:"mx_QuickSettingsButton_moreOptionsButton",onClick:()=>{i(),b.a.dispatch({action:F.a.ViewUserSettings,initialTabId:Me.a.Sidebar})}},o.a.createElement(Ye,{className:"mx_QuickSettingsButton_icon"}),Object(N.b)("More options")),o.a.createElement(We,{requestClose:i}))),o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,{className:d()("mx_QuickSettingsButton",{expanded:!e}),onClick:a,title:Object(N.b)("Quick settings"),inputRef:n,forceHide:!e,"aria-expanded":!e},e?null:Object(N.b)("Settings")),u)},tt=n(7),nt=n(77),at=n(46),it=n(25),rt=n(272),ot=n(129),st=n(392),lt=n(645),ct=n(269);var dt,ut,mt,ht,pt=e=>{const t=Object(r.useRef)(null),[n,a]=Object(r.useState)(""),[i,s]=Object(lt.a)(!1);Object(r.useEffect)((()=>{var e;null===(e=t.current)||void 0===e||e.focus()}),[]);const l=()=>{e.onFinished(),H.b.createDialog(rt.a,{})},c=!!it.b.get().bug_report_endpoint_url;let d,u;c&&(d=o.a.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_rateApp"},o.a.createElement("h3",null,Object(N.b)("Comment")),o.a.createElement("p",null,Object(N.b)("Your platform and username will be noted to help us use your feedback as much as we can.")),o.a.createElement(at.a,{id:"feedbackComment",label:Object(N.b)("Feedback"),type:"text",autoComplete:"off",value:n,element:"textarea",onChange:e=>{a(e.target.value)},ref:t}),o.a.createElement(Ne.b,{checked:i,onChange:s},Object(N.b)("You may contact me if you want to follow up or to let me test out upcoming ideas")))),c&&(u=o.a.createElement("p",{className:"mx_FeedbackDialog_section_microcopy"},Object(N.b)("PRO TIP: If you start a bug, please submit <debugLogsLink>debug logs</debugLogsLink> to help us track down the problem.",{},{debugLogsLink:e=>o.a.createElement(K.a,{kind:"link_inline",onClick:l},e)})));const m=it.b.getObject("feedback").get("existing_issues_url"),h=it.b.getObject("feedback").get("new_issue_url");return o.a.createElement(nt.a,{className:"mx_FeedbackDialog",hasCancelButton:!!c,title:Object(N.b)("Feedback"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_FeedbackDialog_section mx_FeedbackDialog_reportBug"},o.a.createElement("h3",null,Object(N.b)("Report a bug")),o.a.createElement("p",null,Object(N.b)("Please view <existingIssuesLink>existing bugs on Github</existingIssuesLink> first. No match? <newIssueLink>Start a new one</newIssueLink>.",{},{existingIssuesLink:e=>o.a.createElement(ct.a,{target:"_blank",rel:"noreferrer noopener",href:m},e),newIssueLink:e=>o.a.createElement(ct.a,{target:"_blank",rel:"noreferrer noopener",href:h},e)})),u),d),button:c?Object(N.b)("Send feedback"):Object(N.b)("Go back"),buttonDisabled:c&&!n,onFinished:t=>{if(c&&t){const t=e.feature?`${e.feature}-feedback`:"feedback";Object(st.c)(t,n,i),H.b.createDialog(ot.a,{title:Object(N.b)("Feedback sent"),description:Object(N.b)("Thank you!")})}e.onFinished()}})},gt=n(1406),bt=n(1330),vt=n(1309),ft=n(54),yt=n(196),Et=n(201);function wt(){return wt=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},wt.apply(this,arguments)}function St(e){return r.createElement("svg",wt({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 8 8",role:"presentation","aria-hidden":!0},e),dt||(dt=r.createElement("path",{d:"M6.73 1.395a.333.333 0 00-.527.41l.005.006.021.029a4.121 4.121 0 01.335.587c.187.4.37.95.37 1.573 0 .622-.183 1.173-.37 1.573a4.121 4.121 0 01-.356.616l-.004.006h-.001a.333.333 0 00.527.41L6.48 6.41l.249.194v-.001l.001-.002.003-.003.009-.012a2.258 2.258 0 00.13-.19c.081-.128.189-.312.296-.542A4.43 4.43 0 007.599 4a4.43 4.43 0 00-.43-1.855 4.787 4.787 0 00-.426-.732L6.734 1.4l-.003-.004-.001-.001-.263.204.263-.205z",fill:"currentColor"})),ut||(ut=r.createElement("path",{d:"M5.863 2.595a.333.333 0 00-.527.409l.001.001a.575.575 0 01.044.065c.032.049.074.122.117.214.087.186.169.437.169.716 0 .28-.082.53-.169.716a1.891 1.891 0 01-.16.279l-.002.002a.333.333 0 00.527.408L5.6 5.2l.263.205v-.001l.002-.001.002-.003.005-.007a1.28 1.28 0 00.072-.105c.044-.07.101-.168.158-.29.114-.243.232-.592.232-.998s-.118-.755-.232-.998a2.56 2.56 0 00-.23-.395L5.867 2.6l-.002-.003h-.001v-.001L5.6 2.8l.263-.205zM1.204 6.605a.333.333 0 00.526-.41l-.005-.006a4.121 4.121 0 01-.356-.616A3.764 3.764 0 011 4c0-.622.182-1.173.369-1.573a4.121 4.121 0 01.356-.616l.005-.006a.333.333 0 00-.526-.41l.248.194-.248-.194-.001.001-.001.002L1.2 1.4l-.009.012a2.258 2.258 0 00-.13.19 4.786 4.786 0 00-.295.542A4.43 4.43 0 00.333 4c0 .75.218 1.398.432 1.855a4.787 4.787 0 00.425.732l.01.012.002.004h.001v.001l.264-.204-.263.205z",fill:"currentColor"})),mt||(mt=r.createElement("path",{d:"M2.07 5.405a.333.333 0 00.527-.409l-.001-.001a.575.575 0 01-.044-.065 1.892 1.892 0 01-.117-.214A1.716 1.716 0 012.266 4c0-.28.082-.53.17-.716a1.891 1.891 0 01.16-.279l.001-.002a.333.333 0 00-.527-.408l.263.205-.263-.205v.001l-.001.001-.002.003-.006.007a1.28 1.28 0 00-.072.105 2.562 2.562 0 00-.158.29A2.381 2.381 0 001.6 4c0 .406.118.755.231.998a2.56 2.56 0 00.23.395l.006.007.002.003v.001l.264-.204-.263.205z",fill:"currentColor"})),ht||(ht=r.createElement("circle",{cx:4,cy:4,r:.667,fill:"currentColor"})))}var _t=n(69),Ct=n(729);class Ot extends o.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"dispatcherRef",void 0),i()(this,"themeWatcherRef",void 0),i()(this,"dndWatcherRef",void 0),i()(this,"buttonRef",Object(r.createRef)()),i()(this,"onCurrentVoiceBroadcastRecordingChanged",(e=>{this.setState({showLiveAvatarAddon:null!==e})})),i()(this,"onProfileUpdate",(async()=>{this.forceUpdate()})),i()(this,"onSelectedSpaceUpdate",(async()=>{this.setState({selectedSpace:Y.a.instance.activeSpaceRoom})})),i()(this,"onThemeChanged",(()=>{this.setState({isDarkTheme:this.isUserOnDarkTheme(),isHighContrast:this.isUserOnHighContrastTheme()})})),i()(this,"onAction",(e=>{if(e.action===F.a.ToggleUserMenu)this.state.contextMenuPosition?this.setState({contextMenuPosition:null}):this.buttonRef.current&&this.buttonRef.current.click()})),i()(this,"onOpenMenuClick",(e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:e.currentTarget.getBoundingClientRect()})})),i()(this,"onContextMenu",(e=>{e.preventDefault(),e.stopPropagation(),this.setState({contextMenuPosition:{left:e.clientX,top:e.clientY,width:20,height:0}})})),i()(this,"onCloseMenu",(()=>{this.setState({contextMenuPosition:null})})),i()(this,"onSwitchThemeClick",(e=>{e.preventDefault(),e.stopPropagation(),re.b.trackInteraction("WebUserMenuThemeToggleButton",e),v.b.setValue("use_system_theme",null,f.a.DEVICE,!1);let t=this.state.isDarkTheme?"light":"dark";if(this.state.isHighContrast){const e=Object(Ae.c)(t);e&&(t=e)}v.b.setValue("theme",null,f.a.DEVICE,t)})),i()(this,"onSettingsOpen",((e,t)=>{e.preventDefault(),e.stopPropagation();const n={action:F.a.ViewUserSettings,initialTabId:t};b.a.dispatch(n),this.setState({contextMenuPosition:null})})),i()(this,"onProvideFeedback",(e=>{e.preventDefault(),e.stopPropagation(),H.b.createDialog(pt),this.setState({contextMenuPosition:null})})),i()(this,"onSignOutClick",(async e=>{var t;e.preventDefault(),e.stopPropagation();const n=tt.a.get();n&&n.isCryptoEnabled()&&null!==(t=await n.exportRoomKeys())&&void 0!==t&&t.length?H.b.createDialog(gt.a):b.a.dispatch({action:"logout"}),this.setState({contextMenuPosition:null})})),i()(this,"onSignInClick",(()=>{b.a.dispatch({action:"start_login"}),this.setState({contextMenuPosition:null})})),i()(this,"onRegisterClick",(()=>{b.a.dispatch({action:"start_registration"}),this.setState({contextMenuPosition:null})})),i()(this,"onHomeClick",(e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:F.a.ViewHomePage}),this.setState({contextMenuPosition:null})})),i()(this,"renderContextMenu",(()=>{if(!this.state.contextMenuPosition)return null;let e,t,a;tt.a.safeGet().isGuest()&&(e=o.a.createElement("div",{className:"mx_UserMenu_contextMenu_header mx_UserMenu_contextMenu_guestPrompts"},Object(N.b)("Got an account? <a>Sign in</a>",{},{a:e=>o.a.createElement(K.a,{kind:"link_inline",onClick:this.onSignInClick},e)}),v.b.getValue(oe.b.Registration)?Object(N.b)("New here? <a>Create an account</a>",{},{a:e=>o.a.createElement(K.a,{kind:"link_inline",onClick:this.onRegisterClick},e)}):null)),this.hasHomePage&&(t=o.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconHome",label:Object(N.b)("Home"),onClick:this.onHomeClick})),Object(Ct.a)()&&(a=o.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconMessage",label:Object(N.b)("Feedback"),onClick:this.onProvideFeedback}));let i=o.a.createElement(de.c,null,t,o.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconBell",label:Object(N.b)("Notifications"),onClick:e=>this.onSettingsOpen(e,Me.a.Notifications)}),o.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconLock",label:Object(N.b)("Security & Privacy"),onClick:e=>this.onSettingsOpen(e,Me.a.Security)}),o.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(N.b)("All settings"),onClick:e=>this.onSettingsOpen(e)}),a,o.a.createElement(de.b,{className:"mx_IconizedContextMenu_option_red",iconClassName:"mx_UserMenu_iconSignOut",label:Object(N.b)("Sign out"),onClick:this.onSignOutClick}));tt.a.safeGet().isGuest()&&(i=o.a.createElement(de.c,null,t,o.a.createElement(de.b,{iconClassName:"mx_UserMenu_iconSettings",label:Object(N.b)("Settings"),onClick:e=>this.onSettingsOpen(e)}),a));const r=this.props.isPanelCollapsed?{left:(s=this.state.contextMenuPosition).width+s.left+8,top:s.top,chevronFace:le.a.None}:(e=>({left:e.left,top:e.top+e.height,chevronFace:le.a.None}))(this.state.contextMenuPosition);var s;return o.a.createElement(de.e,ee()({},r,{onFinished:this.onCloseMenu,className:"mx_UserMenu_contextMenu"}),o.a.createElement("div",{className:"mx_UserMenu_contextMenu_header"},o.a.createElement("div",{className:"mx_UserMenu_contextMenu_name"},o.a.createElement("span",{className:"mx_UserMenu_contextMenu_displayName"},vt.a.instance.displayName),o.a.createElement("span",{className:"mx_UserMenu_contextMenu_userId"},Et.a.getDisplayUserIdentifier(tt.a.safeGet().getSafeUserId(),{withDisplayName:!0}))),o.a.createElement(Oe.b,{className:"mx_UserMenu_contextMenu_themeButton",onClick:this.onSwitchThemeClick,title:this.state.isDarkTheme?Object(N.b)("Switch to light mode"):Object(N.b)("Switch to dark mode")},o.a.createElement("img",{src:n(1497).default,alt:Object(N.b)("Switch theme"),width:16}))),e,i)})),this.context=t,this.state={contextMenuPosition:null,isDarkTheme:this.isUserOnDarkTheme(),isHighContrast:this.isUserOnHighContrastTheme(),selectedSpace:Y.a.instance.activeSpaceRoom,showLiveAvatarAddon:this.context.voiceBroadcastRecordingsStore.hasCurrent()},vt.a.instance.on(ft.b,this.onProfileUpdate),Y.a.instance.on(J.d,this.onSelectedSpaceUpdate)}get hasHomePage(){return!!Object(bt.a)(it.b.get(),this.context.client)}componentDidMount(){this.context.voiceBroadcastRecordingsStore.on(_t.y.CurrentChanged,this.onCurrentVoiceBroadcastRecordingChanged),this.dispatcherRef=b.a.register(this.onAction),this.themeWatcherRef=v.b.watchSetting("theme",null,this.onThemeChanged)}componentWillUnmount(){this.themeWatcherRef&&v.b.unwatchSetting(this.themeWatcherRef),this.dndWatcherRef&&v.b.unwatchSetting(this.dndWatcherRef),this.dispatcherRef&&b.a.unregister(this.dispatcherRef),vt.a.instance.off(ft.b,this.onProfileUpdate),Y.a.instance.off(J.d,this.onSelectedSpaceUpdate),this.context.voiceBroadcastRecordingsStore.off(_t.y.CurrentChanged,this.onCurrentVoiceBroadcastRecordingChanged)}isUserOnDarkTheme(){if(v.b.getValue("use_system_theme"))return window.matchMedia("(prefers-color-scheme: dark)").matches;{const e=v.b.getValue("theme");return e.startsWith("custom-")?!!Object(Ae.e)(e.substring(7)).is_dark:"dark"===e}}isUserOnHighContrastTheme(){if(v.b.getValue("use_system_theme"))return window.matchMedia("(prefers-contrast: more)").matches;{const e=v.b.getValue("theme");return!e.startsWith("custom-")&&Object(Ae.g)(e)}}render(){const e=tt.a.safeGet().getSafeUserId(),t=vt.a.instance.displayName||e,n=vt.a.instance.getHttpAvatarUrl(32);let a;this.props.isPanelCollapsed||(a=o.a.createElement("div",{className:"mx_UserMenu_name"},t));const i=this.state.showLiveAvatarAddon?o.a.createElement("div",{className:"mx_UserMenu_userAvatarLive","data-testid":"user-menu-live-vb"},o.a.createElement(St,{className:"mx_Icon_8"})):null;return o.a.createElement("div",{className:"mx_UserMenu"},o.a.createElement(le.b,{className:"mx_UserMenu_contextMenuButton",onClick:this.onOpenMenuClick,inputRef:this.buttonRef,label:Object(N.b)("User menu"),isExpanded:!!this.state.contextMenuPosition,onContextMenu:this.onContextMenu},o.a.createElement("div",{className:"mx_UserMenu_userAvatar"},o.a.createElement(yt.a,{idName:e,name:t,url:n,width:32,height:32,resizeMethod:"crop",className:"mx_UserMenu_userAvatar_BaseAvatar"}),i),a,this.renderContextMenu()),this.props.children)}}i()(Ot,"contextType",Ze.a);var xt=n(169);const kt=["children","trackHorizontalOverflow","verticalScrollsHorizontally"];class Rt extends o.a.Component{constructor(e){super(e),i()(this,"autoHideScrollbar",Object(r.createRef)()),i()(this,"scrollElement",void 0),i()(this,"likelyTrackpadUser",null),i()(this,"checkAgainForTrackpad",0),i()(this,"collectScroller",(e=>{var t,n;null===(t=(n=this.props).wrappedRef)||void 0===t||t.call(n,e),e&&!this.scrollElement&&(this.scrollElement=e,this.scrollElement.addEventListener("scroll",this.checkOverflow,{passive:!0}),this.checkOverflow())})),i()(this,"checkOverflow",(()=>{if(!this.scrollElement)return;const e=this.scrollElement.scrollTop>0,t=this.scrollElement.scrollHeight>this.scrollElement.scrollTop+this.scrollElement.clientHeight,n=this.scrollElement.scrollLeft>0,a=this.scrollElement.scrollWidth>this.scrollElement.scrollLeft+this.scrollElement.clientWidth;e?this.scrollElement.classList.add("mx_IndicatorScrollbar_topOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_topOverflow"),t?this.scrollElement.classList.add("mx_IndicatorScrollbar_bottomOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_bottomOverflow"),n?this.scrollElement.classList.add("mx_IndicatorScrollbar_leftOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_leftOverflow"),a?this.scrollElement.classList.add("mx_IndicatorScrollbar_rightOverflow"):this.scrollElement.classList.remove("mx_IndicatorScrollbar_rightOverflow"),this.props.trackHorizontalOverflow&&this.setState({leftIndicatorOffset:n?`${this.scrollElement.scrollLeft}px`:"0",rightIndicatorOffset:a?`-${this.scrollElement.scrollLeft}px`:"0"})})),i()(this,"onMouseWheel",(e=>{if(this.props.verticalScrollsHorizontally&&this.scrollElement){const t=0,n=1,a=(new Date).getTime();if(Math.abs(e.deltaX)>0?(this.likelyTrackpadUser=!0,this.checkAgainForTrackpad=a+6e4):this.likelyTrackpadUser&&a>=this.checkAgainForTrackpad&&(this.likelyTrackpadUser=!1),this.likelyTrackpadUser)return;if(Math.abs(e.deltaX)<=t){const t=e.deltaY<0?-50:50,a=Math.abs(e.deltaY)<25?e.deltaY+t:e.deltaY;this.scrollElement.scrollLeft+=a*n}}})),this.state={leftIndicatorOffset:"0",rightIndicatorOffset:"0"}}componentDidUpdate(e){o.a.Children.count(e.children)!==o.a.Children.count(this.props.children)&&this.checkOverflow()}componentDidMount(){this.checkOverflow(),X.b.instance.on(X.a.Resize,this.checkOverflow)}componentWillUnmount(){var e;null===(e=this.scrollElement)||void 0===e||e.removeEventListener("scroll",this.checkOverflow),X.b.instance.off(X.a.Resize,this.checkOverflow)}render(){const e=this.props,{children:t,trackHorizontalOverflow:n,verticalScrollsHorizontally:a}=e,i=ge()(e,kt),r={left:this.state.leftIndicatorOffset},s={right:this.state.rightIndicatorOffset},l=n?o.a.createElement("div",{className:"mx_IndicatorScrollbar_leftOverflowIndicator",style:r}):null,c=n?o.a.createElement("div",{className:"mx_IndicatorScrollbar_rightOverflowIndicator",style:s}):null;return o.a.createElement(xt.a,ee()({},i,{ref:this.autoHideScrollbar,wrappedRef:this.collectScroller,onWheel:this.onMouseWheel}),l,t,c)}}const jt=["onFinished","hideHeader"],It=["selected","isPanelCollapsed"],Tt=["children","isPanelCollapsed","setPanelCollapsed","isDraggingOver","innerRef"],Pt=e=>{let{onFinished:t,hideHeader:n}=e,a=ge()(e,jt);const i=Object(ie.b)("Spaces.allRoomsInHome");return o.a.createElement(de.e,ee()({},a,{onFinished:t,className:"mx_SpacePanel_contextMenu",compact:!0}),!n&&o.a.createElement("div",{className:"mx_SpacePanel_contextMenu_header"},Object(N.b)("Home")),o.a.createElement(de.c,{first:!0},o.a.createElement(de.a,{iconClassName:"mx_SpacePanel_noIcon",label:Object(N.b)("Show all rooms"),active:i,onClick:()=>{v.b.setValue("Spaces.allRoomsInHome",null,f.a.ACCOUNT,!i)}})))},Nt=e=>{let{selected:t,isPanelCollapsed:n}=e,a=ge()(e,It);return o.a.createElement("li",{className:d()("mx_SpaceItem",{collapsed:n}),role:"treeitem","aria-selected":t},o.a.createElement(je,ee()({},a,{selected:t,isNarrow:n})))},Dt=()=>Y.a.instance.allRoomsInHome?Pe.a.instance.globalState:Y.a.instance.getNotificationState(J.a.Home),Mt=({isPanelCollapsed:e,setPanelCollapsed:t})=>{const[n,a,i,s]=Object(le.q)();let l;Object(r.useEffect)((()=>{!e&&n&&s()}),[e]),n&&(l=o.a.createElement(ve.c,{onFinished:s}));const c=n?s:()=>{e||t(!0),i()};return o.a.createElement("li",{className:d()("mx_SpaceItem mx_SpaceItem_new",{collapsed:e}),role:"treeitem","aria-selected":!1},o.a.createElement(je,{"data-testid":"create-space-button",className:d()("mx_SpaceButton_new",{mx_SpaceButton_newCancel:n}),label:n?Object(N.b)("Cancel"):Object(N.b)("Create a space"),onClick:c,isNarrow:e,innerRef:a}),l)},At={[J.a.Home]:({selected:e,isPanelCollapsed:t})=>{const n=Object(ae.b)(Y.a.instance,J.b,(()=>Y.a.instance.allRoomsInHome)),[a,i]=Object(r.useState)(Dt()),s=Object(r.useCallback)((()=>{i(Dt())}),[]);return Object(r.useEffect)(s,[s,n]),Object(ae.a)(Pe.a.instance,Pe.b,s),o.a.createElement(Nt,{spaceKey:J.a.Home,className:"mx_SpaceButton_home",selected:e,isPanelCollapsed:t,label:Object(J.g)(J.a.Home,n),notificationState:a,ContextMenuComponent:Pt,contextMenuTooltip:Object(N.b)("Options")})},[J.a.Favourites]:({selected:e,isPanelCollapsed:t})=>o.a.createElement(Nt,{spaceKey:J.a.Favourites,className:"mx_SpaceButton_favourites",selected:e,isPanelCollapsed:t,label:Object(J.g)(J.a.Favourites),notificationState:Y.a.instance.getNotificationState(J.a.Favourites)}),[J.a.People]:({selected:e,isPanelCollapsed:t})=>o.a.createElement(Nt,{spaceKey:J.a.People,className:"mx_SpaceButton_people",selected:e,isPanelCollapsed:t,label:Object(J.g)(J.a.People),notificationState:Y.a.instance.getNotificationState(J.a.People)}),[J.a.Orphans]:({selected:e,isPanelCollapsed:t})=>o.a.createElement(Nt,{spaceKey:J.a.Orphans,className:"mx_SpaceButton_orphans",selected:e,isPanelCollapsed:t,label:Object(J.g)(J.a.Orphans),notificationState:Y.a.instance.getNotificationState(J.a.Orphans)})},Lt=o.a.memo((e=>{let{children:t,isPanelCollapsed:n,setPanelCollapsed:a,isDraggingOver:i,innerRef:r}=e,s=ge()(e,Tt);const[l,c,d,u]=(()=>{const e=Object(ae.b)(Y.a.instance,J.c,(()=>Y.a.instance.invitedSpaces)),[t,n]=Object(ae.b)(Y.a.instance,J.f,(()=>[Y.a.instance.enabledMetaSpaces,Y.a.instance.spacePanelSpaces]));return[e,t,n,Object(ae.b)(Y.a.instance,J.d,(()=>Y.a.instance.activeSpace))]})(),m=u?[u]:[],h=c.map((e=>{const t=At[e];return o.a.createElement(t,{key:e,selected:u===e,isPanelCollapsed:n})}));return o.a.createElement(Rt,ee()({},s,{wrappedRef:r,className:"mx_SpaceTreeLevel",style:i?{pointerEvents:"none"}:void 0,element:"ul",role:"tree","aria-label":Object(N.b)("Spaces")}),h,l.map((e=>o.a.createElement(Ie,{key:e.roomId,space:e,activeSpaces:m,isPanelCollapsed:n,onExpand:()=>a(!1)}))),d.map(((e,t)=>o.a.createElement(be.Draggable,{key:e.roomId,draggableId:e.roomId,index:t},((t,i)=>o.a.createElement(Ie,ee()({},t.draggableProps,{dragHandleProps:t.dragHandleProps,key:e.roomId,innerRef:t.innerRef,className:i.isDragging?"mx_SpaceItem_dragging":void 0,space:e,activeSpaces:m,isPanelCollapsed:n,onExpand:()=>a(!1)})))))),t,Object(te.a)(oe.a.CreateSpaces)&&o.a.createElement(Mt,{isPanelCollapsed:n,setPanelCollapsed:a}))}));var Ut=()=>{const[e,t]=Object(r.useState)(!1),[n,a]=Object(r.useState)(!0),i=Object(r.useRef)(null);return Object(r.useLayoutEffect)((()=>(i.current&&X.b.instance.trackElementDimensions("SpacePanel",i.current),()=>X.b.instance.stopTrackingElementDimensions("SpacePanel"))),[]),Object(ne.a)(b.a,(e=>{e.action===F.a.ToggleSpacePanel&&a(!n)})),o.a.createElement(Oe.d,{handleHomeEnd:!0,handleUpDown:!e},(({onKeyDownHandler:e,onDragEndHandler:r})=>o.a.createElement(be.DragDropContext,{onDragStart:()=>{t(!0)},onDragEnd:e=>{t(!1),e.destination&&(Y.a.instance.moveRootSpace(e.source.index,e.destination.index),r())}},o.a.createElement("div",{className:d()("mx_SpacePanel",{collapsed:n}),onKeyDown:e,ref:i},o.a.createElement(Ot,{isPanelCollapsed:n},o.a.createElement($.a,{className:d()("mx_SpacePanel_toggleCollapse",{expanded:!n}),onClick:()=>a(!n),title:n?Object(N.b)("Expand"):Object(N.b)("Collapse"),tooltip:o.a.createElement("div",null,o.a.createElement("div",{className:"mx_Tooltip_title"},n?Object(N.b)("Expand"):Object(N.b)("Collapse")),o.a.createElement("div",{className:"mx_Tooltip_sub"},m.a?"⌘ + ⇧ + D":Object(N.b)(z.a[m.b.CONTROL])+" + "+Object(N.b)(z.a[m.b.SHIFT])+" + D"))})),o.a.createElement(be.Droppable,{droppableId:"top-level-spaces"},((e,t)=>o.a.createElement(Lt,ee()({},e.droppableProps,{isPanelCollapsed:n,setPanelCollapsed:a,isDraggingOver:t.isDraggingOver,innerRef:e.innerRef}),e.placeholder))),o.a.createElement(et,{isPanelCollapsed:n})))))};const Ft=e=>({left:e.left+window.scrollX,top:e.bottom+window.scrollY+12,chevronFace:le.a.None});var Bt=function(e){return e[e.JoinRoom=0]="JoinRoom",e[e.BulkRedact=1]="BulkRedact",e}(Bt||{});var Vt=({onVisibilityChange:e})=>{var t;const n=Object(r.useContext)(I.a),[a,i,c,d]=Object(le.q)(),[u,m,h,p]=Object(le.q)(),[g,v]=Object(ae.b)(Y.a.instance,J.d,(()=>[Y.a.instance.activeSpace,Y.a.instance.activeSpaceRoom])),f=Object(ae.b)(Y.a.instance,J.b,(()=>Y.a.instance.allRoomsInHome)),y=Object(ie.a)("feature_video_rooms"),E=Object(ie.a)("feature_element_call_video_rooms"),w=(()=>{const e=Object(r.useContext)(I.a),[t,n]=Object(r.useState)(new Map),a=(e,a)=>{const i=new Set(t.get(e));i.add(a),n(new Map(t).set(e,i))},i=(e,a)=>{const i=new Set(t.get(e));i.delete(a)&&n(new Map(t).set(e,i))};return Object(ne.a)(b.a,(e=>{switch(e.action){case F.a.JoinRoom:a(Bt.JoinRoom,e.roomId);break;case F.a.JoinRoomReady:case F.a.JoinRoomError:i(Bt.JoinRoom,e.roomId);break;case F.a.BulkRedactStart:a(Bt.BulkRedact,e.roomId);break;case F.a.BulkRedactEnd:i(Bt.BulkRedact,e.roomId)}})),Object(ae.c)(e,s.b.Room,(e=>i(Bt.JoinRoom,e.roomId))),t})(),S=v||g===J.a.Home;Object(r.useEffect)((()=>{a&&!S&&d()}),[d,S,a]);const _=Object(ae.d)(null!=v?v:void 0,l.RoomEvent.Name,(()=>null==v?void 0:v.name));Object(r.useEffect)((()=>{null==e||e()}),[e]);const C=Object(te.a)(oe.a.ExploreRooms),O=Object(te.a)(oe.a.CreateRooms),x=Object(te.a)(oe.a.CreateSpaces),k=null==v||null===(t=v.currentState)||void 0===t?void 0:t.maySendStateEvent(l.EventType.SpaceChild,n.getUserId()),R=k&&O,j=k&&x,T=O||C||x||v;let P,D;if(a&&i.current){let e;e=v?ue.a:Pt,P=o.a.createElement(e,ee()({},Ft(i.current.getBoundingClientRect()),{space:v,onFinished:d,hideHeader:!0}))}else if(u&&v){let e,t;Object(se.c)(v)&&(e=o.a.createElement(de.b,{label:Object(N.b)("Invite"),iconClassName:"mx_RoomListHeader_iconInvite",onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(se.i)(v),p()}})),null!=v&&v.currentState.maySendStateEvent(l.EventType.RoomAvatar,n.getUserId())&&(t=o.a.createElement(o.a.Fragment,null,o.a.createElement(de.b,{iconClassName:"mx_RoomListHeader_iconNewRoom",label:Object(N.b)("New room"),onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(se.g)(v),re.b.trackInteraction("WebRoomListHeaderPlusMenuCreateRoomItem",e),p()}}),y&&o.a.createElement(de.b,{iconClassName:"mx_RoomListHeader_iconNewVideoRoom",label:Object(N.b)("New video room"),onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(se.g)(v,E?l.RoomType.UnstableCall:l.RoomType.ElementVideo),p()}},o.a.createElement(ce.a,null)))),P=o.a.createElement(de.e,ee()({},Ft(m.current.getBoundingClientRect()),{onFinished:p,compact:!0}),o.a.createElement(de.c,{first:!0},e,t,o.a.createElement(de.b,{label:Object(N.b)("Explore rooms"),iconClassName:"mx_RoomListHeader_iconExplore",onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:F.a.ViewRoom,room_id:v.roomId,metricsTrigger:void 0}),p(),re.b.trackInteraction("WebRoomListHeaderPlusMenuExploreRoomsItem",e)}}),o.a.createElement(de.b,{label:Object(N.b)("Add existing room"),iconClassName:"mx_RoomListHeader_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(se.e)(v),p()},disabled:!R,tooltip:R?void 0:Object(N.b)("You do not have permissions to add rooms to this space")}),x&&o.a.createElement(de.b,{label:Object(N.b)("Add space"),iconClassName:"mx_RoomListHeader_iconPlus",onClick:e=>{e.preventDefault(),e.stopPropagation(),Object(se.h)(v),p()},disabled:!j,tooltip:j?void 0:Object(N.b)("You do not have permissions to add spaces to this space")},o.a.createElement(ce.a,null))))}else if(u){let e,t;O&&(e=o.a.createElement(o.a.Fragment,null,o.a.createElement(de.b,{label:Object(N.b)("Start new chat"),iconClassName:"mx_RoomListHeader_iconStartChat",onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"view_create_chat"}),re.b.trackInteraction("WebRoomListHeaderPlusMenuCreateChatItem",e),p()}}),o.a.createElement(de.b,{label:Object(N.b)("New room"),iconClassName:"mx_RoomListHeader_iconNewRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"view_create_room"}),re.b.trackInteraction("WebRoomListHeaderPlusMenuCreateRoomItem",e),p()}}),y&&o.a.createElement(de.b,{label:Object(N.b)("New video room"),iconClassName:"mx_RoomListHeader_iconNewVideoRoom",onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"view_create_room",type:E?l.RoomType.UnstableCall:l.RoomType.ElementVideo}),p()}},o.a.createElement(ce.a,null)))),C&&(t=o.a.createElement(de.b,{label:Object(N.b)("Join public room"),iconClassName:"mx_RoomListHeader_iconExplore",onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:F.a.ViewRoomDirectory}),re.b.trackInteraction("WebRoomListHeaderPlusMenuExploreRoomsItem",e),p()}})),P=o.a.createElement(de.e,ee()({},Ft(m.current.getBoundingClientRect()),{onFinished:p,compact:!0}),o.a.createElement(de.c,{first:!0},e,t))}D=v&&_?_:Object(J.g)(g,f);const M=[...w.entries()].filter((([e,t])=>t.size>0)).map((([e,t])=>{switch(e){case Bt.JoinRoom:return Object(N.b)("Currently joining %(count)s rooms",{count:t.size});case Bt.BulkRedact:return Object(N.b)("Currently removing messages in %(count)s rooms",{count:t.size})}})).join("\n");let A=o.a.createElement("div",{className:"mx_RoomListHeader_contextLessTitle"},D);if(S){const e={inputRef:i,onClick:c,isExpanded:a,className:"mx_RoomListHeader_contextMenuButton",children:D};A=v?o.a.createElement(le.b,ee()({},e,{label:Object(N.b)("%(spaceName)s menu",{spaceName:null!=_?_:v.name})})):o.a.createElement(le.c,ee()({},e,{title:Object(N.b)("Home options")}))}return o.a.createElement("div",{className:"mx_RoomListHeader"},A,M?o.a.createElement(he.a,{label:M},o.a.createElement(me.a,null)):null,T&&o.a.createElement(le.c,{inputRef:m,onClick:h,isExpanded:u,className:"mx_RoomListHeader_plusButton",title:Object(N.b)("Add")}),P)},Wt=n(1325),zt=n(61),Ht=n(617),Gt=n(419),Kt=n(423);const qt=({room:e,onClick:t})=>{const[n,a,i]=Object(Oe.i)();return o.a.createElement($.a,{className:"mx_RoomBreadcrumbs_crumb",onClick:t,"aria-label":Object(N.b)("Room %(name)s",{name:e.name}),title:e.name,tooltipClassName:"mx_RoomBreadcrumbs_Tooltip",onFocus:n,inputRef:i,tabIndex:a?0:-1},o.a.createElement(Gt.a,{room:e,avatarSize:32,displayBadge:!0,forceCount:!0,tooltipProps:{tabIndex:a?0:-1}}))};class $t extends o.a.PureComponent{constructor(e){super(e),i()(this,"isMounted",!0),i()(this,"onBreadcrumbsUpdate",(()=>{this.isMounted&&(this.setState({doAnimation:!1,skipFirst:!0}),window.setTimeout((()=>this.setState({doAnimation:!0,skipFirst:!1})),0))})),i()(this,"viewRoom",((e,t,n=!1)=>{b.a.dispatch({action:F.a.ViewRoom,room_id:e.roomId,metricsTrigger:"WebHorizontalBreadcrumbs",metricsViaKeyboard:n})})),this.state={doAnimation:!0,skipFirst:!1},Wt.a.instance.on(ft.b,this.onBreadcrumbsUpdate)}componentWillUnmount(){this.isMounted=!1,Wt.a.instance.off(ft.b,this.onBreadcrumbsUpdate)}render(){const e=Wt.a.instance.rooms.map(((e,t)=>o.a.createElement(qt,{key:e.roomId,room:e,onClick:n=>this.viewRoom(e,t,"click"!==n.type)})));return e.length>0?o.a.createElement(Ht.CSSTransition,{appear:!0,in:this.state.doAnimation,timeout:640,classNames:"mx_RoomBreadcrumbs"},o.a.createElement(Kt.a,{className:"mx_RoomBreadcrumbs","aria-label":Object(N.b)("Recently visited rooms")},e.slice(this.state.skipFirst?1:0))):o.a.createElement("div",{className:"mx_RoomBreadcrumbs"},o.a.createElement("div",{className:"mx_RoomBreadcrumbs_placeholder"},Object(N.b)("No recently visited rooms")))}}var Yt=n(160),Jt=n(1341);function Qt({selected:e,minimized:t}){const n=Object(ie.b)("FTUE.useCaseSelection");return Object(ie.b)("FTUE.userOnboardingButton")&&!t&&Object(Jt.b)(n)?o.a.createElement(Xt,{selected:e,minimized:t}):o.a.createElement(o.a.Fragment,null)}function Xt({selected:e,minimized:t}){const n=Object(r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),re.b.trackInteraction("WebRoomListUserOnboardingIgnoreButton",e),v.b.setValue("FTUE.userOnboardingButton",null,f.a.ACCOUNT,!1)}),[]),a=Object(r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),re.b.trackInteraction("WebRoomListUserOnboardingButton",e),b.a.fire(F.a.ViewHomePage)}),[]);return o.a.createElement(K.a,{className:d()("mx_UserOnboardingButton",{mx_UserOnboardingButton_selected:e,mx_UserOnboardingButton_minimized:t}),onClick:a},!t&&o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_UserOnboardingButton_content"},o.a.createElement(Yt.a,{size:"4",className:"mx_Heading_h4"},Object(N.b)("Welcome")),o.a.createElement(K.a,{className:"mx_UserOnboardingButton_close",onClick:n}))))}var Zt=function(e){return e[e.Disabled=0]="Disabled",e[e.Legacy=1]="Legacy",e}(Zt||{});class en extends r.Component{constructor(e){super(e),i()(this,"listContainerRef",Object(r.createRef)()),i()(this,"roomListRef",Object(r.createRef)()),i()(this,"focusedElement",null),i()(this,"isDoingStickyHeaders",!1),i()(this,"updateActiveSpace",(e=>{this.setState({activeSpace:e})})),i()(this,"onDialPad",(()=>{b.a.fire(F.a.OpenDialPad)})),i()(this,"onExplore",(e=>{b.a.fire(F.a.ViewRoomDirectory),re.b.trackInteraction("WebLeftPanelExploreRoomsButton",e)})),i()(this,"refreshStickyHeaders",(()=>{this.listContainerRef.current&&this.handleStickyHeaders(this.listContainerRef.current)})),i()(this,"onBreadcrumbsUpdate",(()=>{const e=en.breadcrumbsMode;if(e!==this.state.showBreadcrumbs){if(this.setState({showBreadcrumbs:e}),!this.listContainerRef.current)return;this.handleStickyHeaders(this.listContainerRef.current)}})),i()(this,"onScroll",(e=>{const t=e.target;this.handleStickyHeaders(t)})),i()(this,"onFocus",(e=>{this.focusedElement=e.target})),i()(this,"onBlur",(()=>{this.focusedElement=null})),i()(this,"onKeyDown",((e,t)=>{if(!this.focusedElement)return;var n;Object(Q.a)().getRoomListAction(e)===z.h.NextRoom&&(t||(e.stopPropagation(),e.preventDefault(),null===(n=this.roomListRef.current)||void 0===n||n.focus()))})),this.state={activeSpace:Y.a.instance.activeSpace,showBreadcrumbs:en.breadcrumbsMode},Wt.a.instance.on(ft.b,this.onBreadcrumbsUpdate),zt.c.instance.on(zt.b,this.onBreadcrumbsUpdate),Y.a.instance.on(J.d,this.updateActiveSpace)}static get breadcrumbsMode(){return Wt.a.instance.visible?Zt.Legacy:Zt.Disabled}componentDidMount(){this.listContainerRef.current&&(X.b.instance.trackElementDimensions("ListContainer",this.listContainerRef.current),this.listContainerRef.current.addEventListener("scroll",this.onScroll,{passive:!0})),X.b.instance.on("ListContainer",this.refreshStickyHeaders)}componentWillUnmount(){var e;Wt.a.instance.off(ft.b,this.onBreadcrumbsUpdate),zt.c.instance.off(zt.b,this.onBreadcrumbsUpdate),Y.a.instance.off(J.d,this.updateActiveSpace),X.b.instance.stopTrackingElementDimensions("ListContainer"),X.b.instance.removeListener("ListContainer",this.refreshStickyHeaders),null===(e=this.listContainerRef.current)||void 0===e||e.removeEventListener("scroll",this.onScroll)}componentDidUpdate(e,t){t.activeSpace!==this.state.activeSpace&&this.refreshStickyHeaders()}handleStickyHeaders(e){this.isDoingStickyHeaders||(this.isDoingStickyHeaders=!0,window.requestAnimationFrame((()=>{this.doStickyHeaders(e),this.isDoingStickyHeaders=!1})))}doStickyHeaders(e){if(!e.parentElement)return;const t=e.scrollTop,n=e.offsetHeight+e.scrollTop,a=e.querySelectorAll(".mx_RoomSublist:not(.mx_RoomSublist_hidden)"),i=new Map;let r,o;for(const e of a){const s=e.querySelector(".mx_RoomSublist_stickable");if(!s)continue;s.style.removeProperty("display");const l=.4,c=e.offsetTop+l*W.a<=t,d=e.offsetTop+l*W.a>=n;c||e===a[0]?(i.set(s,{stickyTop:!0}),r&&(r.style.display="none",i.set(r,{makeInvisible:!0})),r=s):d&&!o?(i.set(s,{stickyBottom:!0}),o=s):i.set(s,{})}for(const t of i.keys()){const n=i.get(t);if(n.makeInvisible)t.style.display="none";else{if(n.stickyTop){t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")||t.classList.add("mx_RoomSublist_headerContainer_stickyTop");const n=`${e.parentElement.offsetTop}px`;t.style.top!==n&&(t.style.top=n)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyTop")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyTop"),t.style.top&&t.style.removeProperty("top");if(n.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")||t.classList.add("mx_RoomSublist_headerContainer_stickyBottom");const n=`${X.b.instance.windowHeight-(e.parentElement.offsetTop+e.parentElement.offsetHeight)}px`;t.style.bottom!==n&&(t.style.bottom=n)}else t.classList.contains("mx_RoomSublist_headerContainer_stickyBottom")&&t.classList.remove("mx_RoomSublist_headerContainer_stickyBottom"),t.style.bottom&&t.style.removeProperty("bottom");if(n.stickyTop||n.stickyBottom){t.classList.contains("mx_RoomSublist_headerContainer_sticky")||t.classList.add("mx_RoomSublist_headerContainer_sticky");const e=X.b.instance.getElementDimensions("ListContainer");if(e){const n=15,a=`${e.width-n}px`;t.style.width!==a&&(t.style.width=a)}}else n.stickyTop||n.stickyBottom||(t.classList.contains("mx_RoomSublist_headerContainer_sticky")&&t.classList.remove("mx_RoomSublist_headerContainer_sticky"),t.style.width&&t.style.removeProperty("width"))}}const s=e.parentElement;s&&(r?s.classList.add("mx_LeftPanel_roomListWrapper_stickyTop"):s.classList.remove("mx_LeftPanel_roomListWrapper_stickyTop"),o?s.classList.add("mx_LeftPanel_roomListWrapper_stickyBottom"):s.classList.remove("mx_LeftPanel_roomListWrapper_stickyBottom"))}renderBreadcrumbs(){if(this.state.showBreadcrumbs===Zt.Legacy&&!this.props.isMinimized)return r.createElement(Rt,{className:"mx_LeftPanel_breadcrumbsContainer mx_AutoHideScrollbar",verticalScrollsHorizontally:!0},r.createElement($t,null))}renderSearchDialExplore(){let e,t;return V.b.instance.getSupportsPstnProtocol()&&(e=r.createElement($.a,{className:d()("mx_LeftPanel_dialPadButton",{}),onClick:this.onDialPad,title:Object(N.b)("Open dial pad")})),this.state.activeSpace===J.a.Home&&Object(te.a)(oe.a.ExploreRooms)&&(t=r.createElement($.a,{className:"mx_LeftPanel_exploreButton",onClick:this.onExplore,title:Object(N.b)("Explore rooms")})),r.createElement("div",{className:"mx_LeftPanel_filterContainer",onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown},r.createElement(q,{isMinimized:this.props.isMinimized}),e,t)}render(){const e=r.createElement(B.b,{onKeyDown:this.onKeyDown,resizeNotifier:this.props.resizeNotifier,onFocus:this.onFocus,onBlur:this.onBlur,isMinimized:this.props.isMinimized,activeSpace:this.state.activeSpace,onResize:this.refreshStickyHeaders,onListCollapse:this.refreshStickyHeaders,ref:this.roomListRef}),t=d()({mx_LeftPanel:!0,mx_LeftPanel_minimized:this.props.isMinimized}),n=d()("mx_LeftPanel_actualRoomListContainer","mx_AutoHideScrollbar");return r.createElement("div",{className:t},r.createElement("div",{className:"mx_LeftPanel_roomListContainer"},Object(te.a)(oe.a.FilterContainer)&&this.renderSearchDialExplore(),this.renderBreadcrumbs(),!this.props.isMinimized&&r.createElement(Vt,{onVisibilityChange:this.refreshStickyHeaders}),r.createElement(Qt,{selected:this.props.pageType===h.a.HomePage,minimized:this.props.isMinimized}),r.createElement("div",{className:"mx_LeftPanel_roomListWrapper"},r.createElement("div",{className:n,ref:this.listContainerRef,tabIndex:-1},e))))}}var tn=n(613);class nn extends r.PureComponent{constructor(e){super(e),i()(this,"onUpdateToasts",(()=>{this.setState({toasts:tn.a.instance.components})})),this.state={toasts:tn.a.instance.components},tn.a.instance.on(ft.b,this.onUpdateToasts)}componentWillUnmount(){tn.a.instance.off(ft.b,this.onUpdateToasts)}render(){const e=this.state.toasts.map(((e,t)=>r.createElement("div",{className:"mx_NonUrgentToastContainer_toast",key:`toast-${t}`},r.createElement(e,{}))));return r.createElement("div",{className:"mx_NonUrgentToastContainer",role:"alert"},e)}}var an=n(18),rn=n(189),on=n(3);class sn extends o.a.Component{constructor(e){super(e),i()(this,"element",Object(r.createRef)()),i()(this,"onAudioOutputChanged",(e=>{const t=this.element.current;if(e)try{t.setSinkId(e)}catch(e){on.a.error("Couldn't set requested audio output device: using default",e),on.a.warn("Couldn't set requested audio output device: using default",e)}})),i()(this,"onNewStream",(()=>{this.setState({audioMuted:this.props.feed.isAudioMuted()}),this.playMedia()})),this.state={audioMuted:this.props.feed.isAudioMuted()}}componentDidMount(){p.c.instance.addListener(p.a.AudioOutputChanged,this.onAudioOutputChanged),this.props.feed.addListener(rn.b.NewStream,this.onNewStream),this.playMedia()}componentWillUnmount(){p.c.instance.removeListener(p.a.AudioOutputChanged,this.onAudioOutputChanged),this.props.feed.removeListener(rn.b.NewStream,this.onNewStream),this.stopMedia()}async playMedia(){const e=this.element.current;if(e){this.onAudioOutputChanged(p.c.getAudioOutput()),e.muted=!1,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{await e.load()}catch(e){on.a.info(`Failed to play media element with feed for userId ${this.props.feed.userId} with purpose ${this.props.feed.purpose}`,e)}}}stopMedia(){const e=this.element.current;e&&(e.pause(),e.removeAttribute("src"))}render(){return this.state.audioMuted?null:o.a.createElement("audio",{ref:this.element})}}class ln extends o.a.Component{constructor(e){super(e),i()(this,"onFeedsChanged",(()=>{this.setState({feeds:this.props.call.getRemoteFeeds()})})),this.state={feeds:this.props.call.getRemoteFeeds()}}componentDidMount(){this.props.call.addListener(an.d.FeedsChanged,this.onFeedsChanged)}componentWillUnmount(){this.props.call.removeListener(an.d.FeedsChanged,this.onFeedsChanged)}render(){return this.state.feeds.map(((e,t)=>o.a.createElement(sn,{feed:e,key:t})))}}var cn=n(47),dn=n(30),un=n(425),mn=n(45),hn=n(376),pn=n(238),gn=n(649);class bn extends o.a.Component{constructor(...e){super(...e),i()(this,"onResizeStart",(()=>{this.props.resizeNotifier.startResizing()})),i()(this,"onResize",(()=>{this.props.resizeNotifier.notifyRightHandleResized()})),i()(this,"onResizeStop",((e,t,n,a)=>{this.props.resizeNotifier.stopResizing(),window.localStorage.setItem(this.sizeSettingStorageKey,(this.loadSidePanelSize().width+a.width).toString())}))}get sizeSettingStorageKey(){let e="mx_rhs_size";return this.props.sizeKey&&(e+=`_${this.props.sizeKey}`),e}loadSidePanelSize(){let e=parseInt(window.localStorage.getItem(this.sizeSettingStorageKey),10);return isNaN(e)&&(e=this.props.defaultSize),{height:"100%",width:e}}render(){const e=o.a.Children.only(this.props.children),t=this.props.panel;let n;return!this.props.collapsedRhs&&t&&(n=o.a.createElement(gn.Resizable,{key:this.props.sizeKey,defaultSize:this.loadSidePanelSize(),minWidth:264,maxWidth:"50%",enable:{top:!1,right:!1,bottom:!1,left:!0,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_RightPanel_ResizeWrapper",handleClasses:{left:"mx_ResizeHandle--horizontal"}},t)),o.a.createElement("div",{className:"mx_MainSplit"},e,n)}}i()(bn,"defaultProps",{defaultSize:350});var vn=n(74),fn=n(123),yn=n(773),En=n(634),wn=n(470),Sn=n(86),_n=n(337),Cn=n(270),On=n(108),xn=n(63);const kn=["app","className","width","height"];var Rn=e=>{let{app:t,className:a,width:i=20,height:r=20}=e,s=ge()(e,kn),l=[n(1527).default];return t.type.includes("jitsi")?l=[n(1528).default]:t.type.includes("meeting")||t.type.includes("calendar")?l=[n(1529).default]:t.type.includes("pad")||t.type.includes("doc")||t.type.includes("calc")?l=[n(1530).default]:t.type.includes("clock")&&(l=[n(1531).default]),o.a.createElement(yt.a,ee()({},s,{name:t.id,className:d()("mx_WidgetAvatar",a),url:Object(On.b)(t)&&t.avatar_url?Object(xn.b)(t.avatar_url).getSquareThumbnailHttp(20):null,urls:l,width:i,height:r}))},jn=n(396),In=n(28),Tn=n(96),Pn=n(1362),Nn=n(171),Dn=n(31),Mn=n(145),An=n(136),Ln=n(73);function Un(){return it.b.get("audio_stream_url")}async function Fn(e,t,n){const a=await async function(e,t){const n=await e.getOpenIdToken(),a=Un()+"/createStream",i=await window.fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({room_id:t,openid_token:n})});return(await i.json()).stream_id}(e,n);await t.transport.send(Ln.a.StartLiveStream,{rtmpStreamKey:"rtmp://audiostream.dummy/"+a})}var Bn=n(642),Vn=n(67),Wn=n(29);var zn=n(198),Hn=n(662),Gn=n(34),Kn=n(60);class qn extends o.a.PureComponent{constructor(e){super(e),i()(this,"onAllow",(()=>{this.onPermissionSelection(!0)})),i()(this,"onDeny",(()=>{this.onPermissionSelection(!1)})),i()(this,"onRememberSelectionChange",(e=>{this.setState({rememberSelection:e})})),this.state={rememberSelection:!1}}onPermissionSelection(e){this.state.rememberSelection&&(on.a.log(`Remembering ${this.props.widget.id} as allowed=${e} for OpenID`),Ze.b.instance.widgetPermissionStore.setOIDCState(this.props.widget,this.props.widgetKind,this.props.inRoomId,e?Hn.a.Allowed:Hn.a.Denied)),this.props.onFinished(e)}render(){return o.a.createElement(Gn.a,{className:"mx_WidgetOpenIDPermissionsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(N.b)("Allow this widget to verify your identity")},o.a.createElement("div",{className:"mx_WidgetOpenIDPermissionsDialog_content"},o.a.createElement("p",null,Object(N.b)("The widget will verify your user ID, but won't be able to perform actions for you:")),o.a.createElement("p",{className:"text-muted"},this.props.widget.templateUrl.split("?")[0].split("#")[0])),o.a.createElement(Kn.a,{primaryButton:Object(N.b)("Continue"),onPrimaryButtonClick:this.onAllow,onCancel:this.onDeny,additive:o.a.createElement(zn.a,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:Object(N.b)("Remember this")})}))}}var $n=n(6),Yn=n(88),Jn=n(641);const Qn="generic";class Xn{static bylineFor(e){return e.kind===Tn.EventKind.State?e.keyStr?Object(N.b)("with state key %(stateKey)s",{stateKey:e.keyStr}):Object(N.b)("with an empty state key"):null}static for(e,t){if(Xn.simpleCaps[e]){const n=Xn.simpleCaps[e];if(n[t])return{primary:Object(N.b)(n[t])};if(n[Qn])return{primary:Object(N.b)(n[Qn])}}if(Object(Tn.isTimelineCapability)(e)){if(Object(Tn.isTimelineCapabilityFor)(e,Tn.Symbols.AnyRoom))return{primary:Object(N.b)("The above, but in any room you are joined or invited to as well")};{const t=Object(Tn.getTimelineRoomIDFromCapability)(e),n=tt.a.safeGet().getRoom(t);return{primary:Object(N.b)("The above, but in <Room /> as well",{},{Room:()=>{var e;return n?o.a.createElement(Cn.a,{tooltip:null!==(e=n.getCanonicalAlias())&&void 0!==e?e:t},o.a.createElement("b",null,n.name)):o.a.createElement("b",null,o.a.createElement("code",null,t))}})}}}const[n]=Tn.WidgetEventCapability.findEventCapabilities([e]);if(n){if(n.kind===Tn.EventKind.Event&&n.eventType===l.EventType.RoomMessage)return Xn.forRoomMessageCap(n,t);const e=n.kind===Tn.EventKind.State?Xn.stateSendRecvCaps:Xn.nonStateSendRecvCaps;if(e[n.eventType]){const a=e[n.eventType],i=(null==a?void 0:a[t])||(null==a?void 0:a[Qn]);if(null!=i&&i[n.direction])return{primary:Object(N.b)(i[n.direction])}}return t===Tn.WidgetKind.Room?n.direction===Tn.EventDirection.Send?{primary:Object(N.b)("Send <b>%(eventType)s</b> events as you in this room",{eventType:n.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:Xn.bylineFor(n)}:{primary:Object(N.b)("See <b>%(eventType)s</b> events posted to this room",{eventType:n.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:Xn.bylineFor(n)}:n.direction===Tn.EventDirection.Send?{primary:Object(N.b)("Send <b>%(eventType)s</b> events as you in your active room",{eventType:n.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:Xn.bylineFor(n)}:{primary:Object(N.b)("See <b>%(eventType)s</b> events posted to your active room",{eventType:n.eventType},{b:e=>o.a.createElement("b",null,e)}),byline:Xn.bylineFor(n)}}return{primary:Object(N.b)("The <b>%(capability)s</b> capability",{capability:e},{b:e=>o.a.createElement("b",null,e)})}}static forRoomMessageCap(e,t){if(!e.keyStr)return e.direction===Tn.EventDirection.Send?{primary:t===Tn.WidgetKind.Room?Object(N.b)("Send messages as you in this room"):Object(N.b)("Send messages as you in your active room")}:{primary:t===Tn.WidgetKind.Room?Object(N.b)("See messages posted to this room"):Object(N.b)("See messages posted to your active room")};switch(e.keyStr){case l.MsgType.Text:return e.direction===Tn.EventDirection.Send?{primary:t===Tn.WidgetKind.Room?Object(N.b)("Send text messages as you in this room"):Object(N.b)("Send text messages as you in your active room")}:{primary:t===Tn.WidgetKind.Room?Object(N.b)("See text messages posted to this room"):Object(N.b)("See text messages posted to your active room")};case l.MsgType.Emote:return e.direction===Tn.EventDirection.Send?{primary:t===Tn.WidgetKind.Room?Object(N.b)("Send emotes as you in this room"):Object(N.b)("Send emotes as you in your active room")}:{primary:t===Tn.WidgetKind.Room?Object(N.b)("See emotes posted to this room"):Object(N.b)("See emotes posted to your active room")};case l.MsgType.Image:return e.direction===Tn.EventDirection.Send?{primary:t===Tn.WidgetKind.Room?Object(N.b)("Send images as you in this room"):Object(N.b)("Send images as you in your active room")}:{primary:t===Tn.WidgetKind.Room?Object(N.b)("See images posted to this room"):Object(N.b)("See images posted to your active room")};case l.MsgType.Video:return e.direction===Tn.EventDirection.Send?{primary:t===Tn.WidgetKind.Room?Object(N.b)("Send videos as you in this room"):Object(N.b)("Send videos as you in your active room")}:{primary:t===Tn.WidgetKind.Room?Object(N.b)("See videos posted to this room"):Object(N.b)("See videos posted to your active room")};case l.MsgType.File:return e.direction===Tn.EventDirection.Send?{primary:t===Tn.WidgetKind.Room?Object(N.b)("Send general files as you in this room"):Object(N.b)("Send general files as you in your active room")}:{primary:t===Tn.WidgetKind.Room?Object(N.b)("See general files posted to this room"):Object(N.b)("See general files posted to your active room")};default:{let n;return n=e.direction===Tn.EventDirection.Send?t===Tn.WidgetKind.Room?Object(N.b)("Send <b>%(msgtype)s</b> messages as you in this room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}):Object(N.b)("Send <b>%(msgtype)s</b> messages as you in your active room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}):t===Tn.WidgetKind.Room?Object(N.b)("See <b>%(msgtype)s</b> messages posted to this room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}):Object(N.b)("See <b>%(msgtype)s</b> messages posted to your active room",{msgtype:e.keyStr},{b:e=>o.a.createElement("b",null,e)}),{primary:n}}}}}i()(Xn,"simpleCaps",{[Tn.MatrixCapabilities.AlwaysOnScreen]:{[Tn.WidgetKind.Room]:Object(N.d)("Remain on your screen when viewing another room, when running"),[Qn]:Object(N.d)("Remain on your screen while running")},[Tn.MatrixCapabilities.StickerSending]:{[Tn.WidgetKind.Room]:Object(N.d)("Send stickers into this room"),[Qn]:Object(N.d)("Send stickers into your active room")},[Jn.a.CanChangeViewedRoom]:{[Qn]:Object(N.d)("Change which room you're viewing")},[Tn.MatrixCapabilities.MSC2931Navigate]:{[Qn]:Object(N.d)("Change which room, message, or user you're viewing")}}),i()(Xn,"stateSendRecvCaps",{[l.EventType.RoomTopic]:{[Tn.WidgetKind.Room]:{[Tn.EventDirection.Send]:Object(N.d)("Change the topic of this room"),[Tn.EventDirection.Receive]:Object(N.d)("See when the topic changes in this room")},[Qn]:{[Tn.EventDirection.Send]:Object(N.d)("Change the topic of your active room"),[Tn.EventDirection.Receive]:Object(N.d)("See when the topic changes in your active room")}},[l.EventType.RoomName]:{[Tn.WidgetKind.Room]:{[Tn.EventDirection.Send]:Object(N.d)("Change the name of this room"),[Tn.EventDirection.Receive]:Object(N.d)("See when the name changes in this room")},[Qn]:{[Tn.EventDirection.Send]:Object(N.d)("Change the name of your active room"),[Tn.EventDirection.Receive]:Object(N.d)("See when the name changes in your active room")}},[l.EventType.RoomAvatar]:{[Tn.WidgetKind.Room]:{[Tn.EventDirection.Send]:Object(N.d)("Change the avatar of this room"),[Tn.EventDirection.Receive]:Object(N.d)("See when the avatar changes in this room")},[Qn]:{[Tn.EventDirection.Send]:Object(N.d)("Change the avatar of your active room"),[Tn.EventDirection.Receive]:Object(N.d)("See when the avatar changes in your active room")}},[l.EventType.RoomMember]:{[Tn.WidgetKind.Room]:{[Tn.EventDirection.Send]:Object(N.d)("Remove, ban, or invite people to this room, and make you leave"),[Tn.EventDirection.Receive]:Object(N.d)("See when people join, leave, or are invited to this room")},[Qn]:{[Tn.EventDirection.Send]:Object(N.d)("Remove, ban, or invite people to your active room, and make you leave"),[Tn.EventDirection.Receive]:Object(N.d)("See when people join, leave, or are invited to your active room")}}}),i()(Xn,"nonStateSendRecvCaps",{[l.EventType.Sticker]:{[Tn.WidgetKind.Room]:{[Tn.EventDirection.Send]:Object(N.d)("Send stickers to this room as you"),[Tn.EventDirection.Receive]:Object(N.d)("See when a sticker is posted in this room")},[Qn]:{[Tn.EventDirection.Send]:Object(N.d)("Send stickers to your active room as you"),[Tn.EventDirection.Receive]:Object(N.d)("See when anyone posts a sticker to your active room")}}});class Zn extends o.a.PureComponent{constructor(e){super(e),i()(this,"eventPermissionsMap",new Map),i()(this,"onToggle",(e=>{const t=Object(Yn.f)(this.state.booleanStates);t[e]=!t[e],this.setState({booleanStates:t})})),i()(this,"onRememberSelectionChange",(e=>{this.setState({rememberSelection:e})})),i()(this,"onSubmit",(async()=>{this.closeAndTryRemember(Object.entries(this.state.booleanStates).filter((([e,t])=>t)).map((([e])=>e)))})),i()(this,"onReject",(async()=>{this.closeAndTryRemember([])}));Tn.WidgetEventCapability.findEventCapabilities(this.props.requestedCapabilities).forEach((e=>this.eventPermissionsMap.set(e.raw,e)));const t={};this.props.requestedCapabilities.forEach((e=>t[e]=!0)),this.state={booleanStates:t,rememberSelection:!0}}closeAndTryRemember(e){this.props.onFinished({approved:e,remember:this.state.rememberSelection})}render(){const e=Object.entries(this.state.booleanStates).sort((([e],[t])=>{const n=Object(Tn.isTimelineCapability)(e),a=Object(Tn.isTimelineCapability)(t);return n||a?n&&!a?1:!n&&a?-1:n&&a?Object($n.x)(e,t):0:Object($n.x)(e,t)})).map((([e,t],n)=>{const a=Xn.for(e,this.props.widgetKind),i=a.byline?o.a.createElement("span",{className:"mx_WidgetCapabilitiesPromptDialog_byline"},a.byline):null;return o.a.createElement("div",{className:"mx_WidgetCapabilitiesPromptDialog_cap",key:e+n},o.a.createElement(Ne.b,{checked:t,onChange:()=>this.onToggle(e)},a.primary),i)}));return o.a.createElement(Gn.a,{className:"mx_WidgetCapabilitiesPromptDialog",onFinished:this.props.onFinished,title:Object(N.b)("Approve widget permissions")},o.a.createElement("form",{onSubmit:this.onSubmit},o.a.createElement("div",{className:"mx_Dialog_content"},o.a.createElement("div",{className:"text-muted"},Object(N.b)("This widget would like to:")),e,o.a.createElement(Kn.a,{primaryButton:Object(N.b)("Approve"),cancelButton:Object(N.b)("Decline All"),onPrimaryButtonClick:this.onSubmit,onCancel:this.onReject,additive:o.a.createElement(zn.a,{value:this.state.rememberSelection,toggleInFront:!0,onChange:this.onRememberSelectionChange,label:Object(N.b)("Remember my selection for this widget")})}))))}}const ea={};var ta=n(415),na=n(636),aa=n(805);const ia=({urls:e,username:t,credential:n})=>({uris:e,username:t,password:n});class ra extends Tn.WidgetDriver{constructor(e,t,n,a,r){var o;if(super(),this.forWidget=t,this.forWidgetKind=n,this.inRoomId=r,i()(this,"allowedCapabilities",void 0),this.allowedCapabilities=new Set([...e,Tn.MatrixCapabilities.Screenshots,Jn.a.RequiresClient]),Mn.a.JITSI.matches(this.forWidget.type)&&n===Tn.WidgetKind.Room)this.allowedCapabilities.add(Tn.MatrixCapabilities.AlwaysOnScreen);else if(Mn.a.STICKERPICKER.matches(this.forWidget.type)&&n===Tn.WidgetKind.Account){const e=Tn.WidgetEventCapability.forRoomEvent(Tn.EventDirection.Send,l.EventType.Sticker).raw;this.allowedCapabilities.add(Tn.MatrixCapabilities.StickerSending),this.allowedCapabilities.add(e),this.allowedCapabilities.add("visibility")}else if(a&&new URL(null!==(o=it.b.get("element_call").url)&&void 0!==o?o:it.a.element_call.url).origin===this.forWidget.origin){this.allowedCapabilities.add(Tn.MatrixCapabilities.AlwaysOnScreen),this.allowedCapabilities.add(Tn.MatrixCapabilities.MSC3846TurnServers),this.allowedCapabilities.add(`org.matrix.msc2762.timeline:${r}`),this.allowedCapabilities.add(Tn.WidgetEventCapability.forRoomEvent(Tn.EventDirection.Send,"org.matrix.rageshake_request").raw),this.allowedCapabilities.add(Tn.WidgetEventCapability.forRoomEvent(Tn.EventDirection.Receive,"org.matrix.rageshake_request").raw),this.allowedCapabilities.add(Tn.WidgetEventCapability.forStateEvent(Tn.EventDirection.Receive,l.EventType.RoomMember).raw),this.allowedCapabilities.add(Tn.WidgetEventCapability.forStateEvent(Tn.EventDirection.Receive,"org.matrix.msc3401.call").raw),this.allowedCapabilities.add(Tn.WidgetEventCapability.forStateEvent(Tn.EventDirection.Send,"org.matrix.msc3401.call.member",tt.a.safeGet().getSafeUserId()).raw),this.allowedCapabilities.add(Tn.WidgetEventCapability.forStateEvent(Tn.EventDirection.Receive,"org.matrix.msc3401.call.member").raw);const e=[l.EventType.CallInvite,l.EventType.CallCandidates,l.EventType.CallAnswer,l.EventType.CallHangup,l.EventType.CallReject,l.EventType.CallSelectAnswer,l.EventType.CallNegotiate,l.EventType.CallSDPStreamMetadataChanged,l.EventType.CallSDPStreamMetadataChangedPrefix,l.EventType.CallReplaces];for(const t of e)this.allowedCapabilities.add(Tn.WidgetEventCapability.forToDeviceEvent(Tn.EventDirection.Send,t).raw),this.allowedCapabilities.add(Tn.WidgetEventCapability.forToDeviceEvent(Tn.EventDirection.Receive,t).raw);Ze.b.instance.widgetPermissionStore.setOIDCState(t,n,r,Hn.a.Allowed)}}async validateCapabilities(e){const t=(n=e,a=this.allowedCapabilities,Object(Wn.a)(Array.from(n),Array.from(a)));var n,a;const i=new Set(t.removed),r=new Set(this.allowedCapabilities);var o;let s;if((o=this.forWidget,JSON.parse(localStorage.getItem(`widget_${o.id}_approved_caps`)||"[]")).forEach((e=>{r.add(e),i.delete(e)})),ea.preapproveCapabilities)s=await ea.preapproveCapabilities(this.forWidget,e);else{const t={approvedCapabilities:void 0};Bn.a.instance.invoke(Pn.WidgetLifecycle.CapabilitiesRequest,t,this.forWidget,e),s=t.approvedCapabilities}s&&s.forEach((e=>{r.add(e),i.delete(e)}));let l=!1;if(i.size>0)try{var c;const[e]=await H.b.createDialog(Zn,{requestedCapabilities:i,widget:this.forWidget,widgetKind:this.forWidgetKind}).finished;null==e||null===(c=e.approved)||void 0===c||c.forEach((e=>r.add(e))),l=!(null==e||!e.remember)}catch(e){on.a.error("Non-fatal error getting capabilities: ",e)}const d=new Set(function(e,t){return Object(Wn.f)(Array.from(e),Array.from(t))}(r,e));return l&&function(e,t){localStorage.setItem(`widget_${e.id}_approved_caps`,JSON.stringify(t))}(this.forWidget,Array.from(d)),d}async sendEvent(e,t,n,a){const i=tt.a.get(),r=a||Ze.b.instance.roomViewStore.getRoomId();if(!i||!r)throw new Error("Not in a room or not attached to a client");let o=null;return null!==n?o=await i.sendStateEvent(r,e,t,n):e===l.EventType.RoomRedaction?o=await i.redactEvent(r,t.redacts):(o=await i.sendEvent(r,e,t),e===l.EventType.RoomMessage&&ta.CHAT_EFFECTS.forEach((e=>{if(Object(na.containsEmoji)(t,e.emojis)){var n;(null===(n=t["m.relates_to"])||void 0===n?void 0:n.rel_type)!==dn.d.name&&b.a.dispatch({action:`effects.${e.command}`})}}))),{roomId:r,eventId:o.event_id}}async sendToDevice(e,t,n){const a=tt.a.safeGet();if(t){const e=await a.crypto.deviceList.downloadKeys(Object.keys(n),!1);await Promise.all(Object.entries(n).flatMap((([t,n])=>Object.entries(n).map((async([n,i])=>{const r=e.get(t);r&&("*"===n?await a.encryptAndSendToDevices(Array.from(r.values()).map((e=>({userId:t,deviceInfo:e}))),i):r.has(n)&&await a.encryptAndSendToDevices([{userId:t,deviceInfo:r.get(n)}],i))})))))}else await a.queueToDevice({eventType:e,batch:Object.entries(n).flatMap((([e,t])=>Object.entries(t).map((([t,n])=>({userId:e,deviceId:t,payload:n})))))})}pickRooms(e){const t=tt.a.get();if(!t)throw new Error("Not attached to a client");return(e?e.includes(Tn.Symbols.AnyRoom)?t.getVisibleRooms(v.b.getValue("feature_dynamic_room_predecessors")):e.map((e=>t.getRoom(e))):[t.getRoom(Ze.b.instance.roomViewStore.getRoomId())]).filter((e=>!!e))}async readRoomEvents(e,t,n,a){n=n>0?Math.min(n,Number.MAX_SAFE_INTEGER):Number.MAX_SAFE_INTEGER;const i=this.pickRooms(a),r=[];for(const a of i){const i=[],o=a.getLiveTimeline().getEvents();for(let a=o.length-1;a>0&&!(i.length>=n);a--){const n=o[a];n.getType()!==e||n.isState()||e===l.EventType.RoomMessage&&t&&t!==n.getContent().msgtype||i.push(n)}i.forEach((e=>r.push(e.getEffectiveEvent())))}return r}async readStateEvents(e,t,n,a){n=n>0?Math.min(n,Number.MAX_SAFE_INTEGER):Number.MAX_SAFE_INTEGER;const i=this.pickRooms(a),r=[];for(const a of i){const i=[],o=a.currentState.events.get(e);if(o)if(""===t||t){const e=o.get(t);e&&i.push(e)}else i.push(...Array.from(o.values()));i.slice(0,n).forEach((e=>r.push(e.getEffectiveEvent())))}return r}async askOpenID(e){const t={approved:void 0};if(Bn.a.instance.invoke(Pn.WidgetLifecycle.IdentityRequest,t,this.forWidget),t.approved)return e.update({state:Tn.OpenIDRequestState.Allowed,token:await tt.a.safeGet().getOpenIdToken()});const n=Ze.b.instance.widgetPermissionStore.getOIDCState(this.forWidget,this.forWidgetKind,this.inRoomId),a=()=>tt.a.safeGet().getOpenIdToken();return n===Hn.a.Denied?e.update({state:Tn.OpenIDRequestState.Blocked}):n===Hn.a.Allowed?e.update({state:Tn.OpenIDRequestState.Allowed,token:await a()}):(e.update({state:Tn.OpenIDRequestState.PendingUserConfirmation}),void H.b.createDialog(qn,{widget:this.forWidget,widgetKind:this.forWidgetKind,inRoomId:this.inRoomId,onFinished:async t=>t?e.update({state:Tn.OpenIDRequestState.Allowed,token:await a()}):e.update({state:Tn.OpenIDRequestState.Blocked})}))}async navigate(e){Object(aa.a)(e)}async*getTurnServers(){const e=tt.a.safeGet();if(!e.pollingTurnServers||!e.getTurnServers().length)return;let t,n;const a=([e])=>t(ia(e)),i=(e,t)=>{t&&n(e)};e.on(s.b.TurnServers,a),e.on(s.b.TurnServersError,i);try{const a=e.getTurnServers()[0];for(yield ia(a);;)yield await new Promise(((e,a)=>{t=e,n=a}))}finally{e.off(s.b.TurnServers,a),e.off(s.b.TurnServersError,i)}}async readEventRelations(e,t,n,a,i,r,o,s){var l,c;const d=tt.a.safeGet(),u=s;if("string"!=typeof(t=null!==(l=null!==(c=t)&&void 0!==c?c:Ze.b.instance.roomViewStore.getRoomId())&&void 0!==l?l:void 0))throw new Error("Error while reading the current room");const{events:m,nextBatch:h,prevBatch:p}=await d.relations(t,e,null!=n?n:null,null!=a?a:null,{from:i,to:r,limit:o,dir:u});return{chunk:m.map((e=>e.getEffectiveEvent())),nextBatch:null!=h?h:void 0,prevBatch:null!=p?p:void 0}}async searchUserDirectory(e,t){const n=tt.a.safeGet(),{limited:a,results:i}=await n.searchUserDirectory({term:e,limit:t});return{limited:a,results:i.map((e=>({userId:e.user_id,displayName:e.display_name,avatarUrl:e.avatar_url})))}}}var oa=n(176),sa=n(120);const la="io.element.web";function ca(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function da(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ca(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ca(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class ua extends r.PureComponent{constructor(e){super(e),i()(this,"widget",void 0),i()(this,"possibleButtons",void 0),i()(this,"appFrame",r.createRef()),i()(this,"state",{disabledButtonIds:(this.props.widgetDefinition.buttons||[]).filter((e=>e.disabled)).map((e=>e.id))}),i()(this,"onReady",(()=>{var e;null===(e=this.state.messaging)||void 0===e||e.sendWidgetConfig(this.props.widgetDefinition)})),i()(this,"onLoad",(()=>{this.state.messaging&&(this.state.messaging.once("ready",this.onReady),this.state.messaging.on(`action:${Tn.WidgetApiFromWidgetAction.CloseModalWidget}`,this.onWidgetClose),this.state.messaging.on(`action:${Tn.WidgetApiFromWidgetAction.SetModalButtonEnabled}`,this.onButtonEnableToggle))})),i()(this,"onWidgetClose",(e=>{this.props.onFinished(!0,e.detail.data)})),i()(this,"onButtonEnableToggle",(e=>{var t;e.preventDefault();var n;if(e.detail.data.button===Tn.BuiltInModalButtonID.Close||!this.possibleButtons.includes(e.detail.data.button))return null===(n=this.state.messaging)||void 0===n?void 0:n.transport.reply(e.detail,{error:{message:"Invalid button"}});let a;if(e.detail.data.enabled)a=Object(Wn.b)(this.state.disabledButtonIds).filter((t=>t!==e.detail.data.button));else{const t=new Set(this.state.disabledButtonIds);t.add(e.detail.data.button),a=Array.from(t)}this.setState({disabledButtonIds:a}),null===(t=this.state.messaging)||void 0===t||t.transport.reply(e.detail,{})})),this.widget=new ya(da(da({},this.props.widgetDefinition),{},{creatorUserId:tt.a.safeGet().getSafeUserId(),id:`modal_${this.props.sourceWidgetId}`})),this.possibleButtons=(this.props.widgetDefinition.buttons||[]).map((e=>e.id))}componentDidMount(){const e=new ra([],this.widget,Tn.WidgetKind.Modal,!1),t=new Tn.ClientWidgetApi(this.widget,this.appFrame.current,e);this.setState({messaging:t})}componentWillUnmount(){this.state.messaging&&(this.state.messaging.off("ready",this.onReady),this.state.messaging.off(`action:${Tn.WidgetApiFromWidgetAction.CloseModalWidget}`,this.onWidgetClose),this.state.messaging.stop())}render(){var e,t,a;const i=this.widget.getCompleteUrl({widgetRoomId:this.props.widgetRoomId,currentUserId:tt.a.safeGet().getSafeUserId(),userDisplayName:null!==(e=vt.a.instance.displayName)&&void 0!==e?e:void 0,userHttpAvatarUrl:null!==(t=vt.a.instance.getHttpAvatarUrl())&&void 0!==t?t:void 0,clientId:la,clientTheme:v.b.getValue("theme"),clientLanguage:Object(N.i)()}),o=new URL(i);o.searchParams.set("widgetId",this.widget.id),o.searchParams.set("parentUrl",window.location.href.split("#",2)[0]);const s=o.toString().replace(/%24/g,"$");let l;return this.props.widgetDefinition.buttons&&(l=this.props.widgetDefinition.buttons.slice(0,3).reverse().map((e=>{let t="secondary";switch(e.kind){case Tn.ModalButtonKind.Primary:t="primary";break;case Tn.ModalButtonKind.Secondary:t="primary_outline";break;case Tn.ModalButtonKind.Danger:t="danger"}const n=this.state.disabledButtonIds.includes(e.id);return r.createElement(K.a,{key:e.id,kind:t,onClick:()=>{var t;null===(t=this.state.messaging)||void 0===t||t.notifyModalWidgetButtonClicked(e.id)},disabled:n},e.label)}))),r.createElement(Gn.a,{title:this.props.widgetDefinition.name||Object(N.b)("Modal Widget"),className:"mx_ModalWidgetDialog",contentId:"mx_Dialog_content",onFinished:this.props.onFinished},r.createElement("div",{className:"mx_ModalWidgetDialog_warning"},r.createElement("img",{src:n(529).default,height:"16",width:"16",alt:""}),Object(N.b)("Data on this screen is shared with %(widgetDomain)s",{widgetDomain:o.hostname})),r.createElement("div",null,r.createElement("iframe",{title:null!==(a=this.widget.name)&&void 0!==a?a:void 0,ref:this.appFrame,sandbox:"allow-forms allow-scripts allow-same-origin",src:s,onLoad:this.onLoad})),r.createElement("div",{className:"mx_ModalWidgetDialog_buttons"},l))}}function ma(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ha(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ma(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ma(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class pa extends sa.a{constructor(){super(b.a,{}),i()(this,"modalInstance",null),i()(this,"openSourceWidgetId",null),i()(this,"openSourceWidgetRoomId",null),i()(this,"canOpenModalWidget",(()=>!this.modalInstance)),i()(this,"openModalWidget",((e,t,n)=>{this.modalInstance||(this.openSourceWidgetId=t.id,this.openSourceWidgetRoomId=null!=n?n:null,this.modalInstance=H.b.createDialog(ua,{widgetDefinition:ha({},e),widgetRoomId:n,sourceWidgetId:t.id,onFinished:(e,a)=>{this.closeModalWidget(t,n,e&&a?a:{"m.exited":!0}),this.openSourceWidgetId=null,this.openSourceWidgetRoomId=null,this.modalInstance=null}},void 0,!1,!0))})),i()(this,"closeModalWidget",((e,t,n)=>{if(this.modalInstance&&this.openSourceWidgetId===e.id&&this.openSourceWidgetRoomId===t){this.openSourceWidgetId=null,this.openSourceWidgetRoomId=null,this.modalInstance.close(),this.modalInstance=null;const a=Nn.a.instance.getMessaging(e,t);if(!a)return void on.a.error("No source widget messaging for modal widget");a.notifyModalWidgetClose(n)}}))}static get instance(){return pa.internalInstance}async onAction(e){}}i()(pa,"internalInstance",(()=>{const e=new pa;return e.start(),e})()),window.mxModalWidgetStore=pa.instance;var ga=n(650);const ba={};function va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function fa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?va(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class ya extends Tn.Widget{constructor(e){super(e),this.rawDefinition=e}get templateUrl(){var e;return Mn.a.JITSI.matches(this.type)?Sn.a.getLocalJitsiWrapperUrl({forLocalRender:!0,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):super.templateUrl}get popoutTemplateUrl(){var e;return Mn.a.JITSI.matches(this.type)?Sn.a.getLocalJitsiWrapperUrl({forLocalRender:!1,auth:null===(e=super.rawData)||void 0===e?void 0:e.auth}):this.templateUrl}get rawData(){let e=super.rawData.conferenceId;if(void 0===e){e=new URL(super.templateUrl).searchParams.get("confId")}let t=super.rawData.domain;void 0===t&&(t="meet.element.io");let n=(new ga.a).getEffectiveTheme();if(n.startsWith("custom-")){const e=Object(Ae.e)(n.slice(7));n=e.is_dark?"dark":"light"}return n=n.includes("light")?"light":"dark",fa(fa({},super.rawData),{},{theme:n,conferenceId:e,domain:t})}getCompleteUrl(e,t=!1){return Object(Tn.runTemplate)(t?this.popoutTemplateUrl:this.templateUrl,fa(fa({},this.rawDefinition),{},{data:this.rawData}),e)}}class Ea extends Vn.EventEmitter{constructor(e){var t;super(),this.appTileProps=e,i()(this,"client",void 0),i()(this,"messaging",null),i()(this,"mockWidget",void 0),i()(this,"scalarToken",void 0),i()(this,"roomId",void 0),i()(this,"kind",void 0),i()(this,"virtual",void 0),i()(this,"readUpToMap",{}),i()(this,"onOpenModal",(async e=>{var t,n;(e.preventDefault(),pa.instance.canOpenModalWidget())?(pa.instance.openModalWidget(e.detail.data,this.mockWidget,this.roomId),null===(t=this.messaging)||void 0===t||t.transport.reply(e.detail,{})):null===(n=this.messaging)||void 0===n||n.transport.reply(e.detail,{error:{message:"Unable to open modal at this time"}})})),i()(this,"onEvent",(e=>{this.client.decryptEventIfNeeded(e),e.isBeingDecrypted()||e.isDecryptionFailure()||this.feedEvent(e)})),i()(this,"onEventDecrypted",(e=>{e.isDecryptionFailure()||this.feedEvent(e)})),i()(this,"onToDeviceEvent",(async e=>{var t;await this.client.decryptEventIfNeeded(e),e.isDecryptionFailure()||await(null===(t=this.messaging)||void 0===t?void 0:t.feedToDevice(e.getEffectiveEvent(),e.isEncrypted()))})),this.client=tt.a.safeGet();let n=e.app;n.creatorUserId||(n=Object(Yn.f)(n),n.creatorUserId=this.client.getUserId()),this.mockWidget=new ya(n),this.roomId=null===(t=e.room)||void 0===t?void 0:t.roomId,this.kind=e.userWidget?Tn.WidgetKind.Account:Tn.WidgetKind.Room,this.virtual=Object(On.b)(n)&&void 0===n.eventId}get eventListenerRoomId(){return this.roomId?this.roomId:Ze.b.instance.roomViewStore.getRoomId()}get widgetApi(){return this.messaging}get embedUrl(){return this.runUrlTemplate({asPopout:!1})}get popoutUrl(){return this.runUrlTemplate({asPopout:!0})}runUrlTemplate(e={asPopout:!1}){var t,n,a,i,r;const o=null!==(t=null==ba||null===(n=ba.provideVariables)||void 0===n?void 0:n.call(ba))&&void 0!==t?t:{},s={widgetRoomId:this.roomId,currentUserId:this.client.getUserId(),userDisplayName:null!==(a=vt.a.instance.displayName)&&void 0!==a?a:void 0,userHttpAvatarUrl:null!==(i=vt.a.instance.getHttpAvatarUrl())&&void 0!==i?i:void 0,clientId:la,clientTheme:v.b.getValue("theme"),clientLanguage:Object(N.i)(),deviceId:null!==(r=this.client.getDeviceId())&&void 0!==r?r:void 0},l=this.mockWidget.getCompleteUrl(Object.assign(s,o),null==e?void 0:e.asPopout),c=new URL(l);return null!=e&&e.asPopout||(c.searchParams.set("widgetId",this.mockWidget.id),c.searchParams.set("parentUrl",window.location.href.split("#",2)[0]),this.scalarToken&&c.searchParams.set("scalar_token",this.scalarToken)),c.toString().replace(/%24/g,"$")}get isManagedByManager(){return!!this.scalarToken}get started(){return!!this.messaging}startMessaging(e){if(this.started)return;const t=this.appTileProps.whitelistCapabilities||[],n=new ra(t,this.mockWidget,this.kind,this.virtual,this.roomId);this.messaging=new Tn.ClientWidgetApi(this.mockWidget,e,n),this.messaging.on("preparing",(()=>this.emit("preparing"))),this.messaging.on("error:preparing",(e=>this.emit("error:preparing",e))),this.messaging.on("ready",(()=>{Nn.a.instance.storeMessaging(this.mockWidget,this.roomId,this.messaging),this.emit("ready")})),this.messaging.on("capabilitiesNotified",(()=>this.emit("capabilitiesNotified"))),this.messaging.on(`action:${Tn.WidgetApiFromWidgetAction.OpenModalWidget}`,this.onOpenModal),this.messaging.on(`action:${Ln.a.JoinCall}`,(()=>{var e;null===(e=Ze.b.instance.voiceBroadcastRecordingsStore.getCurrent())||void 0===e||e.pause()})),this.messaging.on(`action:${Ln.a.ViewRoom}`,(e=>{var t;e.preventDefault();const n=(e.detail.data||{}).room_id;var a,i;return n?null!==(t=this.messaging)&&void 0!==t&&t.hasCapability(Jn.a.CanChangeViewedRoom)?(b.a.dispatch({action:F.a.ViewRoom,room_id:n,metricsTrigger:"Widget"}),void this.messaging.transport.reply(e.detail,{})):null===(i=this.messaging)||void 0===i?void 0:i.transport.reply(e.detail,{error:{message:"This widget does not have permission for this action (denied)."}}):null===(a=this.messaging)||void 0===a?void 0:a.transport.reply(e.detail,{error:{message:"Room ID not supplied."}})}));for(const e of this.client.getRooms()){var a;const t=(null===(a=e.getLiveTimeline())||void 0===a?void 0:a.getEvents())||[],n=t[t.length-1];n&&(this.readUpToMap[e.roomId]=n.getId())}this.client.on(s.b.Event,this.onEvent),this.client.on(l.MatrixEventEvent.Decrypted,this.onEventDecrypted),this.client.on(s.b.ToDeviceEvent,this.onToDeviceEvent),this.messaging.on(`action:${Tn.WidgetApiFromWidgetAction.UpdateAlwaysOnScreen}`,(e=>{var t,n;null!==(t=this.messaging)&&void 0!==t&&t.hasCapability(Tn.MatrixCapabilities.AlwaysOnScreen)&&(oa.b.instance.setWidgetPersistence(this.mockWidget.id,null!==(n=this.roomId)&&void 0!==n?n:null,e.detail.data.value),e.preventDefault(),this.messaging.transport.reply(e.detail,{}))})),this.messaging.on(`action:${Tn.WidgetApiFromWidgetAction.SendSticker}`,(e=>{var t;null!==(t=this.messaging)&&void 0!==t&&t.hasCapability(Tn.MatrixCapabilities.StickerSending)&&(e.preventDefault(),this.messaging.transport.reply(e.detail,{}),b.a.dispatch({action:"m.sticker",data:e.detail.data,widgetId:this.mockWidget.id}))})),Mn.a.STICKERPICKER.matches(this.mockWidget.type)&&this.messaging.on(`action:${Ln.a.OpenIntegrationManager}`,(e=>{var t,n,a;e.preventDefault(),null===(t=this.messaging)||void 0===t||t.transport.reply(e.detail,{}),b.a.dispatch({action:"stickerpicker_close"});const i=e.detail.data,r=null==i?void 0:i.integType,o=null==i?void 0:i.integId,s=Ze.b.instance.roomViewStore.getRoomId(),l=s?this.client.getRoom(s):void 0;l&&(null===(n=_n.a.sharedInstance())||void 0===n||null===(a=n.getPrimaryManager())||void 0===a||a.open(l,`type_${r}`,o))})),Mn.a.JITSI.matches(this.mockWidget.type)&&this.messaging.on(`action:${Ln.a.HangupCall}`,(e=>{var t,n;e.preventDefault(),null!==(t=e.detail.data)&&void 0!==t&&t.errorMessage&&H.b.createDialog(Dn.a,{title:Object(N.b)("Connection lost"),description:Object(N.b)("You were disconnected from the call. (Error: %(message)s)",{message:e.detail.data.errorMessage})}),null===(n=this.messaging)||void 0===n||n.transport.reply(e.detail,{})}))}async prepare(){var e,t;if(await(null!==(e=null==ba||null===(t=ba.isReady)||void 0===t?void 0:t.call(ba))&&void 0!==e?e:Promise.resolve()),this.scalarToken)return;const n=Nn.a.instance.getMessaging(this.mockWidget,this.roomId);n&&(this.messaging=n);try{if(Sn.a.isScalarUrl(this.mockWidget.templateUrl)){const e=_n.a.sharedInstance();if(e.hasManager()){const t=e.getPrimaryManager();if(t&&Sn.a.isScalarUrl(t.apiUrl)){const e=t.getScalarClient();this.scalarToken=await e.getScalarToken()}}}}catch(e){on.a.error("Error preparing widget communications: ",e)}}stopMessaging(e={forceDestroy:!1}){var t;null!=e&&e.forceDestroy||!oa.b.instance.getWidgetPersistence(this.mockWidget.id,null!==(t=this.roomId)&&void 0!==t?t:null)?this.started&&(Nn.a.instance.stopMessaging(this.mockWidget,this.roomId),this.messaging=null,this.client.off(s.b.Event,this.onEvent),this.client.off(l.MatrixEventEvent.Decrypted,this.onEventDecrypted),this.client.off(s.b.ToDeviceEvent,this.onToDeviceEvent)):on.a.log("Skipping destroy - persistent widget")}feedEvent(e){if(!this.messaging)return;const t=this.readUpToMap[e.getRoomId()];if(t){if(t===e.getId())return;let n=!0;const a=this.client.getRoom(e.getRoomId());if(!a)return;const i=a.getLiveTimeline(),r=Object(Wn.b)(i.getEvents()).reverse().slice(0,100);for(const a of r){if(a.getId()===t)break;if(a.getId()===e.getId()){n=!1;break}}if(n)return}const n=e.getRoomId(),a=e.getId();if(n&&a){const e=this.client.getRoom(n);e&&"join"===e.getMyMembership()&&(this.readUpToMap[n]=a)}const i=e.getEffectiveEvent();this.messaging.feedEvent(i,this.eventListenerRoomId).catch((e=>{on.a.error("Error sending event to widget: ",e)}))}}const wa=["onFinished","app","userWidget","onDeleteClick","onEditClick","showUnpin"],Sa=e=>!!Un()&&Mn.a.JITSI.matches(e.type),_a=(e,t)=>t&&Sn.a.isManagedByManager(e),Ca=(e,t,n,a)=>{var i;const r=Object(On.b)(n)&&void 0!==n.eventId&&null!==(i=v.b.getValue("allowedWidgets",t)[n.eventId])&&void 0!==i&&i||n.creatorUserId===(null==e?void 0:e.getUserId()),o=Mn.a.JITSI.matches(n.type);return!a&&!o&&r},Oa=(e,t)=>!!t||e,xa=e=>v.b.getValue("enableWidgetScreenshots")&&!(null==e||!e.hasCapability(Tn.MatrixCapabilities.Screenshots)),ka=(e,t,n)=>{if(!n)return[!1,!1];const a=t?An.d.instance.getContainerWidgets(t,An.a.Top):[],i=a.findIndex((t=>t.id===e.id));return[i>0,i<a.length-1]},Ra=(e,t,n,a,i,r)=>{const o=a||Sn.a.canUserModifyWidgets(e,null==t?void 0:t.roomId),s=Nn.a.instance.getMessagingForUid(Sn.a.getWidgetUid(n));return Sa(n)||_a(n,o)||Ca(e,null==t?void 0:t.roomId,n,a)||Oa(o,r)||xa(s)||ka(n,t,i).some(Boolean)},ja=e=>{let{onFinished:t,app:n,userWidget:a,onDeleteClick:i,onEditClick:s,showUnpin:l}=e,c=ge()(e,wa);const d=Object(r.useContext)(I.a),{room:u,roomId:m}=Object(r.useContext)(In.b),h=Nn.a.instance.getMessagingForUid(Sn.a.getWidgetUid(n)),p=a||Sn.a.canUserModifyWidgets(d,m);let g,f,y,E,w;if(m&&Sa(n)){const e=async()=>{try{await Fn(d,h,m)}catch(e){on.a.error("Failed to start livestream",e);const t=e instanceof Error?e.message:Object(N.b)("Unable to start audio streaming.");H.b.createDialog(Dn.a,{title:Object(N.b)("Failed to start livestream"),description:t})}t()};g=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Start audio stream")})}if(_a(n,p)){const e=()=>{s?s():u&&Sn.a.editWidget(u,n),t()};f=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Edit")})}if(xa(h)){const e=()=>{null==h||h.takeScreenshot().then((e=>{b.a.dispatch({action:"picture_snapshot",file:e.screenshot})})).catch((e=>{on.a.error("Failed to take screenshot: ",e)})),t()};y=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Take a picture")})}if(Oa(p,i)){const e=()=>{i?i():m&&H.b.createDialog(nt.a,{title:Object(N.b)("Delete Widget"),description:Object(N.b)("Deleting a widget removes it for all users in this room. Are you sure you want to delete this widget?"),button:Object(N.b)("Delete widget"),onFinished:e=>{e&&Sn.a.setRoomWidget(d,m,n.id)}}),t()};E=o.a.createElement(de.b,{onClick:e,label:a?Object(N.b)("Remove"):Object(N.b)("Remove for everyone")})}if(Ca(d,m,n,a)){const e={approved:void 0};if(Bn.a.instance.invoke(Pn.WidgetLifecycle.PreLoadRequest,e,new ya(n)),!e.approved){const e=()=>{const e=Object(On.b)(n)?n.eventId:void 0;on.a.info("Revoking permission for widget to load: "+e);const a=v.b.getValue("allowedWidgets",m);void 0!==e&&(a[e]=!1);const i=v.b.firstSupportedLevel("allowedWidgets");if(!i)throw new Error("level must be defined");v.b.setValue("allowedWidgets",null!=m?m:null,i,a).catch((e=>{on.a.error(e)})),t()};w=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Revoke permissions")})}}const[S,_]=ka(n,u,l);let C,O;if(S){const e=()=>{if(!u)throw new Error("room must be defined");An.d.instance.moveWithinContainer(u,An.a.Top,n,-1),t()};C=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Move left")})}if(_){const e=()=>{if(!u)throw new Error("room must be defined");An.d.instance.moveWithinContainer(u,An.a.Top,n,1),t()};O=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Move right")})}return o.a.createElement(de.e,ee()({},c,{chevronFace:le.a.None,onFinished:t}),o.a.createElement(de.c,null,g,f,w,E,y,C,O))},Ia=(e,t=250)=>{const[n,a]=Object(r.useState)(e.getJoinedMemberCount());return Object(ae.c)(e.currentState,l.RoomStateEvent.Update,Object(R.throttle)((()=>{a(e.getJoinedMemberCount())}),t,{leading:!0,trailing:!0})),n},Ta=e=>{const[t,n]=Object(r.useState)(e.getMyMembership());return Object(ae.c)(e,l.RoomEvent.MyMembership,(()=>{n(e.getMyMembership())})),t};var Pa=n(1355),Na=n(1396),Da=n(1397),Ma=n(38),Aa=n(32);class La{static isPinnable(e){return!!e&&(!!this.pinnableEventTypes.includes(e.getType())&&!e.isRedacted())}}i()(La,"pinnableEventTypes",[l.EventType.RoomMessage,Aa.e.name,Aa.e.altName]);var Ua=n(147),Fa=n(811),Ba=n(116),Va=n(71),Wa=n(230);class za extends o.a.Component{constructor(...e){super(...e),i()(this,"context",void 0),i()(this,"onTileClicked",(()=>{b.a.dispatch({action:F.a.ViewRoom,event_id:this.props.event.getId(),highlighted:!0,room_id:this.props.event.getRoomId(),metricsTrigger:void 0})})),i()(this,"relations",new Map),i()(this,"getRelationsForEvent",((e,t,n)=>{var a;if(e===this.props.event.getId())return null===(a=this.relations.get(t))||void 0===a?void 0:a.get(n)}))}render(){var e;const t=this.props.event.getSender();if(!t)throw new Error("Pinned event unexpectedly has no sender");let n;return this.props.onUnpinClicked&&(n=o.a.createElement($.a,{onClick:this.props.onUnpinClicked,className:"mx_PinnedEventTile_unpinButton",title:Object(N.b)("Unpin")})),o.a.createElement("div",{className:"mx_PinnedEventTile"},o.a.createElement(Ba.b,{className:"mx_PinnedEventTile_senderAvatar",member:this.props.event.sender,width:24,height:24,fallbackUserId:t}),o.a.createElement("span",{className:"mx_PinnedEventTile_sender "+Object(Wa.f)(t)},(null===(e=this.props.event.sender)||void 0===e?void 0:e.name)||t),n,o.a.createElement("div",{className:"mx_PinnedEventTile_message"},o.a.createElement(Fa.a,{mxEvent:this.props.event,getRelationsForEvent:this.getRelationsForEvent,className:"mx_PinnedEventTile_body",maxImageHeight:150,onHeightChanged:()=>{},permalinkCreator:this.props.permalinkCreator,replacingEventId:this.props.event.replacingEventId()})),o.a.createElement("div",{className:"mx_PinnedEventTile_footer"},o.a.createElement("span",{className:"mx_MessageTimestamp mx_PinnedEventTile_timestamp"},Object(Va.a)(new Date(this.props.event.getTs()))),o.a.createElement(K.a,{onClick:this.onTileClicked,kind:"link"},Object(N.b)("View message"))))}}i()(za,"contextType",I.a);var Ha=n(338),Ga=n(612);function Ka(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function qa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ka(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ka(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $a(e){var t,n,a;return null!==(t=null==e||null===(n=e.currentState.getStateEvents(l.EventType.RoomPinnedEvents,""))||void 0===n||null===(a=n.getContent())||void 0===a?void 0:a.pinned)&&void 0!==t?t:[]}const Ya=e=>{const[t,n]=Object(r.useState)($a(e)),a=Object(r.useCallback)((t=>{t&&t.getType()!==l.EventType.RoomPinnedEvents||n($a(e))}),[e]);return Object(ae.c)(null==e?void 0:e.currentState,l.RoomStateEvent.Events,a),Object(r.useEffect)((()=>(n($a(e)),()=>{n([])})),[e]),t};function Ja(e){var t,n,a;return new Set(null!==(t=null==e||null===(n=e.getAccountData(Ga.a))||void 0===n||null===(a=n.getContent())||void 0===a?void 0:a.event_ids)&&void 0!==t?t:[])}const Qa=e=>{const[t,n]=Object(r.useState)(new Set),a=Object(r.useCallback)((t=>{t&&t.getType()!==Ga.a||n(Ja(e))}),[e]);return Object(ae.c)(e,l.RoomEvent.AccountData,a),Object(r.useEffect)((()=>(n(Ja(e)),()=>{n(new Set)})),[e]),t};var Xa=({room:e,onClose:t,permalinkCreator:n})=>{const a=Object(r.useContext)(I.a),i=Object(r.useContext)(In.b),s=Object(Ha.a)(e,(e=>e.mayClientSendStateEvent(l.EventType.RoomPinnedEvents,a))),c=Ya(e),d=Qa(e);Object(r.useEffect)((()=>{if(!a||a.isGuest())return;c.filter((e=>!d.has(e))).length>0&&a.setRoomAccountData(e.roomId,Ga.a,{event_ids:c})}),[a,e.roomId,c,d]);const u=Object(Ua.a)((()=>{const t=c.map((async t=>{var n;const i=e.getUnfilteredTimelineSet(),r=null==i||null===(n=i.getTimelineForEvent(t))||void 0===n?void 0:n.getEvents().find((e=>e.getId()===t));if(r)return La.isPinnable(r)?r:null;try{const[n,{events:[i]}]=await Promise.all([a.fetchRoomEvent(e.roomId,t),a.relations(e.roomId,t,l.RelationType.Replace,null,{limit:1})]),r=new l.MatrixEvent(n);r.isEncrypted()&&await a.decryptEventIfNeeded(r),await e.processPollEvents([r]);const o=r.getSender();if(o&&La.isPinnable(r))return r.sender=e.getMember(o),i&&r.makeReplaced(i),r}catch(n){on.a.error("Error looking up pinned event "+t+" in room "+e.roomId),on.a.error(n)}return null}));return Promise.all(t)}),[a,e,c],null);let m;if(c.length)if(null!=u&&u.length){const t=async t=>{var n;const i=e.currentState.getStateEvents(l.EventType.RoomPinnedEvents,"");if(null!=i&&null!==(n=i.getContent())&&void 0!==n&&n.pinned){const n=i.getContent().pinned,r=n.indexOf(t.getId());-1!==r&&(n.splice(r,1),await a.sendStateEvent(e.roomId,l.EventType.RoomPinnedEvents,{pinned:n},""))}};m=Object(Wn.m)(u).reverse().map((e=>o.a.createElement(za,{key:e.getId(),event:e,onUnpinClicked:s?()=>t(e):void 0,permalinkCreator:n})))}else m=o.a.createElement(Ma.a,null);else m=o.a.createElement("div",{className:"mx_PinnedMessagesCard_empty_wrapper"},o.a.createElement("div",{className:"mx_PinnedMessagesCard_empty"},o.a.createElement("div",{className:"mx_MessageActionBar mx_PinnedMessagesCard_MessageActionBar"},o.a.createElement("div",{className:"mx_MessageActionBar_iconButton"},o.a.createElement(Na.a,null)),o.a.createElement("div",{className:"mx_MessageActionBar_iconButton"},o.a.createElement(Da.a,null)),o.a.createElement("div",{className:"mx_MessageActionBar_iconButton mx_MessageActionBar_optionsButton"},o.a.createElement(Pa.a,null))),o.a.createElement(Yt.a,{size:"4",className:"mx_PinnedMessagesCard_empty_header"},Object(N.b)("Nothing pinned, yet")),Object(N.b)("If you have permissions, open the menu on any message and select <b>Pin</b> to stick them here.",{},{b:e=>o.a.createElement("b",null,e)})));return o.a.createElement(En.b,{header:o.a.createElement("div",{className:"mx_BaseCard_header_title"},o.a.createElement(Yt.a,{size:"4",className:"mx_BaseCard_header_title_heading"},Object(N.b)("Pinned messages"))),className:"mx_PinnedMessagesCard",onClose:t},o.a.createElement(In.b.Provider,{value:qa(qa({},i),{},{timelineRenderingType:In.a.Pinned})},m))},Za=n(635),ei=n(280),ti=n(1417),ni=n(229),ai=n(1532),ii=n(1363),ri=n(633);class oi extends ii.a{constructor(e,t,n,a){super(e,t,n,a),i()(this,"totalSize",0),i()(this,"messages",[])}get destinationFileName(){return this.makeFileNameNoExtension()+".json"}createJSONString(){var e,t,n,a,i,r,o;const s=Object(Va.g)(new Date),c=null===(e=this.room.currentState.getStateEvents(l.EventType.RoomCreate,""))||void 0===e?void 0:e.getSender(),d=c&&(null===(t=this.room)||void 0===t||null===(n=t.getMember(c))||void 0===n?void 0:n.rawDisplayName)||c,u=(null===(a=this.room.currentState.getStateEvents(l.EventType.RoomTopic,""))||void 0===a||null===(i=a.getContent())||void 0===i?void 0:i.topic)||"",m=this.room.client.getUserId(),h=(null===(r=this.room)||void 0===r||null===(o=r.getMember(m))||void 0===o?void 0:o.rawDisplayName)||m,p={room_name:this.room.name,room_creator:d,topic:u,export_date:s,exported_by:h,messages:this.messages};return JSON.stringify(p,null,2)}async getJSONString(e){if(this.exportOptions.attachmentsIncluded&&this.isAttachment(e))try{const t=await this.getMediaBlob(e);if(this.totalSize+t.size<this.exportOptions.maxSize){this.totalSize+=t.size;const n=this.getFilePath(e);this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1),this.addFile(n,t)}}catch(e){on.a.log("Error fetching file: "+e)}const t=e.toJSON();return e.isEncrypted()?t.decrypted:t}async createOutput(e){for(let t=0;t<e.length;t++){const n=e[t];if(this.updateProgress(Object(N.b)("Processing event %(number)s out of %(total)s",{number:t+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();Object(ri.c)(n,this.room.client,!1)&&this.messages.push(await this.getJSONString(n))}return this.createJSONString()}async export(){on.a.info("Starting export process..."),on.a.info("Fetching events...");const e=performance.now(),t=await this.getRequiredEvents(),n=performance.now();on.a.log(`Fetched ${t.length} events in ${(n-e)/1e3}s`),on.a.info("Creating output...");const a=await this.createOutput(t);if(this.files.length)this.addFile("export.json",new Blob([a])),await this.downloadZIP();else{const e=this.destinationFileName;this.downloadPlainText(e,a)}const i=performance.now();this.cancelled?on.a.info("Export cancelled successfully"):(on.a.info("Export successful!"),on.a.log(`Exported ${t.length} events in ${(i-e)/1e3} seconds`)),this.cleanUp()}}var si=n(202);class li extends ii.a{constructor(e,t,n,a){super(e,t,n,a),i()(this,"totalSize",void 0),i()(this,"mediaOmitText",void 0),i()(this,"textForReplyEvent",(e=>{const t=/> <(.*?)>(.*?)\n\n(.*)/s.exec(e.body);if(!t)return e.body;let n;const a=t[1],i=t[3];n=t[2].substring(1);const r=n.split("\n").filter((e=>!/^\s*$/.test(e)));return r.length>0?(n=r[0].substring(0,32),r[0].length>32&&(n+="..."),n=` "${n}"`):n="",`<${a}${n}> ${i}`})),i()(this,"plainTextForEvent",(async e=>{const t=e.sender&&e.sender.name?e.sender.name:e.getSender();let n="";if(this.isAttachment(e))if(this.exportOptions.attachmentsIncluded)try{const t=await this.getMediaBlob(e);if(this.totalSize+t.size>this.exportOptions.maxSize)n=` (${this.mediaOmitText})`;else{this.totalSize+=t.size;const a=this.getFilePath(e);n=" ("+Object(N.b)("File Attached")+")",this.addFile(a,t),this.totalSize==this.exportOptions.maxSize&&(this.exportOptions.attachmentsIncluded=!1)}}catch(e){n=" ("+Object(N.b)("Error fetching file")+")",on.a.log("Error fetching file "+e)}else n=` (${this.mediaOmitText})`;return this.isReply(e)?t+": "+this.textForReplyEvent(e.getContent())+n:Object(si.b)(e,this.room.client)+n})),this.totalSize=0,this.mediaOmitText=this.exportOptions.attachmentsIncluded?Object(N.b)("Media omitted - file size limit exceeded"):Object(N.b)("Media omitted")}get destinationFileName(){return this.makeFileNameNoExtension()+".txt"}async createOutput(e){let t="";for(let n=0;n<e.length;n++){const a=e[n];if(this.updateProgress(Object(N.b)("Processing event %(number)s out of %(total)s",{number:n+1,total:e.length}),!1,!0),this.cancelled)return this.cleanUp();if(!Object(ri.c)(a,this.room.client,!1))continue;const i=await this.plainTextForEvent(a);t+=i&&`${Object(Va.d)(new Date(a.getTs()),v.b.getValue("showTwelveHourTimestamps"))} - ${i}\n`}return t}async export(){this.updateProgress(Object(N.b)("Starting export process…")),this.updateProgress(Object(N.b)("Fetching events…"));const e=performance.now(),t=await this.getRequiredEvents(),n=performance.now();on.a.log(`Fetched ${t.length} events in ${(n-e)/1e3}s`),this.updateProgress(Object(N.b)("Creating output…"));const a=await this.createOutput(t);if(this.files.length)this.addFile("export.txt",new Blob([a])),await this.downloadZIP();else{const e=this.destinationFileName;this.downloadPlainText(e,a)}const i=performance.now();this.cancelled?on.a.info("Export cancelled successfully"):(on.a.info("Export successful!"),on.a.log(`Exported ${t.length} events in ${(i-e)/1e3} seconds`)),this.cleanUp()}}var ci=()=>({});const di=(e,t)=>n=>"number"==typeof n&&!(isNaN(n)||e>n||n>t);var ui=({room:e,onFinished:t})=>{const{exportFormat:n,exportType:a,includeAttachments:i,numberOfMessages:s,sizeLimit:l,setExportFormat:c,setExportType:d,setNumberOfMessages:u,setSizeLimit:m,setAttachments:h}=(()=>{var e,t,n,a,i;const o=ci(),[s,l]=Object(r.useState)(null!==(e=o.format)&&void 0!==e?e:ti.a.Html),[c,d]=Object(r.useState)(null!==(t=o.range)&&void 0!==t?t:ti.b.Timeline),[u,m]=Object(r.useState)(null!==(n=o.includeAttachments)&&void 0!==n&&n),[h,p]=Object(r.useState)(null!==(a=o.numberOfMessages)&&void 0!==a?a:100),[g,b]=Object(r.useState)(null!==(i=o.sizeMb)&&void 0!==i?i:8);return{exportFormat:s,exportType:c,includeAttachments:u,numberOfMessages:h,sizeLimit:g,setExportFormat:o.format?void 0:l,setExportType:o.range?void 0:d,setNumberOfMessages:o.numberOfMessages?void 0:p,setSizeLimit:o.sizeMb?void 0:b,setAttachments:void 0===o.includeAttachments?m:void 0}})(),[p,g]=Object(r.useState)(!1),b=Object(r.useRef)(null),v=Object(r.useRef)(null),[f,y]=Object(r.useState)(Object(N.b)("Processing…")),[E,w]=Object(r.useState)(!1),[S,_]=Object(r.useState)(!1),[C,O]=Object(r.useState)(!1),[x,k]=((e,t)=>{const[n,a]=Object(r.useState)(e);return[n,e=>{a(e),t(e)}]})(null,(async e=>{await(null==e?void 0:e.export().then((()=>{S||O(!0)})))})),R=async()=>{var t;if(!m||await(null===(t=b.current)||void 0===t?void 0:t.validate({focused:!1}))){if(a===ti.b.LastNMessages){var r;var o;if(!await(null===(r=v.current)||void 0===r?void 0:r.validate({focused:!1})))return void(null===(o=v.current)||void 0===o||o.validate({focused:!0}))}g(!0),await(async()=>{const t={numberOfMessages:s,attachmentsIncluded:i,maxSize:1024*l*1024};switch(n){case ti.a.Html:k(new ai.a(e,ti.b[a],t,y));break;case ti.a.Json:k(new oi(e,ti.b[a],t,y));break;case ti.a.PlainText:k(new li(e,ti.b[a],t,y));break;default:return void on.a.error("Unknown export format")}})()}else{var c;null===(c=b.current)||void 0===c||c.validate({focused:!0})}},j=Object(ni.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(N.b)("Enter a number between %(min)s and %(max)s",{min:1,max:2e3})},{key:"number",test:({value:e})=>{const t=parseInt(e,10);return di(1,2e3)(t)},invalid:()=>Object(N.b)("Size can only be a number between %(min)s MB and %(max)s MB",{min:1,max:2e3})}]}),I=async e=>await j(e),T=Object(ni.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(N.b)("Enter a number between %(min)s and %(max)s",{min:1,max:10**8})},{key:"number",test:({value:e})=>{const t=parseInt(e,10);return di(1,10**8)(t)},invalid:()=>Object(N.b)("Number of messages can only be a number between %(min)s and %(max)s",{min:1,max:10**8})}]}),P=async e=>await T(e),D=async()=>{p?w(!0):t(!1)},M=async()=>{await(null==x?void 0:x.cancelExport()),_(!0),g(!1),k(null)},A=Object.values(ti.a).map((e=>({value:e,label:Object(ti.c)(e)}))),L=Object.values(ti.b).map((e=>o.a.createElement("option",{key:ti.b[e],value:e},Object(ti.d)(e))));let U;a===ti.b.LastNMessages&&u&&(U=o.a.createElement(at.a,{id:"message-count",element:"input",type:"number",value:s.toString(),ref:v,onValidate:P,label:Object(N.b)("Number of messages"),onChange:e=>{u(parseInt(e.target.value))}}));const F=o.a.createElement("span",null,Object(N.b)("MB"));return S?o.a.createElement(ot.a,{title:Object(N.b)("Export Cancelled"),description:Object(N.b)("The export was cancelled successfully"),hasCloseButton:!0,onFinished:t}):C?o.a.createElement(ot.a,{title:Object(N.b)("Export Successful"),description:Object(N.b)("Your export was successful. Find it in your Downloads folder."),hasCloseButton:!0,onFinished:t}):E?o.a.createElement(Gn.a,{title:Object(N.b)("Warning"),className:"mx_ExportDialog",contentId:"mx_Dialog_content",onFinished:t,fixedWidth:!0},o.a.createElement("p",null,Object(N.b)("Are you sure you want to stop exporting your data? If you do, you'll need to start over.")),o.a.createElement(Kn.a,{primaryButton:Object(N.b)("Stop"),primaryButtonClass:"danger",hasCancel:!0,cancelButton:Object(N.b)("Continue"),onCancel:()=>w(!1),onPrimaryButtonClick:M})):o.a.createElement(Gn.a,{title:p?Object(N.b)("Exporting your data"):Object(N.b)("Export Chat"),className:`mx_ExportDialog ${p&&"mx_ExportDialog_Exporting"}`,contentId:"mx_Dialog_content",hasCancel:!0,onFinished:t,fixedWidth:!0},p?null:o.a.createElement("p",null,Object(N.b)("Select from the options below to export chats from your timeline")),o.a.createElement("div",{className:"mx_ExportDialog_options"},!!c&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"mx_ExportDialog_subheading"},Object(N.b)("Format")),o.a.createElement(ei.a,{name:"exportFormat",value:n,onChange:e=>c(ti.a[e]),definitions:A})),!!d&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"mx_ExportDialog_subheading"},Object(N.b)("Messages")),o.a.createElement(at.a,{id:"export-type",element:"select",value:a,onChange:e=>{d(ti.b[e.target.value])}},L),U),m&&o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"mx_ExportDialog_subheading"},Object(N.b)("Size Limit")),o.a.createElement(at.a,{id:"size-limit",type:"number",autoComplete:"off",onValidate:I,element:"input",ref:b,value:l.toString(),postfixComponent:F,onChange:e=>m(parseInt(e.target.value))})),h&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Ne.b,{className:"mx_ExportDialog_attachments-checkbox",id:"include-attachments",checked:i,onChange:e=>h(e.target.checked)},Object(N.b)("Include Attachments")))),p?o.a.createElement("div",{"data-testid":"export-progress",className:"mx_ExportDialog_progress"},o.a.createElement(Ma.a,{w:24,h:24}),o.a.createElement("p",null,f),o.a.createElement(Kn.a,{primaryButton:Object(N.b)("Cancel"),primaryButtonClass:"danger",hasCancel:!1,onPrimaryButtonClick:D})):o.a.createElement(Kn.a,{primaryButton:Object(N.b)("Export"),onPrimaryButtonClick:R,onCancel:()=>t(!1)}))},mi=n(812);const hi=({room:e,matrixClient:t,permalinkCreator:n,onFinished:a})=>o.a.createElement(Gn.a,{onFinished:a},o.a.createElement(mi.a,{room:e,matrixClient:t,permalinkCreator:n,onFinished:a})),pi=["children","className","onClick"],gi=e=>{let{children:t,className:n,onClick:a}=e,i=ge()(e,pi);return o.a.createElement(K.a,ee()({},i,{className:d()("mx_BaseCard_Button mx_RoomSummaryCard_Button",n),onClick:a}),t)},bi=e=>{const[t,n]=Object(r.useState)((()=>On.a.instance.getApps(e.roomId))),a=Object(r.useCallback)((()=>{n([...On.a.instance.getApps(e.roomId)])}),[e]);return Object(r.useEffect)(a,[e,a]),Object(ae.a)(On.a.instance,e.roomId,a),Object(ae.a)(An.d.instance,An.d.emissionForRoom(e),a),t},vi=({app:e,room:t})=>{const n=Sn.a.getWidgetName(e),a=Sn.a.getWidgetDataTitle(e),i=a&&" - "+a,[s,l]=Object(r.useState)();Object(r.useEffect)((()=>{l(Sn.a.canUserModifyWidgets(t.client,t.roomId))}),[t.client,t.roomId]);const c=An.d.instance.isInContainer(t,e,An.a.Top),u=c?()=>{An.d.instance.moveToContainer(t,e,An.a.Right)}:()=>{An.d.instance.moveToContainer(t,e,An.a.Top)},[m,h,p,g]=Object(le.q)();let b;if(m){var v,f,y;const t=null===(v=h.current)||void 0===v?void 0:v.getBoundingClientRect(),n=null!==(f=null==t?void 0:t.right)&&void 0!==f?f:0,a=null!==(y=null==t?void 0:t.top)&&void 0!==y?y:0;b=o.a.createElement(ja,{chevronFace:le.a.None,right:X.b.instance.windowWidth-n,bottom:X.b.instance.windowHeight-a,onFinished:g,app:e})}const E=!c&&!An.d.instance.canAddToContainer(t,An.a.Top);let w;w=E?Object(N.b)("You can only pin up to %(count)s widgets",{count:An.b}):c?Object(N.b)("Unpin"):Object(N.b)("Pin");const S=An.d.instance.isInContainer(t,e,An.a.Center),_=S?()=>{An.d.instance.moveToContainer(t,e,An.a.Right)}:()=>{An.d.instance.moveToContainer(t,e,An.a.Center)},C=S?Object(N.b)("Close"):Object(N.b)("Maximise");let O="";c?O=Object(N.b)("Unpin this widget to view it in this panel"):S&&(O=Object(N.b)("Close this widget to view it in this panel"));const x=d()("mx_BaseCard_Button mx_RoomSummaryCard_Button",{mx_RoomSummaryCard_Button_pinned:c,mx_RoomSummaryCard_Button_maximised:S});return o.a.createElement("div",{className:x,ref:h},o.a.createElement($.a,{className:"mx_RoomSummaryCard_icon_app",onClick:()=>{fn.a.instance.pushCard({phase:vn.a.Widget,state:{widgetId:e.id}})},title:O,forceHide:!(c||S),disabled:c||S},o.a.createElement(Rn,{app:e}),o.a.createElement("span",null,n),i),s&&o.a.createElement(le.c,{className:"mx_RoomSummaryCard_app_options",isExpanded:m,onClick:p,title:Object(N.b)("Options")}),o.a.createElement($.a,{className:"mx_RoomSummaryCard_app_pinToggle",onClick:u,title:w,disabled:E}),o.a.createElement($.a,{className:"mx_RoomSummaryCard_app_maximiseToggle",onClick:_,title:C}),b)},fi=({room:e})=>{const t=bi(e),n=Object(r.useMemo)((()=>t.filter((e=>void 0!==e.eventId))),[t]);let a=null;return n.length>0&&An.d.instance.canCopyLayoutToRoom(e)&&(a=o.a.createElement(K.a,{kind:"link",onClick:()=>An.d.instance.copyLayoutToRoom(e)},Object(N.b)("Set my room layout for everyone"))),o.a.createElement(En.a,{className:"mx_RoomSummaryCard_appsGroup",title:Object(N.b)("Widgets")},n.map((t=>o.a.createElement(vi,{key:t.id,app:t,room:e}))),a,o.a.createElement(K.a,{kind:"link",onClick:()=>{const t=_n.a.sharedInstance();var n;t.hasManager()?null===(n=t.getPrimaryManager())||void 0===n||n.open(e):t.openNoManagerDialog()}},n.length>0?Object(N.b)("Edit widgets, bridges & bots"):Object(N.b)("Add widgets, bridges & bots")))},yi=e=>{fn.a.instance.pushCard({phase:vn.a.RoomMemberList},!0),re.b.trackInteraction("WebRightPanelRoomInfoPeopleButton",e)},Ei=()=>{fn.a.instance.pushCard({phase:vn.a.FilePanel},!0)},wi=()=>{fn.a.instance.pushCard({phase:vn.a.PinnedMessages},!0)},Si=e=>{b.a.dispatch({action:"open_room_settings"}),re.b.trackInteraction("WebRightPanelRoomInfoSettingsButton",e)};var _i,Ci=({room:e,permalinkCreator:t,onClose:n})=>{var a;const i=Object(r.useContext)(I.a),s=Object(yn.a)(i,e),l=Object(r.useContext)(In.b).e2eStatus,c=Object(ie.a)("feature_video_rooms"),u=Object(ie.a)("feature_element_call_video_rooms"),m=c&&(e.isElementVideoRoom()||u&&e.isCallRoom()),h=e.getCanonicalAlias()||e.getAltAliases()[0]||"",p=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_RoomSummaryCard_avatar",role:"presentation"},o.a.createElement(fe.a,{room:e,height:54,width:54,viewAvatarOnClick:!0}),o.a.createElement(Cn.a,{tooltip:s?Object(N.b)("Encrypted"):Object(N.b)("Not encrypted"),class:d()("mx_RoomSummaryCard_e2ee",{mx_RoomSummaryCard_e2ee_normal:s,mx_RoomSummaryCard_e2ee_warning:s&&l===jn.a.Warning,mx_RoomSummaryCard_e2ee_verified:s&&l===jn.a.Verified})})),o.a.createElement(Za.a,{room:e},(e=>o.a.createElement("h1",{className:"mx_RoomSummaryCard_roomName",title:e},e))),o.a.createElement("div",{className:"mx_RoomSummaryCard_alias",title:h},h)),g=Ia(e),b=Object(ie.a)("feature_pinning"),f=null===(a=Ya(b?e:void 0))||void 0===a?void 0:a.length;return o.a.createElement(En.b,{header:p,className:"mx_RoomSummaryCard",onClose:n},o.a.createElement(En.a,{title:Object(N.b)("About"),className:"mx_RoomSummaryCard_aboutGroup"},o.a.createElement(gi,{className:"mx_RoomSummaryCard_icon_people",onClick:yi},Object(N.b)("People"),o.a.createElement("span",{className:"mx_BaseCard_Button_sublabel"},g)),!m&&o.a.createElement(gi,{className:"mx_RoomSummaryCard_icon_files",onClick:Ei},Object(N.b)("Files")),!m&&o.a.createElement(gi,{className:"mx_RoomSummaryCard_icon_poll",onClick:()=>{H.b.createDialog(hi,{room:e,matrixClient:i,permalinkCreator:t})}},Object(N.b)("Poll history")),b&&!m&&o.a.createElement(gi,{className:"mx_RoomSummaryCard_icon_pins",onClick:wi},Object(N.b)("Pinned"),f>0&&o.a.createElement("span",{className:"mx_BaseCard_Button_sublabel"},f)),!m&&o.a.createElement(gi,{className:"mx_RoomSummaryCard_icon_export",onClick:async()=>{H.b.createDialog(ui,{room:e})}},Object(N.b)("Export chat")),o.a.createElement(gi,{"data-testid":"shareRoomButton",className:"mx_RoomSummaryCard_icon_share",onClick:()=>{H.b.createDialog(wn.a,{target:e})}},Object(N.b)("Share room")),o.a.createElement(gi,{className:"mx_RoomSummaryCard_icon_settings",onClick:Si},Object(N.b)("Room settings"))),v.b.getValue(oe.b.Widgets)&&!m&&Object(te.a)(oe.a.AddIntegrations)&&o.a.createElement(fi,{room:e}))},Oi=n(110);function xi(){return xi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},xi.apply(this,arguments)}function ki(e){return r.createElement("svg",xi({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14",role:"presentation","aria-hidden":!0},e),_i||(_i=r.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",transform:"translate(1 1)"},r.createElement("circle",{cx:6,cy:6,r:6}),r.createElement("path",{d:"M4.254 4.2a1.8 1.8 0 013.498.6c0 1.2-1.8 1.8-1.8 1.8M6 8.991"}))))}function Ri(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}class ji extends o.a.Component{constructor(e){super(e);const t=this.parseWidgetUrl(),n=tt.a.safeGet().getRoom(this.props.roomId);let a=null;n&&(a=n.getMember(this.props.creatorUserId)),this.state=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ri(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ri(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({roomMember:a},t)}parseWidgetUrl(){const e=Object(Oi.c)(this.props.url);if(Sn.a.isScalarUrl(this.props.url)&&e.searchParams.has("url")){const t=Object(Oi.c)(e.searchParams.get("url"));return{widgetDomain:t.host||t.hostname,isWrapped:!0}}return{widgetDomain:e.host||e.hostname,isWrapped:!1}}render(){const e=it.b.get().brand,t=this.state.roomMember?this.state.roomMember.name:this.props.creatorUserId,n=t===this.props.creatorUserId?null:this.props.creatorUserId,a=this.state.roomMember?o.a.createElement(Ba.b,{member:this.state.roomMember,width:38,height:38}):o.a.createElement(yt.a,{name:this.props.creatorUserId,width:38,height:38}),i=o.a.createElement("div",null,Object(N.b)("Any of the following data may be shared:"),o.a.createElement("ul",null,o.a.createElement("li",null,Object(N.b)("Your display name")),o.a.createElement("li",null,Object(N.b)("Your profile picture URL")),o.a.createElement("li",null,Object(N.b)("Your user ID")),o.a.createElement("li",null,Object(N.b)("Your device ID")),o.a.createElement("li",null,Object(N.b)("Your theme")),o.a.createElement("li",null,Object(N.b)("Your language")),o.a.createElement("li",null,Object(N.b)("%(brand)s URL",{brand:e})),o.a.createElement("li",null,Object(N.b)("Room ID")),o.a.createElement("li",null,Object(N.b)("Widget ID")))),r=o.a.createElement(Cn.a,{tooltip:i,tooltipClass:"mx_Tooltip--appPermission mx_Tooltip--appPermission--dark",class:"mx_TextWithTooltip_target--helpIcon"},o.a.createElement(ki,{className:"mx_Icon mx_Icon_12"})),s=this.state.isWrapped?Object(N.b)("Using this widget may share data <helpIcon /> with %(widgetDomain)s & your integration manager.",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>r}):Object(N.b)("Using this widget may share data <helpIcon /> with %(widgetDomain)s.",{widgetDomain:this.state.widgetDomain},{helpIcon:()=>r}),l=this.props.isRoomEncrypted?Object(N.b)("Widgets do not use message encryption."):null;return o.a.createElement("div",{className:"mx_AppPermission"},o.a.createElement("div",{className:"mx_AppPermission_content"},o.a.createElement("div",{className:"mx_AppPermission_content_bolder"},Object(N.b)("Widget added by")),o.a.createElement("div",null,a,o.a.createElement(Yt.a,{size:"4"},t),o.a.createElement("div",null,n)),o.a.createElement("div",null,s),o.a.createElement("div",null,Object(N.b)("This widget may use cookies.")," ",l),o.a.createElement("div",null,o.a.createElement(K.a,{kind:"primary_sm",onClick:this.props.onPermissionGranted},Object(N.b)("Continue")))))}}i()(ji,"defaultProps",{onPermissionGranted:()=>{}});var Ii=e=>o.a.createElement("div",{className:"mx_AppWarning"},o.a.createElement("div",null,o.a.createElement("img",{src:n(476).default,alt:""})),o.a.createElement("div",null,o.a.createElement("span",null,e.errorMsg||"Error"))),Ti=n(103),Pi=n.n(Ti);function Ni(e){return document.getElementById(e)}class Di extends o.a.Component{constructor(e){super(e),i()(this,"resizeObserver",void 0),i()(this,"dispatcherRef",void 0),i()(this,"childContainer",void 0),i()(this,"child",void 0),i()(this,"collectChildContainer",(e=>{this.childContainer&&this.resizeObserver.unobserve(this.childContainer),this.childContainer=e,e&&this.resizeObserver.observe(e)})),i()(this,"collectChild",(e=>{this.child=e,this.updateChild()})),i()(this,"onAction",(e=>{"timeline_resize"===e.action?this.repositionChild():"logout"===e.action&&Di.destroyElement(this.props.persistKey)})),i()(this,"repositionChild",(()=>{this.updateChildPosition(this.child,this.childContainer)})),this.resizeObserver=new ResizeObserver(this.repositionChild),window.addEventListener("resize",this.repositionChild),this.dispatcherRef=b.a.register(this.onAction),this.props.moveRef&&(this.props.moveRef.current=this.repositionChild)}static destroyElement(e){const t=Ni("mx_persistedElement_"+e);t&&t.remove()}static isMounted(e){return Boolean(Ni("mx_persistedElement_"+e))}componentDidMount(){this.updateChild(),this.renderApp()}componentDidUpdate(){this.updateChild(),this.renderApp()}componentWillUnmount(){this.updateChildVisibility(this.child,!1),this.resizeObserver.disconnect(),window.removeEventListener("resize",this.repositionChild),b.a.unregister(this.dispatcherRef)}updateChild(){this.updateChildPosition(this.child,this.childContainer),this.updateChildVisibility(this.child,!0)}renderApp(){const e=o.a.createElement(I.a.Provider,{value:tt.a.safeGet()},o.a.createElement("div",{ref:this.collectChild,style:this.props.style},this.props.children));Pi.a.render(e,function(e){let t=Ni(e);return t||(t=document.createElement("div"),t.id=e,document.body.appendChild(t)),t}("mx_persistedElement_"+this.props.persistKey))}updateChildVisibility(e,t=!1){e&&(e.style.display=t?"block":"none")}updateChildPosition(e,t){if(!e||!t)return;const n=t.getBoundingClientRect();Object.assign(e.style,{zIndex:Object($n.u)(this.props.zIndex)?9:this.props.zIndex,position:"absolute",top:"0",left:"0",transform:`translateX(${n.left}px) translateY(${n.top}px)`,width:n.width+"px",height:n.height+"px"})}render(){return o.a.createElement("div",{ref:this.collectChildContainer})}}var Mi;function Ai(){return Ai=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ai.apply(this,arguments)}function Li(e){return r.createElement("svg",Ai({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14",role:"presentation","aria-hidden":!0},e),Mi||(Mi=r.createElement("path",{d:"M13.786 1.25l-3.351 3.351 1.16 1.161c.46.46.132 1.248-.518 1.248H7.733a.732.732 0 01-.73-.73V2.922c0-.65.789-.978 1.249-.518l1.16 1.16 3.351-3.35a.727.727 0 011.03 0 .743.743 0 01-.007 1.036zM1.25 13.786l3.351-3.351 1.161 1.16c.46.46 1.248.132 1.248-.518V7.733a.732.732 0 00-.73-.73H2.922c-.65 0-.978.789-.518 1.249l1.16 1.16-3.35 3.351a.727.727 0 000 1.03.743.743 0 001.036-.007z",fill:"currentColor"})))}var Ui;function Fi(){return Fi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Fi.apply(this,arguments)}function Bi(e){return r.createElement("svg",Fi({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 14",role:"presentation","aria-hidden":!0},e),Ui||(Ui=r.createElement("path",{d:"M14 4.348V.778A.78.78 0 0013.222 0h-3.57C8.96 0 8.61.84 9.1 1.33l1.237 1.237-7.778 7.777-1.237-1.236C.84 8.618 0 8.96 0 9.652v3.57c0 .428.35.778.778.778h3.57c.692 0 1.042-.84.552-1.33l-1.237-1.237 7.778-7.777 1.237 1.236c.482.49 1.322.148 1.322-.544z",fill:"currentColor"})))}var Vi,Wi=n(793);function zi(){return zi=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},zi.apply(this,arguments)}function Hi(e){return r.createElement("svg",zi({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 11 11",role:"presentation","aria-hidden":!0},e),Vi||(Vi=r.createElement("path",{d:"M8.5 6v3a1 1 0 01-1 1H2a1 1 0 01-1-1V3.5a1 1 0 011-1h3M7 1h3v3M4.5 6.5L10 1",fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})))}function Gi(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Gi(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Gi(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class qi extends o.a.Component{constructor(e,t){super(e),i()(this,"context",void 0),i()(this,"contextMenuButton",Object(r.createRef)()),i()(this,"iframe",void 0),i()(this,"allowedWidgetsWatchRef",void 0),i()(this,"persistKey",void 0),i()(this,"sgWidget",void 0),i()(this,"dispatcherRef",void 0),i()(this,"unmounted",!1),i()(this,"watchUserReady",(()=>{vt.a.instance.isProfileInfoFetched||vt.a.instance.once(ft.b,this.onUserReady)})),i()(this,"onUserReady",(()=>{this.setState({isUserProfileReady:!0})})),i()(this,"hasPermissionToLoad",(e=>{var t;if(this.usingLocalWidget())return!0;if(!e.room)return!0;const n={approved:void 0};if(Bn.a.instance.invoke(Pn.WidgetLifecycle.PreLoadRequest,n,new ya(this.props.app)),n.approved)return!0;const a=v.b.getValue("allowedWidgets",e.room.roomId);return Object(On.b)(e.app)&&void 0!==e.app.eventId&&null!==(t=a[e.app.eventId])&&void 0!==t&&t||e.userId===e.creatorUserId})),i()(this,"onMyMembership",((e,t)=>{var n;"leave"!==t&&"ban"!==t||e.roomId!==(null===(n=this.props.room)||void 0===n?void 0:n.roomId)||this.onUserLeftRoom()})),i()(this,"onAllowedWidgetsChange",(()=>{const e=this.hasPermissionToLoad(this.props);var t;this.state.hasPermissionToLoad&&!e&&(oa.b.instance.destroyPersistentWidget(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null),Di.destroyElement(this.persistKey),null===(t=this.sgWidget)||void 0===t||t.stopMessaging());this.setState({hasPermissionToLoad:e})})),i()(this,"iframeRefChange",(e=>{this.iframe=e,this.unmounted||(e?this.startMessaging():this.resetWidget(this.props))})),i()(this,"onWidgetPreparing",(()=>{this.setState({loading:!1})})),i()(this,"updateRequiresClient",(()=>{var e,t;this.setState({requiresClient:!(null===(e=this.sgWidget)||void 0===e||null===(t=e.widgetApi)||void 0===t||!t.hasCapability(Jn.a.RequiresClient))})})),i()(this,"onAction",(e=>{var t,n,a;switch(e.action){case"m.sticker":e.widgetId===this.props.app.id&&null!==(t=this.sgWidget)&&void 0!==t&&null!==(n=t.widgetApi)&&void 0!==n&&n.hasCapability(Tn.MatrixCapabilities.StickerSending)?(b.a.dispatch({action:"post_sticker_message",data:Ki(Ki({},e.data),{},{threadId:this.props.threadId})}),b.a.dispatch({action:"stickerpicker_close"})):on.a.warn("Ignoring sticker message. Invalid capability");break;case F.a.AfterLeaveRoom:e.room_id===(null===(a=this.props.room)||void 0===a?void 0:a.roomId)&&this.onUserLeftRoom()}})),i()(this,"grantWidgetPermission",(()=>{var e;const t=null===(e=this.props.room)||void 0===e?void 0:e.roomId,n=Object(On.b)(this.props.app)?this.props.app.eventId:void 0;on.a.info("Granting permission for widget to load: "+n);const a=v.b.getValue("allowedWidgets",t);void 0!==n&&(a[n]=!0);const i=v.b.firstSupportedLevel("allowedWidgets");v.b.setValue("allowedWidgets",null!=t?t:null,i,a).then((()=>{this.setState({hasPermissionToLoad:!0}),this.startWidget()})).catch((e=>{on.a.error(e)}))})),i()(this,"onPopoutWidgetClick",(()=>{var e;Mn.a.JITSI.matches(this.props.app.type)&&this.reload(),Object.assign(document.createElement("a"),{target:"_blank",href:null===(e=this.sgWidget)||void 0===e?void 0:e.popoutUrl,rel:"noreferrer noopener"}).click()})),i()(this,"onToggleMaximisedClick",(()=>{if(!this.props.room)return;const e=An.d.instance.isInContainer(this.props.room,this.props.app,An.a.Center)?An.a.Top:An.a.Center;An.d.instance.moveToContainer(this.props.room,this.props.app,e)})),i()(this,"onMinimiseClicked",(()=>{this.props.room&&An.d.instance.moveToContainer(this.props.room,this.props.app,An.a.Right)})),i()(this,"onContextMenuClick",(()=>{this.setState({menuDisplayed:!0})})),i()(this,"closeContextMenu",(()=>{this.setState({menuDisplayed:!1})})),this.context=t,this.props.miniMode||oa.b.instance.dockWidget(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null),this.persistKey="widget_"+Sn.a.getWidgetUid(this.props.app);try{this.sgWidget=new Ea(this.props),this.setupSgListeners()}catch(e){on.a.log("Failed to construct widget",e),this.sgWidget=null}this.state=this.getNewState(e)}onUserLeftRoom(){oa.b.instance.getWidgetPersistence(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null)&&(this.props.room&&Ze.b.instance.roomViewStore.getRoomId()!==this.props.room.roomId?this.endWidgetActions():Mn.a.JITSI.matches(this.props.app.type)?this.reload():oa.b.instance.destroyPersistentWidget(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null))}determineInitialRequiresClientState(){try{var e;const t=new ya(this.props.app),n=Nn.a.instance.getMessaging(t,null===(e=this.props.room)||void 0===e?void 0:e.roomId);if(n)return n.hasCapability(Jn.a.RequiresClient)}catch{}return!0}getNewState(e){return{initialising:!0,loading:this.props.waitForIframeLoad&&!Di.isMounted(this.persistKey),hasPermissionToLoad:this.hasPermissionToLoad(e),isUserProfileReady:vt.a.instance.isProfileInfoFetched,error:null,menuDisplayed:!1,requiresClient:this.determineInitialRequiresClientState(),hasContextMenuOptions:Ra(this.context,this.props.room,e.app,e.userWidget,!e.userWidget,e.onDeleteClick)}}isMixedContent(){const e=window.location.protocol,t=Object(Oi.c)(this.props.app.url).protocol;return"https:"===e&&"https:"!==t&&(on.a.warn("Refusing to load mixed-content app:",e,t,window.location,this.props.app.url),!0)}componentDidMount(){this.sgWidget&&this.state.hasPermissionToLoad&&this.startWidget(),this.watchUserReady(),this.props.room&&this.context.on(l.RoomEvent.MyMembership,this.onMyMembership),this.allowedWidgetsWatchRef=v.b.watchSetting("allowedWidgets",null,this.onAllowedWidgetsChange),this.dispatcherRef=b.a.register(this.onAction)}componentWillUnmount(){this.unmounted=!0,this.props.miniMode||oa.b.instance.undockWidget(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null),oa.b.instance.isLive(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null)||this.endWidgetActions(),this.dispatcherRef&&b.a.unregister(this.dispatcherRef),this.props.room&&this.context.off(l.RoomEvent.MyMembership,this.onMyMembership),this.allowedWidgetsWatchRef&&v.b.unwatchSetting(this.allowedWidgetsWatchRef),vt.a.instance.removeListener(ft.b,this.onUserReady)}setupSgListeners(){var e,t,n;null===(e=this.sgWidget)||void 0===e||e.on("preparing",this.onWidgetPreparing),null===(t=this.sgWidget)||void 0===t||t.on("error:preparing",this.updateRequiresClient),null===(n=this.sgWidget)||void 0===n||n.on("capabilitiesNotified",this.updateRequiresClient)}stopSgListeners(){this.sgWidget&&(this.sgWidget.off("preparing",this.onWidgetPreparing),this.sgWidget.off("error:preparing",this.updateRequiresClient),this.sgWidget.off("capabilitiesNotified",this.updateRequiresClient))}resetWidget(e){var t;null===(t=this.sgWidget)||void 0===t||t.stopMessaging(),this.stopSgListeners();try{this.sgWidget=new Ea(e),this.setupSgListeners(),this.startWidget()}catch(e){on.a.error("Failed to construct widget",e),this.sgWidget=null}}startWidget(){var e;null===(e=this.sgWidget)||void 0===e||e.prepare().then((()=>{this.unmounted||this.setState({initialising:!1})}))}startMessaging(){try{var e;null===(e=this.sgWidget)||void 0===e||e.startMessaging(this.iframe)}catch(e){on.a.error("Failed to start widget",e)}}componentDidUpdate(e){e.app.url!==this.props.app.url&&(this.getNewState(this.props),this.state.hasPermissionToLoad&&this.resetWidget(this.props))}async endWidgetActions(){var e;this.iframe&&(this.iframe.src="about:blank"),Mn.a.JITSI.matches(this.props.app.type)&&this.props.room&&V.b.instance.hangupCallApp(this.props.room.roomId),Di.destroyElement(this.persistKey),oa.b.instance.destroyPersistentWidget(this.props.app.id,Object(On.b)(this.props.app)?this.props.app.roomId:null),null===(e=this.sgWidget)||void 0===e||e.stopMessaging({forceDestroy:!0})}formatAppTileName(){let e="No name";return this.props.app.name&&this.props.app.name.trim()&&(e=this.props.app.name.trim()),e}usingLocalWidget(){return Mn.a.JITSI.matches(this.props.app.type)}getTileTitle(){const e=this.formatAppTileName(),t=o.a.createElement("span",null," - ");let n="";return this.props.widgetPageTitle&&this.props.widgetPageTitle!==this.formatAppTileName()&&(n=this.props.widgetPageTitle),o.a.createElement("span",null,o.a.createElement(Rn,{app:this.props.app}),o.a.createElement("b",null,e),o.a.createElement("span",null,n?t:"",n))}reload(){this.endWidgetActions().then((()=>{this.resetWidget(this.props),this.startMessaging(),this.iframe&&this.sgWidget&&(this.iframe.src=this.sgWidget.embedUrl)}))}render(){let e;const t=d()({mx_AppTileBody:!0,"mx_AppTileBody--large":!this.props.miniMode,"mx_AppTileBody--mini":this.props.miniMode,"mx_AppTileBody--loading":this.state.loading}),n={};this.props.pointerEvents&&(n.pointerEvents=this.props.pointerEvents);const a=o.a.createElement("div",{className:"mx_AppTileBody_fadeInSpinner"},o.a.createElement(Ma.a,{message:Object(N.b)("Loading…")})),i=Sn.a.getWidgetName(this.props.app);if(null===this.sgWidget)e=o.a.createElement("div",{className:t,style:n},o.a.createElement(Ii,{errorMsg:Object(N.b)("Error loading Widget")}));else if(!this.state.hasPermissionToLoad&&this.props.room){const a=this.context.isRoomEncrypted(this.props.room.roomId);e=o.a.createElement("div",{className:t,style:n},o.a.createElement(ji,{roomId:this.props.room.roomId,creatorUserId:this.props.creatorUserId,url:this.sgWidget.embedUrl,isRoomEncrypted:a,onPermissionGranted:this.grantWidgetPermission}))}else if(this.state.initialising||!this.state.isUserProfileReady)e=o.a.createElement("div",{className:t,style:n},a);else if(this.isMixedContent())e=o.a.createElement("div",{className:t,style:n},o.a.createElement(Ii,{errorMsg:Object(N.b)("Error - Mixed content")}));else if(e=o.a.createElement("div",{className:t,style:n},this.state.loading&&a,o.a.createElement("iframe",{title:i,allow:"microphone; camera; encrypted-media; autoplay; display-capture; clipboard-write; clipboard-read;",ref:this.iframeRefChange,src:this.sgWidget.embedUrl,allowFullScreen:!0,sandbox:"allow-forms allow-popups allow-popups-to-escape-sandbox allow-same-origin allow-scripts allow-presentation allow-downloads"})),!this.props.userWidget){const t=101;e=o.a.createElement("div",{className:"mx_AppTile_persistedWrapper"},o.a.createElement(Di,{zIndex:this.props.miniMode?t:9,persistKey:this.persistKey,moveRef:this.props.movePersistedElement},e))}let r,s;r=this.props.miniMode?{mx_AppTile_mini:!0}:this.props.fullWidth?{mx_AppTileFullWidth:!0}:{mx_AppTile:!0},r=d()(r),this.state.menuDisplayed&&(s=o.a.createElement(ja,ee()({},Object(le.i)(this.contextMenuButton.current.getBoundingClientRect()),{app:this.props.app,onFinished:this.closeContextMenu,showUnpin:!this.props.userWidget,userWidget:this.props.userWidget,onEditClick:this.props.onEditClick,onDeleteClick:this.props.onDeleteClick})));const l=[];if(this.props.showLayoutButtons){const e=this.props.room&&An.d.instance.isInContainer(this.props.room,this.props.app,An.a.Center);l.push(o.a.createElement(K.a,{key:"toggleMaximised",className:"mx_AppTileMenuBar_widgets_button",title:e?Object(N.b)("Un-maximise"):Object(N.b)("Maximise"),onClick:this.onToggleMaximisedClick},e?o.a.createElement(Li,{className:"mx_Icon mx_Icon_12"}):o.a.createElement(Bi,{className:"mx_Icon mx_Icon_12"}))),l.push(o.a.createElement(K.a,{key:"minimise",className:"mx_AppTileMenuBar_widgets_button",title:Object(N.b)("Minimise"),onClick:this.onMinimiseClicked},o.a.createElement(Wi.a,{className:"mx_Icon mx_Icon_12"})))}return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:r,id:this.props.app.id},this.props.showMenubar&&o.a.createElement("div",{className:"mx_AppTileMenuBar"},o.a.createElement("span",{className:"mx_AppTileMenuBar_title",style:{pointerEvents:this.props.handleMinimisePointerEvents?"all":"none"}},this.props.showTitle&&this.getTileTitle()),o.a.createElement("span",{className:"mx_AppTileMenuBar_widgets"},l,this.props.showPopout&&!this.state.requiresClient&&o.a.createElement(K.a,{className:"mx_AppTileMenuBar_widgets_button",title:Object(N.b)("Popout widget"),onClick:this.onPopoutWidgetClick},o.a.createElement(Hi,{className:"mx_Icon mx_Icon_12 mx_Icon--stroke"})),this.state.hasContextMenuOptions&&o.a.createElement(le.b,{className:"mx_AppTileMenuBar_widgets_button",label:Object(N.b)("Options"),isExpanded:this.state.menuDisplayed,inputRef:this.contextMenuButton,onClick:this.onContextMenuClick},o.a.createElement(Ye,{className:"mx_Icon mx_Icon_12"})))),e),s)}}i()(qi,"contextType",I.a),i()(qi,"defaultProps",{waitForIframeLoad:!0,showMenubar:!0,showTitle:!0,showPopout:!0,handleMinimisePointerEvents:!1,userWidget:!1,miniMode:!1,threadId:null,showLayoutButtons:!0});var $i=({room:e,widgetId:t,onClose:n})=>{const a=Object(r.useContext)(I.a),i=bi(e).find((e=>e.id===t)),s=i&&An.d.instance.isInContainer(e,i,An.a.Right),[l,c,d,u]=Object(le.q)();if(Object(r.useEffect)((()=>{i&&s||fn.a.instance.popCard()}),[i,s]),!i||!s)return null;let m;if(l){var h;const e=null===(h=c.current)||void 0===h?void 0:h.getBoundingClientRect(),t=e?e.right:0,n=e?e.bottom:0;m=o.a.createElement(ja,{chevronFace:le.a.None,right:X.b.instance.windowWidth-t-12,top:n+12,onFinished:u,app:i})}const p=o.a.createElement("div",{className:"mx_BaseCard_header_title"},o.a.createElement(Yt.a,{size:"4",className:"mx_BaseCard_header_title_heading"},Sn.a.getWidgetName(i)),o.a.createElement(le.b,{className:"mx_BaseCard_header_title_button--option",inputRef:c,onClick:d,isExpanded:l,label:Object(N.b)("Options")}),m);return o.a.createElement(En.b,{header:p,className:"mx_WidgetCard",onClose:n,withoutScrollContainer:!0},o.a.createElement(qi,{app:i,fullWidth:!0,showMenubar:!1,room:e,userId:a.getSafeUserId(),creatorUserId:i.creatorUserId,widgetPageTitle:Sn.a.getWidgetDataTitle(i),waitForIframeLoad:i.waitForIframeLoad}))},Yi=n(219),Ji=n(659),Qi=n(344),Xi=n(1356),Zi=n(1395),er=n(237),tr=n(427);class nr extends o.a.Component{constructor(e){super(e),i()(this,"userLastModifiedTime",void 0),i()(this,"memberLastModifiedTime",void 0),i()(this,"onRoomStateEvents",(e=>{if(e.getType()!==l.EventType.RoomEncryption)return;const{roomId:t}=this.props.member;if(e.getRoomId()!==t)return;tt.a.safeGet().removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents),this.setState({isRoomEncrypted:!0}),this.updateE2EStatus()})),i()(this,"onUserTrustStatusChanged",((e,t)=>{e===this.props.member.userId&&this.updateE2EStatus()})),i()(this,"onDeviceVerificationChanged",((e,t,n)=>{e===this.props.member.userId&&this.updateE2EStatus()})),i()(this,"onClick",(()=>{b.a.dispatch({action:F.a.ViewUser,member:this.props.member,push:!0})})),this.state={isRoomEncrypted:!1}}componentDidMount(){const e=tt.a.safeGet(),{roomId:t}=this.props.member;if(t){const n=e.isRoomEncrypted(t);this.setState({isRoomEncrypted:n}),n?(e.on(cn.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),e.on(cn.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.updateE2EStatus()):e.on(l.RoomStateEvent.Events,this.onRoomStateEvents)}}componentWillUnmount(){const e=tt.a.get();e&&(e.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents),e.removeListener(cn.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),e.removeListener(cn.b.DeviceVerificationChanged,this.onDeviceVerificationChanged))}async updateE2EStatus(){const e=tt.a.safeGet(),{userId:t}=this.props.member,n=t===e.getUserId(),a=e.checkUserTrust(t);if(!a.isCrossSigningVerified())return void this.setState({e2eStatus:a.wasCrossSigningVerified()?er.a.Warning:er.a.Normal});const i=await Object(tr.b)(e,t),r=await Object(Wn.k)(i,(async a=>{var i;const r=await(null===(i=e.getCrypto())||void 0===i?void 0:i.getDeviceVerificationStatus(t,a));return!r||(n?!r.crossSigningVerified:!r.isVerified())}));this.setState({e2eStatus:r?er.a.Warning:er.a.Verified})}shouldComponentUpdate(e,t){return void 0===this.memberLastModifiedTime||this.memberLastModifiedTime<e.member.getLastModifiedTime()||(!(!e.member.user||!(void 0===this.userLastModifiedTime||this.userLastModifiedTime<e.member.user.getLastModifiedTime()))||(t.isRoomEncrypted!==this.state.isRoomEncrypted||t.e2eStatus!==this.state.e2eStatus))}getDisplayName(){return this.props.member.name}getPowerLabel(){return Object(N.b)("%(userName)s (power %(powerLevelNumber)s)",{userName:Et.a.getDisplayUserIdentifier(this.props.member.userId,{roomId:this.props.member.roomId}),powerLevelNumber:this.props.member.powerLevel}).trim()}render(){var e;const t=this.props.member,n=this.getDisplayName(),a=null===(e=t.user)||void 0===e?void 0:e.presence,i=o.a.createElement(Ba.b,{member:t,width:36,height:36,"aria-hidden":"true"});t.user&&(this.userLastModifiedTime=t.user.getLastModifiedTime()),this.memberLastModifiedTime=t.getLastModifiedTime();const r=new Map([[100,Xi.a.Admin],[50,Xi.a.Moderator]]);let s=this.props.member.powerLevel;for(const[e]of r)if(this.props.member.powerLevel>=e){s=e;break}const l=r.get(s);let c;this.state.isRoomEncrypted&&(c=this.state.e2eStatus);const d=o.a.createElement(Zi.a,{member:t,fallbackName:n||""});return o.a.createElement(Xi.b,ee()({},this.props,{presenceState:a,presenceLastActiveAgo:t.user?t.user.lastActiveAgo:0,presenceLastTs:t.user?t.user.lastPresenceTs:0,presenceCurrentlyActive:!!t.user&&t.user.currentlyActive,avatarJsx:i,title:this.getPowerLabel(),name:n,nameJSX:d,powerStatus:l,showPresence:this.props.showPresence,e2eStatus:c,onClick:this.onClick}))}}i()(nr,"defaultProps",{showPresence:!0});class ar extends o.a.Component{constructor(e,t){var a;super(e),i()(this,"showPresence",void 0),i()(this,"mounted",!1),i()(this,"context",void 0),i()(this,"onUserPresenceChange",((e,t)=>{this.refs[t.userId]&&this.updateList()})),i()(this,"onRoom",(e=>{e.roomId===this.props.roomId&&this.updateListNow(!0)})),i()(this,"onMyMembership",((e,t,n)=>{e.roomId===this.props.roomId&&"join"===t&&"join"!==n&&this.updateListNow(!0)})),i()(this,"onRoomStateUpdate",(e=>{e.roomId===this.props.roomId&&this.updateList()})),i()(this,"onRoomMemberName",((e,t)=>{t.roomId===this.props.roomId&&this.updateList()})),i()(this,"onRoomStateEvent",(e=>{e.getRoomId()===this.props.roomId&&e.getType()===l.EventType.RoomThirdPartyInvite&&this.updateList(),this.canInvite!==this.state.canInvite&&this.setState({canInvite:this.canInvite})})),i()(this,"updateList",Object(R.throttle)((()=>{this.updateListNow(!1)}),500,{leading:!0,trailing:!0})),i()(this,"createOverflowTileJoined",((e,t)=>this.createOverflowTile(e,t,this.showMoreJoinedMemberList))),i()(this,"createOverflowTileInvited",((e,t)=>this.createOverflowTile(e,t,this.showMoreInvitedMemberList))),i()(this,"createOverflowTile",((e,t,a)=>{const i=Object(N.b)("and %(count)s others...",{count:e});return o.a.createElement(Xi.b,{className:"mx_EntityTile_ellipsis",avatarJsx:o.a.createElement(yt.a,{url:n(1399).default,name:"...",width:36,height:36}),name:i,presenceState:"online",suppressOnHover:!0,onClick:a})})),i()(this,"showMoreJoinedMemberList",(()=>{this.setState({truncateAtJoined:this.state.truncateAtJoined+100})})),i()(this,"showMoreInvitedMemberList",(()=>{this.setState({truncateAtInvited:this.state.truncateAtInvited+100})})),i()(this,"onSearchQueryChanged",(e=>{this.props.onSearchQueryChanged(e)})),i()(this,"onPending3pidInviteClick",(e=>{b.a.dispatch({action:"view_3pid_invite",event:e})})),i()(this,"getChildrenJoined",((e,t)=>this.makeMemberTiles(this.state.filteredJoinedMembers.slice(e,t)))),i()(this,"getChildCountJoined",(()=>this.state.filteredJoinedMembers.length)),i()(this,"getChildrenInvited",((e,t)=>{let n=this.state.filteredInvitedMembers;return t>this.state.filteredInvitedMembers.length&&(n=n.concat(this.getPending3PidInvites())),this.makeMemberTiles(n.slice(e,t))})),i()(this,"getChildCountInvited",(()=>this.state.filteredInvitedMembers.length+(this.getPending3PidInvites()||[]).length)),i()(this,"onInviteButtonClick",(e=>{re.b.trackInteraction("WebRightPanelMemberListInviteButton",e),tt.a.safeGet().isGuest()?b.a.dispatch({action:"require_registration"}):b.a.dispatch({action:"view_invite",roomId:this.props.roomId})})),this.state=this.getMembersState([],[]),this.showPresence=null===(a=null==t?void 0:t.memberListStore.isPresenceEnabled())||void 0===a||a,this.mounted=!0,this.listenForMembersChanges()}listenForMembersChanges(){const e=tt.a.safeGet();e.on(l.RoomStateEvent.Update,this.onRoomStateUpdate),e.on(l.RoomMemberEvent.Name,this.onRoomMemberName),e.on(l.RoomStateEvent.Events,this.onRoomStateEvent),e.on(l.UserEvent.LastPresenceTs,this.onUserPresenceChange),e.on(l.UserEvent.Presence,this.onUserPresenceChange),e.on(l.UserEvent.CurrentlyActive,this.onUserPresenceChange),e.on(s.b.Room,this.onRoom),e.on(l.RoomEvent.MyMembership,this.onMyMembership)}componentDidMount(){this.updateListNow(!0)}componentWillUnmount(){this.mounted=!1;const e=tt.a.get();e&&(e.removeListener(l.RoomStateEvent.Update,this.onRoomStateUpdate),e.removeListener(l.RoomMemberEvent.Name,this.onRoomMemberName),e.removeListener(l.RoomEvent.MyMembership,this.onMyMembership),e.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvent),e.removeListener(s.b.Room,this.onRoom),e.removeListener(l.UserEvent.LastPresenceTs,this.onUserPresenceChange),e.removeListener(l.UserEvent.Presence,this.onUserPresenceChange),e.removeListener(l.UserEvent.CurrentlyActive,this.onUserPresenceChange)),this.updateList.cancel()}get canInvite(){const e=tt.a.safeGet(),t=e.getRoom(this.props.roomId);return!(null==t||!t.canInvite(e.getSafeUserId()))||!(null==t||!t.isSpaceRoom()||t.getJoinRule()!==l.JoinRule.Public)}getMembersState(e,t){return{loading:!1,filteredJoinedMembers:t,filteredInvitedMembers:e,canInvite:this.canInvite,truncateAtJoined:30,truncateAtInvited:5}}async updateListNow(e){if(!this.mounted)return;e&&this.setState({loading:!0});const{joined:t,invited:n}=await this.context.memberListStore.loadMemberList(this.props.roomId,this.props.searchQuery);this.mounted&&this.setState({loading:!1,filteredJoinedMembers:t,filteredInvitedMembers:n})}componentDidUpdate(e,t,n){e.searchQuery!==this.props.searchQuery&&this.updateListNow(!1)}getPending3PidInvites(){const e=tt.a.safeGet().getRoom(this.props.roomId);return e?e.currentState.getStateEvents("m.room.third_party_invite").filter((function(t){if(!Object(Yi.c)(t))return!1;return!e.currentState.getInviteForThreePidToken(t.getStateKey())})):[]}makeMemberTiles(e){return e.map((e=>e instanceof l.RoomMember?o.a.createElement(nr,{key:e.userId,member:e,ref:e.userId,showPresence:this.showPresence}):o.a.createElement(Xi.b,{key:e.getStateKey(),name:e.getContent().display_name,suppressOnHover:!0,onClick:()=>this.onPending3pidInviteClick(e)})))}render(){if(this.state.loading)return o.a.createElement(En.b,{className:"mx_MemberList",onClose:this.props.onClose},o.a.createElement(Ma.a,null));const e=tt.a.safeGet().getRoom(this.props.roomId);let t,n,a;if("join"===(null==e?void 0:e.getMyMembership())&&Object(te.a)(oe.a.InviteUsers)){let n=Object(N.b)("Invite to this room");e.isSpaceRoom()&&(n=Object(N.b)("Invite to this space")),t=this.state.canInvite?o.a.createElement(K.a,{className:"mx_MemberList_invite",onClick:this.onInviteButtonClick},o.a.createElement("span",null,n)):o.a.createElement($.a,{className:"mx_MemberList_invite",onClick:null,disabled:!0,tooltip:Object(N.b)("You do not have permission to invite users")},o.a.createElement("span",null,n))}this.getChildCountInvited()>0&&(n=o.a.createElement("h2",null,Object(N.b)("Invited")),a=o.a.createElement(Ji.a,{className:"mx_MemberList_section mx_MemberList_invited",truncateAt:this.state.truncateAtInvited,createOverflowElement:this.createOverflowTileInvited,getChildren:this.getChildrenInvited,getChildCount:this.getChildCountInvited}));const i=o.a.createElement(Qi.a,{className:"mx_MemberList_query mx_textinput_icon mx_textinput_search",placeholder:Object(N.b)("Filter room members"),onSearch:this.onSearchQueryChanged,initialValue:this.props.searchQuery});let r;return null!=e&&e.isSpaceRoom()&&(r=o.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},o.a.createElement(fe.a,{room:e,height:32,width:32}),o.a.createElement(Za.a,{room:e}))),o.a.createElement(En.b,{className:"mx_MemberList",header:o.a.createElement(o.a.Fragment,null,r,t),footer:i,onClose:this.props.onClose},o.a.createElement("div",{className:"mx_MemberList_wrapper"},o.a.createElement(Ji.a,{className:"mx_MemberList_section mx_MemberList_joined",truncateAt:this.state.truncateAtJoined,createOverflowElement:this.createOverflowTileJoined,getChildren:this.getChildrenJoined,getChildCount:this.getChildCountJoined}),n,a))}}i()(ar,"contextType",Ze.a);var ir=n(817);class rr extends o.a.Component{constructor(e){var t,n,a,r;super(e),i()(this,"room",void 0),i()(this,"onRoomStateEvents",(e=>{if(e.getType()===l.EventType.RoomThirdPartyInvite&&e.getStateKey()===this.state.stateKey){const t=e.getContent().display_name,n={invited:Object(Yi.c)(e)};t&&(n.displayName=t),this.setState(n)}})),i()(this,"onCancel",(()=>{b.a.dispatch({action:"view_3pid_invite",event:null})})),i()(this,"onKickClick",(()=>{tt.a.safeGet().sendStateEvent(this.state.roomId,"m.room.third_party_invite",{},this.state.stateKey).catch((e=>{on.a.error(e),this.setState({invited:!0}),H.b.createDialog(Dn.a,{title:Object(N.b)("Failed to revoke invite"),description:Object(N.b)("Could not revoke the invite. The server may be experiencing a temporary problem or you do not have sufficient permissions to revoke the invite.")})})),this.setState({invited:!1})})),this.room=tt.a.safeGet().getRoom(this.props.event.getRoomId());const o=null===(t=this.room)||void 0===t?void 0:t.getMember(tt.a.safeGet().getSafeUserId()),s=null===(n=this.room)||void 0===n?void 0:n.currentState.getStateEvents("m.room.power_levels",""),c=this.props.event.getSender();let d=s?s.getContent().kick:50;"number"!=typeof d&&(d=50);const u=null===(a=this.room)||void 0===a?void 0:a.getMember(c);this.state={stateKey:this.props.event.getStateKey(),roomId:this.props.event.getRoomId(),displayName:this.props.event.getContent().display_name,invited:!0,canKick:!!o&&o.powerLevel>d,senderName:null!==(r=null==u?void 0:u.name)&&void 0!==r?r:c}}componentDidMount(){tt.a.safeGet().on(l.RoomStateEvent.Events,this.onRoomStateEvents)}componentWillUnmount(){const e=tt.a.get();e&&e.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents)}render(){var e;let t,n;return this.state.canKick&&this.state.invited&&(t=o.a.createElement("div",{className:"mx_MemberInfo_container"},o.a.createElement("h3",null,Object(N.b)("Admin Tools")),o.a.createElement(K.a,{className:"mx_MemberInfo_field",onClick:this.onKickClick},Object(N.b)("Revoke invite")))),null!==(e=this.room)&&void 0!==e&&e.isSpaceRoom()&&(n=o.a.createElement("div",{className:"mx_RightPanel_scopeHeader"},o.a.createElement(fe.a,{room:this.room,height:32,width:32}),o.a.createElement(Za.a,{room:this.room}))),o.a.createElement("div",{className:"mx_MemberInfo",role:"tabpanel"},n,o.a.createElement("div",{className:"mx_MemberInfo_name"},o.a.createElement(K.a,{className:"mx_MemberInfo_cancel",onClick:this.onCancel,title:Object(N.b)("Close")}),o.a.createElement("h2",null,this.state.displayName)),o.a.createElement("div",{className:"mx_MemberInfo_container mx_MemberInfo_container--profile"},Object(N.b)("Invited by %(sender)s",{sender:this.state.senderName})),t)}}var or=n(149),sr=n(1314);let lr=function(e){return e[e.Files=0]="Files",e[e.Search=1]="Search",e}({});function cr({isRoomEncrypted:e,kind:t}){if(!e)return o.a.createElement(o.a.Fragment,null);if(sr.a.get())return o.a.createElement(o.a.Fragment,null);if(sr.a.error)return o.a.createElement("div",{className:"mx_SearchWarning"},Object(N.b)("Message search initialisation failed, check <a>your settings</a> for more information",{},{a:e=>o.a.createElement(K.a,{kind:"link_inline",onClick:e=>{e.preventDefault(),b.a.dispatch({action:F.a.ViewUserSettings,initialTabId:Me.a.Security})}},e)}));const n=it.b.get("brand"),a=it.b.getObject("desktop_builds");let i,r;if(null!=a&&a.get("available")){r=o.a.createElement("img",{alt:Object(N.b)("Desktop app logo"),src:a.get("logo")});const e=a.get("url");switch(t){case lr.Files:i=Object(N.b)("Use the <a>Desktop app</a> to see all encrypted files",{},{a:t=>o.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)});break;case lr.Search:i=Object(N.b)("Use the <a>Desktop app</a> to search encrypted messages",{},{a:t=>o.a.createElement("a",{href:e,target:"_blank",rel:"noreferrer noopener"},t)})}}else switch(t){case lr.Files:i=Object(N.b)("This version of %(brand)s does not support viewing some encrypted files",{brand:n});break;case lr.Search:i=Object(N.b)("This version of %(brand)s does not support searching encrypted messages",{brand:n})}return i?o.a.createElement("div",{className:"mx_SearchWarning"},r,o.a.createElement("span",null,i)):(on.a.warn("Unknown desktop builds warning kind: ",t),o.a.createElement(o.a.Fragment,null))}var dr=n(654),ur=n(101),mr=n(667),hr=n(281),pr=n(1373),gr=n(323);const br=(...e)=>{v.b.getValue("debug_timeline_panel")&&on.a.log.call(console,"TimelinePanel debuglog:",...e)},vr=(e,t)=>e.localTimestamp<t.localTimestamp,fr=(e,t)=>e.localTimestamp>=t.localTimestamp;class yr extends o.a.Component{constructor(e,t){var n;if(super(e,t),i()(this,"context",void 0),i()(this,"lastRRSentEventId",void 0),i()(this,"lastRMSentEventId",void 0),i()(this,"messagePanel",Object(r.createRef)()),i()(this,"dispatcherRef",void 0),i()(this,"timelineWindow",void 0),i()(this,"overlayTimelineWindow",void 0),i()(this,"unmounted",!1),i()(this,"readReceiptActivityTimer",null),i()(this,"readMarkerActivityTimer",null),i()(this,"callEventGroupers",new Map),i()(this,"initialReadMarkerId",null),i()(this,"onDumpDebugLogs",(()=>{var e,t,n,a,i,r,o;const s=null===(e=this.props.timelineSet)||void 0===e?void 0:e.room,c=null===(t=this.state)||void 0===t||null===(n=t.events)||void 0===n?void 0:n.map((e=>e.getId()));let d,u,m;try{const e=this.messagePanel.current;if(e){const t=Pi.a.findDOMNode(e);if(t){d=[...t.querySelectorAll("[data-event-id]")].map((e=>e.getAttribute("data-event-id")))}}}catch(e){on.a.error("onDumpDebugLogs: Failed to get the actual event ID's in the DOM",e)}const h={};if(s){const e=s.getTimelineSets(),t=s.threadsTimelineSets;try{u=Er(e),m=Er(t)}catch(e){on.a.error("onDumpDebugLogs: Failed to serialize event IDs from timelinesets",e)}try{s.getThreads().forEach((e=>{var t,n;h[e.id]={events:e.events.map((e=>e.getId())),numTimelines:e.timelineSet.getTimelines().length,liveTimeline:e.timelineSet.getLiveTimeline().getEvents().length,prevTimeline:null===(t=e.timelineSet.getLiveTimeline().getNeighbouringTimeline(l.Direction.Backward))||void 0===t?void 0:t.getEvents().length,nextTimeline:null===(n=e.timelineSet.getLiveTimeline().getNeighbouringTimeline(l.Direction.Forward))||void 0===n?void 0:n.getEvents().length}}))}catch(e){on.a.error("onDumpDebugLogs: Failed to serialize event IDs from the threads",e)}}let p,g;try{var b;p=null===(b=this.timelineWindow)||void 0===b?void 0:b.getEvents().map((e=>e.getId()))}catch(e){on.a.error("onDumpDebugLogs: Failed to get event IDs from the timelineWindow",e)}try{g=this.props.timelineSet.getPendingEvents().map((e=>e.getId()))}catch(e){on.a.error("onDumpDebugLogs: Failed to get pending event IDs",e)}on.a.debug(`TimelinePanel(${this.context.timelineRenderingType}): Debugging info for ${null==s?void 0:s.roomId}\n\tevents(${c.length})=${JSON.stringify(c)}\n\trenderedEventIds(${null!==(a=null===(i=d)||void 0===i?void 0:i.length)&&void 0!==a?a:0})=${JSON.stringify(d)}\n\tserializedEventIdsFromTimelineSets=${JSON.stringify(u)}\n\tserializedEventIdsFromThreadsTimelineSets=${JSON.stringify(m)}\n\tserializedThreadsMap=${JSON.stringify(h)}\n\ttimelineWindowEventIds(${null===(r=p)||void 0===r?void 0:r.length})=${JSON.stringify(p)}\n\tpendingEventIds(${null===(o=g)||void 0===o?void 0:o.length})=${JSON.stringify(g)}`)})),i()(this,"onMessageListUnfillRequest",((e,t)=>{var n,a;const i=e?l.EventTimeline.BACKWARDS:l.EventTimeline.FORWARDS;br("unpaginating events in direction",i);const r=t,o=this.timelineWindow.getEvents(),s=null!==(n=null===(a=this.overlayTimelineWindow)||void 0===a?void 0:a.getEvents())&&void 0!==n?n:[];let c,d,u,m=o.findIndex((e=>e.getId()===r));-1===m?(c=s.findIndex((e=>e.getId()===r)),m=e?Object(R.findLastIndex)(o,(e=>fr(s[c],e))):o.findIndex((e=>vr(s[c],e)))):c=e?Object(R.findLastIndex)(s,(e=>vr(e,o[m]))):s.findIndex((e=>fr(e,o[m]))),d=-1===m?0:e?m+1:o.length-m,u=-1===c?0:e?c+1:s.length-c,d>0&&(br("Unpaginating",d,"in direction",i),this.timelineWindow.unpaginate(d,e)),u>0&&(br("Unpaginating",d,"from overlay timeline in direction",i),this.overlayTimelineWindow.unpaginate(u,e));const{events:h,liveEvents:p,firstVisibleEventIndex:g}=this.getEvents();this.buildLegacyCallEventGroupers(h),this.setState({events:h,liveEvents:p,firstVisibleEventIndex:g}),e?this.setState({canBackPaginate:!0}):this.setState({canForwardPaginate:!0})})),i()(this,"onPaginationRequest",((e,t,n)=>this.props.onPaginationRequest?this.props.onPaginationRequest(e,t,n):e.paginate(t,n))),i()(this,"onMessageListFillRequest",(e=>{var t;if(!this.shouldPaginate())return Promise.resolve(!1);const n=e?l.EventTimeline.BACKWARDS:l.EventTimeline.FORWARDS,a=e?"canBackPaginate":"canForwardPaginate",i=e?"backPaginating":"forwardPaginating";return this.state[a]?null!==(t=this.timelineWindow)&&void 0!==t&&t.canPaginate(n)?e&&0!==this.state.firstVisibleEventIndex?(br("won't",n,"paginate past first visible event"),Promise.resolve(!1)):(br("Initiating paginate; backwards:"+e),this.setState({[i]:!0}),this.onPaginationRequest(this.timelineWindow,n,50).then((async t=>{var n;if(this.unmounted)return!1;this.overlayTimelineWindow&&await this.extendOverlayWindowToCoverMainWindow(),br("paginate complete backwards:"+e+"; success:"+t);const{events:r,liveEvents:o,firstVisibleEventIndex:s}=this.getEvents();this.buildLegacyCallEventGroupers(r);const c={[i]:!1,[a]:t,events:r,liveEvents:o,firstVisibleEventIndex:s},d=e?l.EventTimeline.FORWARDS:l.EventTimeline.BACKWARDS,u=e?"canForwardPaginate":"canBackPaginate";return!this.state[u]&&null!==(n=this.timelineWindow)&&void 0!==n&&n.canPaginate(d)&&(br("can now",d,"paginate again"),c[u]=!0),new Promise((n=>{this.setState(c,(()=>{n(t&&(!e||0===s))}))}))}))):(br("can't",n,"paginate any further"),this.setState({[a]:!1}),Promise.resolve(!1)):(br("have given up",n,"paginating this timeline"),Promise.resolve(!1))})),i()(this,"onMessageListScroll",(e=>{var t,n;null===(t=(n=this.props).onScroll)||void 0===t||t.call(n,e),this.props.manageReadMarkers&&this.doManageReadMarkers()})),i()(this,"doManageReadMarkers",Object(R.debounce)((()=>{var e;const t=this.getReadMarkerPosition();if(null===t)return;t<0&&this.setState({readMarkerVisible:!0});const n=this.readMarkerTimeout(t);null===(e=this.readMarkerActivityTimer)||void 0===e||e.changeTimeout(n)}),100,{leading:!1,trailing:!0})),i()(this,"onAction",(e=>{switch(e.action){case"ignore_state_changed":this.forceUpdate();break;case F.a.DumpDebugLogs:this.onDumpDebugLogs()}})),i()(this,"onRoomTimeline",((e,t,n,a,i)=>{var r,o;i.timeline.getTimelineSet()!==this.props.timelineSet&&i.timeline.getTimelineSet()!==this.props.overlayTimelineSet||(dn.e.hasServerSideSupport||this.context.timelineRenderingType!==In.a.Thread||(n&&!this.state.canBackPaginate&&this.setState({canBackPaginate:!0}),n||this.state.canForwardPaginate||this.setState({canForwardPaginate:!0})),!n&&i&&i.liveEvent&&null!==(r=this.messagePanel.current)&&void 0!==r&&r.getScrollState()&&(null!==(o=this.messagePanel.current.getScrollState())&&void 0!==o&&o.stuckAtBottom?this.timelineWindow.paginate(l.EventTimeline.FORWARDS,1,!1).then((()=>{if(this.overlayTimelineWindow)return this.overlayTimelineWindow.paginate(l.EventTimeline.FORWARDS,1,!1)})).then((()=>{if(this.unmounted)return;const{events:t,liveEvents:n,firstVisibleEventIndex:a}=this.getEvents();this.buildLegacyCallEventGroupers(t);const i=n[n.length-1],r={events:t,liveEvents:n,firstVisibleEventIndex:a};let o=!1;if(this.props.manageReadMarkers){const t=tt.a.safeGet().credentials.userId;if(o=!1,e.getSender()===t||mr.a.sharedInstance().userActiveRecently()){if(i&&0===this.getReadMarkerPosition()){var s;this.setReadMarker(null!==(s=i.getId())&&void 0!==s?s:null,i.getTs(),!0),r.readMarkerVisible=!1,r.readMarkerEventId=i.getId(),o=!0}}else r.readMarkerVisible=!0}this.setState(r,(()=>{var e,t,n;(null===(e=this.messagePanel.current)||void 0===e||e.updateTimelineMinHeight(),o)&&(null===(t=(n=this.props).onReadMarkerUpdated)||void 0===t||t.call(n))}))})):this.setState({canForwardPaginate:!0})))})),i()(this,"onRoomTimelineReset",((e,t)=>{t!==this.props.timelineSet&&t!==this.props.overlayTimelineSet||this.canResetTimeline()&&this.loadTimeline()})),i()(this,"canResetTimeline",(()=>{var e,t;return!0===(null===(e=this.messagePanel)||void 0===e||null===(t=e.current)||void 0===t?void 0:t.isAtBottom())})),i()(this,"onRoomRedaction",((e,t)=>{this.unmounted||this.hasTimelineSetFor(t.roomId)&&this.forceUpdate()})),i()(this,"onThreadUpdate",(e=>{var t;if(this.unmounted)return;if(!this.hasTimelineSetFor(e.roomId))return;const n=null===(t=this.messagePanel.current)||void 0===t?void 0:t.getTileForEventId(e.id);n&&n.forceUpdate()})),i()(this,"onEventVisibilityChange",(e=>{var t;if(this.unmounted)return;if(!this.hasTimelineSetFor(e.getRoomId()))return;const n=null===(t=this.messagePanel.current)||void 0===t?void 0:t.getTileForEventId(e.getId());n&&n.forceUpdate()})),i()(this,"onVisibilityPowerLevelChange",((e,t)=>{var n;if(!this.unmounted&&this.hasTimelineSetFor(t.roomId)&&t.userId==(null===(n=tt.a.safeGet().credentials)||void 0===n?void 0:n.userId)){for(const e of this.state.events){var a;const t=null===(a=this.messagePanel.current)||void 0===a?void 0:a.getTileForEventId(e.getId());t&&t.forceUpdate()}this.forceUpdate()}})),i()(this,"onEventReplaced",(e=>{this.unmounted||this.hasTimelineSetFor(e.getRoomId())&&this.forceUpdate()})),i()(this,"onRoomReceipt",((e,t)=>{this.unmounted||t===this.props.timelineSet.room&&this.forceUpdate()})),i()(this,"onLocalEchoUpdated",((e,t,n)=>{this.unmounted||this.hasTimelineSetFor(t.roomId)&&this.reloadEvents()})),i()(this,"onAccountData",((e,t)=>{this.unmounted||t===this.props.timelineSet.room&&e.getType()===l.EventType.FullyRead&&this.setState({readMarkerEventId:e.getContent().event_id},this.props.onReadMarkerUpdated)})),i()(this,"onEventDecrypted",(e=>{this.props.timelineSet.room&&this.hasTimelineSetFor(e.getRoomId())&&this.state.events.includes(e)&&(this.recheckFirstVisibleEventIndex(),this.buildLegacyCallEventGroupers(this.state.events),this.forceUpdate())})),i()(this,"onSync",((e,t,n)=>{this.unmounted||this.setState({clientSyncState:e})})),i()(this,"recheckFirstVisibleEventIndex",Object(R.throttle)((()=>{const e=this.checkForPreJoinUISI(this.state.events);e!==this.state.firstVisibleEventIndex&&this.setState({firstVisibleEventIndex:e})}),500,{leading:!0,trailing:!0})),i()(this,"sendReadReceipts",(async()=>{var e,t;if(v.b.getValue("lowBandwidth"))return;if(!this.messagePanel.current)return;if(!this.props.manageReadReceipts)return;const n=tt.a.get();if(!n||n.isGuest())return;const a=this.getCurrentReadReceipt(!0),i=this.indexForEventId(a),r=this.getLastDisplayedEventIndex({ignoreOwn:!0}),o=null!==(e=this.state.events[null!=r?r:this.state.events.length-1])&&void 0!==e?e:null,s=this.shouldSendReadReceipt(a,i,o,r),l=this.state.readMarkerEventId,c=this.shouldSendFullyReadMarker(l),d=null===(t=this.props.timelineSet.room)||void 0===t?void 0:t.roomId;br(`Sending Read Markers for ${d}: `,{shouldSendReadReceipt:s,shouldSendFullyReadMarker:c,currentReadReceiptEventId:a,currentReadReceiptEventIndex:i,lastReadEventId:null==o?void 0:o.getId(),lastReadEventIndex:r,readMarkerEventId:this.state.readMarkerEventId});const u=[];if(s&&u.push(this.sendReadReceipt(n,o)),c){this.props.timelineSet.findEventById(l)&&u.push(this.sendFullyReadMarker(n,null!=d?d:"",l))}await Promise.all(u)})),i()(this,"updateReadMarker",(async()=>{if(!this.props.manageReadMarkers)return;if(1===this.getReadMarkerPosition())return;const e=this.getLastDisplayedEventIndex({allowPartial:!0});if(null===e)return;const t=this.state.events[e];this.setReadMarker(t.getId(),t.getTs()),this.state.readMarkerVisible&&this.setState({readMarkerVisible:!1}),await this.sendReadReceipts()})),i()(this,"jumpToLiveTimeline",(()=>{var e,t;null!==(e=this.timelineWindow)&&void 0!==e&&e.canPaginate(l.EventTimeline.FORWARDS)?this.loadTimeline():null===(t=this.messagePanel.current)||void 0===t||t.scrollToBottom()})),i()(this,"scrollToEventIfNeeded",(e=>{var t;null===(t=this.messagePanel.current)||void 0===t||t.scrollToEventIfNeeded(e)})),i()(this,"jumpToReadMarker",(()=>{if(!this.props.manageReadMarkers)return;if(!this.messagePanel.current)return;if(!this.state.readMarkerEventId)return;null===this.messagePanel.current.getReadMarkerPosition()?this.loadTimeline(this.state.readMarkerEventId,0,1/3):this.messagePanel.current.scrollToEvent(this.state.readMarkerEventId,0,1/3)})),i()(this,"forgetReadMarker",(async()=>{if(!this.props.manageReadMarkers)return;const e=this.getCurrentReadReceipt(),t=this.props.timelineSet.getTimelineForEvent(null!=e?e:"");let n;if(t){const a=t.getEvents().find((t=>t.getId()==e));a&&(n=a.getTs())}this.setReadMarker(e,n),await this.sendReadReceipts()})),i()(this,"isAtEndOfLiveTimeline",(()=>{var e;return(null===(e=this.messagePanel.current)||void 0===e?void 0:e.isAtBottom())&&this.timelineWindow&&!this.timelineWindow.canPaginate(l.EventTimeline.FORWARDS)})),i()(this,"getScrollState",(()=>this.messagePanel.current?this.messagePanel.current.getScrollState():null)),i()(this,"getReadMarkerPosition",(()=>{if(!this.props.manageReadMarkers)return null;if(!this.messagePanel.current)return null;if(!this.props.timelineSet.room)return null;const e=this.messagePanel.current.getReadMarkerPosition();if(null!==e)return e;const t=yr.roomReadMarkerTsMap[this.props.timelineSet.room.roomId];return t&&this.state.events.length>0?t<this.state.events[0].getTs()?-1:1:null})),i()(this,"canJumpToReadMarker",(()=>{const e=this.getReadMarkerPosition();return null!==this.state.readMarkerEventId&&(null===e||e<0)})),i()(this,"handleScrollKey",(e=>{if(!this.messagePanel.current)return;Object(Q.a)().getRoomAction(e)===z.h.JumpToLatestMessage?this.jumpToLiveTimeline():this.messagePanel.current.handleScrollKey(e)})),i()(this,"getRelationsForEvent",((e,t,n)=>{var a;return null===(a=this.props.timelineSet.relations)||void 0===a?void 0:a.getChildEventsForEvent(e,t,n)})),this.context=t,br("mounting"),this.props.manageReadMarkers){var a;const e=null===(a=this.props.timelineSet.room)||void 0===a?void 0:a.getAccountData("m.fully_read");this.initialReadMarkerId=e?e.getContent().event_id:this.getCurrentReadReceipt()}this.state={events:[],liveEvents:[],timelineLoading:!0,firstVisibleEventIndex:0,canBackPaginate:!1,canForwardPaginate:!1,readMarkerVisible:!0,readMarkerEventId:this.initialReadMarkerId,backPaginating:!1,forwardPaginating:!1,clientSyncState:tt.a.safeGet().getSyncState(),isTwelveHour:v.b.getValue("showTwelveHourTimestamps"),alwaysShowTimestamps:v.b.getValue("alwaysShowTimestamps"),readMarkerInViewThresholdMs:v.b.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:v.b.getValue("readMarkerOutOfViewThresholdMs")},this.dispatcherRef=b.a.register(this.onAction);const o=tt.a.safeGet();o.on(l.RoomEvent.Timeline,this.onRoomTimeline),o.on(l.RoomEvent.TimelineReset,this.onRoomTimelineReset),o.on(l.RoomEvent.Redaction,this.onRoomRedaction),v.b.getValue("feature_msc3531_hide_messages_pending_moderation")&&(o.on(l.MatrixEventEvent.VisibilityChange,this.onEventVisibilityChange),o.on(l.RoomMemberEvent.PowerLevel,this.onVisibilityPowerLevelChange)),o.on(l.RoomEvent.RedactionCancelled,this.onRoomRedaction),o.on(l.RoomEvent.Receipt,this.onRoomReceipt),o.on(l.RoomEvent.LocalEchoUpdated,this.onLocalEchoUpdated),o.on(l.RoomEvent.AccountData,this.onAccountData),o.on(l.MatrixEventEvent.Decrypted,this.onEventDecrypted),o.on(l.MatrixEventEvent.Replaced,this.onEventReplaced),o.on(s.b.Sync,this.onSync),null===(n=this.props.timelineSet.room)||void 0===n||n.on(dn.f.Update,this.onThreadUpdate)}componentDidMount(){this.props.manageReadReceipts&&this.updateReadReceiptOnUserActivity(),this.props.manageReadMarkers&&this.updateReadMarkerOnUserActivity(),this.initTimeline(this.props)}componentDidUpdate(e){var t,n;e.timelineSet!==this.props.timelineSet&&on.a.warn("Replacing timelineSet on a TimelinePanel - confusion may ensue"),null===(t=this.props.timelineSet.room)||void 0===t||t.off(dn.f.Update,this.onThreadUpdate),null===(n=this.props.timelineSet.room)||void 0===n||n.on(dn.f.Update,this.onThreadUpdate);const a=e.eventId!=this.props.eventId,i=e.highlightedEventId!=this.props.highlightedEventId,r=e.eventScrollIntoView&&!this.props.eventScrollIntoView,o=e.overlayTimelineSet!==this.props.overlayTimelineSet;a||i||r?(on.a.log(`TimelinePanel switching to eventId ${this.props.eventId} (was ${e.eventId}), scrollIntoView: ${this.props.eventScrollIntoView} (was ${e.eventScrollIntoView})`),this.initTimeline(this.props)):o&&(on.a.log("TimelinePanel updating overlay timeline."),this.initTimeline(this.props))}componentWillUnmount(){this.unmounted=!0,this.readReceiptActivityTimer&&(this.readReceiptActivityTimer.abort(),this.readReceiptActivityTimer=null),this.readMarkerActivityTimer&&(this.readMarkerActivityTimer.abort(),this.readMarkerActivityTimer=null),b.a.unregister(this.dispatcherRef);const e=tt.a.get();var t;e&&(e.removeListener(l.RoomEvent.Timeline,this.onRoomTimeline),e.removeListener(l.RoomEvent.TimelineReset,this.onRoomTimelineReset),e.removeListener(l.RoomEvent.Redaction,this.onRoomRedaction),e.removeListener(l.RoomEvent.RedactionCancelled,this.onRoomRedaction),e.removeListener(l.RoomEvent.Receipt,this.onRoomReceipt),e.removeListener(l.RoomEvent.LocalEchoUpdated,this.onLocalEchoUpdated),e.removeListener(l.RoomEvent.AccountData,this.onAccountData),e.removeListener(l.RoomMemberEvent.PowerLevel,this.onVisibilityPowerLevelChange),e.removeListener(l.MatrixEventEvent.Decrypted,this.onEventDecrypted),e.removeListener(l.MatrixEventEvent.Replaced,this.onEventReplaced),e.removeListener(l.MatrixEventEvent.VisibilityChange,this.onEventVisibilityChange),e.removeListener(s.b.Sync,this.onSync),null===(t=this.props.timelineSet.room)||void 0===t||t.removeListener(dn.f.Update,this.onThreadUpdate))}hasTimelineSetFor(e){var t,n,a;return void 0!==e&&e===(null===(t=this.props.timelineSet.room)||void 0===t?void 0:t.roomId)||e===(null===(n=this.props.overlayTimelineSet)||void 0===n||null===(a=n.room)||void 0===a?void 0:a.roomId)}readMarkerTimeout(e){var t,n,a,i;return 0===e?null!==(t=null===(n=this.context)||void 0===n?void 0:n.readMarkerInViewThresholdMs)&&void 0!==t?t:this.state.readMarkerInViewThresholdMs:null!==(a=null===(i=this.context)||void 0===i?void 0:i.readMarkerOutOfViewThresholdMs)&&void 0!==a?a:this.state.readMarkerOutOfViewThresholdMs}async updateReadMarkerOnUserActivity(){const e=this.readMarkerTimeout(this.getReadMarkerPosition());for(this.readMarkerActivityTimer=new hr.a(e);this.readMarkerActivityTimer;){mr.a.sharedInstance().timeWhileActiveRecently(this.readMarkerActivityTimer);try{await this.readMarkerActivityTimer.finished()}catch(e){continue}await this.updateReadMarker()}}async updateReadReceiptOnUserActivity(){for(this.readReceiptActivityTimer=new hr.a(500);this.readReceiptActivityTimer;){mr.a.sharedInstance().timeWhileActiveNow(this.readReceiptActivityTimer);try{await this.readReceiptActivityTimer.finished()}catch(e){continue}await this.sendReadReceipts()}}async determineReceiptType(e){var t,n;const a=null!==(t=null===(n=this.props.timelineSet.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null;return v.b.getValue("sendReadReceipts",a)?ur.b.Read:await e.doesServerSupportUnstableFeature("org.matrix.msc2285.stable")&&await e.isVersionSupported("v1.4")?ur.b.ReadPrivate:(on.a.warn("Falling back to public instead of private receipts because the homeserver does not support them"),ur.b.Read)}shouldSendFullyReadMarker(e){return!!this.state.readMarkerEventId&&((!this.lastRMSentEventId||this.lastRMSentEventId!==this.state.readMarkerEventId)&&((!this.state.readMarkerEventId||this.state.readMarkerEventId!==this.initialReadMarkerId)&&!this.props.timelineSet.thread))}shouldSendReadReceipt(e,t,n,a){var i;return!!n&&((!e||null!==t||null===(i=this.timelineWindow)||void 0===i||!i.canPaginate(l.EventTimeline.FORWARDS))&&((null===a||null===t||a>t)&&(!this.lastRRSentEventId||this.lastRRSentEventId!==(null==n?void 0:n.getId()))))}async sendReadReceipt(e,t){this.lastRRSentEventId=t.getId();const n=await this.determineReceiptType(e);try{await e.sendReadReceipt(t,n)}catch(e){var a;this.lastRRSentEventId=void 0,on.a.error("Error sending receipt",{room:null===(a=this.props.timelineSet.room)||void 0===a?void 0:a.roomId,error:e})}}async sendFullyReadMarker(e,t,n){this.lastRMSentEventId=this.state.readMarkerEventId;try{await e.setRoomReadMarkers(t,n)}catch(e){this.lastRMSentEventId=void 0,on.a.error("Error sending fully_read",{roomId:t,error:e})}}advanceReadMarkerPastMyEvents(){if(!this.props.manageReadMarkers||!this.timelineWindow)return;const e=this.timelineWindow.getEvents();let t;for(t=0;t<e.length&&e[t].getId()!=this.state.readMarkerEventId;t++);if(t>=e.length)return;const n=tt.a.safeGet().credentials.userId;for(t++;t<e.length;t++){if(e[t].getSender()!==n)break}t--;const a=e[t];this.setReadMarker(a.getId(),a.getTs())}initTimeline(e){const t=e.eventId,n=e.eventPixelOffset;let a=1;return null==n&&(a=.5),this.loadTimeline(t,n,a,e.eventScrollIntoView)}scrollIntoView(e,t,n){var a,i;const r=()=>{this.messagePanel.current&&(e?(br("TimelinePanel scrolling to eventId "+e+" at position "+100*n+"% + "+t),this.messagePanel.current.scrollToEvent(e,t,n)):(br("TimelinePanel scrolling to bottom"),this.messagePanel.current.scrollToBottom()))};br("TimelinePanel scheduling scroll to event"),null===(a=(i=this.props).onEventScrolledIntoView)||void 0===a||a.call(i,e),r(),window.requestAnimationFrame((()=>{r()}))}async extendOverlayWindowToCoverMainWindow(){const e=this.timelineWindow,t=this.overlayTimelineWindow,n=e.getEvents();if(n.length>0){let a;do{a=[];const i=t.getEvents();!t.canPaginate(l.EventTimeline.BACKWARDS)||0!==i.length&&!fr(i[0],n[0])&&e.canPaginate(l.EventTimeline.BACKWARDS)||a.push(this.onPaginationRequest(t,l.EventTimeline.BACKWARDS,50)),!t.canPaginate(l.EventTimeline.FORWARDS)||0!==i.length&&!vr(i.at(-1),n.at(-1))&&e.canPaginate(l.EventTimeline.FORWARDS)||a.push(this.onPaginationRequest(t,l.EventTimeline.FORWARDS,50)),await Promise.all(a)}while(a.length>0)}}loadTimeline(e,t,n,a=!0){const i=tt.a.safeGet();this.timelineWindow=new dr.b(i,this.props.timelineSet,{windowLimit:this.props.timelineCap}),this.overlayTimelineWindow=this.props.overlayTimelineSet?new dr.b(i,this.props.overlayTimelineSet,{windowLimit:this.props.timelineCap}):void 0;const r=()=>{var i,r,o,s,c,d,u;this.unmounted||(null===(i=this.messagePanel.current)||void 0===i||i.onTimelineReset(),this.reloadEvents(),this.advanceReadMarkerPastMyEvents(),this.setState({canBackPaginate:null!==(r=(null===(o=this.timelineWindow)||void 0===o?void 0:o.canPaginate(l.EventTimeline.BACKWARDS))||(null===(s=this.overlayTimelineWindow)||void 0===s?void 0:s.canPaginate(l.EventTimeline.BACKWARDS)))&&void 0!==r&&r,canForwardPaginate:null!==(c=(null===(d=this.timelineWindow)||void 0===d?void 0:d.canPaginate(l.EventTimeline.FORWARDS))||(null===(u=this.overlayTimelineWindow)||void 0===u?void 0:u.canPaginate(l.EventTimeline.FORWARDS)))&&void 0!==c&&c,timelineLoading:!1},(()=>{this.messagePanel.current?(a&&this.scrollIntoView(e,t,n),this.props.sendReadReceiptOnLoad&&this.sendReadReceipts().catch((e=>{on.a.warn("Error sending receipts on load",e)}))):on.a.log("can't initialise scroll state because messagePanel didn't load")})))};if(this.props.timelineSet.getTimelineForEvent(e)&&!this.overlayTimelineWindow)return this.timelineWindow.load(e,30),void r();const o=this.timelineWindow.load(e,30).then((async()=>{this.overlayTimelineWindow&&(await this.overlayTimelineWindow.load(void 0,30),await this.extendOverlayWindowToCoverMainWindow())}));this.buildLegacyCallEventGroupers(),this.setState({events:[],liveEvents:[],canBackPaginate:!1,canForwardPaginate:!1,timelineLoading:!0}),o.then(r,(t=>{var n;if(this.unmounted)return;let a,i;this.setState({timelineLoading:!1}),on.a.error(`Error loading timeline panel at ${null===(n=this.props.timelineSet.room)||void 0===n?void 0:n.roomId}/${e}`,t),e&&this.props.timelineSet.room&&(a=()=>{b.a.dispatch({action:F.a.ViewRoom,room_id:this.props.timelineSet.room.roomId,metricsTrigger:void 0})}),i="M_FORBIDDEN"==t.errcode?Object(N.b)("Tried to load a specific point in this room's timeline, but you do not have permission to view the message in question."):Object(N.b)("Tried to load a specific point in this room's timeline, but was unable to find it."),H.b.createDialog(Dn.a,{title:Object(N.b)("Failed to load timeline position"),description:i,onFinished:a})}))}reloadEvents(){if(this.unmounted)return;const e=this.getEvents();this.buildLegacyCallEventGroupers(e.events),this.setState(e)}refreshTimeline(e){this.loadTimeline(e,void 0,void 0,!1),this.reloadEvents()}getEvents(){var e,t;const n=this.timelineWindow.getEvents();let a=null!==(e=null===(t=this.overlayTimelineWindow)||void 0===t?void 0:t.getEvents())&&void 0!==e?e:[];void 0!==this.props.overlayTimelineSetFilter&&(a=a.filter(this.props.overlayTimelineSetFilter));const i=a.reduce(((e,t)=>{const n=e.findIndex((e=>vr(t,e)));return-1===n?this.timelineWindow.canPaginate(l.EventTimeline.FORWARDS)||e.push(t):0===n?this.timelineWindow.canPaginate(l.EventTimeline.BACKWARDS)||e.unshift(t):e.splice(n,0,t),e}),[...n]);Object(Wn.b)(i).reverse().forEach((e=>{tt.a.safeGet().decryptEventIfNeeded(e)}));const r=this.checkForPreJoinUISI(i),o=[...i];if(!this.timelineWindow.canPaginate(l.EventTimeline.FORWARDS)){const e=this.props.timelineSet.getPendingEvents();i.push(...e.filter((t=>{const{shouldLiveInRoom:n,threadId:a}=this.props.timelineSet.room.eventShouldLiveIn(t,e);return this.context.timelineRenderingType===In.a.Thread?a===this.context.threadId:n})))}return{events:i,liveEvents:o,firstVisibleEventIndex:r}}checkForPreJoinUISI(e){const t=tt.a.safeGet(),n=this.props.timelineSet.room,a=[In.a.Thread,In.a.ThreadsList].includes(this.context.timelineRenderingType);if(0===e.length||!n||!t.isRoomEncrypted(n.roomId)||a)return on.a.debug("checkForPreJoinUISI: showing all messages, skipping check"),0;const i=t.getSafeUserId();let r=e.length-1,o="leave";for(;r>=0;r--){var s,c,d;const t=this.props.timelineSet.getTimelineForEvent(e[r].getId());if(!t){on.a.warn(`Event ${e[r].getId()} in room ${n.roomId} is live, but it does not have a timeline`);continue}o=null!==(s=null===(c=t.getState(l.EventTimeline.FORWARDS))||void 0===c||null===(d=c.getMember(i))||void 0===d?void 0:d.membership)&&void 0!==s?s:"leave";const a=t.getEvents();for(let t=a.length-1;t>=0;t--){const n=a[t];if(n.getId()===e[r].getId())break;n.getStateKey()===i&&n.getType()===l.EventType.RoomMember&&(o=n.getPrevContent().membership||"leave")}break}for(;r>=0;r--){const t=e[r];if(t.getStateKey()===i&&t.getType()===l.EventType.RoomMember)o=t.getPrevContent().membership||"leave";else if("leave"===o&&(t.isDecryptionFailure()||t.isBeingDecrypted()))return on.a.debug("checkForPreJoinUISI: reached a pre-join UISI at index ",r),r+1}return on.a.debug("checkForPreJoinUISI: did not find pre-join UISI"),0}indexForEventId(e){if(null===e)return null;if(this.context.timelineRenderingType===In.a.Thread)return 0;const t=this.state.events.findIndex((t=>t.getId()===e));return t>-1?t:null}getVisibleDecryptionFailures(e){const t=this.messagePanel.current;if(!t)return null;const n=Pi.a.findDOMNode(t);if(!n)return null;const a=n.getBoundingClientRect(),i=e?100:0,r=a.top-i,o=a.bottom+i,s=[];for(const e of this.state.liveEvents){const n=e.getId();if(!n)continue;const a=t.getNodeForEventId(n);if(!a)continue;const i=a.getBoundingClientRect();if(i.top>o)break;i.bottom>=r&&e.isDecryptionFailure()&&s.push(e)}return s}getLastDisplayedEventIndex(e={}){const t=e.ignoreOwn||!1,n=e.allowPartial||!1,a=this.messagePanel.current;if(!a)return null;const i=Pi.a.findDOMNode(a);if(!i)return null;const r=i.getBoundingClientRect(),o=tt.a.safeGet().credentials.userId,s=e=>{if(e){const t=e.getBoundingClientRect();if(n&&t.top<=r.bottom||!n&&t.bottom<=r.bottom)return!0}return!1};let l=0;for(let e=this.state.liveEvents.length-1;e>=0;--e){var c;const n=this.state.liveEvents[e],i=a.getNodeForEventId(n.getId()),r=s(i);if(r&&0!==l)return e+l;i&&!r&&(l=0);const d=!!n.status||t&&n.getSender()===o;if(!(!Object(ri.c)(n,tt.a.safeGet(),null===(c=this.context)||void 0===c?void 0:c.showHiddenEvents)||Object(un.a)(n,this.context))&&i){if(!d&&r)return e}else(!d||d&&0!==l)&&++l}return null}getCurrentReadReceipt(e=!1){var t,n;const a=tt.a.get();if(null==a)return null;const i=a.getSafeUserId(),r=null!==(t=this.props.timelineSet.thread)&&void 0!==t?t:this.props.timelineSet.room;return null!==(n=null==r?void 0:r.getEventReadUpTo(i,e))&&void 0!==n?n:null}setReadMarker(e,t,n=!1){var a;const i=null===(a=this.props.timelineSet.room)||void 0===a?void 0:a.roomId;e!==this.state.readMarkerEventId&&null!==e&&(void 0!==t?yr.roomReadMarkerTsMap[null!=i?i:""]=t:delete yr.roomReadMarkerTsMap[null!=i?i:""],n||this.setState({readMarkerEventId:e},this.props.onReadMarkerUpdated))}shouldPaginate(){return!this.state.events.some((e=>e.isBeingDecrypted()))}buildLegacyCallEventGroupers(e){this.callEventGroupers=Object(gr.b)(this.callEventGroupers,e)}render(){var e,t,n,a,i,r;if(this.state.timelineLoading)return o.a.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},o.a.createElement(Ma.a,null));if(0==this.state.events.length&&!this.state.canBackPaginate&&this.props.empty)return o.a.createElement("div",{className:this.props.className+" mx_RoomView_messageListWrapper"},o.a.createElement("div",{className:"mx_RoomView_empty"},this.props.empty));const s=!(null!==(e=this.timelineWindow)&&void 0!==e&&e.canPaginate(l.EventTimeline.FORWARDS)),c=this.state.forwardPaginating||["PREPARED","CATCHUP"].includes(this.state.clientSyncState),d=this.state.firstVisibleEventIndex?this.state.events.slice(this.state.firstVisibleEventIndex):this.state.events;return o.a.createElement(pr.a,{ref:this.messagePanel,room:this.props.timelineSet.room,permalinkCreator:this.props.permalinkCreator,hidden:this.props.hidden,backPaginating:this.state.backPaginating,forwardPaginating:c,events:d,highlightedEventId:this.props.highlightedEventId,readMarkerEventId:this.state.readMarkerEventId,readMarkerVisible:this.state.readMarkerVisible,canBackPaginate:this.state.canBackPaginate&&0===this.state.firstVisibleEventIndex,showUrlPreview:this.props.showUrlPreview,showReadReceipts:this.props.showReadReceipts,ourUserId:tt.a.safeGet().getSafeUserId(),stickyBottom:s,onScroll:this.onMessageListScroll,onFillRequest:this.onMessageListFillRequest,onUnfillRequest:this.onMessageListUnfillRequest,isTwelveHour:null!==(t=null===(n=this.context)||void 0===n?void 0:n.showTwelveHourTimestamps)&&void 0!==t?t:this.state.isTwelveHour,alwaysShowTimestamps:null!==(a=null!==(i=this.props.alwaysShowTimestamps)&&void 0!==i?i:null===(r=this.context)||void 0===r?void 0:r.alwaysShowTimestamps)&&void 0!==a?a:this.state.alwaysShowTimestamps,className:this.props.className,resizeNotifier:this.props.resizeNotifier,getRelationsForEvent:this.getRelationsForEvent,editState:this.props.editState,showReactions:this.props.showReactions,layout:this.props.layout,hideThreadedMessages:this.props.hideThreadedMessages,disableGrouping:this.props.disableGrouping,callEventGroupers:this.callEventGroupers})}}function Er(e){return e.map((e=>{const t={},n=e.getTimelines(),a=e.getLiveTimeline();return n.forEach(((e,n)=>{t[e===a?"liveTimeline":`${n}`]=e.getEvents().map((e=>e.getId()))})),t}))}i()(yr,"contextType",In.b),i()(yr,"roomReadMarkerTsMap",{}),i()(yr,"defaultProps",{timelineCap:Number.MAX_VALUE,className:"mx_RoomView_messagePanel",sendReadReceiptOnLoad:!0,hideThreadedMessages:!0,disableGrouping:!1});var wr=yr,Sr=n(256);class _r extends o.a.PureComponent{constructor(e){super(e),i()(this,"instanceId",void 0),i()(this,"onResize",((e,t)=>{e===X.a.Resize&&this.props.onMeasurement(t.contentRect.width<=this.props.breakpoint)})),this.instanceId=_r.instanceCount++}componentDidMount(){X.b.instance.on(`Measured${this.instanceId}`,this.onResize)}componentDidUpdate(e){const t=e.sensor,n=this.props.sensor;t!==n&&(t&&X.b.instance.stopTrackingElementDimensions(`Measured${this.instanceId}`),n&&X.b.instance.trackElementDimensions(`Measured${this.instanceId}`,this.props.sensor))}componentWillUnmount(){X.b.instance.off(`Measured${this.instanceId}`,this.onResize),X.b.instance.stopTrackingElementDimensions(`Measured${this.instanceId}`)}render(){return null}}function Cr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Or(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Cr(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Cr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}i()(_r,"instanceCount",0),i()(_r,"defaultProps",{breakpoint:500});class xr extends o.a.Component{constructor(...e){super(...e),i()(this,"decryptingEvents",new Set),i()(this,"noRoom",!1),i()(this,"card",Object(r.createRef)()),i()(this,"state",{timelineSet:null,narrow:!1}),i()(this,"onRoomTimeline",((e,t,n,a,i)=>{if((null==t?void 0:t.roomId)!==this.props.roomId)return;if(n||!i||!i.liveEvent||e.isRedacted())return;tt.a.safeGet().decryptEventIfNeeded(e),e.isBeingDecrypted()?this.decryptingEvents.add(e.getId()):this.addEncryptedLiveEvent(e)})),i()(this,"onEventDecrypted",((e,t)=>{if(e.getRoomId()!==this.props.roomId)return;const n=e.getId();this.decryptingEvents.delete(n)&&(t||this.addEncryptedLiveEvent(e))})),i()(this,"onPaginationRequest",((e,t,n)=>{const a=tt.a.safeGet(),i=sr.a.get(),r=this.props.roomId,o=a.getRoom(r);return o&&a.isRoomEncrypted(r)&&null!==i?i.paginateTimelineWindow(o,e,t,n):e.paginate(t,n)})),i()(this,"onMeasurement",(e=>{this.setState({narrow:e})}))}addEncryptedLiveEvent(e){if(!this.state.timelineSet)return;const t=this.state.timelineSet.getLiveTimeline();"m.room.message"===e.getType()&&["m.file","m.image","m.video","m.audio"].includes(e.getContent().msgtype)&&(this.state.timelineSet.eventIdToTimeline(e.getId())||this.state.timelineSet.addEventToTimeline(e,t,!1))}async componentDidMount(){const e=tt.a.safeGet();await this.updateTimelineSet(this.props.roomId),e.isRoomEncrypted(this.props.roomId)&&null!==sr.a.get()&&(e.on(l.RoomEvent.Timeline,this.onRoomTimeline),e.on(l.MatrixEventEvent.Decrypted,this.onEventDecrypted))}componentWillUnmount(){const e=tt.a.get();null!==e&&e.isRoomEncrypted(this.props.roomId)&&null!==sr.a.get()&&(e.removeListener(l.RoomEvent.Timeline,this.onRoomTimeline),e.removeListener(l.MatrixEventEvent.Decrypted,this.onEventDecrypted))}async fetchFileEventsServer(e){const t=tt.a.safeGet(),n=new or.a(t.getSafeUserId());return n.setDefinition({room:{timeline:{contains_url:!0,types:["m.room.message"]}}}),n.filterId=await t.getOrCreateFilter("FILTER_FILES_"+t.credentials.userId,n),e.getOrCreateFilteredTimelineSet(n)}async updateTimelineSet(e){const t=tt.a.safeGet(),n=t.getRoom(e),a=sr.a.get();if(this.noRoom=!n,n){let i;try{if(i=await this.fetchFileEventsServer(n),t.isRoomEncrypted(e)&&null!==a){const e=i.getLiveTimeline();await a.populateFileTimeline(i,e,n,10)}this.setState({timelineSet:i})}catch(e){on.a.error("Failed to get or create file panel filter",e)}}else on.a.error("Failed to add filtered timelineSet for FilePanel as no room!")}render(){if(tt.a.safeGet().isGuest())return o.a.createElement(En.b,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose},o.a.createElement("div",{className:"mx_RoomView_empty"},Object(N.b)("You must <a>register</a> to use this functionality",{},{a:e=>o.a.createElement("a",{href:"#/register",key:"sub"},e)})));if(this.noRoom)return o.a.createElement(En.b,{className:"mx_FilePanel mx_RoomView_messageListWrapper",onClose:this.props.onClose},o.a.createElement("div",{className:"mx_RoomView_empty"},Object(N.b)("You must join the room to see its files")));const e=o.a.createElement("div",{className:"mx_RightPanel_empty mx_FilePanel_empty"},o.a.createElement("h2",null,Object(N.b)("No files visible in this room")),o.a.createElement("p",null,Object(N.b)("Attach files from chat or just drag and drop them anywhere in a room."))),t=!this.noRoom&&tt.a.safeGet().isRoomEncrypted(this.props.roomId);return this.state.timelineSet?o.a.createElement(In.b.Provider,{value:Or(Or({},this.context),{},{timelineRenderingType:In.a.File,narrow:this.state.narrow})},o.a.createElement(En.b,{className:"mx_FilePanel",onClose:this.props.onClose,withoutScrollContainer:!0,ref:this.card},this.card.current&&o.a.createElement(_r,{sensor:this.card.current,onMeasurement:this.onMeasurement}),o.a.createElement(cr,{isRoomEncrypted:t,kind:lr.Files}),o.a.createElement(wr,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:this.state.timelineSet,showUrlPreview:!1,onPaginationRequest:this.onPaginationRequest,resizeNotifier:this.props.resizeNotifier,empty:e,layout:Sr.a.Group}))):o.a.createElement(In.b.Provider,{value:Or(Or({},this.context),{},{timelineRenderingType:In.a.File})},o.a.createElement(En.b,{className:"mx_FilePanel",onClose:this.props.onClose},o.a.createElement(Ma.a,null)))}}i()(xr,"contextType",In.b);var kr=xr;class Rr extends o.a.Component{constructor(e){super(e),i()(this,"resize",(()=>{this.props.onResize&&this.props.onResize()}))}componentDidMount(){window.addEventListener("resize",this.resize)}componentWillUnmount(){window.removeEventListener("resize",this.resize)}render(){return o.a.createElement("div",null,this.props.element)}}const jr="stickerPicker";class Ir extends o.a.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"prevSentVisibility",void 0),i()(this,"popoverWidth",300),i()(this,"popoverHeight",300),i()(this,"scalarClient",null),i()(this,"removeStickerpickerWidgets",(async()=>{const e=await this.acquireScalarClient();on.a.log("Removing Stickerpicker widgets"),this.state.widgetId?e?e.disableWidgetAssets(Mn.a.STICKERPICKER,this.state.widgetId).then((()=>{on.a.log("Assets disabled")})).catch((()=>{on.a.error("Failed to disable assets")})):on.a.error("Cannot disable assets: no scalar client"):on.a.warn("No widget ID specified, not disabling assets"),this.props.setStickerPickerOpen(!1),Sn.a.removeStickerpickerWidgets(this.props.room.client).then((()=>{this.forceUpdate()})).catch((e=>{on.a.error("Failed to remove sticker picker widget",e)}))})),i()(this,"updateWidget",(()=>{var e,t,n,a;const i=Sn.a.getStickerpickerWidgets(this.props.room.client)[0];if(!i)return Ir.currentWidget=void 0,void this.setState({stickerpickerWidget:null,widgetId:null});const r=Ir.currentWidget,o=null!==(e=null==r||null===(t=r.content)||void 0===t?void 0:t.url)&&void 0!==e?e:null;(null!==(n=null==i||null===(a=i.content)||void 0===a?void 0:a.url)&&void 0!==n?n:null)!==o&&Di.destroyElement(jr),Ir.currentWidget=i,this.setState({stickerpickerWidget:i,widgetId:i?i.id:null})})),i()(this,"onAction",(e=>{switch(e.action){case"user_widget_updated":this.forceUpdate();break;case"stickerpicker_close":case"show_left_panel":case"hide_left_panel":this.props.setStickerPickerOpen(!1)}})),i()(this,"onRightPanelStoreUpdate",(()=>{this.props.setStickerPickerOpen(!1)})),i()(this,"onResize",(()=>{this.props.isStickerPickerOpen&&this.props.setStickerPickerOpen(!1)})),i()(this,"onFinished",(()=>{this.props.isStickerPickerOpen&&this.props.setStickerPickerOpen(!1)})),i()(this,"launchManageIntegrations",(()=>{var e,t,n;null===(e=_n.a.sharedInstance())||void 0===e||null===(t=e.getPrimaryManager())||void 0===t||t.open(this.props.room,`type_${Mn.a.STICKERPICKER.preferred}`,null!==(n=this.state.widgetId)&&void 0!==n?n:void 0)})),this.state={imError:null,stickerpickerWidget:null,widgetId:null}}async acquireScalarClient(){return this.scalarClient?Promise.resolve(this.scalarClient):_n.a.sharedInstance().hasManager()?(this.scalarClient=null!==(e=null===(t=_n.a.sharedInstance().getPrimaryManager())||void 0===t?void 0:t.getScalarClient())&&void 0!==e?e:null,null===(n=this.scalarClient)||void 0===n?void 0:n.connect().then((()=>(this.forceUpdate(),this.scalarClient))).catch((e=>{this.imError(Object(N.d)("Failed to connect to integration manager"),e)}))):void _n.a.sharedInstance().openNoManagerDialog();var e,t,n}componentDidMount(){window.addEventListener("resize",this.onResize),this.dispatcherRef=b.a.register(this.onAction),tt.a.safeGet().on(s.b.AccountData,this.updateWidget),fn.a.instance.on(ft.b,this.onRightPanelStoreUpdate),this.updateWidget()}componentWillUnmount(){const e=tt.a.get();e&&e.removeListener(s.b.AccountData,this.updateWidget),fn.a.instance.off(ft.b,this.onRightPanelStoreUpdate),window.removeEventListener("resize",this.onResize),this.dispatcherRef&&b.a.unregister(this.dispatcherRef)}componentDidUpdate(){this.sendVisibilityToWidget(this.props.isStickerPickerOpen)}imError(e,t){on.a.error(e,t),this.setState({imError:Object(N.b)(e)}),this.props.setStickerPickerOpen(!1)}defaultStickerpickerContent(){return o.a.createElement(K.a,{onClick:this.launchManageIntegrations,className:"mx_Stickers_contentPlaceholder"},o.a.createElement("p",null,Object(N.b)("You don't currently have any stickerpacks enabled")),o.a.createElement("p",{className:"mx_Stickers_addLink"},Object(N.b)("Add some now")),o.a.createElement("img",{src:n(1542),alt:""}))}errorStickerpickerContent(){return o.a.createElement("div",{style:{textAlign:"center"},className:"error"},o.a.createElement("p",null," ",this.state.imError," "))}sendVisibilityToWidget(e){if(!this.state.stickerpickerWidget)return;const t=Nn.a.instance.getMessagingForUid(Sn.a.calcWidgetUid(this.state.stickerpickerWidget.id));t&&e!==this.prevSentVisibility&&(t.updateVisibility(e).catch((e=>{on.a.error("Error updating widget visibility: ",e)})),this.prevSentVisibility=e)}getStickerpickerContent(){var e;if(this.state.imError)return this.errorStickerpickerContent();const t=this.state.stickerpickerWidget;let n;if(null!=t&&null!==(e=t.content)&&void 0!==e&&e.url){t.content.name=t.content.name||Object(N.b)("Stickerpack");const e={id:t.id,url:t.content.url,name:t.content.name,type:t.content.type,data:t.content.data,creatorUserId:t.content.creatorUserId||t.sender};n=o.a.createElement("div",{className:"mx_Stickers_content_container"},o.a.createElement("div",{id:"stickersContent",className:"mx_Stickers_content",style:{border:"none",height:this.popoverHeight,width:this.popoverWidth}},o.a.createElement(Di,{persistKey:jr,zIndex:3500},o.a.createElement(qi,{app:e,room:this.props.room,threadId:this.props.threadId,fullWidth:!0,userId:tt.a.safeGet().credentials.userId,creatorUserId:t.sender||tt.a.safeGet().credentials.userId,waitForIframeLoad:!0,showMenubar:!0,onEditClick:this.launchManageIntegrations,onDeleteClick:this.removeStickerpickerWidgets,showTitle:!1,showPopout:!1,handleMinimisePointerEvents:!0,userWidget:!0,showLayoutButtons:!1}))))}else n=this.defaultStickerpickerContent();return n}render(){return this.props.isStickerPickerOpen?o.a.createElement(le.n,ee()({chevronFace:le.a.Bottom,menuWidth:this.popoverWidth,menuHeight:this.popoverHeight,onFinished:this.onFinished,menuPaddingTop:0,menuPaddingLeft:0,menuPaddingRight:0,zIndex:3500},this.props.menuPosition),o.a.createElement(Rr,{element:this.getStickerpickerContent(),onResize:this.onFinished})):null}}i()(Ir,"defaultProps",{threadId:null}),i()(Ir,"currentWidget",void 0);var Tr=n(1444);class Pr extends o.a.Component{render(){return this.props.replyToEvent?o.a.createElement("div",{className:"mx_ReplyPreview"},o.a.createElement("div",{className:"mx_ReplyPreview_section"},o.a.createElement("div",{className:"mx_ReplyPreview_header"},o.a.createElement("span",null,Object(N.b)("Replying")),o.a.createElement(K.a,{className:"mx_ReplyPreview_header_cancel",onClick:()=>{return e=this.context.timelineRenderingType,void b.a.dispatch({action:"reply_to_event",event:null,context:e});var e}})),o.a.createElement(Tr.a,{mxEvent:this.props.replyToEvent,permalinkCreator:this.props.permalinkCreator}))):null}}i()(Pr,"contextType",In.b);var Nr=n(347),Dr=n(791),Mr=n(428);class Ar extends o.a.PureComponent{constructor(e){super(e),i()(this,"waveform",[]),i()(this,"scheduledUpdate",new Mr.a((()=>this.updateWaveform()),(()=>requestAnimationFrame((()=>this.scheduledUpdate.trigger()))))),this.state={waveform:Object(Wn.g)(0,Nr.a)}}componentDidMount(){this.props.recorder.liveData.onUpdate((e=>{this.waveform=Object(Wn.c)(Array.from(e.waveform),Nr.a),this.scheduledUpdate.mark()}))}updateWaveform(){this.setState({waveform:this.waveform})}render(){return o.a.createElement(Dr.a,{relHeights:this.state.waveform})}}i()(Ar,"defaultProps",{progress:1});var Lr=n(222);class Ur extends o.a.PureComponent{constructor(e){super(e),i()(this,"seconds",0),i()(this,"scheduledUpdate",new Mr.a((()=>this.updateClock()),(()=>requestAnimationFrame((()=>this.scheduledUpdate.trigger()))))),this.state={seconds:0}}componentDidMount(){this.props.recorder.liveData.onUpdate((e=>{this.seconds=e.timeSeconds,this.scheduledUpdate.mark()}))}updateClock(){this.setState({seconds:this.seconds})}render(){return o.a.createElement(Lr.a,{seconds:this.state.seconds,"aria-live":"off"})}}var Fr=n(329),Br=n(104);class Vr{constructor(e,t){this.matrixClient=e,this.voiceRecording=t,i()(this,"lastUpload",void 0),i()(this,"buffer",new Uint8Array(0)),i()(this,"playback",void 0),i()(this,"onDataAvailable",(e=>{const t=new Uint8Array(e);this.buffer=Object(Wn.l)(this.buffer,t)})),this.voiceRecording.onDataAvailable=this.onDataAvailable}async start(){if(this.lastUpload||this.hasRecording)throw new Error("Recording already prepared");return this.voiceRecording.start()}async stop(){return await this.voiceRecording.stop(),this.audioBuffer}on(e,t){return this.voiceRecording.on(e,t),this}off(e,t){return this.voiceRecording.off(e,t),this}emit(e,...t){return this.voiceRecording.emit(e,...t)}get hasRecording(){return this.buffer.length>0}get isRecording(){return this.voiceRecording.isRecording}getPlayback(){return this.playback=Fr.a.for(this,"playback").do((()=>new Br.a(this.audioBuffer.buffer,this.voiceRecording.amplitudes))),this.playback}async upload(e){if(!this.hasRecording)throw new Error("No recording available to upload");if(this.lastUpload)return this.lastUpload;try{this.emit(Nr.b.Uploading);const{url:t,file:n}=await Object(hn.b)(this.matrixClient,e,new Blob([this.audioBuffer],{type:this.contentType}));this.lastUpload={mxc:t,encrypted:n},this.emit(Nr.b.Uploaded)}catch(e){throw this.emit(Nr.b.Ended),e}return this.lastUpload}get durationSeconds(){return this.voiceRecording.durationSeconds}get contentType(){return this.voiceRecording.contentType}get contentLength(){return this.buffer.length}get liveData(){return this.voiceRecording.liveData}get isSupported(){return this.voiceRecording.isSupported}destroy(){var e;null===(e=this.playback)||void 0===e||e.destroy(),this.voiceRecording.destroy()}get audioBuffer(){return this.buffer.slice(0)}}function Wr(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}function zr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Hr(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?zr(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):zr(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Gr extends sa.a{constructor(){super(b.a,{})}static get instance(){return this.internalInstance||(this.internalInstance=new Gr,this.internalInstance.start()),this.internalInstance}async onAction(e){}static getVoiceRecordingId(e,t){return"io.element.thread"===(null==t?void 0:t.rel_type)||(null==t?void 0:t.rel_type)===l.RelationType.Thread?e.roomId+"|"+t.event_id:e.roomId}getActiveRecording(e){return this.state[e]}startRecording(e){if(!this.matrixClient)throw new Error("Cannot start a recording without a MatrixClient");if(!e)throw new Error("Recording must be associated with a room");if(this.state[e])throw new Error("A recording is already in progress");const t=(n=this.matrixClient,new Vr(n,new Nr.d));var n;return this.updateState(Hr(Hr({},this.state),{},{[e]:t})),t}disposeRecording(e){var t;null===(t=this.state[e])||void 0===t||t.destroy();const n=this.state,{[e]:a}=n,i=ge()(n,[e].map(Wr));return this.reset(i)}}i()(Gr,"internalInstance",void 0),window.mxVoiceRecordingStore=Gr.instance;var Kr=n(821),qr=n(324),$r=n(220),Yr=n(345),Jr=n(141),Qr=n(775);class Xr extends o.a.PureComponent{constructor(e){super(e),i()(this,"context",void 0),i()(this,"voiceRecordingId",void 0),i()(this,"onCancel",(async()=>{await this.disposeRecording()})),i()(this,"onRecordStartEndClick",(async()=>{if(this.state.recorder)return void await this.state.recorder.stop();const e=()=>{H.b.createDialog(Dn.a,{title:Object(N.b)("Unable to access your microphone"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(N.b)("We were unable to access your microphone. Please check your browser settings and try again.")))})};try{var t;const e=await p.c.getDevices();if(null==e||null===(t=e[p.b.AudioInput])||void 0===t||!t.length)return void H.b.createDialog(Dn.a,{title:Object(N.b)("No microphone found"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(N.b)("We didn't find a microphone on your device. Please check your settings and try again.")))})}catch(t){return on.a.error("Error getting devices: ",t),void e()}try{qr.a.instance.pauseAllExcept();const e=Gr.instance.startRecording(this.voiceRecordingId);await e.start(),this.bindNewRecorder(e),this.setState({recorder:e,recordingPhase:Nr.b.Started})}catch(t){on.a.error("Error starting recording: ",t),e(),Gr.instance.disposeRecording(this.voiceRecordingId)}})),i()(this,"onRecordingUpdate",(e=>{e!==Nr.b.EndingSoon&&this.setState({recordingPhase:e})})),this.state={},this.voiceRecordingId=Gr.getVoiceRecordingId(this.props.room,this.props.relation)}componentDidMount(){const e=Gr.instance.getActiveRecording(this.voiceRecordingId);e&&(!e.isRecording&&e.hasRecording||on.a.warn("Cached recording hasn't ended yet and might cause issues"),this.bindNewRecorder(e),this.setState({recorder:e,recordingPhase:Nr.b.Ended}))}async componentWillUnmount(){const e=Gr.instance.getActiveRecording(this.voiceRecordingId);await(null==e?void 0:e.stop()),this.bindNewRecorder(null)}async send(){if(!this.state.recorder)throw new Error("No recording started - cannot send anything");const{replyToEvent:e,relation:t,permalinkCreator:n}=this.props;let a;await this.state.recorder.stop();try{a=await this.state.recorder.upload(this.voiceRecordingId)}catch(e){return on.a.error("Error uploading voice message:",e),void this.setState({didUploadFail:!0})}try{const i=Object(Qr.a)(a.mxc,this.state.recorder.contentType,Math.round(1e3*this.state.recorder.durationSeconds),this.state.recorder.contentLength,a.encrypted,this.state.recorder.getPlayback().thumbnailWaveform.map((e=>Math.round(1024*e))));Object(Yr.a)(tt.a.safeGet().getSafeUserId(),i,null,e),Object(Yr.b)(i,t),e&&(Object(Jr.a)(i,e,{permalinkCreator:n,includeLegacyFallback:!0}),b.a.dispatch({action:"reply_to_event",event:null,context:this.context.timelineRenderingType})),Object($r.a)(this.props.room.roomId,(e=>tt.a.safeGet().sendMessage(e,i)),this.props.room.client)}catch(e){on.a.error("Error sending voice message:",e)}await this.disposeRecording()}async disposeRecording(){await Gr.instance.disposeRecording(this.voiceRecordingId),this.setState({recorder:void 0,recordingPhase:void 0,didUploadFail:!1})}bindNewRecorder(e){this.state.recorder&&this.state.recorder.off(ft.b,this.onRecordingUpdate),e&&e.on(ft.b,this.onRecordingUpdate)}renderWaveformArea(){return this.state.recorder?this.state.recordingPhase!==Nr.b.Started?o.a.createElement(Kr.b,{playback:this.state.recorder.getPlayback(),layout:Kr.a.Composer}):o.a.createElement("div",{className:"mx_MediaBody mx_VoiceMessagePrimaryContainer mx_VoiceRecordComposerTile_recording"},o.a.createElement(Ur,{recorder:this.state.recorder}),o.a.createElement(Ar,{recorder:this.state.recorder})):null}render(){if(!this.state.recordingPhase)return null;let e,t,n;if(this.state.recordingPhase===Nr.b.Started){var a;let t=Object(N.b)("Send voice message");this.state.recorder&&(t=Object(N.b)("Stop recording")),e=o.a.createElement($.a,{className:"mx_VoiceRecordComposerTile_stop",onClick:this.onRecordStartEndClick,title:t}),!this.state.recorder||null!==(a=this.state.recorder)&&void 0!==a&&a.isRecording||(e=null)}return this.state.recorder&&this.state.recordingPhase!==Nr.b.Uploading&&(t=o.a.createElement($.a,{className:"mx_VoiceRecordComposerTile_delete",title:Object(N.b)("Delete"),onClick:this.onCancel})),this.state.recordingPhase===Nr.b.Uploading?n=o.a.createElement("span",{className:"mx_VoiceRecordComposerTile_uploadingState"},o.a.createElement(me.a,{w:16,h:16})):this.state.didUploadFail&&this.state.recordingPhase===Nr.b.Ended&&(n=o.a.createElement("span",{className:"mx_VoiceRecordComposerTile_failedState"},o.a.createElement("span",{className:"mx_VoiceRecordComposerTile_uploadState_badge"},o.a.createElement(we.a,{notification:_e.a.forSymbol("!",Ce.a.Red)})),o.a.createElement("span",{className:"text-warning"},Object(N.b)("Failed to send")))),o.a.createElement(o.a.Fragment,null,n,t,e,this.renderWaveformArea())}}i()(Xr,"contextType",In.b);var Zr=n(106),eo=n(1372),to=n(146),no=n(53),ao=n(819);let io=0;function ro(e){var t;return o.a.createElement($.a,{className:"mx_MessageComposer_sendMessage",onClick:e.onClick,title:null!==(t=e.title)&&void 0!==t?t:Object(N.b)("Send message"),"data-testid":"sendmessagebtn"})}class oo extends o.a.Component{constructor(e){super(e),i()(this,"tooltipId",`mx_MessageComposer_${Math.random()}`),i()(this,"dispatcherRef",void 0),i()(this,"messageComposerInput",Object(r.createRef)()),i()(this,"voiceRecordingButton",Object(r.createRef)()),i()(this,"ref",Object(r.createRef)()),i()(this,"instanceId",void 0),i()(this,"_voiceRecording",void 0),i()(this,"context",void 0),i()(this,"onResize",((e,t)=>{if(e===X.a.Resize){const{narrow:e}=this.context;this.setState({isMenuOpen:!!e&&this.state.isMenuOpen,isStickerPickerOpen:!1})}})),i()(this,"onAction",(e=>{switch(e.action){case"reply_to_event":e.context===this.context.timelineRenderingType&&window.setTimeout((()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()}),100);break;case F.a.SettingUpdated:{const t=e;switch(t.settingName){case"MessageComposerInput.showStickersButton":{const e=v.b.getValue("MessageComposerInput.showStickersButton");this.state.showStickersButton!==e&&this.setState({showStickersButton:e});break}case"MessageComposerInput.showPollsButton":{const e=v.b.getValue("MessageComposerInput.showPollsButton");this.state.showPollsButton!==e&&this.setState({showPollsButton:e});break}case no.a.VoiceBroadcast:this.state.showVoiceBroadcastButton!==t.newValue&&this.setState({showVoiceBroadcastButton:!!t.newValue});break;case"feature_wysiwyg_composer":this.state.isWysiwygLabEnabled!==t.newValue&&this.setState({isWysiwygLabEnabled:Boolean(t.newValue)})}}}})),i()(this,"onTombstoneClick",(e=>{var t,n;e.preventDefault();const a=null===(t=this.context.tombstone)||void 0===t?void 0:t.getContent().replacement_room,i=tt.a.safeGet().getRoom(a);let r;if(i){const e=i.currentState.getStateEvents(l.EventType.RoomCreate,"");null!=e&&e.getId()&&(r=e.getId())}const o=null===(n=this.context.tombstone)||void 0===n?void 0:n.getSender(),s=o?[o.split(":").slice(1).join(":")]:void 0;b.a.dispatch({action:F.a.ViewRoom,highlighted:!0,event_id:r,room_id:a,auto_join:!0,via_servers:s,metricsTrigger:"Tombstone",metricsViaKeyboard:"click"!==e.type})})),i()(this,"renderPlaceholderText",(()=>{if(this.props.replyToEvent){var e;const t=(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===dn.d.name;return t&&this.props.e2eStatus?Object(N.b)("Reply to encrypted thread…"):t?Object(N.b)("Reply to thread…"):this.props.e2eStatus?Object(N.b)("Send an encrypted reply…"):Object(N.b)("Send a reply…")}return this.props.e2eStatus?Object(N.b)("Send an encrypted message…"):Object(N.b)("Send a message…")})),i()(this,"addEmoji",(e=>(b.a.dispatch({action:F.a.ComposerInsert,text:e,timelineRenderingType:this.context.timelineRenderingType}),!0))),i()(this,"sendMessage",(async()=>{var e,t;if(this.state.haveRecording&&this.voiceRecordingButton.current)await(null===(t=this.voiceRecordingButton.current)||void 0===t?void 0:t.send());else if(null===(e=this.messageComposerInput.current)||void 0===e||e.sendMessage(),this.state.isWysiwygLabEnabled){const{permalinkCreator:e,relation:t,replyToEvent:n}=this.props,a=this.state.composerContent;this.setState({composerContent:"",initialComposerContent:""}),b.a.dispatch({action:F.a.ClearAndFocusSendMessageComposer,timelineRenderingType:this.context.timelineRenderingType}),await Object(ao.d)(a,this.state.isRichTextEnabled,{mxClient:this.props.mxClient,roomContext:this.context,permalinkCreator:e,relation:t,replyToEvent:n})}})),i()(this,"onChange",(e=>{this.setState({isComposerEmpty:e.isEmpty})})),i()(this,"onWysiwygChange",(e=>{this.setState({composerContent:e,isComposerEmpty:0===(null==e?void 0:e.length)})})),i()(this,"onRichTextToggle",(async()=>{const{richToPlain:e,plainToRich:t}=await Object(ao.c)(),{isRichTextEnabled:n,composerContent:a}=this.state,i=n?await e(a,!1):await t(a,!1);this.setState({isRichTextEnabled:!n,composerContent:i,initialComposerContent:i})})),i()(this,"onVoiceStoreUpdate",(()=>{this.updateRecordingState()})),i()(this,"onRecordingStarted",(()=>{const e=Gr.getVoiceRecordingId(this.props.room,this.props.relation);this.voiceRecording=Gr.instance.getActiveRecording(e),this.setState({haveRecording:!!this.voiceRecording})})),i()(this,"onRecordingEndingSoon",(({secondsLeft:e})=>{this.setState({recordingTimeLeftSeconds:e}),window.setTimeout((()=>this.setState({recordingTimeLeftSeconds:void 0})),3e3)})),i()(this,"setStickerPickerOpen",(e=>{this.setState({isStickerPickerOpen:e,isMenuOpen:!1})})),i()(this,"toggleStickerPickerOpen",(()=>{this.setStickerPickerOpen(!this.state.isStickerPickerOpen)})),i()(this,"toggleButtonMenu",(()=>{this.setState({isMenuOpen:!this.state.isMenuOpen})})),i()(this,"onRecordStartEndClick",(()=>{const e=Ze.b.instance.voiceBroadcastRecordingsStore.getCurrent();var t;e&&e.getState()!==_t.h.Stopped?H.b.createDialog(ot.a,{title:Object(N.b)("Can't start voice message"),description:o.a.createElement("p",null,Object(N.b)("You can't start a voice message as you are currently recording a live broadcast. Please end your live broadcast in order to start recording a voice message.")),hasCloseButton:!0}):null===(t=this.voiceRecordingButton.current)||void 0===t||t.onRecordStartEndClick();this.context.narrow&&this.toggleButtonMenu()})),Gr.instance.on(ft.b,this.onVoiceStoreUpdate),this.state={isComposerEmpty:!0,composerContent:"",haveRecording:!1,recordingTimeLeftSeconds:void 0,isMenuOpen:!1,isStickerPickerOpen:!1,showStickersButton:v.b.getValue("MessageComposerInput.showStickersButton"),showPollsButton:v.b.getValue("MessageComposerInput.showPollsButton"),showVoiceBroadcastButton:v.b.getValue(no.a.VoiceBroadcast),isWysiwygLabEnabled:v.b.getValue("feature_wysiwyg_composer"),isRichTextEnabled:!0,initialComposerContent:""},this.instanceId=io++,v.b.monitorSetting("MessageComposerInput.showStickersButton",null),v.b.monitorSetting("MessageComposerInput.showPollsButton",null),v.b.monitorSetting(no.a.VoiceBroadcast,null),v.b.monitorSetting("feature_wysiwyg_composer",null)}get voiceRecording(){return this._voiceRecording}set voiceRecording(e){this._voiceRecording&&(this._voiceRecording.off(Nr.b.Started,this.onRecordingStarted),this._voiceRecording.off(Nr.b.EndingSoon,this.onRecordingEndingSoon)),this._voiceRecording=e,e&&(e.on(Nr.b.Started,this.onRecordingStarted),e.on(Nr.b.EndingSoon,this.onRecordingEndingSoon))}componentDidMount(){this.dispatcherRef=b.a.register(this.onAction),this.waitForOwnMember(),X.b.instance.trackElementDimensions(`MessageComposer${this.instanceId}`,this.ref.current),X.b.instance.on(`MessageComposer${this.instanceId}`,this.onResize),this.updateRecordingState()}waitForOwnMember(){const e=this.props.room.getMember(tt.a.safeGet().getUserId());e?this.setState({me:e}):this.props.room.loadMembersIfNeeded().then((()=>{var e;const t=null!==(e=this.props.room.getMember(tt.a.safeGet().getSafeUserId()))&&void 0!==e?e:void 0;this.setState({me:t})}))}componentWillUnmount(){Gr.instance.off(ft.b,this.onVoiceStoreUpdate),this.dispatcherRef&&b.a.unregister(this.dispatcherRef),X.b.instance.stopTrackingElementDimensions(`MessageComposer${this.instanceId}`),X.b.instance.removeListener(`MessageComposer${this.instanceId}`,this.onResize),this.voiceRecording=null}updateRecordingState(){const e=Gr.getVoiceRecordingId(this.props.room,this.props.relation);this.voiceRecording=Gr.instance.getActiveRecording(e),this.voiceRecording?this.voiceRecording.hasRecording&&!this.voiceRecording.isRecording&&this.setState({haveRecording:!0}):this.setState({haveRecording:!1})}get showStickersButton(){return this.state.showStickersButton&&!Object(to.a)(this.props.room)}getMenuPosition(){if(this.ref.current){const e=this.state.isWysiwygLabEnabled&&this.state.isRichTextEnabled,t=this.ref.current.getBoundingClientRect(),n=e?36:0,a=new DOMRect(t.x,t.y+n,t.width,t.height-n);return Object(le.i)(a)}}render(){var e;const t=Boolean(!this.state.isWysiwygLabEnabled&&this.props.e2eStatus),a=t&&o.a.createElement(er.b,{key:"e2eIcon",status:this.props.e2eStatus,className:"mx_MessageComposer_e2eIcon"}),i=[],r=this.getMenuPosition(),s=this.context.canSendMessages&&!this.context.tombstone;let l,c;if(s)l=this.state.isWysiwygLabEnabled&&r?o.a.createElement(ao.b,{key:"controls_input",disabled:this.state.haveRecording,onChange:this.onWysiwygChange,onSend:this.sendMessage,isRichTextEnabled:this.state.isRichTextEnabled,initialContent:this.state.initialComposerContent,e2eStatus:this.props.e2eStatus,menuPosition:r,placeholder:this.renderPlaceholderText(),eventRelation:this.props.relation}):o.a.createElement(Yr.c,{ref:this.messageComposerInput,key:"controls_input",room:this.props.room,placeholder:this.renderPlaceholderText(),permalinkCreator:this.props.permalinkCreator,relation:this.props.relation,replyToEvent:this.props.replyToEvent,onChange:this.onChange,disabled:this.state.haveRecording,toggleStickerPickerOpen:this.toggleStickerPickerOpen}),i.push(o.a.createElement(Xr,{key:"controls_voice_record",ref:this.voiceRecordingButton,room:this.props.room,permalinkCreator:this.props.permalinkCreator,relation:this.props.relation,replyToEvent:this.props.replyToEvent}));else if(this.context.tombstone){const e=this.context.tombstone.getContent().replacement_room,t=e?o.a.createElement("a",{href:Object(mn.f)(tt.a.safeGet(),e),className:"mx_MessageComposer_roomReplaced_link",onClick:this.onTombstoneClick},Object(N.b)("The conversation continues here.")):"";i.push(o.a.createElement("div",{className:"mx_MessageComposer_replaced_wrapper",key:"room_replaced"},o.a.createElement("div",{className:"mx_MessageComposer_replaced_valign"},o.a.createElement("img",{"aria-hidden":!0,alt:"",className:"mx_MessageComposer_roomReplaced_icon",src:n(1543).default}),o.a.createElement("span",{className:"mx_MessageComposer_roomReplaced_header"},Object(N.b)("This room has been replaced and is no longer active.")),o.a.createElement("br",null),t)))}else i.push(o.a.createElement("div",{key:"controls_error",className:"mx_MessageComposer_noperm_error"},Object(N.b)("You do not have permission to post to this room")));if(this.state.recordingTimeLeftSeconds){const e=Math.round(this.state.recordingTimeLeftSeconds);c=o.a.createElement(Zr.b,{id:this.tooltipId,label:Object(N.b)("%(seconds)ss left",{seconds:e}),alignment:Zr.a.Top})}const u=(null===(e=this.props.relation)||void 0===e?void 0:e.rel_type)===dn.d.name?this.props.relation.event_id:null;i.push(o.a.createElement(Ir,{room:this.props.room,threadId:u,isStickerPickerOpen:this.state.isStickerPickerOpen,setStickerPickerOpen:this.setStickerPickerOpen,menuPosition:r,key:"stickers"}));const m=s&&(!this.state.isComposerEmpty||this.state.haveRecording),h=d()({mx_MessageComposer:!0,"mx_MessageComposer--compact":this.props.compact,mx_MessageComposer_e2eStatus:t,mx_MessageComposer_wysiwyg:this.state.isWysiwygLabEnabled});return o.a.createElement("div",{className:h,ref:this.ref,"aria-describedby":this.state.recordingTimeLeftSeconds?this.tooltipId:void 0},c,o.a.createElement("div",{className:"mx_MessageComposer_wrapper"},o.a.createElement(Pr,{replyToEvent:this.props.replyToEvent,permalinkCreator:this.props.permalinkCreator}),o.a.createElement("div",{className:"mx_MessageComposer_row"},a,l,o.a.createElement("div",{className:"mx_MessageComposer_actions"},i,s&&o.a.createElement(eo.b,{addEmoji:this.addEmoji,haveRecording:this.state.haveRecording,isMenuOpen:this.state.isMenuOpen,isStickerPickerOpen:this.state.isStickerPickerOpen,menuPosition:r,relation:this.props.relation,onRecordStartEndClick:this.onRecordStartEndClick,setStickerPickerOpen:this.setStickerPickerOpen,showLocationButton:!window.electron&&v.b.getValue(oe.b.LocationSharing),showPollsButton:this.state.showPollsButton,showStickersButton:this.showStickersButton,isRichTextEnabled:this.state.isRichTextEnabled,onComposerModeClick:this.onRichTextToggle,toggleButtonMenu:this.toggleButtonMenu,showVoiceBroadcastButton:this.state.showVoiceBroadcastButton,onStartVoiceBroadcastClick:()=>{(async(e,t,n,a,i)=>{var r;if(!await Object(_t.C)(e,t,a))return null;const o=t.getUserId();if(!o)return null;const s=e.getMember(o);if(!s)return null;null===(r=n.getCurrent())||void 0===r||r.pause(),n.clearCurrent();const l=new _t.o(e,s,t,n,a);i.setCurrent(l)})(this.props.room,tt.a.safeGet(),Ze.b.instance.voiceBroadcastPlaybacksStore,Ze.b.instance.voiceBroadcastRecordingsStore,Ze.b.instance.voiceBroadcastPreRecordingStore),this.toggleButtonMenu()}}),m&&o.a.createElement(ro,{key:"controls_send",onClick:this.sendMessage,title:this.state.haveRecording?Object(N.b)("Send voice message"):void 0})))))}}i()(oo,"contextType",In.b),i()(oo,"defaultProps",{compact:!1,showVoiceBroadcastButton:!1,isRichTextEnabled:!0});var so=Object(I.c)(oo);class lo{constructor(e){this.event=e,i()(this,"serializedParts",null),i()(this,"caret",null)}setEditorState(e,t){this.caret=e,this.serializedParts=t}hasEditorState(){return!!this.serializedParts}getSerializedParts(){return this.serializedParts}getCaret(){return this.caret}getEvent(){return this.event}}var co=n(457),uo=n(150);class mo extends o.a.PureComponent{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"mounted",!1),i()(this,"onAction",(e=>{this.mounted&&function(e){return[F.a.UploadStarted,F.a.UploadProgress,F.a.UploadFailed,F.a.UploadFinished,F.a.UploadCanceled].includes(e.action)}(e)&&this.setState(this.calculateState())})),i()(this,"onCancelClick",(e=>{e.preventDefault(),hn.a.sharedInstance().cancelUpload(this.state.currentUpload)})),this.state=this.calculateState()}componentDidMount(){this.dispatcherRef=b.a.register(this.onAction),this.mounted=!0}componentWillUnmount(){this.mounted=!1,b.a.unregister(this.dispatcherRef)}getUploadsInRoom(){return hn.a.sharedInstance().getCurrentUploads(this.props.relation).filter((e=>e.roomId===this.props.room.roomId))}calculateState(){const[e,...t]=this.getUploadsInRoom();return{currentUpload:e,currentFile:null==e?void 0:e.fileName,currentLoaded:null==e?void 0:e.loaded,currentTotal:null==e?void 0:e.total,countFiles:t.length+1}}render(){if(!this.state.currentFile)return null;const e=Object(N.b)("Uploading %(filename)s and %(count)s others",{filename:this.state.currentFile,count:this.state.countFiles-1}),t=Object(uo.a)(this.state.currentTotal);return o.a.createElement("div",{className:"mx_UploadBar"},o.a.createElement("div",{className:"mx_UploadBar_filename"},e," (",t,")"),o.a.createElement(K.a,{onClick:this.onCancelClick,className:"mx_UploadBar_cancel"}),o.a.createElement(co.a,{value:this.state.currentLoaded,max:this.state.currentTotal}))}}var ho=n(131);const po=["mxEvent","permalinkCreator","onMenuToggle"];var go=e=>{let{mxEvent:t,permalinkCreator:n,onMenuToggle:a}=e,i=ge()(e,po);const[s,l,c,d]=Object(le.q)(),u=Object(r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:F.a.ViewRoom,event_id:t.getId(),highlighted:!0,room_id:t.getRoomId(),metricsTrigger:void 0}),d()}),[t,d]),m=Object(r.useCallback)((async e=>{if(n){null==e||e.preventDefault(),null==e||e.stopPropagation();const a=n.forEvent(t.getId());await Object(ho.b)(a),d()}}),[t,d,n]);Object(r.useEffect)((()=>{null==a||a(s)}),[s,a]);const h=tt.a.safeGet().getRoom(t.getRoomId()),p=!!h&&!An.d.instance.hasMaximisedWidget(h);return o.a.createElement(o.a.Fragment,null,o.a.createElement(le.c,ee()({},i,{className:"mx_BaseCard_header_title_button--option",onClick:c,title:Object(N.b)("Thread options"),isExpanded:s,inputRef:l,"data-testid":"threadlist-dropdown-button"})),s&&o.a.createElement(de.e,ee()({onFinished:d,className:"mx_RoomTile_contextMenu",compact:!0,rightAligned:!0},{left:(g=l.current.getBoundingClientRect()).left+window.scrollX+g.width,top:g.bottom+window.scrollY,chevronFace:le.a.None}),o.a.createElement(de.c,null,p&&o.a.createElement(de.b,{onClick:e=>u(e),label:Object(N.b)("View in room"),iconClassName:"mx_ThreadPanel_viewInRoom"}),n&&o.a.createElement(de.b,{"data-testid":"copy-thread-link",onClick:e=>m(e),label:Object(N.b)("Copy link to thread"),iconClassName:"mx_ThreadPanel_copyLinkToThread"}))));var g};var bo=({parent:e,onFileDrop:t})=>{const[a,i]=Object(r.useState)({dragging:!1,counter:0});return Object(r.useEffect)((()=>{if(!e||e.ondrop)return;const n=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer&&i((t=>({counter:t.counter+1,dragging:!(!e.dataTransfer.types.includes("Files")&&!e.dataTransfer.types.includes("application/x-moz-file"))||t.dragging})))},a=e=>{e.stopPropagation(),e.preventDefault(),i((e=>({counter:e.counter-1,dragging:!(e.counter<=1)&&e.dragging})))},r=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(e.dataTransfer.dropEffect="none",(e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"))&&(e.dataTransfer.dropEffect="copy"))},o=e=>{e.stopPropagation(),e.preventDefault(),e.dataTransfer&&(t(e.dataTransfer),i((e=>({dragging:!1,counter:e.counter-1}))))};return null==e||e.addEventListener("drop",o),null==e||e.addEventListener("dragover",r),null==e||e.addEventListener("dragenter",n),null==e||e.addEventListener("dragleave",a),()=>{null==e||e.removeEventListener("drop",o),null==e||e.removeEventListener("dragover",r),null==e||e.removeEventListener("dragenter",n),null==e||e.removeEventListener("dragleave",a)}}),[e,t]),a.dragging?o.a.createElement("div",{className:"mx_FileDropTarget"},o.a.createElement("img",{src:n(1544).default,className:"mx_FileDropTarget_image",alt:""}),Object(N.b)("Drop file here to upload")):null},vo=n(424);function fo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function yo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fo(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Eo extends o.a.Component{constructor(e){var t;super(e),i()(this,"context",void 0),i()(this,"dispatcherRef",null),i()(this,"layoutWatcherRef",void 0),i()(this,"timelinePanel",Object(r.createRef)()),i()(this,"card",Object(r.createRef)()),i()(this,"eventId",void 0),i()(this,"onAction",(e=>{switch(e.phase==vn.a.ThreadView&&e.event&&this.setupThread(e.event),e.action){case F.a.ComposerInsert:if(e.composerType)break;if(e.timelineRenderingType!==In.a.Thread)break;b.a.dispatch(yo(yo({},e),{},{composerType:this.state.editState?vo.a.Edit:vo.a.Send}));break;case F.a.EditEvent:if(e.timelineRenderingType!==In.a.Thread)return;if(e.event&&!e.event.getThread())return;this.setState({editState:e.event?new lo(e.event):void 0},(()=>{var t;e.event&&(null===(t=this.timelinePanel.current)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))}));break;case"reply_to_event":e.context===In.a.Thread&&this.setState({replyToEvent:e.event})}})),i()(this,"setupThread",(e=>{const t=e.getId();let n=this.props.room.getThread(t);if(!n){const a=[];null===e.status&&a.push(e),n=this.props.room.createThread(t,e,a,!0)}this.updateThread(n)})),i()(this,"onNewThread",(e=>{e.id===this.props.mxEvent.getId()&&this.setupThread(this.props.mxEvent)})),i()(this,"updateThreadRelation",(()=>{this.setState({lastReply:this.threadLastReply})})),i()(this,"updateThread",(e=>{this.state.thread!==e&&(this.setupThreadListeners(e,this.state.thread),e&&this.setState({thread:e,lastReply:this.threadLastReply},(async()=>this.postThreadUpdate(e))))})),i()(this,"resetJumpToEvent",(e=>{var t,n;this.props.initialEvent&&this.props.initialEventScrollIntoView&&e===(null===(t=this.props.initialEvent)||void 0===t?void 0:t.getId())&&b.a.dispatch({action:F.a.ViewRoom,room_id:this.props.room.roomId,event_id:null===(n=this.props.initialEvent)||void 0===n?void 0:n.getId(),highlighted:this.props.isInitialEventHighlighted,scroll_into_view:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0})})),i()(this,"onMeasurement",(e=>{this.setState({narrow:e})})),i()(this,"onKeyDown",(e=>{let t=!1;if(Object(Q.a)().getRoomAction(e)===z.h.UploadFile)b.a.dispatch({action:"upload_file",context:In.a.Thread},!0),t=!0;t&&(e.stopPropagation(),e.preventDefault())})),i()(this,"onFileDrop",(e=>{const t=this.props.mxEvent.getRoomId();t?hn.a.sharedInstance().sendContentListToRoom(Array.from(e.files),t,this.threadRelation,tt.a.safeGet(),In.a.Thread):console.warn("Unknwon roomId for event",this.props.mxEvent)})),i()(this,"renderThreadViewHeader",(()=>o.a.createElement("div",{className:"mx_BaseCard_header_title"},o.a.createElement(Yt.a,{size:"4",className:"mx_BaseCard_header_title_heading"},Object(N.b)("Thread")),o.a.createElement(go,{mxEvent:this.props.mxEvent,permalinkCreator:this.props.permalinkCreator})))),this.setEventId(this.props.mxEvent);const n=null!==(t=this.props.room.getThread(this.eventId))&&void 0!==t?t:void 0;this.setupThreadListeners(n),this.state={layout:v.b.getValue("layout"),narrow:!1,thread:n,lastReply:null==n?void 0:n.lastReply((e=>e.isRelation(dn.d.name)&&!e.status))},this.layoutWatcherRef=v.b.watchSetting("layout",null,((...[,,,e])=>this.setState({layout:e})))}componentDidMount(){this.state.thread&&this.postThreadUpdate(this.state.thread),this.setupThread(this.props.mxEvent),this.dispatcherRef=b.a.register(this.onAction),this.props.room.on(dn.f.New,this.onNewThread)}componentWillUnmount(){var e;this.dispatcherRef&&b.a.unregister(this.dispatcherRef);const t=this.props.mxEvent.getRoomId();v.b.unwatchSetting(this.layoutWatcherRef);const n=Ze.b.instance.roomViewStore.getRoomId()!==t;this.props.initialEvent&&!n&&b.a.dispatch({action:F.a.ViewRoom,room_id:this.props.room.roomId,metricsTrigger:void 0}),b.a.dispatch({action:F.a.ViewThread,thread_id:null}),null===(e=this.state.thread)||void 0===e||e.off(dn.f.NewReply,this.updateThreadRelation),this.props.room.off(l.RoomEvent.LocalEchoUpdated,this.updateThreadRelation),this.props.room.removeListener(dn.f.New,this.onNewThread)}componentDidUpdate(e){e.mxEvent!==this.props.mxEvent&&(this.setEventId(this.props.mxEvent),this.setupThread(this.props.mxEvent)),e.room!==this.props.room&&fn.a.instance.setCard({phase:vn.a.RoomSummary})}setEventId(e){if(!e.getId())throw new Error("Got thread event without id");this.eventId=e.getId()}get threadLastReply(){var e,t;return null!==(e=null===(t=this.state.thread)||void 0===t?void 0:t.lastReply((e=>e.isRelation(dn.d.name)&&!e.status)))&&void 0!==e?e:void 0}async postThreadUpdate(e){var t,n;b.a.dispatch({action:F.a.ViewThread,thread_id:e.id}),e.emit(dn.f.ViewThread),this.updateThreadRelation(),null===(t=this.timelinePanel.current)||void 0===t||t.refreshTimeline(null===(n=this.props.initialEvent)||void 0===n?void 0:n.getId())}setupThreadListeners(e,t){var n;t&&(null===(n=this.state.thread)||void 0===n||n.off(dn.f.NewReply,this.updateThreadRelation),this.props.room.off(l.RoomEvent.LocalEchoUpdated,this.updateThreadRelation));e&&(e.on(dn.f.NewReply,this.updateThreadRelation),this.props.room.on(l.RoomEvent.LocalEchoUpdated,this.updateThreadRelation))}get threadRelation(){var e,t,n,a;const i={rel_type:dn.d.name,event_id:null===(e=this.state.thread)||void 0===e?void 0:e.id,is_falling_back:!0},r=null!==(t=null===(n=this.state.lastReply)||void 0===n?void 0:n.getId())&&void 0!==t?t:null===(a=this.state.thread)||void 0===a?void 0:a.id;return r&&(i["m.in_reply_to"]={event_id:r}),i}render(){var e,t,n,a,i,r;const s=this.props.isInitialEventHighlighted?null===(e=this.props.initialEvent)||void 0===e?void 0:e.getId():void 0,l=this.threadRelation;let c;var u;this.state.thread?(this.props.initialEvent&&this.props.initialEvent.getRoomId()!==this.state.thread.roomId&&on.a.warn("ThreadView attempting to render TimelinePanel with mismatched initialEvent",this.state.thread.roomId,this.props.initialEvent.getRoomId(),this.props.initialEvent.getId()),c=o.a.createElement(o.a.Fragment,null,o.a.createElement(bo,{parent:this.card.current,onFileDrop:this.onFileDrop}),o.a.createElement(wr,{key:this.state.thread.id,ref:this.timelinePanel,showReadReceipts:this.context.showReadReceipts,manageReadReceipts:!0,manageReadMarkers:!0,sendReadReceiptOnLoad:!0,timelineSet:this.state.thread.timelineSet,showUrlPreview:this.context.showUrlPreview,layout:this.state.layout===Sr.a.Bubble?Sr.a.Bubble:Sr.a.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!0,className:"mx_RoomView_messagePanel",permalinkCreator:this.props.permalinkCreator,membersLoaded:!0,editState:this.state.editState,eventId:null===(u=this.props.initialEvent)||void 0===u?void 0:u.getId(),highlightedEventId:s,eventScrollIntoView:this.props.initialEventScrollIntoView,onEventScrolledIntoView:this.resetJumpToEvent}))):c=o.a.createElement("div",{className:"mx_RoomView_messagePanelSpinner"},o.a.createElement(Ma.a,null));return o.a.createElement(In.b.Provider,{value:yo(yo({},this.context),{},{timelineRenderingType:In.a.Thread,threadId:null===(t=this.state.thread)||void 0===t?void 0:t.id,liveTimeline:null===(n=this.state)||void 0===n||null===(a=n.thread)||void 0===a||null===(i=a.timelineSet)||void 0===i?void 0:i.getLiveTimeline(),narrow:this.state.narrow})},o.a.createElement(En.b,{className:d()("mx_ThreadView mx_ThreadPanel",{mx_ThreadView_narrow:this.state.narrow}),onClose:this.props.onClose,withoutScrollContainer:!0,header:this.renderThreadViewHeader(),ref:this.card,onKeyDown:this.onKeyDown,onBack:e=>{re.b.trackInteraction("WebThreadViewBackButton",e)}},this.card.current&&o.a.createElement(_r,{sensor:this.card.current,onMeasurement:this.onMeasurement}),o.a.createElement("div",{className:"mx_ThreadView_timelinePanelWrapper"},c),hn.a.sharedInstance().getCurrentUploads(l).length>0&&o.a.createElement(mo,{room:this.props.room,relation:l}),(null===(r=this.state.thread)||void 0===r?void 0:r.timelineSet)&&o.a.createElement(so,{room:this.props.room,resizeNotifier:this.props.resizeNotifier,relation:l,replyToEvent:this.state.replyToEvent,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus,compact:!0})))}}i()(Eo,"contextType",In.b);var wo=n(656);function So(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function _o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?So(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):So(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let Co=function(e){return e[e.My=0]="My",e[e.All=1]="All",e}({});const Oo=({label:e,description:t,onClick:n,isSelected:a})=>o.a.createElement(le.f,{active:a,className:"mx_ThreadPanel_Header_FilterOptionItem",onClick:n},o.a.createElement("span",null,e),o.a.createElement("span",null,t)),xo=({filterOption:e,setFilterOption:t,empty:n})=>{const[a,i,r,s]=Object(le.q)(),l=[{label:Object(N.b)("All threads"),description:Object(N.b)("Shows all threads from current room"),key:Co.All},{label:Object(N.b)("My threads"),description:Object(N.b)("Shows all threads you've participated in"),key:Co.My}],c=l.find((t=>t.key===e)),d=l.map((e=>o.a.createElement(Oo,{key:e.key,label:e.label,description:e.description,onClick:()=>{t(e.key),s()},isSelected:e===c}))),u=a?o.a.createElement(le.n,{top:108,right:33,onFinished:s,chevronFace:le.a.Top,wrapperClassName:"mx_BaseCard_header_title"},d):null;return o.a.createElement("div",{className:"mx_BaseCard_header_title"},o.a.createElement(Yt.a,{size:"4",className:"mx_BaseCard_header_title_heading"},Object(N.b)("Threads")),!n&&o.a.createElement(o.a.Fragment,null,o.a.createElement(wo.a,{className:"mx_ThreadPanel_dropdown",inputRef:i,isExpanded:a,onClick:e=>{r(),re.b.trackInteraction("WebRightPanelThreadPanelFilterDropdown",e)}},`${Object(N.b)("Show:")} ${null==c?void 0:c.label}`),u))},ko=({hasThreads:e,filterOption:t,showAllThreadsCallback:n})=>{let a;return a=e?o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(N.b)("Reply to an ongoing thread or use “%(replyInThread)s” when hovering over a message to start a new one.",{replyInThread:Object(N.b)("Reply in thread")})),o.a.createElement("p",null,t===Co.My?o.a.createElement("button",{onClick:n},Object(N.b)("Show all threads")):o.a.createElement(o.a.Fragment,null," "))):o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(N.b)("Threads help keep your conversations on-topic and easy to track.")),o.a.createElement("p",{className:"mx_ThreadPanel_empty_tip"},Object(N.b)("<b>Tip:</b> Use “%(replyInThread)s” when hovering over a message.",{replyInThread:Object(N.b)("Reply in thread")},{b:e=>o.a.createElement("b",null,e)}))),o.a.createElement("aside",{className:"mx_ThreadPanel_empty"},o.a.createElement("div",{className:"mx_ThreadPanel_largeIcon"}),o.a.createElement("h2",null,Object(N.b)("Keep discussions organised with threads")),a)};var Ro=({roomId:e,onClose:t,permalinkCreator:n})=>{var a,i,s,l,c,d;const u=Object(r.useContext)(I.a),m=Object(r.useContext)(In.b),h=Object(r.useRef)(null),p=Object(r.useRef)(null),[g,b]=Object(r.useState)(Co.All),[v,f]=Object(r.useState)(null),[y,E]=Object(r.useState)(!1),w=g===Co.My?null==v?void 0:v.threadsTimelineSets[1]:null==v?void 0:v.threadsTimelineSets[0],S=Boolean(null==v||null===(a=v.threadsTimelineSets)||void 0===a||null===(i=a[0])||void 0===i||null===(s=i.getLiveTimeline())||void 0===s||null===(l=s.getEvents())||void 0===l?void 0:l.length);return Object(r.useEffect)((()=>{const t=u.getRoom(e);null==t||t.createThreadsTimelineSets().then((()=>t.fetchRoomThreads())).then((()=>{b(Co.All),f(t)}))}),[u,e]),Object(r.useEffect)((()=>{var e;w&&!dn.e.hasServerSideSupport&&(null===(e=h.current)||void 0===e||e.refreshTimeline())}),[w,h]),o.a.createElement(In.b.Provider,{value:_o(_o({},m),{},{timelineRenderingType:In.a.ThreadsList,showHiddenEvents:!0,narrow:y})},o.a.createElement(En.b,{header:o.a.createElement(xo,{filterOption:g,setFilterOption:b,empty:!S}),className:"mx_ThreadPanel",onClose:t,withoutScrollContainer:!0,ref:p},p.current&&o.a.createElement(_r,{sensor:p.current,onMeasurement:E}),w?o.a.createElement(wr,{key:g+":"+(null!==(c=null===(d=w.getFilter())||void 0===d?void 0:d.filterId)&&void 0!==c?c:e),ref:h,showReadReceipts:!1,manageReadReceipts:!1,manageReadMarkers:!1,sendReadReceiptOnLoad:!1,timelineSet:w,showUrlPreview:!1,empty:o.a.createElement(ko,{hasThreads:S,filterOption:g,showAllThreadsCallback:()=>b(Co.All)}),alwaysShowTimestamps:!0,layout:Sr.a.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!1,className:"mx_RoomView_messagePanel",membersLoaded:!0,permalinkCreator:n,disableGrouping:!0}):o.a.createElement("div",{className:"mx_AutoHideScrollbar"},o.a.createElement(Ma.a,null))))};function jo(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Io(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?jo(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jo(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class To extends o.a.PureComponent{constructor(e){super(e),i()(this,"card",o.a.createRef()),i()(this,"onMeasurement",(e=>{this.setState({narrow:e})})),this.state={narrow:!1}}render(){const e=o.a.createElement("div",{className:"mx_RightPanel_empty mx_NotificationPanel_empty"},o.a.createElement("h2",null,Object(N.b)("You're all caught up")),o.a.createElement("p",null,Object(N.b)("You have no visible notifications.")));let t;const n=tt.a.safeGet().getNotifTimelineSet();return n?t=o.a.createElement(wr,{manageReadReceipts:!1,manageReadMarkers:!1,timelineSet:n,showUrlPreview:!1,empty:e,alwaysShowTimestamps:!0,layout:Sr.a.Group}):(on.a.error("No notifTimelineSet available!"),t=o.a.createElement(Ma.a,null)),o.a.createElement(In.b.Provider,{value:Io(Io({},this.context),{},{timelineRenderingType:In.a.Notification,narrow:this.state.narrow})},o.a.createElement(En.b,{header:o.a.createElement("div",{className:"mx_BaseCard_header_title"},o.a.createElement(Yt.a,{size:"4",className:"mx_BaseCard_header_title_heading"},Object(N.b)("Notifications"))),className:"mx_ThreadPanel",onClose:this.props.onClose,withoutScrollContainer:!0},this.card.current&&o.a.createElement(_r,{sensor:this.card.current,onMeasurement:this.onMeasurement}),t))}}i()(To,"contextType",In.b);var Po=e=>{const t=d()({mx_JumpToBottomButton:!0,mx_JumpToBottomButton_highlight:e.highlight});let n;return e.numUnreadMessages&&(n=o.a.createElement("div",{className:"mx_JumpToBottomButton_badge"},e.numUnreadMessages)),o.a.createElement("div",{className:t},o.a.createElement(K.a,{className:"mx_JumpToBottomButton_scrollDown",title:Object(N.b)("Scroll to most recent messages"),onClick:e.onScrollToBottomClick}),n)};function No(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Do(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?No(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):No(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Mo extends o.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"layoutWatcherRef",void 0),i()(this,"timelinePanel",o.a.createRef()),i()(this,"card",o.a.createRef()),i()(this,"readReceiptsSettingWatcher",void 0),i()(this,"onRoomViewStoreUpdate",(async e=>{const t={initialEventId:Ze.b.instance.roomViewStore.getInitialEventId(),isInitialEventHighlighted:Ze.b.instance.roomViewStore.isInitialEventHighlighted(),replyToEvent:Ze.b.instance.roomViewStore.getQuotingEvent()};this.setState(t)})),i()(this,"onAction",(e=>{if(e.action===F.a.EditEvent)this.setState({editState:e.event?new lo(e.event):void 0},(()=>{var t;e.event&&(null===(t=this.timelinePanel.current)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))}))})),i()(this,"onScroll",(()=>{const e=this.timelinePanel.current;e&&(e.isAtEndOfLiveTimeline()?this.setState({atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.state.initialEventId&&this.state.isInitialEventHighlighted&&b.a.dispatch({action:F.a.ViewRoom,room_id:this.props.room.roomId,event_id:this.state.initialEventId,highlighted:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0}))})),i()(this,"onMeasurement",(e=>{this.setState({narrow:e})})),i()(this,"jumpToLiveTimeline",(()=>{var e;this.state.initialEventId&&this.state.isInitialEventHighlighted?b.a.dispatch({action:F.a.ViewRoom,room_id:this.props.room.roomId}):(null===(e=this.timelinePanel.current)||void 0===e||e.jumpToLiveTimeline(),b.a.fire(F.a.FocusSendMessageComposer))})),i()(this,"renderTimelineCardHeader",(()=>o.a.createElement("div",{className:"mx_BaseCard_header_title"},o.a.createElement(Yt.a,{size:"4",className:"mx_BaseCard_header_title_heading"},Object(N.b)("Chat"))))),this.state={showReadReceipts:v.b.getValue("showReadReceipts",e.room.roomId),layout:v.b.getValue("layout"),atEndOfLiveTimeline:!0,narrow:!1}}componentDidMount(){Ze.b.instance.roomViewStore.addListener(ft.b,this.onRoomViewStoreUpdate),this.dispatcherRef=b.a.register(this.onAction),this.readReceiptsSettingWatcher=v.b.watchSetting("showReadReceipts",null,((...[,,,e])=>this.setState({showReadReceipts:e}))),this.layoutWatcherRef=v.b.watchSetting("layout",null,((...[,,,e])=>this.setState({layout:e})))}componentWillUnmount(){Ze.b.instance.roomViewStore.removeListener(ft.b,this.onRoomViewStoreUpdate),this.readReceiptsSettingWatcher&&v.b.unwatchSetting(this.readReceiptsSettingWatcher),this.layoutWatcherRef&&v.b.unwatchSetting(this.layoutWatcherRef),this.dispatcherRef&&b.a.unregister(this.dispatcherRef)}render(){var e,t;const n=this.state.isInitialEventHighlighted?this.state.initialEventId:void 0;let a;this.state.atEndOfLiveTimeline||(a=o.a.createElement(Po,{highlight:this.props.room.getUnreadNotificationCount(l.NotificationCountType.Highlight)>0,onScrollToBottomClick:this.jumpToLiveTimeline}));const i=hn.a.sharedInstance().getCurrentUploads(this.props.composerRelation).length>0,r="join"===this.props.room.getMyMembership();return o.a.createElement(In.b.Provider,{value:Do(Do({},this.context),{},{timelineRenderingType:null!==(e=this.props.timelineRenderingType)&&void 0!==e?e:this.context.timelineRenderingType,liveTimeline:null===(t=this.props.timelineSet)||void 0===t?void 0:t.getLiveTimeline(),narrow:this.state.narrow})},o.a.createElement(En.b,{className:this.props.classNames,onClose:this.props.onClose,withoutScrollContainer:!0,header:this.renderTimelineCardHeader(),ref:this.card},this.card.current&&o.a.createElement(_r,{sensor:this.card.current,onMeasurement:this.onMeasurement}),o.a.createElement("div",{className:"mx_TimelineCard_timeline"},a,o.a.createElement(wr,{ref:this.timelinePanel,showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!0,manageReadMarkers:!1,sendReadReceiptOnLoad:!0,timelineSet:this.props.timelineSet,showUrlPreview:this.context.showUrlPreview,layout:this.state.layout===Sr.a.Bubble?Sr.a.Bubble:Sr.a.Group,hideThreadedMessages:!1,hidden:!1,showReactions:!0,className:"mx_RoomView_messagePanel",permalinkCreator:this.props.permalinkCreator,membersLoaded:!0,editState:this.state.editState,eventId:this.state.initialEventId,resizeNotifier:this.props.resizeNotifier,highlightedEventId:n,onScroll:this.onScroll})),i&&o.a.createElement(mo,{room:this.props.room,relation:this.props.composerRelation}),r&&o.a.createElement(so,{room:this.props.room,relation:this.props.composerRelation,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus,compact:!0})))}}function Ao(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}i()(Mo,"contextType",In.b);class Lo extends o.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"delayedUpdate",Object(R.throttle)((()=>{this.forceUpdate()}),500,{leading:!0,trailing:!0})),i()(this,"onRoomStateMember",((e,t,n)=>{var a,i;this.props.room&&n.roomId===this.props.room.roomId&&(this.state.phase===vn.a.RoomMemberList||this.state.phase===vn.a.RoomMemberInfo&&n.userId===(null===(a=this.state.cardState)||void 0===a||null===(i=a.member)||void 0===i?void 0:i.userId))&&this.delayedUpdate()})),i()(this,"onRightPanelStoreUpdate",(()=>{this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ao(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ao(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},Lo.getDerivedStateFromProps(this.props)))})),i()(this,"onClose",(()=>{var e,t,n,a;if(null!==(e=this.props.overwriteCard)&&void 0!==e&&null!==(t=e.state)&&void 0!==t&&t.member)b.a.dispatch({action:F.a.ViewHomePage});else if(this.state.phase===vn.a.EncryptionPanel&&null!==(n=this.state.cardState)&&void 0!==n&&null!==(a=n.verificationRequest)&&void 0!==a&&a.pending)this.state.cardState.verificationRequest.cancel();else{var i,r;fn.a.instance.togglePanel(null!==(i=null===(r=this.props.room)||void 0===r?void 0:r.roomId)&&void 0!==i?i:null)}})),i()(this,"onSearchQueryChanged",(e=>{this.setState({searchQuery:e})})),this.state={searchQuery:""}}componentDidMount(){this.context.on(l.RoomStateEvent.Members,this.onRoomStateMember),fn.a.instance.on(ft.b,this.onRightPanelStoreUpdate)}componentWillUnmount(){var e;null===(e=this.context)||void 0===e||e.removeListener(l.RoomStateEvent.Members,this.onRoomStateMember),fn.a.instance.off(ft.b,this.onRightPanelStoreUpdate)}static getDerivedStateFromProps(e){var t,n,a;let i;return e.room&&(i=fn.a.instance.currentCardForRoom(e.room.roomId)),{cardState:null===(t=i)||void 0===t?void 0:t.state,phase:null!==(n=null===(a=i)||void 0===a?void 0:a.phase)&&void 0!==n?n:void 0}}render(){var e,t,n,a,i;let r=o.a.createElement("div",null);const s=null===(e=this.props.room)||void 0===e?void 0:e.roomId,c=null!==(t=null===(n=this.props.overwriteCard)||void 0===n?void 0:n.phase)&&void 0!==t?t:this.state.phase,d=null!==(a=null===(i=this.props.overwriteCard)||void 0===i?void 0:i.state)&&void 0!==a?a:this.state.cardState;switch(c){case vn.a.RoomMemberList:s&&(r=o.a.createElement(ar,{roomId:s,key:s,onClose:this.onClose,searchQuery:this.state.searchQuery,onSearchQueryChanged:this.onSearchQueryChanged}));break;case vn.a.SpaceMemberList:var u,m;if(null!=d&&d.spaceId||s)r=o.a.createElement(ar,{roomId:null!==(u=null==d?void 0:d.spaceId)&&void 0!==u?u:s,key:null!==(m=null==d?void 0:d.spaceId)&&void 0!==m?m:s,onClose:this.onClose,searchQuery:this.state.searchQuery,onSearchQueryChanged:this.onSearchQueryChanged});break;case vn.a.RoomMemberInfo:case vn.a.SpaceMemberInfo:case vn.a.EncryptionPanel:if(null!=d&&d.member){var h;const e=d.member instanceof l.RoomMember?d.member:void 0;r=o.a.createElement(ir.a,{user:d.member,room:null!==(h=this.context.getRoom(null==e?void 0:e.roomId))&&void 0!==h?h:this.props.room,key:null!=s?s:d.member.userId,onClose:this.onClose,phase:c,verificationRequest:d.verificationRequest,verificationRequestPromise:d.verificationRequestPromise})}break;case vn.a.Room3pidMemberInfo:case vn.a.Space3pidMemberInfo:null!=d&&d.memberInfoEvent&&(r=o.a.createElement(rr,{event:d.memberInfoEvent,key:s}));break;case vn.a.NotificationPanel:r=o.a.createElement(To,{onClose:this.onClose});break;case vn.a.PinnedMessages:this.props.room&&v.b.getValue("feature_pinning")&&(r=o.a.createElement(Xa,{room:this.props.room,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator}));break;case vn.a.Timeline:this.props.room&&(r=o.a.createElement(Mo,{classNames:"mx_ThreadPanel mx_TimelineCard",room:this.props.room,timelineSet:this.props.room.getUnfilteredTimelineSet(),resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus}));break;case vn.a.FilePanel:s&&(r=o.a.createElement(kr,{roomId:s,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose}));break;case vn.a.ThreadView:this.props.room&&null!=d&&d.threadHeadEvent&&(r=o.a.createElement(Eo,{room:this.props.room,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,mxEvent:d.threadHeadEvent,initialEvent:d.initialEvent,isInitialEventHighlighted:d.isInitialEventHighlighted,initialEventScrollIntoView:d.initialEventScrollIntoView,permalinkCreator:this.props.permalinkCreator,e2eStatus:this.props.e2eStatus}));break;case vn.a.ThreadPanel:this.props.room&&(r=o.a.createElement(Ro,{roomId:this.props.room.roomId,resizeNotifier:this.props.resizeNotifier,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator}));break;case vn.a.RoomSummary:this.props.room&&(r=o.a.createElement(Ci,{room:this.props.room,onClose:this.onClose,permalinkCreator:this.props.permalinkCreator}));break;case vn.a.Widget:this.props.room&&null!=d&&d.widgetId&&(r=o.a.createElement($i,{room:this.props.room,widgetId:d.widgetId,onClose:this.onClose}))}return o.a.createElement("aside",{className:"mx_RightPanel dark-panel",id:"mx_RightPanel"},r)}}i()(Lo,"contextType",I.a);class Uo{constructor(){i()(this,"scrollStateMap",new Map)}getScrollState(e){return this.scrollStateMap.get(e)}setScrollState(e,t){null===t?this.scrollStateMap.delete(e):this.scrollStateMap.set(e,t)}}void 0===window.mxRoomScrollStateStore&&(window.mxRoomScrollStateStore=new Uo);var Fo=window.mxRoomScrollStateStore,Bo=n(285),Vo=n(644),Wo=n(640),zo=n(1545),Ho=n(418),Go=n(98);class Ko extends o.a.PureComponent{constructor(e){super(e),i()(this,"onViewClick",(()=>{this.setState({hidden:!1})})),this.state={hidden:!0}}render(){const e=d()({mx_InviteReason:!0,mx_InviteReason_hidden:this.state.hidden});return o.a.createElement("div",{className:e},o.a.createElement("div",{className:"mx_InviteReason_reason"},this.props.htmlReason?Object(Go.h)(this.props.htmlReason):this.props.reason),o.a.createElement("div",{className:"mx_InviteReason_view",onClick:this.onViewClick},Object(N.b)("View message")))}}var qo=n(727);var $o=function(e){return e.NotLoggedIn="NotLoggedIn",e.Joining="Joining",e.Loading="Loading",e.Rejecting="Rejecting",e.Kicked="Kicked",e.Banned="Banned",e.OtherThreePIDError="OtherThreePIDError",e.InvitedEmailNotFoundInAccount="InvitedEmailNotFoundInAccount",e.InvitedEmailNoIdentityServer="InvitedEmailNoIdentityServer",e.InvitedEmailMismatch="InvitedEmailMismatch",e.Invite="Invite",e.ViewingRoom="ViewingRoom",e.RoomNotFound="RoomNotFound",e.OtherError="OtherError",e.PromptAskToJoin="PromptAskToJoin",e.Knocked="Knocked",e}($o||{});class Yo extends o.a.Component{constructor(e){super(e),i()(this,"onLoginClick",(()=>{b.a.dispatch({action:"start_login",screenAfterLogin:this.makeScreenAfterLogin()})})),i()(this,"onRegisterClick",(()=>{b.a.dispatch({action:"start_registration",screenAfterLogin:this.makeScreenAfterLogin()})})),i()(this,"onChangeReason",(e=>{this.setState({reason:e.target.value})})),this.state={busy:!1}}componentDidMount(){this.checkInvitedEmail()}componentDidUpdate(e,t){this.props.invitedEmail===e.invitedEmail&&this.props.inviterName===e.inviterName||this.checkInvitedEmail()}async checkInvitedEmail(){if(this.props.inviterName&&this.props.invitedEmail){this.setState({busy:!0});try{const e=await tt.a.safeGet().getThreePids();if(this.setState({accountEmails:e.threepids.filter((e=>"email"===e.medium)).map((e=>e.address))}),!tt.a.safeGet().getIdentityServerUrl())return void this.setState({busy:!1});const t=new Ho.a,n=await t.getAccessToken(),a=await tt.a.safeGet().lookupThreePid("email",this.props.invitedEmail,n);if(!("mxid"in a))throw new N.a("Unable to find user by email");this.setState({invitedEmailMxid:a.mxid})}catch(e){this.setState({threePidFetchError:e})}this.setState({busy:!1})}}getMessageCase(){if(tt.a.safeGet().isGuest())return $o.NotLoggedIn;const e=this.getMyMember();if(e){if(e.isKicked())return $o.Kicked;if("ban"===e.membership)return $o.Banned}if(this.props.joining)return $o.Joining;if(this.props.rejecting)return $o.Rejecting;if(this.props.loading||this.state.busy)return $o.Loading;if(this.props.knocked)return $o.Knocked;if(this.props.promptAskToJoin)return $o.PromptAskToJoin;if(this.props.inviterName){if(this.props.invitedEmail){if(this.state.threePidFetchError)return $o.OtherThreePIDError;if(this.state.accountEmails&&!this.state.accountEmails.includes(this.props.invitedEmail))return $o.InvitedEmailNotFoundInAccount;if(!tt.a.safeGet().getIdentityServerUrl())return $o.InvitedEmailNoIdentityServer;if(this.state.invitedEmailMxid!=tt.a.safeGet().getUserId())return $o.InvitedEmailMismatch}return $o.Invite}return this.props.error?"M_NOT_FOUND"==this.props.error.errcode?$o.RoomNotFound:$o.OtherError:$o.ViewingRoom}getKickOrBanInfo(){var e,t,n,a;const i=this.getMyMember();if(!i)return{};const r=null===(e=i.events.member)||void 0===e?void 0:e.getSender(),o=r?null===(t=this.props.room)||void 0===t?void 0:t.currentState.getMember(r):void 0;return{memberName:null!==(n=null==o?void 0:o.name)&&void 0!==n?n:r,reason:null===(a=i.events.member)||void 0===a?void 0:a.getContent().reason}}joinRule(){var e,t,n;return null!==(e=null===(t=this.props.room)||void 0===t||null===(n=t.currentState.getStateEvents(l.EventType.RoomJoinRules,""))||void 0===n?void 0:n.getContent().join_rule)&&void 0!==e?e:null}getMyMember(){var e,t;return null!==(e=null===(t=this.props.room)||void 0===t?void 0:t.getMember(tt.a.safeGet().getSafeUserId()))&&void 0!==e?e:null}getInviteMember(){var e;const{room:t}=this.props;if(!t)return null;const n=tt.a.safeGet().getSafeUserId(),a=t.currentState.getMember(n);if(!a)return null;const i=null===(e=a.events.member)||void 0===e?void 0:e.getSender();return i?t.currentState.getMember(i):null}isDMInvite(){var e;const t=this.getMyMember();if(!t)return!1;const n=null===(e=t.events.member)||void 0===e?void 0:e.getContent();return"invite"===(null==n?void 0:n.membership)&&n.is_direct}makeScreenAfterLogin(){var e,t,n,a,i,r;return{screen:"room",params:{email:this.props.invitedEmail,signurl:this.props.signUrl,room_name:null!==(e=null===(t=this.props.oobData)||void 0===t?void 0:t.name)&&void 0!==e?e:null,room_avatar_url:null!==(n=null===(a=this.props.oobData)||void 0===a?void 0:a.avatarUrl)&&void 0!==n?n:null,inviter_name:null!==(i=null===(r=this.props.oobData)||void 0===r?void 0:r.inviterName)&&void 0!==i?i:null}}}render(){var e,t,n,a,i,r;const s=it.b.get().brand,c=null!==(e=null!==(t=null===(n=this.props.room)||void 0===n?void 0:n.name)&&void 0!==t?t:this.props.roomAlias)&&void 0!==e?e:"",u=null!==(a=null===(i=this.props.room)||void 0===i?void 0:i.isSpaceRoom())&&void 0!==a?a:(null===(r=this.props.oobData)||void 0===r?void 0:r.roomType)===l.RoomType.Space;let m,h,p,g,b,f,y,E,w=!1;const S=[],_=this.getMessageCase();switch(_){case $o.Joining:var C;m=null!==(C=this.props.oobData)&&void 0!==C&&C.roomType||u?u?Object(N.b)("Joining space…"):Object(N.b)("Joining room…"):Object(N.b)("Joining…"),w=!0;break;case $o.Loading:m=Object(N.b)("Loading…"),w=!0;break;case $o.Rejecting:m=Object(N.b)("Rejecting invite…"),w=!0;break;case $o.NotLoggedIn:{const e={canJoin:!1};this.props.roomId&&Bn.a.instance.invoke(zo.RoomViewLifecycle.PreviewRoomNotLoggedIn,e,this.props.roomId),e.canJoin?(m=Object(N.b)("Join the room to participate"),b=Object(N.b)("Join"),g=()=>{Bn.a.instance.invoke(zo.RoomViewLifecycle.JoinFromRoomPreview,this.props.roomId)}):(m=Object(N.b)("Join the conversation with an account"),v.b.getValue(oe.b.Registration)&&(b=Object(N.b)("Sign Up"),g=this.onRegisterClick),y=Object(N.b)("Sign In"),f=this.onLoginClick),this.props.previewLoading&&(E=o.a.createElement("div",null,o.a.createElement(Ma.a,{w:20,h:20}),Object(N.b)("Loading preview")));break}case $o.Kicked:{const{memberName:e,reason:t}=this.getKickOrBanInfo();m=c?Object(N.b)("You were removed from %(roomName)s by %(memberName)s",{memberName:e,roomName:c}):Object(N.b)("You were removed by %(memberName)s",{memberName:e}),h=t?Object(N.b)("Reason: %(reason)s",{reason:t}):void 0,b=u?Object(N.b)("Forget this space"):Object(N.b)("Forget this room"),g=this.props.onForgetClick,this.joinRule()!==l.JoinRule.Invite&&(y=b,f=g,b=Object(N.b)("Re-join"),g=this.props.onJoinClick);break}case $o.Banned:{const{memberName:e,reason:t}=this.getKickOrBanInfo();m=c?Object(N.b)("You were banned from %(roomName)s by %(memberName)s",{memberName:e,roomName:c}):Object(N.b)("You were banned by %(memberName)s",{memberName:e}),h=t?Object(N.b)("Reason: %(reason)s",{reason:t}):void 0,b=u?Object(N.b)("Forget this space"):Object(N.b)("Forget this room"),g=this.props.onForgetClick;break}case $o.OtherThreePIDError:{var O;m=c?Object(N.b)("Something went wrong with your invite to %(roomName)s",{roomName:c}):Object(N.b)("Something went wrong with your invite.");const e=this.joinRule(),t=Object(N.b)("An error (%(errcode)s) was returned while trying to validate your invite. You could try to pass this information on to the person who invited you.",{errcode:(null===(O=this.state.threePidFetchError)||void 0===O?void 0:O.errcode)||Object(N.b)("unknown error code")});switch(e){case"invite":h=[Object(N.b)("You can only join it with a working invite."),t],b=Object(N.b)("Try to join anyway"),g=this.props.onJoinClick;break;case"public":h=Object(N.b)("You can still join here."),b=Object(N.b)("Join the discussion"),g=this.props.onJoinClick;break;default:h=t,b=Object(N.b)("Try to join anyway"),g=this.props.onJoinClick}break}case $o.InvitedEmailNotFoundInAccount:m=c?Object(N.b)("This invite to %(roomName)s was sent to %(email)s which is not associated with your account",{roomName:c,email:this.props.invitedEmail}):Object(N.b)("This invite was sent to %(email)s which is not associated with your account",{email:this.props.invitedEmail}),h=Object(N.b)("Link this email with your account in Settings to receive invites directly in %(brand)s.",{brand:s}),b=Object(N.b)("Join the discussion"),g=this.props.onJoinClick;break;case $o.InvitedEmailNoIdentityServer:m=c?Object(N.b)("This invite to %(roomName)s was sent to %(email)s",{roomName:c,email:this.props.invitedEmail}):Object(N.b)("This invite was sent to %(email)s",{email:this.props.invitedEmail}),h=Object(N.b)("Use an identity server in Settings to receive invites directly in %(brand)s.",{brand:s}),b=Object(N.b)("Join the discussion"),g=this.props.onJoinClick;break;case $o.InvitedEmailMismatch:m=c?Object(N.b)("This invite to %(roomName)s was sent to %(email)s",{roomName:c,email:this.props.invitedEmail}):Object(N.b)("This invite was sent to %(email)s",{email:this.props.invitedEmail}),h=Object(N.b)("Share this email in Settings to receive invites directly in %(brand)s.",{brand:s}),b=Object(N.b)("Join the discussion"),g=this.props.onJoinClick;break;case $o.Invite:{var x,k;const e=o.a.createElement(fe.a,{room:this.props.room,oobData:this.props.oobData}),t=this.getInviteMember();let n;n=t?o.a.createElement("span",null,o.a.createElement("span",{className:"mx_RoomPreviewBar_inviter"},t.rawDisplayName)," (",t.userId,")"):o.a.createElement("span",{className:"mx_RoomPreviewBar_inviter"},this.props.inviterName);var R;if(this.isDMInvite())m=Object(N.b)("Do you want to chat with %(user)s?",{user:null!==(R=null==t?void 0:t.name)&&void 0!==R?R:this.props.inviterName}),h=[e,Object(N.b)("<userName/> wants to chat",{},{userName:()=>n})],b=Object(N.b)("Start chatting");else m=Object(N.b)("Do you want to join %(roomName)s?",{roomName:c}),h=[e,Object(N.b)("<userName/> invited you",{},{userName:()=>n})],b=Object(N.b)("Accept");const a=tt.a.safeGet().getSafeUserId(),i=null===(x=this.props.room)||void 0===x?void 0:x.currentState.getMember(a),r=null==i||null===(k=i.events.member)||void 0===k?void 0:k.getContent();null!=r&&r.reason&&(p=o.a.createElement(Ko,{reason:r.reason,htmlReason:r["io.element.html_reason"]})),g=this.props.onJoinClick,y=Object(N.b)("Reject"),f=this.props.onRejectClick,this.props.onRejectAndIgnoreClick&&S.push(o.a.createElement(K.a,{kind:"secondary",onClick:this.props.onRejectAndIgnoreClick,key:"ignore"},Object(N.b)("Reject & Ignore user")));break}case $o.ViewingRoom:m=this.props.canPreview?Object(N.b)("You're previewing %(roomName)s. Want to join it?",{roomName:c}):c?Object(N.b)("%(roomName)s can't be previewed. Do you want to join it?",{roomName:c}):Object(N.b)("There's no preview, would you like to join?"),b=Object(N.b)("Join the discussion"),g=this.props.onJoinClick;break;case $o.RoomNotFound:m=c?Object(N.b)("%(roomName)s does not exist.",{roomName:c}):Object(N.b)("This room or space does not exist."),h=Object(N.b)("Are you sure you're at the right place?");break;case $o.OtherError:var j;m=c?Object(N.b)("%(roomName)s is not accessible at this time.",{roomName:c}):Object(N.b)("This room or space is not accessible at this time."),h=[Object(N.b)("Try again later, or ask a room or space admin to check if you have access."),Object(N.b)("%(errcode)s was returned while trying to access the room or space. If you think you're seeing this message in error, please <issueLink>submit a bug report</issueLink>.",{errcode:String(null===(j=this.props.error)||void 0===j?void 0:j.errcode)},{issueLink:e=>o.a.createElement("a",{href:"https://github.com/vector-im/element-web/issues/new/choose",target:"_blank",rel:"noreferrer noopener"},e)})];break;case $o.PromptAskToJoin:var I;m=c?Object(N.b)("Ask to join %(roomName)s?",{roomName:c}):Object(N.b)("Ask to join?");h=[o.a.createElement(fe.a,{room:this.props.room,oobData:this.props.oobData}),Object(N.b)("You need to be granted access to this room in order to view or participate in the conversation. You can send a request to join below.")],p=o.a.createElement(at.a,{autoFocus:!0,className:"mx_RoomPreviewBar_fullWidth",element:"textarea",onChange:this.onChangeReason,placeholder:Object(N.b)("Message (optional)"),type:"text",value:null!==(I=this.state.reason)&&void 0!==I?I:""}),g=()=>this.props.onSubmitAskToJoin&&this.props.onSubmitAskToJoin(this.state.reason),b=Object(N.b)("Request access");break;case $o.Knocked:m=Object(N.b)("Request to join sent"),h=[o.a.createElement(o.a.Fragment,null,o.a.createElement(qo.a,{className:"mx_Icon mx_Icon_16 mx_RoomPreviewBar_icon"}),Object(N.b)("Your request to join is pending."))],f=this.props.onCancelAskToJoin,y=Object(N.b)("Cancel request")}let T,P,D,M;h&&(Array.isArray(h)||(h=[h]),T=h.map(((e,t)=>o.a.createElement("p",{key:`subTitle${t}`},e)))),P=w?o.a.createElement("h3",{className:"mx_RoomPreviewBar_spinnerTitle"},o.a.createElement(Ma.a,null),m):o.a.createElement("h3",null,m),g&&(D=o.a.createElement(K.a,{kind:"primary",onClick:g},b)),f&&(M=o.a.createElement(K.a,{kind:"secondary",onClick:f},y));const A=this.props.canPreview,L=d()("mx_RoomPreviewBar","dark-panel",`mx_RoomPreviewBar_${_}`,{mx_RoomPreviewBar_panel:A,mx_RoomPreviewBar_dialog:!A}),U=A?o.a.createElement(o.a.Fragment,null,M,S,D):o.a.createElement(o.a.Fragment,null,D,S,M);return o.a.createElement("div",{className:L},o.a.createElement("div",{className:"mx_RoomPreviewBar_message"},P,T),p,o.a.createElement("div",{className:d()("mx_RoomPreviewBar_actions",{mx_RoomPreviewBar_fullWidth:_===$o.PromptAskToJoin})},U),o.a.createElement("div",{className:"mx_RoomPreviewBar_footer"},E))}}i()(Yo,"defaultProps",{onJoinClick(){}});var Jo=n(91),Qo=n(1329);const Xo=["room"];function Zo(e){let{room:t}=e,n=ge()(e,Xo);const a=Object(r.useContext)(I.a),i=Object(r.useRef)(null),s=Object(Qo.b)(t),c=Object(Go.i)(null==s?void 0:s.text,null==s?void 0:s.html,i),u=Object(r.useCallback)((e=>{var t;null===(t=n.onClick)||void 0===t||t.call(n,e);if("A"!==e.target.tagName.toUpperCase())return void b.a.fire(F.a.ShowRoomTopic);const a=e.target,i=Object(mn.j)(a.href);i!==a.href&&(e.preventDefault(),window.location.hash=i)}),[n]);Object(ne.a)(b.a,(e=>{if(e.action===F.a.ShowRoomTopic){const e=t.currentState.maySendStateEvent(l.EventType.RoomTopic,a.getSafeUserId()),n=Object(Go.i)(null==s?void 0:s.text,null==s?void 0:s.html,i,!0),r=H.b.createDialog(ot.a,{title:t.name,description:o.a.createElement("div",null,o.a.createElement(Go.a,{options:{attributes:{onClick(){r.close()}}},as:"p"},n),e&&o.a.createElement(K.a,{kind:"primary_outline",onClick:()=>{r.close(),b.a.dispatch({action:"open_room_settings"})}},Object(N.b)("Edit topic"))),hasCloseButton:!0,button:!1})}}));const m=d()(n.className,"mx_RoomTopic");return o.a.createElement(he.a,ee()({},n,{ref:i,onClick:u,dir:"auto",tooltipTargetClassName:m,label:Object(N.b)("Click to read topic"),alignment:Zr.a.Bottom,ignoreHover:e=>"A"===e.target.tagName.toUpperCase()}),o.a.createElement(Go.a,null,c))}var es=n(64),ts=n(664);const ns=["room","onlyKnownUsers","numShown"],as=5,is=e=>{var t;return!(null===(t=es.a.shared().getDMRoomsForUserId(e.userId))||void 0===t||!t.length)};var rs=e=>{let{room:t,onlyKnownUsers:n=!0,numShown:a=as}=e,i=ge()(e,ns);const s=Object(r.useContext)(I.a),c="join"===t.getMyMembership();let d=((e,t=250)=>{const[n,a]=Object(r.useState)(e.getJoinedMembers());return Object(ae.c)(e.currentState,l.RoomStateEvent.Update,Object(R.throttle)((()=>{a(e.getJoinedMembers())}),t,{leading:!0,trailing:!0})),n})(t);const u=d.length,m=[e=>e.getMxcAvatarUrl()?0:1];n?d=d.filter(is):m.unshift((e=>is(e)?0:1));const h=Object(R.sortBy)(d.filter((e=>e.userId!==s.getUserId())),m).slice(0,a);if(h.length<1)return null;const p=h.map((e=>e.name)).reverse().join(", "),g=o.a.createElement("div",null,o.a.createElement("div",{className:"mx_Tooltip_title"},i.onClick?Object(N.b)("View all %(count)s members",{count:u}):Object(N.b)("%(count)s members",{count:u})),o.a.createElement("div",{className:"mx_Tooltip_sub"},c?Object(N.b)("Including you, %(commaSeparatedMembers)s",{commaSeparatedMembers:p}):Object(N.b)("Including %(commaSeparatedMembers)s",{commaSeparatedMembers:p})));return o.a.createElement(ts.a,ee()({members:h,faceSize:28,overflow:d.length>a,tooltip:g},i),n&&o.a.createElement("span",{className:"mx_FacePile_summary"},Object(N.b)("%(count)s people you know have already joined",{count:d.length})))};var os=({room:e})=>{const t=Object(Ua.a)((async()=>{if("invite"!==e.getMyMembership())return null;try{return await e.client.getRoomSummary(e.roomId)}catch(e){return null}}),[e]),n=Object(Ha.a)(e,(e=>e.getJoinRule())),a=Ta(e),i=Ia(e),r=Object(ie.a)("feature_element_call_video_rooms");let s,c,d;if(e.isElementVideoRoom()||r&&e.isCallRoom()?(s="mx_RoomInfoLine_video",c=Object(N.b)("Video room")):n===l.JoinRule.Public?(s="mx_RoomInfoLine_public",c=e.isSpaceRoom()?Object(N.b)("Public space"):Object(N.b)("Public room")):(s="mx_RoomInfoLine_private",c=e.isSpaceRoom()?Object(N.b)("Private space"):Object(N.b)("Private room")),"invite"===a&&t)d=o.a.createElement("span",{className:"mx_RoomInfoLine_members"},Object(N.b)("%(count)s members",{count:t.num_joined_members}));else if(i&&void 0!==t){const t=()=>fn.a.instance.setCard({phase:e.isSpaceRoom()?vn.a.SpaceMemberList:vn.a.RoomMemberList});d=o.a.createElement(K.a,{kind:"link",className:"mx_RoomInfoLine_members",onClick:t},Object(N.b)("%(count)s members",{count:i}))}return o.a.createElement("div",{className:`mx_RoomInfoLine ${s}`},c,d)};var ss=({room:e,onJoinButtonClicked:t,onRejectButtonClicked:n})=>{const a=Object(r.useContext)(I.a),i=Object(ie.a)("feature_video_rooms"),s=Object(ie.a)("feature_element_call_video_rooms"),c=e.isElementVideoRoom()||s&&e.isCallRoom(),d=Ta(e);Object(ne.a)(b.a,(t=>{t.action===F.a.JoinRoomError&&t.roomId===e.roomId&&m(!1)}));const[u,m]=Object(r.useState)(!1),h=Object(Ha.a)(e,(e=>e.getJoinRule())),p=Object(Jo.b)(d)===Jo.a.Leave&&h!==l.JoinRule.Public,g=()=>b.a.dispatch({action:F.a.ViewUserSettings,initialTabId:Me.a.Labs});let v,f,y=null;if("join"===d)v=o.a.createElement(K.a,{kind:"danger_outline",onClick:()=>{b.a.dispatch({action:"leave_room",room_id:e.roomId})}},Object(N.b)("Leave"));else if("invite"===d){var E,w;const i=null===(E=e.getMember(a.getUserId()))||void 0===E||null===(w=E.events.member)||void 0===w?void 0:w.getSender();if(i){const t=e.getMember(i);y=o.a.createElement("div",{className:"mx_RoomPreviewCard_inviter"},o.a.createElement(Ba.b,{member:t,fallbackUserId:i,width:32,height:32}),o.a.createElement("div",null,o.a.createElement("div",{className:"mx_RoomPreviewCard_inviter_name"},Object(N.b)("<inviter/> invites you",{},{inviter:()=>o.a.createElement("b",null,(null==t?void 0:t.name)||i)})),t?o.a.createElement("div",{className:"mx_RoomPreviewCard_inviter_mxid"},i):null))}v=o.a.createElement(o.a.Fragment,null,o.a.createElement(K.a,{kind:"primary_outline",onClick:()=>{m(!0),n()}},Object(N.b)("Reject")),o.a.createElement(K.a,{kind:"primary",onClick:()=>{m(!0),t()}},Object(N.b)("Accept")))}else v=o.a.createElement(K.a,{kind:"primary",onClick:()=>{t(),a.isGuest()||m(!0)},disabled:p},Object(N.b)("Join"));u&&(v=o.a.createElement(me.a,null)),f=c?o.a.createElement(o.a.Fragment,null,o.a.createElement(fe.a,{room:e,height:50,width:50,viewAvatarOnClick:!0}),o.a.createElement("div",{className:"mx_RoomPreviewCard_video"}),o.a.createElement(ce.a,{onClick:g,tooltipTitle:Object(N.b)("Video rooms are a beta feature")})):e.isSpaceRoom()?o.a.createElement(fe.a,{room:e,height:80,width:80,viewAvatarOnClick:!0}):o.a.createElement(fe.a,{room:e,height:50,width:50,viewAvatarOnClick:!0});let S=null;return p?S=Object(N.b)("To view %(roomName)s, you need an invite",{roomName:e.name}):c&&!i&&(S="join"===d?Object(N.b)("To view, please enable video rooms in Labs first"):Object(N.b)("To join, please enable video rooms in Labs first"),v=o.a.createElement(K.a,{kind:"primary",onClick:g},Object(N.b)("Show Labs settings"))),o.a.createElement("div",{className:"mx_RoomPreviewCard"},y,o.a.createElement("div",{className:"mx_RoomPreviewCard_avatar"},f),o.a.createElement("h1",{className:"mx_RoomPreviewCard_name"},o.a.createElement(Za.a,{room:e})),o.a.createElement(os,{room:e}),o.a.createElement(Zo,{room:e,className:"mx_RoomPreviewCard_topic"}),"public"===e.getJoinRule()&&o.a.createElement(rs,{room:e}),S?o.a.createElement("div",{className:"mx_RoomPreviewCard_notice"},S):null,o.a.createElement("div",{className:"mx_RoomPreviewCard_joinButtons"},v))};let ls=function(e){return e.Room="Room",e.All="All",e}({});class cs extends o.a.Component{constructor(e){super(e),i()(this,"searchTerm",Object(r.createRef)()),i()(this,"onThisRoomClick",(()=>{this.setState({scope:ls.Room},(()=>this.searchIfQuery()))})),i()(this,"onAllRoomsClick",(()=>{this.setState({scope:ls.All},(()=>this.searchIfQuery()))})),i()(this,"onSearchChange",(e=>{switch(Object(Q.a)().getAccessibilityAction(e)){case z.h.Enter:this.onSearch();break;case z.h.Escape:this.props.onCancelClick()}})),i()(this,"onSearch",(()=>{var e;null!==(e=this.searchTerm.current)&&void 0!==e&&e.value.trim()&&this.props.onSearch(this.searchTerm.current.value,this.state.scope)})),this.state={scope:ls.Room}}searchIfQuery(){var e;null!==(e=this.searchTerm.current)&&void 0!==e&&e.value&&this.onSearch()}render(){const e=d()("mx_SearchBar_searchButton",{mx_SearchBar_searching:this.props.searchInProgress}),t=d()("mx_SearchBar_button",{mx_SearchBar_unselected:this.state.scope!==ls.Room}),n=d()("mx_SearchBar_button",{mx_SearchBar_unselected:this.state.scope!==ls.All});return o.a.createElement(o.a.Fragment,null,o.a.createElement(re.a,{screenName:"RoomSearch"}),o.a.createElement("div",{className:"mx_SearchBar"},o.a.createElement("div",{className:"mx_SearchBar_buttons",role:"radiogroup"},o.a.createElement(K.a,{className:t,onClick:this.onThisRoomClick,"aria-checked":this.state.scope===ls.Room,role:"radio"},Object(N.b)("This Room")),o.a.createElement(K.a,{className:n,onClick:this.onAllRoomsClick,"aria-checked":this.state.scope===ls.All,role:"radio"},Object(N.b)("All Rooms"))),o.a.createElement("div",{className:"mx_SearchBar_input mx_textinput"},o.a.createElement("input",{ref:this.searchTerm,type:"text",autoFocus:!0,placeholder:Object(N.b)("Search…"),"aria-label":this.state.scope===ls.Room?Object(N.b)("Search this room"):Object(N.b)("Search all rooms"),onKeyDown:this.onSearchChange}),o.a.createElement(K.a,{className:e,onClick:this.onSearch,"aria-label":Object(N.b)("Search")})),o.a.createElement(K.a,{className:"mx_SearchBar_cancel",onClick:this.props.onCancelClick,"aria-label":Object(N.b)("Cancel")})),o.a.createElement(cr,{isRoomEncrypted:this.props.isRoomEncrypted,kind:lr.Search}))}}var ds=n(801);class us extends o.a.PureComponent{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"onStateEvents",(e=>{if(!this.props.room||e.getRoomId()!==this.props.room.roomId)return;if("m.room.tombstone"!==e.getType())return;const t=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.setState({upgraded:t&&t.getContent().replacement_room})})),i()(this,"onUpgradeClick",(()=>{H.b.createDialog(ds.a,{room:this.props.room})}));const n=this.props.room.currentState.getStateEvents("m.room.tombstone","");this.state={upgraded:null==n?void 0:n.getContent().replacement_room}}componentDidMount(){this.context.on(l.RoomStateEvent.Events,this.onStateEvents)}componentWillUnmount(){this.context.removeListener(l.RoomStateEvent.Events,this.onStateEvents)}render(){let e=o.a.createElement("div",null,o.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},o.a.createElement("p",null,Object(N.b)("Upgrading this room will shut down the current instance of the room and create an upgraded room with the same name.")),o.a.createElement("p",null,Object(N.b)("<b>Warning</b>: upgrading a room will <i>not automatically migrate room members to the new version of the room.</i> We'll post a link to the new room in the old version of the room - room members will have to click this link to join the new room.",{},{b:e=>o.a.createElement("b",null,e),i:e=>o.a.createElement("i",null,e)}))),o.a.createElement("p",{className:"mx_RoomUpgradeWarningBar_upgradelink"},o.a.createElement(K.a,{onClick:this.onUpgradeClick},Object(N.b)("Upgrade this room to the recommended room version"))));return this.state.upgraded&&(e=o.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_body"},o.a.createElement("p",null,Object(N.b)("This room has already been upgraded.")))),o.a.createElement("div",{className:"mx_RoomUpgradeWarningBar"},o.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_wrapped"},o.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_header"},Object(N.b)("This room is running room version <roomVersion />, which this homeserver has marked as <i>unstable</i>.",{},{roomVersion:()=>o.a.createElement("code",null,this.props.room.getVersion()),i:e=>o.a.createElement("i",null,e)})),e,o.a.createElement("div",{className:"mx_RoomUpgradeWarningBar_small"},Object(N.b)("Only room administrators will see this warning"))))}}i()(us,"contextType",I.a);var ms=function(e){return e.CloseScalar="close_scalar",e.GetWidgets="get_widgets",e.SetWidget="set_widget",e.JoinRulesState="join_rules_state",e.SetPlumbingState="set_plumbing_state",e.GetMembershipCount="get_membership_count",e.GetRoomEncryptionState="get_room_enc_state",e.CanSendEvent="can_send_event",e.MembershipState="membership_state",e.invite="invite",e.Kick="kick",e.BotOptions="bot_options",e.SetBotOptions="set_bot_options",e.SetBotPower="set_bot_power",e.GetOpenIdToken="get_open_id_token",e.SendEvent="send_event",e.ReadEvents="read_events",e}(ms||{});function hs(e,t){const n=Object(Yn.b)(e.data);n.response=t,e.source.postMessage(n,e.origin)}function ps(e,t,n){on.a.error("Action:"+e.data.action+" failed with message: "+t);const a=Object(Yn.b)(e.data);a.response={error:{message:t}},n&&(a.response.error._error=n),e.source.postMessage(a,e.origin)}function gs(e,t){const n=tt.a.safeGet(),a=e.data.widget_id;let i=e.data.type;const r=e.data.url,o=e.data.name,s=e.data.data,l=e.data.avatar_url,c=e.data.userWidget;if(a&&void 0!==r){if(null!==r){if(void 0!==o&&"string"!=typeof o)return void ps(e,Object(N.b)("Unable to create widget."),new Error("Optional field 'name' must be a string."));if(void 0!==s&&!(s instanceof Object))return void ps(e,Object(N.b)("Unable to create widget."),new Error("Optional field 'data' must be an Object."));if(void 0!==l&&"string"!=typeof l)return void ps(e,Object(N.b)("Unable to create widget."),new Error("Optional field 'avatar_url' must be a string."));if("string"!=typeof i)return void ps(e,Object(N.b)("Unable to create widget."),new Error("Field 'type' must be a string."));if("string"!=typeof r)return void ps(e,Object(N.b)("Unable to create widget."),new Error("Field 'url' must be a string or null."))}if(i=Mn.a.fromString(i),c)Sn.a.setUserWidget(n,a,i,r,o,s).then((()=>{hs(e,{success:!0}),b.a.dispatch({action:"user_widget_updated"})})).catch((t=>{ps(e,Object(N.b)("Unable to create widget."),t)}));else{if(!t)return void ps(e,Object(N.b)("Missing roomId."));Sn.a.setRoomWidget(n,t,a,i,r,o,s,l).then((()=>{hs(e,{success:!0})}),(t=>{ps(e,Object(N.b)("Failed to send request."),t)}))}}else ps(e,Object(N.b)("Unable to create widget."),new Error("Missing required widget fields."))}function bs(e,t){const n=tt.a.get();if(!n)return void ps(e,Object(N.b)("You need to be logged in."));let a=[];if(t){const i=n.getRoom(t);if(!i)return void ps(e,Object(N.b)("This room is not recognised."));a=Sn.a.getRoomWidgets(i).map((e=>e.event))}const i=Sn.a.getUserWidgetsArray(n);a=a.concat(i),hs(e,a)}function vs(e,t,n,a){const i=tt.a.get();if(!i)return void ps(e,Object(N.b)("You need to be logged in."));const r=i.getRoom(t);if(!r)return void ps(e,Object(N.b)("This room is not recognised."));const o=r.currentState.getStateEvents(n,a);hs(e,o?o.getContent():null)}const fs=function(e){let t,n;e.origin||(e.origin=e.originalEvent.origin);try{var a;ys||(ys=null===(a=_n.a.sharedInstance().getPrimaryManager())||void 0===a?void 0:a.uiUrl),t=new URL(ys)}catch(e){return}try{n=new URL(e.origin)}catch(e){return}if(t.origin!==n.origin||!e.data.action||e.data.api)return;if(e.data.action===ms.CloseScalar)return b.a.dispatch({action:ms.CloseScalar}),void hs(e,null);const i=e.data.room_id,r=e.data.user_id;if(!i)return e.data.action===ms.GetWidgets?void bs(e,null):e.data.action===ms.SetWidget?void gs(e,null):e.data.action===ms.GetOpenIdToken?void async function(e){try{hs(e,await tt.a.safeGet().getOpenIdToken())}catch(t){on.a.warn("Unable to fetch openId token.",t),ps(e,"Unable to fetch openId token.")}}(e):void ps(e,Object(N.b)("Missing room_id in request"));if(i===Ze.b.instance.roomViewStore.getRoomId())if(e.data.action!==ms.GetWidgets)if(e.data.action!==ms.SetWidget)if(e.data.action!==ms.JoinRulesState)if(e.data.action!==ms.SetPlumbingState)if(e.data.action!==ms.GetMembershipCount)if(e.data.action!==ms.GetRoomEncryptionState)if(e.data.action!==ms.CanSendEvent)if(e.data.action!==ms.SendEvent)if(e.data.action!==ms.ReadEvents)if(r)switch(e.data.action){case ms.MembershipState:!function(e,t,n){on.a.log(`membership_state of ${n} in room ${t} requested.`),vs(e,t,"m.room.member",n)}(e,i,r);break;case ms.invite:!function(e,t,n){on.a.log(`Received request to invite ${n} into room ${t}`);const a=tt.a.get();if(!a)return void ps(e,Object(N.b)("You need to be logged in."));const i=a.getRoom(t);if(i){const t=i.getMember(n);if(t&&["join","invite"].includes(t.membership))return void hs(e,{success:!0})}a.invite(t,n).then((function(){hs(e,{success:!0})}),(function(t){ps(e,Object(N.b)("You need to be able to invite users to do that."),t)}))}(e,i,r);break;case ms.Kick:!function(e,t,n){on.a.log(`Received request to kick ${n} from room ${t}`);const a=tt.a.get();if(!a)return void ps(e,Object(N.b)("You need to be logged in."));const i=a.getRoom(t);if(i){const t=i.getMember(n);if(!t||Object(Jo.b)(t.membership)===Jo.a.Leave)return void hs(e,{success:!0})}const r=e.data.reason;a.kick(t,n,r).then((()=>{hs(e,{success:!0})})).catch((t=>{ps(e,Object(N.b)("You need to be able to kick users to do that."),t)}))}(e,i,r);break;case ms.BotOptions:!function(e,t,n){on.a.log(`bot_options of ${n} in room ${t} requested.`),vs(e,t,"m.room.bot.options","_"+n)}(e,i,r);break;case ms.SetBotOptions:!function(e,t,n){on.a.log(`Received request to set options for bot ${n} in room ${t}`);const a=tt.a.get();a?a.sendStateEvent(t,"m.room.bot.options",e.data.content,"_"+n).then((()=>{hs(e,{success:!0})}),(t=>{ps(e,t.message?t.message:Object(N.b)("Failed to send request."),t)})):ps(e,Object(N.b)("You need to be logged in."))}(e,i,r);break;case ms.SetBotPower:!async function(e,t,n,a,i){if(!(Number.isInteger(a)&&a>=0))return void ps(e,Object(N.b)("Power level must be positive integer."));on.a.log(`Received request to set power level to ${a} for bot ${n} in room ${t}.`);const r=tt.a.get();if(r)try{const d=await r.getStateEvent(t,"m.room.power_levels","");var o,s,c;if(!0===i)if((null!==(o=null!==(s=null===(c=d.users)||void 0===c?void 0:c[n])&&void 0!==s?s:d.users_default)&&void 0!==o?o:0)>=a)return hs(e,{success:!0});return await r.setPowerLevel(t,n,a,new l.MatrixEvent({type:"m.room.power_levels",content:d})),hs(e,{success:!0})}catch(t){var d;const n=t instanceof Error?t:void 0;ps(e,null!==(d=null==n?void 0:n.message)&&void 0!==d?d:Object(N.b)("Failed to send request."),n)}else ps(e,Object(N.b)("You need to be logged in."))}(e,i,r,e.data.level,e.data.ignoreIfGreater);break;default:on.a.warn("Unhandled postMessage event with action '"+e.data.action+"'")}else ps(e,Object(N.b)("Missing user_id in request"));else!async function(e,t){const n=e.data.type,a=e.data.state_key,i=e.data.limit;if("string"!=typeof n)return void ps(e,Object(N.b)("Failed to read events"),new Error("Invalid 'type' in request"));if(!["m.room.power_levels","m.room.encryption","m.room.member","m.room.name","m.widgets","im.vector.modular.widgets","io.element.integrations.installations"].includes(n))return void ps(e,Object(N.b)("Failed to read events"),new Error("Disallowed 'type' in request"));let r;if(void 0!==i){if("number"!=typeof i||i<0)return void ps(e,Object(N.b)("Failed to read events"),new Error("Invalid 'limit' in request"));r=Math.min(i,Number.MAX_SAFE_INTEGER)}else r=Number.MAX_SAFE_INTEGER;const o=tt.a.get();if(!o)return void ps(e,Object(N.b)("You need to be logged in."));const s=o.getRoom(t);if(s){if(void 0!==a){if("string"!=typeof a&&!0!==a)return void ps(e,Object(N.b)("Failed to read events"),new Error("Invalid 'state_key' in request"));const t=!0===a?void 0:a;let i=[];return i=i.concat(s.currentState.getStateEvents(n,t)||[]),i=i.slice(0,r),void hs(e,{events:i.map((e=>e.getEffectiveEvent()))})}ps(e,Object(N.b)("Failed to read events"),new Error("Reading message events is not implemented"))}else ps(e,Object(N.b)("This room is not recognised."))}(e,i);else!async function(e,t){const n=e.data.type,a=e.data.state_key,i=e.data.content;if("string"!=typeof n)return void ps(e,Object(N.b)("Failed to send event"),new Error("Invalid 'type' in request"));if(!["m.widgets","im.vector.modular.widgets","io.element.integrations.installations"].includes(n))return void ps(e,Object(N.b)("Failed to send event"),new Error("Disallowed 'type' in request"));if(!i||"object"!=typeof i)return void ps(e,Object(N.b)("Failed to send event"),new Error("Invalid 'content' in request"));const r=tt.a.get();if(!r)return void ps(e,Object(N.b)("You need to be logged in."));if(r.getRoom(t))if(void 0!==a)try{hs(e,{room_id:t,event_id:(await r.sendStateEvent(t,n,i,a)).event_id})}catch(t){return void ps(e,Object(N.b)("Failed to send event"),t)}else ps(e,Object(N.b)("Failed to send event"),new Error("Sending message events is not implemented"));else ps(e,Object(N.b)("This room is not recognised."))}(e,i);else!function(e,t){const n=""+e.data.event_type,a=Boolean(e.data.is_state),i=tt.a.get();if(!i)return void ps(e,Object(N.b)("You need to be logged in."));const r=i.getRoom(t);if(!r)return void ps(e,Object(N.b)("This room is not recognised."));if("join"!==r.getMyMembership())return void ps(e,Object(N.b)("You are not in this room."));const o=i.credentials.userId;let s=!1;s=a?r.currentState.maySendStateEvent(n,o):r.currentState.maySendEvent(n,o),s?hs(e,!0):ps(e,Object(N.b)("You do not have permission to do that in this room."))}(e,i);else!function(e,t){const n=tt.a.get();if(!n)return void ps(e,Object(N.b)("You need to be logged in."));if(!n.getRoom(t))return void ps(e,Object(N.b)("This room is not recognised."));hs(e,tt.a.safeGet().isRoomEncrypted(t))}(e,i);else!function(e,t){const n=tt.a.get();if(!n)return void ps(e,Object(N.b)("You need to be logged in."));const a=n.getRoom(t);if(!a)return void ps(e,Object(N.b)("This room is not recognised."));hs(e,a.getJoinedMemberCount())}(e,i);else!function(e,t,n){if("string"!=typeof n)throw new Error("Plumbing state status should be a string");on.a.log(`Received request to set plumbing state to status "${n}" in room ${t}`);const a=tt.a.get();a?a.sendStateEvent(t,"m.room.plumbing",{status:n}).then((()=>{hs(e,{success:!0})}),(t=>{ps(e,t.message?t.message:Object(N.b)("Failed to send request."),t)})):ps(e,Object(N.b)("You need to be logged in."))}(e,i,e.data.status);else!function(e,t){on.a.log(`join_rules of ${t} requested.`),vs(e,t,"m.room.join_rules","")}(e,i);else gs(e,i);else bs(e,i);else ps(e,Object(N.b)("Room %(roomId)s not visible",{roomId:i}))};let ys,Es=0;var ws=n(95);class Ss extends o.a.Component{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"resizeContainer",void 0),i()(this,"resizer",void 0),i()(this,"dispatcherRef",void 0),i()(this,"onIsResizing",(e=>{this.setState({resizingVertical:e}),e||this.relaxResizer()})),i()(this,"collectResizer",(e=>{this.resizeContainer&&this.resizer.detach(),e&&(this.resizer.container=e,this.resizer.attach()),this.resizeContainer=e,this.loadResizerPreferences()})),i()(this,"getAppsHash",(e=>e.map((e=>e.id)).join("~"))),i()(this,"relaxResizer",(()=>{const e=this.resizer.getDistributors();e.forEach((e=>e.start())),e.forEach((e=>e.finish()))})),i()(this,"loadResizerPreferences",(()=>{const e=An.d.instance.getResizerDistributions(this.props.room,An.a.Top);if(this.state.apps&&this.topApps().length-1===e.length)e.forEach(((e,t)=>{const n=this.resizer.forHandleAt(t);n&&(n.size=e,n.finish())}));else if(this.state.apps){const e=this.resizer.getDistributors();e.forEach((e=>e.item.clearSize())),e.forEach((e=>e.start())),e.forEach((e=>e.finish()))}})),i()(this,"onAction",(e=>{const t=this.props.room.roomId+"_hide_widget_drawer";if("appsDrawer"===e.action)e.show?localStorage.setItem(t,"false"):localStorage.setItem(t,"true")})),i()(this,"getApps",(()=>({[An.a.Top]:An.d.instance.getContainerWidgets(this.props.room,An.a.Top),[An.a.Center]:An.d.instance.getContainerWidgets(this.props.room,An.a.Center)}))),i()(this,"topApps",(()=>this.state.apps[An.a.Top])),i()(this,"centerApps",(()=>this.state.apps[An.a.Center])),i()(this,"updateApps",(()=>{this.unmounted||this.setState({apps:this.getApps()})})),this.state={apps:this.getApps(),resizingVertical:!1,resizingHorizontal:!1,resizing:!1},this.resizer=this.createResizer(),this.props.resizeNotifier.on("isResizing",this.onIsResizing)}componentDidMount(){0===Es&&window.addEventListener("message",fs,!1),Es+=1,An.d.instance.on(An.d.emissionForRoom(this.props.room),this.updateApps),this.dispatcherRef=b.a.register(this.onAction)}componentWillUnmount(){this.unmounted=!0,function(){if(Es-=1,0===Es&&window.removeEventListener("message",fs),Es<0){const e=new Error("ScalarMessaging: mismatched startListening / stopListening detected. Negative count");on.a.error(e)}}(),An.d.instance.off(An.d.emissionForRoom(this.props.room),this.updateApps),this.dispatcherRef&&b.a.unregister(this.dispatcherRef),this.resizeContainer&&this.resizer.detach(),this.props.resizeNotifier.off("isResizing",this.onIsResizing)}createResizer(){const e=new j(null,O,{onResizeStart:()=>{var e;null===(e=this.resizeContainer)||void 0===e||e.classList.add("mx_AppsDrawer--resizing"),this.setState({resizingHorizontal:!0})},onResizeStop:()=>{var e;null===(e=this.resizeContainer)||void 0===e||e.classList.remove("mx_AppsDrawer--resizing"),An.d.instance.setResizerDistributions(this.props.room,An.a.Top,this.topApps().slice(1).map(((e,t)=>this.resizer.forHandleAt(t).size))),this.setState({resizingHorizontal:!1})}});return e.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle--vertical",reverse:"mx_ResizeHandle_reverse"}),e}componentDidUpdate(e,t){e.userId!==this.props.userId||e.room!==this.props.room?this.updateApps():this.getAppsHash(this.topApps())!==this.getAppsHash(t.apps[An.a.Top])&&this.loadResizerPreferences()}isResizing(){return this.state.resizingVertical||this.state.resizingHorizontal}render(){if(!this.props.showApps)return o.a.createElement("div",null);const e=this.centerApps().length>0,t=(e?this.centerApps():this.topApps()).map(((e,t,n)=>o.a.createElement(qi,{key:e.id,app:e,fullWidth:n.length<2,room:this.props.room,userId:this.props.userId,creatorUserId:e.creatorUserId,widgetPageTitle:Sn.a.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,pointerEvents:this.isResizing()?"none":void 0})));if(0===t.length)return o.a.createElement("div",null);let n;0===t.length&&Bo.a.roomHasPendingWidgets(this.props.room.roomId,Sn.a.getRoomWidgets(this.props.room))&&(n=o.a.createElement(Ma.a,null));const a=d()({mx_AppsDrawer:!0,"mx_AppsDrawer--maximised":e,"mx_AppsDrawer--resizing":this.state.resizing,"mx_AppsDrawer--2apps":2===t.length,"mx_AppsDrawer--3apps":3===t.length}),i=o.a.createElement("div",{className:"mx_AppsContainer",ref:this.collectResizer},t.map(((e,n)=>n<1?e:o.a.createElement(o.a.Fragment,{key:e.key},o.a.createElement(y,{reverse:n>t.length/2}),e))));let r;return r=e?i:o.a.createElement(_s,{room:this.props.room,minHeight:100,maxHeight:this.props.maxHeight-50,className:"mx_AppsDrawer_resizer",handleWrapperClass:"mx_AppsDrawer_resizer_container",handleClass:"mx_AppsDrawer_resizer_container_handle",resizeNotifier:this.props.resizeNotifier},i),o.a.createElement("div",{className:a},r,n)}}i()(Ss,"defaultProps",{showApps:!0});const _s=({room:e,minHeight:t,maxHeight:n,className:a,handleWrapperClass:i,handleClass:r,resizeNotifier:s,children:l})=>{let c=An.d.instance.getContainerHeight(e,An.a.Top);return t||(t=100),n||(n=X.b.instance.windowHeight/4*3),c?(c=Object(ws.a)(c,0,100),c=Object(ws.d)(c/100,t,n)):c=280,o.a.createElement(gn.Resizable,{size:{height:Math.min(c,n),width:void 0},minHeight:t,maxHeight:n,onResizeStart:()=>{s.startResizing()},onResize:()=>{s.notifyTimelineHeightChanged()},onResizeStop:(a,i,r,o)=>{let l=c+o.height;l=100*Object(ws.c)(l,t,n),An.d.instance.setContainerHeight(e,An.a.Top,l),s.stopResizing()},className:a,handleWrapperClass:i,handleClasses:{bottom:r},enable:{bottom:!0}},l)};var Cs=n(76);class Os extends o.a.PureComponent{constructor(e){super(e),i()(this,"element",void 0),i()(this,"setElementRef",(e=>{var t;e?(this.element=e,e.addEventListener("resize",this.onResize)):null===(t=this.element)||void 0===t||t.removeEventListener("resize",this.onResize)})),i()(this,"onNewStream",(()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}),this.playMedia()})),i()(this,"onMuteStateChanged",(()=>{this.setState({audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()})})),i()(this,"onResize",(e=>{this.props.onResize&&!this.props.feed.isLocal()&&this.props.onResize(e)})),this.state={audioMuted:this.props.feed.isAudioMuted(),videoMuted:this.props.feed.isVideoMuted()}}componentDidMount(){this.updateFeed(null,this.props.feed),this.playMedia()}componentWillUnmount(){this.updateFeed(this.props.feed,null)}componentDidUpdate(e,t){this.updateFeed(e.feed,this.props.feed),t.videoMuted===this.state.videoMuted&&e.feed.stream===this.props.feed.stream||this.playMedia()}static getDerivedStateFromProps(e){return{audioMuted:e.feed.isAudioMuted(),videoMuted:e.feed.isVideoMuted()}}updateFeed(e,t){e!==t&&(e&&(this.props.feed.removeListener(rn.b.NewStream,this.onNewStream),this.props.feed.removeListener(rn.b.MuteStateChanged,this.onMuteStateChanged),this.props.feed.purpose===Cs.b.Usermedia&&this.props.feed.measureVolumeActivity(!1),this.stopMedia()),t&&(this.props.feed.addListener(rn.b.NewStream,this.onNewStream),this.props.feed.addListener(rn.b.MuteStateChanged,this.onMuteStateChanged),this.props.feed.purpose===Cs.b.Usermedia&&this.props.feed.measureVolumeActivity(!0),this.playMedia()))}async playMedia(){const e=this.element;if(e){e.muted=!0,e.srcObject=this.props.feed.stream,e.autoplay=!0;try{await e.play()}catch(e){on.a.info(`Failed to play media element with feed for userId ${this.props.feed.userId} with purpose ${this.props.feed.purpose}`,e)}}}stopMedia(){const e=this.element;e&&(e.pause(),e.removeAttribute("src"))}render(){const{pipMode:e,primary:t,secondary:n,feed:a}=this.props,i=d()("mx_VideoFeed",{mx_VideoFeed_primary:t,mx_VideoFeed_secondary:n,mx_VideoFeed_voice:this.state.videoMuted}),r=d()("mx_VideoFeed_mic",{mx_VideoFeed_mic_muted:this.state.audioMuted,mx_VideoFeed_mic_unmuted:!this.state.audioMuted});let s,l;if(a.purpose===Cs.b.Screenshare||t||e||(s=o.a.createElement("div",{className:r})),this.state.videoMuted){var c;const n=V.b.instance.roomIdForCall(this.props.call),a=null!==(c=n?tt.a.safeGet().getRoom(n):void 0)&&void 0!==c?c:void 0;let i;e&&t?i=76:e&&!t?i=16:!e&&t&&(i=160),l=o.a.createElement(fe.a,{room:a,height:i,width:i})}else{const e=d()("mx_VideoFeed_video",{mx_VideoFeed_video_mirror:this.props.feed.isLocal()&&this.props.feed.purpose===Cs.b.Usermedia&&v.b.getValue("VideoView.flipVideoHorizontally")});l=o.a.createElement("video",{className:e,ref:this.setElementRef})}return o.a.createElement("div",{className:i},s,l)}}var xs=n(162);class ks extends o.a.Component{render(){const e=this.props.feeds.map((e=>o.a.createElement(Os,{key:e.stream.id,feed:e,call:this.props.call,primary:!1,pipMode:this.props.pipMode}))),t=d()("mx_LegacyCallViewSidebar",{mx_LegacyCallViewSidebar_pipMode:this.props.pipMode});return o.a.createElement("div",{className:t},e)}}const Rs=({onExpand:e,onPin:t,onMaximize:n})=>o.a.createElement("div",{className:"mx_LegacyCallViewHeader_controls"},n&&o.a.createElement($.a,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_fullscreen",onClick:n,title:Object(N.b)("Fill screen")}),t&&o.a.createElement($.a,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_pin",onClick:t,title:Object(N.b)("Pin")}),e&&o.a.createElement($.a,{className:"mx_LegacyCallViewHeader_button mx_LegacyCallViewHeader_button_expand",onClick:e,title:Object(N.b)("Return to call")})),js=({callRoom:e})=>o.a.createElement("span",{className:"mx_LegacyCallViewHeader_secondaryCallInfo"},o.a.createElement(fe.a,{room:e,height:16,width:16}),o.a.createElement("span",{className:"mx_LegacyCallView_secondaryCall_roomName"},Object(N.b)("%(name)s on hold",{name:e.name})));var Is=({pipMode:e=!1,callRooms:t,onPipMouseDown:n,onExpand:a,onPin:i,onMaximize:r})=>{const[s,l]=t,c=s.name;return e?o.a.createElement("div",{className:"mx_LegacyCallViewHeader mx_LegacyCallViewHeader_pip",onMouseDown:n},o.a.createElement(fe.a,{room:s,height:32,width:32}),o.a.createElement("div",{className:"mx_LegacyCallViewHeader_callInfo"},o.a.createElement("div",{className:"mx_LegacyCallViewHeader_roomName"},c),l&&o.a.createElement(js,{callRoom:l})),o.a.createElement(Rs,{onExpand:a,onPin:i,onMaximize:r})):o.a.createElement("div",{className:"mx_LegacyCallViewHeader"},o.a.createElement("div",{className:"mx_LegacyCallViewHeader_icon"}),o.a.createElement("span",{className:"mx_LegacyCallViewHeader_text"},Object(N.b)("Call")),o.a.createElement(Rs,{onMaximize:r}))};class Ts extends o.a.Component{constructor(e){super(e),i()(this,"onHoldClick",(()=>{this.props.call.setRemoteOnHold(!0),this.props.onFinished()})),i()(this,"onUnholdClick",(()=>{V.b.instance.setActiveCallRoomId(this.props.call.roomId),this.props.onFinished()})),i()(this,"onTransferClick",(()=>{V.b.instance.showTransferDialog(this.props.call),this.props.onFinished()}))}render(){const e=this.props.call.isRemoteOnHold()?Object(N.b)("Resume"):Object(N.b)("Hold"),t=this.props.call.isRemoteOnHold()?this.onUnholdClick:this.onHoldClick;let n;return this.props.call.opponentCanBeTransferred()&&(n=o.a.createElement(le.d,{className:"mx_LegacyCallContextMenu_item",onClick:this.onTransferClick},Object(N.b)("Transfer"))),o.a.createElement(le.n,this.props,o.a.createElement(le.d,{className:"mx_LegacyCallContextMenu_item",onClick:t},e),n)}}var Ps=n(665);class Ns extends r.Component{constructor(e){super(e),i()(this,"numberEntryFieldRef",Object(r.createRef)()),i()(this,"onDigitPress",((e,t)=>{var n;(this.props.call.sendDtmfDigit(e),this.setState({value:this.state.value+e}),"click"===t.type)&&(null===(n=this.numberEntryFieldRef.current)||void 0===n||n.focus())})),i()(this,"onCancelClick",(()=>{this.props.onFinished()})),i()(this,"onKeyDown",(e=>{"Backspace"!==e.code&&"Delete"!==e.code||e.preventDefault()})),i()(this,"onChange",(e=>{this.setState({value:e.target.value})})),this.state={value:""}}render(){return r.createElement(le.n,this.props,r.createElement("div",{className:"mx_DialPadContextMenuWrapper"},r.createElement("div",null,r.createElement(K.a,{className:"mx_DialPadContextMenu_cancel",onClick:this.onCancelClick})),r.createElement("div",{className:"mx_DialPadContextMenu_header"},r.createElement(at.a,{ref:this.numberEntryFieldRef,className:"mx_DialPadContextMenu_dialled",value:this.state.value,autoFocus:!0,onKeyDown:this.onKeyDown,onChange:this.onChange})),r.createElement("div",{className:"mx_DialPadContextMenu_dialPad"},r.createElement(Ps.a,{onDigitPress:this.onDigitPress,hasDial:!1}))))}}const Ds=["deviceKinds"],Ms={[p.b.AudioInput]:Object(N.d)("Input devices"),[p.b.AudioOutput]:Object(N.d)("Output devices"),[p.b.VideoInput]:Object(N.d)("Cameras")},As=({label:e,selected:t,onClick:n})=>o.a.createElement(de.d,{iconClassName:"mx_DeviceContextMenu_device_icon",label:e,active:t,onClick:n}),Ls=({deviceKind:e})=>{const[t,n]=Object(r.useState)([]),[a,i]=Object(r.useState)(p.c.getDevice(e));Object(r.useEffect)((()=>{(async()=>{var t,a;n(null!==(t=null===(a=await p.c.getDevices())||void 0===a?void 0:a[e])&&void 0!==t?t:[])})()}),[e]);return o.a.createElement(de.c,{label:Object(N.b)(Ms[e])},t.map((({label:t,deviceId:n})=>o.a.createElement(As,{key:n,label:t,selected:a===n,onClick:()=>(t=>{p.c.instance.setDevice(t,e),i(t)})(n)}))))};var Us=e=>{let{deviceKinds:t}=e,n=ge()(e,Ds);return o.a.createElement(de.e,ee()({compact:!0,className:"mx_DeviceContextMenu"},n),t.map((e=>o.a.createElement(Ls,{key:e,deviceKind:e}))))};const Fs=["children","state","className","onLabel","offLabel"],Bs=["state","deviceKinds"],Vs=e=>{let{children:t,state:n,className:a,onLabel:i,offLabel:r}=e,s=ge()(e,Fs);const l=d()("mx_LegacyCallViewButtons_button",a,{mx_LegacyCallViewButtons_button_on:n,mx_LegacyCallViewButtons_button_off:!n});return o.a.createElement($.a,ee()({className:l,title:n?i:r,alignment:Zr.a.Top},s),t)},Ws=e=>{let{state:t,deviceKinds:n}=e,a=ge()(e,Bs);const[i,s,l,c]=Object(le.q)(),[u,m]=Object(r.useState)(!1),h=d()("mx_LegacyCallViewButtons_button","mx_LegacyCallViewButtons_dropdownButton",{mx_LegacyCallViewButtons_dropdownButton_collapsed:!i});return o.a.createElement(Vs,ee()({inputRef:s,forceHide:i||u,state:t},a),o.a.createElement(Vs,{className:h,onClick:e=>{e.stopPropagation(),l()},onHover:e=>m(e),state:t}),i&&s.current&&o.a.createElement(Us,ee()({},Object(le.k)(s.current.getBoundingClientRect()),{onFinished:c,deviceKinds:n})))};class zs extends o.a.Component{constructor(e){super(e),i()(this,"dialpadButton",Object(r.createRef)()),i()(this,"contextMenuButton",Object(r.createRef)()),i()(this,"controlsHideTimer",null),i()(this,"onControlsHideTimer",(()=>{this.state.hoveringControls||this.state.showDialpad||this.state.showMoreMenu||(this.controlsHideTimer=null,this.setState({visible:!1}))})),i()(this,"onMouseEnter",(()=>{this.setState({hoveringControls:!0})})),i()(this,"onMouseLeave",(()=>{this.setState({hoveringControls:!1})})),i()(this,"onDialpadClick",(()=>{this.state.showDialpad?this.setState({showDialpad:!1}):(this.setState({showDialpad:!0}),this.showControls())})),i()(this,"onMoreClick",(()=>{this.setState({showMoreMenu:!0}),this.showControls()})),i()(this,"closeDialpad",(()=>{this.setState({showDialpad:!1})})),i()(this,"closeContextMenu",(()=>{this.setState({showMoreMenu:!1})})),this.state={showDialpad:!1,hoveringControls:!1,showMoreMenu:!1,visible:!0}}componentDidMount(){this.showControls()}showControls(){this.state.showMoreMenu||this.state.showDialpad||(this.state.visible||this.setState({visible:!0}),null!==this.controlsHideTimer&&clearTimeout(this.controlsHideTimer),this.controlsHideTimer=window.setTimeout(this.onControlsHideTimer,2e3))}render(){const e=d()("mx_LegacyCallViewButtons",{mx_LegacyCallViewButtons_hidden:!this.state.visible});let t,n;return this.state.showDialpad&&this.dialpadButton.current&&(t=o.a.createElement(Ns,ee()({},Object(le.l)(this.dialpadButton.current.getBoundingClientRect(),le.a.None,8),{mountAsChild:!this.props.pipMode,onFinished:this.closeDialpad,call:this.props.call}))),this.state.showMoreMenu&&this.contextMenuButton.current&&(n=o.a.createElement(Ts,ee()({},Object(le.l)(this.contextMenuButton.current.getBoundingClientRect(),le.a.None,8),{mountAsChild:!this.props.pipMode,onFinished:this.closeContextMenu,call:this.props.call}))),o.a.createElement("div",{className:e,onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},t,n,this.props.buttonsVisibility.dialpad&&o.a.createElement(le.c,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_dialpad",inputRef:this.dialpadButton,onClick:this.onDialpadClick,isExpanded:this.state.showDialpad,title:Object(N.b)("Dialpad"),alignment:Zr.a.Top}),o.a.createElement(Ws,{state:!this.props.buttonsState.micMuted,className:"mx_LegacyCallViewButtons_button_mic",onLabel:Object(N.b)("Mute the microphone"),offLabel:Object(N.b)("Unmute the microphone"),onClick:this.props.handlers.onMicMuteClick,deviceKinds:[p.b.AudioInput,p.b.AudioOutput]}),this.props.buttonsVisibility.vidMute&&o.a.createElement(Ws,{state:!this.props.buttonsState.vidMuted,className:"mx_LegacyCallViewButtons_button_vid",onLabel:Object(N.b)("Stop the camera"),offLabel:Object(N.b)("Start the camera"),onClick:this.props.handlers.onVidMuteClick,deviceKinds:[p.b.VideoInput]}),this.props.buttonsVisibility.screensharing&&o.a.createElement(Vs,{state:this.props.buttonsState.screensharing,className:"mx_LegacyCallViewButtons_button_screensharing",onLabel:Object(N.b)("Stop sharing your screen"),offLabel:Object(N.b)("Start sharing your screen"),onClick:this.props.handlers.onScreenshareClick}),this.props.buttonsVisibility.sidebar&&o.a.createElement(Vs,{state:this.props.buttonsState.sidebarShown,className:"mx_LegacyCallViewButtons_button_sidebar",onLabel:Object(N.b)("Hide sidebar"),offLabel:Object(N.b)("Show sidebar"),onClick:this.props.handlers.onToggleSidebarClick}),this.props.buttonsVisibility.contextMenu&&o.a.createElement(le.c,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_button_more",onClick:this.onMoreClick,inputRef:this.contextMenuButton,isExpanded:this.state.showMoreMenu,title:Object(N.b)("More"),alignment:Zr.a.Top}),o.a.createElement($.a,{className:"mx_LegacyCallViewButtons_button mx_LegacyCallViewButtons_button_hangup",onClick:this.props.handlers.onHangupClick,title:Object(N.b)("Hangup"),alignment:Zr.a.Top}))}}function Hs(){return document.fullscreenElement||document.webkitFullscreenElement||document.msFullscreenElement}function Gs(){const e=document.exitFullscreen||document.webkitExitFullscreen||document.msExitFullscreen;e&&e.call(document)}class Ks extends o.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"contentWrapperRef",Object(r.createRef)()),i()(this,"buttonsRef",Object(r.createRef)()),i()(this,"onAction",(e=>{if("video_fullscreen"===e.action){if(!this.contentWrapperRef.current)return;e.fullscreen?function(e){const t=e.requestFullscreen||e.webkitRequestFullScreen||e.msRequestFullscreen;t&&t.call(e)}(this.contentWrapperRef.current):Hs()&&Gs()}})),i()(this,"onCallState",(e=>{this.setState({callState:e})})),i()(this,"onFeedsChanged",(e=>{const{primary:t,secondary:n,sidebar:a}=Ks.getOrderedFeeds(e);this.setState({primaryFeed:t,secondaryFeed:n,sidebarFeeds:a,micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted()})})),i()(this,"onCallLocalHoldUnhold",(()=>{this.setState({isLocalOnHold:this.props.call.isLocalOnHold()})})),i()(this,"onCallRemoteHoldUnhold",(()=>{this.setState({isRemoteOnHold:this.props.call.isRemoteOnHold(),isLocalOnHold:this.props.call.isLocalOnHold()})})),i()(this,"onMouseMove",(()=>{var e;null===(e=this.buttonsRef.current)||void 0===e||e.showControls()})),i()(this,"onMaximizeClick",(()=>{b.a.dispatch({action:"video_fullscreen",fullscreen:!0})})),i()(this,"onMicMuteClick",(async()=>{const e=!this.state.micMuted;this.setState({micMuted:await this.props.call.setMicrophoneMuted(e)})})),i()(this,"onVidMuteClick",(async()=>{const e=!this.state.vidMuted;this.setState({vidMuted:await this.props.call.setLocalVideoMuted(e)})})),i()(this,"onScreenshareClick",(async()=>{let e;e=this.state.screensharing?await this.props.call.setScreensharingEnabled(!1):await this.props.call.setScreensharingEnabled(!0),this.setState({sidebarShown:!0,screensharing:e})})),i()(this,"onNativeKeyDown",(e=>{var t,n;let a=!1;switch(Object(Q.a)().getCallAction(e)){case z.h.ToggleMicInCall:this.onMicMuteClick(),null===(t=this.buttonsRef.current)||void 0===t||t.showControls(),a=!0;break;case z.h.ToggleWebcamInCall:this.onVidMuteClick(),null===(n=this.buttonsRef.current)||void 0===n||n.showControls(),a=!0}a&&(e.stopPropagation(),e.preventDefault())})),i()(this,"onCallResumeClick",(()=>{const e=V.b.instance.roomIdForCall(this.props.call);e&&V.b.instance.setActiveCallRoomId(e)})),i()(this,"onTransferClick",(()=>{const e=V.b.instance.getTransfereeForCallId(this.props.call.callId);e&&this.props.call.transferToCall(e)})),i()(this,"onHangupClick",(()=>{const e=V.b.instance.roomIdForCall(this.props.call);e&&V.b.instance.hangupOrReject(e)})),i()(this,"onToggleSidebar",(()=>{this.setState({sidebarShown:!this.state.sidebarShown})}));const{primary:t,secondary:n,sidebar:a}=Ks.getOrderedFeeds(this.props.call.getFeeds());this.state={isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),screensharing:this.props.call.isScreensharing(),callState:this.props.call.state,primaryFeed:t,secondaryFeed:n,sidebarFeeds:a,sidebarShown:!0},this.updateCallListeners(null,this.props.call)}componentDidMount(){this.dispatcherRef=b.a.register(this.onAction),document.addEventListener("keydown",this.onNativeKeyDown)}componentWillUnmount(){Hs()&&Gs(),document.removeEventListener("keydown",this.onNativeKeyDown),this.updateCallListeners(this.props.call,null),this.dispatcherRef&&b.a.unregister(this.dispatcherRef)}static getDerivedStateFromProps(e){const{primary:t,secondary:n,sidebar:a}=Ks.getOrderedFeeds(e.call.getFeeds());return{primaryFeed:t,secondaryFeed:n,sidebarFeeds:a}}componentDidUpdate(e){this.props.call!==e.call&&(this.setState({isLocalOnHold:this.props.call.isLocalOnHold(),isRemoteOnHold:this.props.call.isRemoteOnHold(),micMuted:this.props.call.isMicrophoneMuted(),vidMuted:this.props.call.isLocalVideoMuted(),callState:this.props.call.state}),this.updateCallListeners(null,this.props.call))}updateCallListeners(e,t){e!==t&&(e&&(e.removeListener(an.d.State,this.onCallState),e.removeListener(an.d.LocalHoldUnhold,this.onCallLocalHoldUnhold),e.removeListener(an.d.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),e.removeListener(an.d.FeedsChanged,this.onFeedsChanged)),t&&(t.on(an.d.State,this.onCallState),t.on(an.d.LocalHoldUnhold,this.onCallLocalHoldUnhold),t.on(an.d.RemoteHoldUnhold,this.onCallRemoteHoldUnhold),t.on(an.d.FeedsChanged,this.onFeedsChanged)))}static getOrderedFeeds(e){if(e.length<=2)return{primary:e.find((e=>!e.isLocal())),secondary:e.find((e=>e.isLocal())),sidebar:[]};let t;const n=e.filter((e=>e.purpose===Cs.b.Screenshare));t=n.find((e=>!e.isLocal()))||n[0],t||(t=e.find((e=>!e.isLocal())));const a=[...e];return t&&a.splice(a.indexOf(t),1),a.sort(((e,t)=>e.isLocal()&&!t.isLocal()?-1:!e.isLocal()&&t.isLocal()?1:0)),{primary:t,sidebar:a}}renderCallControls(){const{call:e,pipMode:t}=this.props,{callState:n,micMuted:a,vidMuted:i,screensharing:r,sidebarShown:s,secondaryFeed:l,sidebarFeeds:c}=this.state,d=e.opponentSupportsSDPStreamMetadata()||e.hasLocalUserMediaVideoTrack,u=(e.opponentSupportsSDPStreamMetadata()||e.hasLocalUserMediaVideoTrack)&&e.state===an.f.Connected,m=l&&!l.isVideoMuted()||c.length>0,h=n===an.f.Connected,p=n===an.f.Connected&&e.opponentSupportsDTMF();return o.a.createElement(zs,{ref:this.buttonsRef,call:e,pipMode:t,handlers:{onToggleSidebarClick:this.onToggleSidebar,onScreenshareClick:this.onScreenshareClick,onHangupClick:this.onHangupClick,onMicMuteClick:this.onMicMuteClick,onVidMuteClick:this.onVidMuteClick},buttonsState:{micMuted:a,vidMuted:i,sidebarShown:s,screensharing:r},buttonsVisibility:{vidMute:d,screensharing:u,sidebar:m,contextMenu:h,dialpad:p}})}renderToast(){var e;const{call:t}=this.props;if(!t.getFeeds().some((e=>e.purpose===Cs.b.Screenshare)))return null;const n=t.isScreensharing(),{primaryFeed:a,sidebarShown:i}=this.state,r=null==a||null===(e=a.getMember())||void 0===e?void 0:e.name;if(!r)return null;let s=n?Object(N.b)("You are presenting"):Object(N.b)("%(sharerName)s is presenting",{sharerName:r});return i||(s+=" • "+(t.isLocalVideoMuted()?Object(N.b)("Your camera is turned off"):Object(N.b)("Your camera is still enabled"))),o.a.createElement("div",{className:"mx_LegacyCallView_toast"},s)}renderContent(){var e;const{pipMode:t,call:n,onResize:a}=this.props,{isLocalOnHold:i,isRemoteOnHold:r,sidebarShown:s,primaryFeed:l,secondaryFeed:c,sidebarFeeds:u}=this.state,m=V.b.instance.roomIdForCall(n),h=null!==(e=m?tt.a.safeGet().getRoom(m):void 0)&&void 0!==e?e:void 0,p=t?76:160,g=V.b.instance.getTransfereeForCallId(n.callId),b=i||r;let v;if(s&&c&&!c.isVideoMuted()&&(v=o.a.createElement(Os,{feed:c,call:n,pipMode:t,onResize:a,secondary:!0})),g||b){const e=d()("mx_LegacyCallView_content",{mx_LegacyCallView_content_hold:b}),t=Object(xs.a)(n.getOpponentMember(),1024,1024,"crop");let a;if(g){const e=tt.a.safeGet(),t=V.b.instance.roomIdForCall(n),i=t?e.getRoom(t):null,r=i?i.name:Object(N.b)("unknown person"),s=V.b.instance.roomIdForCall(g),l=s?e.getRoom(s):null,c=l?l.name:Object(N.b)("unknown person");a=o.a.createElement("div",{className:"mx_LegacyCallView_status"},Object(N.b)("Consulting with %(transferTarget)s. <a>Transfer to %(transferee)s</a>",{transferTarget:r,transferee:c},{a:e=>o.a.createElement(K.a,{kind:"link_inline",onClick:this.onTransferClick},e)}))}else{let e;if(r)e=Object(N.b)(V.b.instance.hasAnyUnheldCall()?Object(N.d)("You held the call <a>Switch</a>"):Object(N.d)("You held the call <a>Resume</a>"),{},{a:e=>o.a.createElement(K.a,{kind:"link_inline",onClick:this.onCallResumeClick},e)});else if(i){var f;e=Object(N.b)("%(peerName)s held the call",{peerName:null===(f=n.getOpponentMember())||void 0===f?void 0:f.name})}a=o.a.createElement("div",{className:"mx_LegacyCallView_status"},e)}return o.a.createElement("div",{className:e,onMouseMove:this.onMouseMove},o.a.createElement("div",{className:"mx_LegacyCallView_holdBackground",style:{backgroundImage:"url("+t+")"}}),a)}return n.noIncomingFeeds()?o.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.a.createElement("div",{className:"mx_LegacyCallView_avatarsContainer"},o.a.createElement("div",{className:"mx_LegacyCallView_avatarContainer",style:{width:p,height:p}},o.a.createElement(fe.a,{room:h,height:p,width:p}))),o.a.createElement("div",{className:"mx_LegacyCallView_status"},Object(N.b)("Connecting")),v):t?o.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.a.createElement(Os,{feed:l,call:n,pipMode:t,onResize:a,primary:!0})):c?o.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.a.createElement(Os,{feed:l,call:n,pipMode:t,onResize:a,primary:!0}),v):o.a.createElement("div",{className:"mx_LegacyCallView_content",onMouseMove:this.onMouseMove},o.a.createElement(Os,{feed:l,call:n,pipMode:t,onResize:a,primary:!0}),s&&o.a.createElement(ks,{feeds:u,call:n,pipMode:Boolean(t)}))}render(){const{call:e,secondaryCall:t,pipMode:n,showApps:a,onMouseDownOnHeader:i}=this.props,{sidebarShown:r,sidebarFeeds:s}=this.state,l=tt.a.safeGet(),c=V.b.instance.roomIdForCall(e),u=V.b.instance.roomIdForCall(t),m=c?l.getRoom(c):null;if(!m)return null;const h=u?l.getRoom(u):null,p=d()({mx_LegacyCallView:!0,mx_LegacyCallView_pip:n,mx_LegacyCallView_large:!n,mx_LegacyCallView_sidebar:r&&0!==s.length&&!n,mx_LegacyCallView_belowWidget:a});return o.a.createElement("div",{className:p},o.a.createElement(Is,{onPipMouseDown:i,pipMode:n,callRooms:[m,h],onMaximize:this.onMaximizeClick}),o.a.createElement("div",{className:"mx_LegacyCallView_content_wrapper",ref:this.contentWrapperRef},this.renderToast(),this.renderContent(),this.renderCallControls()))}}class qs extends o.a.Component{constructor(e){super(e),i()(this,"updateCall",(()=>{const e=this.getCall();e!==this.state.call&&this.setState({call:e})})),i()(this,"onResizeStart",(()=>{this.props.resizeNotifier.startResizing()})),i()(this,"onResize",(()=>{this.props.resizeNotifier.notifyTimelineHeightChanged()})),i()(this,"onResizeStop",(()=>{this.props.resizeNotifier.stopResizing()})),this.state={call:this.getCall()}}componentDidMount(){V.b.instance.addListener(V.a.CallState,this.updateCall),V.b.instance.addListener(V.a.CallChangeRoom,this.updateCall)}componentWillUnmount(){V.b.instance.removeListener(V.a.CallState,this.updateCall),V.b.instance.removeListener(V.a.CallChangeRoom,this.updateCall)}getCall(){const e=V.b.instance.getCallForRoom(this.props.roomId);return e&&[an.f.Ended,an.f.Ringing].includes(e.state)?null:e}render(){return this.state.call?o.a.createElement("div",{className:"mx_LegacyCallViewForRoom"},o.a.createElement(gn.Resizable,{minHeight:380,maxHeight:"80vh",enable:{top:!1,right:!1,bottom:!0,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},onResizeStart:this.onResizeStart,onResize:this.onResize,onResizeStop:this.onResizeStop,className:"mx_LegacyCallViewForRoom_ResizeWrapper",handleClasses:{bottom:"mx_LegacyCallViewForRoom_ResizeHandle"}},o.a.createElement(Ks,{call:this.state.call,pipMode:!1,showApps:this.props.showApps}))):null}}class $s extends o.a.Component{constructor(e){super(e),i()(this,"onRoomStateEvents",(e=>{"re.jki.counter"===e.getType()&&this.updateCounters()})),i()(this,"updateCounters",Object(R.throttle)((()=>{this.setState({counters:this.computeCounters()})}),500,{leading:!0,trailing:!0})),this.state={counters:this.computeCounters()}}componentDidMount(){const e=tt.a.safeGet();v.b.getValue("feature_state_counters")&&e.on(l.RoomStateEvent.Events,this.onRoomStateEvents)}componentWillUnmount(){var e;v.b.getValue("feature_state_counters")&&(null===(e=tt.a.get())||void 0===e||e.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents))}shouldComponentUpdate(e,t){return Object(Yn.d)(this.props,e)||Object(Yn.d)(this.state,t)}computeCounters(){const e=[];if(this.props.room&&v.b.getValue("feature_state_counters")){const t=this.props.room.currentState.getStateEvents("re.jki.counter");t.sort(((e,t)=>Object($n.x)(e.getStateKey(),t.getStateKey())));for(const n of t){const t=n.getContent().title,a=n.getContent().value,i=n.getContent().link,r=n.getContent().severity||"normal",o=n.getStateKey();t&&void 0!==a&&e.push({title:t,value:a,link:i,severity:r,stateKey:o})}}return e}render(){const e=o.a.createElement(qs,{roomId:this.props.room.roomId,resizeNotifier:this.props.resizeNotifier,showApps:this.props.showApps});let t;v.b.getValue(oe.b.Widgets)&&(t=o.a.createElement(Ss,{room:this.props.room,userId:this.props.userId,showApps:this.props.showApps,resizeNotifier:this.props.resizeNotifier}));let n=null;if(this.state.counters&&v.b.getValue("feature_state_counters")){const e=[];this.state.counters.forEach(((t,n)=>{const a=t.title,i=t.value,r=t.link,s=t.severity,l=t.stateKey;let c=o.a.createElement("span",null,a,": ",i);r&&(c=o.a.createElement("a",{href:r,target:"_blank",rel:"noreferrer noopener"},c)),c=o.a.createElement("span",{className:"mx_AuxPanel_stateViews_span","data-severity":s,key:"x-"+l},c),e.push(c),e.push(o.a.createElement("span",{className:"mx_AuxPanel_stateViews_delim",key:"delim"+n}," ","─"," "))})),e.length>0&&(e.pop(),n=o.a.createElement("div",{className:"mx_AuxPanel_stateViews"},e))}return o.a.createElement(xt.a,{className:"mx_AuxPanel"},n,this.props.children,t,e)}}i()($s,"defaultProps",{showApps:!0});const Ys=["isHighlighted","isUnread","onClick","name","title"];class Js extends o.a.Component{render(){const e=this.props,{isHighlighted:t,isUnread:n=!1,onClick:a,name:i,title:r}=e,s=ge()(e,Ys),l=d()({mx_LegacyRoomHeader_button:!0,"mx_LegacyRoomHeader_button--highlight":t,"mx_LegacyRoomHeader_button--unread":n,[`mx_RightPanel_${i}`]:!0});return o.a.createElement($.a,ee()({},s,{"aria-current":t?"true":"false",title:r,alignment:Zr.a.Bottom,className:l,onClick:a}))}}let Qs=function(e){return e.Room="room",e}({});class Xs extends o.a.Component{constructor(e,t){super(e),i()(this,"unmounted",!1),i()(this,"dispatcherRef",void 0),i()(this,"onRightPanelStoreUpdate",(()=>{this.unmounted||this.setState({phase:fn.a.instance.currentCard.phase})}));const n=fn.a.instance;this.state={headerKind:t,phase:n.currentCard.phase,threadNotificationColor:Ce.a.None,globalNotificationColor:Ce.a.None}}componentDidMount(){fn.a.instance.on(ft.b,this.onRightPanelStoreUpdate),this.dispatcherRef=b.a.register(this.onAction.bind(this))}componentWillUnmount(){this.unmounted=!0,fn.a.instance.off(ft.b,this.onRightPanelStoreUpdate),this.dispatcherRef&&b.a.unregister(this.dispatcherRef)}setPhase(e,t){const n=fn.a.instance;n.currentCard.phase==e&&!t&&n.isOpen?n.togglePanel(null):(fn.a.instance.setCard({phase:e,state:t}),n.isOpen||n.togglePanel(null))}isPhase(e){return!!fn.a.instance.isOpen&&(Array.isArray(e)?!!this.state.phase&&e.includes(this.state.phase):e===this.state.phase)}render(){return this.renderButtons()}}var Zs=n(249);const el=[vn.a.RoomSummary,vn.a.Widget,vn.a.FilePanel,vn.a.RoomMemberList,vn.a.RoomMemberInfo,vn.a.EncryptionPanel,vn.a.Room3pidMemberInfo],tl=({color:e})=>{if(e===Ce.a.None)return null;const t=d()({mx_Indicator:!0,mx_LegacyRoomHeader_button_unreadIndicator:!0,mx_Indicator_bold:e===Ce.a.Bold,mx_Indicator_gray:e===Ce.a.Grey,mx_Indicator_red:e===Ce.a.Red});return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_LegacyRoomHeader_button_unreadIndicator_bg"}),o.a.createElement("div",{className:t}))},nl=({room:e,isHighlighted:t,onClick:n})=>{const a=Ya(e),i=Qa(e);if(null==a||!a.length)return null;let r;return a.some((e=>!i.has(e)))&&(r=o.a.createElement(tl,null)),o.a.createElement(Js,{name:"pinnedMessagesButton",title:Object(N.b)("Pinned messages"),isHighlighted:t,isUnread:!!r,onClick:n},r)},al=({room:e,isHighlighted:t,onClick:n})=>{let a;const i=Pe.a.instance.getRoomState(e).color;switch(i){case Ce.a.Bold:case Ce.a.Grey:case Ce.a.Red:a=o.a.createElement(tl,{color:i})}return o.a.createElement(Js,{name:"timelineCardButton",title:Object(N.b)("Chat"),isHighlighted:t,onClick:n},a)};class il extends Xs{constructor(e){super(e,Qs.Room),i()(this,"globalNotificationState",void 0),i()(this,"onNotificationUpdate",(()=>{this.setState({threadNotificationColor:this.notificationColor})})),i()(this,"onUpdateStatus",(e=>{this.globalNotificationState=e,this.setState({globalNotificationColor:e.color})})),i()(this,"onRoomSummaryClicked",(()=>{const e=fn.a.instance.currentCard.phase;e&&el.includes(e)?this.state.phase===e?this.setPhase(e):this.setPhase(e,fn.a.instance.currentCard.state):this.setPhase(vn.a.RoomSummary)})),i()(this,"onNotificationsClicked",(()=>{this.setPhase(vn.a.NotificationPanel)})),i()(this,"onPinnedMessagesClicked",(()=>{this.setPhase(vn.a.PinnedMessages)})),i()(this,"onTimelineCardClicked",(()=>{this.setPhase(vn.a.Timeline)})),i()(this,"onThreadsPanelClicked",(e=>{var t,n;this.state.phase&&il.THREAD_PHASES.includes(this.state.phase)?fn.a.instance.togglePanel(null!==(t=null===(n=this.props.room)||void 0===n?void 0:n.roomId)&&void 0!==t?t:null):(fn.a.instance.setCard({phase:vn.a.ThreadPanel}),re.b.trackInteraction("WebRoomHeaderButtonsThreadsButton",e))})),this.globalNotificationState=Pe.a.instance.globalState}componentDidMount(){var e,t,n,a,i,r,o,s;super.componentDidMount(),null===(e=this.props.room)||void 0===e||e.on(l.RoomEvent.UnreadNotifications,this.onNotificationUpdate),null===(t=this.props.room)||void 0===t||t.on(l.RoomEvent.Receipt,this.onNotificationUpdate),null===(n=this.props.room)||void 0===n||n.on(l.RoomEvent.Timeline,this.onNotificationUpdate),null===(a=this.props.room)||void 0===a||a.on(l.RoomEvent.Redaction,this.onNotificationUpdate),null===(i=this.props.room)||void 0===i||i.on(l.RoomEvent.LocalEchoUpdated,this.onNotificationUpdate),null===(r=this.props.room)||void 0===r||r.on(l.RoomEvent.MyMembership,this.onNotificationUpdate),null===(o=this.props.room)||void 0===o||o.on(dn.f.New,this.onNotificationUpdate),null===(s=this.props.room)||void 0===s||s.on(dn.f.Update,this.onNotificationUpdate),this.onNotificationUpdate(),Pe.a.instance.on(Pe.b,this.onUpdateStatus)}componentWillUnmount(){var e,t,n,a,i,r,o,s;super.componentWillUnmount(),null===(e=this.props.room)||void 0===e||e.off(l.RoomEvent.UnreadNotifications,this.onNotificationUpdate),null===(t=this.props.room)||void 0===t||t.off(l.RoomEvent.Receipt,this.onNotificationUpdate),null===(n=this.props.room)||void 0===n||n.off(l.RoomEvent.Timeline,this.onNotificationUpdate),null===(a=this.props.room)||void 0===a||a.off(l.RoomEvent.Redaction,this.onNotificationUpdate),null===(i=this.props.room)||void 0===i||i.off(l.RoomEvent.LocalEchoUpdated,this.onNotificationUpdate),null===(r=this.props.room)||void 0===r||r.off(l.RoomEvent.MyMembership,this.onNotificationUpdate),null===(o=this.props.room)||void 0===o||o.off(dn.f.New,this.onNotificationUpdate),null===(s=this.props.room)||void 0===s||s.off(dn.f.Update,this.onNotificationUpdate),Pe.a.instance.off(Pe.b,this.onUpdateStatus)}get notificationColor(){var e;switch(null===(e=this.props.room)||void 0===e?void 0:e.threadsAggregateNotificationType){case l.NotificationCountType.Highlight:return Ce.a.Red;case l.NotificationCountType.Total:return Ce.a.Grey}for(const e of this.props.room.getThreads())if(Object(Zs.b)(e))return Ce.a.Bold;return Ce.a.None}onAction(e){e.action===F.a.ViewUser?e.member?e.push?fn.a.instance.pushCard({phase:vn.a.RoomMemberInfo,state:{member:e.member}}):fn.a.instance.setCards([{phase:vn.a.RoomSummary},{phase:vn.a.RoomMemberList},{phase:vn.a.RoomMemberInfo,state:{member:e.member}}]):this.setPhase(vn.a.RoomMemberList):"view_3pid_invite"===e.action&&(e.event?this.setPhase(vn.a.Room3pidMemberInfo,{memberInfoEvent:e.event}):this.setPhase(vn.a.RoomMemberList))}renderButtons(){if(!this.props.room)return o.a.createElement(o.a.Fragment,null);const e=new Map;return v.b.getValue("feature_pinning")&&e.set(vn.a.PinnedMessages,o.a.createElement(nl,{key:"pinnedMessagesButton",room:this.props.room,isHighlighted:this.isPhase(vn.a.PinnedMessages),onClick:this.onPinnedMessagesClicked})),e.set(vn.a.Timeline,o.a.createElement(al,{key:"timelineButton",room:this.props.room,isHighlighted:this.isPhase(vn.a.Timeline),onClick:this.onTimelineCardClicked})),e.set(vn.a.ThreadPanel,o.a.createElement(Js,{key:vn.a.ThreadPanel,name:"threadsButton","data-testid":"threadsButton",title:Object(N.b)("Threads"),onClick:this.onThreadsPanelClicked,isHighlighted:this.isPhase(il.THREAD_PHASES),isUnread:this.state.threadNotificationColor>Ce.a.None},o.a.createElement(tl,{color:this.state.threadNotificationColor}))),e.set(vn.a.NotificationPanel,o.a.createElement(Js,{key:"notifsButton",name:"notifsButton",title:Object(N.b)("Notifications"),isHighlighted:this.isPhase(vn.a.NotificationPanel),onClick:this.onNotificationsClicked,isUnread:this.globalNotificationState.color===Ce.a.Red},this.globalNotificationState.color===Ce.a.Red?o.a.createElement(tl,{color:this.globalNotificationState.color}):null)),e.set(vn.a.RoomSummary,o.a.createElement(Js,{key:"roomSummaryButton",name:"roomSummaryButton",title:Object(N.b)("Room info"),isHighlighted:this.isPhase(el),onClick:this.onRoomSummaryClicked})),o.a.createElement(o.a.Fragment,null,Array.from(e.keys()).map((t=>{var n;return null!==(n=this.props.excludedRightPanelPhaseButtons)&&void 0!==n&&n.includes(t)?null:e.get(t)})))}}i()(il,"THREAD_PHASES",[vn.a.ThreadPanel,vn.a.ThreadView]);var rl=n(818),ol=n(355),sl=n(84),ll=n(429),cl=n(780);const dl=["room","onFinished"];var ul=e=>{var t;let{room:n,onFinished:a}=e,i=ge()(e,dl);const s=Object(r.useContext)(I.a),l=Object(ae.b)(zt.c.instance,zt.b,(()=>zt.c.instance.getTagsForRoom(n)));let c;if(l.includes(P.a.Archived)){const e=e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"forget_room",room_id:n.roomId}),a()};c=o.a.createElement(de.b,{iconClassName:"mx_RoomTile_iconSignOut",label:Object(N.b)("Forget"),className:"mx_IconizedContextMenu_option_red",onClick:e})}else{const e=e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"leave_room",room_id:n.roomId}),a(),re.b.trackInteraction("WebRoomHeaderContextMenuLeaveItem",e)};c=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Leave"),className:"mx_IconizedContextMenu_option_red",iconClassName:"mx_RoomTile_iconSignOut"})}const d=es.a.shared().getUserIdForRoomId(n.roomId),u=Object(ie.a)("feature_video_rooms"),m=Object(ie.a)("feature_element_call_video_rooms"),h=u&&(n.isElementVideoRoom()||m&&n.isCallRoom());let p,g,f,y,E,w,S;if(n.canInvite(s.getUserId())&&!d&&Object(te.a)(oe.a.InviteUsers)){const e=e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"view_invite",roomId:n.roomId}),a(),re.b.trackInteraction("WebRoomHeaderContextMenuInviteItem",e)};p=o.a.createElement(de.b,{onClick:e,label:Object(N.b)("Invite"),iconClassName:"mx_RoomTile_iconInvite"})}if("join"===n.getMyMembership()){const e=l.includes(P.a.Favourite);g=o.a.createElement(de.a,{onClick:e=>{R(e,P.a.Favourite),re.b.trackInteraction("WebRoomHeaderContextMenuFavouriteToggle",e)},active:e,label:e?Object(N.b)("Favourited"):Object(N.b)("Favourite"),iconClassName:"mx_RoomTile_iconStar"});const t=l.includes(P.a.LowPriority);f=o.a.createElement(de.a,{onClick:e=>R(e,P.a.LowPriority),active:t,label:Object(N.b)("Low priority"),iconClassName:"mx_RoomTile_iconArrowDown"});let i,r;switch(ol.a.forRoom(n).notificationVolume){case sl.a.AllMessages:i=Object(N.b)("Default"),r="mx_RoomTile_iconNotificationsDefault";break;case sl.a.AllMessagesLoud:i=Object(N.b)("All messages"),r="mx_RoomTile_iconNotificationsAllMessages";break;case sl.a.MentionsOnly:i=Object(N.b)("Mentions only"),r="mx_RoomTile_iconNotificationsMentionsKeywords";break;case sl.a.Mute:i=Object(N.b)("Mute"),r="mx_RoomTile_iconNotificationsNone"}y=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"open_room_settings",room_id:n.roomId,initial_tab_id:ll.a.Notifications}),a(),re.b.trackInteraction("WebRoomHeaderContextMenuNotificationsItem",e)},label:Object(N.b)("Notifications"),iconClassName:r},o.a.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},i))}d||(E=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),j(e),fn.a.instance.pushCard({phase:vn.a.RoomMemberList},!1),a(),re.b.trackInteraction("WebRoomHeaderContextMenuPeopleItem",e)},label:Object(N.b)("People"),iconClassName:"mx_RoomTile_iconPeople"},o.a.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},n.getJoinedMemberCount())),w=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"copy_room",room_id:n.roomId}),a()},label:Object(N.b)("Copy room link"),iconClassName:"mx_RoomTile_iconCopyLink"})),h||(S=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),j(e),fn.a.instance.pushCard({phase:vn.a.FilePanel},!1),a()},label:Object(N.b)("Files"),iconClassName:"mx_RoomTile_iconFiles"}));const _=Object(ie.a)("feature_pinning"),C=null===(t=Ya(_?n:void 0))||void 0===t?void 0:t.length;let O,x,k;_&&!h&&(O=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),j(e),fn.a.instance.pushCard({phase:vn.a.PinnedMessages},!1),a()},label:Object(N.b)("Pinned"),iconClassName:"mx_RoomTile_iconPins"},C>0&&o.a.createElement("span",{className:"mx_IconizedContextMenu_sublabel"},C))),h||(x=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),j(e),fn.a.instance.setCard({phase:vn.a.RoomSummary},!1),a()},label:Object(N.b)("Widgets"),iconClassName:"mx_RoomTile_iconWidgets"})),h||(k=o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),H.b.createDialog(ui,{room:n}),a()},label:Object(N.b)("Export chat"),iconClassName:"mx_RoomTile_iconExport"}));const R=(e,t)=>{if(e.preventDefault(),e.stopPropagation(),t===P.a.Favourite||t===P.a.LowPriority){const e=t===P.a.Favourite?P.a.LowPriority:P.a.Favourite,a=zt.c.instance.getTagsForRoom(n).includes(t),i=a?t:e,r=a?null:t;b.a.dispatch(rl.a.tagRoom(s,n,i,r,0))}else on.a.warn(`Unexpected tag ${t} applied to ${n.roomId}`);if(Object(Q.a)().getAccessibilityAction(e)===z.h.Enter)a()},j=e=>{Ze.b.instance.roomViewStore.getRoomId()!==n.roomId&&b.a.dispatch({action:F.a.ViewRoom,room_id:n.roomId,metricsTrigger:"RoomList",metricsViaKeyboard:"click"!==e.type},!0)};return o.a.createElement(de.e,ee()({},i,{onFinished:a,className:"mx_RoomTile_contextMenu",compact:!0}),o.a.createElement(de.c,null,p,y,g,E,S,O,x,f,w,o.a.createElement(de.b,{onClick:e=>{e.preventDefault(),e.stopPropagation(),b.a.dispatch({action:"open_room_settings",room_id:n.roomId}),a(),re.b.trackInteraction("WebRoomHeaderContextMenuSettingsItem",e)},label:Object(N.b)("Settings"),iconClassName:"mx_RoomTile_iconSettings"}),k,v.b.getValue("developerMode")&&o.a.createElement(cl.a,{onFinished:a,roomId:n.roomId}),c))},ml=n(447),hl=n(114),pl=n(164),gl=n(126),bl=n(346),vl=n(795),fl=n(794);const yl=({liveBeaconIds:e,roomId:t})=>{const{onStopSharing:n,onResetLocationPublishError:a,beacon:i,stoppingInProgress:r,hasStopSharingError:s,hasLocationPublishError:l}=Object(gl.k)(e);if(!i)return null;const c=s||l,d=e=>t=>{null==t||t.stopPropagation(),e()};return o.a.createElement("div",{className:"mx_RoomLiveShareWarning",onClick:()=>{b.a.dispatch({action:F.a.ViewRoom,room_id:i.roomId,metricsTrigger:void 0,event_id:i.beaconInfoId,scroll_into_view:!0,highlighted:!0})}},o.a.createElement(bl.a,{className:"mx_RoomLiveShareWarning_icon",withError:c}),o.a.createElement("span",{className:"mx_RoomLiveShareWarning_label"},((e,t)=>e?Object(N.b)("An error occurred whilst sharing your live location, please try again"):t?Object(N.b)("An error occurred while stopping your live location, please try again"):Object(N.b)("You are sharing your live location"))(l,s)),r&&o.a.createElement("span",{className:"mx_RoomLiveShareWarning_spinner"},o.a.createElement(Ma.a,{h:16,w:16})),!r&&!c&&o.a.createElement(fl.a,{beacon:i}),o.a.createElement(K.a,{className:"mx_RoomLiveShareWarning_stopButton","data-testid":"room-live-share-primary-button",onClick:d((()=>{l?a():n()})),kind:"danger",element:"button",disabled:r},c?Object(N.b)("Retry"):Object(N.b)("Stop")),l&&o.a.createElement(K.a,{"data-testid":"room-live-share-wire-error-close-button",title:Object(N.b)("Stop and close"),element:"button",className:"mx_RoomLiveShareWarning_closeButton",onClick:d(n)},o.a.createElement(vl.a,{className:"mx_RoomLiveShareWarning_closeButtonIcon"})))};var El=({roomId:e})=>{const t=Object(ae.b)(pl.a.instance,pl.b.MonitoringLivePosition,(()=>pl.a.instance.isMonitoringLiveLocation)),n=Object(ae.b)(pl.a.instance,pl.b.LivenessChange,(()=>pl.a.instance.getLiveBeaconIds(e)));return t&&n.length?o.a.createElement(yl,{liveBeaconIds:n,roomId:e}):null};const wl=e=>e.isElementVideoRoom()||v.b.getValue("feature_element_call_video_rooms")&&e.isCallRoom();var Sl=n(185),_l=n(781),Cl=n(56),Ol=n(607);const xl=({roomId:e,call:t})=>{const n=Object(r.useCallback)((t=>{t.preventDefault(),b.b.dispatch({action:F.a.ViewRoom,room_id:e,view_call:!0,metricsTrigger:void 0})}),[e]),a=Object(r.useCallback)((()=>{const n=t.groupCall.room.currentState.getStateEvents(l.EventType.GroupCallPrefix,t.groupCall.groupCallId);null!==n?b.a.dispatch({action:F.a.ViewRoom,room_id:e,metricsTrigger:void 0,event_id:n.getId(),scroll_into_view:!0,highlighted:!0}):on.a.error("Couldn't find a group call event to jump to")}),[t,e]);return o.a.createElement("div",{className:"mx_RoomCallBanner",onClick:a},o.a.createElement("div",{className:"mx_RoomCallBanner_text"},o.a.createElement("span",{className:"mx_RoomCallBanner_label"},Object(N.b)("Video call")),o.a.createElement(Ol.b,{groupCall:t.groupCall})),o.a.createElement(K.a,{onClick:n,kind:"primary",element:"button",disabled:!1},Object(N.b)("Join")))};var kl=({roomId:e})=>{const t=Object(Sl.a)(e),n=Object(ae.b)(pl.a.instance,pl.b.MonitoringLivePosition,(()=>pl.a.instance.isMonitoringLiveLocation)),a=Object(ae.b)(pl.a.instance,pl.b.LivenessChange,(()=>pl.a.instance.getLiveBeaconIds(e)));return n&&a.length||Ze.b.instance.roomViewStore.isViewingCall()?null:null!==t&&t.connectionState===Cl.c.Disconnected?o.a.createElement(xl,{call:t,roomId:e}):null};class Rl{constructor(e){this.reason=e}}const jl=({room:e,busy:t,setBusy:n,behavior:a})=>{const{onClick:i,tooltip:s,disabled:l}=Object(r.useMemo)((()=>a instanceof Rl?{onClick:()=>{},tooltip:a.reason,disabled:!0}:{onClick:async t=>{t.preventDefault(),n(!0),await V.b.instance.placeCall(e.roomId,an.g.Voice),n(!1)},disabled:!1}),[a,e,n]);return o.a.createElement($.a,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_voiceCallButton",onClick:i,title:Object(N.b)("Voice call"),tooltip:null!=s?s:Object(N.b)("Voice call"),alignment:Zr.a.Bottom,disabled:l||t})},Il=({room:e,busy:t,setBusy:n,behavior:a})=>{const[i,s,l,c]=Object(le.q)(),d=Object(r.useCallback)((async()=>{n(!0),await V.b.instance.placeCall(e.roomId,an.g.Video),n(!1)}),[n,e]),u=Object(r.useCallback)((()=>{n(!0),b.a.dispatch({action:F.a.ViewRoom,room_id:e.roomId,view_call:!0,metricsTrigger:void 0}),n(!1)}),[n,e]),{onClick:m,tooltip:h,disabled:p}=Object(r.useMemo)((()=>a instanceof Rl?{onClick:()=>{},tooltip:a.reason,disabled:!0}:"legacy_or_jitsi"===a?{onClick:async e=>{e.preventDefault(),await d()},disabled:!1}:"element"===a?{onClick:async e=>{e.preventDefault(),u()},disabled:!1}:{onClick:async e=>{e.preventDefault(),l()},disabled:!1}),[a,d,u,l]),g=Object(r.useCallback)((async e=>{e.preventDefault(),c(),await d()}),[c,d]),v=Object(r.useCallback)((e=>{e.preventDefault(),c(),u()}),[c,u]);let f=null;if(i){const e=s.current.getBoundingClientRect(),t=it.b.get("element_call").brand;f=o.a.createElement(de.e,ee()({},Object(le.i)(e),{onFinished:c}),o.a.createElement(de.c,null,o.a.createElement(de.b,{label:Object(N.b)("Video call (Jitsi)"),onClick:g}),o.a.createElement(de.b,{label:Object(N.b)("Video call (%(brand)s)",{brand:t}),onClick:v})))}return o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,{inputRef:s,className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_videoCallButton",onClick:m,title:Object(N.b)("Video call"),tooltip:null!=h?h:Object(N.b)("Video call"),alignment:Zr.a.Bottom,disabled:p||t}),f)},Tl=({room:e})=>{const[t,n]=Object(r.useState)(!1),a=Object(ie.b)("showCallButtonsInComposer"),i=Object(ie.a)("feature_group_calls"),s=Object(ie.a)("feature_video_rooms"),c=Object(r.useMemo)((()=>s&&wl(e)),[s,e]),d=Object(r.useMemo)((()=>it.b.get("element_call").use_exclusively),[]),u=Object(ae.b)(V.b.instance,V.a.CallsChanged,Object(r.useCallback)((()=>null!==V.b.instance.getCallForRoom(e.roomId)),[e])),m=bi(e),h=Object(r.useMemo)((()=>m.some((e=>Mn.a.JITSI.matches(e.type)))),[m]),p=null!==Object(Sl.a)(e.roomId),[g,b,v]=Object(ae.d)(e,l.RoomStateEvent.Update,Object(r.useCallback)((()=>[Object(_l.a)(e),e.currentState.mayClientSendStateEvent("im.vector.modular.widgets",e.client),e.currentState.mayClientSendStateEvent(Cl.d.CALL_EVENT_TYPE.name,e.client)]),[e])),f=a=>o.a.createElement(jl,{room:e,busy:t,setBusy:n,behavior:a}),y=a=>o.a.createElement(Il,{room:e,busy:t,setBusy:n,behavior:a});if(c||!a)return null;if(i){if(d)return y(p?new Rl(Object(N.b)("Ongoing call")):v?"element":new Rl(Object(N.b)("You do not have permission to start video calls")));if(u||h||p)return o.a.createElement(o.a.Fragment,null,f(new Rl(Object(N.b)("Ongoing call"))),y(new Rl(Object(N.b)("Ongoing call"))));if(g.length<=1)return o.a.createElement(o.a.Fragment,null,f(new Rl(Object(N.b)("There's no one here to call"))),y(new Rl(Object(N.b)("There's no one here to call"))));if(2===g.length)return o.a.createElement(o.a.Fragment,null,f("legacy_or_jitsi"),y("legacy_or_jitsi"));if(b)return o.a.createElement(o.a.Fragment,null,f("legacy_or_jitsi"),y(v?"jitsi_or_element":"legacy_or_jitsi"));{const e=v?"element":new Rl(Object(N.b)("You do not have permission to start video calls"));return o.a.createElement(o.a.Fragment,null,f(new Rl(Object(N.b)("You do not have permission to start voice calls"))),y(e))}}return u||h?o.a.createElement(o.a.Fragment,null,f(new Rl(Object(N.b)("Ongoing call"))),y(new Rl(Object(N.b)("Ongoing call")))):g.length<=1?o.a.createElement(o.a.Fragment,null,f(new Rl(Object(N.b)("There's no one here to call"))),y(new Rl(Object(N.b)("There's no one here to call")))):2===g.length||b?o.a.createElement(o.a.Fragment,null,f("legacy_or_jitsi"),y("legacy_or_jitsi")):o.a.createElement(o.a.Fragment,null,f(new Rl(Object(N.b)("You do not have permission to start voice calls"))),y(new Rl(Object(N.b)("You do not have permission to start video calls"))))},Pl=({call:e})=>{const t=Object(Sl.e)(e),[n,a,i,s]=Object(le.q)(),l=Object(r.useCallback)((e=>{e.preventDefault(),i()}),[i]),c=Object(r.useCallback)((t=>{t.preventDefault(),s(),e.setLayout(Cl.f.Tile)}),[s,e]),u=Object(r.useCallback)((t=>{t.preventDefault(),s(),e.setLayout(Cl.f.Spotlight)}),[s,e]);let m=null;if(n){const e=a.current.getBoundingClientRect();m=o.a.createElement(de.e,ee()({className:"mx_LegacyRoomHeader_layoutMenu"},Object(le.i)(e),{onFinished:s}),o.a.createElement(de.c,null,o.a.createElement(de.d,{iconClassName:"mx_LegacyRoomHeader_freedomIcon",label:Object(N.b)("Freedom"),active:t===Cl.f.Tile,onClick:c}),o.a.createElement(de.d,{iconClassName:"mx_LegacyRoomHeader_spotlightIcon",label:Object(N.b)("Spotlight"),active:t===Cl.f.Spotlight,onClick:u})))}return o.a.createElement(o.a.Fragment,null,o.a.createElement($.a,{inputRef:a,className:d()("mx_LegacyRoomHeader_button",{"mx_LegacyRoomHeader_layoutButton--freedom":t===Cl.f.Tile,"mx_LegacyRoomHeader_layoutButton--spotlight":t===Cl.f.Spotlight}),onClick:l,title:Object(N.b)("Change layout"),alignment:Zr.a.Bottom,key:"layout"}),m)};class Nl extends o.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"client",this.props.room.client),i()(this,"onRightPanelStoreUpdate",(()=>{this.setState({rightPanelOpen:fn.a.instance.isOpen})})),i()(this,"onRoomStateEvents",(e=>{this.props.room&&e.getRoomId()===this.props.room.roomId&&this.rateLimitedUpdate()})),i()(this,"onNotificationUpdate",(()=>{this.forceUpdate()})),i()(this,"rateLimitedUpdate",Object(R.throttle)((()=>{this.forceUpdate()}),500,{leading:!0,trailing:!0})),i()(this,"onContextMenuOpenClick",(e=>{e.preventDefault(),e.stopPropagation();const t=e.target;this.setState({contextMenuPosition:t.getBoundingClientRect()})})),i()(this,"onContextMenuCloseClick",(()=>{this.setState({contextMenuPosition:void 0})})),i()(this,"onHideCallClick",(e=>{e.preventDefault(),b.a.dispatch({action:F.a.ViewRoom,room_id:this.props.room.roomId,view_call:!1,metricsTrigger:void 0})}));Pe.a.instance.getRoomState(e.room).on(hl.b.Update,this.onNotificationUpdate),this.state={rightPanelOpen:fn.a.instance.isOpen}}componentDidMount(){this.client.on(l.RoomStateEvent.Events,this.onRoomStateEvents),fn.a.instance.on(ft.b,this.onRightPanelStoreUpdate)}componentWillUnmount(){this.client.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents);Pe.a.instance.getRoomState(this.props.room).removeListener(hl.b.Update,this.onNotificationUpdate),fn.a.instance.off(ft.b,this.onRightPanelStoreUpdate)}renderButtons(e){const t=[];this.props.viewingCall||!this.props.inRoom||this.context.tombstone||t.push(o.a.createElement(Tl,{key:"calls",room:this.props.room})),this.props.viewingCall&&this.props.activeCall instanceof Cl.d&&t.push(o.a.createElement(Pl,{key:"layout",call:this.props.activeCall})),!this.props.viewingCall&&this.props.onForgetClick&&t.push(o.a.createElement($.a,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_forgetButton",onClick:this.props.onForgetClick,title:Object(N.b)("Forget room"),alignment:Zr.a.Bottom,key:"forget"})),!this.props.viewingCall&&this.props.onAppsClick&&t.push(o.a.createElement($.a,{className:d()("mx_LegacyRoomHeader_button mx_LegacyRoomHeader_appsButton",{mx_LegacyRoomHeader_appsButton_highlight:this.props.appsShown}),onClick:this.props.onAppsClick,title:this.props.appsShown?Object(N.b)("Hide Widgets"):Object(N.b)("Show Widgets"),"aria-checked":this.props.appsShown,alignment:Zr.a.Bottom,key:"apps"})),!this.props.viewingCall&&this.props.onSearchClick&&this.props.inRoom&&t.push(o.a.createElement($.a,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_searchButton",onClick:this.props.onSearchClick,title:Object(N.b)("Search"),alignment:Zr.a.Bottom,key:"search"})),this.props.onInviteClick&&(!this.props.viewingCall||e)&&this.props.inRoom&&t.push(o.a.createElement($.a,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_inviteButton",onClick:this.props.onInviteClick,title:Object(N.b)("Invite"),alignment:Zr.a.Bottom,key:"invite"}));const n=[];return this.props.viewingCall&&!e&&(null===this.props.activeCall?n.push(o.a.createElement(K.a,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_closeButton",onClick:this.onHideCallClick,title:Object(N.b)("Close call"),key:"close"})):n.push(o.a.createElement($.a,{className:"mx_LegacyRoomHeader_button mx_LegacyRoomHeader_minimiseButton",onClick:this.onHideCallClick,title:Object(N.b)("View chat timeline"),alignment:Zr.a.Bottom,key:"minimise"}))),o.a.createElement(o.a.Fragment,null,t,o.a.createElement(il,{room:this.props.room,excludedRightPanelPhaseButtons:this.props.excludedRightPanelPhaseButtons}),n)}renderName(e){let t=null;this.state.contextMenuPosition&&this.props.room&&(t=o.a.createElement(ul,ee()({},Object(ml.a)(this.state.contextMenuPosition),{room:this.props.room,onFinished:this.onContextMenuCloseClick})));let n=!1;const a=this.props.room?this.props.room.getJoinedMembers():void 0;if(a&&1===a.length&&a[0].userId===this.client.credentials.userId){const e=this.props.room.currentState.getStateEvents("m.room.name","");e&&e.getContent().name||(n=!0)}const i=d()("mx_LegacyRoomHeader_nametext",{mx_LegacyRoomHeader_settingsHint:n}),r=o.a.createElement(Za.a,{room:this.props.room},(t=>{const n=t||e;return o.a.createElement("div",{dir:"auto",className:i,title:n,role:"heading","aria-level":1},n)}));return this.props.enableRoomOptionsMenu&&Object(te.a)(oe.a.RoomOptionsMenu)?o.a.createElement(le.c,{className:"mx_LegacyRoomHeader_name",onClick:this.onContextMenuOpenClick,isExpanded:!!this.state.contextMenuPosition,title:Object(N.b)("Room options"),alignment:Zr.a.Bottom},r,this.props.room&&o.a.createElement("div",{className:"mx_LegacyRoomHeader_chevron"}),t):o.a.createElement("div",{className:"mx_LegacyRoomHeader_name mx_LegacyRoomHeader_name--textonly"},r)}render(){var e;const t=v.b.getValue("feature_video_rooms")&&wl(this.props.room);let n=null;this.props.room&&(n=o.a.createElement(Gt.a,{room:this.props.room,avatarSize:24,oobData:this.props.oobData,viewAvatarOnClick:!0}));const a=this.props.viewingCall?o.a.createElement("div",{className:"mx_LegacyRoomHeader_icon mx_LegacyRoomHeader_icon_video"}):this.props.e2eStatus?o.a.createElement(er.b,{className:"mx_LegacyRoomHeader_icon",status:this.props.e2eStatus,tooltipAlignment:Zr.a.Bottom}):this.client.isRoomEncrypted(this.props.room.roomId)&&this.client.isCryptoEnabled()?o.a.createElement("div",{className:"mx_LegacyRoomHeader_icon"}):null,i=this.props.showButtons?this.renderButtons(t):null;let r=Object(N.b)("Join Room");this.props.oobData&&this.props.oobData.name&&(r=this.props.oobData.name);const s=this.renderName(r);if(this.props.viewingCall&&!t)return o.a.createElement("header",{className:"mx_LegacyRoomHeader light-panel"},o.a.createElement("div",{className:"mx_LegacyRoomHeader_wrapper","aria-owns":this.state.rightPanelOpen?"mx_RightPanel":void 0},o.a.createElement("div",{className:"mx_LegacyRoomHeader_avatar"},n),a,s,this.props.activeCall instanceof Cl.d&&o.a.createElement(Ol.b,{groupCall:this.props.activeCall.groupCall}),o.a.createElement("div",{className:"mx_LegacyRoomHeader_topic"}),i));let l=null;"number"==typeof(null===(e=this.props.searchInfo)||void 0===e?void 0:e.count)&&(l=o.a.createElement("div",{className:"mx_LegacyRoomHeader_searchStatus"}," ",Object(N.b)("(~%(count)s results)",{count:this.props.searchInfo.count})));const c=o.a.createElement(Zo,{room:this.props.room,className:"mx_LegacyRoomHeader_topic"}),d=t?o.a.createElement(ce.a,{onClick:()=>b.a.dispatch({action:F.a.ViewUserSettings,initialTabId:Me.a.Labs}),tooltipTitle:Object(N.b)("Video rooms are a beta feature")}):null;return o.a.createElement("header",{className:"mx_LegacyRoomHeader light-panel"},o.a.createElement("div",{className:"mx_LegacyRoomHeader_wrapper","aria-owns":this.state.rightPanelOpen?"mx_RightPanel":void 0},o.a.createElement("div",{className:"mx_LegacyRoomHeader_avatar"},n),a,s,l,c,d,i),!t&&o.a.createElement(kl,{roomId:this.props.room.roomId}),o.a.createElement(El,{roomId:this.props.room.roomId}))}}i()(Nl,"defaultProps",{inRoom:!1,excludedRightPanelPhaseButtons:[],showButtons:!0,enableRoomOptionsMenu:!0}),i()(Nl,"contextType",In.b);var Dl=n(1546);n(1548);const Ml=["as","children","type","weight","size"],Al=["as","children"];function Ll(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Ul(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ll(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ll(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Fl,Bl={};var Vl,Wl={};var zl,Hl;zl=function(){if(Fl)return Bl;Fl=1;var e=o.a;function t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=Object.prototype.hasOwnProperty,a=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,i={},r={};function s(e){return!!n.call(r,e)||!n.call(i,e)&&(a.test(e)?r[e]=!0:(i[e]=!0,!1))}function l(e,t,n,a,i,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=a,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=o}var c={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){c[e]=new l(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];c[t]=new l(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){c[e]=new l(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){c[e]=new l(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){c[e]=new l(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){c[e]=new l(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){c[e]=new l(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){c[e]=new l(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){c[e]=new l(e,5,!1,e.toLowerCase(),null,!1,!1)}));var d=/[\-:]([a-z])/g;function u(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(d,u);c[t]=new l(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(d,u);c[t]=new l(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(d,u);c[t]=new l(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){c[e]=new l(e,1,!1,e.toLowerCase(),null,!1,!1)})),c.xlinkHref=new l("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){c[e]=new l(e,1,!1,e.toLowerCase(),null,!0,!0)}));var m={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},h=["Webkit","ms","Moz","O"];Object.keys(m).forEach((function(e){h.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),m[t]=m[e]}))}));var p=/["'&<>]/;function g(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=p.exec(e);if(t){var n,a="",i=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}i!==n&&(a+=e.substring(i,n)),i=n+1,a+=t}e=i!==n?a+e.substring(i,n):a}return e}var b=/([A-Z])/g,v=/^ms-/,f=Array.isArray;function y(e,t){return{insertionMode:e,selectedValue:t}}var E=new Map;function w(e,a,i){if("object"!=typeof i)throw Error(t(62));for(var r in a=!0,i)if(n.call(i,r)){var o=i[r];if(null!=o&&"boolean"!=typeof o&&""!==o){if(0===r.indexOf("--")){var s=g(r);o=g((""+o).trim())}else{s=r;var l=E.get(s);void 0!==l||(l=g(s.replace(b,"-$1").toLowerCase().replace(v,"-ms-")),E.set(s,l)),s=l,o="number"==typeof o?0===o||n.call(m,r)?""+o:o+"px":g((""+o).trim())}a?(a=!1,e.push(' style="',s,":",o)):e.push(";",s,":",o)}}a||e.push('"')}function S(e,t,n,a){switch(n){case"style":return void w(e,t,a);case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])if(null!==(t=c.hasOwnProperty(n)?c[n]:null)){switch(typeof a){case"function":case"symbol":return;case"boolean":if(!t.acceptsBooleans)return}switch(n=t.attributeName,t.type){case 3:a&&e.push(" ",n,'=""');break;case 4:!0===a?e.push(" ",n,'=""'):!1!==a&&e.push(" ",n,'="',g(a),'"');break;case 5:isNaN(a)||e.push(" ",n,'="',g(a),'"');break;case 6:!isNaN(a)&&1<=a&&e.push(" ",n,'="',g(a),'"');break;default:t.sanitizeURL&&(a=""+a),e.push(" ",n,'="',g(a),'"')}}else if(s(n)){switch(typeof a){case"function":case"symbol":return;case"boolean":if("data-"!==(t=n.toLowerCase().slice(0,5))&&"aria-"!==t)return}e.push(" ",n,'="',g(a),'"')}}function _(e,n,a){if(null!=n){if(null!=a)throw Error(t(60));if("object"!=typeof n||!("__html"in n))throw Error(t(61));null!=(n=n.__html)&&e.push(""+n)}}function C(e,t,a,i){e.push(k(a));var r,o=a=null;for(r in t)if(n.call(t,r)){var s=t[r];if(null!=s)switch(r){case"children":a=s;break;case"dangerouslySetInnerHTML":o=s;break;default:S(e,i,r,s)}}return e.push(">"),_(e,o,a),"string"==typeof a?(e.push(g(a)),null):a}var O=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,x=new Map;function k(e){var n=x.get(e);if(void 0===n){if(!O.test(e))throw Error(t(65,e));n="<"+e,x.set(e,n)}return n}function R(a,i,r,o,l){switch(i){case"select":a.push(k("select"));var c=null,d=null;for(p in r)if(n.call(r,p)){var u=r[p];if(null!=u)switch(p){case"children":c=u;break;case"dangerouslySetInnerHTML":d=u;break;case"defaultValue":case"value":break;default:S(a,o,p,u)}}return a.push(">"),_(a,d,c),c;case"option":d=l.selectedValue,a.push(k("option"));var m=u=null,h=null,p=null;for(c in r)if(n.call(r,c)){var b=r[c];if(null!=b)switch(c){case"children":u=b;break;case"selected":h=b;break;case"dangerouslySetInnerHTML":p=b;break;case"value":m=b;default:S(a,o,c,b)}}if(null!=d)if(r=null!==m?""+m:function(t){var n="";return e.Children.forEach(t,(function(e){null!=e&&(n+=e)})),n}(u),f(d)){for(o=0;o<d.length;o++)if(""+d[o]===r){a.push(' selected=""');break}}else""+d===r&&a.push(' selected=""');else h&&a.push(' selected=""');return a.push(">"),_(a,p,u),u;case"textarea":for(u in a.push(k("textarea")),p=d=c=null,r)if(n.call(r,u)&&null!=(m=r[u]))switch(u){case"children":p=m;break;case"value":c=m;break;case"defaultValue":d=m;break;case"dangerouslySetInnerHTML":throw Error(t(91));default:S(a,o,u,m)}if(null===c&&null!==d&&(c=d),a.push(">"),null!=p){if(null!=c)throw Error(t(92));if(f(p)&&1<p.length)throw Error(t(93));c=""+p}return"string"==typeof c&&"\n"===c[0]&&a.push("\n"),null!==c&&a.push(g(""+c)),null;case"input":for(d in a.push(k("input")),m=p=u=c=null,r)if(n.call(r,d)&&null!=(h=r[d]))switch(d){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,"input"));case"defaultChecked":m=h;break;case"defaultValue":u=h;break;case"checked":p=h;break;case"value":c=h;break;default:S(a,o,d,h)}return null!==p?S(a,o,"checked",p):null!==m&&S(a,o,"checked",m),null!==c?S(a,o,"value",c):null!==u&&S(a,o,"value",u),a.push("/>"),null;case"menuitem":for(var v in a.push(k("menuitem")),r)if(n.call(r,v)&&null!=(c=r[v]))switch(v){case"children":case"dangerouslySetInnerHTML":throw Error(t(400));default:S(a,o,v,c)}return a.push(">"),null;case"title":for(b in a.push(k("title")),c=null,r)if(n.call(r,b)&&null!=(d=r[b]))switch(b){case"children":c=d;break;case"dangerouslySetInnerHTML":throw Error(t(434));default:S(a,o,b,d)}return a.push(">"),c;case"listing":case"pre":for(m in a.push(k(i)),d=c=null,r)if(n.call(r,m)&&null!=(u=r[m]))switch(m){case"children":c=u;break;case"dangerouslySetInnerHTML":d=u;break;default:S(a,o,m,u)}if(a.push(">"),null!=d){if(null!=c)throw Error(t(60));if("object"!=typeof d||!("__html"in d))throw Error(t(61));null!=(r=d.__html)&&("string"==typeof r&&0<r.length&&"\n"===r[0]?a.push("\n",r):a.push(""+r))}return"string"==typeof c&&"\n"===c[0]&&a.push("\n"),c;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":for(var y in a.push(k(i)),r)if(n.call(r,y)&&null!=(c=r[y]))switch(y){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,i));default:S(a,o,y,c)}return a.push("/>"),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return C(a,r,i,o);case"html":return 0===l.insertionMode&&a.push("<!DOCTYPE html>"),C(a,r,i,o);default:if(-1===i.indexOf("-")&&"string"!=typeof r.is)return C(a,r,i,o);for(h in a.push(k(i)),d=c=null,r)if(n.call(r,h)&&null!=(u=r[h]))switch(h){case"children":c=u;break;case"dangerouslySetInnerHTML":d=u;break;case"style":w(a,o,u);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:s(h)&&"function"!=typeof u&&"symbol"!=typeof u&&a.push(" ",h,'="',g(u),'"')}return a.push(">"),_(a,d,c),c}}function j(e,n,a){if(e.push('\x3c!--$?--\x3e<template id="'),null===a)throw Error(t(395));return e.push(a),e.push('"></template>')}var I=/[<\u2028\u2029]/g;function T(e){return JSON.stringify(e).replace(I,(function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}}))}function P(e,t,n,a){return n.generateStaticMarkup?(e.push(g(t)),!1):(""===t?e=a:(a&&e.push("\x3c!-- --\x3e"),e.push(g(t)),e=!0),e)}var N=Object.assign,D=Symbol.for("react.element"),M=Symbol.for("react.portal"),A=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),U=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),B=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),W=Symbol.for("react.suspense"),z=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),G=Symbol.for("react.lazy"),K=Symbol.for("react.scope"),q=Symbol.for("react.debug_trace_mode"),$=Symbol.for("react.legacy_hidden"),Y=Symbol.for("react.default_value"),J=Symbol.iterator;function Q(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case A:return"Fragment";case M:return"Portal";case U:return"Profiler";case L:return"StrictMode";case W:return"Suspense";case z:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case B:return(e.displayName||"Context")+".Consumer";case F:return(e._context.displayName||"Context")+".Provider";case V:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case H:return null!==(t=e.displayName||null)?t:Q(e.type)||"Memo";case G:t=e._payload,e=e._init;try{return Q(e(t))}catch(e){}}return null}var X={};function Z(e,t){if(!(e=e.contextTypes))return X;var n,a={};for(n in e)a[n]=t[n];return a}var ee=null;function te(e,n){if(e!==n){e.context._currentValue2=e.parentValue,e=e.parent;var a=n.parent;if(null===e){if(null!==a)throw Error(t(401))}else{if(null===a)throw Error(t(401));te(e,a)}n.context._currentValue2=n.value}}function ne(e){e.context._currentValue2=e.parentValue,null!==(e=e.parent)&&ne(e)}function ae(e){var t=e.parent;null!==t&&ae(t),e.context._currentValue2=e.value}function ie(e,n){if(e.context._currentValue2=e.parentValue,null===(e=e.parent))throw Error(t(402));e.depth===n.depth?te(e,n):ie(e,n)}function re(e,n){var a=n.parent;if(null===a)throw Error(t(402));e.depth===a.depth?te(e,a):re(e,a),n.context._currentValue2=n.value}function oe(e){var t=ee;t!==e&&(null===t?ae(e):null===e?ne(t):t.depth===e.depth?te(t,e):t.depth>e.depth?ie(t,e):re(t,e),ee=e)}var se={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function le(e,t,n,a){var i=void 0!==e.state?e.state:null;e.updater=se,e.props=n,e.state=i;var r={queue:[],replace:!1};e._reactInternals=r;var o=t.contextType;if(e.context="object"==typeof o&&null!==o?o._currentValue2:a,"function"==typeof(o=t.getDerivedStateFromProps)&&(i=null==(o=o(n,i))?i:N({},i,o),e.state=i),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount))if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&se.enqueueReplaceState(e,e.state,null),null!==r.queue&&0<r.queue.length)if(t=r.queue,o=r.replace,r.queue=null,r.replace=!1,o&&1===t.length)e.state=t[0];else{for(r=o?t[0]:e.state,i=!0,o=o?1:0;o<t.length;o++){var s=t[o];null!=(s="function"==typeof s?s.call(e,r,n,a):s)&&(i?(i=!1,r=N({},r,s)):N(r,s))}e.state=r}else r.queue=null}var ce={id:1,overflow:""};function de(e,t,n){var a=e.id;e=e.overflow;var i=32-ue(a)-1;a&=~(1<<i),n+=1;var r=32-ue(t)+i;if(30<r){var o=i-i%5;return r=(a&(1<<o)-1).toString(32),a>>=o,i-=o,{id:1<<32-ue(t)+i|n<<i|a,overflow:r+e}}return{id:1<<r|n<<i|a,overflow:e}}var ue=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(me(e)/he|0)|0},me=Math.log,he=Math.LN2,pe="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ge=null,be=null,ve=null,fe=null,ye=!1,Ee=!1,we=0,Se=null,_e=0;function Ce(){if(null===ge)throw Error(t(321));return ge}function Oe(){if(0<_e)throw Error(t(312));return{memoizedState:null,queue:null,next:null}}function xe(){return null===fe?null===ve?(ye=!1,ve=fe=Oe()):(ye=!0,fe=ve):null===fe.next?(ye=!1,fe=fe.next=Oe()):(ye=!0,fe=fe.next),fe}function ke(){be=ge=null,Ee=!1,ve=null,_e=0,fe=Se=null}function Re(e,t){return"function"==typeof t?t(e):t}function je(e,t,n){if(ge=Ce(),fe=xe(),ye){var a=fe.queue;if(t=a.dispatch,null!==Se&&void 0!==(n=Se.get(a))){Se.delete(a),a=fe.memoizedState;do{a=e(a,n.action),n=n.next}while(null!==n);return fe.memoizedState=a,[a,t]}return[fe.memoizedState,t]}return e=e===Re?"function"==typeof t?t():t:void 0!==n?n(t):t,fe.memoizedState=e,e=(e=fe.queue={last:null,dispatch:null}).dispatch=Te.bind(null,ge,e),[fe.memoizedState,e]}function Ie(e,t){if(ge=Ce(),t=void 0===t?null:t,null!==(fe=xe())){var n=fe.memoizedState;if(null!==n&&null!==t){var a=n[1];e:if(null===a)a=!1;else{for(var i=0;i<a.length&&i<t.length;i++)if(!pe(t[i],a[i])){a=!1;break e}a=!0}if(a)return n[0]}}return e=e(),fe.memoizedState=[e,t],e}function Te(e,n,a){if(25<=_e)throw Error(t(301));if(e===ge)if(Ee=!0,e={action:a,next:null},null===Se&&(Se=new Map),void 0===(a=Se.get(n)))Se.set(n,e);else{for(n=a;null!==n.next;)n=n.next;n.next=e}}function Pe(){throw Error(t(394))}function Ne(){}var De={readContext:function(e){return e._currentValue2},useContext:function(e){return Ce(),e._currentValue2},useMemo:Ie,useReducer:je,useRef:function(e){ge=Ce();var t=(fe=xe()).memoizedState;return null===t?(e={current:e},fe.memoizedState=e):t},useState:function(e){return je(Re,e)},useInsertionEffect:Ne,useLayoutEffect:function(){},useCallback:function(e,t){return Ie((function(){return e}),t)},useImperativeHandle:Ne,useEffect:Ne,useDebugValue:Ne,useDeferredValue:function(e){return Ce(),e},useTransition:function(){return Ce(),[!1,Pe]},useId:function(){var e=be.treeContext,n=e.overflow;e=((e=e.id)&~(1<<32-ue(e)-1)).toString(32)+n;var a=Me;if(null===a)throw Error(t(404));return n=we++,e=":"+a.idPrefix+"R"+e,0<n&&(e+="H"+n.toString(32)),e+":"},useMutableSource:function(e,t){return Ce(),t(e._source)},useSyncExternalStore:function(e,n,a){if(void 0===a)throw Error(t(407));return a()}},Me=null,Ae=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function Le(e){return console.error(e),null}function Ue(){}function Fe(e,t,n,a,i,r,o,s){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++;var l={node:t,ping:function(){var t=e.pingedTasks;t.push(l),1===t.length&&et(e)},blockedBoundary:n,blockedSegment:a,abortSet:i,legacyContext:r,context:o,treeContext:s};return i.add(l),l}function Be(e,t,n,a,i,r){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],formatContext:a,boundary:n,lastPushedText:i,textEmbedded:r}}function Ve(e,t){if(null!=(e=e.onError(t))&&"string"!=typeof e)throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof e+'" instead');return e}function We(e,t){var n=e.onShellError;n(t),(n=e.onFatalError)(t),null!==e.destination?(e.status=2,e.destination.destroy(t)):(e.status=1,e.fatalError=t)}function ze(e,t,n,a,i){for(ge={},be=t,we=0,e=n(a,i);Ee;)Ee=!1,we=0,_e+=1,fe=null,e=n(a,i);return ke(),e}function He(e,n,a,i){var r=a.render(),o=i.childContextTypes;if(null!=o){var s=n.legacyContext;if("function"!=typeof a.getChildContext)i=s;else{for(var l in a=a.getChildContext())if(!(l in o))throw Error(t(108,Q(i)||"Unknown",l));i=N({},s,a)}n.legacyContext=i,qe(e,n,r),n.legacyContext=s}else qe(e,n,r)}function Ge(e,t){if(e&&e.defaultProps){for(var n in t=N({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function Ke(e,n,a,i,r){if("function"==typeof a)if(a.prototype&&a.prototype.isReactComponent){r=Z(a,n.legacyContext);var o=a.contextType;le(o=new a(i,"object"==typeof o&&null!==o?o._currentValue2:r),a,i,r),He(e,n,o,a)}else{r=ze(e,n,a,i,o=Z(a,n.legacyContext));var s=0!==we;if("object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof)le(r,a,i,o),He(e,n,r,a);else if(s){i=n.treeContext,n.treeContext=de(i,1,0);try{qe(e,n,r)}finally{n.treeContext=i}}else qe(e,n,r)}else{if("string"!=typeof a){switch(a){case $:case q:case L:case U:case A:case z:return void qe(e,n,i.children);case K:throw Error(t(343));case W:e:{a=n.blockedBoundary,r=n.blockedSegment,o=i.fallback,i=i.children;var l={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:s=new Set,errorDigest:null},c=Be(0,r.chunks.length,l,r.formatContext,!1,!1);r.children.push(c),r.lastPushedText=!1;var d=Be(0,0,null,r.formatContext,!1,!1);d.parentFlushed=!0,n.blockedBoundary=l,n.blockedSegment=d;try{if(Ye(e,n,i),e.responseState.generateStaticMarkup||d.lastPushedText&&d.textEmbedded&&d.chunks.push("\x3c!-- --\x3e"),d.status=1,Xe(l,d),0===l.pendingTasks)break e}catch(t){d.status=4,l.forceClientRender=!0,l.errorDigest=Ve(e,t)}finally{n.blockedBoundary=a,n.blockedSegment=r}n=Fe(e,o,a,c,s,n.legacyContext,n.context,n.treeContext),e.pingedTasks.push(n)}return}if("object"==typeof a&&null!==a)switch(a.$$typeof){case V:if(i=ze(e,n,a.render,i,r),0!==we){a=n.treeContext,n.treeContext=de(a,1,0);try{qe(e,n,i)}finally{n.treeContext=a}}else qe(e,n,i);return;case H:return void Ke(e,n,a=a.type,i=Ge(a,i),r);case F:if(r=i.children,a=a._context,i=i.value,o=a._currentValue2,a._currentValue2=i,ee=i={parent:s=ee,depth:null===s?0:s.depth+1,context:a,parentValue:o,value:i},n.context=i,qe(e,n,r),null===(e=ee))throw Error(t(403));return i=e.parentValue,e.context._currentValue2=i===Y?e.context._defaultValue:i,e=ee=e.parent,void(n.context=e);case B:return void qe(e,n,i=(i=i.children)(a._currentValue2));case G:return void Ke(e,n,a=(r=a._init)(a._payload),i=Ge(a,i),void 0)}throw Error(t(130,null==a?a:typeof a,""))}switch(o=R((r=n.blockedSegment).chunks,a,i,e.responseState,r.formatContext),r.lastPushedText=!1,s=r.formatContext,r.formatContext=function(e,t,n){switch(t){case"select":return y(1,null!=n.value?n.value:n.defaultValue);case"svg":return y(2,null);case"math":return y(3,null);case"foreignObject":return y(1,null);case"table":return y(4,null);case"thead":case"tbody":case"tfoot":return y(5,null);case"colgroup":return y(7,null);case"tr":return y(6,null)}return 4<=e.insertionMode||0===e.insertionMode?y(1,null):e}(s,a,i),Ye(e,n,o),r.formatContext=s,a){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:r.chunks.push("</",a,">")}r.lastPushedText=!1}}function qe(e,n,a){if(n.node=a,"object"==typeof a&&null!==a){switch(a.$$typeof){case D:return void Ke(e,n,a.type,a.props,a.ref);case M:throw Error(t(257));case G:var i=a._init;return void qe(e,n,a=i(a._payload))}if(f(a))return void $e(e,n,a);if((i=null===a||"object"!=typeof a?null:"function"==typeof(i=J&&a[J]||a["@@iterator"])?i:null)&&(i=i.call(a))){if(!(a=i.next()).done){var r=[];do{r.push(a.value),a=i.next()}while(!a.done);$e(e,n,r)}return}throw e=Object.prototype.toString.call(a),Error(t(31,"[object Object]"===e?"object with keys {"+Object.keys(a).join(", ")+"}":e))}"string"==typeof a?(i=n.blockedSegment).lastPushedText=P(n.blockedSegment.chunks,a,e.responseState,i.lastPushedText):"number"==typeof a&&((i=n.blockedSegment).lastPushedText=P(n.blockedSegment.chunks,""+a,e.responseState,i.lastPushedText))}function $e(e,t,n){for(var a=n.length,i=0;i<a;i++){var r=t.treeContext;t.treeContext=de(r,a,i);try{Ye(e,t,n[i])}finally{t.treeContext=r}}}function Ye(e,t,n){var a=t.blockedSegment.formatContext,i=t.legacyContext,r=t.context;try{return qe(e,t,n)}catch(l){if(ke(),"object"!=typeof l||null===l||"function"!=typeof l.then)throw t.blockedSegment.formatContext=a,t.legacyContext=i,t.context=r,oe(r),l;n=l;var o=t.blockedSegment,s=Be(0,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(s),o.lastPushedText=!1,e=Fe(e,t.node,t.blockedBoundary,s,t.abortSet,t.legacyContext,t.context,t.treeContext).ping,n.then(e,e),t.blockedSegment.formatContext=a,t.legacyContext=i,t.context=r,oe(r)}}function Je(e){var t=e.blockedBoundary;(e=e.blockedSegment).status=3,Ze(this,t,e)}function Qe(e,n,a){var i=e.blockedBoundary;e.blockedSegment.status=3,null===i?(n.allPendingTasks--,2!==n.status&&(n.status=2,null!==n.destination&&n.destination.push(null))):(i.pendingTasks--,i.forceClientRender||(i.forceClientRender=!0,e=void 0===a?Error(t(432)):a,i.errorDigest=n.onError(e),i.parentFlushed&&n.clientRenderedBoundaries.push(i)),i.fallbackAbortableTasks.forEach((function(e){return Qe(e,n,a)})),i.fallbackAbortableTasks.clear(),n.allPendingTasks--,0===n.allPendingTasks&&(i=n.onAllReady)())}function Xe(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary){var n=t.children[0];n.id=t.id,n.parentFlushed=!0,1===n.status&&Xe(e,n)}else e.completedSegments.push(t)}function Ze(e,n,a){if(null===n){if(a.parentFlushed){if(null!==e.completedRootSegment)throw Error(t(389));e.completedRootSegment=a}e.pendingRootTasks--,0===e.pendingRootTasks&&(e.onShellError=Ue,(n=e.onShellReady)())}else n.pendingTasks--,n.forceClientRender||(0===n.pendingTasks?(a.parentFlushed&&1===a.status&&Xe(n,a),n.parentFlushed&&e.completedBoundaries.push(n),n.fallbackAbortableTasks.forEach(Je,e),n.fallbackAbortableTasks.clear()):a.parentFlushed&&1===a.status&&(Xe(n,a),1===n.completedSegments.length&&n.parentFlushed&&e.partialBoundaries.push(n)));e.allPendingTasks--,0===e.allPendingTasks&&(e=e.onAllReady)()}function et(e){if(2!==e.status){var t=ee,n=Ae.current;Ae.current=De;var a=Me;Me=e.responseState;try{var i,r=e.pingedTasks;for(i=0;i<r.length;i++){var o=r[i],s=e,l=o.blockedSegment;if(0===l.status){oe(o.context);try{qe(s,o,o.node),s.responseState.generateStaticMarkup||l.lastPushedText&&l.textEmbedded&&l.chunks.push("\x3c!-- --\x3e"),o.abortSet.delete(o),l.status=1,Ze(s,o.blockedBoundary,l)}catch(e){if(ke(),"object"==typeof e&&null!==e&&"function"==typeof e.then){var c=o.ping;e.then(c,c)}else{o.abortSet.delete(o),l.status=4;var d=o.blockedBoundary,u=e,m=Ve(s,u);null===d?We(s,u):(d.pendingTasks--,d.forceClientRender||(d.forceClientRender=!0,d.errorDigest=m,d.parentFlushed&&s.clientRenderedBoundaries.push(d))),s.allPendingTasks--,0===s.allPendingTasks&&(0,s.onAllReady)()}}}}r.splice(0,i),null!==e.destination&&ot(e,e.destination)}catch(t){Ve(e,t),We(e,t)}finally{Me=a,Ae.current=n,n===De&&oe(t)}}}function tt(e,n,a){switch(a.parentFlushed=!0,a.status){case 0:var i=a.id=e.nextSegmentId++;return a.lastPushedText=!1,a.textEmbedded=!1,e=e.responseState,n.push('<template id="'),n.push(e.placeholderPrefix),e=i.toString(16),n.push(e),n.push('"></template>');case 1:a.status=2;var r=!0;i=a.chunks;var o=0;a=a.children;for(var s=0;s<a.length;s++){for(r=a[s];o<r.index;o++)n.push(i[o]);r=nt(e,n,r)}for(;o<i.length-1;o++)n.push(i[o]);return o<i.length&&(r=n.push(i[o])),r;default:throw Error(t(390))}}function nt(e,n,a){var i=a.boundary;if(null===i)return tt(e,n,a);if(i.parentFlushed=!0,i.forceClientRender)return e.responseState.generateStaticMarkup||(i=i.errorDigest,n.push("\x3c!--$!--\x3e"),n.push("<template"),i&&(n.push(' data-dgst="'),i=g(i),n.push(i),n.push('"')),n.push("></template>")),tt(e,n,a),!!e.responseState.generateStaticMarkup||n.push("\x3c!--/$--\x3e");if(0<i.pendingTasks){i.rootSegmentID=e.nextSegmentId++,0<i.completedSegments.length&&e.partialBoundaries.push(i);var r=e.responseState,o=r.nextSuspenseID++;return r=r.boundaryPrefix+o.toString(16),i=i.id=r,j(n,e.responseState,i),tt(e,n,a),n.push("\x3c!--/$--\x3e")}if(i.byteSize>e.progressiveChunkSize)return i.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(i),j(n,e.responseState,i.id),tt(e,n,a),n.push("\x3c!--/$--\x3e");if(e.responseState.generateStaticMarkup||n.push("\x3c!--$--\x3e"),1!==(a=i.completedSegments).length)throw Error(t(391));return nt(e,n,a[0]),!!e.responseState.generateStaticMarkup||n.push("\x3c!--/$--\x3e")}function at(e,n,a){return function(e,n,a,i){switch(a.insertionMode){case 0:case 1:return e.push('<div hidden id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');case 2:return e.push('<svg aria-hidden="true" style="display:none" id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');case 3:return e.push('<math aria-hidden="true" style="display:none" id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');case 4:return e.push('<table hidden id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');case 5:return e.push('<table hidden><tbody id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');case 6:return e.push('<table hidden><tr id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');case 7:return e.push('<table hidden><colgroup id="'),e.push(n.segmentPrefix),n=i.toString(16),e.push(n),e.push('">');default:throw Error(t(397))}}(n,e.responseState,a.formatContext,a.id),nt(e,n,a),function(e,n){switch(n.insertionMode){case 0:case 1:return e.push("</div>");case 2:return e.push("</svg>");case 3:return e.push("</math>");case 4:return e.push("</table>");case 5:return e.push("</tbody></table>");case 6:return e.push("</tr></table>");case 7:return e.push("</colgroup></table>");default:throw Error(t(397))}}(n,a.formatContext)}function it(e,n,a){for(var i=a.completedSegments,r=0;r<i.length;r++)rt(e,n,a,i[r]);if(i.length=0,e=e.responseState,i=a.id,a=a.rootSegmentID,n.push(e.startInlineScript),e.sentCompleteBoundaryFunction?n.push('$RC("'):(e.sentCompleteBoundaryFunction=!0,n.push('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("')),null===i)throw Error(t(395));return a=a.toString(16),n.push(i),n.push('","'),n.push(e.segmentPrefix),n.push(a),n.push('")<\/script>')}function rt(e,n,a,i){if(2===i.status)return!0;var r=i.id;if(-1===r){if(-1===(i.id=a.rootSegmentID))throw Error(t(392));return at(e,n,i)}return at(e,n,i),e=e.responseState,n.push(e.startInlineScript),e.sentCompleteSegmentFunction?n.push('$RS("'):(e.sentCompleteSegmentFunction=!0,n.push('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("')),n.push(e.segmentPrefix),r=r.toString(16),n.push(r),n.push('","'),n.push(e.placeholderPrefix),n.push(r),n.push('")<\/script>')}function ot(e,n){try{var a=e.completedRootSegment;if(null!==a&&0===e.pendingRootTasks){nt(e,n,a),e.completedRootSegment=null;var i=e.responseState.bootstrapChunks;for(a=0;a<i.length-1;a++)n.push(i[a]);a<i.length&&n.push(i[a])}var r,o=e.clientRenderedBoundaries;for(r=0;r<o.length;r++){var s=o[r];i=n;var l=e.responseState,c=s.id,d=s.errorDigest,u=s.errorMessage,m=s.errorComponentStack;if(i.push(l.startInlineScript),l.sentClientRenderFunction?i.push('$RX("'):(l.sentClientRenderFunction=!0,i.push('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("')),null===c)throw Error(t(395));if(i.push(c),i.push('"'),d||u||m){i.push(",");var h=T(d||"");i.push(h)}if(u||m){i.push(",");var p=T(u||"");i.push(p)}if(m){i.push(",");var g=T(m);i.push(g)}if(!i.push(")<\/script>"))return e.destination=null,r++,void o.splice(0,r)}o.splice(0,r);var b=e.completedBoundaries;for(r=0;r<b.length;r++)if(!it(e,n,b[r]))return e.destination=null,r++,void b.splice(0,r);b.splice(0,r);var v=e.partialBoundaries;for(r=0;r<v.length;r++){var f=v[r];e:{o=e,s=n;var y=f.completedSegments;for(l=0;l<y.length;l++)if(!rt(o,s,f,y[l])){l++,y.splice(0,l);var E=!1;break e}y.splice(0,l),E=!0}if(!E)return e.destination=null,r++,void v.splice(0,r)}v.splice(0,r);var w=e.completedBoundaries;for(r=0;r<w.length;r++)if(!it(e,n,w[r]))return e.destination=null,r++,void w.splice(0,r);w.splice(0,r)}finally{0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&n.push(null)}}function st(e,t){try{var n=e.abortableTasks;n.forEach((function(n){return Qe(n,e,t)})),n.clear(),null!==e.destination&&ot(e,e.destination)}catch(t){Ve(e,t),We(e,t)}}function lt(){}function ct(e,n,a,i){var r=!1,o=null,s="",l={push:function(e){return null!==e&&(s+=e),!0},destroy:function(e){r=!0,o=e}},c=!1;if(e=function(e,t,n,a,i,r,o,s,l){var c=[],d=new Set;return(n=Be(t={destination:null,responseState:t,progressiveChunkSize:void 0===a?12800:a,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:d,pingedTasks:c,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:void 0===i?Le:i,onAllReady:void 0===r?Ue:r,onShellReady:void 0===o?Ue:o,onShellError:void 0===s?Ue:s,onFatalError:void 0===l?Ue:l},0,null,n,!1,!1)).parentFlushed=!0,e=Fe(t,e,null,n,d,X,null,ce),c.push(e),t}(e,function(e,t){return{bootstrapChunks:[],startInlineScript:"<script>",placeholderPrefix:(t=void 0===t?"":t)+"P:",segmentPrefix:t+"S:",boundaryPrefix:t+"B:",idPrefix:t,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1,generateStaticMarkup:e}}(a,n?n.identifierPrefix:void 0),{insertionMode:1,selectedValue:null},1/0,lt,void 0,(function(){c=!0}),void 0,void 0),et(e),st(e,i),1===e.status)e.status=2,l.destroy(e.fatalError);else if(2!==e.status&&null===e.destination){e.destination=l;try{ot(e,l)}catch(t){Ve(e,t),We(e,t)}}if(r)throw o;if(!c)throw Error(t(426));return s}return Bl.renderToNodeStream=function(){throw Error(t(207))},Bl.renderToStaticMarkup=function(e,t){return ct(e,t,!0,'The server used "renderToStaticMarkup" which does not support Suspense. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},Bl.renderToStaticNodeStream=function(){throw Error(t(208))},Bl.renderToString=function(e,t){return ct(e,t,!1,'The server used "renderToString" which does not support Suspense. If you intended for this Suspense boundary to render the fallback content on the server consider throwing an Error somewhere within the Suspense boundary. If you intended to have the server wait for the suspended component please switch to "renderToReadableStream" which supports Suspense on the server')},Bl.version="18.2.0",Bl}(),Hl=function(){if(Vl)return Wl;Vl=1;var e=o.a;function t(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=null,a=0;function i(e,t){if(0!==t.length)if(512<t.length)0<a&&(e.enqueue(new Uint8Array(n.buffer,0,a)),n=new Uint8Array(512),a=0),e.enqueue(t);else{var i=n.length-a;i<t.length&&(0===i?e.enqueue(n):(n.set(t.subarray(0,i),a),e.enqueue(n),t=t.subarray(i)),n=new Uint8Array(512),a=0),n.set(t,a),a+=t.length}}function r(e,t){return i(e,t),!0}function s(e){n&&0<a&&(e.enqueue(new Uint8Array(n.buffer,0,a)),n=null,a=0)}var l=new TextEncoder;function c(e){return l.encode(e)}function d(e){return l.encode(e)}function u(e,t){"function"==typeof e.error?e.error(t):e.close()}var m=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},g={};function b(e){return!!m.call(g,e)||!m.call(p,e)&&(h.test(e)?g[e]=!0:(p[e]=!0,!1))}function v(e,t,n,a,i,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=a,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=o}var f={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){f[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];f[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){f[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){f[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){f[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){f[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){f[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){f[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){f[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function E(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,E);f[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,E);f[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,E);f[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){f[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),f.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){f[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var w={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},S=["Webkit","ms","Moz","O"];Object.keys(w).forEach((function(e){S.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),w[t]=w[e]}))}));var _=/["'&<>]/;function C(e){if("boolean"==typeof e||"number"==typeof e)return""+e;e=""+e;var t=_.exec(e);if(t){var n,a="",i=0;for(n=t.index;n<e.length;n++){switch(e.charCodeAt(n)){case 34:t="&quot;";break;case 38:t="&amp;";break;case 39:t="&#x27;";break;case 60:t="&lt;";break;case 62:t="&gt;";break;default:continue}i!==n&&(a+=e.substring(i,n)),i=n+1,a+=t}e=i!==n?a+e.substring(i,n):a}return e}var O=/([A-Z])/g,x=/^ms-/,k=Array.isArray,R=d("<script>"),j=d("<\/script>"),I=d('<script src="'),T=d('<script type="module" src="'),P=d('" async=""><\/script>'),N=/(<\/|<)(s)(cript)/gi;function D(e,t,n,a){return t+("s"===n?"\\u0073":"\\u0053")+a}function M(e,t){return{insertionMode:e,selectedValue:t}}var A=d("\x3c!-- --\x3e");function L(e,t,n,a){return""===t?a:(a&&e.push(A),e.push(c(C(t))),!0)}var U=new Map,F=d(' style="'),B=d(":"),V=d(";");function W(e,n,a){if("object"!=typeof a)throw Error(t(62));for(var i in n=!0,a)if(m.call(a,i)){var r=a[i];if(null!=r&&"boolean"!=typeof r&&""!==r){if(0===i.indexOf("--")){var o=c(C(i));r=c(C((""+r).trim()))}else{o=i;var s=U.get(o);void 0!==s||(s=d(C(o.replace(O,"-$1").toLowerCase().replace(x,"-ms-"))),U.set(o,s)),o=s,r="number"==typeof r?0===r||m.call(w,i)?c(""+r):c(r+"px"):c(C((""+r).trim()))}n?(n=!1,e.push(F,o,B,r)):e.push(V,o,B,r)}}n||e.push(G)}var z=d(" "),H=d('="'),G=d('"'),K=d('=""');function q(e,t,n,a){switch(n){case"style":return void W(e,t,a);case"defaultValue":case"defaultChecked":case"innerHTML":case"suppressContentEditableWarning":case"suppressHydrationWarning":return}if(!(2<n.length)||"o"!==n[0]&&"O"!==n[0]||"n"!==n[1]&&"N"!==n[1])if(null!==(t=f.hasOwnProperty(n)?f[n]:null)){switch(typeof a){case"function":case"symbol":return;case"boolean":if(!t.acceptsBooleans)return}switch(n=c(t.attributeName),t.type){case 3:a&&e.push(z,n,K);break;case 4:!0===a?e.push(z,n,K):!1!==a&&e.push(z,n,H,c(C(a)),G);break;case 5:isNaN(a)||e.push(z,n,H,c(C(a)),G);break;case 6:!isNaN(a)&&1<=a&&e.push(z,n,H,c(C(a)),G);break;default:t.sanitizeURL&&(a=""+a),e.push(z,n,H,c(C(a)),G)}}else if(b(n)){switch(typeof a){case"function":case"symbol":return;case"boolean":if("data-"!==(t=n.toLowerCase().slice(0,5))&&"aria-"!==t)return}e.push(z,c(n),H,c(C(a)),G)}}var $=d(">"),Y=d("/>");function J(e,n,a){if(null!=n){if(null!=a)throw Error(t(60));if("object"!=typeof n||!("__html"in n))throw Error(t(61));null!=(n=n.__html)&&e.push(c(""+n))}}var Q=d(' selected=""');function X(e,t,n,a){e.push(ne(n));var i,r=n=null;for(i in t)if(m.call(t,i)){var o=t[i];if(null!=o)switch(i){case"children":n=o;break;case"dangerouslySetInnerHTML":r=o;break;default:q(e,a,i,o)}}return e.push($),J(e,r,n),"string"==typeof n?(e.push(c(C(n))),null):n}var Z=d("\n"),ee=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,te=new Map;function ne(e){var n=te.get(e);if(void 0===n){if(!ee.test(e))throw Error(t(65,e));n=d("<"+e),te.set(e,n)}return n}var ae=d("<!DOCTYPE html>");function ie(n,a,i,r,o){switch(a){case"select":n.push(ne("select"));var s=null,l=null;for(p in i)if(m.call(i,p)){var d=i[p];if(null!=d)switch(p){case"children":s=d;break;case"dangerouslySetInnerHTML":l=d;break;case"defaultValue":case"value":break;default:q(n,r,p,d)}}return n.push($),J(n,l,s),s;case"option":l=o.selectedValue,n.push(ne("option"));var u=d=null,h=null,p=null;for(s in i)if(m.call(i,s)){var g=i[s];if(null!=g)switch(s){case"children":d=g;break;case"selected":h=g;break;case"dangerouslySetInnerHTML":p=g;break;case"value":u=g;default:q(n,r,s,g)}}if(null!=l)if(i=null!==u?""+u:function(t){var n="";return e.Children.forEach(t,(function(e){null!=e&&(n+=e)})),n}(d),k(l)){for(r=0;r<l.length;r++)if(""+l[r]===i){n.push(Q);break}}else""+l===i&&n.push(Q);else h&&n.push(Q);return n.push($),J(n,p,d),d;case"textarea":for(d in n.push(ne("textarea")),p=l=s=null,i)if(m.call(i,d)&&null!=(u=i[d]))switch(d){case"children":p=u;break;case"value":s=u;break;case"defaultValue":l=u;break;case"dangerouslySetInnerHTML":throw Error(t(91));default:q(n,r,d,u)}if(null===s&&null!==l&&(s=l),n.push($),null!=p){if(null!=s)throw Error(t(92));if(k(p)&&1<p.length)throw Error(t(93));s=""+p}return"string"==typeof s&&"\n"===s[0]&&n.push(Z),null!==s&&n.push(c(C(""+s))),null;case"input":for(l in n.push(ne("input")),u=p=d=s=null,i)if(m.call(i,l)&&null!=(h=i[l]))switch(l){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,"input"));case"defaultChecked":u=h;break;case"defaultValue":d=h;break;case"checked":p=h;break;case"value":s=h;break;default:q(n,r,l,h)}return null!==p?q(n,r,"checked",p):null!==u&&q(n,r,"checked",u),null!==s?q(n,r,"value",s):null!==d&&q(n,r,"value",d),n.push(Y),null;case"menuitem":for(var v in n.push(ne("menuitem")),i)if(m.call(i,v)&&null!=(s=i[v]))switch(v){case"children":case"dangerouslySetInnerHTML":throw Error(t(400));default:q(n,r,v,s)}return n.push($),null;case"title":for(g in n.push(ne("title")),s=null,i)if(m.call(i,g)&&null!=(l=i[g]))switch(g){case"children":s=l;break;case"dangerouslySetInnerHTML":throw Error(t(434));default:q(n,r,g,l)}return n.push($),s;case"listing":case"pre":for(u in n.push(ne(a)),l=s=null,i)if(m.call(i,u)&&null!=(d=i[u]))switch(u){case"children":s=d;break;case"dangerouslySetInnerHTML":l=d;break;default:q(n,r,u,d)}if(n.push($),null!=l){if(null!=s)throw Error(t(60));if("object"!=typeof l||!("__html"in l))throw Error(t(61));null!=(i=l.__html)&&("string"==typeof i&&0<i.length&&"\n"===i[0]?n.push(Z,c(i)):n.push(c(""+i)))}return"string"==typeof s&&"\n"===s[0]&&n.push(Z),s;case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":for(var f in n.push(ne(a)),i)if(m.call(i,f)&&null!=(s=i[f]))switch(f){case"children":case"dangerouslySetInnerHTML":throw Error(t(399,a));default:q(n,r,f,s)}return n.push(Y),null;case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return X(n,i,a,r);case"html":return 0===o.insertionMode&&n.push(ae),X(n,i,a,r);default:if(-1===a.indexOf("-")&&"string"!=typeof i.is)return X(n,i,a,r);for(h in n.push(ne(a)),l=s=null,i)if(m.call(i,h)&&null!=(d=i[h]))switch(h){case"children":s=d;break;case"dangerouslySetInnerHTML":l=d;break;case"style":W(n,r,d);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":break;default:b(h)&&"function"!=typeof d&&"symbol"!=typeof d&&n.push(z,c(h),H,c(C(d)),G)}return n.push($),J(n,l,s),s}}var re=d("</"),oe=d(">"),se=d('<template id="'),le=d('"></template>'),ce=d("\x3c!--$--\x3e"),de=d('\x3c!--$?--\x3e<template id="'),ue=d('"></template>'),me=d("\x3c!--$!--\x3e"),he=d("\x3c!--/$--\x3e"),pe=d("<template"),ge=d('"'),be=d(' data-dgst="');d(' data-msg="'),d(' data-stck="');var ve=d("></template>");function fe(e,n,a){if(i(e,de),null===a)throw Error(t(395));return i(e,a),r(e,ue)}var ye=d('<div hidden id="'),Ee=d('">'),we=d("</div>"),Se=d('<svg aria-hidden="true" style="display:none" id="'),_e=d('">'),Ce=d("</svg>"),Oe=d('<math aria-hidden="true" style="display:none" id="'),xe=d('">'),ke=d("</math>"),Re=d('<table hidden id="'),je=d('">'),Ie=d("</table>"),Te=d('<table hidden><tbody id="'),Pe=d('">'),Ne=d("</tbody></table>"),De=d('<table hidden><tr id="'),Me=d('">'),Ae=d("</tr></table>"),Le=d('<table hidden><colgroup id="'),Ue=d('">'),Fe=d("</colgroup></table>"),Be=d('function $RS(a,b){a=document.getElementById(a);b=document.getElementById(b);for(a.parentNode.removeChild(a);a.firstChild;)b.parentNode.insertBefore(a.firstChild,b);b.parentNode.removeChild(b)};$RS("'),Ve=d('$RS("'),We=d('","'),ze=d('")<\/script>'),He=d('function $RC(a,b){a=document.getElementById(a);b=document.getElementById(b);b.parentNode.removeChild(b);if(a){a=a.previousSibling;var f=a.parentNode,c=a.nextSibling,e=0;do{if(c&&8===c.nodeType){var d=c.data;if("/$"===d)if(0===e)break;else e--;else"$"!==d&&"$?"!==d&&"$!"!==d||e++}d=c.nextSibling;f.removeChild(c);c=d}while(c);for(;b.firstChild;)f.insertBefore(b.firstChild,c);a.data="$";a._reactRetry&&a._reactRetry()}};$RC("'),Ge=d('$RC("'),Ke=d('","'),qe=d('")<\/script>'),$e=d('function $RX(b,c,d,e){var a=document.getElementById(b);a&&(b=a.previousSibling,b.data="$!",a=a.dataset,c&&(a.dgst=c),d&&(a.msg=d),e&&(a.stck=e),b._reactRetry&&b._reactRetry())};$RX("'),Ye=d('$RX("'),Je=d('"'),Qe=d(")<\/script>"),Xe=d(","),Ze=/[<\u2028\u2029]/g;function et(e){return JSON.stringify(e).replace(Ze,(function(e){switch(e){case"<":return"\\u003c";case"\u2028":return"\\u2028";case"\u2029":return"\\u2029";default:throw Error("escapeJSStringsForInstructionScripts encountered a match it does not know how to replace. this means the match regex and the replacement characters are no longer in sync. This is a bug in React")}}))}var tt=Object.assign,nt=Symbol.for("react.element"),at=Symbol.for("react.portal"),it=Symbol.for("react.fragment"),rt=Symbol.for("react.strict_mode"),ot=Symbol.for("react.profiler"),st=Symbol.for("react.provider"),lt=Symbol.for("react.context"),ct=Symbol.for("react.forward_ref"),dt=Symbol.for("react.suspense"),ut=Symbol.for("react.suspense_list"),mt=Symbol.for("react.memo"),ht=Symbol.for("react.lazy"),pt=Symbol.for("react.scope"),gt=Symbol.for("react.debug_trace_mode"),bt=Symbol.for("react.legacy_hidden"),vt=Symbol.for("react.default_value"),ft=Symbol.iterator;function yt(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case it:return"Fragment";case at:return"Portal";case ot:return"Profiler";case rt:return"StrictMode";case dt:return"Suspense";case ut:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case lt:return(e.displayName||"Context")+".Consumer";case st:return(e._context.displayName||"Context")+".Provider";case ct:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case mt:return null!==(t=e.displayName||null)?t:yt(e.type)||"Memo";case ht:t=e._payload,e=e._init;try{return yt(e(t))}catch(e){}}return null}var Et={};function wt(e,t){if(!(e=e.contextTypes))return Et;var n,a={};for(n in e)a[n]=t[n];return a}var St=null;function _t(e,n){if(e!==n){e.context._currentValue=e.parentValue,e=e.parent;var a=n.parent;if(null===e){if(null!==a)throw Error(t(401))}else{if(null===a)throw Error(t(401));_t(e,a)}n.context._currentValue=n.value}}function Ct(e){e.context._currentValue=e.parentValue,null!==(e=e.parent)&&Ct(e)}function Ot(e){var t=e.parent;null!==t&&Ot(t),e.context._currentValue=e.value}function xt(e,n){if(e.context._currentValue=e.parentValue,null===(e=e.parent))throw Error(t(402));e.depth===n.depth?_t(e,n):xt(e,n)}function kt(e,n){var a=n.parent;if(null===a)throw Error(t(402));e.depth===a.depth?_t(e,a):kt(e,a),n.context._currentValue=n.value}function Rt(e){var t=St;t!==e&&(null===t?Ot(e):null===e?Ct(t):t.depth===e.depth?_t(t,e):t.depth>e.depth?xt(t,e):kt(t,e),St=e)}var jt={isMounted:function(){return!1},enqueueSetState:function(e,t){null!==(e=e._reactInternals).queue&&e.queue.push(t)},enqueueReplaceState:function(e,t){(e=e._reactInternals).replace=!0,e.queue=[t]},enqueueForceUpdate:function(){}};function It(e,t,n,a){var i=void 0!==e.state?e.state:null;e.updater=jt,e.props=n,e.state=i;var r={queue:[],replace:!1};e._reactInternals=r;var o=t.contextType;if(e.context="object"==typeof o&&null!==o?o._currentValue:a,"function"==typeof(o=t.getDerivedStateFromProps)&&(i=null==(o=o(n,i))?i:tt({},i,o),e.state=i),"function"!=typeof t.getDerivedStateFromProps&&"function"!=typeof e.getSnapshotBeforeUpdate&&("function"==typeof e.UNSAFE_componentWillMount||"function"==typeof e.componentWillMount))if(t=e.state,"function"==typeof e.componentWillMount&&e.componentWillMount(),"function"==typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),t!==e.state&&jt.enqueueReplaceState(e,e.state,null),null!==r.queue&&0<r.queue.length)if(t=r.queue,o=r.replace,r.queue=null,r.replace=!1,o&&1===t.length)e.state=t[0];else{for(r=o?t[0]:e.state,i=!0,o=o?1:0;o<t.length;o++){var s=t[o];null!=(s="function"==typeof s?s.call(e,r,n,a):s)&&(i?(i=!1,r=tt({},r,s)):tt(r,s))}e.state=r}else r.queue=null}var Tt={id:1,overflow:""};function Pt(e,t,n){var a=e.id;e=e.overflow;var i=32-Nt(a)-1;a&=~(1<<i),n+=1;var r=32-Nt(t)+i;if(30<r){var o=i-i%5;return r=(a&(1<<o)-1).toString(32),a>>=o,i-=o,{id:1<<32-Nt(t)+i|n<<i|a,overflow:r+e}}return{id:1<<r|n<<i|a,overflow:e}}var Nt=Math.clz32?Math.clz32:function(e){return 0==(e>>>=0)?32:31-(Dt(e)/Mt|0)|0},Dt=Math.log,Mt=Math.LN2,At="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},Lt=null,Ut=null,Ft=null,Bt=null,Vt=!1,Wt=!1,zt=0,Ht=null,Gt=0;function Kt(){if(null===Lt)throw Error(t(321));return Lt}function qt(){if(0<Gt)throw Error(t(312));return{memoizedState:null,queue:null,next:null}}function $t(){return null===Bt?null===Ft?(Vt=!1,Ft=Bt=qt()):(Vt=!0,Bt=Ft):null===Bt.next?(Vt=!1,Bt=Bt.next=qt()):(Vt=!0,Bt=Bt.next),Bt}function Yt(){Ut=Lt=null,Wt=!1,Ft=null,Gt=0,Bt=Ht=null}function Jt(e,t){return"function"==typeof t?t(e):t}function Qt(e,t,n){if(Lt=Kt(),Bt=$t(),Vt){var a=Bt.queue;if(t=a.dispatch,null!==Ht&&void 0!==(n=Ht.get(a))){Ht.delete(a),a=Bt.memoizedState;do{a=e(a,n.action),n=n.next}while(null!==n);return Bt.memoizedState=a,[a,t]}return[Bt.memoizedState,t]}return e=e===Jt?"function"==typeof t?t():t:void 0!==n?n(t):t,Bt.memoizedState=e,e=(e=Bt.queue={last:null,dispatch:null}).dispatch=Zt.bind(null,Lt,e),[Bt.memoizedState,e]}function Xt(e,t){if(Lt=Kt(),t=void 0===t?null:t,null!==(Bt=$t())){var n=Bt.memoizedState;if(null!==n&&null!==t){var a=n[1];e:if(null===a)a=!1;else{for(var i=0;i<a.length&&i<t.length;i++)if(!At(t[i],a[i])){a=!1;break e}a=!0}if(a)return n[0]}}return e=e(),Bt.memoizedState=[e,t],e}function Zt(e,n,a){if(25<=Gt)throw Error(t(301));if(e===Lt)if(Wt=!0,e={action:a,next:null},null===Ht&&(Ht=new Map),void 0===(a=Ht.get(n)))Ht.set(n,e);else{for(n=a;null!==n.next;)n=n.next;n.next=e}}function en(){throw Error(t(394))}function tn(){}var nn={readContext:function(e){return e._currentValue},useContext:function(e){return Kt(),e._currentValue},useMemo:Xt,useReducer:Qt,useRef:function(e){Lt=Kt();var t=(Bt=$t()).memoizedState;return null===t?(e={current:e},Bt.memoizedState=e):t},useState:function(e){return Qt(Jt,e)},useInsertionEffect:tn,useLayoutEffect:function(){},useCallback:function(e,t){return Xt((function(){return e}),t)},useImperativeHandle:tn,useEffect:tn,useDebugValue:tn,useDeferredValue:function(e){return Kt(),e},useTransition:function(){return Kt(),[!1,en]},useId:function(){var e=Ut.treeContext,n=e.overflow;e=((e=e.id)&~(1<<32-Nt(e)-1)).toString(32)+n;var a=an;if(null===a)throw Error(t(404));return n=zt++,e=":"+a.idPrefix+"R"+e,0<n&&(e+="H"+n.toString(32)),e+":"},useMutableSource:function(e,t){return Kt(),t(e._source)},useSyncExternalStore:function(e,n,a){if(void 0===a)throw Error(t(407));return a()}},an=null,rn=e.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function on(e){return console.error(e),null}function sn(){}function ln(e,t,n,a,i,r,o,s){e.allPendingTasks++,null===n?e.pendingRootTasks++:n.pendingTasks++;var l={node:t,ping:function(){var t=e.pingedTasks;t.push(l),1===t.length&&_n(e)},blockedBoundary:n,blockedSegment:a,abortSet:i,legacyContext:r,context:o,treeContext:s};return i.add(l),l}function cn(e,t,n,a,i,r){return{status:0,id:-1,index:t,parentFlushed:!1,chunks:[],children:[],formatContext:a,boundary:n,lastPushedText:i,textEmbedded:r}}function dn(e,t){if(null!=(e=e.onError(t))&&"string"!=typeof e)throw Error('onError returned something with a type other than "string". onError should return a string and may return null or undefined but must not return anything else. It received something of type "'+typeof e+'" instead');return e}function un(e,t){var n=e.onShellError;n(t),(n=e.onFatalError)(t),null!==e.destination?(e.status=2,u(e.destination,t)):(e.status=1,e.fatalError=t)}function mn(e,t,n,a,i){for(Lt={},Ut=t,zt=0,e=n(a,i);Wt;)Wt=!1,zt=0,Gt+=1,Bt=null,e=n(a,i);return Yt(),e}function hn(e,n,a,i){var r=a.render(),o=i.childContextTypes;if(null!=o){var s=n.legacyContext;if("function"!=typeof a.getChildContext)i=s;else{for(var l in a=a.getChildContext())if(!(l in o))throw Error(t(108,yt(i)||"Unknown",l));i=tt({},s,a)}n.legacyContext=i,bn(e,n,r),n.legacyContext=s}else bn(e,n,r)}function pn(e,t){if(e&&e.defaultProps){for(var n in t=tt({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}function gn(e,n,a,i,r){if("function"==typeof a)if(a.prototype&&a.prototype.isReactComponent){r=wt(a,n.legacyContext);var o=a.contextType;It(o=new a(i,"object"==typeof o&&null!==o?o._currentValue:r),a,i,r),hn(e,n,o,a)}else{r=mn(e,n,a,i,o=wt(a,n.legacyContext));var s=0!==zt;if("object"==typeof r&&null!==r&&"function"==typeof r.render&&void 0===r.$$typeof)It(r,a,i,o),hn(e,n,r,a);else if(s){i=n.treeContext,n.treeContext=Pt(i,1,0);try{bn(e,n,r)}finally{n.treeContext=i}}else bn(e,n,r)}else{if("string"!=typeof a){switch(a){case bt:case gt:case rt:case ot:case it:case ut:return void bn(e,n,i.children);case pt:throw Error(t(343));case dt:e:{a=n.blockedBoundary,r=n.blockedSegment,o=i.fallback,i=i.children;var l={id:null,rootSegmentID:-1,parentFlushed:!1,pendingTasks:0,forceClientRender:!1,completedSegments:[],byteSize:0,fallbackAbortableTasks:s=new Set,errorDigest:null},d=cn(0,r.chunks.length,l,r.formatContext,!1,!1);r.children.push(d),r.lastPushedText=!1;var u=cn(0,0,null,r.formatContext,!1,!1);u.parentFlushed=!0,n.blockedBoundary=l,n.blockedSegment=u;try{if(fn(e,n,i),u.lastPushedText&&u.textEmbedded&&u.chunks.push(A),u.status=1,wn(l,u),0===l.pendingTasks)break e}catch(t){u.status=4,l.forceClientRender=!0,l.errorDigest=dn(e,t)}finally{n.blockedBoundary=a,n.blockedSegment=r}n=ln(e,o,a,d,s,n.legacyContext,n.context,n.treeContext),e.pingedTasks.push(n)}return}if("object"==typeof a&&null!==a)switch(a.$$typeof){case ct:if(i=mn(e,n,a.render,i,r),0!==zt){a=n.treeContext,n.treeContext=Pt(a,1,0);try{bn(e,n,i)}finally{n.treeContext=a}}else bn(e,n,i);return;case mt:return void gn(e,n,a=a.type,i=pn(a,i),r);case st:if(r=i.children,a=a._context,i=i.value,o=a._currentValue,a._currentValue=i,St=i={parent:s=St,depth:null===s?0:s.depth+1,context:a,parentValue:o,value:i},n.context=i,bn(e,n,r),null===(e=St))throw Error(t(403));return i=e.parentValue,e.context._currentValue=i===vt?e.context._defaultValue:i,e=St=e.parent,void(n.context=e);case lt:return void bn(e,n,i=(i=i.children)(a._currentValue));case ht:return void gn(e,n,a=(r=a._init)(a._payload),i=pn(a,i),void 0)}throw Error(t(130,null==a?a:typeof a,""))}switch(o=ie((r=n.blockedSegment).chunks,a,i,e.responseState,r.formatContext),r.lastPushedText=!1,s=r.formatContext,r.formatContext=function(e,t,n){switch(t){case"select":return M(1,null!=n.value?n.value:n.defaultValue);case"svg":return M(2,null);case"math":return M(3,null);case"foreignObject":return M(1,null);case"table":return M(4,null);case"thead":case"tbody":case"tfoot":return M(5,null);case"colgroup":return M(7,null);case"tr":return M(6,null)}return 4<=e.insertionMode||0===e.insertionMode?M(1,null):e}(s,a,i),fn(e,n,o),r.formatContext=s,a){case"area":case"base":case"br":case"col":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":break;default:r.chunks.push(re,c(a),oe)}r.lastPushedText=!1}}function bn(e,n,a){if(n.node=a,"object"==typeof a&&null!==a){switch(a.$$typeof){case nt:return void gn(e,n,a.type,a.props,a.ref);case at:throw Error(t(257));case ht:var i=a._init;return void bn(e,n,a=i(a._payload))}if(k(a))return void vn(e,n,a);if((i=null===a||"object"!=typeof a?null:"function"==typeof(i=ft&&a[ft]||a["@@iterator"])?i:null)&&(i=i.call(a))){if(!(a=i.next()).done){var r=[];do{r.push(a.value),a=i.next()}while(!a.done);vn(e,n,r)}return}throw e=Object.prototype.toString.call(a),Error(t(31,"[object Object]"===e?"object with keys {"+Object.keys(a).join(", ")+"}":e))}"string"==typeof a?(i=n.blockedSegment).lastPushedText=L(n.blockedSegment.chunks,a,e.responseState,i.lastPushedText):"number"==typeof a&&((i=n.blockedSegment).lastPushedText=L(n.blockedSegment.chunks,""+a,e.responseState,i.lastPushedText))}function vn(e,t,n){for(var a=n.length,i=0;i<a;i++){var r=t.treeContext;t.treeContext=Pt(r,a,i);try{fn(e,t,n[i])}finally{t.treeContext=r}}}function fn(e,t,n){var a=t.blockedSegment.formatContext,i=t.legacyContext,r=t.context;try{return bn(e,t,n)}catch(l){if(Yt(),"object"!=typeof l||null===l||"function"!=typeof l.then)throw t.blockedSegment.formatContext=a,t.legacyContext=i,t.context=r,Rt(r),l;n=l;var o=t.blockedSegment,s=cn(0,o.chunks.length,null,o.formatContext,o.lastPushedText,!0);o.children.push(s),o.lastPushedText=!1,e=ln(e,t.node,t.blockedBoundary,s,t.abortSet,t.legacyContext,t.context,t.treeContext).ping,n.then(e,e),t.blockedSegment.formatContext=a,t.legacyContext=i,t.context=r,Rt(r)}}function yn(e){var t=e.blockedBoundary;(e=e.blockedSegment).status=3,Sn(this,t,e)}function En(e,n,a){var i=e.blockedBoundary;e.blockedSegment.status=3,null===i?(n.allPendingTasks--,2!==n.status&&(n.status=2,null!==n.destination&&n.destination.close())):(i.pendingTasks--,i.forceClientRender||(i.forceClientRender=!0,e=void 0===a?Error(t(432)):a,i.errorDigest=n.onError(e),i.parentFlushed&&n.clientRenderedBoundaries.push(i)),i.fallbackAbortableTasks.forEach((function(e){return En(e,n,a)})),i.fallbackAbortableTasks.clear(),n.allPendingTasks--,0===n.allPendingTasks&&(i=n.onAllReady)())}function wn(e,t){if(0===t.chunks.length&&1===t.children.length&&null===t.children[0].boundary){var n=t.children[0];n.id=t.id,n.parentFlushed=!0,1===n.status&&wn(e,n)}else e.completedSegments.push(t)}function Sn(e,n,a){if(null===n){if(a.parentFlushed){if(null!==e.completedRootSegment)throw Error(t(389));e.completedRootSegment=a}e.pendingRootTasks--,0===e.pendingRootTasks&&(e.onShellError=sn,(n=e.onShellReady)())}else n.pendingTasks--,n.forceClientRender||(0===n.pendingTasks?(a.parentFlushed&&1===a.status&&wn(n,a),n.parentFlushed&&e.completedBoundaries.push(n),n.fallbackAbortableTasks.forEach(yn,e),n.fallbackAbortableTasks.clear()):a.parentFlushed&&1===a.status&&(wn(n,a),1===n.completedSegments.length&&n.parentFlushed&&e.partialBoundaries.push(n)));e.allPendingTasks--,0===e.allPendingTasks&&(e=e.onAllReady)()}function _n(e){if(2!==e.status){var t=St,n=rn.current;rn.current=nn;var a=an;an=e.responseState;try{var i,r=e.pingedTasks;for(i=0;i<r.length;i++){var o=r[i],s=e,l=o.blockedSegment;if(0===l.status){Rt(o.context);try{bn(s,o,o.node),l.lastPushedText&&l.textEmbedded&&l.chunks.push(A),o.abortSet.delete(o),l.status=1,Sn(s,o.blockedBoundary,l)}catch(e){if(Yt(),"object"==typeof e&&null!==e&&"function"==typeof e.then){var c=o.ping;e.then(c,c)}else{o.abortSet.delete(o),l.status=4;var d=o.blockedBoundary,u=e,m=dn(s,u);null===d?un(s,u):(d.pendingTasks--,d.forceClientRender||(d.forceClientRender=!0,d.errorDigest=m,d.parentFlushed&&s.clientRenderedBoundaries.push(d))),s.allPendingTasks--,0===s.allPendingTasks&&(0,s.onAllReady)()}}}}r.splice(0,i),null!==e.destination&&jn(e,e.destination)}catch(t){dn(e,t),un(e,t)}finally{an=a,rn.current=n,n===nn&&Rt(t)}}}function Cn(e,n,a){switch(a.parentFlushed=!0,a.status){case 0:var o=a.id=e.nextSegmentId++;return a.lastPushedText=!1,a.textEmbedded=!1,e=e.responseState,i(n,se),i(n,e.placeholderPrefix),i(n,e=c(o.toString(16))),r(n,le);case 1:a.status=2;var s=!0;o=a.chunks;var l=0;a=a.children;for(var d=0;d<a.length;d++){for(s=a[d];l<s.index;l++)i(n,o[l]);s=On(e,n,s)}for(;l<o.length-1;l++)i(n,o[l]);return l<o.length&&(s=r(n,o[l])),s;default:throw Error(t(390))}}function On(e,n,a){var o=a.boundary;if(null===o)return Cn(e,n,a);if(o.parentFlushed=!0,o.forceClientRender)o=o.errorDigest,r(n,me),i(n,pe),o&&(i(n,be),i(n,c(C(o))),i(n,ge)),r(n,ve),Cn(e,n,a);else if(0<o.pendingTasks){o.rootSegmentID=e.nextSegmentId++,0<o.completedSegments.length&&e.partialBoundaries.push(o);var s=e.responseState,l=s.nextSuspenseID++;s=d(s.boundaryPrefix+l.toString(16)),o=o.id=s,fe(n,e.responseState,o),Cn(e,n,a)}else if(o.byteSize>e.progressiveChunkSize)o.rootSegmentID=e.nextSegmentId++,e.completedBoundaries.push(o),fe(n,e.responseState,o.id),Cn(e,n,a);else{if(r(n,ce),1!==(a=o.completedSegments).length)throw Error(t(391));On(e,n,a[0])}return r(n,he)}function xn(e,n,a){return function(e,n,a,o){switch(a.insertionMode){case 0:case 1:return i(e,ye),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,Ee);case 2:return i(e,Se),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,_e);case 3:return i(e,Oe),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,xe);case 4:return i(e,Re),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,je);case 5:return i(e,Te),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,Pe);case 6:return i(e,De),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,Me);case 7:return i(e,Le),i(e,n.segmentPrefix),i(e,c(o.toString(16))),r(e,Ue);default:throw Error(t(397))}}(n,e.responseState,a.formatContext,a.id),On(e,n,a),function(e,n){switch(n.insertionMode){case 0:case 1:return r(e,we);case 2:return r(e,Ce);case 3:return r(e,ke);case 4:return r(e,Ie);case 5:return r(e,Ne);case 6:return r(e,Ae);case 7:return r(e,Fe);default:throw Error(t(397))}}(n,a.formatContext)}function kn(e,n,a){for(var o=a.completedSegments,s=0;s<o.length;s++)Rn(e,n,a,o[s]);if(o.length=0,e=e.responseState,o=a.id,a=a.rootSegmentID,i(n,e.startInlineScript),e.sentCompleteBoundaryFunction?i(n,Ge):(e.sentCompleteBoundaryFunction=!0,i(n,He)),null===o)throw Error(t(395));return a=c(a.toString(16)),i(n,o),i(n,Ke),i(n,e.segmentPrefix),i(n,a),r(n,qe)}function Rn(e,n,a,o){if(2===o.status)return!0;var s=o.id;if(-1===s){if(-1===(o.id=a.rootSegmentID))throw Error(t(392));return xn(e,n,o)}return xn(e,n,o),i(n,(e=e.responseState).startInlineScript),e.sentCompleteSegmentFunction?i(n,Ve):(e.sentCompleteSegmentFunction=!0,i(n,Be)),i(n,e.segmentPrefix),i(n,s=c(s.toString(16))),i(n,We),i(n,e.placeholderPrefix),i(n,s),r(n,ze)}function jn(e,o){n=new Uint8Array(512),a=0;try{var l=e.completedRootSegment;if(null!==l&&0===e.pendingRootTasks){On(e,o,l),e.completedRootSegment=null;var d=e.responseState.bootstrapChunks;for(l=0;l<d.length-1;l++)i(o,d[l]);l<d.length&&r(o,d[l])}var u,m=e.clientRenderedBoundaries;for(u=0;u<m.length;u++){var h=m[u];d=o;var p=e.responseState,g=h.id,b=h.errorDigest,v=h.errorMessage,f=h.errorComponentStack;if(i(d,p.startInlineScript),p.sentClientRenderFunction?i(d,Ye):(p.sentClientRenderFunction=!0,i(d,$e)),null===g)throw Error(t(395));i(d,g),i(d,Je),(b||v||f)&&(i(d,Xe),i(d,c(et(b||"")))),(v||f)&&(i(d,Xe),i(d,c(et(v||"")))),f&&(i(d,Xe),i(d,c(et(f)))),r(d,Qe)}m.splice(0,u);var y=e.completedBoundaries;for(u=0;u<y.length;u++)kn(e,o,y[u]);y.splice(0,u),s(o),n=new Uint8Array(512),a=0;var E=e.partialBoundaries;for(u=0;u<E.length;u++){var w=E[u];e:{m=e,h=o;var S=w.completedSegments;for(p=0;p<S.length;p++)if(!Rn(m,h,w,S[p])){p++,S.splice(0,p);var _=!1;break e}S.splice(0,p),_=!0}if(!_)return e.destination=null,u++,void E.splice(0,u)}E.splice(0,u);var C=e.completedBoundaries;for(u=0;u<C.length;u++)kn(e,o,C[u]);C.splice(0,u)}finally{s(o),0===e.allPendingTasks&&0===e.pingedTasks.length&&0===e.clientRenderedBoundaries.length&&0===e.completedBoundaries.length&&o.close()}}function In(e,t){try{var n=e.abortableTasks;n.forEach((function(n){return En(n,e,t)})),n.clear(),null!==e.destination&&jn(e,e.destination)}catch(t){dn(e,t),un(e,t)}}return Wl.renderToReadableStream=function(e,t){return new Promise((function(n,a){var i,r,o=new Promise((function(e,t){r=e,i=t})),s=function(e,t,n,a,i,r,o,s,l){var c=[],d=new Set;return(n=cn(t={destination:null,responseState:t,progressiveChunkSize:void 0===a?12800:a,status:0,fatalError:null,nextSegmentId:0,allPendingTasks:0,pendingRootTasks:0,completedRootSegment:null,abortableTasks:d,pingedTasks:c,clientRenderedBoundaries:[],completedBoundaries:[],partialBoundaries:[],onError:void 0===i?on:i,onAllReady:void 0===r?sn:r,onShellReady:void 0===o?sn:o,onShellError:void 0===s?sn:s,onFatalError:void 0===l?sn:l},0,null,n,!1,!1)).parentFlushed=!0,e=ln(t,e,null,n,d,Et,null,Tt),c.push(e),t}(e,function(e,t,n,a,i){e=void 0===e?"":e,t=void 0===t?R:d('<script nonce="'+C(t)+'">');var r=[];if(void 0!==n&&r.push(t,c((""+n).replace(N,D)),j),void 0!==a)for(n=0;n<a.length;n++)r.push(I,c(C(a[n])),P);if(void 0!==i)for(a=0;a<i.length;a++)r.push(T,c(C(i[a])),P);return{bootstrapChunks:r,startInlineScript:t,placeholderPrefix:d(e+"P:"),segmentPrefix:d(e+"S:"),boundaryPrefix:e+"B:",idPrefix:e,nextSuspenseID:0,sentCompleteSegmentFunction:!1,sentCompleteBoundaryFunction:!1,sentClientRenderFunction:!1}}(t?t.identifierPrefix:void 0,t?t.nonce:void 0,t?t.bootstrapScriptContent:void 0,t?t.bootstrapScripts:void 0,t?t.bootstrapModules:void 0),function(e){return M("http://www.w3.org/2000/svg"===e?2:"http://www.w3.org/1998/Math/MathML"===e?3:0,null)}(t?t.namespaceURI:void 0),t?t.progressiveChunkSize:void 0,t?t.onError:void 0,r,(function(){var e=new ReadableStream({type:"bytes",pull:function(e){if(1===s.status)s.status=2,u(e,s.fatalError);else if(2!==s.status&&null===s.destination){s.destination=e;try{jn(s,e)}catch(e){dn(s,e),un(s,e)}}},cancel:function(){In(s)}},{highWaterMark:0});e.allReady=o,n(e)}),(function(e){o.catch((function(){})),a(e)}),i);if(t&&t.signal){var l=t.signal,m=function(){In(s,l.reason),l.removeEventListener("abort",m)};l.addEventListener("abort",m)}_n(s)}))},Wl.version="18.2.0",Wl}(),zl.version,zl.renderToString;zl.renderToStaticMarkup;zl.renderToNodeStream,zl.renderToStaticNodeStream,Hl.renderToReadableStream;const Gl=e=>{let{as:t,children:n,type:a="body",weight:i="regular",size:r="md"}=e,o=ge()(e,Ml);const s=t||"p";return Object(Dl.jsx)(s,Ul(Ul({},o),{},{style:Ul(Ul({},o.style||{}),{},{font:`var(--cpd-font-${a}-${r}-${i})`,letterSpacing:`var(--cpd-font-letter-spacing-${a}-${r})`}),children:n}))},Kl=e=>{let{as:t="p",children:n}=e,a=ge()(e,Al);return Object(Dl.jsx)(Gl,Ul(Ul({as:t,type:"body"},a),{},{children:n}))},ql=(e,t="")=>(null==e?void 0:e.name)||t;function $l({room:e}){const t=function(e,t){let n=Object(N.b)("Join Room");t&&t.name&&(n=t.name);const[a,i]=Object(r.useState)(ql(e,n));return Object(ae.c)(e,l.RoomEvent.Name,(()=>{i(ql(e,n))})),Object(r.useEffect)((()=>{i(ql(e,n))}),[e,n]),a}(e),n=Object(Qo.b)(e);return o.a.createElement("header",{className:"mx_RoomHeader light-panel",onClick:()=>{const e=fn.a.instance;e.isOpen?e.togglePanel(null):e.setCard({phase:vn.a.RoomSummary})}},o.a.createElement(Gt.a,{room:e,avatarSize:40,displayBadge:!1}),o.a.createElement("div",{className:"mx_RoomHeader_info"},o.a.createElement(Kl,{as:"div",size:"lg",weight:"semibold",dir:"auto",title:t,role:"heading","aria-level":1},t),n&&o.a.createElement(Kl,{as:"div",size:"sm",className:"mx_RoomHeader_topic"},n.text)))}var Yl=({roomWidth:e})=>{const t=Object(r.useRef)(null),a=Object(r.useRef)(new Map);return Object(r.useEffect)((()=>{const e=()=>{var e;t.current&&(null===(e=t.current)||void 0===e?void 0:e.height)!==X.b.instance.windowHeight&&(t.current.height=X.b.instance.windowHeight)},i=b.a.register((e=>{const i="effects.";if(t.current&&e.action.startsWith(i)){(async e=>{if(!e)return null;let t=a.current.get(e)||null;if(null===t){var i;const r=null===(i=ta.CHAT_EFFECTS.find((t=>t.command===e)))||void 0===i?void 0:i.options;try{const{default:i}=await n(1555)(`./${e}`);t=new i(r),a.current.set(e,t)}catch(t){on.a.warn(`Unable to load effect module at '../../../effects/${e}.`,t)}}return t})(e.action.slice(8)).then((e=>null==e?void 0:e.start(t.current)))}})),r=t.current;return r&&(r.height=X.b.instance.windowHeight),X.b.instance.on(X.a.Resize,e),()=>{b.a.unregister(i),X.b.instance.off(X.a.Resize,e);const t=a.current;for(const e in t){const n=t.get(e);n&&n.isRunning&&n.stop()}}}),[]),o.a.createElement("canvas",{ref:t,width:e,style:{display:"block",zIndex:999999,pointerEvents:"none",position:"fixed",top:0,right:0},"aria-hidden":!0})},Jl=n(133);const Ql=({kind:e,devices:t,setDevice:n,deviceListLabel:a,muted:i,disabled:s,toggle:l,unmutedTitle:c,mutedTitle:u})=>{const[m,h,p,g]=Object(le.q)(),b=Object(r.useCallback)((e=>{n(e),g()}),[n,g]);let v=null;if(m){const e=h.current.getBoundingClientRect();v=o.a.createElement(de.e,ee()({},Object(le.j)(e,void 0,10),{onFinished:g}),o.a.createElement(de.c,null,t.map((e=>o.a.createElement(de.b,{key:e.deviceId,label:e.label,onClick:()=>b(e)})))))}return t.length?o.a.createElement("div",{className:d()("mx_CallView_deviceButtonWrapper",{mx_CallView_deviceButtonWrapper_muted:i})},o.a.createElement($.a,{className:`mx_CallView_deviceButton mx_CallView_deviceButton_${e}`,inputRef:h,title:i?u:c,alignment:Zr.a.Top,onClick:l,disabled:s}),t.length>1?o.a.createElement(le.b,{className:"mx_CallView_deviceListButton",onClick:p,isExpanded:m,label:a,disabled:s}):null,v):null},Xl=({room:e,joinCallButtonDisabledTooltip:t,connect:n,children:a})=>{const[i,s]=Object(r.useState)(!1),l=Object(r.useMemo)((()=>e.getMember(e.myUserId)),[e]),c=Object(r.useRef)(null),[d,u]=Object(r.useState)((()=>p.c.getVideoInput())),[m,h]=Object(r.useState)((()=>p.c.startWithAudioMuted)),[g,b]=Object(r.useState)((()=>p.c.startWithVideoMuted)),v=Object(r.useCallback)((()=>{p.c.startWithAudioMuted=!m,h(!m)}),[m,h]),f=Object(r.useCallback)((()=>{p.c.startWithVideoMuted=!g,b(!g)}),[g,b]),y=e=>{p.c.startWithAudioMuted=!0,p.c.startWithVideoMuted=!0,on.a.warn(e)},[E,w,S]=Object(Ua.a)((async()=>{var e,t,n,a;let i;try{if(i=await p.c.getDevices(),void 0===i)return y("Could not access devices!"),[null,[],[]]}catch(e){return y(`Unable to get Media Devices: ${e}`),[null,[],[]]}let r=null;try{i.audioinput.length>0?r=await navigator.mediaDevices.getUserMedia({audio:!0,video:!g&&i.videoinput.length>0&&{deviceId:d}}):i.videoinput.length>0&&(r=await navigator.mediaDevices.getUserMedia({video:{deviceId:d}}))}catch(e){on.a.warn(`Failed to get stream for device ${d}`,e),y("Have access to Device list but unable to read from Media Devices")}var o;(null!==r&&(i=await p.c.getDevices()),g)&&(null===(o=r)||void 0===o||o.getTracks().forEach((e=>e.stop())),r=null);return[r,null!==(e=null===(t=i)||void 0===t?void 0:t.audioinput)&&void 0!==e?e:[],null!==(n=null===(a=i)||void 0===a?void 0:a.videoinput)&&void 0!==n?n:[]]}),[d,g],[null,[],[]]),_=Object(r.useCallback)((e=>{p.c.instance.setAudioInput(e.deviceId)}),[]),C=Object(r.useCallback)((e=>{p.c.instance.setVideoInput(e.deviceId),u(e.deviceId)}),[]);Object(r.useEffect)((()=>{if(E){const e=c.current;return e.srcObject=E,e.play(),()=>{E.getTracks().forEach((e=>e.stop())),e.srcObject=null}}}),[E]);const O=Object(r.useCallback)((async e=>{e.preventDefault(),s(!0);try{await n()}catch(e){on.a.error(e),s(!1)}}),[n,s]);return o.a.createElement("div",{className:"mx_CallView_lobby"},a,o.a.createElement("div",{className:"mx_CallView_preview"},o.a.createElement(Ba.b,{key:l.userId,member:l,width:200,height:200,resizeMethod:"scale"}),o.a.createElement("video",{ref:c,style:{visibility:g?"hidden":void 0},muted:!0,playsInline:!0,disablePictureInPicture:!0}),o.a.createElement("div",{className:"mx_CallView_controls"},o.a.createElement(Ql,{kind:"audio",devices:w,setDevice:_,deviceListLabel:Object(N.b)("Audio devices"),muted:m,disabled:i,toggle:v,unmutedTitle:Object(N.b)("Mute microphone"),mutedTitle:Object(N.b)("Unmute microphone")}),o.a.createElement(Ql,{kind:"video",devices:S,setDevice:C,deviceListLabel:Object(N.b)("Video devices"),muted:g,disabled:i,toggle:f,unmutedTitle:Object(N.b)("Turn off camera"),mutedTitle:Object(N.b)("Turn on camera")}))),o.a.createElement($.a,{className:"mx_CallView_connectButton",kind:"primary",disabled:i||void 0!==t,onClick:O,label:Object(N.b)("Join"),tooltip:i?Object(N.b)("Connecting"):t,alignment:Zr.a.Bottom}))},Zl=({room:e,resizing:t,call:n,setStartingCall:a})=>{const i=Object(r.useContext)(I.a),s=Object(r.useRef)();void 0===s.current&&(s.current=Object($n.m)());const l=s.current,[c,d]=Object(r.useState)((()=>null!==n&&Object(Cl.g)(n.connectionState)));Object(r.useEffect)((()=>{if(null!==n){const e=e=>d(Object(Cl.g)(e));return n.on(Cl.b.ConnectionState,e),()=>{n.off(Cl.b.ConnectionState,e)}}}),[n]);const u=Object(r.useCallback)((async()=>{a(!0),await Cl.d.create(e),await l.promise}),[e,a,l]);return Object(r.useEffect)((()=>{(async()=>{if(null!==n)try{await Promise.all([...Jl.a.instance.activeCalls].map((e=>e.disconnect()))),await n.connect(),l.resolve()}catch(e){l.reject(e)}})()}),[n,l]),o.a.createElement("div",{className:"mx_CallView"},c?null:o.a.createElement(Xl,{room:e,connect:u}),null!==n&&o.a.createElement(qi,{app:n.widget,room:e,userId:i.credentials.userId,creatorUserId:n.widget.creatorUserId,waitForIframeLoad:n.widget.waitForIframeLoad,showMenubar:!1,pointerEvents:t?"none":void 0}))},ec=({room:e,resizing:t,call:n})=>{const a=Object(r.useContext)(I.a),i=Object(Cl.g)(Object(Sl.c)(n)),s=Object(Sl.g)(n),l=Object(Sl.d)(n),c=Object(r.useCallback)((async()=>{await Promise.all([...Jl.a.instance.activeCalls].map((e=>e.disconnect()))),await n.connect()}),[n]);Object(r.useEffect)((()=>{n.clean()}),[n]);let d=null;if(!i){let t=null;if(s.length){const e=s.slice(0,8),n=s.length>e.length;t=o.a.createElement("div",{className:"mx_CallView_participants"},Object(N.b)("%(count)s people joined",{count:s.length}),o.a.createElement(ts.a,{members:e,faceSize:24,overflow:n}))}d=o.a.createElement(Xl,{room:e,connect:c,joinCallButtonDisabledTooltip:null!=l?l:void 0},t)}return o.a.createElement("div",{className:"mx_CallView"},d,o.a.createElement(qi,{app:n.widget,room:e,userId:a.credentials.userId,creatorUserId:n.widget.creatorUserId,waitForIframeLoad:n.widget.waitForIframeLoad,showMenubar:!1,pointerEvents:t?"none":void 0}))},tc=({room:e,resizing:t,waitForCall:n})=>{const a=Object(Sl.a)(e.roomId),[i,s]=Object(r.useState)(!1);return null===a||i?n?null:o.a.createElement(Zl,{room:e,resizing:t,call:a,setStartingCall:s}):o.a.createElement(ec,{room:e,resizing:t,call:a})};var nc=n(336),ac=n(666),ic=n(117),rc=n(421);const oc=(e,t)=>{const[n,a]=Object(r.useState)((()=>Array.isArray(t)?t:new Array(e).fill(t)));return[n,(e,t)=>a((n=>{const a=[...n];return a[e]=t,a}))]};var sc=n(286),lc=n(728),cc=n(1402),dc=n(618),uc=n(287);function mc(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function hc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?mc(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):mc(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const pc=({room:e,suggested:t,selected:n,hasPermissions:a,onToggleClick:i,onViewRoomClick:s,onJoinRoomClick:c,numChildRooms:u,children:m})=>{var h,p;const g=Object(r.useContext)(I.a),b=Object(ae.d)(g,l.ClientEvent.Room,(()=>{const t=null==g?void 0:g.getRoom(e.room_id);return"join"===(null==t?void 0:t.getMyMembership())?t:void 0})),v=Object(ae.d)(b,l.RoomEvent.Name,(e=>null==e?void 0:e.name)),f=v||e.name||e.canonical_alias||(null===(h=e.aliases)||void 0===h?void 0:h[0])||(e.room_type===l.RoomType.Space?Object(N.b)("Unnamed Space"):Object(N.b)("Unnamed Room")),[y,E]=Object(lt.a)(!0),[w,S,_]=Object(Oe.i)(),[C,O]=Object(r.useState)(!1),x=e=>{e.preventDefault(),e.stopPropagation(),s()},k=async t=>{O(!0),t.preventDefault(),t.stopPropagation(),c().then((()=>Object(uc.a)(g,e.room_id))).finally((()=>{O(!1)}))};let R,j,T;R=C?o.a.createElement($.a,{disabled:!0,onClick:k,kind:"primary_outline",onFocus:w,tabIndex:S?0:-1,title:Object(N.b)("Joining")},o.a.createElement(Ma.a,{w:24,h:24})):b?o.a.createElement(K.a,{onClick:x,kind:"primary_outline",onFocus:w,tabIndex:S?0:-1},Object(N.b)("View")):o.a.createElement(K.a,{onClick:k,kind:"primary",onFocus:w,tabIndex:S?0:-1},Object(N.b)("Join")),i&&(j=a?o.a.createElement(Ne.b,{checked:!!n,onChange:i,tabIndex:S?0:-1}):o.a.createElement(Cn.a,{tooltip:Object(N.b)("You don't have permission"),onClick:e=>{e.stopPropagation()}},o.a.createElement(Ne.b,{disabled:!0,tabIndex:S?0:-1}))),T=b?o.a.createElement(fe.a,{room:b,width:20,height:20}):o.a.createElement(yt.a,{name:f,idName:e.room_id,url:e.avatar_url?Object(xn.b)(e.avatar_url).getSquareThumbnailHttp(20):null,width:20,height:20});let P,D,M,A,L=Object(N.b)("%(count)s members",{count:null!==(p=e.num_joined_members)&&void 0!==p?p:0});if(void 0!==u&&(L+=" · "+Object(N.b)("%(count)s rooms",{count:u})),b){const e=Object(Qo.a)(b);P=Object(Go.i)(null==e?void 0:e.text,null==e?void 0:e.html)}else P=e.topic;P&&(D=o.a.createElement(Go.a,{options:{attributes:{onClick(e){e.stopPropagation()}}}}," · ",P)),b&&(M=o.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_joined"},Object(N.b)("Joined"))),!t||b&&!a||(A=o.a.createElement(dc.b,{tooltip:Object(N.b)("This room is suggested as a good one to join")},Object(N.b)("Suggested")));const U=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_item"},o.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_avatar"},T),o.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_name"},f,M,A),o.a.createElement("div",{className:"mx_SpaceHierarchy_roomTile_info"},L,D)),o.a.createElement("div",{className:"mx_SpaceHierarchy_actions"},R,j));let F,B,V;if(m){if(F=o.a.createElement("div",{className:d()("mx_SpaceHierarchy_subspace_toggle",{mx_SpaceHierarchy_subspace_toggle_shown:y}),onClick:e=>{e.stopPropagation(),E()}}),y){const e=e=>{var t;if(Object(Q.a)().getAccessibilityAction(e)===z.h.ArrowLeft)e.preventDefault(),e.stopPropagation(),null===(t=_.current)||void 0===t||t.focus()};B=o.a.createElement("div",{className:"mx_SpaceHierarchy_subspace_children",onKeyDown:e,role:"group"},m)}V=e=>{let t=!1;switch(Object(Q.a)().getAccessibilityAction(e)){case z.h.ArrowLeft:y&&(t=!0,E());break;case z.h.ArrowRight:if(t=!0,y){var n,a;const e=null===(n=_.current)||void 0===n?void 0:n.nextElementSibling;null==e||null===(a=e.querySelector(".mx_SpaceHierarchy_roomTile"))||void 0===a||a.focus()}else E()}t&&(e.preventDefault(),e.stopPropagation())}}return o.a.createElement("li",{className:"mx_SpaceHierarchy_roomTileWrapper",role:"treeitem","aria-selected":n,"aria-expanded":m?y:void 0},o.a.createElement(K.a,{className:d()("mx_SpaceHierarchy_roomTile",{mx_SpaceHierarchy_subspace:e.room_type===l.RoomType.Space,mx_SpaceHierarchy_joining:C}),onClick:a&&i?i:x,onKeyDown:V,inputRef:_,onFocus:w,tabIndex:S?0:-1},U,F),B)},gc=(e,t,n,a)=>{var i,r;const o=t.roomMap.get(n);if(e.isGuest()&&!(null!=o&&o.world_readable||null!=o&&o.guest_can_join))return void b.a.dispatch({action:"require_registration"});const s=Object(pn.a)(null!==(i=null==o?void 0:o.canonical_alias)&&void 0!==i?i:"",null!==(r=null==o?void 0:o.aliases)&&void 0!==r?r:[])||void 0;b.a.dispatch({action:F.a.ViewRoom,should_peek:!0,room_alias:s,room_id:n,via_servers:Array.from(t.viaMap.get(n)||[]),oob_data:{avatarUrl:null==o?void 0:o.avatar_url,name:(null==o?void 0:o.name)||s||Object(N.b)("Unnamed room"),roomType:a},metricsTrigger:"RoomDirectory"})},bc=async(e,t,n)=>{if(e.isGuest())b.a.dispatch({action:"require_registration"});else{try{await e.joinRoom(n,{viaServers:Array.from(t.viaMap.get(n)||[])})}catch(e){return void(e instanceof l.MatrixError?Ze.b.instance.roomViewStore.showJoinRoomError(e,n):(on.a.warn("Got a non-MatrixError while joining room",e),Ze.b.instance.roomViewStore.showJoinRoomError(new l.MatrixError({error:Object(N.b)("Unknown error")}),n)))}b.a.dispatch({action:F.a.JoinRoomReady,roomId:n,metricsTrigger:"SpaceHierarchy"})}},vc=({root:e,roomSet:t,hierarchy:n,parents:a,selectedMap:i,onViewRoomClick:s,onJoinRoomClick:c,onToggleClick:d})=>{const u=Object(r.useContext)(I.a),m=u.getRoom(e.room_id),h=null==m?void 0:m.currentState.maySendStateEvent(l.EventType.SpaceChild,u.getSafeUserId()),p=Object(R.sortBy)(e.children_state,(e=>Object(Y.b)(e.content.order,e.origin_server_ts,e.state_key))),[g,b]=p.reduce(((e,a)=>{const i=n.roomMap.get(a.state_key);return i&&t.has(i)&&e[i.room_type===l.RoomType.Space?0:1].push(((e,t,n)=>{const a=e.getRoomUpgradeHistory(t.room_id,!0,v.b.getValue("feature_dynamic_room_predecessors"));let i=null;for(let e=a.length-1;e>=0;--e)if(n.roomMap.get(a[e].roomId)){i=a[e];break}var r,o,s,c,d;return i?hc(hc({},t),{},{room_id:i.roomId,room_type:i.getType(),name:i.name,topic:null===(r=i.currentState.getStateEvents(l.EventType.RoomTopic,""))||void 0===r?void 0:r.getContent().topic,avatar_url:null!==(o=i.getMxcAvatarUrl())&&void 0!==o?o:void 0,canonical_alias:null!==(s=i.getCanonicalAlias())&&void 0!==s?s:void 0,aliases:i.getAltAliases(),world_readable:(null===(c=i.currentState.getStateEvents(l.EventType.RoomHistoryVisibility,""))||void 0===c?void 0:c.getContent().history_visibility)===l.HistoryVisibility.WorldReadable,guest_can_join:(null===(d=i.currentState.getStateEvents(l.EventType.RoomGuestAccess,""))||void 0===d?void 0:d.getContent().guest_access)===l.GuestAccess.CanJoin,num_joined_members:i.getJoinedMemberCount()}):t})(u,i,n)),e}),[[],[]]),f=new Set(a).add(e.room_id);return o.a.createElement(o.a.Fragment,null,Object(R.uniqBy)(b,"room_id").map((t=>{var a;return o.a.createElement(pc,{key:t.room_id,room:t,suggested:n.isSuggested(e.room_id,t.room_id),selected:null==i||null===(a=i.get(e.room_id))||void 0===a?void 0:a.has(t.room_id),onViewRoomClick:()=>s(t.room_id,t.room_type),onJoinRoomClick:()=>c(t.room_id,f),hasPermissions:h,onToggleClick:d?()=>d(e.room_id,t.room_id):void 0})})),g.filter((e=>!f.has(e.room_id))).map((a=>{var r;return o.a.createElement(pc,{key:a.room_id,room:a,numChildRooms:a.children_state.filter((e=>{const a=n.roomMap.get(e.state_key);return a&&t.has(a)&&!a.room_type})).length,suggested:n.isSuggested(e.room_id,a.room_id),selected:null==i||null===(r=i.get(e.room_id))||void 0===r?void 0:r.has(a.room_id),onViewRoomClick:()=>s(a.room_id,l.RoomType.Space),onJoinRoomClick:()=>c(a.room_id,f),hasPermissions:h,onToggleClick:d?()=>d(e.room_id,a.room_id):void 0},o.a.createElement(vc,{root:a,roomSet:t,hierarchy:n,parents:f,selectedMap:i,onViewRoomClick:s,onJoinRoomClick:c,onToggleClick:d}))})))},fc=({hierarchy:e,selected:t,setSelected:n,setError:a})=>{const i=Object(r.useContext)(I.a),[s,c]=Object(r.useState)(!1),[d,u]=Object(r.useState)(!1),m=Array.from(t.keys()).flatMap((e=>[...t.get(e).values()].map((t=>[e,t])))),h=m.every((([t,n])=>e.isSuggested(t,n))),p=!m.length||s||d;let g=K.a,b={};m.length||(g=$.a,b={tooltip:Object(N.b)("Select a room below first"),alignment:Zr.a.Top});let v=Object(N.b)("Saving…");return d||(v=h?Object(N.b)("Mark as not suggested"):Object(N.b)("Mark as suggested")),o.a.createElement(o.a.Fragment,null,o.a.createElement(g,ee()({},b,{onClick:async()=>{c(!0);try{const t=i.getSafeUserId();for(const[n,a]of m){await i.sendStateEvent(n,l.EventType.SpaceChild,{},a);const r=i.getRoom(a),o=null==r?void 0:r.currentState.getStateEvents(l.EventType.SpaceParent,n);null!=r&&r.currentState.maySendStateEvent(l.EventType.SpaceParent,t)&&Array.isArray(null==o?void 0:o.getContent().via)&&await i.sendStateEvent(a,l.EventType.SpaceParent,{},n),e.removeRelation(n,a)}}catch(e){a(Object(N.b)("Failed to remove some rooms. Try again later"))}c(!1),n(new Map)},kind:"danger_outline",disabled:p}),s?Object(N.b)("Removing…"):Object(N.b)("Remove")),o.a.createElement(g,ee()({},b,{onClick:async()=>{u(!0);try{for(const[n,a]of m){var t;const r=!h,o=null===(t=e.getRelation(n,a))||void 0===t?void 0:t.content;if(!o||o.suggested===r)continue;const s=hc(hc({},o),{},{suggested:!h});await i.sendStateEvent(n,l.EventType.SpaceChild,s,a),o.suggested=s.suggested}}catch(e){a("Failed to update some suggestions. Try again later")}u(!1),n(new Map)},kind:"primary_outline",disabled:p}),v))};var yc=({space:e,initialText:t="",showRoom:n,additionalButtons:a})=>{const i=Object(r.useContext)(I.a),[s,c]=Object(r.useState)(t),[d,u]=Object(r.useState)(new Map),{loading:m,rooms:h,hierarchy:p,loadMore:g,error:v}=(e=>{const[t,n]=Object(r.useState)([]),[a,i]=Object(r.useState)(),[o,s]=Object(r.useState)(),l=Object(r.useCallback)((()=>{s(void 0);const t=new cc.a(e,20);t.load().then((()=>{var a;e===t.root&&n(null!==(a=t.rooms)&&void 0!==a?a:[])}),s),i(t)}),[e]);Object(r.useEffect)(l,[l]),Object(ne.a)(b.a,(e=>{e.action===F.a.UpdateSpaceHierarchy&&(n([]),l())}));const c=Object(r.useCallback)((async e=>{var t;!a||a.loading||!a.canLoadMore||a.noSupport||o||(await a.load(e).catch(s),n(null!==(t=a.rooms)&&void 0!==t?t:[]))}),[o,a]);return(null==a?void 0:a.root)!==e?{loading:!0,loadMore:c}:{loading:a.loading,rooms:t,hierarchy:a,loadMore:c,error:o}})(e),f=Object(r.useMemo)((()=>{if(null==h||!h.length||!p)return new Set;const e=s.toLowerCase().trim();if(!e)return new Set(h);const t=h.filter((t=>{var n,a;return(null===(n=t.name)||void 0===n?void 0:n.toLowerCase().includes(e))||(null===(a=t.topic)||void 0===a?void 0:a.toLowerCase().includes(e))})),n=new Set,a=[...t.map((e=>e.room_id))];for(;a.length;){var i;const e=a.pop();n.add(e),null===(i=p.backRefs.get(e))||void 0===i||i.forEach((e=>{n.has(e)||a.push(e)}))}return new Set(h.filter((e=>n.has(e.room_id))))}),[h,p,s]),[y,E]=Object(r.useState)("");let w=y;!y&&v&&(w=Object(N.b)("Failed to load list of rooms."));const S=(e=>{const t=t=>{t[0].isIntersecting&&e()},n=Object(r.useRef)();return e=>{n.current?n.current.disconnect():e&&(n.current=new IntersectionObserver(t,{root:e.parentElement,rootMargin:"0px 0px 600px 0px"})),n.current&&e&&n.current.observe(e)}})(g);if(!m&&p.noSupport)return o.a.createElement("p",null,Object(N.b)("Your server does not support showing space hierarchies."));const _=(e,t)=>{if(E(""),!d.has(e))return void u(new Map(d.set(e,new Set([t]))));const n=d.get(e);n.has(t)?(n.delete(t),u(new Map(d.set(e,new Set(n))))):u(new Map(d.set(e,new Set([...n,t]))))};return o.a.createElement(Oe.d,{onKeyDown:(e,t)=>{var n,a;Object(Q.a)().getAccessibilityAction(e)===z.h.ArrowDown&&e.currentTarget.classList.contains("mx_SpaceHierarchy_search")&&(null===(n=t.refs[0])||void 0===n||null===(a=n.current)||void 0===a||a.focus())},handleHomeEnd:!0,handleUpDown:!0},(({onKeyDownHandler:r})=>{let g;if(p&&(!m||null!=h&&h.length)){const t="join"===(null==e?void 0:e.getMyMembership())&&e.currentState.maySendStateEvent(l.EventType.SpaceChild,i.getSafeUserId()),c=p.roomMap.get(e.roomId);let m,h;f.size&&c?m=o.a.createElement(o.a.Fragment,null,o.a.createElement(vc,{root:c,roomSet:f,hierarchy:p,parents:new Set,selectedMap:d,onToggleClick:t?_:void 0,onViewRoomClick:(e,t)=>n(i,p,e,t),onJoinRoomClick:async(e,t)=>{for(const e of t){var n;"join"!==(null===(n=i.getRoom(e))||void 0===n?void 0:n.getMyMembership())&&await bc(i,p,e)}await bc(i,p,e)}})):p.canLoadMore||(m=o.a.createElement("div",{className:"mx_SpaceHierarchy_noResults"},o.a.createElement("h3",null,Object(N.b)("No results found")),o.a.createElement("div",null,Object(N.b)("You may want to try a different search or check for typos.")))),p.canLoadMore&&(h=o.a.createElement("div",{ref:S},o.a.createElement(Ma.a,null))),g=o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"mx_SpaceHierarchy_listHeader"},o.a.createElement("h4",{className:"mx_SpaceHierarchy_listHeader_header"},s.trim()?Object(N.b)("Results"):Object(N.b)("Rooms and spaces")),o.a.createElement("div",{className:"mx_SpaceHierarchy_listHeader_buttons"},a,t&&o.a.createElement(fc,{hierarchy:p,selected:d,setSelected:u,setError:E}))),w&&o.a.createElement("div",{className:"mx_SpaceHierarchy_error"},w),o.a.createElement("ul",{className:"mx_SpaceHierarchy_list",onKeyDown:r,role:"tree","aria-label":Object(N.b)("Space")},m),h)}else g=o.a.createElement(Ma.a,null);return o.a.createElement(o.a.Fragment,null,o.a.createElement(Qi.a,{className:"mx_SpaceHierarchy_search mx_textinput_icon mx_textinput_search",placeholder:Object(N.b)("Search names and descriptions"),onSearch:c,autoFocus:!0,initialValue:t,onKeyDown:r}),g)}))},Ec=function(e){return e[e.Landing=0]="Landing",e[e.PublicCreateRooms=1]="PublicCreateRooms",e[e.PublicShare=2]="PublicShare",e[e.PrivateScope=3]="PrivateScope",e[e.PrivateInvite=4]="PrivateInvite",e[e.PrivateCreateRooms=5]="PrivateCreateRooms",e[e.PrivateExistingRooms=6]="PrivateExistingRooms",e}(Ec||{});const wc=({space:e})=>{const[t,n,a,i]=Object(le.q)(),r=Object(te.a)(oe.a.CreateRooms),s=Object(te.a)(oe.a.CreateSpaces),c=Object(ie.a)("feature_video_rooms"),d=Object(ie.a)("feature_element_call_video_rooms");let u=null;if(t){const t=n.current.getBoundingClientRect();u=o.a.createElement(de.e,{left:t.left+window.scrollX+0,top:t.bottom+window.scrollY+8,chevronFace:le.a.None,onFinished:i,className:"mx_RoomTile_contextMenu",compact:!0},o.a.createElement(de.c,{first:!0},r&&o.a.createElement(o.a.Fragment,null,o.a.createElement(de.b,{label:Object(N.b)("New room"),iconClassName:"mx_RoomList_iconNewRoom",onClick:async t=>{t.preventDefault(),t.stopPropagation(),i(),re.b.trackInteraction("WebSpaceHomeCreateRoomButton",t),await Object(se.g)(e)&&b.a.fire(F.a.UpdateSpaceHierarchy)}}),c&&o.a.createElement(de.b,{label:Object(N.b)("New video room"),iconClassName:"mx_RoomList_iconNewVideoRoom",onClick:async t=>{t.preventDefault(),t.stopPropagation(),i(),await Object(se.g)(e,d?l.RoomType.UnstableCall:l.RoomType.ElementVideo)&&b.a.fire(F.a.UpdateSpaceHierarchy)}},o.a.createElement(ce.a,null))),o.a.createElement(de.b,{label:Object(N.b)("Add existing room"),iconClassName:"mx_RoomList_iconAddExistingRoom",onClick:t=>{t.preventDefault(),t.stopPropagation(),i(),Object(se.e)(e)}}),s&&o.a.createElement(de.b,{label:Object(N.b)("Add space"),iconClassName:"mx_RoomList_iconPlus",onClick:t=>{t.preventDefault(),t.stopPropagation(),i(),Object(se.h)(e)}},o.a.createElement(ce.a,null))))}return o.a.createElement(o.a.Fragment,null,o.a.createElement(le.b,{kind:"primary",inputRef:n,onClick:a,isExpanded:t,label:Object(N.b)("Add")},Object(N.b)("Add")),u)},Sc=({space:e})=>{const t=Object(r.useContext)(I.a),n=Ta(e),a=t.getSafeUserId(),i=Object(r.useCallback)((()=>{var t;return fn.a.instance.isOpenForRoom(e.roomId)&&(null===(t=fn.a.instance.currentCardForRoom(e.roomId))||void 0===t?void 0:t.phase)===vn.a.SpaceMemberList}),[e.roomId]),s=Object(ae.b)(fn.a.instance,ft.b,i);let c;Object(se.c)(e)&&Object(te.a)(oe.a.InviteUsers)&&(c=o.a.createElement(K.a,{kind:"primary",className:"mx_SpaceRoomView_landing_inviteButton",onClick:()=>{Object(se.i)(e)}},Object(N.b)("Invite")));let d,u;"join"===n&&e.currentState.maySendStateEvent(l.EventType.SpaceChild,a)&&(d=o.a.createElement(wc,{space:e})),Object(se.d)(e)&&(u=o.a.createElement($.a,{className:"mx_SpaceRoomView_landing_settingsButton",onClick:()=>{Object(se.k)(e)},title:Object(N.b)("Settings")}));return o.a.createElement("div",{className:"mx_SpaceRoomView_landing"},o.a.createElement("div",{className:"mx_SpaceRoomView_landing_header"},o.a.createElement(fe.a,{room:e,height:80,width:80,viewAvatarOnClick:!0})),o.a.createElement("div",{className:"mx_SpaceRoomView_landing_name"},o.a.createElement(Za.a,{room:e},(e=>{const t={name:()=>o.a.createElement("h1",null,e)};return Object(N.b)("Welcome to <name/>",{},t)}))),o.a.createElement("div",{className:"mx_SpaceRoomView_landing_infoBar"},o.a.createElement(os,{room:e}),o.a.createElement("div",{className:"mx_SpaceRoomView_landing_infoBar_interactive"},o.a.createElement(rs,{room:e,onlyKnownUsers:!1,numShown:7,onClick:s?void 0:()=>{fn.a.instance.setCard({phase:vn.a.SpaceMemberList})}}),c,u)),o.a.createElement(Zo,{room:e,className:"mx_SpaceRoomView_landing_topic"}),o.a.createElement(yc,{space:e,showRoom:gc,additionalButtons:d}))},_c=({space:e,title:t,description:n,onFinished:a})=>{const[i,s]=Object(r.useState)(!1),[c,d]=Object(r.useState)(""),u=[Object(N.b)("General"),Object(N.b)("Random"),Object(N.b)("Support")],[m,h]=oc(3,[Object(N.b)("General"),Object(N.b)("Random"),""]),p=new Array(3).fill(0).map(((e,t)=>{const n="roomName"+t;return o.a.createElement(at.a,{key:n,name:n,type:"text",label:Object(N.b)("Room name"),placeholder:u[t],value:m[t],onChange:e=>h(t,e.target.value),autoFocus:2===t,disabled:i,autoComplete:"off"})})),g=async t=>{if(t.preventDefault(),!i){d(""),s(!0);try{var n;const t=e.getJoinRule()===l.JoinRule.Public,i=m.map((e=>e.trim())).filter(Boolean),r=await Promise.all(i.map((n=>Object(ic.c)(e.client,{createOpts:{preset:t?l.Preset.PublicChat:l.Preset.PrivateChat,name:n},spinner:!1,encryption:!1,andView:!1,inlineErrors:!0,parentSpace:e,joinRule:t?void 0:l.JoinRule.Restricted,suggested:!0}))));a(null!==(n=r[0])&&void 0!==n?n:void 0)}catch(e){on.a.error("Failed to create initial space rooms",e),d(Object(N.b)("Failed to create initial space rooms"))}s(!1)}};let b=e=>{e.preventDefault(),a()},v=Object(N.b)("Skip for now");return m.some((e=>e.trim()))&&(b=g,v=i?Object(N.b)("Creating rooms…"):Object(N.b)("Continue")),o.a.createElement("div",null,o.a.createElement("h1",null,t),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},n),c&&o.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},c),o.a.createElement("form",{onSubmit:b,id:"mx_SpaceSetupFirstRooms"},p),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.a.createElement(K.a,{kind:"primary",disabled:i,onClick:b,element:"input",type:"submit",form:"mx_SpaceSetupFirstRooms",value:v})))},Cc=({space:e,onFinished:t})=>o.a.createElement("div",null,o.a.createElement("h1",null,Object(N.b)("What do you want to organise?")),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.b)("Pick rooms or conversations to add. This is just a space for you, no one will be informed. You can add more later.")),o.a.createElement(sc.a,{space:e,emptySelectionButton:o.a.createElement(K.a,{kind:"primary",onClick:t},Object(N.b)("Skip for now")),filterPlaceholder:Object(N.b)("Search for rooms"),onFinished:t,roomsRenderer:sc.f,dmsRenderer:sc.e})),Oc=({justCreatedOpts:e,space:t,onFinished:n,firstRoomId:a})=>{var i;return o.a.createElement("div",{className:"mx_SpaceRoomView_publicShare"},o.a.createElement("h1",null,Object(N.b)("Share %(name)s",{name:(null==e||null===(i=e.createOpts)||void 0===i?void 0:i.name)||t.name})),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.b)("It's just you at the moment, it will be even better with others.")),o.a.createElement(lc.a,{space:t}),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.a.createElement(K.a,{kind:"primary",onClick:n},a?Object(N.b)("Go to my first room"):Object(N.b)("Go to my space"))))},xc=({space:e,justCreatedOpts:t,onFinished:n})=>{var a;return o.a.createElement("div",{className:"mx_SpaceRoomView_privateScope"},o.a.createElement("h1",null,Object(N.b)("Who are you working with?")),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.b)("Make sure the right people have access to %(name)s",{name:(null==t||null===(a=t.createOpts)||void 0===a?void 0:a.name)||e.name})),o.a.createElement(K.a,{className:"mx_SpaceRoomView_privateScope_justMeButton",onClick:()=>{n(!1)}},Object(N.b)("Just me"),o.a.createElement("div",null,Object(N.b)("A private space to organise your rooms"))),o.a.createElement(K.a,{className:"mx_SpaceRoomView_privateScope_meAndMyTeammatesButton",onClick:()=>{n(!0)}},Object(N.b)("Me and my teammates"),o.a.createElement("div",null,Object(N.b)("A private space for you and your teammates"))))},kc=Object(ni.a)({rules:[{key:"email",test:({value:e})=>!e||rc.a(e),invalid:()=>Object(N.b)("Doesn't look like a valid email address")}]}),Rc=({space:e,onFinished:t})=>{const[n,a]=Object(r.useState)(!1),[i,s]=Object(r.useState)(""),l=[Object(r.useRef)(),Object(r.useRef)(),Object(r.useRef)()],[c,d]=oc(3,""),u=new Array(3).fill(0).map(((e,t)=>{const a="emailAddress"+t;return o.a.createElement(at.a,{key:a,name:a,type:"text",label:Object(N.b)("Email address"),placeholder:Object(N.b)("Email"),value:c[t],onChange:e=>d(t,e.target.value),ref:l[t],onValidate:kc,autoFocus:0===t,disabled:n})})),m=async i=>{if(i.preventDefault(),n)return;s("");for(const e of l){var r;if(!1===await(null===(r=e.current)||void 0===r?void 0:r.validate({allowEmpty:!0})))return e.current.focus(),void e.current.validate({allowEmpty:!0,focused:!0})}a(!0);const o=c.map((e=>e.trim())).filter(Boolean);try{const n=await Object(Yi.a)(e.client,e.roomId,o),a=Object.keys(n.states).filter((e=>"error"===n.states[e]));a.length>0?(on.a.log("Failed to invite users to space: ",n),s(Object(N.b)("Failed to invite the following users to your space: %(csvUsers)s",{csvUsers:a.join(", ")}))):t()}catch(e){on.a.error("Failed to invite users to space: ",e),s(Object(N.b)("We couldn't invite those users. Please check the users you want to invite and try again."))}a(!1)};let h=e=>{e.preventDefault(),t()},p=Object(N.b)("Skip for now");return c.some((e=>e.trim()))&&(h=m,p=n?Object(N.b)("Inviting…"):Object(N.b)("Continue")),o.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates"},o.a.createElement("h1",null,Object(N.b)("Invite your teammates")),o.a.createElement("div",{className:"mx_SpaceRoomView_description"},Object(N.b)("Make sure the right people have access. You can invite more later.")),i&&o.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},i),o.a.createElement("form",{onSubmit:h,id:"mx_SpaceSetupPrivateInvite"},u),o.a.createElement("div",{className:"mx_SpaceRoomView_inviteTeammates_buttons"},o.a.createElement(K.a,{className:"mx_SpaceRoomView_inviteTeammates_inviteDialogButton",onClick:()=>Object(Yi.e)(e.roomId)},Object(N.b)("Invite by username"))),o.a.createElement("div",{className:"mx_SpaceRoomView_buttons"},o.a.createElement(K.a,{kind:"primary",disabled:n,onClick:h,element:"input",type:"submit",form:"mx_SpaceSetupPrivateInvite",value:p})))};class jc extends o.a.PureComponent{constructor(e,t){var n;super(e,t),i()(this,"context",void 0),i()(this,"dispatcherRef",void 0),i()(this,"onMyMembership",((e,t)=>{e.roomId===this.props.space.roomId&&this.setState({myMembership:t})})),i()(this,"onRightPanelStoreUpdate",(()=>{this.setState({showRightPanel:fn.a.instance.isOpenForRoom(this.props.space.roomId)})})),i()(this,"onAction",(e=>{if(e.action!==F.a.ViewRoom||e.room_id!==this.props.space.roomId){if(e.action===F.a.ViewUser||"view_3pid_invite"===e.action)if(e.action===F.a.ViewUser&&e.member){const t={phase:vn.a.SpaceMemberInfo,state:{spaceId:this.props.space.roomId,member:e.member}};e.push?fn.a.instance.pushCard(t):fn.a.instance.setCards([{phase:vn.a.SpaceMemberList,state:{spaceId:this.props.space.roomId}},t])}else"view_3pid_invite"===e.action&&e.event?fn.a.instance.setCard({phase:vn.a.Space3pidMemberInfo,state:{spaceId:this.props.space.roomId,memberInfoEvent:e.event}}):fn.a.instance.setCard({phase:vn.a.SpaceMemberList,state:{spaceId:this.props.space.roomId}})}else this.setState({phase:Ec.Landing})})),i()(this,"goToFirstRoom",(async()=>{this.state.firstRoomId?b.a.dispatch({action:F.a.ViewRoom,room_id:this.state.firstRoomId,metricsTrigger:void 0}):this.setState({phase:Ec.Landing})}));let a=Ec.Landing;const r=null===(n=this.props.space.currentState.getStateEvents(l.EventType.RoomCreate,""))||void 0===n?void 0:n.getSender();var o;this.props.justCreatedOpts&&t.getSafeUserId()===r&&(a=(null===(o=this.props.justCreatedOpts.createOpts)||void 0===o?void 0:o.preset)===l.Preset.PublicChat?Ec.PublicCreateRooms:Ec.PrivateScope);this.state={phase:a,showRightPanel:fn.a.instance.isOpenForRoom(this.props.space.roomId),myMembership:this.props.space.getMyMembership()},this.dispatcherRef=b.a.register(this.onAction),fn.a.instance.on(ft.b,this.onRightPanelStoreUpdate)}componentDidMount(){this.context.on(l.RoomEvent.MyMembership,this.onMyMembership)}componentWillUnmount(){b.a.unregister(this.dispatcherRef),fn.a.instance.off(ft.b,this.onRightPanelStoreUpdate),this.context.off(l.RoomEvent.MyMembership,this.onMyMembership)}renderBody(){var e,t;switch(this.state.phase){case Ec.Landing:return"join"===this.state.myMembership?o.a.createElement(Sc,{space:this.props.space}):o.a.createElement(ss,{room:this.props.space,onJoinButtonClicked:this.props.onJoinButtonClicked,onRejectButtonClicked:this.props.onRejectButtonClicked});case Ec.PublicCreateRooms:return o.a.createElement(_c,{space:this.props.space,title:Object(N.b)("What are some things you want to discuss in %(spaceName)s?",{spaceName:(null===(e=this.props.justCreatedOpts)||void 0===e||null===(t=e.createOpts)||void 0===t?void 0:t.name)||this.props.space.name}),description:o.a.createElement(o.a.Fragment,null,Object(N.b)("Let's create a room for each of them."),o.a.createElement("br",null),Object(N.b)("You can add more later too, including already existing ones.")),onFinished:e=>this.setState({phase:Ec.PublicShare,firstRoomId:e})});case Ec.PublicShare:return o.a.createElement(Oc,{justCreatedOpts:this.props.justCreatedOpts,space:this.props.space,onFinished:this.goToFirstRoom,firstRoomId:this.state.firstRoomId});case Ec.PrivateScope:return o.a.createElement(xc,{space:this.props.space,justCreatedOpts:this.props.justCreatedOpts,onFinished:e=>{this.setState({phase:e?Ec.PrivateCreateRooms:Ec.PrivateExistingRooms})}});case Ec.PrivateInvite:return o.a.createElement(Rc,{space:this.props.space,onFinished:()=>this.setState({phase:Ec.Landing})});case Ec.PrivateCreateRooms:return o.a.createElement(_c,{space:this.props.space,title:Object(N.b)("What projects are your team working on?"),description:o.a.createElement(o.a.Fragment,null,Object(N.b)("We'll create rooms for each of them."),o.a.createElement("br",null),Object(N.b)("You can add more later too, including already existing ones.")),onFinished:e=>this.setState({phase:Ec.PrivateInvite,firstRoomId:e})});case Ec.PrivateExistingRooms:return o.a.createElement(Cc,{space:this.props.space,onFinished:()=>this.setState({phase:Ec.Landing})})}}render(){const e=this.state.showRightPanel&&this.state.phase===Ec.Landing?o.a.createElement(Lo,{room:this.props.space,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.props.permalinkCreator}):void 0;return o.a.createElement("main",{className:"mx_SpaceRoomView"},o.a.createElement(Wo.a,null,o.a.createElement(bn,{panel:e,resizeNotifier:this.props.resizeNotifier},this.renderBody())))}}i()(jc,"contextType",I.a);var Ic=n(723);class Tc extends o.a.PureComponent{render(){return o.a.createElement("div",{className:"mx_TopUnreadMessagesBar"},o.a.createElement(K.a,{className:"mx_TopUnreadMessagesBar_scrollUp",title:Object(N.b)("Jump to first unread message."),onClick:this.props.onScrollUpClick}),o.a.createElement(K.a,{className:"mx_TopUnreadMessagesBar_markAsRead",title:Object(N.b)("Mark all as read"),onClick:this.props.onCloseClick}))}}var Pc=n(97),Nc=n(174),Dc=n(159),Mc=n(1364),Ac=n(797),Lc=n(725);const Uc=({text:e})=>o.a.createElement("div",{className:"mx_LargeLoader"},o.a.createElement(Ma.a,{w:45,h:45}),o.a.createElement("div",{className:"mx_LargeLoader_text"},e));var Fc=n(653),Bc=n(1320);class Vc extends o.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"callEventGroupers",new Map),this.buildLegacyCallEventGroupers(this.props.timeline)}buildLegacyCallEventGroupers(e){this.callEventGroupers=Object(gr.b)(this.callEventGroupers,e)}render(){const e=this.props.timeline,t=e[this.props.ourEventsIndexes[0]],n=t.getId(),a=t.getTs(),i=[o.a.createElement(Fc.a,{key:a+"-search",roomId:t.getRoomId(),ts:a})],r=v.b.getValue("layout"),s=v.b.getValue("showTwelveHourTimestamps"),l=v.b.getValue("alwaysShowTimestamps"),c=tt.a.safeGet();for(let t=0;t<e.length;t++){var d;const a=e[t];let h;const p=!this.props.ourEventsIndexes.includes(t);if(p||(h=this.props.searchHighlights),Object(ri.c)(a,c,null===(d=this.context)||void 0===d?void 0:d.showHiddenEvents)){var u;const d=e[t-1],g=d&&!Object(Va.p)(d.getDate()||void 0,a.getDate()||void 0)&&Object(pr.b)(d,a,c,null===(u=this.context)||void 0===u?void 0:u.showHiddenEvents,In.a.Search);let b=!0;const v=e[t+1];if(v){var m;b=Object(Va.p)(a.getDate()||void 0,v.getDate()||void 0)||a.getSender()!==v.getSender()||!Object(pr.b)(a,v,c,null===(m=this.context)||void 0===m?void 0:m.showHiddenEvents,In.a.Search)}i.push(o.a.createElement(Bc.b,{key:`${n}+${t}`,mxEvent:a,layout:r,contextual:p,highlights:h,permalinkCreator:this.props.permalinkCreator,highlightLink:this.props.resultLink,onHeightChanged:this.props.onHeightChanged,isTwelveHour:s,alwaysShowTimestamps:l,lastInSection:b,continuation:g,callEventGrouper:this.callEventGroupers.get(a.getContent().call_id)}))}}return o.a.createElement("li",{"data-scroll-tokens":n},o.a.createElement("ol",null,i))}}i()(Vc,"contextType",In.b);var Wc=n(434),zc=n(273);const Hc=10;async function Gc(e,t,n,a){const i={limit:Hc};void 0!==n&&(i.rooms=[n]);const r={search_categories:{room_events:{search_term:t,filter:i,order_by:Wc.a.Recent,event_context:{before_limit:1,after_limit:1,include_profile:!0}}}};return{response:await e.search({body:r},a),query:r}}async function Kc(e,t,n,a){const i=await Gc(e,t,n,a),r={abortSignal:a,_query:i.query,results:[],highlights:[]};return e.processRoomEventsSearch(r,i.response)}function qc(e,t){const n=e.result,a=t.result;return n.origin_server_ts>a.origin_server_ts?-1:n.origin_server_ts<a.origin_server_ts?1:0}async function $c(e,t,n=!0){const a=sr.a.get(),i={search_term:e,before_limit:1,after_limit:1,limit:Hc,order_by_recency:!0,room_id:void 0};void 0!==t&&(i.room_id=t);const r=await a.search(i);if(!r)throw new Error("Local search failed");i.next_batch=r.next_batch;return{response:r,query:i}}function Yc(e,t){try{const n=e[e.length-1].result,a=t[t.length-1].result;return n.origin_server_ts<=a.origin_server_ts?-1:1}catch{return 0}}function Jc(e,t,n,a){const i=n.concat(a).sort(qc);t.results=i.slice(0,Hc),e.cachedEvents=i.slice(Hc)}function Qc(e,t,n){var a;const i=function(e,t,n){var a;const i={},r=null!==(a=e.cachedEvents)&&void 0!==a?a:[];let o=e.oldestEventFrom;return i.highlights=e.highlights,t&&n&&n.results?(Yc(t.results,n.results)<0&&(o="local"),Jc(e,i,t.results,n.results),i.highlights=t.highlights.concat(n.highlights)):t?(Yc(t.results,r)<0&&(o="local"),Jc(e,i,t.results,r)):n&&n.results?(Yc(n.results,r)<0&&(o="server"),Jc(e,i,n.results,r)):(i.results=r,e.cachedEvents=[]),e.oldestEventFrom=o,i}(e,t,n);if(e.count)i.count=e.count;else{var r,o;const e=null!==(r=null==t?void 0:t.count)&&void 0!==r?r:0,a=null!==(o=null==n?void 0:n.count)&&void 0!==o?o:0;i.count=e+a}return t&&Object(zc.b)(e.seshatQuery)&&(e.seshatQuery.next_batch=t.next_batch),n&&(e.serverSideNextBatch=n.next_batch),null!==(a=e.seshatQuery)&&void 0!==a&&a.next_batch?i.next_batch=e.seshatQuery.next_batch:e.serverSideNextBatch&&(i.next_batch=e.serverSideNextBatch),!i.next_batch&&Object(zc.b)(e.cachedEvents)&&e.cachedEvents.length>0&&(i.next_batch="cached"),i}function Xc(e=[]){for(const t of e){const e=t.context.getTimeline();for(const t of e){const e=t.event;e.curve25519Key&&(t.makeEncrypted(l.EventType.RoomMessageEncrypted,{algorithm:e.algorithm},e.curve25519Key,e.ed25519Key),t.forwardingCurve25519KeyChain=e.forwardingCurve25519KeyChain,delete e.curve25519Key,delete e.ed25519Key,delete e.algorithm,delete e.forwardingCurve25519KeyChain)}}}function Zc(e,t,n,a){let i;return i=void 0!==n?e.isRoomEncrypted(n)?async function(e,t,n){const a={results:[],highlights:[]};if(""===t)return a;const i=await $c(t,n);a.seshatQuery=i.query;const r={search_categories:{room_events:i.response}},o=e.processRoomEventsSearch(a,r);return Xc(o.results),o}(e,t,n):Kc(e,t,n,a):async function(e,t,n){const a=Gc(e,t,void 0,n),i=$c(t);await Promise.all([a,i]);const r=await i,o=await a,s=o.query,l=o.response,c=r.query,d=r.response,u={seshatQuery:c,_query:s,serverSideNextBatch:l.search_categories.room_events.next_batch,cachedEvents:[],oldestEventFrom:"server",results:[],highlights:[]},m={search_categories:{room_events:Qc(u,d,l.search_categories.room_events)}},h=e.processRoomEventsSearch(u,m);return Xc(h.results),h}(e,t,a),i}function ed(e,t){const n=t.seshatQuery,a=t._query;if(n){if(a){const n=async function(e,t){var n;const a=sr.a.get(),i=t.seshatQuery,r=t.oldestEventFrom;let o,s;if(null==i||!i.next_batch||t.serverSideNextBatch&&"server"!==r||(o=await a.search(i)),t.serverSideNextBatch&&("local"===r||null==i||!i.next_batch)){const n={body:t._query,next_batch:t.serverSideNextBatch};s=await e.search(n)}const l={search_categories:{room_events:Qc(t,o,null===(n=s)||void 0===n?void 0:n.search_categories.room_events)}},c=t.results?t.results.length:0,d=e.processRoomEventsSearch(t,l),u=d.results.length-c;return Xc(d.results.slice(Math.max(d.results.length-u,0))),t.pendingRequest=void 0,d}(e,t);return t.pendingRequest=n,n}{const n=async function(e,t){const n=sr.a.get();if(!t.seshatQuery)throw new Error("localSearchProcess must be called first");const a=await n.search(t.seshatQuery);if(!a)throw new Error("Local search pagination failed");t.seshatQuery.next_batch=a.next_batch;const i=a.results.length,r={search_categories:{room_events:a}},o=e.processRoomEventsSearch(t,r);return Xc(o.results.slice(Math.max(o.results.length-i,0))),t.pendingRequest=void 0,o}(e,t);return t.pendingRequest=n,n}}return e.backPaginateRoomEventsSearch(t)}function td(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}let nd=function(e){};const ad=Object(r.forwardRef)((({term:e,scope:t,promise:n,abortController:a,resizeNotifier:s,className:l,onUpdate:c},d)=>{const u=Object(r.useContext)(I.a),m=Object(r.useContext)(In.b),[h,p]=Object(r.useState)(!0),[g,b]=Object(r.useState)(null),[v,f]=Object(r.useState)(null),y=Object(r.useRef)(!1),E=Object(r.useRef)(new Map).current,w=Object(r.useRef)();Object(r.useEffect)((()=>()=>{E.forEach((e=>e.stop())),E.clear()}),[E]);const S=Object(r.useCallback)((t=>(p(!0),t.then((async t=>{if(nd("search complete"),y.current)return on.a.error("Discarding stale search results"),!1;let n=t.highlights;n.includes(e)||(n=n.concat(e)),n=n.sort((function(e,t){return t.length-e.length}));for(const e of t.results)for(const t of e.context.getTimeline()){if(!t.getServerAggregatedRelation(dn.d.name)||t.getThread())continue;const e=u.getRoom(t.getRoomId()),n=null==e?void 0:e.findThreadForEvent(t);n?t.setThread(n):null==e||e.createThread(t.getId(),t,[],!0)}return b(n),f(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?td(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):td(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t)),!1}),(e=>{var t;return y.current?(on.a.error("Discarding stale search results"),!1):(on.a.error("Search failed",e),H.b.createDialog(Dn.a,{title:Object(N.b)("Search failed"),description:null!==(t=null==e?void 0:e.message)&&void 0!==t?t:Object(N.b)("Server may be unavailable, overloaded, or search timed out :(")}),!1)})).finally((()=>{p(!1)})))),[u,e]);if(Object(r.useEffect)((()=>(y.current=!1,S(n),()=>{y.current=!0,null==a||a.abort()})),[]),void 0===(null==v?void 0:v.count))return o.a.createElement("div",{className:"mx_RoomView_messagePanel mx_RoomView_messagePanelSearchSpinner","data-testid":"messagePanelSearchSpinner"});const _=[];var C;(h&&_.push(o.a.createElement("li",{key:"search-spinner"},o.a.createElement(Ma.a,null))),v.next_batch)||(null!=v&&null!==(C=v.results)&&void 0!==C&&C.length?_.push(o.a.createElement("li",{key:"search-top-marker"},o.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(N.b)("No more results")))):_.push(o.a.createElement("li",{key:"search-top-marker"},o.a.createElement("h2",{className:"mx_RoomView_topMarker"},Object(N.b)("No results")))));const O=()=>{var e;null===(e=w.current)||void 0===e||e.checkScroll()};let x,k=[],R=[];for(let e=((null==v||null===(j=v.results)||void 0===j?void 0:j.length)||0)-1;e>=0;e--){var j;const n=v.results[e],a=n.context.getEvent(),i=a.getRoomId(),r=u.getRoom(i);if(!r){on.a.log("Hiding search result from an unknown room",i);continue}if(!Object(ri.c)(a,u,m.showHiddenEvents))continue;t===ls.All&&i!==x&&(_.push(o.a.createElement("li",{key:a.getId()+"-room"},o.a.createElement("h2",null,Object(N.b)("Room"),": ",r.name))),x=i);const s="#/room/"+i+"/"+a.getId(),l=n.context.getTimeline(),c=e>0?v.results[e-1].context.getTimeline():[];if(e>0&&l[l.length-1].getId()==c[0].getId()){if(0==k.length){for(let e=0==k.length?0:1;e<n.context.getTimeline().length;e++)k.push(l[e]);R.push(n.context.getOurEventIndex())}for(let e=1;e<c.length;e++)k.push(c[e]);R.push(R[R.length-1]+v.results[e-1].context.getOurEventIndex()+1);continue}0==k.length&&(k=n.context.getTimeline(),R=[],R.push(n.context.getOurEventIndex()));let d=E.get(i);d||(d=new mn.a(r),d.start(),E.set(i,d)),_.push(o.a.createElement(Vc,{key:a.getId(),timeline:k,ourEventsIndexes:R,searchHighlights:null!=g?g:[],resultLink:s,permalinkCreator:d,onHeightChanged:O})),R=[],k=[]}return o.a.createElement(Vo.a,{ref:e=>{"function"==typeof d?d(e):d&&(d.current=e),w.current=e},className:"mx_RoomView_searchResultsPanel "+l,onFillRequest:async e=>{if(!e)return!1;if(!v.next_batch)return nd("no more search results"),!1;nd("requesting more search results");const t=function(e,t){const n=sr.a.get();return t.pendingRequest?t.pendingRequest:null===n?e.backPaginateRoomEventsSearch(t):ed(e,t)}(u,v);return S(t)},resizeNotifier:s},o.a.createElement("li",{className:"mx_RoomView_scrollheader"}),_)}));var id=n(244),rd=n(1418),od=n(163);const sd=({roomView:e,resizeNotifier:t,inviteEvent:n})=>{const a=Object(In.c)(),i=it.b.get().brand;return o.a.createElement("div",{className:"mx_RoomView mx_RoomView--local"},o.a.createElement(Wo.a,null,v.b.getValue("feature_new_room_decoration_ui")?o.a.createElement($l,{room:a.room}):o.a.createElement(Nl,{room:a.room,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:jn.a.Normal,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),o.a.createElement("main",{className:"mx_RoomView_body",ref:e},o.a.createElement("div",{className:"mx_RoomView_timeline"},o.a.createElement(Vo.a,{className:"mx_RoomView_messagePanel",resizeNotifier:t},o.a.createElement(od.a,{className:"mx_cryptoEvent mx_cryptoEvent_icon",title:Object(N.b)("Waiting for users to join %(brand)s",{brand:i}),subtitle:Object(N.b)("Once invited users have joined %(brand)s, you will be able to chat and the room will be end-to-end encrypted",{brand:i})}),o.a.createElement(Mc.a,null),o.a.createElement(Bc.a,{mxEvent:n}))))))},ld=["upgradeRecommendation"],cd=["upgradeRecommendation"];function dd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ud(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?dd(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}let md=function(e){};const hd="sandbox"in document.createElement("iframe");var pd=function(e){return e[e.Timeline=0]="Timeline",e[e.MaximisedWidget=1]="MaximisedWidget",e[e.Call=2]="Call",e}(pd||{});function gd(e){const t=Object(r.useContext)(In.b),n=t.room,a=e.localRoom.currentState.getStateEvents(l.EventType.RoomEncryption)[0];let i;a&&(i=o.a.createElement(Ac.a,{mxEvent:a}));const s=()=>{n.state=Nc.c.NEW,b.b.dispatch({action:"local_room_event",roomId:n.roomId})};let c=null,d=null;if(n.isError){const e=o.a.createElement(K.a,{onClick:s,className:"mx_RoomStatusBar_unsentRetry"},Object(N.b)("Retry"));c=o.a.createElement(Lc.a,{title:Object(N.b)("Some of your messages have not been sent"),notificationState:_e.a.RED_EXCLAMATION,buttons:e})}else d=o.a.createElement(so,{room:e.localRoom,resizeNotifier:e.resizeNotifier,permalinkCreator:e.permalinkCreator});return o.a.createElement("div",{className:"mx_RoomView mx_RoomView--local"},o.a.createElement(Wo.a,null,v.b.getValue("feature_new_room_decoration_ui")?o.a.createElement($l,{room:n}):o.a.createElement(Nl,{room:t.room,searchInfo:void 0,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:n.encrypted?jn.a.Normal:void 0,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),o.a.createElement("main",{className:"mx_RoomView_body",ref:e.roomView},o.a.createElement(bo,{parent:e.roomView.current,onFileDrop:e.onFileDrop}),o.a.createElement("div",{className:"mx_RoomView_timeline"},o.a.createElement(Vo.a,{className:"mx_RoomView_messagePanel",resizeNotifier:e.resizeNotifier},i,o.a.createElement(Mc.a,null))),c,d)))}function bd(e){const t=Object(N.b)("We're creating a room with %(names)s",{names:e.names});return o.a.createElement("div",{className:"mx_RoomView mx_RoomView--local"},o.a.createElement(Wo.a,null,v.b.getValue("feature_new_room_decoration_ui")?o.a.createElement($l,{room:e.localRoom}):o.a.createElement(Nl,{room:e.localRoom,searchInfo:void 0,inRoom:!0,onSearchClick:null,onInviteClick:null,onForgetClick:null,e2eStatus:e.localRoom.encrypted?jn.a.Normal:void 0,onAppsClick:null,appsShown:!1,excludedRightPanelPhaseButtons:[],showButtons:!1,enableRoomOptionsMenu:!1,viewingCall:!1,activeCall:null}),o.a.createElement("div",{className:"mx_RoomView_body"},o.a.createElement(Uc,{text:t}))))}class vd extends o.a.Component{constructor(e,t){var n;if(super(e,t),i()(this,"askToJoinEnabled",void 0),i()(this,"dispatcherRef",void 0),i()(this,"settingWatchers",void 0),i()(this,"unmounted",!1),i()(this,"permalinkCreators",{}),i()(this,"roomView",Object(r.createRef)()),i()(this,"searchResultsPanel",Object(r.createRef)()),i()(this,"messagePanel",null),i()(this,"roomViewBody",Object(r.createRef)()),i()(this,"context",void 0),i()(this,"onIsResizing",(e=>{this.setState({resizing:e})})),i()(this,"onWidgetStoreUpdate",(()=>{this.state.room&&(this.checkWidgets(this.state.room),this.doMaybeRemoveOwnJitsiWidget())})),i()(this,"onWidgetEchoStoreUpdate",(()=>{this.state.room&&this.checkWidgets(this.state.room)})),i()(this,"onWidgetLayoutChange",(()=>{this.state.room&&(b.a.dispatch({action:"appsDrawer",show:!0}),this.context.widgetLayoutStore.hasMaximisedWidget(this.state.room)&&this.context.rightPanelStore.setCard({phase:vn.a.Timeline}),this.checkWidgets(this.state.room))})),i()(this,"checkWidgets",(e=>{this.setState({hasPinnedWidgets:this.context.widgetLayoutStore.hasPinnedWidgets(e),mainSplitContentType:this.getMainSplitContentType(e),showApps:this.shouldShowApps(e)})})),i()(this,"getMainSplitContentType",(e=>v.b.getValue("feature_group_calls")&&this.context.roomViewStore.isViewingCall()||wl(e)?pd.Call:this.context.widgetLayoutStore.hasMaximisedWidget(e)?pd.MaximisedWidget:pd.Timeline)),i()(this,"onRoomViewStoreUpdate",(async e=>{var t,n,a,i,r,o;if(this.unmounted)return;const s=null!==(t=this.context.roomViewStore.getRoomLoadError())&&void 0!==t?t:void 0;if(!e&&!s&&this.state.roomId!==this.context.roomViewStore.getRoomId())return;const l=null!==(n=this.context.roomViewStore.getRoomId())&&void 0!==n?n:null,c=null!==(a=null===(i=this.context.client)||void 0===i?void 0:i.getRoom(null!=l?l:void 0))&&void 0!==a?a:void 0,d={roomId:null!=l?l:void 0,roomAlias:null!==(r=this.context.roomViewStore.getRoomAlias())&&void 0!==r?r:void 0,roomLoading:this.context.roomViewStore.isRoomLoading(),roomLoadError:s,joining:this.context.roomViewStore.isJoining(),replyToEvent:null!==(o=this.context.roomViewStore.getQuotingEvent())&&void 0!==o?o:void 0,shouldPeek:this.state.matrixClientIsReady&&this.context.roomViewStore.shouldPeek(),showReadReceipts:v.b.getValue("showReadReceipts",l),showRedactions:v.b.getValue("showRedactions",l),showJoinLeaves:v.b.getValue("showJoinLeaves",l),showAvatarChanges:v.b.getValue("showAvatarChanges",l),showDisplaynameChanges:v.b.getValue("showDisplaynameChanges",l),wasContextSwitch:this.context.roomViewStore.getWasContextSwitch(),mainSplitContentType:c?this.getMainSplitContentType(c):void 0,initialEventId:void 0,showRightPanel:!!l&&this.context.rightPanelStore.isOpenForRoom(l),threadRightPanel:!!l&&[vn.a.ThreadView,vn.a.ThreadPanel].includes(this.context.rightPanelStore.currentCardForRoom(l).phase),activeCall:l?Jl.a.instance.getActiveCall(l):null,promptAskToJoin:this.context.roomViewStore.promptAskToJoin(),knocked:this.context.roomViewStore.knocked()};var u;this.state.mainSplitContentType!==pd.Timeline&&d.mainSplitContentType===pd.Timeline&&this.context.rightPanelStore.isOpen&&this.context.rightPanelStore.currentCard.phase===vn.a.Timeline&&this.context.rightPanelStore.roomPhaseHistory.some((e=>e.phase===vn.a.Timeline))&&(this.context.rightPanelStore.setCard({phase:vn.a.RoomSummary}),this.context.rightPanelStore.togglePanel(null!==(u=this.state.roomId)&&void 0!==u?u:null),d.showRightPanel=!1);const m=this.context.roomViewStore.getInitialEventId();if(m){var h,p;let e=null==c?void 0:c.findEventById(m);var g;if(!e&&this.context.client&&l)e=null!==(g=await Object(Pc.f)(this.context.client,l,m))&&void 0!==g?g:void 0;d.initialEventPixelOffset=void 0;const t=null===(h=e)||void 0===h?void 0:h.getThread();var f;if(null==t||!t.rootEvent||null!==(p=e)&&void 0!==p&&p.isThreadRoot)d.initialEventId=m,d.isInitialEventHighlighted=this.context.roomViewStore.isInitialEventHighlighted(),d.initialEventScrollIntoView=this.context.roomViewStore.initialEventScrollIntoView(),null!=t&&t.rootEvent&&null!==(f=e)&&void 0!==f&&f.isThreadRoot&&b.a.dispatch({action:F.a.ShowThread,rootEvent:t.rootEvent,initialEvent:e,highlighted:this.context.roomViewStore.isInitialEventHighlighted(),scroll_into_view:this.context.roomViewStore.initialEventScrollIntoView()});else b.a.dispatch({action:F.a.ShowThread,rootEvent:t.rootEvent,initialEvent:e,highlighted:this.context.roomViewStore.isInitialEventHighlighted(),scroll_into_view:this.context.roomViewStore.initialEventScrollIntoView()})}var y,E,w;(this.settingWatchers=this.settingWatchers.concat([v.b.watchSetting("showReadReceipts",l,((...[,,,e])=>this.setState({showReadReceipts:e}))),v.b.watchSetting("showRedactions",l,((...[,,,e])=>this.setState({showRedactions:e}))),v.b.watchSetting("showJoinLeaves",l,((...[,,,e])=>this.setState({showJoinLeaves:e}))),v.b.watchSetting("showAvatarChanges",l,((...[,,,e])=>this.setState({showAvatarChanges:e}))),v.b.watchSetting("showDisplaynameChanges",l,((...[,,,e])=>this.setState({showDisplaynameChanges:e})))]),e||!this.state.shouldPeek||d.shouldPeek)||(null===(y=this.context.client)||void 0===y||y.stopPeeking());if(on.a.log("RVS update:",d.roomId,d.roomAlias,"loading?",d.roomLoading,"joining?",d.joining,"initial?",e,"shouldPeek?",d.shouldPeek),e&&(d.room=this.context.client.getRoom(d.roomId)||void 0,d.room&&(d.showApps=this.shouldShowApps(d.room),this.onRoomLoaded(d.room))),void 0===this.state.roomId&&void 0!==d.roomId&&!d.initialEventId&&d.roomId){const e=Fo.getScrollState(d.roomId);e&&(d.initialEventId=e.focussedEvent,d.initialEventPixelOffset=e.pixelOffset)}this.state.timelineRenderingType===In.a.Search&&this.state.initialEventId!==d.initialEventId&&(d.timelineRenderingType=In.a.Room,null===(E=this.state.search)||void 0===E||null===(w=E.abortController)||void 0===w||w.abort(),d.search=void 0);this.setState(d),e&&this.setupRoom(d.room,d.roomId,!!d.joining,!!d.shouldPeek)})),i()(this,"onActiveCalls",(()=>{if(void 0===this.state.roomId)return;const e=Jl.a.instance.getActiveCall(this.state.roomId);null===e&&b.a.dispatch({action:F.a.ViewRoom,room_id:this.state.roomId,view_call:!1,metricsTrigger:void 0},!0),this.setState({activeCall:e})})),i()(this,"getRoomId",(()=>{var e,t;return null!==(e=null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&void 0!==e?e:this.state.roomId})),i()(this,"onRightPanelStoreUpdate",(()=>{const{roomId:e}=this.state;this.setState({showRightPanel:!!e&&this.context.rightPanelStore.isOpenForRoom(e),threadRightPanel:!!e&&[vn.a.ThreadView,vn.a.ThreadPanel].includes(this.context.rightPanelStore.currentCardForRoom(e).phase)})})),i()(this,"onPageUnload",(e=>hn.a.sharedInstance().getCurrentUploads().length>0?e.returnValue=Object(N.b)("You seem to be uploading files, are you sure you want to quit?"):this.getCallForRoom()&&"ended"!==this.state.callState?e.returnValue=Object(N.b)("You seem to be in a call, are you sure you want to quit?"):void 0)),i()(this,"onReactKeyDown",(e=>{var t;let n=!1;switch(Object(Q.a)().getRoomAction(e)){case z.h.DismissReadMarker:null===(t=this.messagePanel)||void 0===t||t.forgetReadMarker(),this.jumpToLiveTimeline(),n=!0;break;case z.h.JumpToOldestUnread:this.jumpToReadMarker(),n=!0;break;case z.h.UploadFile:b.a.dispatch({action:"upload_file",context:In.a.Room},!0),n=!0}n&&(e.stopPropagation(),e.preventDefault())})),i()(this,"onCallState",(e=>{if(!e)return;const t=this.getCallForRoom();this.setState({callState:null==t?void 0:t.state})})),i()(this,"onAction",(async e=>{var t;if(this.context.client)switch(e.action){case"message_sent":this.checkDesktopNotifications();break;case"post_sticker_message":this.injectSticker(e.data.content.url,e.data.content.info,e.data.description||e.data.name,e.data.threadId);break;case"picture_snapshot":{const t=this.getRoomId();Object(zc.b)(t)&&hn.a.sharedInstance().sendContentListToRoom([e.file],t,void 0,this.context.client);break}case"notifier_enabled":case F.a.UploadStarted:case F.a.UploadFinished:case F.a.UploadCanceled:this.forceUpdate();break;case"appsDrawer":this.setState({showApps:e.show});break;case"reply_to_event":!this.unmounted&&this.state.search&&(null===(t=e.event)||void 0===t?void 0:t.getRoomId())===this.state.roomId&&e.context===In.a.Search&&this.onCancelSearchClick();break;case"MatrixActions.sync":var n;if(!this.state.matrixClientIsReady)this.setState({matrixClientIsReady:!(null===(n=this.context.client)||void 0===n||!n.isInitialSyncComplete())},(()=>{this.onRoomViewStoreUpdate(!0)}));break;case"focus_search":this.onSearchClick();break;case"local_room_event":this.onLocalRoomEvent(e.roomId);break;case F.a.EditEvent:{if(e.timelineRenderingType!==this.state.timelineRenderingType)return;const t=e.event?new lo(e.event):void 0;this.setState({editState:t},(()=>{var t;e.event&&(null===(t=this.messagePanel)||void 0===t||t.scrollToEventIfNeeded(e.event.getId()))}));break}case F.a.ComposerInsert:{if(e.composerType)break;let t=e.timelineRenderingType;if(t===In.a.Thread)break;this.state.timelineRenderingType===In.a.Search&&e.timelineRenderingType===In.a.Search&&(await this.onCancelSearchClick(),t=In.a.Room),b.a.dispatch(ud(ud({},e),{},{timelineRenderingType:t,composerType:this.state.editState?vo.a.Edit:vo.a.Send}));break}case F.a.FocusAComposer:b.a.dispatch(ud(ud({},e),{},{action:this.state.editState?F.a.FocusEditMessageComposer:F.a.FocusSendMessageComposer}));break;case"scroll_to_bottom":var a;if(e.timelineRenderingType===In.a.Room)null===(a=this.messagePanel)||void 0===a||a.jumpToLiveTimeline()}})),i()(this,"onRoomTimeline",((e,t,n,a,i)=>{var r;this.unmounted||t&&t.roomId===(null===(r=this.state.room)||void 0===r?void 0:r.roomId)&&i.timeline.getTimelineSet()===t.getUnfilteredTimelineSet()&&("org.matrix.room.preview_urls"===e.getType()&&this.updatePreviewUrlVisibility(t),"m.room.encryption"===e.getType()&&(this.updateE2EStatus(t),this.updatePreviewUrlVisibility(t)),!n&&null!=i&&i.liveEvent&&(this.state.joining||(e.isBeingDecrypted()||e.isDecryptionFailure()||this.handleEffects(e),this.context.client&&e.getSender()!==this.context.client.getSafeUserId()&&(!this.state.search&&this.state.atEndOfLiveTimeline||Object(un.a)(e,this.state)||this.setState((e=>({numUnreadMessages:e.numUnreadMessages+1})))))))})),i()(this,"onEventDecrypted",(e=>{this.state.room&&this.state.matrixClientIsReady&&e.getRoomId()===this.state.room.roomId&&(e.isDecryptionFailure()||this.handleEffects(e))})),i()(this,"handleEffects",(e=>{if(!this.state.room)return;this.context.roomNotificationStateStore.getRoomState(this.state.room).isUnread&&ta.CHAT_EFFECTS.forEach((t=>{(Object(na.containsEmoji)(e.getContent(),t.emojis)||e.getContent().msgtype===t.msgType)&&(e.isRelation(dn.d.name)||b.a.dispatch({action:`effects.${t.command}`}))}))})),i()(this,"onRoomName",(e=>{this.state.room&&e.roomId==this.state.room.roomId&&this.forceUpdate()})),i()(this,"onKeyBackupStatus",(()=>{this.forceUpdate()})),i()(this,"canResetTimeline",(()=>!this.messagePanel||this.messagePanel.canResetTimeline())),i()(this,"loadVirtualRoom",(async e=>{const t=(null==e?void 0:e.roomId)&&await id.a.sharedInstance().getVirtualRoomForRoom(null==e?void 0:e.roomId);this.setState({virtualRoom:t||void 0})})),i()(this,"onRoomLoaded",(e=>{this.unmounted||(this.context.widgetLayoutStore.on(An.d.emissionForRoom(e),this.onWidgetLayoutChange),this.calculatePeekRules(e),this.updatePreviewUrlVisibility(e),this.loadMembersIfJoined(e),this.calculateRecommendedVersion(e),this.updateE2EStatus(e),this.updatePermissions(e),this.checkWidgets(e),this.loadVirtualRoom(e),this.getMainSplitContentType(e)!==pd.Timeline&&this.context.roomNotificationStateStore.getRoomState(e).isUnread&&this.context.rightPanelStore.setCard({phase:vn.a.Timeline},!0,e.roomId),this.setState({tombstone:this.getRoomTombstone(e),liveTimeline:e.getLiveTimeline()}))})),i()(this,"onRoomTimelineReset",(e=>{var t;e&&e.roomId===(null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&e.getLiveTimeline()!==this.state.liveTimeline&&(on.a.log(`Live timeline of ${e.roomId} was reset`),this.setState({liveTimeline:e.getLiveTimeline()}))})),i()(this,"onRoom",(e=>{e&&e.roomId===this.state.roomId&&(this.state.room&&this.context.widgetLayoutStore.off(An.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),this.setState({room:e},(()=>{this.onRoomLoaded(e)})))})),i()(this,"onDeviceVerificationChanged",(e=>{const t=this.state.room;null!=t&&t.currentState.getMember(e)&&this.updateE2EStatus(t)})),i()(this,"onUserVerificationChanged",(e=>{const t=this.state.room;t&&t.currentState.getMember(e)&&this.updateE2EStatus(t)})),i()(this,"onCrossSigningKeysChanged",(()=>{const e=this.state.room;e&&this.updateE2EStatus(e)})),i()(this,"onUrlPreviewsEnabledChange",(()=>{this.state.room&&this.updatePreviewUrlVisibility(this.state.room)})),i()(this,"onRoomStateEvents",((e,t)=>{if(this.state.room&&this.state.room.roomId===t.roomId)if(e.getType()===l.EventType.RoomTombstone)this.setState({tombstone:this.getRoomTombstone()});else this.updatePermissions(this.state.room)})),i()(this,"onRoomStateUpdate",(e=>{var t;e.roomId===(null===(t=this.state.room)||void 0===t?void 0:t.roomId)&&this.updateRoomMembers()})),i()(this,"onMyMembership",(e=>{e.roomId===this.state.roomId&&(this.forceUpdate(),this.loadMembersIfJoined(e),this.updatePermissions(e))})),i()(this,"updateRoomMembers",Object(R.throttle)((()=>{this.state.room&&(this.updateDMState(),this.updateE2EStatus(this.state.room))}),500,{leading:!0,trailing:!0})),i()(this,"onInviteClick",(()=>{b.a.dispatch({action:"view_invite",roomId:this.getRoomId()})})),i()(this,"onJoinButtonClicked",(()=>{var e;null!==(e=this.context.client)&&void 0!==e&&e.isGuest()?(b.a.dispatch({action:F.a.DoAfterSyncPrepared,deferred_action:{action:F.a.ViewRoom,room_id:this.getRoomId(),metricsTrigger:void 0}}),b.a.dispatch({action:"require_registration"})):Promise.resolve().then((()=>{var e;const t=null===(e=this.props.threepidInvite)||void 0===e?void 0:e.signUrl,n=this.getRoomId();var a;Object(zc.b)(n)&&b.a.dispatch({action:F.a.JoinRoom,roomId:n,opts:{inviteSignUrl:t},metricsTrigger:"invite"===(null===(a=this.state.room)||void 0===a?void 0:a.getMyMembership())?"Invite":"RoomPreview",canAskToJoin:this.state.canAskToJoin});return Promise.resolve()}))})),i()(this,"onMessageListScroll",(()=>{var e;null!==(e=this.messagePanel)&&void 0!==e&&e.isAtEndOfLiveTimeline()?this.setState({numUnreadMessages:0,atEndOfLiveTimeline:!0}):this.setState({atEndOfLiveTimeline:!1}),this.updateTopUnreadMessagesBar()})),i()(this,"resetJumpToEvent",(e=>{this.state.initialEventId&&this.state.initialEventScrollIntoView&&this.state.initialEventId===e&&(md("Removing scroll_into_view flag from initial event"),b.a.dispatch({action:F.a.ViewRoom,room_id:this.getRoomId(),event_id:this.state.initialEventId,highlighted:this.state.isInitialEventHighlighted,scroll_into_view:!1,replyingToEvent:this.state.replyToEvent,metricsTrigger:void 0}))})),i()(this,"onSearch",((e,t)=>{const n=t===ls.Room?this.getRoomId():void 0;md("sending search request");const a=new AbortController,i=function(e,t,n,a){return null===sr.a.get()?Kc(e,t,n,a):Zc(e,t,n,a)}(this.context.client,e,n,a.signal);this.setState({search:{searchId:(new Date).getTime(),roomId:n,term:e,scope:t,promise:i,abortController:a}})})),i()(this,"onSearchUpdate",((e,t)=>{this.setState({search:ud(ud({},this.state.search),{},{count:null==t?void 0:t.count,inProgress:e})})})),i()(this,"onAppsClick",(()=>{b.a.dispatch({action:"appsDrawer",show:!this.state.showApps})})),i()(this,"onForgetClick",(()=>{b.a.dispatch({action:"forget_room",room_id:this.getRoomId()})})),i()(this,"onRejectButtonClicked",(()=>{var e;const t=this.getRoomId();t&&(this.setState({rejecting:!0}),null===(e=this.context.client)||void 0===e||e.leave(t).then((()=>{b.a.dispatch({action:F.a.ViewHomePage}),this.setState({rejecting:!1})}),(e=>{on.a.error(`Failed to reject invite: ${e}`);const t=e.message?e.message:JSON.stringify(e);H.b.createDialog(Dn.a,{title:Object(N.b)("Failed to reject invite"),description:t}),this.setState({rejecting:!1})})))})),i()(this,"onRejectAndIgnoreClick",(async()=>{this.setState({rejecting:!0});try{const e=this.state.room.getMember(this.context.client.getSafeUserId()).events.member,t=this.context.client.getIgnoredUsers();t.push(e.getSender()),await this.context.client.setIgnoredUsers(t),await this.context.client.leave(this.state.roomId),b.a.dispatch({action:F.a.ViewHomePage}),this.setState({rejecting:!1})}catch(e){on.a.error(`Failed to reject invite: ${e}`);const t=e instanceof Error?e.message:JSON.stringify(e);H.b.createDialog(Dn.a,{title:Object(N.b)("Failed to reject invite"),description:t}),this.setState({rejecting:!1})}})),i()(this,"onRejectThreepidInviteButtonClicked",(()=>{b.a.fire(F.a.ViewRoomDirectory)})),i()(this,"onSearchClick",(()=>{this.setState({timelineRenderingType:this.state.timelineRenderingType===In.a.Search?In.a.Room:In.a.Search})})),i()(this,"onCancelSearchClick",(()=>new Promise((e=>{this.setState({timelineRenderingType:In.a.Room,search:void 0},e)})))),i()(this,"jumpToLiveTimeline",(()=>{var e;this.state.initialEventId&&this.state.isInitialEventHighlighted?b.a.dispatch({action:F.a.ViewRoom,room_id:this.getRoomId(),metricsTrigger:void 0}):(null===(e=this.messagePanel)||void 0===e||e.jumpToLiveTimeline(),b.a.fire(F.a.FocusSendMessageComposer))})),i()(this,"jumpToReadMarker",(()=>{var e;null===(e=this.messagePanel)||void 0===e||e.jumpToReadMarker()})),i()(this,"forgetReadMarker",(e=>{var t;e.stopPropagation(),null===(t=this.messagePanel)||void 0===t||t.forgetReadMarker()})),i()(this,"updateTopUnreadMessagesBar",(()=>{if(!this.messagePanel)return;const e=this.messagePanel.canJumpToReadMarker();this.state.showTopUnreadMessagesBar!=e&&this.setState({showTopUnreadMessagesBar:e})})),i()(this,"onStatusBarVisible",(()=>{this.unmounted||this.state.statusBarVisible||this.setState({statusBarVisible:!0})})),i()(this,"onStatusBarHidden",(()=>{!this.unmounted&&this.state.statusBarVisible&&this.setState({statusBarVisible:!1})})),i()(this,"handleScrollKey",(e=>{var t;let n;this.searchResultsPanel.current?n=this.searchResultsPanel.current:this.messagePanel&&(n=this.messagePanel),null===(t=n)||void 0===t||t.handleScrollKey(e)})),i()(this,"gatherTimelinePanelRef",(e=>{this.messagePanel=e})),i()(this,"onHiddenHighlightsClick",(()=>{const e=this.getOldRoom();e&&b.a.dispatch({action:F.a.ViewRoom,room_id:e.roomId,metricsTrigger:"Predecessor"})})),i()(this,"onFileDrop",(async e=>{const t=this.getRoomId();t&&this.context.client&&await hn.a.sharedInstance().sendContentListToRoom(Array.from(e.files),t,void 0,this.context.client,In.a.Room)})),i()(this,"onMeasurement",(e=>{this.setState({narrow:e})})),i()(this,"onSubmitAskToJoin",(e=>{const t=this.getRoomId();Object(zc.b)(t)&&b.a.dispatch({action:F.a.SubmitAskToJoin,roomId:t,opts:{reason:e}})})),i()(this,"onCancelAskToJoin",(()=>{const e=this.getRoomId();Object(zc.b)(e)&&b.a.dispatch({action:F.a.CancelAskToJoin,roomId:e})})),this.askToJoinEnabled=v.b.getValue("feature_ask_to_join"),!t.client)throw new Error("Unable to create RoomView without MatrixClient");const a=t.client.hasLazyLoadMembersEnabled();this.state={roomId:void 0,roomLoading:!0,peekLoading:!1,shouldPeek:!0,membersLoaded:!a,numUnreadMessages:0,callState:void 0,activeCall:null,canPeek:!1,canSelfRedact:!1,showApps:!1,isPeeking:!1,showRightPanel:!1,threadRightPanel:!1,joining:!1,showTopUnreadMessagesBar:!1,statusBarVisible:!1,canReact:!1,canSendMessages:!1,resizing:!1,layout:v.b.getValue("layout"),lowBandwidth:v.b.getValue("lowBandwidth"),alwaysShowTimestamps:v.b.getValue("alwaysShowTimestamps"),showTwelveHourTimestamps:v.b.getValue("showTwelveHourTimestamps"),readMarkerInViewThresholdMs:v.b.getValue("readMarkerInViewThresholdMs"),readMarkerOutOfViewThresholdMs:v.b.getValue("readMarkerOutOfViewThresholdMs"),showHiddenEvents:v.b.getValue("showHiddenEventsInTimeline"),showReadReceipts:!0,showRedactions:!0,showJoinLeaves:!0,showAvatarChanges:!0,showDisplaynameChanges:!0,matrixClientIsReady:null===(n=t.client)||void 0===n?void 0:n.isInitialSyncComplete(),mainSplitContentType:pd.Timeline,timelineRenderingType:In.a.Room,liveTimeline:void 0,narrow:!1,msc3946ProcessDynamicPredecessor:v.b.getValue("feature_dynamic_room_predecessors"),canAskToJoin:this.askToJoinEnabled,promptAskToJoin:!1,knocked:!1},this.dispatcherRef=b.a.register(this.onAction),t.client.on(s.b.Room,this.onRoom),t.client.on(l.RoomEvent.Timeline,this.onRoomTimeline),t.client.on(l.RoomEvent.TimelineReset,this.onRoomTimelineReset),t.client.on(l.RoomEvent.Name,this.onRoomName),t.client.on(l.RoomStateEvent.Events,this.onRoomStateEvents),t.client.on(l.RoomStateEvent.Update,this.onRoomStateUpdate),t.client.on(l.RoomEvent.MyMembership,this.onMyMembership),t.client.on(cn.b.KeyBackupStatus,this.onKeyBackupStatus),t.client.on(cn.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),t.client.on(cn.b.UserTrustStatusChanged,this.onUserVerificationChanged),t.client.on(cn.b.KeysChanged,this.onCrossSigningKeysChanged),t.client.on(l.MatrixEventEvent.Decrypted,this.onEventDecrypted),t.roomViewStore.on(ft.b,this.onRoomViewStoreUpdate),t.rightPanelStore.on(ft.b,this.onRightPanelStoreUpdate),Bo.a.on(ft.b,this.onWidgetEchoStoreUpdate),t.widgetStore.on(ft.b,this.onWidgetStoreUpdate),Jl.a.instance.on(Jl.b.ActiveCalls,this.onActiveCalls),this.props.resizeNotifier.on("isResizing",this.onIsResizing),this.settingWatchers=[v.b.watchSetting("layout",null,((...[,,,e])=>this.setState({layout:e}))),v.b.watchSetting("lowBandwidth",null,((...[,,,e])=>this.setState({lowBandwidth:e}))),v.b.watchSetting("alwaysShowTimestamps",null,((...[,,,e])=>this.setState({alwaysShowTimestamps:e}))),v.b.watchSetting("showTwelveHourTimestamps",null,((...[,,,e])=>this.setState({showTwelveHourTimestamps:e}))),v.b.watchSetting("readMarkerInViewThresholdMs",null,((...[,,,e])=>this.setState({readMarkerInViewThresholdMs:e}))),v.b.watchSetting("readMarkerOutOfViewThresholdMs",null,((...[,,,e])=>this.setState({readMarkerOutOfViewThresholdMs:e}))),v.b.watchSetting("showHiddenEventsInTimeline",null,((...[,,,e])=>this.setState({showHiddenEvents:e}))),v.b.watchSetting("urlPreviewsEnabled",null,this.onUrlPreviewsEnabledChange),v.b.watchSetting("urlPreviewsEnabled_e2ee",null,this.onUrlPreviewsEnabledChange),v.b.watchSetting("feature_dynamic_room_predecessors",null,((...[,,,e])=>this.setState({msc3946ProcessDynamicPredecessor:e})))]}doMaybeRemoveOwnJitsiWidget(){if(!this.state.roomId||!this.state.room||!this.context.client)return;const e=this.context.widgetStore.getApps(this.state.roomId).filter((e=>e.eventId&&Mn.a.JITSI.matches(e.type)));if(e.length<2)return;const t=this.context.client.getSafeUserId(),n=e.find((e=>e.creatorUserId===t));if(!n)return;const a=this.state.room.findEventById(n.eventId);if(!a)return;const i=a.getTs();if(!i)return;const r=e.reduce(((e,t)=>{var a;if(t.eventId===n.eventId)return e;const i=(null===(a=this.state.room.findEventById(t.eventId))||void 0===a?void 0:a.getTs())||0;return Math.max(e,i)}),0);r&&i>r&&i-r<3e4&&Sn.a.setRoomWidget(this.context.client,this.state.roomId,n.id)}getPermalinkCreatorForRoom(){const{room:e,roomId:t}=this.state;if(void 0===e){if(Object(zc.b)(t)){const e=new mn.a(null,t);return this.permalinkCreators[t]=e,e}throw new Error("Cannot get a permalink creator without a roomId")}return this.permalinkCreators[e.roomId]||(this.permalinkCreators[e.roomId]=new mn.a(e),this.state.room&&e.roomId===this.state.room.roomId?this.permalinkCreators[e.roomId].start():this.permalinkCreators[e.roomId].load()),this.permalinkCreators[e.roomId]}stopAllPermalinkCreators(){if(this.permalinkCreators)for(const e of Object.keys(this.permalinkCreators))this.permalinkCreators[e].stop()}setupRoom(e,t,n,a){var i;if(!n&&t)if(!e&&a)on.a.info(`Attempting to peek into room ${t}`),this.setState({peekLoading:!0,isPeeking:!0}),null===(i=this.context.client)||void 0===i||i.peekInRoom(t).then((e=>{this.unmounted||(this.setState({room:e,peekLoading:!1,canAskToJoin:this.askToJoinEnabled&&e.getJoinRule()===l.JoinRule.Knock}),this.onRoomLoaded(e))})).catch((e=>{if(!this.unmounted){if(this.setState({isPeeking:!1}),"M_GUEST_ACCESS_FORBIDDEN"!==e.errcode&&"M_FORBIDDEN"!==e.errcode)throw e;this.setState({peekLoading:!1})}}));else if(e){var r;null===(r=this.context.client)||void 0===r||r.stopPeeking(),this.setState({isPeeking:!1,canAskToJoin:this.askToJoinEnabled&&e.getJoinRule()===l.JoinRule.Knock})}}shouldShowApps(e){if(!hd||!e)return!1;const t=e.roomId+"_hide_widget_drawer",n=localStorage.getItem(t),a=!n||"false"===n,i=this.context.widgetLayoutStore.getContainerWidgets(e,An.a.Top);return a&&i.length>0}componentDidMount(){this.onRoomViewStoreUpdate(!0);const e=this.getCallForRoom(),t=null==e?void 0:e.state;this.setState({callState:t}),this.context.legacyCallHandler.on(V.a.CallState,this.onCallState),window.addEventListener("beforeunload",this.onPageUnload)}shouldComponentUpdate(e,t){const n=Object(Yn.d)(this.props,e),a=this.state,{upgradeRecommendation:i}=a,r=ge()(a,ld),{upgradeRecommendation:o}=t,s=ge()(t,cd),l=(null==o?void 0:o.needsUpgrade)!==(null==i?void 0:i.needsUpgrade)||Object(Yn.d)(r,s);return n||l}componentDidUpdate(){this.messagePanel&&void 0===this.state.atEndOfLiveTimeline&&this.setState({atEndOfLiveTimeline:this.messagePanel.isAtEndOfLiveTimeline()})}componentWillUnmount(){var e,t;(this.unmounted=!0,this.context.legacyCallHandler.removeListener(V.a.CallState,this.onCallState),this.state.roomId&&Fo.setScrollState(this.state.roomId,this.getScrollState()),this.state.shouldPeek)&&(null===(e=this.context.client)||void 0===e||e.stopPeeking());this.stopAllPermalinkCreators(),b.a.unregister(this.dispatcherRef),this.context.client&&(this.context.client.removeListener(s.b.Room,this.onRoom),this.context.client.removeListener(l.RoomEvent.Timeline,this.onRoomTimeline),this.context.client.removeListener(l.RoomEvent.TimelineReset,this.onRoomTimelineReset),this.context.client.removeListener(l.RoomEvent.Name,this.onRoomName),this.context.client.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents),this.context.client.removeListener(l.RoomEvent.MyMembership,this.onMyMembership),this.context.client.removeListener(l.RoomStateEvent.Update,this.onRoomStateUpdate),this.context.client.removeListener(cn.b.KeyBackupStatus,this.onKeyBackupStatus),this.context.client.removeListener(cn.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.context.client.removeListener(cn.b.UserTrustStatusChanged,this.onUserVerificationChanged),this.context.client.removeListener(cn.b.KeysChanged,this.onCrossSigningKeysChanged),this.context.client.removeListener(l.MatrixEventEvent.Decrypted,this.onEventDecrypted)),window.removeEventListener("beforeunload",this.onPageUnload),this.context.roomViewStore.off(ft.b,this.onRoomViewStoreUpdate),this.context.rightPanelStore.off(ft.b,this.onRightPanelStoreUpdate),Bo.a.removeListener(ft.b,this.onWidgetEchoStoreUpdate),this.context.widgetStore.removeListener(ft.b,this.onWidgetStoreUpdate),this.props.resizeNotifier.off("isResizing",this.onIsResizing),this.state.room&&this.context.widgetLayoutStore.off(An.d.emissionForRoom(this.state.room),this.onWidgetLayoutChange),Jl.a.instance.off(Jl.b.ActiveCalls,this.onActiveCalls),this.context.legacyCallHandler.off(V.a.CallState,this.onCallState),this.updateRoomMembers.cancel();for(const e of this.settingWatchers)v.b.unwatchSetting(e);this.viewsLocalRoom&&this.state.room&&(null===(t=this.context.client)||void 0===t||t.store.removeRoom(this.state.room.roomId))}onLocalRoomEvent(e){this.context.client&&this.state.room&&e===this.state.room.roomId&&Object(Dc.c)(this.context.client,this.state.room)}getRoomTombstone(e=this.state.room){var t;return null!==(t=null==e?void 0:e.currentState.getStateEvents(l.EventType.RoomTombstone,""))&&void 0!==t?t:void 0}async calculateRecommendedVersion(e){const t=await e.getRecommendedVersion();this.unmounted||this.setState({upgradeRecommendation:t})}async loadMembersIfJoined(e){var t;if(null!==(t=this.context.client)&&void 0!==t&&t.hasLazyLoadMembersEnabled()&&e&&"join"===e.getMyMembership())try{await e.loadMembersIfNeeded(),this.unmounted||this.setState({membersLoaded:!0})}catch(t){const n=`Fetching room members for ${e.roomId} failed. Room members will appear incomplete.`;on.a.error(n),on.a.error(t)}}calculatePeekRules(e){const t=e.currentState.getStateEvents(l.EventType.RoomHistoryVisibility,"");this.setState({canPeek:(null==t?void 0:t.getContent().history_visibility)===l.HistoryVisibility.WorldReadable})}updatePreviewUrlVisibility({roomId:e}){var t;const n=null!==(t=this.context.client)&&void 0!==t&&t.isRoomEncrypted(e)?"urlPreviewsEnabled_e2ee":"urlPreviewsEnabled";this.setState({showUrlPreview:v.b.getValue(n,e)})}async updateE2EStatus(e){var t;if(null===(t=this.context.client)||void 0===t||!t.isRoomEncrypted(e.roomId))return;let n=jn.a.Warning;this.context.client.isCryptoEnabled()&&(n=await Object(jn.b)(this.context.client,e)),this.unmounted||this.setState({e2eStatus:n})}updatePermissions(e){if(e&&this.context.client){const t=this.context.client.getSafeUserId(),n="join"===e.getMyMembership()&&e.currentState.maySendEvent(l.EventType.Reaction,t),a=e.maySendMessage(),i=e.currentState.maySendEvent(l.EventType.RoomRedaction,t);this.setState({canReact:n,canSendMessages:a,canSelfRedact:i})}}checkDesktopNotifications(){if(!this.state.room)return;this.state.room.getJoinedMemberCount()+this.state.room.getInvitedMemberCount()>1&&nc.default.shouldShowPrompt()&&Object(ac.b)(!0)}updateDMState(){const e=this.state.room;if("join"!==(null==e?void 0:e.getMyMembership()))return;const t=e.getDMInviter();t&&pn.d(e.client,e.roomId,t)}injectSticker(e,t,n,a){const i=this.getRoomId();this.context.client&&i&&(this.context.client.isGuest()?b.a.dispatch({action:"require_registration"}):hn.a.sharedInstance().sendStickerContentToRoom(e,i,a,t,n,this.context.client).then(void 0,(e=>{e.name})))}getScrollState(){const e=this.messagePanel;if(!e)return null;if(this.state.atEndOfLiveTimeline)return null;const t=e.getScrollState();return!t||t.stuckAtBottom?null:{focussedEvent:t.trackedScrollToken,pixelOffset:t.pixelOffset}}getCallForRoom(){return this.state.room?this.context.legacyCallHandler.getCallForRoom(this.state.room.roomId):null}getOldRoom(){var e,t;const{roomId:n}=(null===(e=this.state.room)||void 0===e?void 0:e.findPredecessor(this.state.msc3946ProcessDynamicPredecessor))||{};return(null===(t=this.context.client)||void 0===t?void 0:t.getRoom(n))||null}getHiddenHighlightCount(){const e=this.getOldRoom();return e?e.getUnreadNotificationCount(l.NotificationCountType.Highlight):0}get messagePanelClassNames(){return d()("mx_RoomView_messagePanel",{mx_IRCLayout:this.state.layout===Sr.a.IRC})}get viewsLocalRoom(){return Object(to.a)(this.state.room)}get permalinkCreator(){return this.getPermalinkCreatorForRoom()}renderLocalRoomCreateLoader(e){var t;if(!this.state.room||null===(t=this.context)||void 0===t||!t.client)return null;const n=this.state.room.getDefaultRoomName(this.context.client.getSafeUserId());return o.a.createElement(In.b.Provider,{value:this.state},o.a.createElement(bd,{localRoom:e,names:n,resizeNotifier:this.props.resizeNotifier}))}renderLocalRoomView(e){return o.a.createElement(In.b.Provider,{value:this.state},o.a.createElement(gd,{localRoom:e,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,roomView:this.roomView,onFileDrop:this.onFileDrop}))}renderWaitingForThirdPartyRoomView(e){return o.a.createElement(In.b.Provider,{value:this.state},o.a.createElement(sd,{resizeNotifier:this.props.resizeNotifier,roomView:this.roomView,inviteEvent:e}))}render(){var e,t;if(!this.context.client)return null;if(this.state.room instanceof Nc.b)return this.state.room.state===Nc.c.CREATING?this.renderLocalRoomCreateLoader(this.state.room):this.renderLocalRoomView(this.state.room);if(this.state.room){const{shouldEncrypt:e,inviteEvent:t}=Object(rd.a)(this.state.room);if(e)return this.renderWaitingForThirdPartyRoomView(t)}if(!this.state.room){const e=!this.state.matrixClientIsReady||this.state.roomLoading||this.state.peekLoading;if(e){const t=!this.state.matrixClientIsReady||!this.state.roomId||this.state.peekLoading;return o.a.createElement("div",{className:"mx_RoomView"},o.a.createElement(Wo.a,null,o.a.createElement(Yo,{canPreview:!1,previewLoading:t&&!this.state.roomLoadError,error:this.state.roomLoadError,loading:e,joining:this.state.joining,oobData:this.props.oobData,roomId:this.state.roomId})))}{var n,a;let e;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(n=this.props.threepidInvite)||void 0===n?void 0:n.toEmail,i=this.state.roomAlias;return o.a.createElement("div",{className:"mx_RoomView"},o.a.createElement(Wo.a,null,o.a.createElement(Yo,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,canPreview:!1,error:this.state.roomLoadError,roomAlias:i,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,signUrl:null===(a=this.props.threepidInvite)||void 0===a?void 0:a.signUrl,roomId:this.state.roomId,promptAskToJoin:this.state.promptAskToJoin,knocked:this.state.knocked,onSubmitAskToJoin:this.onSubmitAskToJoin,onCancelAskToJoin:this.onCancelAskToJoin})))}}const i=this.state.room.getMyMembership();if(wl(this.state.room)&&(!v.b.getValue("feature_video_rooms")||"join"!==i))return o.a.createElement(Wo.a,null,o.a.createElement("div",{className:"mx_MainSplit"},o.a.createElement(ss,{room:this.state.room,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.onRejectButtonClicked})),";");if("invite"===i&&!this.state.room.isSpaceRoom()){if(this.state.joining||this.state.rejecting)return o.a.createElement(Wo.a,null,o.a.createElement(Yo,{canPreview:!1,error:this.state.roomLoadError,joining:this.state.joining,rejecting:this.state.rejecting,roomId:this.state.roomId}));{const e=this.context.client.getSafeUserId(),t=this.state.room.getMember(e),n=t?t.events.member:null;let a=Object(N.b)("Unknown");var r,s;if(n)a=null!==(r=null===(s=n.sender)||void 0===s?void 0:s.name)&&void 0!==r?r:n.getSender();return o.a.createElement("div",{className:"mx_RoomView"},o.a.createElement(Wo.a,null,o.a.createElement(Yo,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectButtonClicked,onRejectAndIgnoreClick:this.onRejectAndIgnoreClick,inviterName:a,canPreview:!1,joining:this.state.joining,room:this.state.room,roomId:this.state.roomId})))}}if(this.state.canAskToJoin&&["knock","leave"].includes(i))return o.a.createElement("div",{className:"mx_RoomView"},o.a.createElement(Wo.a,null,o.a.createElement(Yo,{room:this.state.room,promptAskToJoin:"leave"===i||this.state.promptAskToJoin,knocked:"knock"===i||this.state.knocked,onSubmitAskToJoin:this.onSubmitAskToJoin,onCancelAskToJoin:this.onCancelAskToJoin})));let c,u=null;{const e=this.getCallForRoom();e&&"ended"!==this.state.callState&&"ringing"!==this.state.callState&&(u=e)}let m=!0;hn.a.sharedInstance().getCurrentUploads().length>0?c=o.a.createElement(mo,{room:this.state.room}):this.state.search||(m=this.state.statusBarVisible,c=o.a.createElement(Ic.a,{room:this.state.room,isPeeking:"join"!==i,onInviteClick:this.onInviteClick,onVisible:this.onStatusBarVisible,onHidden:this.onStatusBarHidden}));const h=d()("mx_RoomView_statusArea",{mx_RoomView_statusArea_expanded:m}),p=c&&o.a.createElement("div",{className:h},o.a.createElement("div",{className:"mx_RoomView_statusAreaBox"},o.a.createElement("div",{className:"mx_RoomView_statusAreaBox_line"}),c)),g=this.state.upgradeRecommendation,b=g&&g.needsUpgrade&&this.state.room.userMayUpgradeRoom(this.context.client.getSafeUserId()),f=this.getHiddenHighlightCount();let y,E;var w;if(this.state.timelineRenderingType===In.a.Search)y=o.a.createElement(cs,{searchInProgress:null===(w=this.state.search)||void 0===w?void 0:w.inProgress,onCancelClick:this.onCancelSearchClick,onSearch:this.onSearch,isRoomEncrypted:this.context.client.isRoomEncrypted(this.state.room.roomId)});else if(b)y=o.a.createElement(us,{room:this.state.room});else if("join"!==i){var S,_;let e;this.props.oobData&&(e=this.props.oobData.inviterName);const t=null===(S=this.props.threepidInvite)||void 0===S?void 0:S.toEmail;if(E=o.a.createElement(Yo,{onJoinClick:this.onJoinButtonClicked,onForgetClick:this.onForgetClick,onRejectClick:this.onRejectThreepidInviteButtonClicked,joining:this.state.joining,inviterName:e,invitedEmail:t,oobData:this.props.oobData,canPreview:this.state.canPeek,room:this.state.room,roomId:this.state.roomId}),!(this.state.canPeek||null!==(_=this.state.room)&&void 0!==_&&_.isSpaceRoom()))return o.a.createElement("div",{className:"mx_RoomView"},E)}else f>0&&(y=o.a.createElement(K.a,{element:"div",className:"mx_RoomView_auxPanel_hiddenHighlights",onClick:this.onHiddenHighlightsClick},Object(N.b)("You have %(count)s unread notifications in a prior version of this room.",{count:f})));if(null!==(e=this.state.room)&&void 0!==e&&e.isSpaceRoom()&&!this.props.forceTimeline)return o.a.createElement(jc,{space:this.state.room,justCreatedOpts:this.props.justCreatedOpts,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,onJoinButtonClicked:this.onJoinButtonClicked,onRejectButtonClicked:this.props.threepidInvite?this.onRejectThreepidInviteButtonClicked:this.onRejectButtonClicked});const C=o.a.createElement($s,{room:this.state.room,userId:this.context.client.getSafeUserId(),showApps:this.state.showApps,resizeNotifier:this.props.resizeNotifier},y);let O;let x;"join"===i&&!this.state.search&&(O=o.a.createElement(so,{room:this.state.room,e2eStatus:this.state.e2eStatus,resizeNotifier:this.props.resizeNotifier,replyToEvent:this.state.replyToEvent,permalinkCreator:this.permalinkCreator}));let k,R=!1;this.state.search&&(x=o.a.createElement(ad,{key:this.state.search.searchId,ref:this.searchResultsPanel,term:this.state.search.term,scope:this.state.search.scope,promise:this.state.search.promise,abortController:this.state.search.abortController,resizeNotifier:this.props.resizeNotifier,className:this.messagePanelClassNames,onUpdate:this.onSearchUpdate}),R=!0),this.state.isInitialEventHighlighted&&(k=this.state.initialEventId);const j=o.a.createElement(wr,{ref:this.gatherTimelinePanelRef,timelineSet:this.state.room.getUnfilteredTimelineSet(),overlayTimelineSet:null===(t=this.state.virtualRoom)||void 0===t?void 0:t.getUnfilteredTimelineSet(),overlayTimelineSetFilter:gr.c,showReadReceipts:this.state.showReadReceipts,manageReadReceipts:!this.state.isPeeking,sendReadReceiptOnLoad:!this.state.wasContextSwitch,manageReadMarkers:!this.state.isPeeking,hidden:R,highlightedEventId:k,eventId:this.state.initialEventId,eventScrollIntoView:this.state.initialEventScrollIntoView,eventPixelOffset:this.state.initialEventPixelOffset,onScroll:this.onMessageListScroll,onEventScrolledIntoView:this.resetJumpToEvent,onReadMarkerUpdated:this.updateTopUnreadMessagesBar,showUrlPreview:this.state.showUrlPreview,className:this.messagePanelClassNames,membersLoaded:this.state.membersLoaded,permalinkCreator:this.permalinkCreator,resizeNotifier:this.props.resizeNotifier,showReactions:!0,layout:this.state.layout,editState:this.state.editState});let I,T;this.state.showTopUnreadMessagesBar&&!this.state.search&&(I=o.a.createElement(Tc,{onScrollUpClick:this.jumpToReadMarker,onCloseClick:this.forgetReadMarker})),!1!==this.state.atEndOfLiveTimeline||this.state.search||(T=o.a.createElement(Po,{highlight:this.state.room.getUnreadNotificationCount(l.NotificationCountType.Highlight)>0,numUnreadMessages:this.state.numUnreadMessages,onScrollToBottomClick:this.jumpToLiveTimeline}));const P=this.state.room&&this.state.showRightPanel?o.a.createElement(Lo,{room:this.state.room,resizeNotifier:this.props.resizeNotifier,permalinkCreator:this.permalinkCreator,e2eStatus:this.state.e2eStatus}):void 0,D=d()("mx_RoomView_timeline",{mx_RoomView_timeline_rr_enabled:this.state.showReadReceipts}),M=d()("mx_RoomView",{mx_RoomView_inCall:Boolean(u),mx_RoomView_immersive:this.state.mainSplitContentType!==pd.Timeline}),A=v.b.getValue("showChatEffects");let L,U;switch(this.state.mainSplitContentType){case pd.Timeline:U="mx_MainSplit_timeline",L=o.a.createElement(o.a.Fragment,null,this.roomViewBody.current&&o.a.createElement(_r,{sensor:this.roomViewBody.current,onMeasurement:this.onMeasurement}),C,o.a.createElement("div",{className:D},o.a.createElement(bo,{parent:this.roomView.current,onFileDrop:this.onFileDrop}),I,T,j,x),p,E,O);break;case pd.MaximisedWidget:U="mx_MainSplit_maximisedWidget",L=o.a.createElement(o.a.Fragment,null,o.a.createElement(Ss,{room:this.state.room,userId:this.context.client.getSafeUserId(),resizeNotifier:this.props.resizeNotifier,showApps:!0}),E);break;case pd.Call:U="mx_MainSplit_call",L=o.a.createElement(o.a.Fragment,null,o.a.createElement(tc,{room:this.state.room,resizing:this.state.resizing,waitForCall:wl(this.state.room)}),E)}const F=d()("mx_RoomView_body",U);let B=[vn.a.Timeline],V=this.onAppsClick,W=this.onForgetClick,z=this.onSearchClick,H=null,G=!1;switch(this.state.mainSplitContentType){case pd.MaximisedWidget:B=[],V=null,W=null,z=null;break;case pd.Call:B=[],V=null,W=null,z=null,this.state.room.canInvite(this.context.client.getSafeUserId())&&(H=this.onInviteClick),G=!0}const q=this.state.room.getMember(this.context.client.getSafeUserId()),$=!this.context.client.isGuest()&&(["leave","ban"].includes(i)||(null==q?void 0:q.isKicked()));return o.a.createElement(In.b.Provider,{value:this.state},o.a.createElement("main",{className:M,ref:this.roomView,onKeyDown:this.onReactKeyDown},A&&this.roomView.current&&o.a.createElement(Yl,{roomWidth:this.roomView.current.offsetWidth}),o.a.createElement(Wo.a,null,v.b.getValue("feature_new_room_decoration_ui")?o.a.createElement($l,{room:this.state.room}):o.a.createElement(Nl,{room:this.state.room,searchInfo:this.state.search,oobData:this.props.oobData,inRoom:"join"===i,onSearchClick:z,onInviteClick:H,onForgetClick:$?W:null,e2eStatus:this.state.e2eStatus,onAppsClick:this.state.hasPinnedWidgets?V:null,appsShown:this.state.showApps,excludedRightPanelPhaseButtons:B,showButtons:!this.viewsLocalRoom,enableRoomOptionsMenu:!this.viewsLocalRoom,viewingCall:G,activeCall:this.state.activeCall}),o.a.createElement(bn,{panel:P,resizeNotifier:this.props.resizeNotifier,sizeKey:this.state.threadRightPanel?"thread":void 0,defaultSize:this.state.threadRightPanel?500:void 0},o.a.createElement("div",{className:F,ref:this.roomViewBody,"data-layout":this.state.layout},L)))))}}i()(vd,"contextType",Ze.a);var fd=vd;class yd extends r.Component{constructor(e){super(e),i()(this,"onToastStoreUpdate",(()=>{this.setState({toasts:M.a.sharedInstance().getToasts(),countSeen:M.a.sharedInstance().getCountSeen()})})),this.state={toasts:M.a.sharedInstance().getToasts(),countSeen:M.a.sharedInstance().getCountSeen()},M.a.sharedInstance().on("update",this.onToastStoreUpdate)}componentWillUnmount(){M.a.sharedInstance().removeListener("update",this.onToastStoreUpdate)}render(){const e=this.state.toasts.length,t=e>1;let n,a;if(0!==e){const i=this.state.toasts[0],{title:o,icon:s,key:l,component:c,className:u,bodyClassName:m,props:h}=i,p=d()("mx_Toast_body",m),g=d()("mx_Toast_toast",u,{mx_Toast_hasIcon:s,[`mx_Toast_icon_${s}`]:s}),b=Object.assign({},h,{key:l,toastKey:l}),v=r.createElement(c,b);let f,y;(o&&t||this.state.countSeen>0)&&(f=` (${this.state.countSeen+1}/${this.state.countSeen+e})`),o&&(y=r.createElement("div",{className:"mx_Toast_title"},r.createElement("h2",null,o),r.createElement("span",{className:"mx_Toast_title_countIndicator"},f))),n=r.createElement("div",{className:g},y,r.createElement("div",{className:p},v)),a=d()("mx_ToastContainer",{mx_ToastContainer_stacked:t})}return n?r.createElement("div",{className:a,role:"alert"},n):null}}class Ed extends o.a.Component{constructor(e){super(e),i()(this,"context",void 0),this.state={loading:!0}}componentDidMount(){this.props.userId&&this.loadProfileInfo()}componentDidUpdate(e){e.userId!==this.props.userId&&this.props.userId&&this.loadProfileInfo()}async loadProfileInfo(){let e;this.setState({loading:!0});try{e=await this.context.getProfileInfo(this.props.userId)}catch(e){return H.b.createDialog(Dn.a,{title:Object(N.b)("Could not load user profile"),description:e instanceof Error?e.message:Object(N.b)("Operation failed")}),void this.setState({loading:!1})}const t=new l.MatrixEvent({type:"m.room.member",content:e}),n=new l.RoomMember("",this.props.userId);n.setMembershipEvent(t),this.setState({member:n,loading:!1})}render(){if(this.state.loading)return o.a.createElement(Ma.a,null);if(this.state.member){const e=o.a.createElement(Lo,{overwriteCard:{phase:vn.a.RoomMemberInfo,state:{member:this.state.member}},resizeNotifier:this.props.resizeNotifier});return o.a.createElement(bn,{panel:e,resizeNotifier:this.props.resizeNotifier},o.a.createElement(Jt.a,null))}return o.a.createElement("div",null)}}i()(Ed,"contextType",I.a);var wd=({backgroundImage:e,blurMultiplier:t})=>{if(!e)return null;const n={};if(t){const e=getComputedStyle(document.documentElement).getPropertyValue("--lp-background-blur").replace("px",""),a=parseInt(e,10);isNaN(a)||(n.filter=`blur(${a*t}px)`)}return o.a.createElement("div",{className:"mx_BackdropPanel"},o.a.createElement("img",{role:"presentation",alt:"",style:n,className:"mx_BackdropPanel--image",src:e}))},Sd=n(478);var _d=({isMinimized:e})=>{const t=Object(ae.b)(pl.a.instance,pl.b.MonitoringLivePosition,(()=>pl.a.instance.isMonitoringLiveLocation)),n=Object(ae.b)(pl.a.instance,pl.b.LocationPublishError,(()=>pl.a.instance.getLiveBeaconIdsWithLocationPublishError())),a=Object(ae.b)(pl.a.instance,pl.b.BeaconUpdateError,(()=>pl.a.instance.getLiveBeaconIds().filter((e=>pl.a.instance.beaconUpdateErrors.has(e))))),i=Object(ae.b)(pl.a.instance,pl.b.LivenessChange,(()=>pl.a.instance.getLiveBeaconIds())),s=!!n.length,l=!!a.length;if(((e,t)=>{Object(r.useEffect)((()=>{const n=()=>{"visible"===document.visibilityState&&e.forEach((e=>{var n;return null===(n=t.get(e))||void 0===n?void 0:n.monitorLiveness()}))};return e.length&&document.addEventListener("visibilitychange",n),()=>{document.removeEventListener("visibilitychange",n)}}),[e,t])})(i,pl.a.instance.beacons),!t)return null;const c=((e,t,n)=>{var a,i;const r=null!==(a=null!==(i=null==t?void 0:t[0])&&void 0!==i?i:null==n?void 0:n[0])&&void 0!==a?a:null==e?void 0:e[0];if(!r)return;return pl.a.instance.getBeaconById(r)})(i,a,n),u=c?e=>{b.a.dispatch({action:F.a.ViewRoom,room_id:c.roomId,metricsTrigger:void 0,event_id:c.beaconInfoId,scroll_into_view:!0,highlighted:!0})}:null,m=((e,t)=>e?Object(N.b)("An error occurred while stopping your live location"):t?Object(N.b)("An error occurred whilst sharing your live location"):Object(N.b)("You are sharing your live location"))(l,s);return o.a.createElement(K.a,{className:d()("mx_LeftPanelLiveShareWarning",{mx_LeftPanelLiveShareWarning__minimized:e,mx_LeftPanelLiveShareWarning__error:s||l}),title:e?m:void 0,onClick:u},e?o.a.createElement(Sd.a,{height:10}):m)},Cd=n(1556),Od=n(661);class xd extends o.a.Component{constructor(e,t){super(e,t),i()(this,"context",void 0),i()(this,"room",void 0),this.room=t.getRoom(this.props.persistentRoomId)}render(){const e=On.a.instance.get(this.props.persistentWidgetId,this.props.persistentRoomId);return e?o.a.createElement(qi,{key:e.id,app:e,fullWidth:!0,room:this.room,userId:this.context.getSafeUserId(),creatorUserId:e.creatorUserId,widgetPageTitle:Sn.a.getWidgetDataTitle(e),waitForIframeLoad:e.waitForIframeLoad,miniMode:!0,showMenubar:!1,pointerEvents:this.props.pointerEvents,movePersistedElement:this.props.movePersistedElement}):null}}i()(xd,"contextType",I.a);var kd,Rd,jd=n(1421);function Id(){return Id=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Id.apply(this,arguments)}function Td(e){return r.createElement("svg",Id({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",role:"presentation","aria-hidden":!0},e),kd||(kd=r.createElement("path",{d:"M8.027 15.961c1.141 1.232 3.888 3.365 4.637 3.803l.151.09c1.143.679 4.722 2.807 7.33.815 2.021-1.542 1.364-3.278.684-3.794-.466-.362-1.838-1.36-3.128-2.26-1.268-.883-1.974-.175-2.452.303l-.026.026-.96.961c-.246.245-.618.156-.974-.125a26.02 26.02 0 01-2.692-2.385l-.004-.004c-.47-.47-1.4-1.4-2.373-2.68-.28-.356-.37-.728-.125-.973l.96-.961.027-.026c.478-.478 1.186-1.184.303-2.452-.9-1.29-1.898-2.662-2.26-3.128-.516-.68-2.252-1.337-3.794.684-1.992 2.608.136 6.187.815 7.33l.09.151c.438.75 2.56 3.484 3.791 4.625z",fill:"currentColor"})),Rd||(Rd=r.createElement("path",{d:"M20.697 3.078a.638.638 0 000-.893.615.615 0 00-.88 0L17 5.045l-2.817-2.86a.615.615 0 00-.88 0 .638.638 0 000 .893l2.817 2.86-2.938 2.984a.638.638 0 000 .893.615.615 0 00.88 0L17 6.832l2.938 2.983a.615.615 0 00.88 0 .638.638 0 000-.893L17.88 5.939l2.817-2.86z",fill:"currentColor"})))}const Pd=({widgetId:e,room:t,viewingRoom:n,onStartMoving:a,movePersistedElement:i})=>{const s=Object(r.useMemo)((()=>On.a.instance.getApps(t.roomId).find((t=>t.id===e))),[t,e]),c=Object(ae.d)(t,l.RoomEvent.Name,Object(r.useCallback)((()=>t.name),[t])),d=Object(Sl.b)(e,t.roomId),u=Object(r.useCallback)((e=>{e.preventDefault(),e.stopPropagation(),null!==d?b.a.dispatch({action:F.a.ViewRoom,room_id:t.roomId,view_call:!0,metricsTrigger:"WebFloatingCallWindow"}):n?An.d.instance.moveToContainer(t,s,An.a.Center):b.a.dispatch({action:F.a.ViewRoom,room_id:t.roomId,metricsTrigger:"WebFloatingCallWindow"})}),[t,d,s,n]),m=Object(r.useCallback)((e=>{var t;(e.preventDefault(),e.stopPropagation(),null!==d)?d.disconnect().catch((e=>console.error("Failed to leave call",e))):null===(t=Nn.a.instance.getMessagingForUid(Sn.a.getWidgetUid(s)))||void 0===t||t.transport.send(Ln.a.HangupCall,{}).catch((e=>console.error("Failed to leave Jitsi",e)))}),[d,s]);return o.a.createElement("div",{className:"mx_WidgetPip",onMouseDown:a,onClick:u},o.a.createElement(Kt.a,{className:"mx_WidgetPip_header"},o.a.createElement(Oe.a,{onClick:u,className:"mx_WidgetPip_backButton","aria-label":Object(N.b)("Back")},o.a.createElement(jd.a,{className:"mx_Icon mx_Icon_16"}),c)),o.a.createElement(xd,{persistentWidgetId:e,persistentRoomId:t.roomId,pointerEvents:"none",movePersistedElement:i}),(null!==d||Mn.a.JITSI.matches(null==s?void 0:s.type))&&o.a.createElement(Kt.a,{className:"mx_WidgetPip_footer"},o.a.createElement(Oe.b,{onClick:m,tooltip:Object(N.b)("Leave"),"aria-label":Object(N.b)("Leave"),alignment:Zr.a.Top},o.a.createElement(Td,{className:"mx_Icon mx_Icon_24"}))))},Nd=[an.f.Connected,an.f.InviteSent,an.f.Connecting,an.f.CreateAnswer,an.f.CreateOffer,an.f.WaitLocalMedia];function Dd(e){if(!e)return[null,[]];const t=V.b.instance.getAllActiveCallsForPip(e);let n=null,a=[];for(const e of t)Nd.includes(e.state)&&(e.isRemoteOnHold()||null!==n?a.push(e):n=e);return null===n&&a.length>0&&(n=a[0],a=a.slice(1)),a.length>1&&on.a.log("Found more than 1 secondary call! Other calls will not be shown."),[n,a]}class Md extends o.a.Component{constructor(e){super(e),i()(this,"onMove",(()=>{var e,t;return null===(e=(t=this.props.movePersistedElement).current)||void 0===e?void 0:e.call(t)})),i()(this,"onRoomViewStoreUpdate",(()=>{var e,t;const n=Ze.b.instance.roomViewStore.getRoomId(),a=this.state.viewedRoomId;if(n===a)return;const i=null===(e=tt.a.get())||void 0===e?void 0:e.getRoom(a);i&&An.d.instance.off(An.d.emissionForRoom(i),this.updateCalls);const r=null===(t=tt.a.get())||void 0===t?void 0:t.getRoom(n||void 0);if(r&&An.d.instance.on(An.d.emissionForRoom(r),this.updateCalls),!n)return;const[o,s]=Dd(n);this.setState({viewedRoomId:n,primaryCall:o,secondaryCall:s[0]}),this.updateShowWidgetInPip()})),i()(this,"onWidgetPersistence",(()=>{this.updateShowWidgetInPip()})),i()(this,"onWidgetDockChanges",(()=>{this.updateShowWidgetInPip()})),i()(this,"updateCalls",(()=>{if(!this.state.viewedRoomId)return;const[e,t]=Dd(this.state.viewedRoomId);this.setState({primaryCall:e,secondaryCall:t[0]}),this.updateShowWidgetInPip()})),i()(this,"onCallRemoteHold",(()=>{if(!this.state.viewedRoomId)return;const[e,t]=Dd(this.state.viewedRoomId);this.setState({primaryCall:e,secondaryCall:t[0]})})),i()(this,"onDoubleClick",(()=>{var e;const t=null===(e=this.state.primaryCall)||void 0===e?void 0:e.roomId;var n;(null!=t?t:this.state.persistentRoomId)&&b.a.dispatch({action:F.a.ViewRoom,room_id:null!==(n=null!=t?t:this.state.persistentRoomId)&&void 0!==n?n:void 0,metricsTrigger:"WebFloatingCallWindow"})}));const t=Ze.b.instance.roomViewStore.getRoomId(),[n,a]=Dd(t);this.state={viewedRoomId:t||void 0,primaryCall:n||null,secondaryCall:a[0],persistentWidgetId:oa.b.instance.getPersistentWidgetId(),persistentRoomId:oa.b.instance.getPersistentRoomId(),showWidgetInPip:!1}}componentDidMount(){V.b.instance.addListener(V.a.CallChangeRoom,this.updateCalls),V.b.instance.addListener(V.a.CallState,this.updateCalls),Ze.b.instance.roomViewStore.addListener(ft.b,this.onRoomViewStoreUpdate),tt.a.safeGet().on(an.d.RemoteHoldUnhold,this.onCallRemoteHold);const e=tt.a.safeGet().getRoom(this.state.viewedRoomId);e&&An.d.instance.on(An.d.emissionForRoom(e),this.updateCalls),oa.b.instance.on(oa.a.Persistence,this.onWidgetPersistence),oa.b.instance.on(oa.a.Dock,this.onWidgetDockChanges),oa.b.instance.on(oa.a.Undock,this.onWidgetDockChanges)}componentWillUnmount(){V.b.instance.removeListener(V.a.CallChangeRoom,this.updateCalls),V.b.instance.removeListener(V.a.CallState,this.updateCalls);const e=tt.a.get();null==e||e.removeListener(an.d.RemoteHoldUnhold,this.onCallRemoteHold),Ze.b.instance.roomViewStore.removeListener(ft.b,this.onRoomViewStoreUpdate);const t=null==e?void 0:e.getRoom(this.state.viewedRoomId);t&&An.d.instance.off(An.d.emissionForRoom(t),this.updateCalls),oa.b.instance.off(oa.a.Persistence,this.onWidgetPersistence),oa.b.instance.off(oa.a.Dock,this.onWidgetDockChanges),oa.b.instance.off(oa.a.Undock,this.onWidgetDockChanges)}updateShowWidgetInPip(){const e=oa.b.instance.getPersistentWidgetId(),t=oa.b.instance.getPersistentRoomId();let n=!1,a=!1;e&&t&&tt.a.safeGet().getRoom(t)&&(a=!oa.b.instance.isDocked(e,t),n=this.state.viewedRoomId!==t);const i=n||a;this.setState({showWidgetInPip:i,persistentWidgetId:e,persistentRoomId:t})}createVoiceBroadcastPlaybackPipContent(e){const t=this.state.viewedRoomId===e.infoEvent.getRoomId()?o.a.createElement(_t.j,{playback:e,pip:!0}):o.a.createElement(_t.B,{playback:e});return({onStartMoving:n})=>o.a.createElement("div",{key:`vb-playback-${e.infoEvent.getId()}`,onMouseDown:n},t)}createVoiceBroadcastPreRecordingPipContent(e){return({onStartMoving:t})=>o.a.createElement("div",{key:"vb-pre-recording",onMouseDown:t},o.a.createElement(_t.p,{voiceBroadcastPreRecording:e}))}createVoiceBroadcastRecordingPipContent(e){return({onStartMoving:t})=>o.a.createElement("div",{key:`vb-recording-${e.infoEvent.getId()}`,onMouseDown:t},o.a.createElement(_t.w,{recording:e}))}render(){let e=[];if(this.props.voiceBroadcastRecording?e=[this.createVoiceBroadcastRecordingPipContent(this.props.voiceBroadcastRecording)]:this.props.voiceBroadcastPreRecording?e=[this.createVoiceBroadcastPreRecordingPipContent(this.props.voiceBroadcastPreRecording)]:this.props.voiceBroadcastPlayback&&(e=[this.createVoiceBroadcastPlaybackPipContent(this.props.voiceBroadcastPlayback)]),this.state.primaryCall){const t=this.state.primaryCall;e.push((({onStartMoving:e,onResize:n})=>o.a.createElement(Ks,{onMouseDownOnHeader:e,call:t,secondaryCall:this.state.secondaryCall,pipMode:true,onResize:n})))}return this.state.showWidgetInPip&&this.state.persistentWidgetId&&e.push((({onStartMoving:e})=>{var t;return o.a.createElement(Pd,{widgetId:this.state.persistentWidgetId,room:tt.a.safeGet().getRoom(null!==(t=this.state.persistentRoomId)&&void 0!==t?t:void 0),viewingRoom:this.state.viewedRoomId===this.state.persistentRoomId,onStartMoving:e,movePersistedElement:this.props.movePersistedElement})})),e.length?o.a.createElement(Cd.a,{className:"mx_LegacyCallPreview",draggable:true,onDoubleClick:this.onDoubleClick,onMove:this.onMove},e):null}}const Ad=()=>{const e=Object(r.useContext)(Ze.a),t=e.voiceBroadcastPreRecordingStore,{currentVoiceBroadcastPreRecording:n}=Object(_t.Q)(t),a=e.voiceBroadcastRecordingsStore,{currentVoiceBroadcastRecording:i}=Object(_t.R)(a),s=e.voiceBroadcastPlaybacksStore,{currentVoiceBroadcastPlayback:l}=(c=s,{currentVoiceBroadcastPlayback:Object(ae.d)(c,Od.b.CurrentChanged,(e=>null!=e?e:c.getCurrent()))});var c;const d=Object(r.useRef)();return o.a.createElement(Md,{voiceBroadcastPlayback:l,voiceBroadcastPreRecording:n,voiceBroadcastRecording:i,movePersistedElement:d})};var Ld=n(221),Ud=n(1343),Fd=n(1422);function Bd(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Vd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Bd(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Bd(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Wd=e=>e?Vd(Vd({},e.rule),{},{kind:e.kind}):void 0,zd=async(e,t)=>{if((null==e?void 0:e.getType())!==l.EventType.PushRules)return;const n=new Ld.a(t);Object.entries(Ud.d).forEach((async([e,a])=>{try{await(async(e,t,n,a)=>{var i;const r=Wd(t.getPushRuleAndKindById(n));if(!r)return;const o=null===(i=a.syncedRuleIds)||void 0===i?void 0:i.map((e=>Wd(t.getPushRuleAndKindById(e)))).filter((e=>Boolean(e)));if(null==o||!o.length)return;const s=a.ruleToVectorState(r),l=o.filter((e=>a.ruleToVectorState(e)!==s));l.length&&await Object(Fd.a)(e,l.map((({rule_id:e})=>e)),r.actions)})(t,n,e,a)}catch(t){on.a.error(`Failed to fully synchronise push rules for ${e}`,t)}}))};function Hd(e){return e.closest("input, textarea, select, [contenteditable=true]")}class Gd extends o.a.Component{constructor(e){super(e),i()(this,"_matrixClient",void 0),i()(this,"_roomView",void 0),i()(this,"_resizeContainer",void 0),i()(this,"resizeHandler",void 0),i()(this,"layoutWatcherRef",void 0),i()(this,"compactLayoutWatcherRef",void 0),i()(this,"backgroundImageWatcherRef",void 0),i()(this,"resizer",void 0),i()(this,"onCallState",(()=>{const e=V.b.instance.getAllActiveCalls();e!==this.state.activeCalls&&this.setState({activeCalls:e})})),i()(this,"refreshBackgroundImage",(async()=>{let e=v.b.getValue("RoomList.backgroundImage");e=e?Object(xn.b)(e).srcHttp:vt.a.instance.getHttpAvatarUrl(),this.setState({backgroundImage:e})})),i()(this,"canResetTimelineInRoom",(e=>!this._roomView.current||this._roomView.current.canResetTimeline())),i()(this,"onAccountData",(e=>{"m.ignored_user_list"===e.getType()&&b.a.dispatch({action:"ignore_state_changed"}),zd(e,this._matrixClient)})),i()(this,"onCompactLayoutChanged",(()=>{this.setState({useCompactLayout:v.b.getValue("useCompactLayout")})})),i()(this,"onSync",((e,t,n)=>{var a,i,r;const o=null===(a=this.state.syncErrorData)||void 0===a||null===(i=a.error)||void 0===i?void 0:i.errcode,s=null==n||null===(r=n.error)||void 0===r?void 0:r.errcode;e===t&&o===s||(this.setState({syncErrorData:e===u.c.Error?n:void 0}),t===u.c.Prepared&&e===u.c.Syncing?this.updateServerNoticeEvents():this.calculateServerLimitToast(this.state.syncErrorData,this.state.usageLimitEventContent))})),i()(this,"onRoomStateEvents",(e=>{const t=zt.c.instance.orderedLists[P.a.ServerNotice];null!=t&&t.some((t=>t.roomId===e.getRoomId()))&&this.updateServerNoticeEvents()})),i()(this,"onUsageLimitDismissed",(()=>{this.setState({usageLimitDismissed:!0})})),i()(this,"updateServerNoticeEvents",(async()=>{const e=zt.c.instance.orderedLists[P.a.ServerNotice];if(!e)return;const t=[];let n=0;for(const a of e){const e=a.currentState.getStateEvents("m.room.pinned_events","");if(!e||!e.getContent().pinned)continue;n=e.getTs();const i=e.getContent().pinned.slice(0,2);for(const e of i){const n=await this._matrixClient.getEventTimeline(a.getUnfilteredTimelineSet(),e),i=null==n?void 0:n.getEvents().find((t=>t.getId()===e));i&&t.push(i)}}if(n&&this.state.usageLimitEventTs&&this.state.usageLimitEventTs>n)return;const a=t.find((e=>e&&"m.room.message"===e.getType()&&"m.server_notice.usage_limit_reached"===e.getContent().server_notice_type)),i=null==a?void 0:a.getContent();this.calculateServerLimitToast(this.state.syncErrorData,i),this.setState({usageLimitEventContent:i,usageLimitEventTs:n,usageLimitDismissed:!1})})),i()(this,"onPaste",(e=>{const t=Hd(e.target);if(t!==document.activeElement)if(null!=t&&t.focus)t.focus();else{var n;const e=!(null===(n=document.activeElement)||void 0===n||!n.closest(".mx_ThreadView"));b.a.dispatch({action:F.a.FocusSendMessageComposer,context:e?In.a.Thread:In.a.Room},!0)}})),i()(this,"onReactKeyDown",(e=>{this.onKeyDown(e)})),i()(this,"onNativeKeyDown",(e=>{e.target===document.body&&this.onKeyDown(e)})),i()(this,"onKeyDown",(e=>{var t,n,a;let i=!1;switch(Object(Q.a)().getRoomAction(e)){case z.h.ScrollUp:case z.h.ScrollDown:case z.h.JumpToFirstMessage:case z.h.JumpToLatestMessage:this.onScrollKeyPressed(e),i=!0;break;case z.h.SearchInRoom:b.a.dispatch({action:"focus_search"}),i=!0}if(i)return e.stopPropagation(),void e.preventDefault();switch(Object(Q.a)().getNavigationAction(e)){case z.h.FilterRooms:b.a.dispatch({action:"focus_room_filter"}),i=!0;break;case z.h.ToggleUserMenu:b.a.fire(F.a.ToggleUserMenu),i=!0;break;case z.h.ShowKeyboardSettings:b.a.dispatch({action:F.a.ViewUserSettings,initialTabId:Me.a.Keyboard}),i=!0;break;case z.h.GoToHome:b.a.dispatch({action:F.a.ViewHomePage}),H.b.closeCurrentModal("homeKeyboardShortcut"),i=!0;break;case z.h.ToggleSpacePanel:b.a.fire(F.a.ToggleSpacePanel),i=!0;break;case z.h.ToggleRoomSidePanel:"room_view"===this.props.page_type&&(fn.a.instance.togglePanel(null),i=!0);break;case z.h.SelectPrevRoom:b.a.dispatch({action:F.a.ViewRoomDelta,delta:-1,unread:!1}),i=!0;break;case z.h.SelectNextRoom:b.a.dispatch({action:F.a.ViewRoomDelta,delta:1,unread:!1}),i=!0;break;case z.h.SelectPrevUnreadRoom:b.a.dispatch({action:F.a.ViewRoomDelta,delta:-1,unread:!0});break;case z.h.SelectNextUnreadRoom:b.a.dispatch({action:F.a.ViewRoomDelta,delta:1,unread:!0});break;case z.h.PreviousVisitedRoomOrSpace:null===(t=T.a.get())||void 0===t||t.navigateForwardBack(!0),i=!0;break;case z.h.NextVisitedRoomOrSpace:null===(n=T.a.get())||void 0===n||n.navigateForwardBack(!1),i=!0}if(!i){switch(Object(Q.a)().getLabsAction(e)){case z.h.ToggleHiddenEventVisibility:{const e=v.b.getValueAt(f.a.DEVICE,"showHiddenEventsInTimeline",void 0,!1);v.b.setValue("showHiddenEventsInTimeline",null,f.a.DEVICE,!e),i=!0;break}}}if(!i&&null!==(a=T.a.get())&&void 0!==a&&a.overrideBrowserShortcuts()&&e.code.startsWith("Digit")&&"Digit0"!==e.code&&Object(m.c)(e)&&(b.a.dispatch({action:F.a.SwitchSpace,num:parseInt(e.code.slice(5),10)}),i=!0),i)return e.stopPropagation(),void e.preventDefault();if(!(e.key===m.b.ALT||e.key===m.b.CONTROL||e.key===m.b.META||e.key===m.b.SHIFT)&&!e.ctrlKey&&!e.metaKey){const t=e.target!==document.body&&(e.key===m.b.SPACE||e.key===m.b.ENTER),n=1===e.key.length||"Dead"===e.key;if(!t&&n&&!Hd(e.target)){var r;const t=!(null===(r=document.activeElement)||void 0===r||!r.closest(".mx_ThreadView"));b.a.dispatch({action:F.a.FocusSendMessageComposer,context:t?In.a.Thread:In.a.Room},!0),e.stopPropagation()}}})),i()(this,"onScrollKeyPressed",(e=>{var t;null===(t=this._roomView.current)||void 0===t||t.handleScrollKey(e)})),this.state={syncErrorData:void 0,useCompactLayout:v.b.getValue("useCompactLayout"),usageLimitDismissed:!1,activeCalls:V.b.instance.getAllActiveCalls()},this._matrixClient=this.props.matrixClient,p.c.loadDevices(),Object(g.a)(),this._roomView=o.a.createRef(),this._resizeContainer=o.a.createRef(),this.resizeHandler=o.a.createRef()}componentDidMount(){var e;document.addEventListener("keydown",this.onNativeKeyDown,!1),V.b.instance.addListener(V.a.CallState,this.onCallState),this.updateServerNoticeEvents(),this._matrixClient.on(s.b.AccountData,this.onAccountData),zd(this._matrixClient.getAccountData("m.push_rules"),this._matrixClient),this._matrixClient.on(s.b.Sync,this.onSync),this.onSync(this._matrixClient.getSyncState(),null,null!==(e=this._matrixClient.getSyncStateData())&&void 0!==e?e:void 0),this._matrixClient.on(l.RoomStateEvent.Events,this.onRoomStateEvents),this.layoutWatcherRef=v.b.watchSetting("layout",null,this.onCompactLayoutChanged),this.compactLayoutWatcherRef=v.b.watchSetting("useCompactLayout",null,this.onCompactLayoutChanged),this.backgroundImageWatcherRef=v.b.watchSetting("RoomList.backgroundImage",null,this.refreshBackgroundImage),this.resizer=this.createResizer(),this.resizer.attach(),vt.a.instance.on(ft.b,this.refreshBackgroundImage),this.loadResizerPreferences(),this.refreshBackgroundImage()}componentWillUnmount(){var e;document.removeEventListener("keydown",this.onNativeKeyDown,!1),V.b.instance.removeListener(V.a.CallState,this.onCallState),this._matrixClient.removeListener(s.b.AccountData,this.onAccountData),this._matrixClient.removeListener(s.b.Sync,this.onSync),this._matrixClient.removeListener(l.RoomStateEvent.Events,this.onRoomStateEvents),vt.a.instance.off(ft.b,this.refreshBackgroundImage),this.layoutWatcherRef&&v.b.unwatchSetting(this.layoutWatcherRef),this.compactLayoutWatcherRef&&v.b.unwatchSetting(this.compactLayoutWatcherRef),this.backgroundImageWatcherRef&&v.b.unwatchSetting(this.backgroundImageWatcherRef),null===(e=this.resizer)||void 0===e||e.detach()}createResizer(){var e;let t,n;const a={toggleSize:156,onCollapsed:e=>{n=e,e?(b.a.dispatch({action:"hide_left_panel"}),window.localStorage.setItem("mx_lhs_size","0")):b.a.dispatch({action:"show_left_panel"})},onResized:e=>{t=e,this.props.resizeNotifier.notifyLeftHandleResized()},onResizeStart:()=>{this.props.resizeNotifier.startResizing()},onResizeStop:()=>{n||window.localStorage.setItem("mx_lhs_size",""+t),this.props.resizeNotifier.stopResizing()},isItemCollapsed:e=>e.classList.contains("mx_LeftPanel_minimized"),handler:null!==(e=this.resizeHandler.current)&&void 0!==e?e:void 0},i=new j(this._resizeContainer.current,k,a);return i.setClassNames({handle:"mx_ResizeHandle",vertical:"mx_ResizeHandle--vertical",reverse:"mx_ResizeHandle_reverse"}),i}loadResizerPreferences(){var e,t;let n=parseInt(window.localStorage.getItem("mx_lhs_size"),10);isNaN(n)&&(n=350),null===(e=this.resizer)||void 0===e||null===(t=e.forHandleWithId("lp-resizer"))||void 0===t||t.resize(n)}calculateServerLimitToast(e,t){var n;const a="M_RESOURCE_LIMIT_EXCEEDED"===(null==e||null===(n=e.error)||void 0===n?void 0:n.errcode);a&&(t=(null==e?void 0:e.error).data),t&&this.state.usageLimitDismissed?((e,t,n,a)=>{const i=Object(A.d)(e,n,{monthly_active_user:Object(N.d)("Your homeserver has exceeded its user limit."),hs_blocked:Object(N.d)("This homeserver has been blocked by its administrator."),"":Object(N.d)("Your homeserver has exceeded one of its resource limits.")}),r=Object(A.d)(e,n,{"":Object(N.d)("Contact your <a>server admin</a>.")});M.a.sharedInstance().addOrReplaceToast({key:L,title:Object(N.b)("Warning"),props:{description:o.a.createElement(o.a.Fragment,null,i," ",r),acceptLabel:Object(N.b)("Ok"),onAccept:()=>{U(),t&&t()}},component:D.a,priority:70})})(t.limit_type,this.onUsageLimitDismissed,t.admin_contact):U()}render(){let e;switch(this.props.page_type){case h.a.RoomView:e=o.a.createElement(fd,{ref:this._roomView,onRegistered:this.props.onRegistered,threepidInvite:this.props.threepidInvite,oobData:this.props.roomOobData,key:this.props.currentRoomId||"roomview",resizeNotifier:this.props.resizeNotifier,justCreatedOpts:this.props.roomJustCreatedOpts,forceTimeline:this.props.forceTimeline});break;case h.a.HomePage:e=o.a.createElement(Jt.a,{justRegistered:this.props.justRegistered});break;case h.a.UserView:this.props.currentUserId&&(e=o.a.createElement(Ed,{userId:this.props.currentUserId,resizeNotifier:this.props.resizeNotifier}))}const t=d()({mx_MatrixChat_wrapper:!0,mx_MatrixChat_useCompactLayout:this.state.useCompactLayout}),n=d()({mx_MatrixChat:!0,"mx_MatrixChat--with-avatar":this.state.backgroundImage}),a=this.state.activeCalls.map((e=>o.a.createElement(ln,{call:e,key:e.callId})));return o.a.createElement(I.a.Provider,{value:this._matrixClient},o.a.createElement("div",{onPaste:this.onPaste,onKeyDown:this.onReactKeyDown,className:t,"aria-hidden":this.props.hideToSRUsers},o.a.createElement(yd,null),o.a.createElement("div",{className:n},o.a.createElement("div",{className:"mx_LeftPanel_outerWrapper"},o.a.createElement(_d,{isMinimized:this.props.collapseLhs||!1}),o.a.createElement("nav",{className:"mx_LeftPanel_wrapper"},o.a.createElement(wd,{blurMultiplier:.5,backgroundImage:this.state.backgroundImage}),o.a.createElement(Ut,null),o.a.createElement(wd,{backgroundImage:this.state.backgroundImage}),o.a.createElement("div",{className:"mx_LeftPanel_wrapper--user",ref:this._resizeContainer,"data-collapsed":!!this.props.collapseLhs||void 0},o.a.createElement(en,{pageType:this.props.page_type,isMinimized:this.props.collapseLhs||!1,resizeNotifier:this.props.resizeNotifier})))),o.a.createElement(y,{passRef:this.resizeHandler,id:"lp-resizer"}),o.a.createElement("div",{className:"mx_RoomView_wrapper"},e))),o.a.createElement(Ad,null),o.a.createElement(nn,null),a)}}i()(Gd,"displayName","LoggedInView");t.a=Gd},1587:function(e,t,n){"use strict";n.d(t,"a",(function(){return Ki}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(165),l=n(2),c=n(173);let d=function(e){return e.Email="email",e.Phone="msisdn",e}({});var u=n(3),m=n(4),h=n(724),p=n(7),g=n(46),b=n(1309),v=n(11),f=n(31),y=n(63),E=n(10),w=n(802),S=n(201),_=n(279),C=n(113),O=n(639);class x extends o.a.Component{constructor(e){var t,n,a;super(e),i()(this,"userId",void 0),i()(this,"avatarUpload",Object(r.createRef)()),i()(this,"uploadAvatar",(()=>{var e;null===(e=this.avatarUpload.current)||void 0===e||e.click()})),i()(this,"removeAvatar",(()=>{this.avatarUpload.current&&(this.avatarUpload.current.value=""),this.setState({avatarUrl:void 0,avatarFile:null,enableProfileSave:!0})})),i()(this,"cancelProfileChanges",(async e=>{var t;e.stopPropagation(),e.preventDefault(),this.state.enableProfileSave&&this.setState({enableProfileSave:!1,displayName:this.state.originalDisplayName,avatarUrl:null!==(t=this.state.originalAvatarUrl)&&void 0!==t?t:void 0,avatarFile:null})})),i()(this,"saveProfile",(async e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.enableProfileSave)return;this.setState({enableProfileSave:!1});const t={},n=this.state.displayName.trim();try{const e=p.a.safeGet();if(this.state.originalDisplayName!==this.state.displayName&&(await e.setDisplayName(n),t.originalDisplayName=n,t.displayName=n),this.state.avatarFile){var a;u.a.log(`Uploading new avatar, ${this.state.avatarFile.name} of type ${this.state.avatarFile.type}, (${this.state.avatarFile.size}) bytes`);const{content_uri:n}=await e.uploadContent(this.state.avatarFile);await e.setAvatarUrl(n),t.avatarUrl=null!==(a=Object(y.b)(n).getSquareThumbnailHttp(96))&&void 0!==a?a:void 0,t.originalAvatarUrl=t.avatarUrl,t.avatarFile=null}else this.state.originalAvatarUrl!==this.state.avatarUrl&&await e.setAvatarUrl("")}catch(e){u.a.log("Failed to save profile",e),v.b.createDialog(f.a,{title:Object(l.b)("Failed to save your profile"),description:e instanceof Error?e.message:Object(l.b)("The operation could not be completed")})}this.setState(t)})),i()(this,"onDisplayNameChanged",(e=>{this.setState({displayName:e.target.value,enableProfileSave:!0})})),i()(this,"onAvatarChanged",(e=>{var t;if(!e.target.files||!e.target.files.length)return void this.setState({avatarUrl:null!==(t=this.state.originalAvatarUrl)&&void 0!==t?t:void 0,avatarFile:null,enableProfileSave:!1});const n=e.target.files[0],a=new FileReader;a.onload=e=>{var t,a;this.setState({avatarUrl:null!==(t=null===(a=e.target)||void 0===a?void 0:a.result)&&void 0!==t?t:void 0,avatarFile:n,enableProfileSave:!0})},a.readAsDataURL(n)})),this.userId=p.a.safeGet().getSafeUserId();let o=b.a.instance.avatarMxc;o&&(o=Object(y.b)(o).getSquareThumbnailHttp(96)),this.state={originalDisplayName:null!==(t=b.a.instance.displayName)&&void 0!==t?t:"",displayName:null!==(n=b.a.instance.displayName)&&void 0!==n?n:"",originalAvatarUrl:o,avatarUrl:null!==(a=o)&&void 0!==a?a:void 0,avatarFile:null,enableProfileSave:!1}}render(){var e;const t=S.a.getDisplayUserIdentifier(this.userId,{withDisplayName:!0}),n=null===(e=this.state.avatarUrl)||void 0===e?void 0:e.toString();return o.a.createElement("form",{onSubmit:this.saveProfile,autoComplete:"off",noValidate:!0,className:"mx_ProfileSettings"},o.a.createElement("input",{type:"file",ref:this.avatarUpload,className:"mx_ProfileSettings_avatarUpload",onClick:e=>{Object(_.a)(e),C.b.trackInteraction("WebProfileSettingsAvatarUploadButton",e)},onChange:this.onAvatarChanged,accept:"image/*"}),o.a.createElement("div",{className:"mx_ProfileSettings_profile"},o.a.createElement("div",{className:"mx_ProfileSettings_profile_controls"},o.a.createElement(O.a,{heading:Object(l.b)("Profile")}),o.a.createElement(g.a,{label:Object(l.b)("Display Name"),type:"text",value:this.state.displayName,autoComplete:"off",onChange:this.onDisplayNameChanged}),o.a.createElement("p",null,t&&o.a.createElement("span",{className:"mx_ProfileSettings_profile_controls_userId"},t))),o.a.createElement(w.a,{avatarUrl:n,avatarName:this.state.displayName||this.userId,avatarAltText:Object(l.b)("Profile picture"),uploadAvatar:this.uploadAvatar,removeAvatar:this.removeAvatar})),o.a.createElement("div",{className:"mx_ProfileSettings_buttons"},o.a.createElement(E.a,{onClick:this.cancelProfileChanges,kind:"link",disabled:!this.state.enableProfileSave},Object(l.b)("Cancel")),o.a.createElement(E.a,{onClick:this.saveProfile,kind:"primary",disabled:!this.state.enableProfileSave},Object(l.b)("Save"))))}}var k=n(5),R=n(1425),j=n(417),I=n(75),T=n(38);class P extends o.a.Component{constructor(e){super(e),this.onSearchChange=this.onSearchChange.bind(this),this.state={searchQuery:""}}componentDidMount(){const e=I.a.get();var t;e&&(null===(t=e.getAvailableSpellCheckLanguages())||void 0===t||t.then((e=>{e.sort((function(e,t){return e<t?-1:e>t?1:0}));const t=[];e.forEach((e=>{t.push({label:e,value:e})})),this.setState({languages:t})})).catch((e=>{this.setState({languages:[{value:"en",label:"English"}]})})))}onSearchChange(e){this.setState({searchQuery:e})}render(){if(!this.state.languages)return o.a.createElement(T.a,null);let e;e=this.state.searchQuery?this.state.languages.filter((e=>function(e,t){return!!t.label.toUpperCase().includes(e.toUpperCase())||t.value.toUpperCase()===e.toUpperCase()}(this.state.searchQuery,e))):this.state.languages;const t=e.map((e=>o.a.createElement("div",{key:e.value},e.label)));let n,a=k.b.getValue("language",null,!0);return a||(a=navigator.language||navigator.userLanguage),n=this.props.value||a,o.a.createElement(j.a,{id:"mx_LanguageDropdown",className:this.props.className,onOptionChange:this.props.onOptionChange,onSearchChange:this.onSearchChange,searchEnabled:!0,value:n,label:Object(l.b)("Language Dropdown"),placeholder:Object(l.b)("Choose a locale")},t)}}class N extends o.a.Component{constructor(...e){super(...e),i()(this,"onRemove",(e=>(e.stopPropagation(),e.preventDefault(),this.props.onRemoved(this.props.language))))}render(){return o.a.createElement("div",{className:"mx_ExistingSpellCheckLanguage"},o.a.createElement("span",{className:"mx_ExistingSpellCheckLanguage_language"},this.props.language),o.a.createElement(E.a,{onClick:this.onRemove,kind:"danger_sm"},Object(l.b)("Remove")))}}class D extends o.a.Component{constructor(e){super(e),i()(this,"onRemoved",(e=>{const t=this.props.languages.filter((t=>t!==e));this.props.onLanguagesChange(t)})),i()(this,"onAddClick",(e=>{e.stopPropagation(),e.preventDefault();const t=this.state.newLanguage;this.setState({newLanguage:""}),t&&(this.props.languages.includes(t)||(this.props.languages.push(t),this.props.onLanguagesChange(this.props.languages)))})),i()(this,"onNewLanguageChange",(e=>{this.state.newLanguage!==e&&this.setState({newLanguage:e})})),this.state={newLanguage:""}}render(){const e=this.props.languages.map((e=>o.a.createElement(N,{language:e,onRemoved:this.onRemoved,key:e}))),t=o.a.createElement(E.a,{onClick:this.onAddClick,kind:"primary"},Object(l.b)("Add"));return o.a.createElement(o.a.Fragment,null,e,o.a.createElement("form",{onSubmit:this.onAddClick,noValidate:!0},o.a.createElement(P,{className:"mx_GeneralUserSettingsTab_spellCheckLanguageInput",value:this.state.newLanguage,onOptionChange:this.onNewLanguageChange}),t))}}var M=n(574),A=n(316),L=n(161),U=n(34),F=n(9),B=n(14);class V extends o.a.Component{constructor(e){super(e),i()(this,"onStagePhaseChange",((e,t)=>{const n={[A.c.PHASE_PREAUTH]:{body:Object(l.b)("Confirm your account deactivation by using Single Sign On to prove your identity."),continueText:Object(l.b)("Single Sign On"),continueKind:"danger"},[A.c.PHASE_POSTAUTH]:{body:Object(l.b)("Are you sure you want to deactivate your account? This is irreversible."),continueText:Object(l.b)("Confirm account deactivation"),continueKind:"danger"}},a={[A.c.LOGIN_TYPE]:n,[A.c.UNSTABLE_LOGIN_TYPE]:n,[A.b.LOGIN_TYPE]:{[A.a]:{body:Object(l.b)("To continue, please enter your account password:")}}}[e];let i,r,o;if(a){const e=a[t];e&&(e.body&&(i=e.body),e.continueText&&(r=e.continueText),e.continueKind&&(o=e.continueKind))}this.setState({bodyText:i,continueText:r,continueKind:o})})),i()(this,"onUIAuthFinished",((e,t)=>{e||(t!==M.a?(u.a.error("Error during UI Auth:",{result:t}),this.setState({errStr:Object(l.b)("There was a problem communicating with the server. Please try again.")})):this.onCancel())})),i()(this,"onUIAuthComplete",(e=>{p.a.safeGet().deactivateAccount(null!=e?e:void 0,this.state.shouldErase).then((e=>{F.a.fire(B.a.TriggerLogout),this.props.onFinished(!0)})).catch((e=>{u.a.error(e),this.setState({errStr:Object(l.b)("There was a problem communicating with the server. Please try again.")})}))})),i()(this,"onEraseFieldChange",(e=>{this.setState({shouldErase:e.currentTarget.checked,authEnabled:!1}),this.initAuth(e.currentTarget.checked)})),this.state={shouldErase:!1,errStr:null,authData:null,authEnabled:!0},this.initAuth(!1)}onCancel(){this.props.onFinished(!1)}initAuth(e){p.a.safeGet().deactivateAccount(void 0,e).then((e=>{u.a.warn("User's account got deactivated without confirmation: Server had no auth"),this.setState({errStr:Object(l.b)("Server did not require any authentication")})})).catch((e=>{e&&401===e.httpStatus&&e.data?this.setState({authData:e.data,authEnabled:!0}):this.setState({errStr:Object(l.b)("Server did not return valid authentication information.")})}))}render(){let e;this.state.errStr&&(e=o.a.createElement("div",{className:"error"},this.state.errStr));let t=o.a.createElement("div",null,Object(l.b)("Loading…"));return this.state.authData&&this.state.authEnabled&&(t=o.a.createElement("div",null,this.state.bodyText,o.a.createElement(M.b,{matrixClient:p.a.safeGet(),authData:this.state.authData,makeRequest:this.onUIAuthComplete,onAuthFinished:this.onUIAuthFinished,onStagePhaseChange:this.onStagePhaseChange,continueText:this.state.continueText,continueKind:this.state.continueKind}))),o.a.createElement(U.a,{className:"mx_DeactivateAccountDialog",onFinished:this.props.onFinished,titleClass:"danger",title:Object(l.b)("Deactivate Account"),screenName:"DeactivateAccount"},o.a.createElement("div",{className:"mx_Dialog_content"},o.a.createElement("p",null,Object(l.b)("Confirm that you would like to deactivate your account. If you proceed:")),o.a.createElement("ul",null,o.a.createElement("li",null,Object(l.b)("You will not be able to reactivate your account")),o.a.createElement("li",null,Object(l.b)("You will no longer be able to log in")),o.a.createElement("li",null,Object(l.b)("No one will be able to reuse your username (MXID), including you: this username will remain unavailable")),o.a.createElement("li",null,Object(l.b)("You will leave all rooms and DMs that you are in")),o.a.createElement("li",null,Object(l.b)("You will be removed from the identity server: your friends will no longer be able to find you with your email or phone number"))),o.a.createElement("p",null,Object(l.b)("Your old messages will still be visible to people who received them, just like emails you sent in the past. Would you like to hide your sent messages from people who join rooms in the future?")),o.a.createElement("div",{className:"mx_DeactivateAccountDialog_input_section"},o.a.createElement("p",null,o.a.createElement(L.b,{checked:this.state.shouldErase,onChange:this.onEraseFieldChange},Object(l.b)("Hide my messages from new joiners"))),e,t)))}}var W=n(192),z=n(418),H=n(110),G=n(12);async function K(e,t){const n=e.getUserId();let{threepids:a}=await e.getThreePids();if(t&&(a=a.filter((e=>e.medium===t))),a.length>0&&e.getIdentityServerUrl())try{const i=new z.a,r=await i.getAccessToken({check:!1});if(!r)throw new Error("No identity access token found");const o=a.map((({medium:e,address:t})=>[e,t])),s=await e.bulkLookupThreePids(o,r);for(const[e,i,r]of s.threepids){if(r!==n)continue;if(t&&e!==t)continue;const o=a.find((t=>t.medium===e&&t.address===i));o&&(o.bound=!0)}}catch(e){if(!(e instanceof G.f)||"M_TERMS_NOT_SIGNED"!==e.errcode)throw e}return a}var q=n(15),$=n(40),Y=n(416);function J(e){const t=e.getIdentityServerUrl(!0);if(!t)throw new l.a("Identity server not set");return t}class Q{constructor(e){this.matrixClient=e,i()(this,"sessionId",void 0),i()(this,"submitUrl",void 0),i()(this,"bind",!1),i()(this,"clientSecret",void 0),i()(this,"makeAddThreepidOnlyRequest",(e=>this.matrixClient.addThreePidOnly({sid:this.sessionId,client_secret:this.clientSecret,auth:null!=e?e:void 0}))),this.clientSecret=e.generateClientSecret()}async addEmailAddress(e){try{const t=await this.matrixClient.requestAdd3pidEmailToken(e,this.clientSecret,1);return this.sessionId=t.sid,t}catch(e){if(e instanceof m.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new l.a("This email address is already in use",{cause:e});throw e}}async bindEmailAddress(e){if(this.bind=!0,!await this.matrixClient.doesServerSupportSeparateAddAndBind())return this.addEmailAddress(e);{var t;const n=new z.a,a=null!==(t=await n.getAccessToken())&&void 0!==t?t:void 0;try{const t=await this.matrixClient.requestEmailToken(e,this.clientSecret,1,void 0,a);return this.sessionId=t.sid,t}catch(e){if(e instanceof m.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new l.a("This email address is already in use",{cause:e});throw e}}}async addMsisdn(e,t){try{const n=await this.matrixClient.requestAdd3pidMsisdnToken(e,t,this.clientSecret,1);return this.sessionId=n.sid,this.submitUrl=n.submit_url,n}catch(e){if(e instanceof m.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new l.a("This phone number is already in use",{cause:e});throw e}}async bindMsisdn(e,t){if(this.bind=!0,!await this.matrixClient.doesServerSupportSeparateAddAndBind())return this.addMsisdn(e,t);{var n;const a=new z.a,i=null!==(n=await a.getAccessToken())&&void 0!==n?n:void 0;try{const n=await this.matrixClient.requestMsisdnToken(e,t,this.clientSecret,1,void 0,i);return this.sessionId=n.sid,n}catch(e){if(e instanceof m.MatrixError&&"M_THREEPID_IN_USE"===e.errcode)throw new l.a("This phone number is already in use",{cause:e});throw e}}}async checkEmailLinkClicked(){try{if(await this.matrixClient.doesServerSupportSeparateAddAndBind())if(this.bind){const e=new z.a,t=await e.getAccessToken();if(!t)throw new l.a("No identity access token found");await this.matrixClient.bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:J(this.matrixClient),id_access_token:t})}else try{return await this.makeAddThreepidOnlyRequest(),[!0]}catch(e){if(!(e instanceof m.MatrixError&&401===e.httpStatus&&e.data&&e.data.flows))throw e;const t={[A.c.PHASE_PREAUTH]:{title:Object(l.b)("Use Single Sign On to continue"),body:Object(l.b)("Confirm adding this email address by using Single Sign On to prove your identity."),continueText:Object(l.b)("Single Sign On"),continueKind:"primary"},[A.c.PHASE_POSTAUTH]:{title:Object(l.b)("Confirm adding email"),body:Object(l.b)("Click the button below to confirm adding this email address."),continueText:Object(l.b)("Confirm"),continueKind:"primary"}},{finished:n}=v.b.createDialog(Y.a,{title:Object(l.b)("Add Email Address"),matrixClient:this.matrixClient,authData:e.data,makeRequest:this.makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[A.c.LOGIN_TYPE]:t,[A.c.UNSTABLE_LOGIN_TYPE]:t}});return n}else await this.matrixClient.addThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:J(this.matrixClient)},this.bind)}catch(e){if(e instanceof m.HTTPError&&401===e.httpStatus)throw new l.a("Failed to verify email address: make sure you clicked the link in the email",{cause:e});throw e}return[]}async haveMsisdnToken(e){const t=new z.a,n=await this.matrixClient.doesServerSupportSeparateAddAndBind();let a;if(this.submitUrl)a=await this.matrixClient.submitMsisdnTokenOtherUrl(this.submitUrl,this.sessionId,this.clientSecret,e);else{if(!this.bind&&n)throw new l.a("The add / bind with MSISDN flow is misconfigured");a=await this.matrixClient.submitMsisdnToken(this.sessionId,this.clientSecret,e,await t.getAccessToken())}if(a instanceof Error)throw a;if(n)if(this.bind)await this.matrixClient.bindThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:J(this.matrixClient),id_access_token:await t.getAccessToken()});else try{return void await this.makeAddThreepidOnlyRequest()}catch(e){if(!(e instanceof m.MatrixError&&401===e.httpStatus&&e.data&&e.data.flows))throw e;const t={[A.c.PHASE_PREAUTH]:{title:Object(l.b)("Use Single Sign On to continue"),body:Object(l.b)("Confirm adding this phone number by using Single Sign On to prove your identity."),continueText:Object(l.b)("Single Sign On"),continueKind:"primary"},[A.c.PHASE_POSTAUTH]:{title:Object(l.b)("Confirm adding phone number"),body:Object(l.b)("Click the button below to confirm adding this phone number."),continueText:Object(l.b)("Confirm"),continueKind:"primary"}},{finished:n}=v.b.createDialog(Y.a,{title:Object(l.b)("Add Phone Number"),matrixClient:this.matrixClient,authData:e.data,makeRequest:this.makeAddThreepidOnlyRequest,aestheticsForStagePhases:{[A.c.LOGIN_TYPE]:t,[A.c.UNSTABLE_LOGIN_TYPE]:t}});return n}else await this.matrixClient.addThreePid({sid:this.sessionId,client_secret:this.clientSecret,id_server:J(this.matrixClient)},this.bind)}}var X=n(1366);class Z extends o.a.Component{constructor(e){super(e),i()(this,"onRemove",(e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})})),i()(this,"onDontRemove",(e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})})),i()(this,"onActuallyRemove",(e=>{e.stopPropagation(),e.preventDefault(),p.a.safeGet().deleteThreePid(this.props.msisdn.medium,this.props.msisdn.address).then((()=>this.props.onRemoved(this.props.msisdn))).catch((e=>{u.a.error("Unable to remove contact information: "+e),v.b.createDialog(f.a,{title:Object(l.b)("Unable to remove contact information"),description:Object(f.b)(e,Object(l.b)("Operation failed"))})}))})),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?o.a.createElement("div",{className:"mx_GeneralUserSettingsTab_section--discovery_existing"},o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_promptText"},Object(l.b)("Remove %(phone)s?",{phone:this.props.msisdn.address})),o.a.createElement(E.a,{onClick:this.onActuallyRemove,kind:"danger_sm",className:"mx_GeneralUserSettingsTab_section--discovery_existing_button"},Object(l.b)("Remove")),o.a.createElement(E.a,{onClick:this.onDontRemove,kind:"link_sm",className:"mx_GeneralUserSettingsTab_section--discovery_existing_button"},Object(l.b)("Cancel"))):o.a.createElement("div",{className:"mx_GeneralUserSettingsTab_section--discovery_existing"},o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_address"},"+",this.props.msisdn.address),o.a.createElement(E.a,{onClick:this.onRemove,kind:"danger_sm"},Object(l.b)("Remove")))}}class ee extends o.a.Component{constructor(e){super(e),i()(this,"onRemoved",(e=>{const t=this.props.msisdns.filter((t=>t!==e));this.props.onMsisdnsChange(t)})),i()(this,"onChangeNewPhoneNumber",(e=>{this.setState({newPhoneNumber:e.target.value})})),i()(this,"onChangeNewPhoneNumberCode",(e=>{this.setState({newPhoneNumberCode:e.target.value})})),i()(this,"onAddClick",(e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.newPhoneNumber)return;const t=this.state.newPhoneNumber,n=this.state.phoneCountry,a=new Q(p.a.safeGet());this.setState({verifying:!0,continueDisabled:!0,addTask:a}),a.addMsisdn(n,t).then((e=>{this.setState({continueDisabled:!1,verifyMsisdn:e.msisdn})})).catch((e=>{u.a.error("Unable to add phone number "+t+" "+e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),v.b.createDialog(f.a,{title:Object(l.b)("Error"),description:Object(f.b)(e,Object(l.b)("Operation failed"))})}))})),i()(this,"onContinueClick",(e=>{var t;e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});const n=this.state.newPhoneNumberCode,a=this.state.verifyMsisdn;null===(t=this.state.addTask)||void 0===t||t.haveMsisdnToken(n).then((([e]=[])=>{let t=this.state.newPhoneNumber;if(e){const e=[...this.props.msisdns,{address:a,medium:d.Phone}];this.props.onMsisdnsChange(e),t=""}this.setState({addTask:null,continueDisabled:!1,verifying:!1,verifyMsisdn:"",verifyError:null,newPhoneNumber:t,newPhoneNumberCode:""})})).catch((e=>{u.a.error("Unable to verify phone number: "+e),this.setState({continueDisabled:!1});let t=e;e instanceof l.a&&(t=e.cause),"M_THREEPID_AUTH_FAILED"!==t.errcode?v.b.createDialog(f.a,{title:Object(l.b)("Unable to verify phone number."),description:Object(f.b)(e,Object(l.b)("Operation failed"))}):this.setState({verifyError:Object(l.b)("Incorrect verification code")})}))})),i()(this,"onCountryChanged",(e=>{this.setState({phoneCountry:e.iso2})})),this.state={verifying:!1,verifyError:null,verifyMsisdn:"",addTask:null,continueDisabled:!1,phoneCountry:"",newPhoneNumber:"",newPhoneNumberCode:""}}render(){const e=this.props.msisdns.map((e=>o.a.createElement(Z,{msisdn:e,onRemoved:this.onRemoved,key:e.address})));let t=o.a.createElement(E.a,{onClick:this.onAddClick,kind:"primary"},Object(l.b)("Add"));if(this.state.verifying){const e=this.state.verifyMsisdn;t=o.a.createElement("div",null,o.a.createElement("div",null,Object(l.b)("A text message has been sent to +%(msisdn)s. Please enter the verification code it contains.",{msisdn:e}),o.a.createElement("br",null),this.state.verifyError),o.a.createElement("form",{onSubmit:this.onContinueClick,autoComplete:"off",noValidate:!0},o.a.createElement(g.a,{type:"text",label:Object(l.b)("Verification code"),autoComplete:"off",disabled:this.state.continueDisabled,value:this.state.newPhoneNumberCode,onChange:this.onChangeNewPhoneNumberCode}),o.a.createElement(E.a,{onClick:this.onContinueClick,kind:"primary",disabled:this.state.continueDisabled||0===this.state.newPhoneNumberCode.length},Object(l.b)("Continue"))))}const n=o.a.createElement(X.a,{onOptionChange:this.onCountryChanged,className:"mx_PhoneNumbers_country",value:this.state.phoneCountry,disabled:this.state.verifying,isSmall:!0,showPrefix:!0});return o.a.createElement(o.a.Fragment,null,e,o.a.createElement("form",{onSubmit:this.onAddClick,autoComplete:"off",noValidate:!0,className:"mx_PhoneNumbers_new"},o.a.createElement("div",{className:"mx_PhoneNumbers_input"},o.a.createElement(g.a,{type:"text",label:Object(l.b)("Phone Number"),autoComplete:"tel-national",disabled:this.state.verifying,prefixComponent:n,value:this.state.newPhoneNumber,onChange:this.onChangeNewPhoneNumber}))),t)}}var te=n(421);class ne extends o.a.Component{constructor(e){super(e),i()(this,"onRemove",(e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!0})})),i()(this,"onDontRemove",(e=>{e.stopPropagation(),e.preventDefault(),this.setState({verifyRemove:!1})})),i()(this,"onActuallyRemove",(e=>{e.stopPropagation(),e.preventDefault(),p.a.safeGet().deleteThreePid(this.props.email.medium,this.props.email.address).then((()=>this.props.onRemoved(this.props.email))).catch((e=>{u.a.error("Unable to remove contact information: "+e),v.b.createDialog(f.a,{title:Object(l.b)("Unable to remove contact information"),description:e&&e.message?e.message:Object(l.b)("Operation failed")})}))})),this.state={verifyRemove:!1}}render(){return this.state.verifyRemove?o.a.createElement("div",{className:"mx_GeneralUserSettingsTab_section--discovery_existing"},o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_promptText"},Object(l.b)("Remove %(email)s?",{email:this.props.email.address})),o.a.createElement(E.a,{onClick:this.onActuallyRemove,kind:"danger_sm",className:"mx_GeneralUserSettingsTab_section--discovery_existing_button"},Object(l.b)("Remove")),o.a.createElement(E.a,{onClick:this.onDontRemove,kind:"link_sm",className:"mx_GeneralUserSettingsTab_section--discovery_existing_button"},Object(l.b)("Cancel"))):o.a.createElement("div",{className:"mx_GeneralUserSettingsTab_section--discovery_existing"},o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_address"},this.props.email.address),o.a.createElement(E.a,{onClick:this.onRemove,kind:"danger_sm"},Object(l.b)("Remove")))}}class ae extends o.a.Component{constructor(e){super(e),i()(this,"onRemoved",(e=>{const t=this.props.emails.filter((t=>t!==e));this.props.onEmailsChange(t)})),i()(this,"onChangeNewEmailAddress",(e=>{this.setState({newEmailAddress:e.target.value})})),i()(this,"onAddClick",(e=>{if(e.stopPropagation(),e.preventDefault(),!this.state.newEmailAddress)return;const t=this.state.newEmailAddress;if(!te.a(t))return void v.b.createDialog(f.a,{title:Object(l.b)("Invalid Email Address"),description:Object(l.b)("This doesn't appear to be a valid email address")});const n=new Q(p.a.safeGet());this.setState({verifying:!0,continueDisabled:!0,addTask:n}),n.addEmailAddress(t).then((()=>{this.setState({continueDisabled:!1})})).catch((e=>{u.a.error("Unable to add email address "+t+" "+e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),v.b.createDialog(f.a,{title:Object(l.b)("Unable to add email address"),description:Object(f.b)(e,Object(l.b)("Operation failed"))})}))})),i()(this,"onContinueClick",(e=>{var t;e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0}),null===(t=this.state.addTask)||void 0===t||t.checkEmailLinkClicked().then((([e])=>{let t=this.state.newEmailAddress;if(e){const e=this.state.newEmailAddress,n=[...this.props.emails,{address:e,medium:d.Email}];this.props.onEmailsChange(n),t=""}this.setState({addTask:null,continueDisabled:!1,verifying:!1,newEmailAddress:t})})).catch((e=>{u.a.error("Unable to verify email address: ",e),this.setState({continueDisabled:!1});let t=e;e instanceof l.a&&(t=e.cause),t instanceof m.MatrixError&&"M_THREEPID_AUTH_FAILED"===t.errcode?v.b.createDialog(f.a,{title:Object(l.b)("Your email address hasn't been verified yet"),description:Object(l.b)("Click the link in the email you received to verify and then click continue again.")}):v.b.createDialog(f.a,{title:Object(l.b)("Unable to verify email address."),description:Object(f.b)(e,Object(l.b)("Operation failed"))})}))})),this.state={verifying:!1,addTask:null,continueDisabled:!1,newEmailAddress:""}}render(){const e=this.props.emails.map((e=>o.a.createElement(ne,{email:e,onRemoved:this.onRemoved,key:e.address})));let t=o.a.createElement(E.a,{onClick:this.onAddClick,kind:"primary"},Object(l.b)("Add"));return this.state.verifying&&(t=o.a.createElement("div",null,o.a.createElement("div",null,Object(l.b)("We've sent you an email to verify your address. Please follow the instructions there and then click the button below.")),o.a.createElement(E.a,{onClick:this.onContinueClick,kind:"primary",disabled:this.state.continueDisabled},Object(l.b)("Continue")))),o.a.createElement(o.a.Fragment,null,e,o.a.createElement("form",{onSubmit:this.onAddClick,autoComplete:"off",noValidate:!0},o.a.createElement(g.a,{type:"text",label:Object(l.b)("Email Address"),autoComplete:"email",disabled:this.state.verifying,value:this.state.newEmailAddress,onChange:this.onChangeNewEmailAddress}),t))}}var ie=n(218),re=n(183);class oe extends o.a.Component{constructor(e){super(e),i()(this,"onRevokeClick",(e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!1,label:"revoke",errorTitle:Object(l.b)("Unable to revoke sharing for email address")})})),i()(this,"onShareClick",(e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!0,label:"share",errorTitle:Object(l.b)("Unable to share email address")})})),i()(this,"onContinueClick",(async e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});try{var t;await(null===(t=this.state.addTask)||void 0===t?void 0:t.checkEmailLinkClicked()),this.setState({addTask:null,verifying:!1})}catch(e){u.a.error("Unable to verify email address:",e);let t=e;e instanceof l.a&&(t=e.cause),t instanceof m.MatrixError&&"M_THREEPID_AUTH_FAILED"===t.errcode?v.b.createDialog(f.a,{title:Object(l.b)("Your email address hasn't been verified yet"),description:Object(l.b)("Click the link in the email you received to verify and then click continue again.")}):(u.a.error("Unable to verify email address: "+e),v.b.createDialog(f.a,{title:Object(l.b)("Unable to verify email address."),description:Object(f.b)(e,Object(l.b)("Operation failed"))}))}finally{this.setState({continueDisabled:!1})}}));const{bound:t}=e.email;this.state={verifying:!1,addTask:null,continueDisabled:!1,bound:t}}componentDidUpdate(e){if(this.props.email!==e.email){const{bound:e}=this.props.email;this.setState({bound:e})}}async changeBinding({bind:e,label:t,errorTitle:n}){if(!await p.a.safeGet().doesServerSupportSeparateAddAndBind())return this.changeBindingTangledAddBind({bind:e,label:t,errorTitle:n});const{medium:a,address:i}=this.props.email;try{if(e){const e=new Q(p.a.safeGet());this.setState({verifying:!0,continueDisabled:!0,addTask:e}),await e.bindEmailAddress(i),this.setState({continueDisabled:!1})}else await p.a.safeGet().unbindThreePid(a,i);this.setState({bound:e})}catch(e){u.a.error(`changeBinding: Unable to ${t} email address ${i}`,e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),v.b.createDialog(f.a,{title:n,description:Object(f.b)(e,Object(l.b)("Operation failed"))})}}async changeBindingTangledAddBind({bind:e,label:t,errorTitle:n}){const{medium:a,address:i}=this.props.email,r=new Q(p.a.safeGet());this.setState({verifying:!0,continueDisabled:!0,addTask:r});try{await p.a.safeGet().deleteThreePid(a,i),e?await r.bindEmailAddress(i):await r.addEmailAddress(i),this.setState({continueDisabled:!1,bound:e})}catch(e){u.a.error(`changeBindingTangledAddBind: Unable to ${t} email address ${i}`,e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),v.b.createDialog(f.a,{title:n,description:Object(f.b)(e,Object(l.b)("Operation failed"))})}}render(){const{address:e}=this.props.email,{verifying:t,bound:n}=this.state;let a;return a=t?o.a.createElement("span",null,Object(l.b)("Verify the link in your inbox"),o.a.createElement(E.a,{className:"mx_GeneralUserSettingsTab_section--discovery_existing_button",kind:"primary_sm",onClick:this.onContinueClick,disabled:this.state.continueDisabled},Object(l.b)("Complete"))):n?o.a.createElement(E.a,{className:"mx_GeneralUserSettingsTab_section--discovery_existing_button",kind:"danger_sm",onClick:this.onRevokeClick},Object(l.b)("Revoke")):o.a.createElement(E.a,{className:"mx_GeneralUserSettingsTab_section--discovery_existing_button",kind:"primary_sm",onClick:this.onShareClick},Object(l.b)("Share")),o.a.createElement("div",{className:"mx_GeneralUserSettingsTab_section--discovery_existing"},o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_address"},e),a)}}class se extends o.a.Component{render(){let e;this.props.isLoading?e=o.a.createElement(re.a,null):this.props.emails.length>0&&(e=this.props.emails.map((e=>o.a.createElement(oe,{email:e,key:e.address}))));const t=!!this.props.emails.length;return o.a.createElement(ie.b,{heading:Object(l.b)("Email addresses"),description:!t&&Object(l.b)("Discovery options will appear once you have added an email above.")||void 0,stretchContent:!0},e)}}class le extends o.a.Component{constructor(e){super(e),i()(this,"onRevokeClick",(e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!1,label:"revoke",errorTitle:Object(l.b)("Unable to revoke sharing for phone number")})})),i()(this,"onShareClick",(e=>{e.stopPropagation(),e.preventDefault(),this.changeBinding({bind:!0,label:"share",errorTitle:Object(l.b)("Unable to share phone number")})})),i()(this,"onVerificationCodeChange",(e=>{this.setState({verificationCode:e.target.value})})),i()(this,"onContinueClick",(async e=>{e.stopPropagation(),e.preventDefault(),this.setState({continueDisabled:!0});const t=this.state.verificationCode;try{var n;await(null===(n=this.state.addTask)||void 0===n?void 0:n.haveMsisdnToken(t)),this.setState({addTask:null,continueDisabled:!1,verifying:!1,verifyError:null,verificationCode:""})}catch(e){u.a.error("Unable to verify phone number:",e);let t=e;e instanceof l.a&&(t=e.cause),this.setState({continueDisabled:!1}),t instanceof m.MatrixError&&"M_THREEPID_AUTH_FAILED"!==t.errcode?v.b.createDialog(f.a,{title:Object(l.b)("Unable to verify phone number."),description:Object(f.b)(e,Object(l.b)("Operation failed"))}):this.setState({verifyError:Object(l.b)("Incorrect verification code")})}}));const{bound:t}=e.msisdn;this.state={verifying:!1,verificationCode:"",addTask:null,continueDisabled:!1,bound:t,verifyError:null}}componentDidUpdate(e){if(this.props.msisdn!==e.msisdn){const{bound:e}=this.props.msisdn;this.setState({bound:e})}}async changeBinding({bind:e,label:t,errorTitle:n}){if(!await p.a.safeGet().doesServerSupportSeparateAddAndBind())return this.changeBindingTangledAddBind({bind:e,label:t,errorTitle:n});const{medium:a,address:i}=this.props.msisdn;try{if(e){const e=new Q(p.a.safeGet());this.setState({verifying:!0,continueDisabled:!0,addTask:e}),await e.bindMsisdn(null,`+${i}`),this.setState({continueDisabled:!1})}else await p.a.safeGet().unbindThreePid(a,i);this.setState({bound:e})}catch(e){u.a.error(`changeBinding: Unable to ${t} phone number ${i}`,e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),v.b.createDialog(f.a,{title:n,description:Object(f.b)(e,Object(l.b)("Operation failed"))})}}async changeBindingTangledAddBind({bind:e,label:t,errorTitle:n}){const{medium:a,address:i}=this.props.msisdn,r=new Q(p.a.safeGet());this.setState({verifying:!0,continueDisabled:!0,addTask:r});try{await p.a.safeGet().deleteThreePid(a,i),e?await r.bindMsisdn(null,`+${i}`):await r.addMsisdn(null,`+${i}`),this.setState({continueDisabled:!1,bound:e})}catch(e){u.a.error(`changeBindingTangledAddBind: Unable to ${t} phone number ${i}`,e),this.setState({verifying:!1,continueDisabled:!1,addTask:null}),v.b.createDialog(f.a,{title:n,description:Object(f.b)(e,Object(l.b)("Operation failed"))})}}render(){const{address:e}=this.props.msisdn,{verifying:t,bound:n}=this.state;let a;return a=t?o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_verification"},o.a.createElement("span",null,Object(l.b)("Please enter verification code sent via text."),o.a.createElement("br",null),this.state.verifyError),o.a.createElement("form",{onSubmit:this.onContinueClick,autoComplete:"off",noValidate:!0},o.a.createElement(g.a,{type:"text",label:Object(l.b)("Verification code"),autoComplete:"off",disabled:this.state.continueDisabled,value:this.state.verificationCode,onChange:this.onVerificationCodeChange}))):n?o.a.createElement(E.a,{className:"mx_GeneralUserSettingsTab_section--discovery_existing_button",kind:"danger_sm",onClick:this.onRevokeClick},Object(l.b)("Revoke")):o.a.createElement(E.a,{className:"mx_GeneralUserSettingsTab_section--discovery_existing_button",kind:"primary_sm",onClick:this.onShareClick},Object(l.b)("Share")),o.a.createElement("div",{className:"mx_GeneralUserSettingsTab_section--discovery_existing"},o.a.createElement("span",{className:"mx_GeneralUserSettingsTab_section--discovery_existing_address"},"+",e),a)}}class ce extends o.a.Component{render(){let e;this.props.isLoading?e=o.a.createElement(re.a,null):this.props.msisdns.length>0&&(e=this.props.msisdns.map((e=>o.a.createElement(le,{msisdn:e,key:e.address}))));const t=!e&&Object(l.b)("Discovery options will appear once you have added a phone number above.")||void 0;return o.a.createElement(ie.b,{"data-testid":"mx_DiscoveryPhoneNumbers",heading:Object(l.b)("Phone numbers"),description:t,stretchContent:!0},e)}}var de=n(229),ue=n(1317),me=n(1375),he=n(77),pe=n(16),ge=n(43),be=function(e){return e.Display="display",e.Edit="edit",e}(be||{});class ve extends o.a.Component{constructor(e){super(e),i()(this,"value",""),i()(this,"placeholder",!1),i()(this,"editableDiv",Object(r.createRef)()),i()(this,"showPlaceholder",(e=>{this.editableDiv.current&&(e?(this.editableDiv.current.textContent=this.props.placeholder,this.editableDiv.current.setAttribute("class",this.props.className+" "+this.props.placeholderClassName),this.placeholder=!0,this.value=""):(this.editableDiv.current.textContent=this.value,this.editableDiv.current.setAttribute("class",this.props.className),this.placeholder=!1))})),i()(this,"cancelEdit",(()=>{var e;this.setState({phase:be.Display}),this.value=this.props.initialValue,this.showPlaceholder(!this.value),this.onValueChanged(!1),null===(e=this.editableDiv.current)||void 0===e||e.blur()})),i()(this,"onValueChanged",(e=>{var t,n;null===(t=(n=this.props).onValueChanged)||void 0===t||t.call(n,this.value,e)})),i()(this,"onKeyDown",(e=>{this.placeholder&&this.showPlaceholder(!1);if(Object(ge.a)().getAccessibilityAction(e)===pe.h.Enter)e.stopPropagation(),e.preventDefault()})),i()(this,"onKeyUp",(e=>{if(e.target.textContent){if(!this.placeholder){var t;this.value=null!==(t=e.target.textContent)&&void 0!==t?t:""}}else this.showPlaceholder(!0);switch(Object(ge.a)().getAccessibilityAction(e)){case pe.h.Escape:this.cancelEdit();break;case pe.h.Enter:this.onFinish(e)}})),i()(this,"onClickDiv",(()=>{this.props.editable&&this.setState({phase:be.Edit})})),i()(this,"onFocus",(e=>{const t=e.target.childNodes[0];if(t){const n=document.createRange();n.setStart(t,0),n.setEnd(t,e.target.childNodes.length);const a=window.getSelection();a.removeAllRanges(),a.addRange(n)}})),i()(this,"onFinish",((e,t=!1)=>{const n=this,a=Object(ge.a)().getAccessibilityAction(e)===pe.h.Enter||t;this.setState({phase:be.Display},(()=>{this.value!==this.props.initialValue&&n.onValueChanged(a)}))})),i()(this,"onBlur",(e=>{window.getSelection().removeAllRanges(),this.props.blurToCancel?this.cancelEdit():this.onFinish(e,this.props.blurToSubmit),this.showPlaceholder(!this.value)})),this.state={phase:be.Display}}componentDidUpdate(e){e.initialValue!==this.props.initialValue&&(this.value=this.props.initialValue,this.editableDiv.current&&this.showPlaceholder(!this.value))}componentDidMount(){this.value=this.props.initialValue,this.editableDiv.current&&this.showPlaceholder(!this.value)}render(){const{className:e,editable:t,initialValue:n,label:a,labelClassName:i}=this.props;let r;return r=!t||this.state.phase===be.Display&&(a||i)&&!this.value?o.a.createElement("div",{className:e+" "+i,onClick:this.onClickDiv},a||n):o.a.createElement("div",{ref:this.editableDiv,contentEditable:!0,className:e,onKeyDown:this.onKeyDown,onKeyUp:this.onKeyUp,onFocus:this.onFocus,onBlur:this.onBlur}),r}}i()(ve,"defaultProps",{onValueChanged(){},initialValue:"",label:"",placeholder:"",editable:!0,className:"mx_EditableText",placeholderClassName:"mx_EditableText_placeholder",blurToSubmit:!1});class fe extends o.a.Component{constructor(e){super(e),i()(this,"addThreepid",void 0),i()(this,"onEmailAddressChanged",(e=>{this.setState({emailAddress:e})})),i()(this,"onSubmit",(()=>{const e=this.state.emailAddress;te.a(e)?(this.addThreepid=new Q(p.a.safeGet()),this.addThreepid.addEmailAddress(e).then((()=>{v.b.createDialog(he.a,{title:Object(l.b)("Verification Pending"),description:Object(l.b)("Please check your email and click on the link it contains. Once this is done, click continue."),button:Object(l.b)("Continue"),onFinished:this.onEmailDialogFinished})}),(t=>{this.setState({emailBusy:!1}),u.a.error("Unable to add email address "+e+" "+t),v.b.createDialog(f.a,{title:Object(l.b)("Unable to add email address"),description:Object(f.b)(t,Object(l.b)("Operation failed"))})})),this.setState({emailBusy:!0})):v.b.createDialog(f.a,{title:Object(l.b)("Invalid Email Address"),description:Object(l.b)("This doesn't appear to be a valid email address")})})),i()(this,"onCancelled",(()=>{this.props.onFinished(!1)})),i()(this,"onEmailDialogFinished",(e=>{e?this.verifyEmailAddress():this.setState({emailBusy:!1})})),this.state={emailAddress:"",emailBusy:!1}}verifyEmailAddress(){var e;null===(e=this.addThreepid)||void 0===e||e.checkEmailLinkClicked().then((()=>{this.props.onFinished(!0)}),(e=>{this.setState({emailBusy:!1});let t=e;if(e instanceof l.a&&(t=e.cause),t instanceof m.MatrixError&&"M_THREEPID_AUTH_FAILED"===t.errcode){const e=Object(l.b)("Unable to verify email address.")+" "+Object(l.b)("Please check your email and click on the link it contains. Once this is done, click continue.");v.b.createDialog(he.a,{title:Object(l.b)("Verification Pending"),description:e,button:Object(l.b)("Continue"),onFinished:this.onEmailDialogFinished})}else u.a.error("Unable to verify email address: "+e),v.b.createDialog(f.a,{title:Object(l.b)("Unable to verify email address."),description:Object(f.b)(e,Object(l.b)("Operation failed"))})}))}render(){const e=this.state.emailBusy?o.a.createElement(T.a,null):o.a.createElement(ve,{initialValue:this.state.emailAddress,className:"mx_SetEmailDialog_email_input",placeholder:Object(l.b)("Email address"),placeholderClassName:"mx_SetEmailDialog_email_input_placeholder",blurToCancel:!1,onValueChanged:this.onEmailAddressChanged});return o.a.createElement(U.a,{className:"mx_SetEmailDialog",onFinished:this.onCancelled,title:this.props.title,contentId:"mx_Dialog_content"},o.a.createElement("div",{className:"mx_Dialog_content"},o.a.createElement("p",{id:"mx_Dialog_content"},Object(l.b)("This will allow you to reset your password and receive notifications.")),e),o.a.createElement("div",{className:"mx_Dialog_buttons"},o.a.createElement("input",{className:"mx_Dialog_primary",type:"submit",value:Object(l.b)("Continue"),onClick:this.onSubmit}),o.a.createElement("input",{type:"submit",value:Object(l.b)("Skip"),onClick:this.onCancelled})))}}const ye="field_old_password",Ee="field_new_password",we="field_new_password_confirm";var Se=function(e){return e.Edit="edit",e.Uploading="uploading",e.Error="error",e}(Se||{});class _e extends o.a.Component{constructor(e){super(e),i()(this,ye,null),i()(this,Ee,null),i()(this,we,null),i()(this,"onExportE2eKeysClicked",(()=>{v.b.createDialogAsync(n.e(7).then(n.bind(null,1583)),{matrixClient:p.a.safeGet()})})),i()(this,"onChangeOldPassword",(e=>{this.setState({oldPassword:e.target.value})})),i()(this,"onOldPasswordValidate",(async e=>{const t=await this.validateOldPasswordRules(e);return this.markFieldValid(ye,t.valid),t})),i()(this,"validateOldPasswordRules",Object(de.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(l.b)("Passwords can't be empty")}]})),i()(this,"onChangeNewPassword",(e=>{this.setState({newPassword:e.target.value})})),i()(this,"onNewPasswordValidate",(e=>{this.markFieldValid(Ee,e.valid)})),i()(this,"onChangeNewPasswordConfirm",(e=>{this.setState({newPasswordConfirm:e.target.value})})),i()(this,"onNewPasswordConfirmValidate",(async e=>{const t=await this.validatePasswordConfirmRules(e);return this.markFieldValid(we,t.valid),t})),i()(this,"validatePasswordConfirmRules",Object(de.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(l.b)("Confirm password")},{key:"match",test({value:e}){return!e||e===this.state.newPassword},invalid:()=>Object(l.b)("Passwords don't match")}]})),i()(this,"onClickChange",(async e=>{e.preventDefault();if(!await this.verifyFieldsBeforeSubmit())return;const t=this.state.oldPassword,n=this.state.newPassword,a=this.state.newPasswordConfirm;try{return this.checkPassword(t,n,a),this.onChangePassword(t,n)}catch(e){e instanceof Error?this.props.onError(e):this.props.onError(new l.a("Error while changing password: %(error)s",{error:String(e),cause:void 0}))}})),this.state={fieldValid:{},phase:Se.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""}}async onChangePassword(e,t){const n=p.a.safeGet(),a=await n.doesServerSupportLogoutDevices(),i=(await n.getDevices()).devices.length>1;if(i&&!a&&this.props.confirm){const{finished:e}=v.b.createDialog(he.a,{title:Object(l.b)("Warning!"),description:o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("Changing your password on this homeserver will cause all of your other devices to be signed out. This will delete the message encryption keys stored on them, and may make encrypted chat history unreadable.")),o.a.createElement("p",null,Object(l.b)("If you want to retain access to your chat history in encrypted rooms you should first export your room keys and re-import them afterwards.")),o.a.createElement("p",null,Object(l.b)("You can also ask your homeserver admin to upgrade the server to change this behaviour."))),button:Object(l.b)("Continue"),extraButtons:[o.a.createElement("button",{key:"exportRoomKeys",className:"mx_Dialog_primary",onClick:this.onExportE2eKeysClicked},Object(l.b)("Export E2E room keys"))]}),[t]=await e;if(!t)return}this.changePassword(n,e,t,a,i)}changePassword(e,t,n,a,i){var r;const o={type:"m.login.password",identifier:{type:"m.id.user",user:e.credentials.userId},user:null!==(r=e.credentials.userId)&&void 0!==r?r:void 0,password:t};this.setState({phase:Se.Uploading});const s=!a&&void 0,c=!a&&i;e.setPassword(o,n,s).then((()=>{if(this.props.shouldAskForEmail)return this.optionallySetEmail().then((e=>{this.props.onFinished({didSetEmail:e,didLogoutOutOtherDevices:c})}));this.props.onFinished({didLogoutOutOtherDevices:c})}),(e=>{e instanceof Error?this.props.onError(e):this.props.onError(new l.a("Error while changing password: %(error)s",{error:String(e),cause:void 0}))})).finally((()=>{this.setState({phase:Se.Edit,oldPassword:"",newPassword:"",newPasswordConfirm:""})}))}checkPassword(e,t,n){if(t!==n)throw new l.a("New passwords don't match");if(!t||0===t.length)throw new l.a("Passwords can't be empty")}optionallySetEmail(){return v.b.createDialog(fe,{title:Object(l.b)("Do you want to set an email address?")}).finished.then((([e])=>!!e))}markFieldValid(e,t){const{fieldValid:n}=this.state;n[e]=t,this.setState({fieldValid:n})}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[ye,Ee,we];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise((e=>this.setState({},e))),this.allFieldsValid())return!0;const n=this.findFirstInvalidField(t);return!n||(n.focus(),n.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){return Object.values(this.state.fieldValid).every(Boolean)}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}render(){const e=this.props.rowClassName,t=this.props.buttonClassName;switch(this.state.phase){case Se.Edit:return o.a.createElement("form",{className:this.props.className,onSubmit:this.onClickChange},o.a.createElement("div",{className:e},o.a.createElement(g.a,{ref:e=>this[ye]=e,type:"password",label:Object(l.b)("Current password"),value:this.state.oldPassword,onChange:this.onChangeOldPassword,onValidate:this.onOldPasswordValidate})),o.a.createElement("div",{className:e},o.a.createElement(ue.a,{fieldRef:e=>this[Ee]=e,type:"password",label:Object(l.d)("New Password"),minScore:me.a,value:this.state.newPassword,autoFocus:this.props.autoFocusNewPasswordInput,onChange:this.onChangeNewPassword,onValidate:this.onNewPasswordValidate,autoComplete:"new-password"})),o.a.createElement("div",{className:e},o.a.createElement(g.a,{ref:e=>this[we]=e,type:"password",label:Object(l.b)("Confirm password"),value:this.state.newPasswordConfirm,onChange:this.onChangeNewPasswordConfirm,onValidate:this.onNewPasswordConfirmValidate,autoComplete:"new-password"})),o.a.createElement(E.a,{className:t,kind:this.props.buttonKind,onClick:this.onClickChange},this.props.buttonLabel||Object(l.b)("Change Password")));case Se.Uploading:return o.a.createElement("div",{className:"mx_Dialog_content"},o.a.createElement(T.a,null))}}}i()(_e,"defaultProps",{onFinished(){},onError(){},confirm:!0});var Ce=n(88);class Oe extends o.a.Component{constructor(e){super(e),i()(this,"togglePolicy",(e=>{const t=Object(Ce.b)(this.state.policies);t[e].checked=!t[e].checked,this.setState({policies:t})})),i()(this,"onContinue",(()=>{!!this.state.policies.some((e=>!e.checked))||(this.setState({busy:!0}),this.props.onFinished(this.state.policies.map((e=>e.url))))})),this.state={policies:[],busy:!1}}componentDidMount(){const e=[];for(const t of this.props.policiesAndServicePairs){const n=Object.values(t.policies);for(const t of n){const n=Object(l.j)(Object.keys(t).filter((e=>"version"!==e))),a={checked:!1,url:t[n].url,name:t[n].name};e.push(a)}}this.setState({policies:e})}renderCheckboxes(){const e=[];for(let t=0;t<this.state.policies.length;t++){const n=this.state.policies[t],a=Object(l.b)("Accept <policyLink /> to continue:",{},{policyLink:()=>o.a.createElement("a",{href:n.url,rel:"noreferrer noopener",target:"_blank"},n.name,o.a.createElement("span",{className:"mx_InlineTermsAgreement_link"}))});e.push(o.a.createElement("div",{key:t,className:"mx_InlineTermsAgreement_cbContainer"},o.a.createElement("div",null,a),o.a.createElement("div",{className:"mx_InlineTermsAgreement_checkbox"},o.a.createElement(L.b,{onChange:()=>this.togglePolicy(t),checked:n.checked},Object(l.b)("Accept")))))}return e}render(){const e=!!this.state.policies.some((e=>!e.checked));return o.a.createElement("div",null,this.props.introElement,this.renderCheckboxes(),o.a.createElement(E.a,{onClick:this.onContinue,disabled:e||this.state.busy,kind:"primary_sm"},Object(l.b)("Continue")))}}var xe=n(248),ke=n(188),Re=n(156);class je extends o.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",(e=>{"id_server_changed"===e.action&&this.setState({currentClientIdServer:p.a.safeGet().getIdentityServerUrl()})})),i()(this,"onIdentityServerChanged",(e=>{const t=e.target.value;this.setState({idServer:t})})),i()(this,"getTooltip",(()=>this.state.checking?o.a.createElement("div",null,o.a.createElement(re.a,null),Object(l.b)("Checking server")):this.state.error?o.a.createElement("span",{className:"warning"},this.state.error):null)),i()(this,"idServerChangeEnabled",(()=>!!this.state.idServer&&!this.state.busy)),i()(this,"saveIdServer",(e=>{p.a.safeGet().setAccountData("m.identity_server",{base_url:e}),this.setState({busy:!1,error:void 0,currentClientIdServer:e,idServer:""})})),i()(this,"checkIdServer",(async e=>{var t;e.preventDefault();const{idServer:n,currentClientIdServer:a}=this.state;this.setState({busy:!0,checking:!0,error:void 0});const i=Object(H.d)(n);let r=await async function(e){if("https:"!==Object(H.c)(e).protocol)return Object(l.b)("Identity server URL must be HTTPS");try{const t=await fetch(e+"/_matrix/identity/v2");return t.ok?null:t.status<200||t.status>=300?Object(l.b)("Not a valid identity server (status code %(code)s)",{code:t.status}):Object(l.b)("Could not connect to identity server")}catch(e){return Object(l.b)("Could not connect to identity server")}}(i);if(!r)try{this.setState({checking:!1});const e=new z.a(i);await e.getAccessToken();let t=!0;if(!await Object(xe.b)(p.a.safeGet(),i)){const[e]=await this.showNoTermsWarning(i);t=!!e}if(t&&a&&i!==a){const[e]=await this.showServerChangeWarning({title:Object(l.b)("Change identity server"),unboundMessage:Object(l.b)("Disconnect from the identity server <current /> and connect to <new /> instead?",{},{current:e=>o.a.createElement("b",null,Object(H.b)(a)),new:e=>o.a.createElement("b",null,Object(H.b)(n))}),button:Object(l.b)("Continue")});t=!!e}t&&this.saveIdServer(i)}catch(e){u.a.error(e),r=Object(l.b)("Terms of service not accepted or the identity server is invalid.")}this.setState({busy:!1,checking:!1,error:null!==(t=r)&&void 0!==t?t:void 0,currentClientIdServer:p.a.safeGet().getIdentityServerUrl()})})),i()(this,"onDisconnectClicked",(async()=>{this.setState({disconnectBusy:!0});try{const[e]=await this.showServerChangeWarning({title:Object(l.b)("Disconnect identity server"),unboundMessage:Object(l.b)("Disconnect from the identity server <idserver />?",{},{idserver:e=>o.a.createElement("b",null,Object(H.b)(this.state.currentClientIdServer))}),button:Object(l.b)("Disconnect")});e&&this.disconnectIdServer()}finally{this.setState({disconnectBusy:!1})}})),i()(this,"disconnectIdServer",(()=>{p.a.safeGet().setAccountData("m.identity_server",{base_url:null});let e="";Object(xe.c)()&&(e=Object(H.b)(Object(xe.c)())),this.setState({busy:!1,error:void 0,currentClientIdServer:p.a.safeGet().getIdentityServerUrl(),idServer:e})}));let t="";!p.a.safeGet().getIdentityServerUrl()&&Object(xe.c)()&&(t=Object(H.b)(Object(xe.c)())),this.state={defaultIdServer:t,currentClientIdServer:p.a.safeGet().getIdentityServerUrl(),idServer:"",busy:!1,disconnectBusy:!1,checking:!1}}componentDidMount(){this.dispatcherRef=F.a.register(this.onAction)}componentWillUnmount(){this.dispatcherRef&&F.a.unregister(this.dispatcherRef)}showNoTermsWarning(e){const{finished:t}=v.b.createDialog(he.a,{title:Object(l.b)("Identity server has no terms of service"),description:o.a.createElement("div",null,o.a.createElement("span",{className:"warning"},Object(l.b)("The identity server you have chosen does not have any terms of service.")),o.a.createElement("span",null," ",Object(l.b)("Only continue if you trust the owner of the server."))),button:Object(l.b)("Continue")});return t}async showServerChangeWarning({title:e,unboundMessage:t,button:n}){const{currentClientIdServer:a}=this.state;let i=[],r=!0;try{i=await Object(ke.b)(K(p.a.safeGet()),Promise.reject(new Error("Timeout attempting to reach identity server")),1e4)}catch(e){r=!1,u.a.warn(`Unable to reach identity server at ${a} to check for 3PIDs during IS change flow`),u.a.warn(e)}const s=i.filter((e=>e.bound));let c,d=!1;const m={idserver:e=>o.a.createElement("b",null,Object(H.b)(a)),b:e=>o.a.createElement("b",null,e)};r?s.length?(c=o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("You are still <b>sharing your personal data</b> on the identity server <idserver />.",{},m)),o.a.createElement("p",null,Object(l.b)("We recommend that you remove your email addresses and phone numbers from the identity server before disconnecting."))),d=!0,n=Object(l.b)("Disconnect anyway")):c=t:(c=o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("You should <b>remove your personal data</b> from identity server <idserver /> before disconnecting. Unfortunately, identity server <idserver /> is currently offline or cannot be reached.",{},m)),o.a.createElement("p",null,Object(l.b)("You should:")),o.a.createElement("ul",null,o.a.createElement("li",null,Object(l.b)("check your browser plugins for anything that might block the identity server (such as Privacy Badger)")),o.a.createElement("li",null,Object(l.b)("contact the administrators of identity server <idserver />",{},{idserver:m.idserver})),o.a.createElement("li",null,Object(l.b)("wait and try again later")))),d=!0,n=Object(l.b)("Disconnect anyway"));const{finished:h}=v.b.createDialog(he.a,{title:e,description:c,button:n,cancelButton:Object(l.b)("Go back"),danger:d});return h}render(){const e=this.state.currentClientIdServer;let t,n,a;if(e?(t=Object(l.b)("Identity server (%(server)s)",{server:Object(H.b)(e)}),n=Object(l.b)("You are currently using <server></server> to discover and be discoverable by existing contacts you know. You can change your identity server below.",{},{server:t=>o.a.createElement("b",null,Object(H.b)(e))}),this.props.missingTerms&&(n=Object(l.b)("If you don't want to use <server /> to discover and be discoverable by existing contacts you know, enter another identity server below.",{},{server:t=>o.a.createElement("b",null,Object(H.b)(e))}))):(t=Object(l.b)("Identity server"),n=Object(l.b)("You are not currently using an identity server. To discover and be discoverable by existing contacts you know, add one below.")),e){let e=Object(l.b)("Disconnect"),t=Object(l.b)("Disconnecting from your identity server will mean you won't be discoverable by other users and you won't be able to invite others by email or phone.");this.props.missingTerms&&(t=Object(l.b)("Using an identity server is optional. If you choose not to use an identity server, you won't be discoverable by other users and you won't be able to invite others by email or phone."),e=Object(l.b)("Do not use an identity server")),this.state.disconnectBusy&&(e=o.a.createElement(re.a,null)),a=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,t),o.a.createElement(E.a,{onClick:this.onDisconnectClicked,kind:"danger_sm"},e))}return o.a.createElement(Re.a,{legend:t,description:n},o.a.createElement("form",{className:"mx_SetIdServer",onSubmit:this.checkIdServer},o.a.createElement(g.a,{label:Object(l.b)("Enter a new identity server"),type:"text",autoComplete:"off",placeholder:this.state.defaultIdServer,value:this.state.idServer,onChange:this.onIdentityServerChanged,tooltipContent:this.getTooltip(),tooltipClassName:"mx_SetIdServer_tooltip",disabled:this.state.busy,forceValidity:!this.state.error&&void 0}),o.a.createElement(E.a,{type:"submit",kind:"primary_sm",onClick:this.checkIdServer,disabled:!this.idServerChangeEnabled()},Object(l.b)("Change")),a))}}var Ie=n(337),Te=n(426),Pe=n(160);class Ne extends o.a.Component{constructor(e){super(e),i()(this,"onProvisioningToggled",(()=>{const e=this.state.provisioningEnabled;k.b.setValue("integrationProvisioning",null,q.a.ACCOUNT,!e).catch((t=>{u.a.error("Error changing integration manager provisioning"),u.a.error(t),this.setState({provisioningEnabled:e})})),this.setState({provisioningEnabled:!e})}));const t=Ie.a.sharedInstance().getPrimaryManager();this.state={currentManager:t,provisioningEnabled:k.b.getValue("integrationProvisioning")}}render(){const e=this.state.currentManager;let t,n;return e?(t=`(${e.name})`,n=Object(l.b)("Use an integration manager <b>(%(serverName)s)</b> to manage bots, widgets, and sticker packs.",{serverName:e.name},{b:e=>o.a.createElement("b",null,e)})):n=Object(l.b)("Use an integration manager to manage bots, widgets, and sticker packs."),o.a.createElement("label",{className:"mx_SetIntegrationManager","data-testid":"mx_SetIntegrationManager",htmlFor:"toggle_integration"},o.a.createElement("div",{className:"mx_SettingsFlag"},o.a.createElement("div",{className:"mx_SetIntegrationManager_heading_manager"},o.a.createElement(Pe.a,{size:"2"},Object(l.b)("Manage integrations")),o.a.createElement(Pe.a,{size:"3"},t)),o.a.createElement(Te.a,{id:"toggle_integration",checked:this.state.provisioningEnabled,disabled:!1,onChange:this.onProvisioningToggled})),o.a.createElement(ie.a,null,n),o.a.createElement(ie.a,null,Object(l.b)("Integration managers receive configuration data, and can modify widgets, send room invites, and set power levels on your behalf.")))}}var De=n(20),Me=n(168),Ae=n(154),Le=n(21);function Ue(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Fe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ue(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ue(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}class Be extends o.a.Component{constructor(e,t){super(e),i()(this,"context",void 0),i()(this,"dispatcherRef",void 0),i()(this,"onAction",(e=>{"id_server_changed"===e.action&&(this.setState({haveIdServer:Boolean(this.context.getIdentityServerUrl())}),this.getThreepidState())})),i()(this,"onEmailsChange",(e=>{this.setState({emails:e})})),i()(this,"onMsisdnsChange",(e=>{this.setState({msisdns:e})})),i()(this,"onLanguageChange",(e=>{if(this.state.language===e)return;k.b.setValue("language",null,q.a.DEVICE,e),this.setState({language:e});const t=I.a.get();t&&(t.setLanguage([e]),t.reload())})),i()(this,"onSpellCheckLanguagesChange",(e=>{var t;this.setState({spellCheckLanguages:e}),null===(t=I.a.get())||void 0===t||t.setSpellCheckLanguages(e)})),i()(this,"onSpellCheckEnabledChange",(e=>{var t;this.setState({spellCheckEnabled:e}),null===(t=I.a.get())||void 0===t||t.setSpellCheckEnabled(e)})),i()(this,"onPasswordChangeError",(e=>{u.a.error("Failed to change password: "+e);let t=e;e instanceof l.a&&e.cause instanceof Error&&(t=e.cause);const n=Object(f.b)(e,Object(l.b)("Unknown password change error (%(stringifiedError)s)",{stringifiedError:String(e)}));let a=n;t instanceof m.HTTPError&&403===t.httpStatus?a=Object(l.b)("Failed to change password. Is your password correct?"):t instanceof m.HTTPError&&(a=Object(l.b)("%(errorMessage)s (HTTP status %(httpStatus)s)",{errorMessage:n,httpStatus:t.httpStatus})),v.b.createDialog(f.a,{title:Object(l.b)("Error changing password"),description:a})})),i()(this,"onPasswordChanged",(({didLogoutOutOtherDevices:e})=>{let t=Object(l.b)("Your password was successfully changed.");e&&(t+=" "+Object(l.b)("You will not receive push notifications on other devices until you sign back in to them.")),v.b.createDialog(f.a,{title:Object(l.b)("Success"),description:t})})),i()(this,"onDeactivateClicked",(()=>{v.b.createDialog(V,{onFinished:e=>{e&&this.props.closeSettingsFn()}})})),this.context=t,this.state={language:l.f(),spellCheckEnabled:!1,spellCheckLanguages:[],haveIdServer:Boolean(this.context.getIdentityServerUrl()),idServerHasUnsignedTerms:!1,requiredPolicyInfo:{hasTerms:!1,policiesAndServices:null,agreedUrls:null,resolve:null},emails:[],msisdns:[],loading3pids:!0,canChangePassword:!1},this.dispatcherRef=F.a.register(this.onAction),this.getCapabilities(),this.getThreepidState()}async componentDidMount(){const e=I.a.get(),[t,n]=await Promise.all([null==e?void 0:e.getSpellCheckEnabled(),null==e?void 0:e.getSpellCheckLanguages()]);n&&this.setState({spellCheckEnabled:t,spellCheckLanguages:n})}componentWillUnmount(){F.a.unregister(this.dispatcherRef)}async getCapabilities(){const e=this.context,t=await e.doesServerSupportSeparateAddAndBind(),n=(await e.getCapabilities())["m.change_password"],a=!n||!1!==n.enabled,i=m.M_AUTHENTICATION.findIn(e.getClientWellKnown()),r=null==i?void 0:i.account;this.setState({serverSupportsSeparateAddAndBind:t,canChangePassword:a,externalAccountManagementUrl:r})}async getThreepidState(){const e=this.context;this.checkTerms();let t=[];try{t=await K(e)}catch(e){const t=this.context.getIdentityServerUrl();u.a.warn(`Unable to reach identity server at ${t} to check for 3PIDs bindings in Settings`),u.a.warn(e)}this.setState({emails:t.filter((e=>e.medium===d.Email)),msisdns:t.filter((e=>e.medium===d.Phone)),loading3pids:!1})}async checkTerms(){const e=this.context.getIdentityServerUrl();if(!this.state.haveIdServer||!e)return void this.setState({idServerHasUnsignedTerms:!1});const t=new z.a;try{const n=await t.getAccessToken({check:!1});await Object(W.d)(this.context,[new W.a(c.a.IS,e,n)],((t,n,a)=>new Promise(((a,i)=>{this.setState({idServerName:Object(H.b)(e),requiredPolicyInfo:{hasTerms:!0,policiesAndServices:t,agreedUrls:n,resolve:a}})})))),this.setState({requiredPolicyInfo:Fe(Fe({},this.state.requiredPolicyInfo),{},{hasTerms:!1})})}catch(t){u.a.warn(`Unable to reach identity server at ${e} to check for terms in Settings`),u.a.warn(t)}}renderAccountSection(){let e=null;if(k.b.getValue($.b.ThirdPartyID)&&(this.state.haveIdServer||!0===this.state.serverSupportsSeparateAddAndBind)){const t=this.state.loading3pids?o.a.createElement(re.a,null):o.a.createElement(ae,{emails:this.state.emails,onEmailsChange:this.onEmailsChange}),n=this.state.loading3pids?o.a.createElement(re.a,null):o.a.createElement(ee,{msisdns:this.state.msisdns,onMsisdnsChange:this.onMsisdnsChange});e=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.b,{heading:Object(l.b)("Email addresses"),stretchContent:!0,"data-testid":"mx_AccountEmailAddresses"},t),o.a.createElement(ie.b,{heading:Object(l.b)("Phone numbers"),stretchContent:!0,"data-testid":"mx_AccountPhoneNumbers"},n))}else null===this.state.serverSupportsSeparateAddAndBind&&(e=o.a.createElement(T.a,null));let t,n=null;if(this.state.canChangePassword&&(n=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("Set a new account password…")),o.a.createElement(_e,{className:"mx_GeneralUserSettingsTab_section--account_changePassword",rowClassName:"",buttonKind:"primary",onError:this.onPasswordChangeError,onFinished:this.onPasswordChanged}))),this.state.externalAccountManagementUrl){const{hostname:e}=new URL(this.state.externalAccountManagementUrl);t=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,{"data-testid":"external-account-management-outer"},Object(l.b)("Your account details are managed separately at <code>%(hostname)s</code>.",{hostname:e},{code:e=>o.a.createElement("code",null,e)})),o.a.createElement(E.a,{onClick:null,element:"a",kind:"primary",target:"_blank",rel:"noreferrer noopener",href:this.state.externalAccountManagementUrl,"data-testid":"external-account-management-link"},Object(l.b)("Manage account")))}return o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.b,{heading:Object(l.b)("Account"),stretchContent:!0,"data-testid":"accountSection"},t,n),e)}renderLanguageSection(){return o.a.createElement(ie.b,{heading:Object(l.b)("Language and region"),stretchContent:!0},o.a.createElement(R.a,{className:"mx_GeneralUserSettingsTab_section_languageInput",onOptionChange:this.onLanguageChange,value:this.state.language}))}renderSpellCheckSection(){const e=o.a.createElement(O.a,{heading:Object(l.b)("Spell check")},o.a.createElement(Te.a,{checked:!!this.state.spellCheckEnabled,onChange:this.onSpellCheckEnabledChange}));return o.a.createElement(ie.b,{heading:e,stretchContent:!0},this.state.spellCheckEnabled&&!De.a&&o.a.createElement(D,{languages:this.state.spellCheckLanguages,onLanguagesChange:this.onSpellCheckLanguagesChange}))}renderDiscoverySection(){if(this.state.requiredPolicyInfo.hasTerms){const e=o.a.createElement(ie.a,null,Object(l.b)("Agree to the identity server (%(serverName)s) Terms of Service to allow yourself to be discoverable by email address or phone number.",{serverName:this.state.idServerName}));return o.a.createElement(o.a.Fragment,null,o.a.createElement(Oe,{policiesAndServicePairs:this.state.requiredPolicyInfo.policiesAndServices,agreedUrls:this.state.requiredPolicyInfo.agreedUrls,onFinished:this.state.requiredPolicyInfo.resolve,introElement:e}),o.a.createElement(je,{missingTerms:!0}))}const e=this.state.haveIdServer?o.a.createElement(o.a.Fragment,null,o.a.createElement(se,{emails:this.state.emails,isLoading:this.state.loading3pids}),o.a.createElement(ce,{msisdns:this.state.msisdns,isLoading:this.state.loading3pids})):null;return o.a.createElement(o.a.Fragment,null,e,o.a.createElement(je,{missingTerms:!1}))}renderManagementSection(){return o.a.createElement(Ae.a,{heading:Object(l.b)("Deactivate account")},o.a.createElement(ie.b,{heading:Object(l.b)("Account management"),"data-testid":"account-management-section",description:Object(l.b)("Deactivating your account is a permanent action — be careful!")},o.a.createElement(E.a,{onClick:this.onDeactivateClicked,kind:"danger"},Object(l.b)("Deactivate Account"))))}renderIntegrationManagerSection(){return k.b.getValue($.b.Widgets)?o.a.createElement(Ne,null):null}render(){const e=I.a.get(),t=null==e?void 0:e.supportsSpellCheckSettings();let n,a;if(k.b.getValue($.b.Deactivate)&&(n=this.renderManagementSection()),k.b.getValue($.b.IdentityServer)){const e=this.state.requiredPolicyInfo.hasTerms?o.a.createElement(h.a,{className:"mx_GeneralUserSettingsTab_warningIcon",width:"18",height:"18","aria-hidden":!1,"aria-label":Object(l.b)("Warning")}):null,t=o.a.createElement(Pe.a,{size:"2"},e,Object(l.b)("Discovery"));a=o.a.createElement(Ae.a,{heading:t,"data-testid":"discoverySection"},this.renderDiscoverySection())}return o.a.createElement(Me.a,{"data-testid":"mx_GeneralUserSettingsTab"},o.a.createElement(Ae.a,{heading:Object(l.b)("General")},o.a.createElement(x,null),this.renderAccountSection(),this.renderLanguageSection(),t?this.renderSpellCheckSection():null),a,this.renderIntegrationManagerSection(),n)}}i()(Be,"contextType",Le.a);var Ve=n(39),We=n(25),ze=n(377),He=n(199),Ge=n(53),Ke=n(180);class qe extends o.a.Component{constructor(e){super(e),i()(this,"labs",void 0),i()(this,"betas",void 0);const t=k.b.getFeatureSettingNames(),[n,a]=t.reduce(((e,t)=>(e[k.b.getBetaInfo(t)?1:0].push(t),e)),[[],[]]);this.labs=n,this.betas=a,We.b.get("show_labs_settings")||(this.labs=[])}render(){let e,t;if(this.betas.length&&(e=o.a.createElement(o.a.Fragment,null,this.betas.map((e=>o.a.createElement(ze.b,{key:e,featureId:e}))))),this.labs.length){const e=new Ke.a;this.labs.forEach((t=>{e.getOrCreate(k.b.getLabGroup(t),[]).push(o.a.createElement(He.a,{level:q.a.DEVICE,name:t,key:t}))})),e.getOrCreate(Ge.b.Experimental,[]).push(o.a.createElement(He.a,{key:"lowBandwidth",name:"lowBandwidth",level:q.a.DEVICE})),e.getOrCreate(Ge.b.Analytics,[]).push(o.a.createElement(He.a,{key:"automaticErrorReporting",name:"automaticErrorReporting",level:q.a.DEVICE}),o.a.createElement(He.a,{key:"automaticDecryptionErrorReporting",name:"automaticDecryptionErrorReporting",level:q.a.DEVICE})),t=o.a.createElement(o.a.Fragment,null,Object(Ve.sortBy)(Array.from(e.entries()),"0").map((([e,t])=>o.a.createElement(ie.b,{key:e,"data-testid":`labs-group-${e}`,heading:Object(l.b)(Ge.e[e])},t))))}return o.a.createElement(Me.a,null,o.a.createElement(Ae.a,{heading:Object(l.b)("Upcoming features")},o.a.createElement(ie.a,null,Object(l.b)("What's next for %(brand)s? Labs are the best way to get things early, test out new features and help shape them before they actually launch.",{brand:We.b.get("brand")})),e),t&&o.a.createElement(Ae.a,{heading:Object(l.b)("Early previews")},o.a.createElement(ie.a,null,Object(l.b)("Feeling experimental? Try out our latest ideas in development. These features are not finalised; they may be unstable, may change, or may be dropped altogether. <a>Learn more</a>.",{},{a:e=>o.a.createElement("a",{href:"https://github.com/vector-im/element-web/blob/develop/docs/labs.md",rel:"noreferrer noopener",target:"_blank"},e)})),t))}}var $e=n(13),Ye=n.n($e),Je=n(162),Qe=n(1320),Xe=n(256);class Ze extends o.a.Component{constructor(e){super(e),this.state={message:e.message}}fakeEvent({message:e}){const t={type:"m.room.message",sender:this.props.userId,content:{"m.new_content":{msgtype:m.MsgType.Text,body:e,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},msgtype:m.MsgType.Text,body:e,displayname:this.props.displayName,avatar_url:this.props.avatarUrl},unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:"!999999999999999999:example.org"},n=new m.MatrixEvent(t);return n.sender={name:this.props.displayName||this.props.userId,rawDisplayName:this.props.displayName,userId:this.props.userId,getAvatarUrl:(...e)=>Je.c({avatarUrl:this.props.avatarUrl},32,32,"crop"),getMxcAvatarUrl:()=>this.props.avatarUrl},n}render(){const e=Ye()(this.props.className,{mx_IRCLayout:this.props.layout==Xe.a.IRC,mx_EventTilePreview_loader:!this.props.userId});if(!this.props.userId)return o.a.createElement("div",{className:e},o.a.createElement(T.a,null));const t=this.fakeEvent(this.state);return o.a.createElement("div",{className:e,role:"presentation"},o.a.createElement(Qe.b,{mxEvent:t,layout:this.props.layout,as:"div",hideTimestamp:!0,inhibitInteraction:!0}))}}var et=n(335);class tt extends o.a.Component{constructor(e){super(e),i()(this,"onLayoutChange",(e=>{const t=e.target.value;this.setState({layout:t}),k.b.setValue("layout",null,q.a.DEVICE,t),this.props.onLayoutChanged(t)})),this.state={layout:k.b.getValue("layout")}}render(){const e=Ye()("mx_LayoutSwitcher_RadioButton",{mx_LayoutSwitcher_RadioButton_selected:this.state.layout==Xe.a.IRC}),t=Ye()("mx_LayoutSwitcher_RadioButton",{mx_LayoutSwitcher_RadioButton_selected:this.state.layout==Xe.a.Group}),n=Ye()("mx_LayoutSwitcher_RadioButton",{mx_LayoutSwitcher_RadioButton_selected:this.state.layout===Xe.a.Bubble});return o.a.createElement(ie.b,{heading:Object(l.b)("Message layout")},o.a.createElement("div",{className:"mx_LayoutSwitcher_RadioButtons"},o.a.createElement("label",{className:e},o.a.createElement(Ze,{className:"mx_LayoutSwitcher_RadioButton_preview",message:this.props.messagePreviewText,layout:Xe.a.IRC,userId:this.props.userId,displayName:this.props.displayName,avatarUrl:this.props.avatarUrl}),o.a.createElement(et.a,{name:"layout",value:Xe.a.IRC,checked:this.state.layout===Xe.a.IRC,onChange:this.onLayoutChange},Object(l.b)("IRC (Experimental)"))),o.a.createElement("label",{className:t},o.a.createElement(Ze,{className:"mx_LayoutSwitcher_RadioButton_preview",message:this.props.messagePreviewText,layout:Xe.a.Group,userId:this.props.userId,displayName:this.props.displayName,avatarUrl:this.props.avatarUrl}),o.a.createElement(et.a,{name:"layout",value:Xe.a.Group,checked:this.state.layout==Xe.a.Group,onChange:this.onLayoutChange},Object(l.b)("Modern"))),o.a.createElement("label",{className:n},o.a.createElement(Ze,{className:"mx_LayoutSwitcher_RadioButton_preview",message:this.props.messagePreviewText,layout:Xe.a.Bubble,userId:this.props.userId,displayName:this.props.displayName,avatarUrl:this.props.avatarUrl}),o.a.createElement(et.a,{name:"layout",value:Xe.a.Bubble,checked:this.state.layout==Xe.a.Bubble,onChange:this.onLayoutChange},Object(l.b)("Message bubbles")))))}}class nt extends r.Component{constructor(...e){super(...e),i()(this,"onChange",(e=>{this.props.onChange(parseInt(e.target.value,10))}))}get position(){const{min:e,max:t,value:n}=this.props;return Number(100*(n-e)/(t-e))}render(){let e;if(!this.props.disabled){const t=this.position;e=r.createElement("output",{className:"mx_Slider_selection",style:{left:`calc(2px + ${t}% + 1.2em - ${t/100*2.4}em)`}},r.createElement("span",{className:"mx_Slider_selection_label"},this.props.value))}return r.createElement("div",{className:"mx_Slider"},r.createElement("input",{type:"range",min:this.props.min,max:this.props.max,value:this.props.value,onChange:this.onChange,disabled:this.props.disabled,step:this.props.step,autoComplete:"off","aria-label":this.props.label}),e)}}var at=n(456),it=n(95);class rt extends o.a.Component{constructor(e){super(e),i()(this,"MESSAGE_PREVIEW_TEXT",Object(l.b)("Hey you. You're the best!")),i()(this,"unmounted",!1),i()(this,"onFontSizeChanged",(e=>{this.setState({fontSize:e.toString()}),k.b.setValue("baseFontSizeV2",null,q.a.DEVICE,e)})),i()(this,"onValidateFontSize",(async({value:e})=>{const t=parseFloat(e),n=at.a.MIN_SIZE,a=at.a.MAX_SIZE;return isNaN(t)?{valid:!1,feedback:Object(l.b)("Size must be a number")}:n<=t&&t<=a?(k.b.setValue("baseFontSizeV2",null,q.a.DEVICE,parseInt(e,10)),{valid:!0,feedback:Object(l.b)("Use between %(min)s pt and %(max)s pt",{min:n,max:a})}):{valid:!1,feedback:Object(l.b)("Custom font size can only be between %(min)s pt and %(max)s pt",{min:n,max:a})}})),this.state={fontSize:k.b.getValue("baseFontSizeV2",null).toString(),useCustomFontSize:k.b.getValue("useCustomFontSize"),layout:k.b.getValue("layout")}}async componentDidMount(){const e=p.a.safeGet(),t=e.getSafeUserId(),n=await e.getProfileInfo(t);this.unmounted||this.setState({userId:t,displayName:n.displayname,avatarUrl:n.avatar_url})}componentWillUnmount(){this.unmounted=!0}render(){return o.a.createElement(ie.b,{heading:Object(l.b)("Font size"),stretchContent:!0,"data-testid":"mx_FontScalingPanel"},o.a.createElement(Ze,{className:"mx_FontScalingPanel_preview",message:this.MESSAGE_PREVIEW_TEXT,layout:this.state.layout,userId:this.state.userId,displayName:this.state.displayName,avatarUrl:this.state.avatarUrl}),o.a.createElement("div",{className:"mx_FontScalingPanel_fontSlider"},o.a.createElement("div",{className:"mx_FontScalingPanel_fontSlider_smallText"},"Aa"),o.a.createElement(nt,{min:at.a.MIN_SIZE,max:at.a.MAX_SIZE,step:1,value:parseInt(this.state.fontSize,10),onChange:this.onFontSizeChanged,displayFunc:e=>"",disabled:this.state.useCustomFontSize,label:Object(l.b)("Font size")}),o.a.createElement("div",{className:"mx_FontScalingPanel_fontSlider_largeText"},"Aa")),o.a.createElement(He.a,{name:"useCustomFontSize",level:q.a.ACCOUNT,onChange:e=>{if(this.setState({useCustomFontSize:e}),!e){const e=parseInt(this.state.fontSize,10),t=Object(it.a)(e,at.a.MIN_SIZE,at.a.MAX_SIZE);t!==e&&this.onFontSizeChanged(t)}},useCheckbox:!0}),o.a.createElement(g.a,{type:"number",label:Object(l.b)("Font size"),autoComplete:"off",placeholder:this.state.fontSize.toString(),value:this.state.fontSize.toString(),id:"font_size_field",onValidate:this.onValidateFontSize,onChange:e=>this.setState({fontSize:e.target.value}),disabled:!this.state.useCustomFontSize,className:"mx_AppearanceUserSettingsTab_checkboxControlledField"}))}}var ot=n(1405),st=n(322);class lt extends o.a.Component{constructor(e){super(e),i()(this,"onSizeChange",(e=>{const t=e.target.value;this.setState({size:t}),k.b.setValue("Images.size",null,q.a.ACCOUNT,t)})),this.state={size:k.b.getValue("Images.size")}}render(){return o.a.createElement(ie.b,{heading:Object(l.b)("Image size in the timeline")},o.a.createElement("div",{className:"mx_ImageSizePanel_radios"},o.a.createElement("label",null,o.a.createElement("div",{className:"mx_ImageSizePanel_size mx_ImageSizePanel_sizeDefault"}),o.a.createElement(et.a,{name:"image_size",value:st.a.Normal,checked:this.state.size===st.a.Normal,onChange:this.onSizeChange},Object(l.b)("Default"))),o.a.createElement("label",null,o.a.createElement("div",{className:"mx_ImageSizePanel_size mx_ImageSizePanel_sizeLarge"}),o.a.createElement(et.a,{name:"image_size",value:st.a.Large,checked:this.state.size===st.a.Large,onChange:this.onSizeChange},Object(l.b)("Large")))))}}class ct extends o.a.Component{constructor(e){super(e),i()(this,"context",void 0),i()(this,"MESSAGE_PREVIEW_TEXT",Object(l.b)("Hey you. You're the best!")),i()(this,"unmounted",!1),i()(this,"onLayoutChanged",(e=>{this.setState({layout:e})})),this.state={useSystemFont:k.b.getValue("useSystemFont"),systemFont:k.b.getValue("systemFont"),showAdvanced:!1,layout:k.b.getValue("layout")}}async componentDidMount(){const e=this.context,t=e.getUserId(),n=await e.getProfileInfo(t);this.unmounted||this.setState({userId:t,displayName:n.displayname,avatarUrl:n.avatar_url})}componentWillUnmount(){this.unmounted=!0}renderAdvancedSection(){if(!k.b.getValue($.b.AdvancedSettings))return null;const e=We.b.get().brand,t=o.a.createElement(E.a,{kind:"link",onClick:()=>this.setState({showAdvanced:!this.state.showAdvanced}),"aria-expanded":this.state.showAdvanced},this.state.showAdvanced?Object(l.b)("Hide advanced"):Object(l.b)("Show advanced"));let n;if(this.state.showAdvanced){const t=Object(l.b)("Set the name of a font installed on your system & %(brand)s will attempt to use it.",{brand:e});n=o.a.createElement(o.a.Fragment,null,o.a.createElement(He.a,{name:"useCompactLayout",level:q.a.DEVICE,useCheckbox:!0}),o.a.createElement(He.a,{name:"useSystemFont",level:q.a.DEVICE,useCheckbox:!0,onChange:e=>this.setState({useSystemFont:e})}),o.a.createElement(g.a,{className:"mx_AppearanceUserSettingsTab_checkboxControlledField",label:k.b.getDisplayName("systemFont"),onChange:e=>{this.setState({systemFont:e.target.value}),k.b.setValue("systemFont",null,q.a.DEVICE,e.target.value)},tooltipContent:t,forceTooltipVisible:!0,disabled:!this.state.useSystemFont,value:this.state.systemFont}))}return o.a.createElement(ie.b,null,t,n)}render(){const e=We.b.get().brand;return o.a.createElement(Me.a,{"data-testid":"mx_AppearanceUserSettingsTab"},o.a.createElement(Ae.a,{heading:Object(l.b)("Customise your appearance")},o.a.createElement(ie.a,null,Object(l.b)("Appearance Settings only affect this %(brand)s session.",{brand:e})),o.a.createElement(ot.a,null),o.a.createElement(tt,{userId:this.state.userId,displayName:this.state.displayName,avatarUrl:this.state.avatarUrl,messagePreviewText:this.MESSAGE_PREVIEW_TEXT,onLayoutChanged:this.onLayoutChanged}),o.a.createElement(rt,null),this.renderAdvancedSection(),o.a.createElement(lt,null)))}}i()(ct,"contextType",Le.a);var dt=n(6),ut=n(47),mt=n(200),ht=n(643),pt=n(271);class gt extends o.a.PureComponent{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"onKeyBackupSessionsRemaining",(e=>{this.setState({sessionsRemaining:e})})),i()(this,"onKeyBackupStatus",(()=>{this.loadBackupStatus()})),i()(this,"startNewBackup",(()=>{v.b.createDialogAsync(n.e(8).then(n.bind(null,1433)),{onFinished:()=>{this.loadBackupStatus()}},void 0,!1,!0)})),i()(this,"deleteBackup",(()=>{v.b.createDialog(he.a,{title:Object(l.b)("Delete Backup"),description:Object(l.b)("Are you sure? You will lose your encrypted messages if your keys are not backed up properly."),button:Object(l.b)("Delete Backup"),danger:!0,onFinished:e=>{e&&(this.setState({loading:!0}),p.a.safeGet().deleteKeyBackupVersion(this.state.backupInfo.version).then((()=>{this.loadBackupStatus()})))}})})),i()(this,"restoreBackup",(async()=>{v.b.createDialog(ht.a,void 0,void 0,!1,!0)})),i()(this,"resetSecretStorage",(async()=>{this.setState({error:!1});try{await Object(pt.b)((async()=>{}),!0)}catch(e){if(u.a.error("Error resetting secret storage",e),this.unmounted)return;this.setState({error:!0})}this.unmounted||this.loadBackupStatus()})),this.state={loading:!0,error:!1,backupKeyStored:null,backupKeyCached:null,backupKeyWellFormed:null,secretStorageKeyInAccount:null,secretStorageReady:null,backupInfo:null,backupSigStatus:null,sessionsRemaining:0}}componentDidMount(){this.checkKeyBackupStatus(),p.a.safeGet().on(ut.b.KeyBackupStatus,this.onKeyBackupStatus),p.a.safeGet().on(ut.b.KeyBackupSessionsRemaining,this.onKeyBackupSessionsRemaining)}componentWillUnmount(){this.unmounted=!0,p.a.get()&&(p.a.get().removeListener(ut.b.KeyBackupStatus,this.onKeyBackupStatus),p.a.get().removeListener(ut.b.KeyBackupSessionsRemaining,this.onKeyBackupSessionsRemaining))}async checkKeyBackupStatus(){this.getUpdatedDiagnostics();try{var e,t;const n=await p.a.safeGet().checkKeyBackup();this.setState({loading:!1,error:!1,backupInfo:null!==(e=null==n?void 0:n.backupInfo)&&void 0!==e?e:null,backupSigStatus:null!==(t=null==n?void 0:n.trustInfo)&&void 0!==t?t:null})}catch(e){if(u.a.log("Unable to fetch check backup status",e),this.unmounted)return;this.setState({loading:!1,error:!0,backupInfo:null,backupSigStatus:null})}}async loadBackupStatus(){this.setState({loading:!0}),this.getUpdatedDiagnostics();try{const e=await p.a.safeGet().getKeyBackupVersion(),t=e?await p.a.safeGet().isKeyBackupTrusted(e):null;if(this.unmounted)return;this.setState({loading:!1,error:!1,backupInfo:e,backupSigStatus:t})}catch(e){if(u.a.log("Unable to fetch key backup status",e),this.unmounted)return;this.setState({loading:!1,error:!0,backupInfo:null,backupSigStatus:null})}}async getUpdatedDiagnostics(){const e=p.a.safeGet(),t=e.getCrypto();if(!t)return;const n=e.secretStorage,a=!!await e.isKeyBackupKeyStored(),i=await t.getSessionBackupPrivateKey(),r=!!i,o=i instanceof Uint8Array,s=await n.hasKey(),l=await t.isSecretStorageReady();this.unmounted||this.setState({backupKeyStored:a,backupKeyCached:r,backupKeyWellFormed:o,secretStorageKeyInAccount:s,secretStorageReady:l})}render(){const{loading:e,error:t,backupKeyStored:n,backupKeyCached:a,backupKeyWellFormed:i,secretStorageKeyInAccount:r,secretStorageReady:s,backupInfo:c,backupSigStatus:d,sessionsRemaining:u}=this.state;let m,h,g;const b=[];if(t)m=o.a.createElement(ie.a,{className:"error"},Object(l.b)("Unable to load key backup status"));else if(e)m=o.a.createElement(T.a,null);else if(c){let e,t,n=Object(l.b)("Restore from Backup");p.a.safeGet().getKeyBackupEnabled()?m=o.a.createElement(ie.a,null,"✅ ",Object(l.b)("This session is backing up your keys.")):(m=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("This session is <b>not backing up your keys</b>, but you do have an existing backup you can restore from and add to going forward.",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement(ie.a,null,Object(l.b)("Connect this session to key backup before signing out to avoid losing any keys that may only be on this session."))),n=Object(l.b)("Connect this session to Key Backup")),e=p.a.safeGet().getKeyBackupEnabled()?u>0?o.a.createElement("div",null,Object(l.b)("Backing up %(sessionsRemaining)s keys…",{sessionsRemaining:u})," ",o.a.createElement("br",null)):o.a.createElement("div",null,Object(l.b)("All keys backed up")," ",o.a.createElement("br",null)):"",null!=d&&d.trusted_locally&&(t=Object(l.b)("This backup is trusted because it has been restored on this session")),h=o.a.createElement(o.a.Fragment,null,o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Backup version:")),o.a.createElement("td",null,c.version)),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Algorithm:")),o.a.createElement("td",null,c.algorithm))),g=o.a.createElement(o.a.Fragment,null,e,o.a.createElement("div",null,t)),b.push(o.a.createElement(E.a,{key:"restore",kind:"primary",onClick:this.restoreBackup},n)),Object(mt.g)(p.a.safeGet())||b.push(o.a.createElement(E.a,{key:"delete",kind:"danger",onClick:this.deleteBackup},Object(l.b)("Delete Backup")))}else m=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("Your keys are <b>not being backed up from this session</b>.",{},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement(ie.a,null,Object(l.b)("Back up your keys before signing out to avoid losing them."))),b.push(o.a.createElement(E.a,{key:"setup",kind:"primary",onClick:this.startNewBackup},Object(l.b)("Set up")));r&&b.push(o.a.createElement(E.a,{key:"reset",kind:"danger",onClick:this.resetSecretStorage},Object(l.b)("Reset")));let v,f="";return a&&(f=", ",f+=i?Object(l.b)("well formed"):Object(l.b)("unexpected type")),b.length&&(v=o.a.createElement("div",{className:"mx_SecureBackupPanel_buttonRow"},b)),o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("Back up your encryption keys with your account data in case you lose access to your sessions. Your keys will be secured with a unique Security Key.")),m,o.a.createElement("details",null,o.a.createElement("summary",null,Object(l.b)("Advanced")),o.a.createElement("table",{className:"mx_SecureBackupPanel_statusList"},o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Backup key stored:")),o.a.createElement("td",null,!0===n?Object(l.b)("in secret storage"):Object(l.b)("not stored"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Backup key cached:")),o.a.createElement("td",null,a?Object(l.b)("cached locally"):Object(l.b)("not found locally"),f)),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Secret storage public key:")),o.a.createElement("td",null,r?Object(l.b)("in account data"):Object(l.b)("not found"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Secret storage:")),o.a.createElement("td",null,s?Object(l.b)("ready"):Object(l.b)("not ready"))),h),g),v)}}const bt="e2ee.manuallyVerifyAllSessions";var vt=()=>o.a.createElement(ie.b,{heading:Object(l.b)("Encryption")},o.a.createElement(He.a,{name:bt,level:q.a.DEVICE}),o.a.createElement(ie.a,null,Object(l.b)("Individually verify each session used by a user to mark it as trusted, not trusting cross-signed devices.")));var ft=n(230);class yt extends o.a.Component{constructor(e){super(e),i()(this,"onExportE2eKeysClicked",(()=>{v.b.createDialogAsync(n.e(7).then(n.bind(null,1583)),{matrixClient:p.a.safeGet()})})),i()(this,"onImportE2eKeysClicked",(()=>{v.b.createDialogAsync(n.e(36).then(n.bind(null,1602)),{matrixClient:p.a.safeGet()})})),i()(this,"updateBlacklistDevicesFlag",(e=>{p.a.safeGet().setGlobalBlacklistUnverifiedDevices(e)}))}render(){const e=p.a.safeGet(),t=e.deviceId;let n,a,i=e.getDeviceEd25519Key();return i=i?ft.e(i):Object(l.b)("<not supported>"),e.isCryptoEnabled()&&(n=o.a.createElement("div",{className:"mx_CryptographyPanel_importExportButtons"},o.a.createElement(E.a,{kind:"primary",onClick:this.onExportE2eKeysClicked},Object(l.b)("Export E2E room keys")),o.a.createElement(E.a,{kind:"primary",onClick:this.onImportE2eKeysClicked},Object(l.b)("Import E2E room keys")))),k.b.isEnabled("blacklistUnverifiedDevices")&&(a=o.a.createElement(He.a,{name:"blacklistUnverifiedDevices",level:q.a.DEVICE,onChange:this.updateBlacklistDevicesFlag})),o.a.createElement(ie.b,{heading:Object(l.b)("Cryptography")},o.a.createElement(ie.a,null,o.a.createElement("table",{className:"mx_CryptographyPanel_sessionInfo"},o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Session ID:")),o.a.createElement("td",null,o.a.createElement("code",null,t))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Session key:")),o.a.createElement("td",null,o.a.createElement("code",null,o.a.createElement("b",null,i)))))),n,a)}}var Et=n(60);class wt extends o.a.Component{constructor(...e){super(...e),i()(this,"onConfirm",(()=>{this.props.onFinished(!0)})),i()(this,"onDecline",(()=>{this.props.onFinished(!1)}))}render(){return o.a.createElement(U.a,{className:"mx_ConfirmDestroyCrossSigningDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(l.b)("Destroy cross-signing keys?")},o.a.createElement("div",{className:"mx_ConfirmDestroyCrossSigningDialog_content"},o.a.createElement("p",null,Object(l.b)("Deleting cross-signing keys is permanent. Anyone you have verified with will see security alerts. You almost certainly don't want to do this, unless you've lost every device you can cross-sign from."))),o.a.createElement(Et.a,{primaryButton:Object(l.b)("Clear cross-signing keys"),onPrimaryButtonClick:this.onConfirm,primaryButtonClass:"danger",cancelButton:Object(l.b)("Cancel"),onCancel:this.onDecline}))}}var St=n(1349);class _t extends o.a.PureComponent{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"onAccountData",(e=>{const t=e.getType();(t.startsWith("m.cross_signing")||t.startsWith("m.secret_storage"))&&this.getUpdatedStatus()})),i()(this,"onBootstrapClick",(()=>{this.state.crossSigningPrivateKeysInStorage?v.b.createDialog(St.a,{},void 0,!1,!0):Object(pt.b)()})),i()(this,"onStatusChanged",(()=>{this.getUpdatedStatus()})),i()(this,"bootstrapCrossSigning",(async({forceReset:e=!1})=>{this.setState({error:!1});try{const t=p.a.safeGet();await t.bootstrapCrossSigning({authUploadDeviceSigningKeys:async e=>{const{finished:n}=v.b.createDialog(Y.a,{title:Object(l.b)("Setting up keys"),matrixClient:t,makeRequest:e}),[a]=await n;if(!a)throw new Error("Cross-signing key upload auth canceled")},setupNewCrossSigning:e})}catch(e){this.setState({error:!0}),u.a.error("Error bootstrapping cross-signing",e)}this.unmounted||this.getUpdatedStatus()})),i()(this,"resetCrossSigning",(()=>{v.b.createDialog(wt,{onFinished:e=>{e&&this.bootstrapCrossSigning({forceReset:!0})}})})),this.state={error:!1}}componentDidMount(){const e=p.a.safeGet();e.on(m.ClientEvent.AccountData,this.onAccountData),e.on(ut.b.UserTrustStatusChanged,this.onStatusChanged),e.on(ut.b.KeysChanged,this.onStatusChanged),this.getUpdatedStatus()}componentWillUnmount(){this.unmounted=!0;const e=p.a.get();e&&(e.removeListener(m.ClientEvent.AccountData,this.onAccountData),e.removeListener(ut.b.UserTrustStatusChanged,this.onStatusChanged),e.removeListener(ut.b.KeysChanged,this.onStatusChanged))}async getUpdatedStatus(){const e=p.a.safeGet(),t=e.getCrypto();if(!t)return;const n=await t.getCrossSigningStatus(),a=n.publicKeysOnDevice,i=n.privateKeysInSecretStorage,r=n.privateKeysCachedLocally.masterKey,o=n.privateKeysCachedLocally.selfSigningKey,s=n.privateKeysCachedLocally.userSigningKey,l=await e.doesServerSupportUnstableFeature("org.matrix.e2e_cross_signing"),c=await t.isCrossSigningReady();this.setState({crossSigningPublicKeysOnDevice:a,crossSigningPrivateKeysInStorage:i,masterPrivateKeyCached:r,selfSigningPrivateKeyCached:o,userSigningPrivateKeyCached:s,homeserverSupportsCrossSigning:l,crossSigningReady:c})}render(){const{error:e,crossSigningPublicKeysOnDevice:t,crossSigningPrivateKeysInStorage:n,masterPrivateKeyCached:a,selfSigningPrivateKeyCached:i,userSigningPrivateKeyCached:r,homeserverSupportsCrossSigning:s,crossSigningReady:c}=this.state;let d,u;e&&(d=o.a.createElement("div",{className:"error"},e.toString())),u=void 0===s?o.a.createElement(T.a,null):s?c&&n?o.a.createElement(ie.a,{"data-testid":"summarised-status"},"✅ ",Object(l.b)("Cross-signing is ready for use.")):c&&!n?o.a.createElement(ie.a,{"data-testid":"summarised-status"},"⚠️ ",Object(l.b)("Cross-signing is ready but keys are not backed up.")):n?o.a.createElement(ie.a,{"data-testid":"summarised-status"},Object(l.b)("Your account has a cross-signing identity in secret storage, but it is not yet trusted by this session.")):o.a.createElement(ie.a,{"data-testid":"summarised-status"},Object(l.b)("Cross-signing is not set up.")):o.a.createElement(ie.a,{"data-testid":"summarised-status"},Object(l.b)("Your homeserver does not support cross-signing."));const m=t||n||a||i||r,h=[];if(!(t&&n&&a&&i&&r)&&s){let e=Object(l.b)("Set up Secure Backup");n&&(e=Object(l.b)("Verify this session")),h.push(o.a.createElement(E.a,{key:"setup",kind:"primary",onClick:this.onBootstrapClick},e))}let p;return m&&h.push(o.a.createElement(E.a,{key:"reset",kind:"danger",onClick:this.resetCrossSigning},Object(l.b)("Reset"))),h.length&&(p=o.a.createElement("div",{className:"mx_CrossSigningPanel_buttonRow"},h)),o.a.createElement(o.a.Fragment,null,u,o.a.createElement("details",null,o.a.createElement("summary",null,Object(l.b)("Advanced")),o.a.createElement("table",{className:"mx_CrossSigningPanel_statusList"},o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Cross-signing public keys:")),o.a.createElement("td",null,t?Object(l.b)("in memory"):Object(l.b)("not found"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Cross-signing private keys:")),o.a.createElement("td",null,n?Object(l.b)("in secret storage"):Object(l.b)("not found in storage"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Master private key:")),o.a.createElement("td",null,a?Object(l.b)("cached locally"):Object(l.b)("not found locally"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Self signing private key:")),o.a.createElement("td",null,i?Object(l.b)("cached locally"):Object(l.b)("not found locally"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("User signing private key:")),o.a.createElement("td",null,r?Object(l.b)("cached locally"):Object(l.b)("not found locally"))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},Object(l.b)("Homeserver feature support:")),o.a.createElement("td",null,s?Object(l.b)("exists"):Object(l.b)("not found"))))),d,p)}}var Ct=n(1314);class Ot extends o.a.PureComponent{render(){return o.a.createElement(U.a,{hasCancel:!0,onFinished:this.props.onFinished.bind(null,!1),title:Object(l.b)("Reset event store?")},o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("You most likely do not want to reset your event index store"),o.a.createElement("br",null),Object(l.b)("If you do, please note that none of your messages will be deleted, but the search experience might be degraded for a few moments whilst the index is recreated"))),o.a.createElement(Et.a,{primaryButton:Object(l.b)("Reset event store"),onPrimaryButtonClick:this.props.onFinished.bind(null,!0),primaryButtonClass:"danger",cancelButton:Object(l.b)("Cancel"),onCancel:this.props.onFinished.bind(null,!1)}))}}var xt=n(269);class kt extends o.a.Component{constructor(e){super(e),i()(this,"updateCurrentRoom",(async()=>{const e=Ct.a.get(),t=await(null==e?void 0:e.getStats().catch((()=>{})));t&&this.setState({eventIndexSize:t.size,roomCount:t.roomCount})})),i()(this,"onManage",(async()=>{v.b.createDialogAsync(n.e(40).then(n.bind(null,1603)),{onFinished:()=>{}},null,!1,!0)})),i()(this,"onEnable",(async()=>{var e,t;this.setState({enabling:!0}),await Ct.a.initEventIndex(),await(null===(e=Ct.a.get())||void 0===e?void 0:e.addInitialCheckpoints()),null===(t=Ct.a.get())||void 0===t||t.startCrawler(),await k.b.setValue("enableEventIndexing",null,q.a.DEVICE,!0),await this.updateState()})),i()(this,"confirmEventStoreReset",(()=>{const{close:e}=v.b.createDialog(Ot,{onFinished:async t=>{t&&(await k.b.setValue("enableEventIndexing",null,q.a.DEVICE,!1),await Ct.a.deleteEventIndex(),await this.onEnable(),e())}})})),this.state={enabling:!1,eventIndexSize:0,roomCount:0,eventIndexingEnabled:k.b.getValueAt(q.a.DEVICE,"enableEventIndexing")}}componentWillUnmount(){const e=Ct.a.get();null!==e&&e.removeListener("changedCheckpoint",this.updateCurrentRoom)}componentDidMount(){this.updateState()}async updateState(){const e=Ct.a.get(),t=k.b.getValueAt(q.a.DEVICE,"enableEventIndexing");let n=0,a=0;if(null!==e){e.on("changedCheckpoint",this.updateCurrentRoom);const t=await e.getStats().catch((()=>{}));t&&(n=t.size,a=t.roomCount)}this.setState({enabling:!1,eventIndexSize:n,roomCount:a,eventIndexingEnabled:t})}render(){let e;const t=We.b.get().brand;if(null!==Ct.a.get())e=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("Securely cache encrypted messages locally for them to appear in search results, using %(size)s to store messages from %(rooms)s rooms.",{size:Object(ft.a)(this.state.eventIndexSize,0),count:this.state.roomCount,rooms:Object(ft.d)(this.state.roomCount)})),o.a.createElement(E.a,{kind:"primary",onClick:this.onManage},Object(l.b)("Manage")));else if(!this.state.eventIndexingEnabled&&Ct.a.supportIsInstalled())e=o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("Securely cache encrypted messages locally for them to appear in search results.")),o.a.createElement("div",null,o.a.createElement(E.a,{kind:"primary",disabled:this.state.enabling,onClick:this.onEnable},Object(l.b)("Enable")),this.state.enabling?o.a.createElement(re.a,null):o.a.createElement("div",null)));else if(Ct.a.platformHasSupport()&&!Ct.a.supportIsInstalled()){const n="https://github.com/vector-im/element-desktop/blob/develop/docs/native-node-modules.md#adding-seshat-for-search-in-e2e-encrypted-rooms";e=o.a.createElement(ie.a,null,Object(l.b)("%(brand)s is missing some components required for securely caching encrypted messages locally. If you'd like to experiment with this feature, build a custom %(brand)s Desktop with <nativeLink>search components added</nativeLink>.",{brand:t},{nativeLink:e=>o.a.createElement(xt.a,{href:n,target:"_blank",rel:"noreferrer noopener"},e)}))}else e=Ct.a.platformHasSupport()?o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,this.state.enabling?o.a.createElement(re.a,null):Object(l.b)("Message search initialisation failed")),Ct.a.error&&o.a.createElement(ie.a,null,o.a.createElement("details",null,o.a.createElement("summary",null,Object(l.b)("Advanced")),o.a.createElement("code",null,Ct.a.error instanceof Error?Ct.a.error.message:Object(l.b)("Unknown error")),o.a.createElement("p",null,o.a.createElement(E.a,{key:"delete",kind:"danger",onClick:this.confirmEventStoreReset},Object(l.b)("Reset")))))):o.a.createElement(ie.a,null,Object(l.b)("%(brand)s can't securely cache encrypted messages locally while running in a web browser. Use <desktopLink>%(brand)s Desktop</desktopLink> for encrypted messages to appear in search results.",{brand:t},{desktopLink:e=>o.a.createElement(xt.a,{href:"https://element.io/get-started",target:"_blank",rel:"noreferrer noopener"},e)}));return e}}var Rt=n(107),jt=n(1424),It=n(240);class Tt extends o.a.Component{constructor(...e){super(...e),i()(this,"onUnignoreClicked",(()=>{this.props.onUnignored(this.props.userId)}))}render(){const e=`mx_SecurityUserSettingsTab_ignoredUser_${this.props.userId}`;return o.a.createElement("div",{className:"mx_SecurityUserSettingsTab_ignoredUser"},o.a.createElement(E.a,{onClick:this.onUnignoreClicked,kind:"primary_sm","aria-describedby":e,disabled:this.props.inProgress},Object(l.b)("Unignore")),o.a.createElement("span",{id:e},this.props.userId))}}class Pt extends o.a.Component{constructor(e){super(e),i()(this,"dispatcherRef",void 0),i()(this,"onAction",(({action:e})=>{if("ignore_state_changed"===e){const e=p.a.safeGet().getIgnoredUsers(),t=this.state.waitingUnignored.filter((t=>e.includes(t)));this.setState({ignoredUserIds:e,waitingUnignored:t})}})),i()(this,"onMyMembership",((e,t)=>{e.isSpaceRoom()||("invite"===t?this.addInvitedRoom(e):this.state.invitedRoomIds.has(e.roomId)&&this.removeInvitedRoom(e.roomId))})),i()(this,"addInvitedRoom",(e=>{this.setState((({invitedRoomIds:t})=>({invitedRoomIds:new Set(t).add(e.roomId)})))})),i()(this,"removeInvitedRoom",(e=>{this.setState((({invitedRoomIds:t})=>{const n=new Set(t);return n.delete(e),{invitedRoomIds:n}}))})),i()(this,"onUserUnignored",(async e=>{const{ignoredUserIds:t,waitingUnignored:n}=this.state,a=t.filter((e=>!n.includes(e))),i=a.indexOf(e);-1!==i&&(a.splice(i,1),this.setState((({waitingUnignored:t})=>({waitingUnignored:[...t,e]}))),p.a.safeGet().setIgnoredUsers(a))})),i()(this,"getInvitedRooms",(()=>p.a.safeGet().getRooms().filter((e=>e.hasMembershipState(p.a.safeGet().getUserId(),"invite"))))),i()(this,"manageInvites",(async e=>{this.setState({managingInvites:!0});const t=Array.from(this.state.invitedRoomIds),n=p.a.safeGet(),a=e?n.joinRoom.bind(n):n.leave.bind(n);for(let e=0;e<t.length;e++){const n=t[e];await a(n).then((()=>{this.removeInvitedRoom(n)}),(async t=>{"M_LIMIT_EXCEEDED"===t.errcode?(await Object(dt.N)(t.retry_after_ms||2500),e--):u.a.warn(t)}))}this.setState({managingInvites:!1})})),i()(this,"onAcceptAllInvitesClicked",(()=>{this.manageInvites(!0)})),i()(this,"onRejectAllInvitesClicked",(()=>{this.manageInvites(!1)}));const t=new Set(this.getInvitedRooms().map((e=>e.roomId)));this.state={ignoredUserIds:p.a.safeGet().getIgnoredUsers(),waitingUnignored:[],managingInvites:!1,invitedRoomIds:t}}componentDidMount(){this.dispatcherRef=F.a.register(this.onAction),p.a.safeGet().on(m.RoomEvent.MyMembership,this.onMyMembership),p.a.safeGet().getVersions().then((e=>this.setState({versions:e})))}componentWillUnmount(){this.dispatcherRef&&F.a.unregister(this.dispatcherRef),p.a.safeGet().removeListener(m.RoomEvent.MyMembership,this.onMyMembership)}renderIgnoredUsers(){const{waitingUnignored:e,ignoredUserIds:t}=this.state,n=null!=t&&t.length?t.map((t=>o.a.createElement(Tt,{userId:t,onUnignored:this.onUserUnignored,key:t,inProgress:e.includes(t)}))):Object(l.b)("You have no ignored users.");return o.a.createElement(ie.b,{heading:Object(l.b)("Ignored users")},o.a.createElement(ie.a,null,n))}renderManageInvites(){const{invitedRoomIds:e}=this.state;return 0===e.size?null:o.a.createElement(ie.b,{heading:Object(l.b)("Bulk options")},o.a.createElement("div",{className:"mx_SecurityUserSettingsTab_bulkOptions"},o.a.createElement(E.a,{onClick:this.onAcceptAllInvitesClicked,kind:"primary",disabled:this.state.managingInvites},Object(l.b)("Accept all %(invitedRooms)s invites",{invitedRooms:e.size})),o.a.createElement(E.a,{onClick:this.onRejectAllInvitesClicked,kind:"danger",disabled:this.state.managingInvites},Object(l.b)("Reject all %(invitedRooms)s invites",{invitedRooms:e.size})),this.state.managingInvites?o.a.createElement(re.a,null):o.a.createElement("div",null)))}render(){const e=o.a.createElement(ie.b,{heading:Object(l.b)("Secure Backup")},o.a.createElement(gt,null)),t=o.a.createElement(ie.b,{heading:Object(l.b)("Message search")},o.a.createElement(kt,null)),n=o.a.createElement(ie.b,{heading:Object(l.b)("Cross-signing")},o.a.createElement(_t,null));let a,i,r;if(Object(It.a)(p.a.safeGet())||(a=o.a.createElement("div",{className:"mx_SecurityUserSettingsTab_warning"},Object(l.b)("Your server admin has disabled end-to-end encryption by default in private rooms & Direct Messages."))),Rt.a.instance.isEnabled()){const e=()=>{Object(jt.b)({primaryButton:Object(l.b)("OK"),hasCancel:!1})};i=o.a.createElement(Ae.a,{heading:Object(l.b)("Privacy")},o.a.createElement(ie.b,{heading:Object(l.b)("Analytics"),description:Object(l.b)("Share anonymous data to help us identify issues. Nothing personal. No third parties.")},o.a.createElement(E.a,{kind:"link",onClick:e},Object(l.b)("Learn more")),Rt.a.instance.isEnabled()&&o.a.createElement(He.a,{name:"pseudonymousAnalyticsOptIn",level:q.a.ACCOUNT})),o.a.createElement(ie.b,{heading:Object(l.b)("Sessions")},o.a.createElement(He.a,{name:"deviceClientInformationOptIn",level:q.a.ACCOUNT})))}if(k.b.getValue($.b.AdvancedSettings)){const e=this.renderIgnoredUsers(),t=this.renderManageInvites(),n=k.b.isEnabled(bt)?o.a.createElement(vt,null):null;(e||t||n)&&(r=o.a.createElement(Ae.a,{heading:Object(l.b)("Advanced")},e,t,n))}return o.a.createElement(Me.a,null,a,o.a.createElement(Ae.a,{heading:Object(l.b)("Encryption")},e,t,n,o.a.createElement(yt,null)),i,r)}}var Nt=n(44),Dt=n(1343),Mt=n(198),At=n(17),Lt=n.n(At),Ut=n(24),Ft=n.n(Ut),Bt=n(1387);const Vt=["icon","label","onDeleteClick","disabled"],Wt=e=>{let{icon:t,label:n,onDeleteClick:a,disabled:i=!1}=e,r=Ft()(e,Vt);return o.a.createElement("div",Lt()({className:"mx_Tag"},r),null==t?void 0:t(),n,a&&o.a.createElement(E.a,{"aria-label":"Remove",className:"mx_Tag_delete",onClick:a,disabled:i},o.a.createElement(Bt.a,null)))};class zt extends o.a.PureComponent{constructor(e){super(e),i()(this,"onInputChange",(e=>{this.setState({newTag:e.target.value})})),i()(this,"onAdd",(e=>{e.preventDefault(),this.state.newTag&&(this.props.onAdd(this.state.newTag),this.setState({newTag:""}))})),this.state={newTag:""}}onRemove(e){this.props.onRemove(e)}render(){return o.a.createElement("div",{className:Ye()("mx_TagComposer",{mx_TagComposer_disabled:this.props.disabled})},o.a.createElement("form",{className:"mx_TagComposer_input",onSubmit:this.onAdd},o.a.createElement(g.a,{id:this.props.id?this.props.id+"_field":void 0,value:this.state.newTag,onChange:this.onInputChange,label:this.props.label||Object(l.b)("Keyword"),placeholder:this.props.placeholder||Object(l.b)("New keyword"),disabled:this.props.disabled,autoComplete:"off"}),o.a.createElement(E.a,{onClick:this.onAdd,kind:"primary",disabled:this.props.disabled},Object(l.b)("Add"))),o.a.createElement("div",{className:"mx_TagComposer_tags",role:"list"},this.props.tags.map(((e,t)=>o.a.createElement(Wt,{label:e,key:e,onDeleteClick:this.onRemove.bind(this,e),disabled:this.props.disabled,role:"listitem"})))))}}var Ht=n(29),Gt=n(203),Kt=n(1422),qt=n(259);function $t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Yt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$t(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$t(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Jt=function(e){return e.Loading="loading",e.Ready="ready",e.Persisting="persisting",e.Error="error",e.SavingError="savingError",e}(Jt||{}),Qt=function(e){return e.Master="master",e.VectorGlobal="vector_global",e.VectorMentions="vector_mentions",e.VectorOther="vector_other",e.Other="other",e}(Qt||{});const Xt="_keywords",Zt=Qt.VectorMentions,en=[Nt.f.DM,Nt.f.EncryptedDM,Nt.f.Message,Nt.f.EncryptedMessage,Nt.f.ContainsDisplayName,Nt.f.ContainsUserName,Nt.f.AtRoomNotification,Nt.f.InviteToSelf,Nt.f.IncomingCall,Nt.f.SuppressNotices,Nt.f.Tombstone],tn=[Dt.e.Off,Dt.e.On,Dt.e.Loud],nn=(e,t,n)=>{var a;if(null===(a=n.syncedRuleIds)||void 0===a||!a.length)return;const i=n.syncedRuleIds.reduce(((t,a)=>{if(t===Dt.e.Loud)return t;const i=((e,t)=>{for(const n in t){const a=t[n].find((t=>t.rule_id===e));if(a)return a}})(a,e);if(i){const e=n.ruleToVectorState(i);if(e&&tn.indexOf(e)>tn.indexOf(t))return e}return t}),n.ruleToVectorState(t));return i};class an extends o.a.PureComponent{constructor(e){var t;super(e),i()(this,"settingWatchers",void 0),i()(this,"onMasterRuleChanged",(async e=>{this.setState({phase:Jt.Persisting});const t=this.state.masterPushRule;try{await p.a.safeGet().setPushRuleEnabled("global",t.kind,t.rule_id,!e),await this.refreshFromServer()}catch(e){this.setState({phase:Jt.Error}),u.a.error("Error updating master push rule:",e),this.showSaveError()}})),i()(this,"setSavingError",(e=>{this.setState((({ruleIdsWithError:t})=>({phase:Jt.SavingError,ruleIdsWithError:Yt(Yt({},t),{},{[e]:!0})})))})),i()(this,"updateDeviceNotifications",(async e=>{await k.b.setValue("deviceNotificationsEnabled",null,q.a.DEVICE,e)})),i()(this,"onEmailNotificationsChanged",(async(e,t)=>{this.setState({phase:Jt.Persisting});try{if(t)await p.a.safeGet().setPusher({kind:"email",app_id:"m.email",pushkey:e,app_display_name:"Email Notifications",device_display_name:e,lang:navigator.language,data:{brand:We.b.get().brand},append:!0});else{var n;const t=null===(n=this.state.pushers)||void 0===n?void 0:n.find((t=>"email"===t.kind&&t.pushkey===e));t&&await p.a.safeGet().removePusher(t.pushkey,t.app_id)}await this.refreshFromServer()}catch(e){this.setState({phase:Jt.Error}),u.a.error("Error updating email pusher:",e),this.showSaveError()}})),i()(this,"onDesktopNotificationsChanged",(async e=>{await k.b.setValue("notificationsEnabled",null,q.a.DEVICE,e)})),i()(this,"onDesktopShowBodyChanged",(async e=>{await k.b.setValue("notificationBodyEnabled",null,q.a.DEVICE,e)})),i()(this,"onAudioNotificationsChanged",(async e=>{await k.b.setValue("audioNotificationsEnabled",null,q.a.DEVICE,e)})),i()(this,"onRadioChecked",(async(e,t)=>{this.setState((({ruleIdsWithError:t})=>({phase:Jt.Persisting,ruleIdsWithError:Yt(Yt({},t),{},{[e.ruleId]:!1})})));try{const n=p.a.safeGet();if(e.ruleId===Xt){if(!this.state.vectorKeywordRuleInfo)throw new Error("Notification data is incomplete.");for(const e of this.state.vectorKeywordRuleInfo.rules){let a,i;t===Dt.e.On?(1!==e.actions.length&&(i=Dt.c.actionsFor(t)),this.state.vectorKeywordRuleInfo.vectorState===Dt.e.Off&&(a=!0)):t===Dt.e.Loud?(3!==e.actions.length&&(i=Dt.c.actionsFor(t)),this.state.vectorKeywordRuleInfo.vectorState===Dt.e.Off&&(a=!0)):a=!1,i&&await n.setPushRuleActions("global",e.kind,e.rule_id,i),void 0!==a&&await n.setPushRuleEnabled("global",e.kind,e.rule_id,a)}}else{const a=Dt.d[e.ruleId],i=a.vectorStateToActions[t];if(!e.rule)throw new Error("Cannot update rule: push rule data is incomplete.");await Object(Kt.b)(n,e.rule.rule_id,e.rule.kind,i),await Object(Kt.a)(n,a.syncedRuleIds,i)}await this.refreshFromServer()}catch(t){this.setSavingError(e.ruleId),u.a.error("Error updating push rule:",t)}})),i()(this,"onClearNotificationsClicked",(async()=>{try{this.setState({clearingNotifications:!0});const e=p.a.safeGet();await Object(Gt.a)(e)}finally{this.setState({clearingNotifications:!1})}})),i()(this,"onKeywordAdd",(e=>{if(!this.state.vectorKeywordRuleInfo)throw new Error("Notification data is incomplete.");const t=Object(Ce.b)(this.state.vectorKeywordRuleInfo.rules);this.setState({phase:Jt.Persisting,vectorKeywordRuleInfo:Yt(Yt({},this.state.vectorKeywordRuleInfo),{},{rules:[...this.state.vectorKeywordRuleInfo.rules,{pattern:e}]})},(async()=>{await this.setKeywords(this.state.vectorKeywordRuleInfo.rules.map((e=>e.pattern)),t)}))})),i()(this,"onKeywordRemove",(e=>{if(!this.state.vectorKeywordRuleInfo)throw new Error("Notification data is incomplete.");const t=Object(Ce.b)(this.state.vectorKeywordRuleInfo.rules);this.setState({phase:Jt.Persisting,vectorKeywordRuleInfo:Yt(Yt({},this.state.vectorKeywordRuleInfo),{},{rules:this.state.vectorKeywordRuleInfo.rules.filter((t=>t.pattern!==e))})},(async()=>{await this.setKeywords(this.state.vectorKeywordRuleInfo.rules.map((e=>e.pattern)),t)}))})),this.state={phase:Jt.Loading,deviceNotificationsEnabled:null===(t=k.b.getValue("deviceNotificationsEnabled"))||void 0===t||t,desktopNotifications:k.b.getValue("notificationsEnabled"),desktopShowBody:k.b.getValue("notificationBodyEnabled"),audioNotifications:k.b.getValue("audioNotificationsEnabled"),clearingNotifications:!1,ruleIdsWithError:{}},this.settingWatchers=[k.b.watchSetting("notificationsEnabled",null,((...[,,,,e])=>this.setState({desktopNotifications:e}))),k.b.watchSetting("deviceNotificationsEnabled",null,((...[,,,,e])=>{this.setState({deviceNotificationsEnabled:e})})),k.b.watchSetting("notificationBodyEnabled",null,((...[,,,,e])=>this.setState({desktopShowBody:e}))),k.b.watchSetting("audioNotificationsEnabled",null,((...[,,,,e])=>this.setState({audioNotifications:e})))]}get isInhibited(){var e;return!(null===(e=this.state.masterPushRule)||void 0===e||!e.enabled)}componentDidMount(){this.refreshFromServer(),this.refreshFromAccountData()}componentWillUnmount(){this.settingWatchers.forEach((e=>k.b.unwatchSetting(e)))}componentDidUpdate(e,t){this.state.deviceNotificationsEnabled!==t.deviceNotificationsEnabled&&this.persistLocalNotificationSettings(this.state.deviceNotificationsEnabled)}async refreshFromServer(){try{const e=(await Promise.all([this.refreshRules(),this.refreshPushers(),this.refreshThreepids()])).reduce(((e,t)=>Object.assign(t,e)),{});this.setState(Yt(Yt({},e),{},{phase:Jt.Ready}))}catch(e){u.a.error("Error setting up notifications for settings: ",e),this.setState({phase:Jt.Error})}}async refreshFromAccountData(){const e=p.a.safeGet(),t=e.getAccountData(Object(Gt.d)(e.deviceId));if(t){const e=!t.getContent().is_silenced;await this.updateDeviceNotifications(e)}}persistLocalNotificationSettings(e){const t=p.a.safeGet();return t.setAccountData(Object(Gt.d)(t.deviceId),{is_silenced:!e})}async refreshRules(){const e=await p.a.safeGet().getPushRules(),t={[Nt.f.Master]:Qt.Master,[Nt.f.DM]:Qt.VectorGlobal,[Nt.f.EncryptedDM]:Qt.VectorGlobal,[Nt.f.Message]:Qt.VectorGlobal,[Nt.f.EncryptedMessage]:Qt.VectorGlobal,[Nt.f.ContainsDisplayName]:Qt.VectorMentions,[Nt.f.ContainsUserName]:Qt.VectorMentions,[Nt.f.AtRoomNotification]:Qt.VectorMentions,[Nt.f.InviteToSelf]:Qt.VectorOther,[Nt.f.IncomingCall]:Qt.VectorOther,[Nt.f.SuppressNotices]:Qt.VectorOther,[Nt.f.Tombstone]:Qt.VectorOther},n={[Qt.Master]:[],[Qt.VectorGlobal]:[],[Qt.VectorMentions]:[],[Qt.VectorOther]:[],[Qt.Other]:[]};for(const i in e.global){const r=i;for(const i of e.global[r]){var a;const e=Object.assign(i,{kind:r}),o=null!==(a=t[e.rule_id])&&void 0!==a?a:Qt.Other;"."===e.rule_id[0]&&n[o].push(e)}}const i={};if(!(n.master.length>0))throw new Error("Failed to locate a master push rule");i.masterPushRule=n.master[0],i.vectorKeywordRuleInfo=Dt.a.parseContentRules(e),i.vectorPushRules={};const r=[Qt.VectorGlobal,Qt.VectorMentions,Qt.VectorOther];for(const e of r){i.vectorPushRules[e]=[];for(const t of n[e]){const a=Dt.d[t.rule_id],r=a.ruleToVectorState(t);i.vectorPushRules[e].push({ruleId:t.rule_id,rule:t,vectorState:r,syncedVectorState:nn(n,t,a),description:Object(l.b)(a.description)})}i.vectorPushRules[e].sort(((e,t)=>{let n=en.indexOf(e.ruleId),a=en.indexOf(t.ruleId);return n<0&&(n=en.length),a<0&&(a=en.length),n-a})),e===Zt&&i.vectorPushRules[e].push({ruleId:Xt,description:Object(l.b)("Messages containing keywords"),vectorState:i.vectorKeywordRuleInfo.vectorState})}return i}refreshPushers(){return p.a.safeGet().getPushers()}refreshThreepids(){return p.a.safeGet().getThreePids()}showSaveError(){v.b.createDialog(f.a,{title:Object(l.b)("Error saving notification preferences"),description:Object(l.b)("An error occurred whilst saving your notification preferences.")})}async setKeywords(e,t){try{const n=Object(Ht.m)(Array.from(new Set(e))),a=Object(Ht.m)(Array.from(new Set(t.map((e=>e.pattern))))),i=Object(Ht.a)(a,n);for(const e of i.removed)for(const n of t.filter((t=>t.pattern===e)))await p.a.safeGet().deletePushRule("global",n.kind,n.rule_id);let r=this.state.vectorKeywordRuleInfo.vectorState;if(r===Dt.e.Off){const e=t.length?Dt.c.contentRuleVectorStateKind(t[0]):void 0;r=null!=e?e:Dt.e.On}const o=Nt.e.ContentSpecific;for(const e of i.added)await p.a.safeGet().addPushRule("global",o,e,{actions:Dt.c.actionsFor(r),pattern:e}),r===Dt.e.Off&&await p.a.safeGet().setPushRuleEnabled("global",o,e,!1);await this.refreshFromServer()}catch(e){this.setState({phase:Jt.Error}),u.a.error("Error updating keyword push rules:",e),this.showSaveError()}}renderTopSection(){const e=o.a.createElement(Mt.a,{"data-testid":"notif-master-switch",value:!this.isInhibited,label:Object(l.b)("Enable notifications for this account"),caption:Object(l.b)("Turn off to disable notifications on all your devices and sessions"),onChange:this.onMasterRuleChanged,disabled:this.state.phase===Jt.Persisting});if(this.isInhibited)return e;const t=(this.state.threepids||[]).filter((e=>e.medium===d.Email)).map((e=>{var t;return o.a.createElement(Mt.a,{"data-testid":"notif-email-switch",key:e.address,value:!(null===(t=this.state.pushers)||void 0===t||!t.some((t=>"email"===t.kind&&t.pushkey===e.address))),label:Object(l.b)("Enable email notifications for %(email)s",{email:e.address}),onChange:this.onEmailNotificationsChanged.bind(this,e.address),disabled:this.state.phase===Jt.Persisting})}));return o.a.createElement(ie.b,null,e,o.a.createElement(Mt.a,{"data-testid":"notif-device-switch",value:this.state.deviceNotificationsEnabled,label:Object(l.b)("Enable notifications for this device"),onChange:e=>this.updateDeviceNotifications(e),disabled:this.state.phase===Jt.Persisting}),this.state.deviceNotificationsEnabled&&o.a.createElement(o.a.Fragment,null,o.a.createElement(Mt.a,{"data-testid":"notif-setting-notificationsEnabled",value:this.state.desktopNotifications,onChange:this.onDesktopNotificationsChanged,label:Object(l.b)("Enable desktop notifications for this session"),disabled:this.state.phase===Jt.Persisting}),o.a.createElement(Mt.a,{"data-testid":"notif-setting-notificationBodyEnabled",value:this.state.desktopShowBody,onChange:this.onDesktopShowBodyChanged,label:Object(l.b)("Show message in desktop notification"),disabled:this.state.phase===Jt.Persisting}),o.a.createElement(Mt.a,{"data-testid":"notif-setting-audioNotificationsEnabled",value:this.state.audioNotifications,onChange:this.onAudioNotificationsChanged,label:Object(l.b)("Enable audible notifications for this session"),disabled:this.state.phase===Jt.Persisting})),t)}renderCategory(e){var t,n;if(e!==Qt.VectorOther&&this.isInhibited)return null;let a,i;if(e===Qt.VectorOther&&p.a.safeGet().getRooms().some((e=>e.getUnreadNotificationCount()>0))&&(a=o.a.createElement(E.a,{onClick:this.onClearNotificationsClicked,disabled:this.state.clearingNotifications,kind:"danger",className:"mx_UserNotifSettings_clearNotifsButton","data-testid":"clear-notifications"},Object(l.b)("Mark all as read"))),e===Qt.VectorOther&&this.isInhibited)return a?o.a.createElement("div",{className:"mx_UserNotifSettings_floatingSection"},o.a.createElement("div",null,Object(l.b)("Other")),a):null;if(e===Qt.VectorMentions){var r;const e=Object(Ht.m)((null===(r=this.state.vectorKeywordRuleInfo)||void 0===r?void 0:r.rules.map((e=>e.pattern)))||[]);i=o.a.createElement(zt,{tags:e,onAdd:this.onKeywordAdd,onRemove:this.onKeywordRemove,disabled:this.state.phase===Jt.Persisting,label:Object(l.b)("Keyword"),placeholder:Object(l.b)("New keyword")})}const s={[Dt.e.On]:Object(l.b)("On"),[Dt.e.Off]:Object(l.b)("Off"),[Dt.e.Loud]:Object(l.b)("Noisy")},c=(e,t)=>{var n;return o.a.createElement(et.a,{key:e.ruleId+t,name:e.ruleId,checked:(null!==(n=e.syncedVectorState)&&void 0!==n?n:e.vectorState)===t,onChange:this.onRadioChecked.bind(this,e,t),disabled:this.state.phase===Jt.Persisting,"aria-label":s[t]})},d=null===(t=this.state.vectorPushRules)||void 0===t||null===(n=t[e])||void 0===n?void 0:n.map((t=>o.a.createElement("fieldset",{key:e+t.ruleId,"data-testid":e+t.ruleId,className:"mx_UserNotifSettings_gridRowContainer"},o.a.createElement("legend",{className:"mx_UserNotifSettings_gridRowLabel"},t.description),c(t,Dt.e.Off),c(t,Dt.e.On),c(t,Dt.e.Loud),this.state.ruleIdsWithError[t.ruleId]&&o.a.createElement("div",{className:"mx_UserNotifSettings_gridRowError"},o.a.createElement(qt.a,{isError:!0},Object(l.b)("An error occurred when updating your notification preferences. Please try to toggle your option again."))))));let u;switch(e){case Qt.VectorGlobal:u=Object(l.b)("Global");break;case Qt.VectorMentions:u=Object(l.b)("Mentions & keywords");break;case Qt.VectorOther:u=Object(l.b)("Other");break;default:throw new Error("Developer error: Unnamed notifications section: "+e)}return o.a.createElement("div",null,o.a.createElement("div",{"data-testid":`notif-section-${e}`,className:"mx_UserNotifSettings_grid"},o.a.createElement(O.a,{heading:u}),o.a.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},s[Dt.e.Off]),o.a.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},s[Dt.e.On]),o.a.createElement("span",{className:"mx_UserNotifSettings_gridColumnLabel"},s[Dt.e.Loud]),d),a,i)}renderTargets(){var e;if(this.isInhibited)return null;const t=null===(e=this.state.pushers)||void 0===e?void 0:e.map((e=>o.a.createElement("tr",{key:e.kind+e.pushkey},o.a.createElement("td",null,e.app_display_name),o.a.createElement("td",null,e.device_display_name))));return null!=t&&t.length?o.a.createElement("div",{className:"mx_UserNotifSettings_floatingSection"},o.a.createElement("div",null,Object(l.b)("Notification targets")),o.a.createElement("table",null,o.a.createElement("tbody",null,t))):null}render(){return this.state.phase===Jt.Loading?o.a.createElement(T.a,null):this.state.phase===Jt.Error?o.a.createElement("p",{"data-testid":"error-message"},Object(l.b)("There was an error loading your notification settings.")):o.a.createElement(o.a.Fragment,null,this.renderTopSection(),this.renderCategory(Qt.VectorGlobal),this.renderCategory(Qt.VectorMentions),this.renderCategory(Qt.VectorOther),this.renderTargets())}}var rn=n(1365),on=n(84);function sn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?sn(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function cn(e){const t=new Map;for(const a of Object.values(m.PushRuleKind))for(const i of null!==(n=e.global[a])&&void 0!==n?n:[]){var n;i.rule_id.startsWith(".")&&t.set(i.rule_id,ln(ln({},i),{},{kind:a}))}return t}function dn(e,t,n){var a,i;const r={updated:[],added:[],deleted:[]},o=cn(e),s=function(e,t){const n=new Map;n.set(m.RuleId.Master,{rule_id:m.RuleId.Master,kind:m.PushRuleKind.Override,enabled:e.globalMute}),n.set(m.RuleId.EncryptedMessage,{rule_id:m.RuleId.EncryptedMessage,kind:m.PushRuleKind.Underride,enabled:!0,actions:Dt.b.encodeActions({notify:e.defaultLevels.room===on.a.AllMessages,highlight:!1})}),n.set(m.RuleId.Message,{rule_id:m.RuleId.Message,kind:m.PushRuleKind.Underride,enabled:!0,actions:Dt.b.encodeActions({notify:e.defaultLevels.room===on.a.AllMessages,highlight:!1})}),n.set(m.RuleId.EncryptedDM,{rule_id:m.RuleId.EncryptedDM,kind:m.PushRuleKind.Underride,enabled:!0,actions:Dt.b.encodeActions({notify:e.defaultLevels.dm===on.a.AllMessages,highlight:!1,sound:e.sound.people})}),n.set(m.RuleId.DM,{rule_id:m.RuleId.DM,kind:m.PushRuleKind.Underride,enabled:!0,actions:Dt.b.encodeActions({notify:e.defaultLevels.dm===on.a.AllMessages,highlight:!1,sound:e.sound.people})}),n.set(m.RuleId.SuppressNotices,{rule_id:m.RuleId.SuppressNotices,kind:m.PushRuleKind.Override,enabled:!e.activity.bot_notices,actions:rn.a.ACTION_DONT_NOTIFY}),n.set(m.RuleId.InviteToSelf,{rule_id:m.RuleId.InviteToSelf,kind:m.PushRuleKind.Override,enabled:e.activity.invite,actions:Dt.b.encodeActions({notify:!0,highlight:!1,sound:e.sound.people})}),n.set(m.RuleId.MemberEvent,{rule_id:m.RuleId.MemberEvent,kind:m.PushRuleKind.Override,enabled:!0,actions:e.activity.status_event?rn.a.ACTION_NOTIFY:rn.a.ACTION_DONT_NOTIFY});const a=Dt.b.encodeActions({notify:!0,sound:e.sound.mentions,highlight:!0}),i=e.mentions.user?a:rn.a.ACTION_DONT_NOTIFY;t&&n.set(m.RuleId.IsUserMention,{rule_id:m.RuleId.IsUserMention,kind:m.PushRuleKind.ContentSpecific,enabled:!0,actions:i}),n.set(m.RuleId.ContainsDisplayName,{rule_id:m.RuleId.ContainsDisplayName,kind:m.PushRuleKind.Override,enabled:!0,actions:i}),n.set(m.RuleId.ContainsUserName,{rule_id:m.RuleId.ContainsUserName,kind:m.PushRuleKind.ContentSpecific,enabled:!0,actions:i});const r=e.mentions.room?rn.a.ACTION_NOTIFY:rn.a.ACTION_DONT_NOTIFY;return t&&n.set(m.RuleId.IsRoomMention,{rule_id:m.RuleId.IsRoomMention,kind:m.PushRuleKind.ContentSpecific,enabled:!0,actions:r}),n.set(m.RuleId.AtRoomNotification,{rule_id:m.RuleId.AtRoomNotification,kind:m.PushRuleKind.Override,enabled:!0,actions:r}),n.set(m.RuleId.Tombstone,{rule_id:m.RuleId.Tombstone,kind:m.PushRuleKind.Override,enabled:e.activity.status_event,actions:rn.a.ACTION_HIGHLIGHT}),n.set(m.RuleId.IncomingCall,{rule_id:m.RuleId.IncomingCall,kind:m.PushRuleKind.Underride,enabled:!0,actions:Dt.b.encodeActions({notify:!0,sound:e.sound.calls})}),n}(t,n);for(const e of s.values()){const t=o.get(e.rule_id);let n=!1;if(void 0===t)n=!0;else if(void 0!==e.enabled&&e.enabled!==t.enabled)n=!0;else if(void 0!==e.actions){const a=Dt.b.decodeActions(t.actions),i=Dt.b.decodeActions(e.actions);null===a||null===i?n=!0:Object(dt.j)(i,a)||(n=!0)}n&&r.updated.push(e)}const l=Dt.b.encodeActions({notify:!0,sound:t.sound.mentions,highlight:!0}),c=null!==(a=null===(i=e.global.content)||void 0===i?void 0:i.filter((e=>!e.rule_id.startsWith("."))))&&void 0!==a?a:[],d=new Set(t.keywords);for(const e of c){if(d.has(e.pattern)){let n=!1;if(e.enabled!==t.mentions.keywords)n=!0;else if(void 0!==e.actions){const t=Dt.b.decodeActions(e.actions),a=Dt.b.decodeActions(l);null===t||null===a?n=!0:Object(dt.j)(a,t)||(n=!0)}n&&r.updated.push({rule_id:e.rule_id,kind:m.PushRuleKind.ContentSpecific,enabled:t.mentions.keywords,actions:l})}else r.deleted.push({rule_id:e.rule_id,kind:m.PushRuleKind.ContentSpecific});d.delete(e.pattern)}for(const e of d)r.added.push({rule_id:e,kind:m.PushRuleKind.ContentSpecific,default:!1,enabled:t.mentions.keywords,pattern:e,actions:l});return r}function un(e){if(0===e.length)return!0;for(const t of e){if(null==t||!1===t||!t.enabled)continue;const e=Dt.b.decodeActions(t.actions);if(null!==e&&e.notify)return!0}return!1}function mn(e){if(0===e.length)return!1;for(const t of e){if(null==t||!1===t||!t.enabled)continue;const e=Dt.b.decodeActions(t.actions);if(null!==e&&!e.notify&&!0!==e.highlight&&void 0===e.sound)return!0}return!1}function hn(e){for(const t of e){if(null==t||!1===t||!t.enabled)continue;const e=Dt.b.decodeActions(t.actions);if(null!==e&&e.notify&&void 0!==e.sound)return e.sound}}function pn(e){const t=function(){const e=Object(r.useRef)(null);return Object(r.useCallback)((t=>{let n;return n=null===e.current?t():e.current.then(t),e.current=n,n}),[])}(),n=Object(r.useMemo)((()=>e.supportsIntentionalMentions()),[e]),a=Object(r.useRef)(null),[i,o]=Object(r.useState)(null),[s,l]=Object(r.useState)(!1),c=Object(r.useCallback)((async()=>{const t=await e.getPushRules(),i=function(e,t){var n,a,i,r;const o=cn(e),s=null!==(n=null===(a=e.global.content)||void 0===a?void 0:a.filter((e=>!e.rule_id.startsWith("."))))&&void 0!==n?n:[],l=[o.get(m.RuleId.DM),o.get(m.RuleId.EncryptedDM)],c=[o.get(m.RuleId.Message),o.get(m.RuleId.EncryptedMessage)];return{globalMute:null!==(i=null===(r=o.get(m.RuleId.Master))||void 0===r?void 0:r.enabled)&&void 0!==i&&i,defaultLevels:{room:un(c)?on.a.AllMessages:on.a.MentionsOnly,dm:un(l)?on.a.AllMessages:on.a.MentionsOnly},sound:{calls:hn([o.get(m.RuleId.IncomingCall)]),mentions:hn([t&&o.get(m.RuleId.IsUserMention),o.get(m.RuleId.ContainsUserName),o.get(m.RuleId.ContainsDisplayName),...s]),people:hn(l)},activity:{bot_notices:!mn([o.get(m.RuleId.SuppressNotices)]),invite:un([o.get(m.RuleId.InviteToSelf)]),status_event:un([o.get(m.RuleId.MemberEvent),o.get(m.RuleId.Tombstone)])},mentions:{user:un([t&&o.get(m.RuleId.IsUserMention),o.get(m.RuleId.ContainsUserName),o.get(m.RuleId.ContainsDisplayName)]),room:un([t&&o.get(m.RuleId.IsRoomMention),o.get(m.RuleId.AtRoomNotification)]),keywords:un(s)},keywords:s.map((e=>e.pattern))}}(t,n),r=dn(t,i,n);a.current=t,l(r.updated.length>0||r.added.length>0||r.deleted.length>0),o(i)}),[e,n]);Object(r.useEffect)((()=>{t(c).catch((e=>console.error(e)))}),[e,t,c]);const d=Object(r.useCallback)((i=>{o(i),t((async()=>{if(null!==a.current){const t=dn(a.current,i,n);await async function(e,t){await Promise.all(t.deleted.map((t=>e.deletePushRule("global",t.kind,t.rule_id)))),await Promise.all(t.added.map((t=>e.addPushRule("global",t.kind,t.rule_id,t)))),await Promise.all(t.updated.map((async t=>{void 0!==t.enabled&&await e.setPushRuleEnabled("global",t.kind,t.rule_id,t.enabled),void 0!==t.actions&&await e.setPushRuleActions("global",t.kind,t.rule_id,t.actions)})))}(e,t),await c()}})).catch((e=>console.error(e)))}),[t,n,e,c]);return{model:i,hasPendingChanges:s,reconcile:d}}var gn=n(182);const bn={globalMute:!1,defaultLevels:{room:on.a.AllMessages,dm:on.a.AllMessages},sound:{people:"default",mentions:"default",calls:"ring"},activity:{invite:!0,status_event:!1,bot_notices:!0},mentions:{user:!0,room:!0,keywords:!0},keywords:[]};var vn=n(49),fn=n(1328),yn=n(280),En=n(587);function wn({children:e,icon:t,action:n,onAction:a}){return o.a.createElement("div",{className:"mx_SettingsBanner"},t,o.a.createElement("div",{className:"mx_SettingsBanner_content"},e),n&&o.a.createElement(E.a,{kind:"primary_outline",onClick:null!=a?a:null},n))}function Sn(e,t,n){const[a,i]=Object(r.useState)(n),o=Object(r.useCallback)((()=>{let t=!1;return e().then((e=>{t||i(e)})).catch((e=>console.error(e))),()=>{t=!0}}),t);return Object(r.useEffect)(o,[o]),[a,o]}var _n=n(414);const Cn=["children"],On=e=>{let{children:t}=e,n=Ft()(e,Cn);return o.a.createElement("div",Lt()({},n,{className:"mx_SettingsIndent"}),t)};function xn(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function kn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?xn(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xn(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Rn(e){return o.a.createElement(E.a,{kind:"link_inline",onClick:()=>{F.a.dispatch({action:B.a.ViewUserSettings,initialTabId:_n.a.General})}},e)}function jn(){const e=Object(r.useMemo)((()=>({kind:"email",app_id:"m.email",app_display_name:Object(l.b)("Email Notifications"),lang:navigator.language,data:{brand:We.b.get().brand}})),[]),t=Object(Le.b)(),[n,a]=Sn((()=>i.getPushers().then((e=>e.pushers))),[i=t],[]);var i;const[s,c]=function(e){return Sn((()=>e.getThreePids().then((e=>e.threepids))),[e],[])}(t),u=Object(r.useCallback)(((i,r)=>{if(r)t.setPusher(kn(kn({},e),{},{pushkey:i,device_display_name:i,append:!0})).catch((e=>console.error(e)));else{const e=n.find((e=>"email"===e.kind&&e.pushkey===i));e&&t.removePusher(e.pushkey,e.app_id).catch((e=>console.error(e)))}c(),a()}),[e,t,n,a,c]),m=n.filter((e=>"email"!==e.kind));return o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.b,{className:"mx_NotificationPusherSettings",heading:Object(l.b)("Email summary")},o.a.createElement(ie.a,{className:"mx_NotificationPusherSettings_description"},Object(l.b)("Receive an email summary of missed notifications")),o.a.createElement("div",{className:"mx_SettingsSubsection_description mx_NotificationPusherSettings_detail"},o.a.createElement(ie.a,null,Object(l.b)("Select which emails you want to send summaries to. Manage your emails in <button>General</button>.",{},{button:Rn}))),o.a.createElement(On,null,s.filter((e=>e.medium===d.Email)).map((e=>o.a.createElement(fn.a,{key:e.address,label:e.address,value:void 0!==n.find((t=>t.pushkey===e.address)),onChange:t=>u(e.address,t)}))))),m.length>0&&o.a.createElement(ie.b,{heading:Object(l.b)("Notification targets")},o.a.createElement("ul",null,n.filter((e=>"email"!==e.kind)).map((e=>o.a.createElement("li",{key:e.pushkey},e.device_display_name||e.app_display_name))))))}function In(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function Tn(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?In(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):In(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pn=function(e){return e.AllMessages="all_messages",e.PeopleMentionsKeywords="people_mentions_keywords",e.MentionsKeywords="mentions_keywords",e}(Pn||{});const Nn=[{value:Pn.AllMessages,label:Object(l.b)("All messages")},{value:Pn.PeopleMentionsKeywords,label:Object(l.b)("People, Mentions and Keywords")},{value:Pn.MentionsKeywords,label:Object(l.b)("Mentions and Keywords only")}];function Dn(e){return o.a.createElement("strong",null,e)}function Mn(e){return o.a.createElement(xt.a,{href:"https://element.io/help#settings2"},e)}function An(){var e;const t=Object(Le.b)(),n=Object(gn.b)("notificationsEnabled"),a=Object(gn.b)("notificationBodyEnabled"),i=Object(gn.b)("audioNotificationsEnabled"),{model:s,hasPendingChanges:c,reconcile:d}=pn(t),u=null===s||c,m=null!=s?s:bn,[h,p]=Object(r.useState)(!1),g=Object(Le.b)().getRooms().some((e=>e.getUnreadNotificationCount()>0));return o.a.createElement("div",{className:"mx_NotificationSettings2"},c&&null!==s&&o.a.createElement(wn,{icon:o.a.createElement("img",{src:"img/element-icons/new-and-improved.8a4831c.svg",alt:"",width:12}),action:Object(l.b)("Proceed"),onAction:()=>d(s)},Object(l.b)("<strong>Update:</strong>We’ve simplified Notifications Settings to make options easier to find. Some custom settings you’ve chosen in the past are not shown here, but they’re still active. If you proceed, some of your settings may change. <a>Learn more</a>",{},{strong:Dn,a:Mn})),o.a.createElement(Ae.a,{heading:Object(l.b)("Notifications")},o.a.createElement("div",{className:"mx_SettingsSubsection_content mx_NotificationSettings2_flags"},o.a.createElement(Mt.a,{label:Object(l.b)("Enable notifications for this account"),value:!m.globalMute,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{globalMute:!e}))}}),o.a.createElement(Mt.a,{label:Object(l.b)("Enable desktop notifications for this session"),value:n,onChange:e=>k.b.setValue("notificationsEnabled",null,q.a.DEVICE,e)}),o.a.createElement(Mt.a,{label:Object(l.b)("Show message preview in desktop notification"),value:a,onChange:e=>k.b.setValue("notificationBodyEnabled",null,q.a.DEVICE,e)}),o.a.createElement(Mt.a,{label:Object(l.b)("Enable audible notifications for this session"),value:i,onChange:e=>k.b.setValue("audioNotificationsEnabled",null,q.a.DEVICE,e)})),o.a.createElement(ie.b,{heading:Object(l.b)("I want to be notified for (Default Setting)"),description:Object(l.b)("This setting will be applied by default to all your rooms.")},o.a.createElement(yn.a,{name:"defaultNotificationLevel",value:(b=m.defaultLevels,b.room===on.a.AllMessages?Pn.AllMessages:b.dm===on.a.AllMessages?Pn.PeopleMentionsKeywords:Pn.MentionsKeywords),disabled:u,definitions:Nn,onChange:e=>{d(Tn(Tn({},s),{},{defaultLevels:Tn(Tn({},s.defaultLevels),{},{dm:e!==Pn.MentionsKeywords?on.a.AllMessages:on.a.MentionsOnly,room:e===Pn.AllMessages?on.a.AllMessages:on.a.MentionsOnly})}))}})),o.a.createElement(ie.b,{heading:Object(l.b)("Play a sound for"),description:Object(l.b)("Applied by default to all rooms on all devices.")},o.a.createElement(fn.a,{label:"People",value:void 0!==m.sound.people,disabled:u||m.defaultLevels.dm===on.a.MentionsOnly,onChange:e=>{d(Tn(Tn({},s),{},{sound:Tn(Tn({},s.sound),{},{people:e?"default":void 0})}))}}),o.a.createElement(fn.a,{label:Object(l.b)("Mentions and Keywords"),value:void 0!==m.sound.mentions,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{sound:Tn(Tn({},s.sound),{},{mentions:e?"default":void 0})}))}}),o.a.createElement(fn.a,{label:Object(l.b)("Audio and Video calls"),value:void 0!==m.sound.calls,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{sound:Tn(Tn({},s.sound),{},{calls:e?"ring":void 0})}))}})),o.a.createElement(ie.b,{heading:Object(l.b)("Other things we think you might be interested in:")},o.a.createElement(fn.a,{label:Object(l.b)("Invited to a room"),value:m.activity.invite,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{activity:Tn(Tn({},s.activity),{},{invite:e})}))}}),o.a.createElement(fn.a,{label:Object(l.b)("New room activity, upgrades and status messages occur"),value:m.activity.status_event,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{activity:Tn(Tn({},s.activity),{},{status_event:e})}))}}),o.a.createElement(fn.a,{label:Object(l.b)("Messages sent by bots"),value:m.activity.bot_notices,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{activity:Tn(Tn({},s.activity),{},{bot_notices:e})}))}})),o.a.createElement(ie.b,{heading:Object(l.b)("Mentions and Keywords"),description:Object(l.b)("Show a badge <badge/> when keywords are used in a room.",{},{badge:o.a.createElement(En.a,{symbol:"1",count:1,color:vn.a.Grey})})},o.a.createElement(fn.a,{label:Object(l.b)("Notify when someone mentions using @room"),value:m.mentions.room,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{mentions:Tn(Tn({},s.mentions),{},{room:e})}))}}),o.a.createElement(fn.a,{label:Object(l.b)("Notify when someone mentions using @displayname or %(mxid)s",{mxid:t.getUserId()}),value:m.mentions.user,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{mentions:Tn(Tn({},s.mentions),{},{user:e})}))}}),o.a.createElement(fn.a,{label:Object(l.b)("Notify when someone uses a keyword"),byline:Object(l.b)("Enter keywords here, or use for spelling variations or nicknames"),value:m.mentions.keywords,disabled:u,onChange:e=>{d(Tn(Tn({},s),{},{mentions:Tn(Tn({},s.mentions),{},{keywords:e})}))}}),o.a.createElement(zt,{id:"mx_NotificationSettings2_Keywords",tags:null!==(e=null==s?void 0:s.keywords)&&void 0!==e?e:[],disabled:u,onAdd:e=>{d(Tn(Tn({},s),{},{keywords:[e,...s.keywords]}))},onRemove:e=>{d(Tn(Tn({},s),{},{keywords:s.keywords.filter((t=>t!==e))}))},label:Object(l.b)("Keyword"),placeholder:Object(l.b)("New keyword")})),o.a.createElement(jn,null),o.a.createElement(ie.b,{heading:Object(l.b)("Quick Actions")},g&&o.a.createElement(E.a,{kind:"primary_outline",disabled:h,onClick:async()=>{p(!0),await Object(Gt.a)(t),p(!1)}},Object(l.b)("Mark all messages as read")),o.a.createElement(E.a,{kind:"danger_outline",disabled:null===s,onClick:()=>{d(bn)}},Object(l.b)("Reset to default settings")))));var b}class Ln extends o.a.Component{render(){const e=k.b.getValue(Ge.a.NotificationSettings2);return o.a.createElement(Me.a,null,e?o.a.createElement(An,null):o.a.createElement(Ae.a,{heading:Object(l.b)("Notifications")},o.a.createElement(an,null)))}}var Un=n(1341);class Fn extends o.a.Component{constructor(e){super(e),i()(this,"onAutocompleteDelayChange",(e=>{this.setState({autocompleteDelay:e.target.value}),k.b.setValue("autocompleteDelay",null,q.a.DEVICE,e.target.value)})),i()(this,"onReadMarkerInViewThresholdMs",(e=>{this.setState({readMarkerInViewThresholdMs:e.target.value}),k.b.setValue("readMarkerInViewThresholdMs",null,q.a.DEVICE,e.target.value)})),i()(this,"onReadMarkerOutOfViewThresholdMs",(e=>{this.setState({readMarkerOutOfViewThresholdMs:e.target.value}),k.b.setValue("readMarkerOutOfViewThresholdMs",null,q.a.DEVICE,e.target.value)})),i()(this,"onKeyboardShortcutsClicked",(()=>{F.a.dispatch({action:B.a.ViewUserSettings,initialTabId:_n.a.Keyboard})})),this.state={autocompleteDelay:k.b.getValueAt(q.a.DEVICE,"autocompleteDelay").toString(10),readMarkerInViewThresholdMs:k.b.getValueAt(q.a.DEVICE,"readMarkerInViewThresholdMs").toString(10),readMarkerOutOfViewThresholdMs:k.b.getValueAt(q.a.DEVICE,"readMarkerOutOfViewThresholdMs").toString(10)}}renderGroup(e,t=q.a.ACCOUNT){return e.map((e=>o.a.createElement(He.a,{key:e,name:e,level:t})))}render(){const e=k.b.getValue("FTUE.useCaseSelection"),t=Fn.ROOM_LIST_SETTINGS.filter((t=>"FTUE.userOnboardingButton"!==t||Object(Un.b)(e)));return o.a.createElement(Me.a,{"data-testid":"mx_PreferencesUserSettingsTab"},o.a.createElement(Ae.a,{heading:Object(l.b)("Preferences")},t.length>0&&o.a.createElement(ie.b,{heading:Object(l.b)("Room list")},this.renderGroup(t)),o.a.createElement(ie.b,{heading:Object(l.b)("Spaces")},this.renderGroup(Fn.SPACES_SETTINGS,q.a.ACCOUNT)),o.a.createElement(ie.b,{heading:Object(l.b)("Keyboard shortcuts"),description:Object(l.b)("To view all keyboard shortcuts, <a>click here</a>.",{},{a:e=>o.a.createElement(E.a,{kind:"link_inline",onClick:this.onKeyboardShortcutsClicked},e)})},this.renderGroup(Fn.KEYBINDINGS_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Displaying time")},this.renderGroup(Fn.TIME_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Presence"),description:Object(l.b)("Share your activity and status with others.")},this.renderGroup(Fn.PRESENCE_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Composer")},this.renderGroup(Fn.COMPOSER_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Code blocks")},this.renderGroup(Fn.CODE_BLOCKS_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Images, GIFs and videos")},this.renderGroup(Fn.IMAGES_AND_VIDEOS_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Timeline")},this.renderGroup(Fn.TIMELINE_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("Room directory")},this.renderGroup(Fn.ROOM_DIRECTORY_SETTINGS)),o.a.createElement(ie.b,{heading:Object(l.b)("General"),stretchContent:!0},this.renderGroup(Fn.GENERAL_SETTINGS),o.a.createElement(He.a,{name:"Electron.showTrayIcon",level:q.a.PLATFORM,hideIfCannotSet:!0}),o.a.createElement(He.a,{name:"Electron.enableHardwareAcceleration",level:q.a.PLATFORM,hideIfCannotSet:!0,label:Object(l.b)("Enable hardware acceleration (restart %(appName)s to take effect)",{appName:We.b.get().brand})}),o.a.createElement(He.a,{name:"Electron.alwaysShowMenuBar",level:q.a.PLATFORM,hideIfCannotSet:!0}),o.a.createElement(He.a,{name:"Electron.autoLaunch",level:q.a.PLATFORM,hideIfCannotSet:!0}),o.a.createElement(He.a,{name:"Electron.warnBeforeExit",level:q.a.PLATFORM,hideIfCannotSet:!0}),o.a.createElement(g.a,{label:Object(l.b)("Autocomplete delay (ms)"),type:"number",value:this.state.autocompleteDelay,onChange:this.onAutocompleteDelayChange}),o.a.createElement(g.a,{label:Object(l.b)("Read Marker lifetime (ms)"),type:"number",value:this.state.readMarkerInViewThresholdMs,onChange:this.onReadMarkerInViewThresholdMs}),o.a.createElement(g.a,{label:Object(l.b)("Read Marker off-screen lifetime (ms)"),type:"number",value:this.state.readMarkerOutOfViewThresholdMs,onChange:this.onReadMarkerOutOfViewThresholdMs}))))}}i()(Fn,"ROOM_LIST_SETTINGS",["breadcrumbs","FTUE.userOnboardingButton"]),i()(Fn,"SPACES_SETTINGS",["Spaces.allRoomsInHome"]),i()(Fn,"KEYBINDINGS_SETTINGS",["ctrlFForSearch"]),i()(Fn,"PRESENCE_SETTINGS",["sendReadReceipts","sendTypingNotifications"]),i()(Fn,"COMPOSER_SETTINGS",["MessageComposerInput.autoReplaceEmoji","MessageComposerInput.useMarkdown","MessageComposerInput.suggestEmoji","MessageComposerInput.ctrlEnterToSend","MessageComposerInput.surroundWith","MessageComposerInput.showStickersButton","MessageComposerInput.insertTrailingColon"]),i()(Fn,"TIME_SETTINGS",["showTwelveHourTimestamps","alwaysShowTimestamps"]),i()(Fn,"CODE_BLOCKS_SETTINGS",["enableSyntaxHighlightLanguageDetection","expandCodeByDefault","showCodeLineNumbers"]),i()(Fn,"IMAGES_AND_VIDEOS_SETTINGS",["urlPreviewsEnabled","autoplayGifs","autoplayVideo","showImages"]),i()(Fn,"TIMELINE_SETTINGS",["showTypingNotifications","showRedactions","showReadReceipts","showJoinLeaves","showDisplaynameChanges","showChatEffects","showAvatarChanges","Pill.shouldShowPillAvatar","TextualBody.enableBigEmoji","scrollToBottomOnMessageSent","useOnlyCurrentProfiles"]),i()(Fn,"ROOM_DIRECTORY_SETTINGS",["SpotlightSearch.showNsfwPublicRooms"]),i()(Fn,"GENERAL_SETTINGS",["promptBeforeInviteUnknownUsers"]);var Bn=n(18),Vn=n(132),Wn=n(776);const zn=e=>{switch(e){case Vn.b.AudioOutput:return Vn.c.getAudioOutput();case Vn.b.AudioInput:return Vn.c.getAudioInput();case Vn.b.VideoInput:return Vn.c.getVideoInput()}};class Hn extends o.a.Component{constructor(e){super(e),i()(this,"context",void 0),i()(this,"refreshMediaDevices",(async e=>{var t;this.setState({mediaDevices:null!==(t=await Vn.c.getDevices())&&void 0!==t?t:null,[Vn.b.AudioOutput]:zn(Vn.b.AudioOutput),[Vn.b.AudioInput]:zn(Vn.b.AudioInput),[Vn.b.VideoInput]:zn(Vn.b.VideoInput)}),e&&e.getTracks().forEach((e=>e.stop()))})),i()(this,"requestMediaPermissions",(async()=>{const e=await Object(Wn.a)();e&&await this.refreshMediaDevices(e)})),i()(this,"setDevice",(async(e,t)=>{this.setState({[t]:e});try{await Vn.c.instance.setDevice(e,t)}catch(n){u.a.error(`Failed to set device ${t}: ${e}`),this.setState({[t]:zn(t)})}})),i()(this,"changeWebRtcMethod",(e=>{this.context.setForceTURN(!e)})),i()(this,"changeFallbackICEServerAllowed",(e=>{this.context.setFallbackICEServerAllowed(e)})),this.state={mediaDevices:null,[Vn.b.AudioOutput]:null,[Vn.b.AudioInput]:null,[Vn.b.VideoInput]:null,audioAutoGainControl:Vn.c.getAudioAutoGainControl(),audioEchoCancellation:Vn.c.getAudioEchoCancellation(),audioNoiseSuppression:Vn.c.getAudioNoiseSuppression()}}async componentDidMount(){await Vn.c.hasAnyLabeledDevices()&&await this.refreshMediaDevices()}renderDeviceOptions(e,t){return e.map((e=>o.a.createElement("option",{key:`${t}-${e.deviceId}`,value:e.deviceId},e.label)))}renderDropdown(e,t){var n;const a=null===(n=this.state.mediaDevices)||void 0===n?void 0:n[e].slice(0);if(null==a||!a.length)return null;const i=Vn.c.getDefaultDevice(a);return o.a.createElement(g.a,{element:"select",label:t,value:this.state[e]||i,onChange:t=>this.setDevice(t.target.value,e)},this.renderDeviceOptions(a,e))}render(){let e,t,n,a;return this.state.mediaDevices?this.state.mediaDevices&&(t=this.renderDropdown(Vn.b.AudioOutput,Object(l.b)("Audio Output"))||o.a.createElement("p",null,Object(l.b)("No Audio Outputs detected")),n=this.renderDropdown(Vn.b.AudioInput,Object(l.b)("Microphone"))||o.a.createElement("p",null,Object(l.b)("No Microphones detected")),a=this.renderDropdown(Vn.b.VideoInput,Object(l.b)("Camera"))||o.a.createElement("p",null,Object(l.b)("No Webcams detected"))):e=o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("Missing media permissions, click the button below to request.")),o.a.createElement(E.a,{onClick:this.requestMediaPermissions,kind:"primary"},Object(l.b)("Request media permissions"))),o.a.createElement(Me.a,null,o.a.createElement(Ae.a,{heading:Object(l.b)("Voice & Video")},e,o.a.createElement(ie.b,{heading:Object(l.b)("Voice settings"),stretchContent:!0},t,n,o.a.createElement(Mt.a,{value:this.state.audioAutoGainControl,onChange:async e=>{await Vn.c.setAudioAutoGainControl(e),this.setState({audioAutoGainControl:Vn.c.getAudioAutoGainControl()})},label:Object(l.b)("Automatically adjust the microphone volume"),"data-testid":"voice-auto-gain"})),o.a.createElement(ie.b,{heading:Object(l.b)("Video settings"),stretchContent:!0},a,o.a.createElement(He.a,{name:"VideoView.flipVideoHorizontally",level:q.a.ACCOUNT}))),o.a.createElement(Ae.a,{heading:Object(l.b)("Advanced")},o.a.createElement(ie.b,{heading:Object(l.b)("Voice processing")},o.a.createElement(Mt.a,{value:this.state.audioNoiseSuppression,onChange:async e=>{await Vn.c.setAudioNoiseSuppression(e),this.setState({audioNoiseSuppression:Vn.c.getAudioNoiseSuppression()})},label:Object(l.b)("Noise suppression"),"data-testid":"voice-noise-suppression"}),o.a.createElement(Mt.a,{value:this.state.audioEchoCancellation,onChange:async e=>{await Vn.c.setAudioEchoCancellation(e),this.setState({audioEchoCancellation:Vn.c.getAudioEchoCancellation()})},label:Object(l.b)("Echo cancellation"),"data-testid":"voice-echo-cancellation"})),o.a.createElement(ie.b,{heading:Object(l.b)("Connection")},o.a.createElement(He.a,{name:"webRtcAllowPeerToPeer",level:q.a.DEVICE,onChange:this.changeWebRtcMethod}),o.a.createElement(He.a,{name:"fallbackICEServerAllowed",label:Object(l.b)("Allow fallback call assist server (%(server)s)",{server:new URL(Bn.h).pathname}),level:q.a.DEVICE,onChange:this.changeFallbackICEServerAllowed}))))}}i()(Hn,"contextType",Le.a);var Gn=n(117),Kn=n(1316),qn=n(632);const $n=["action"];function Yn(){var e;null===(e=I.a.get())||void 0===e||e.installUpdate()}const Jn=[Kn.d.Ready,Kn.d.Error,Kn.d.NotAvailable];var Qn=()=>{const[e,t]=Object(r.useState)(null);Object(qn.a)(F.a,(e=>{let{action:n}=e,a=Ft()(e,$n);n===B.a.CheckUpdates&&t(a)}));const n=!!e&&!Jn.includes(e.status);let a;return e&&(a=o.a.createElement("span",{className:"mx_UpdateCheckButton_summary"},function(e,t){switch(e){case Kn.d.Error:return Object(l.b)("Error encountered (%(errorDetail)s).",{errorDetail:t});case Kn.d.Checking:return Object(l.b)("Checking for an update…");case Kn.d.NotAvailable:return Object(l.b)("No update available.");case Kn.d.Downloading:return Object(l.b)("Downloading update…");case Kn.d.Ready:return Object(l.b)("New version available. <a>Update now.</a>",{},{a:e=>o.a.createElement(E.a,{kind:"link_inline",onClick:Yn},e)})}}(e.status,e.detail),n&&o.a.createElement(re.a,null))),o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{onClick:()=>{var e;t(null),null===(e=I.a.get())||void 0===e||e.startUpdateCheck()},kind:"primary",disabled:n},Object(l.b)("Check for update")),a)},Xn=n(272),Zn=n(143);class ea extends o.a.Component{constructor(e){super(e),i()(this,"context",void 0),i()(this,"onClearCacheAndReload",(()=>{I.a.get()&&(u.a.log("Clear cache & reload clicked"),this.context.stopClient(),this.context.store.deleteAllData().then((()=>{var e;null===(e=I.a.get())||void 0===e||e.reload()})))})),i()(this,"onBugReport",(()=>{v.b.createDialog(Xn.a,{})})),i()(this,"onStartBotChat",(()=>{this.props.closeSettingsFn(),Object(Gn.c)(this.context,{dmUserId:We.b.get("welcome_user_id"),andView:!0})})),i()(this,"getVersionTextToCopy",(()=>{const{appVersion:e,olmVersion:t}=this.getVersionInfo();return`${e}\n${t}`})),this.state={appVersion:null,canUpdate:!1}}componentDidMount(){var e,t;null===(e=I.a.get())||void 0===e||e.getAppVersion().then((e=>this.setState({appVersion:e}))).catch((e=>{u.a.error("Error getting vector version: ",e)})),null===(t=I.a.get())||void 0===t||t.canSelfUpdate().then((e=>this.setState({canUpdate:e}))).catch((e=>{u.a.error("Error getting self updatability: ",e)}))}getVersionInfo(){const e=We.b.get().brand,t=this.state.appVersion||"unknown",n=this.context.olmVersion,a=n?`${n[0]}.${n[1]}.${n[2]}`:"<not-enabled>";return{appVersion:`${Object(l.b)("%(brand)s version:",{brand:e})} ${t}`,olmVersion:`${Object(l.b)("Olm version:")} ${a}`}}renderLegal(){const e=We.b.get().terms_and_conditions_links;if(!e)return null;const t=[];for(const n of e)t.push(o.a.createElement("div",{key:n.url},o.a.createElement(xt.a,{href:n.url},n.text)));return o.a.createElement(ie.b,{heading:Object(l.b)("Legal")},o.a.createElement(ie.a,null,t))}renderCredits(){return o.a.createElement(ie.b,{heading:Object(l.b)("Credits")},o.a.createElement(ie.a,null,o.a.createElement("ul",null,o.a.createElement("li",null,Object(l.b)("The <photo>default cover photo</photo> is © <author>Jesús Roncero</author> used under the terms of <terms>CC-BY-SA 4.0</terms>.",{},{photo:e=>o.a.createElement(xt.a,{href:"themes/element/img/backgrounds/lake.jpg",rel:"noreferrer noopener",target:"_blank"},e),author:e=>o.a.createElement(xt.a,{href:"https://www.flickr.com/golan"},e),terms:e=>o.a.createElement(xt.a,{href:"https://creativecommons.org/licenses/by-sa/4.0/",rel:"noreferrer noopener",target:"_blank"},e)})),o.a.createElement("li",null,Object(l.b)("The <colr>twemoji-colr</colr> font is © <author>Mozilla Foundation</author> used under the terms of <terms>Apache 2.0</terms>.",{},{colr:e=>o.a.createElement(xt.a,{href:"https://github.com/matrix-org/twemoji-colr",rel:"noreferrer noopener",target:"_blank"},e),author:e=>o.a.createElement(xt.a,{href:"https://mozilla.org"},e),terms:e=>o.a.createElement(xt.a,{href:"https://www.apache.org/licenses/LICENSE-2.0",rel:"noreferrer noopener",target:"_blank"},e)})),o.a.createElement("li",null,Object(l.b)("The <twemoji>Twemoji</twemoji> emoji art is © <author>Twitter, Inc and other contributors</author> used under the terms of <terms>CC-BY 4.0</terms>.",{},{twemoji:e=>o.a.createElement(xt.a,{href:"https://twemoji.twitter.com/"},e),author:e=>o.a.createElement(xt.a,{href:"https://twemoji.twitter.com/"},e),terms:e=>o.a.createElement(xt.a,{href:"https://creativecommons.org/licenses/by/4.0/",rel:"noreferrer noopener",target:"_blank"},e)})))))}render(){const e=We.b.get().brand;let t,n,a=Object(l.b)("For help with using %(brand)s, click <a>here</a>.",{brand:e},{a:e=>o.a.createElement(xt.a,{href:We.b.get("help_url")},e)});We.b.get("welcome_user_id")&&Object(l.f)().startsWith("en")&&(a=o.a.createElement("div",null,Object(l.b)("For help with using %(brand)s, click <a>here</a> or start a chat with our bot using the button below.",{brand:e},{a:e=>o.a.createElement(xt.a,{href:We.b.get("help_url"),rel:"noreferrer noopener",target:"_blank"},e)}),o.a.createElement("div",null,o.a.createElement(E.a,{onClick:this.onStartBotChat,kind:"primary"},Object(l.b)("Chat with %(brand)s Bot",{brand:e}))))),this.state.canUpdate&&(t=o.a.createElement(Qn,null)),We.b.get().bug_report_endpoint_url&&(n=o.a.createElement(ie.b,{heading:Object(l.b)("Bug reporting"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement(ie.a,null,Object(l.b)("If you've submitted a bug via GitHub, debug logs can help us track down the problem. ")),Object(l.b)("Debug logs contain application usage data including your username, the IDs or aliases of the rooms you have visited, which UI elements you last interacted with, and the usernames of other users. They do not contain messages."))},o.a.createElement(E.a,{onClick:this.onBugReport,kind:"primary"},Object(l.b)("Submit debug logs")),o.a.createElement(ie.a,null,Object(l.b)("To report a Matrix-related security issue, please read the Matrix.org <a>Security Disclosure Policy</a>.",{},{a:e=>o.a.createElement(xt.a,{href:"https://matrix.org/security-disclosure-policy/"},e)}))));const{appVersion:i,olmVersion:r}=this.getVersionInfo();return o.a.createElement(Me.a,null,o.a.createElement(Ae.a,{heading:Object(l.b)("Help & About")},n,o.a.createElement(ie.b,{heading:Object(l.b)("FAQ"),description:a}),o.a.createElement(ie.b,{heading:Object(l.b)("Versions")},o.a.createElement(ie.a,null,o.a.createElement(Zn.a,{getTextToCopy:this.getVersionTextToCopy},i,o.a.createElement("br",null),r,o.a.createElement("br",null)),t)),this.renderLegal(),this.renderCredits(),o.a.createElement(ie.b,{heading:Object(l.b)("Advanced")},o.a.createElement(ie.a,null,Object(l.b)("Homeserver is <code>%(homeserverUrl)s</code>",{homeserverUrl:this.context.getHomeserverUrl()},{code:e=>o.a.createElement("code",null,e)})),this.context.getIdentityServerUrl()&&o.a.createElement(ie.a,null,Object(l.b)("Identity server is <code>%(identityServerUrl)s</code>",{identityServerUrl:this.context.getIdentityServerUrl()},{code:e=>o.a.createElement("code",null,e)})),o.a.createElement(ie.a,null,o.a.createElement("details",null,o.a.createElement("summary",null,Object(l.b)("Access Token")),o.a.createElement("b",null,Object(l.b)("Your access token gives full access to your account. Do not share it with anyone.")),o.a.createElement(Zn.a,{getTextToCopy:()=>this.context.getAccessToken()},this.context.getAccessToken()))),o.a.createElement(E.a,{onClick:this.onClearCacheAndReload,kind:"danger"},Object(l.b)("Clear cache and reload")))))}}i()(ea,"contextType",Le.a);var ta=n(575),na=n(122);class aa extends o.a.Component{constructor(e){super(e),i()(this,"onPersonalRuleChanged",(e=>{this.setState({newPersonalRule:e.target.value})})),i()(this,"onNewListChanged",(e=>{this.setState({newList:e.target.value})})),i()(this,"onAddPersonalRule",(async e=>{e.preventDefault(),e.stopPropagation();let t=na.d;this.state.newPersonalRule.startsWith("@")&&(t=na.e),this.setState({busy:!0});try{const e=await ta.a.sharedInstance().getOrCreatePersonalList();await e.banEntity(t,this.state.newPersonalRule,Object(l.b)("Ignored/Blocked")),this.setState({newPersonalRule:""})}catch(e){u.a.error(e),v.b.createDialog(f.a,{title:Object(l.b)("Error adding ignored user/server"),description:Object(l.b)("Something went wrong. Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}})),i()(this,"onSubscribeList",(async e=>{e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});try{const e=await p.a.safeGet().joinRoom(this.state.newList);await ta.a.sharedInstance().subscribeToList(e.roomId),this.setState({newList:""})}catch(e){u.a.error(e),v.b.createDialog(f.a,{title:Object(l.b)("Error subscribing to list"),description:Object(l.b)("Please verify the room ID or address and try again.")})}finally{this.setState({busy:!1})}})),this.state={busy:!1,newPersonalRule:"",newList:""}}async removePersonalRule(e){this.setState({busy:!0});try{const t=ta.a.sharedInstance().getPersonalList();await t.unbanEntity(e.kind,e.entity)}catch(e){u.a.error(e),v.b.createDialog(f.a,{title:Object(l.b)("Error removing ignored user/server"),description:Object(l.b)("Something went wrong. Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}async unsubscribeFromList(e){this.setState({busy:!0});try{await ta.a.sharedInstance().unsubscribeFromList(e.roomId),await p.a.safeGet().leave(e.roomId)}catch(e){u.a.error(e),v.b.createDialog(f.a,{title:Object(l.b)("Error unsubscribing from list"),description:Object(l.b)("Please try again or view your console for hints.")})}finally{this.setState({busy:!1})}}viewListRules(e){const t=p.a.safeGet().getRoom(e.roomId),n=t?t.name:e.roomId,a=e=>{if(0===e.length)return o.a.createElement("i",null,Object(l.b)("None"));const t=[];for(const n of e)t.push(o.a.createElement("li",{key:n.kind+n.entity},o.a.createElement("code",null,n.entity)));return o.a.createElement("ul",null,t)};v.b.createDialog(he.a,{title:Object(l.b)("Ban list rules - %(roomName)s",{roomName:n}),description:o.a.createElement("div",null,o.a.createElement("h3",null,Object(l.b)("Server rules")),a(e.serverRules),o.a.createElement("h3",null,Object(l.b)("User rules")),a(e.userRules)),button:Object(l.b)("Close"),hasCancelButton:!1})}renderPersonalBanListRules(){const e=ta.a.sharedInstance().getPersonalList(),t=e?[...e.userRules,...e.serverRules]:[];if(!e||t.length<=0)return o.a.createElement("i",null,Object(l.b)("You have not ignored anyone."));const n=[];for(const e of t)n.push(o.a.createElement("li",{key:e.entity,className:"mx_MjolnirUserSettingsTab_listItem"},o.a.createElement(E.a,{kind:"danger_sm",onClick:()=>this.removePersonalRule(e),disabled:this.state.busy},Object(l.b)("Remove"))," ",o.a.createElement("code",null,e.entity)));return o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("You are currently ignoring:")),o.a.createElement("ul",null,n))}renderSubscribedBanLists(){const e=ta.a.sharedInstance().getPersonalList(),t=ta.a.sharedInstance().lists.filter((t=>!e||e.roomId!==t.roomId));if(!t||t.length<=0)return o.a.createElement("i",null,Object(l.b)("You are not subscribed to any lists"));const n=[];for(const e of t){const t=p.a.safeGet().getRoom(e.roomId),a=t?o.a.createElement("span",null,t.name," (",o.a.createElement("code",null,e.roomId),")"):o.a.createElement("code",null,"list.roomId");n.push(o.a.createElement("li",{key:e.roomId,className:"mx_MjolnirUserSettingsTab_listItem"},o.a.createElement(E.a,{kind:"danger_sm",onClick:()=>this.unsubscribeFromList(e),disabled:this.state.busy},Object(l.b)("Unsubscribe"))," ",o.a.createElement(E.a,{kind:"primary_sm",onClick:()=>this.viewListRules(e),disabled:this.state.busy},Object(l.b)("View rules"))," ",a))}return o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("You are currently subscribed to:")),o.a.createElement("ul",null,n))}render(){const e=We.b.get().brand;return o.a.createElement(Me.a,null,o.a.createElement(Ae.a,{heading:Object(l.b)("Ignored users")},o.a.createElement(ie.a,null,o.a.createElement("span",{className:"warning"},Object(l.b)("⚠ These settings are meant for advanced users.")),o.a.createElement("p",null,Object(l.b)("Add users and servers you want to ignore here. Use asterisks to have %(brand)s match any characters. For example, <code>@bot:*</code> would ignore all users that have the name 'bot' on any server.",{brand:e},{code:e=>o.a.createElement("code",null,e)})),o.a.createElement("p",null,Object(l.b)("Ignoring people is done through ban lists which contain rules for who to ban. Subscribing to a ban list means the users/servers blocked by that list will be hidden from you."))),o.a.createElement(ie.b,{heading:Object(l.b)("Personal ban list"),description:Object(l.b)("Your personal ban list holds all the users/servers you personally don't want to see messages from. After ignoring your first user/server, a new room will show up in your room list named '%(myBanList)s' - stay in this room to keep the ban list in effect.",{myBanList:Object(l.b)("My Ban List")})},this.renderPersonalBanListRules(),o.a.createElement("form",{onSubmit:this.onAddPersonalRule,autoComplete:"off"},o.a.createElement(g.a,{type:"text",label:Object(l.b)("Server or user ID to ignore"),placeholder:Object(l.b)("eg: @bot:* or example.org"),value:this.state.newPersonalRule,onChange:this.onPersonalRuleChanged}),o.a.createElement(E.a,{type:"submit",kind:"primary",onClick:this.onAddPersonalRule,disabled:this.state.busy},Object(l.b)("Ignore")))),o.a.createElement(ie.b,{heading:Object(l.b)("Subscribed lists"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("span",{className:"warning"},Object(l.b)("Subscribing to a ban list will cause you to join it!"))," ",o.a.createElement("span",null,Object(l.b)("If this isn't what you want, please use a different tool to ignore users.")))},this.renderSubscribedBanLists(),o.a.createElement("form",{onSubmit:this.onSubscribeList,autoComplete:"off"},o.a.createElement(g.a,{type:"text",label:Object(l.b)("Room ID or address of ban list"),value:this.state.newList,onChange:this.onNewListChanged}),o.a.createElement(E.a,{type:"submit",kind:"primary",onClick:this.onSubscribeList,disabled:this.state.busy},Object(l.b)("Subscribe"))))))}}var ia=n(1438),ra=n(687),oa=n(1347);const sa=Object.entries(pe.b).filter((([e])=>e!==pe.c.LABS||We.b.get("show_labs_settings"))),la=({name:e})=>{const t=Object(ra.a)(e),n=Object(ra.b)(e);return t&&n?o.a.createElement("li",{className:"mx_KeyboardShortcut_shortcutRow"},t,o.a.createElement(oa.a,{value:n})):null},ca=({categoryName:e,category:t})=>t.categoryLabel?o.a.createElement(ie.b,{heading:Object(l.b)(t.categoryLabel),key:e},o.a.createElement("ul",{className:"mx_KeyboardShortcut_shortcutList"},t.settingNames.map((e=>o.a.createElement(la,{key:e,name:e}))))):null;var da=()=>o.a.createElement(Me.a,null,o.a.createElement(Ae.a,{heading:Object(l.b)("Keyboard")},sa.map((([e,t])=>o.a.createElement(ca,{key:e,categoryName:e,category:t}))))),ua=n(1350),ma=n(1406),ha=n(1392),pa=n(35),ga=n(1352),ba=n(1389);function va(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function fa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?va(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):va(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const ya=(e,t)=>{const{name:n,version:a,url:i}=Object(ha.a)(e,t.device_id);return{appName:n,appVersion:a,url:i}};let Ea=function(e){return e.Unsupported="Unsupported",e.Default="Default",e}({});const wa=()=>{var e;const t=Object(r.useContext)(Le.a),n=t.getDeviceId(),a=t.getSafeUserId(),[i,o]=Object(r.useState)({}),[s,c]=Object(r.useState)([]),[d,h]=Object(r.useState)(new Map),[p,g]=Object(r.useState)(!0),[b,v]=Object(r.useState)(!0),[f,y]=Object(r.useState)();Object(r.useEffect)((()=>{t.doesServerSupportUnstableFeature("org.matrix.msc3881").then((e=>{v(e)}))}),[t]);const E=Object(r.useCallback)((async()=>{g(!0);try{const e=await async function(e){const{devices:t}=await e.getDevices(),n={};for(const a of t)n[a.device_id]=fa(fa(fa({},a),{},{isVerified:await Object(ba.a)(e,a.device_id)},ya(e,a)),Object(ga.b)(a[m.UNSTABLE_MSC3852_LAST_SEEN_UA.name]));return n}(t);o(e);const{pushers:n}=await t.getPushers();c(n);const a=new Map;Object.keys(e).forEach((e=>{const n=`${m.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name}.${e}`,i=t.getAccountData(n);i&&a.set(e,i.getContent())})),h(a),g(!1)}catch(e){404==e.httpStatus?y(Ea.Unsupported):(u.a.error("Error loading sessions:",e),y(Ea.Default)),g(!1)}}),[t]);Object(r.useEffect)((()=>{E()}),[E]),Object(r.useEffect)((()=>{const e=Object.keys(i);e.length&&Object(ha.b)(e,t)}),[i,t]),Object(pa.a)(t,ut.b.DevicesUpdated,(e=>{e.includes(a)&&E()})),Object(pa.a)(t,m.ClientEvent.AccountData,(e=>{const t=e.getType();if(t.startsWith(m.LOCAL_NOTIFICATION_SETTINGS_PREFIX.name)){const n=new Map(d),a=t.slice(t.lastIndexOf(".")+1);n.set(a,e.getContent()),h(n)}}));const w=!(null===(e=i[n])||void 0===e||!e.isVerified)&&a?async e=>await t.getCrypto().requestDeviceVerification(a,e):void 0,S=Object(r.useCallback)((async(e,n)=>{const a=i[e];if(n!==(null==a?void 0:a.display_name))try{await t.setDeviceDetails(e,{display_name:n}),await E()}catch(e){throw u.a.error("Error setting session display name",e),new Error(Object(l.b)("Failed to set display name"))}}),[t,i,E]),_=Object(r.useCallback)((async(e,n)=>{try{const a=s.find((t=>t[m.PUSHER_DEVICE_ID.name]===e));a?await t.setPusher(fa(fa({},a),{},{[m.PUSHER_ENABLED.name]:n})):d.has(e)&&await t.setLocalNotificationSettings(e,{is_silenced:!n})}catch(e){throw u.a.error("Error setting pusher state",e),new Error(Object(l.b)("Failed to set pusher state"))}finally{await E()}}),[t,s,d,E]);return{devices:i,pushers:s,localNotificationSettings:d,currentDeviceId:n,isLoadingDeviceList:p,error:f,requestDeviceVerification:w,refreshDevices:E,saveDeviceName:S,setPushNotifications:_,supportsMSC3881:b}};var Sa;function _a(){return _a=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_a.apply(this,arguments)}function Ca(e){return r.createElement("svg",_a({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),Sa||(Sa=r.createElement("path",{d:"M4 8.818L7.125 12 14 5",stroke:"currentColor",strokeWidth:1.5,strokeLinecap:"round",strokeLinejoin:"round"})))}const Oa=["value","options","selectedLabel","className"],xa=(e,t)=>n=>{const a=e.find((({id:e})=>e===n));return a?t?`${t}: ${a.label}`:a.label:null},ka=e=>{let{value:t,options:n,selectedLabel:a,className:i}=e,r=Ft()(e,Oa);return o.a.createElement(j.a,Lt()({},r,{value:t,className:Ye()("mx_FilterDropdown",i),getShortOption:xa(n,a)}),n.map((({id:e,label:n,description:a})=>o.a.createElement("div",{className:"mx_FilterDropdown_option","data-testid":`filter-option-${e}`,key:e},e===t&&o.a.createElement(Ca,{className:"mx_FilterDropdown_optionSelectedIcon"}),o.a.createElement("span",{className:"mx_FilterDropdown_optionLabel"},n),!!a&&o.a.createElement("span",{className:"mx_FilterDropdown_optionDescription"},a)))))};var Ra=n(71),ja=n(129);const Ia=["title","description"];var Ta=e=>{let{title:t,description:n}=e,a=Ft()(e,Ia);return o.a.createElement(E.a,Lt()({},a,{kind:"link_inline",onClick:()=>{v.b.createDialog(ja.a,{title:t,description:n,button:Object(l.b)("Got it"),hasCloseButton:!0})},className:"mx_LearnMore_button"}),Object(l.b)("Learn more"))};const Pa=({device:e,saveDeviceName:t,stopEditing:n})=>{const[a,i]=Object(r.useState)(e.display_name||""),[s,c]=Object(r.useState)(!1),[d,u]=Object(r.useState)(null);Object(r.useEffect)((()=>{i(e.display_name||"")}),[e.display_name]);const m=async e=>{c(!0),u(null),e.preventDefault();try{await t(a),n()}catch(e){u(Object(l.b)("Failed to set display name")),c(!1)}},h=`device-rename-${e.device_id}`,p=`device-rename-description-${e.device_id}`;return o.a.createElement("form",{"aria-disabled":s,className:"mx_DeviceDetailHeading_renameForm",onSubmit:m,method:"post"},o.a.createElement("p",{id:h,className:"mx_DeviceDetailHeading_renameFormHeading"},Object(l.b)("Rename session")),o.a.createElement("div",null,o.a.createElement(g.a,{"data-testid":"device-rename-input",type:"text",value:a,autoComplete:"off",onChange:e=>i(e.target.value),autoFocus:!0,disabled:s,"aria-labelledby":h,"aria-describedby":p,className:"mx_DeviceDetailHeading_renameFormInput",maxLength:100}),o.a.createElement(qt.a,{id:p},Object(l.b)("Please be aware that session names are also visible to people you communicate with."),o.a.createElement(Ta,{title:Object(l.b)("Renaming sessions"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("Other users in direct messages and rooms that you join are able to view a full list of your sessions.")),o.a.createElement("p",null,Object(l.b)("This provides them with confidence that they are really speaking to you, but it also means they can see the session name you enter here.")))}),!!d&&o.a.createElement("span",{"data-testid":"device-rename-error",className:"mx_DeviceDetailHeading_renameFormError"},d))),o.a.createElement("div",{className:"mx_DeviceDetailHeading_renameFormButtons"},o.a.createElement(E.a,{onClick:m,kind:"primary","data-testid":"device-rename-submit-cta",disabled:s},Object(l.b)("Save")),o.a.createElement(E.a,{onClick:n,kind:"secondary","data-testid":"device-rename-cancel-cta",disabled:s},Object(l.b)("Cancel")),s&&o.a.createElement(T.a,{w:16,h:16})))},Na=({device:e,saveDeviceName:t})=>{const[n,a]=Object(r.useState)(!1);return n?o.a.createElement(Pa,{device:e,saveDeviceName:t,stopEditing:()=>a(!1)}):o.a.createElement("div",{className:"mx_DeviceDetailHeading","data-testid":"device-detail-heading"},o.a.createElement(Pe.a,{size:"4"},e.display_name||e.device_id),o.a.createElement(E.a,{kind:"link_inline",onClick:()=>a(!0),className:"mx_DeviceDetailHeading_renameCta","data-testid":"device-heading-rename-cta"},Object(l.b)("Rename")))};var Da;function Ma(){return Ma=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ma.apply(this,arguments)}function Aa(e){return r.createElement("svg",Ma({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 18 18",role:"presentation","aria-hidden":!0},e),Da||(Da=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M2 3.05v6.22C2 15.63 9 17 9 17s7-1.37 7-7.73V3.05L9 1 2 3.05zm9.94 2.47c.19-.18.49-.17.67.02.16.18.16.45.02.63l-4.22 5.11-.03.04c-.28.34-.79.39-1.13.11a.29.29 0 01-.077-.067.912.912 0 00-.023-.023L5.34 9.26c-.2-.24-.18-.6.06-.8.2-.18.49-.18.7-.04l1.57 1.1 4.27-4z",fill:"currentColor"})))}var La=n(869),Ua=n(1391),Fa=n(1319);const Ba={[Fa.a.Inactive]:Ua.a,[Fa.a.Verified]:Aa,[Fa.a.Unverified]:La.Icon,[Fa.a.Unverifiable]:La.Icon},Va=({variation:e})=>{const t=Ba[e];return o.a.createElement("div",{className:Ye()("mx_DeviceSecurityCard_icon",e)},o.a.createElement(t,{height:16,width:16}))};var Wa=({variation:e,heading:t,description:n,children:a})=>o.a.createElement("div",{className:"mx_DeviceSecurityCard"},o.a.createElement(Va,{variation:e}),o.a.createElement("div",{className:"mx_DeviceSecurityCard_content"},o.a.createElement("p",{className:"mx_DeviceSecurityCard_heading"},t),o.a.createElement("p",{className:"mx_DeviceSecurityCard_description"},n),!!a&&o.a.createElement("div",{className:"mx_DeviceSecurityCard_actions"},a)));const za={[Fa.a.Verified]:{title:Object(l.b)("Verified sessions"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("Verified sessions are anywhere you are using this account after entering your passphrase or confirming your identity with another verified session.")),o.a.createElement("p",null,Object(l.b)("This means that you have all the keys needed to unlock your encrypted messages and confirm to other users that you trust this session.")))},[Fa.a.Unverified]:{title:Object(l.b)("Unverified sessions"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("Unverified sessions are sessions that have logged in with your credentials but have not been cross-verified.")),o.a.createElement("p",null,Object(l.b)("You should make especially certain that you recognise these sessions as they could represent an unauthorised use of your account.")))},[Fa.a.Unverifiable]:{title:Object(l.b)("Unverified session"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("This session doesn't support encryption and thus can't be verified.")),o.a.createElement("p",null,Object(l.b)("You won't be able to participate in rooms where encryption is enabled when using this session.")),o.a.createElement("p",null,Object(l.b)("For best security and privacy, it is recommended to use Matrix clients that support encryption.")))},[Fa.a.Inactive]:{title:Object(l.b)("Inactive sessions"),description:o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,Object(l.b)("Inactive sessions are sessions you have not used in some time, but they continue to receive encryption keys.")),o.a.createElement("p",null,Object(l.b)("Removing inactive sessions improves security and performance, and makes it easier for you to identify if a new session is suspicious.")))}},Ha=({variation:e})=>{const{title:t,description:n}=za[e];return o.a.createElement(Ta,{title:t,description:n})},Ga=({device:e,isCurrentDevice:t,onVerifyDevice:n})=>{const a=((e,t)=>{if(e.isVerified){const e=t?Object(l.b)("Your current session is ready for secure messaging."):Object(l.b)("This session is ready for secure messaging.");return{variation:Fa.a.Verified,heading:Object(l.b)("Verified session"),description:o.a.createElement(o.a.Fragment,null,e,o.a.createElement(Ha,{variation:Fa.a.Verified}))}}if(null===e.isVerified)return{variation:Fa.a.Unverified,heading:Object(l.b)("Unverified session"),description:o.a.createElement(o.a.Fragment,null,Object(l.b)("This session doesn't support encryption and thus can't be verified."),o.a.createElement(Ha,{variation:Fa.a.Unverifiable}))};const n=t?Object(l.b)("Verify your current session for enhanced secure messaging."):Object(l.b)("Verify or sign out from this session for best security and reliability.");return{variation:Fa.a.Unverified,heading:Object(l.b)("Unverified session"),description:o.a.createElement(o.a.Fragment,null,n,o.a.createElement(Ha,{variation:Fa.a.Unverified}))}})(e,t);return o.a.createElement(Wa,a,!1===e.isVerified&&!!n&&o.a.createElement(E.a,{kind:"primary",onClick:n,"data-testid":`verification-status-button-${e.device_id}`},Object(l.b)("Verify session")))};function Ka(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function qa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ka(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ka(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var $a,Ya=({device:e,pusher:t,localNotificationSettings:n,isSigningOut:a,onVerifyDevice:i,onSignOutDevice:r,saveDeviceName:s,setPushNotifications:c,supportsMSC3881:d,className:u,isCurrentDevice:h})=>{const p=[{id:"session",values:[{label:Object(l.b)("Session ID"),value:e.device_id},{label:Object(l.b)("Last activity"),value:e.last_seen_ts&&Object(Ra.a)(new Date(e.last_seen_ts))}]},{id:"application",heading:Object(l.b)("Application"),values:[{label:Object(l.b)("Name"),value:e.appName},{label:Object(l.b)("Version"),value:e.appVersion},{label:Object(l.b)("URL"),value:e.url}]},{id:"device",heading:Object(l.b)("Device"),values:[{label:Object(l.b)("Model"),value:e.deviceModel},{label:Object(l.b)("Operating system"),value:e.deviceOperatingSystem},{label:Object(l.b)("Browser"),value:e.client},{label:Object(l.b)("IP address"),value:e.last_seen_ip}]}].map((e=>qa(qa({},e),{},{values:e.values.filter((e=>!!e.value))}))).filter((e=>e.values.length)),g=!!t||!!n;return o.a.createElement("div",{className:Ye()("mx_DeviceDetails",u),"data-testid":`device-detail-${e.device_id}`},o.a.createElement("section",{className:"mx_DeviceDetails_section"},o.a.createElement(Na,{device:e,saveDeviceName:s}),o.a.createElement(Ga,{device:e,onVerifyDevice:i,isCurrentDevice:!0})),o.a.createElement("section",{className:"mx_DeviceDetails_section"},o.a.createElement("p",{className:"mx_DeviceDetails_sectionHeading"},Object(l.b)("Session details")),p.map((({heading:e,values:t,id:n},a)=>o.a.createElement("table",{className:"mx_DeviceDetails_metadataTable",key:a,"data-testid":`device-detail-metadata-${n}`},e&&o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",null,e))),o.a.createElement("tbody",null,t.map((({label:e,value:t})=>o.a.createElement("tr",{key:e},o.a.createElement("td",{className:"mxDeviceDetails_metadataLabel"},e),o.a.createElement("td",{className:"mxDeviceDetails_metadataValue"},t))))))))),g&&o.a.createElement("section",{className:"mx_DeviceDetails_section mx_DeviceDetails_pushNotifications","data-testid":"device-detail-push-notification"},o.a.createElement(Te.a,{checked:function(e,t){return e?!!e[m.PUSHER_ENABLED.name]:!n||!n.is_silenced}(t),disabled:function(e,t){return!n&&!(!e||d)}(t),onChange:t=>null==c?void 0:c(e.device_id,t),title:Object(l.b)("Toggle push notifications on this session."),"data-testid":"device-detail-push-notification-checkbox"}),o.a.createElement("p",{className:"mx_DeviceDetails_sectionHeading"},Object(l.b)("Push notifications"),o.a.createElement("small",{className:"mx_DeviceDetails_sectionSubheading"},Object(l.b)("Receive push notifications on this session.")))),o.a.createElement("section",{className:"mx_DeviceDetails_section"},o.a.createElement(E.a,{onClick:r,kind:"danger_inline",disabled:a,"data-testid":"device-detail-sign-out-cta"},o.a.createElement("span",{className:"mx_DeviceDetails_signOutButtonContent"},Object(l.b)("Sign out of this session"),a&&o.a.createElement(T.a,{w:16,h:16})))))};function Ja(){return Ja=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},Ja.apply(this,arguments)}function Qa(e){return r.createElement("svg",Ja({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 10 6",role:"presentation","aria-hidden":!0},e),$a||($a=r.createElement("g",{fill:"none",fillRule:"evenodd",stroke:"currentColor",strokeLinecap:"round",strokeWidth:1.3},r.createElement("path",{d:"M1.5 1.5l3.859 3.254M9.132 1.56L5.359 4.754"}))))}var Xa=n(62);const Za=["isExpanded","onClick"],ei=e=>{let{isExpanded:t,onClick:n}=e,a=Ft()(e,Za);const i=t?Object(l.b)("Hide details"):Object(l.b)("Show details");return o.a.createElement(Xa.a,Lt()({},a,{"aria-label":i,title:i,kind:"icon",className:Ye()("mx_DeviceExpandDetailsButton",{mx_DeviceExpandDetailsButton_expanded:t}),onClick:n}),o.a.createElement(Qa,{className:"mx_DeviceExpandDetailsButton_icon"}))};var ti,ni=n(1353);function ai(){return ai=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ai.apply(this,arguments)}var ii;function ri(){return ri=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ri.apply(this,arguments)}var oi;function si(){return si=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},si.apply(this,arguments)}var li;function ci(){return ci=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},ci.apply(this,arguments)}const di={[ga.a.Desktop]:function(e){return r.createElement("svg",ri({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 19",role:"presentation","aria-hidden":!0},e),ii||(ii=r.createElement("path",{d:"M3 15.5c-.55 0-1.02-.196-1.412-.587A1.927 1.927 0 011 13.5v-11c0-.55.196-1.021.588-1.413A1.925 1.925 0 013 .5h16c.55 0 1.021.196 1.413.587.391.392.587.863.587 1.413v11c0 .55-.196 1.021-.587 1.413A1.928 1.928 0 0119 15.5H3zm0-2h16v-11H3v11zm-2 5a.965.965 0 01-.712-.288A.965.965 0 010 17.5c0-.283.096-.52.288-.712A.965.965 0 011 16.5h20c.283 0 .52.096.712.288A.965.965 0 0122 17.5c0 .283-.096.52-.288.712A.965.965 0 0121 18.5H1zm2-5v-11 11z",fill:"currentColor"})))},[ga.a.Mobile]:function(e){return r.createElement("svg",ci({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 14 23",role:"presentation","aria-hidden":!0},e),li||(li=r.createElement("path",{d:"M12 .51L2 .5c-1.1 0-2 .9-2 2v18c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2v-18c0-1.1-.9-1.99-2-1.99zm0 17.99H2v-14h10v14z",fill:"currentColor"})))},[ga.a.Web]:function(e){return r.createElement("svg",si({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 17",role:"presentation","aria-hidden":!0},e),oi||(oi=r.createElement("path",{d:"M18 16.5H2c-.55 0-1.02-.196-1.412-.587A1.927 1.927 0 010 14.5v-12c0-.55.196-1.02.588-1.412A1.923 1.923 0 012 .5h16c.55 0 1.021.196 1.413.588.391.391.587.862.587 1.412v12c0 .55-.196 1.021-.587 1.413A1.928 1.928 0 0118 16.5zM2 4.5v10h16v-10H2z",fill:"currentColor"})))},[ga.a.Unknown]:function(e){return r.createElement("svg",ai({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 22 23",role:"presentation","aria-hidden":!0},e),ti||(ti=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M11 22.5c6.075 0 11-4.925 11-11S17.075.5 11 .5 0 5.425 0 11.5s4.925 11 11 11zm0-4.24a1.375 1.375 0 100-2.75 1.375 1.375 0 000 2.75zM9.09 9.428A1.91 1.91 0 0111 7.518c1.048 0 1.91.862 1.91 1.91 0 .485-.208.659-1.026 1.224-.363.25-.86.598-1.246 1.108-.415.546-.67 1.227-.67 2.093h2.063c0-.424.113-.666.25-.846.164-.217.402-.4.775-.659l.124-.084c.676-.46 1.792-1.219 1.792-2.836A3.98 3.98 0 0011 5.456a3.972 3.972 0 00-3.973 3.972H9.09z",fill:"currentColor"})))}},ui={[ga.a.Desktop]:Object(l.b)("Desktop session"),[ga.a.Mobile]:Object(l.b)("Mobile session"),[ga.a.Web]:Object(l.b)("Web session"),[ga.a.Unknown]:Object(l.b)("Unknown session type")},mi=({isVerified:e,isSelected:t,deviceType:n})=>{const a=di[n]||di[ga.a.Unknown],i=ui[n]||ui[ga.a.Unknown];return o.a.createElement("div",{className:Ye()("mx_DeviceTypeIcon",{mx_DeviceTypeIcon_selected:t})},o.a.createElement("div",{className:"mx_DeviceTypeIcon_deviceIconWrapper"},o.a.createElement(a,{className:"mx_DeviceTypeIcon_deviceIcon",role:"img","aria-label":i})),e?o.a.createElement(Aa,{className:Ye()("mx_DeviceTypeIcon_verificationIcon","verified"),role:"img","aria-label":Object(l.b)("Verified")}):o.a.createElement(La.Icon,{className:Ye()("mx_DeviceTypeIcon_verificationIcon","unverified"),role:"img","aria-label":Object(l.b)("Unverified")}))};var hi=n(368),pi=n(1390);const gi=({device:e})=>o.a.createElement(Pe.a,{size:"4"},e.display_name||e.device_id);var bi=({device:e,children:t,isSelected:n,onClick:a})=>o.a.createElement("div",{className:Ye()("mx_DeviceTile",{mx_DeviceTile_interactive:!!a}),"data-testid":`device-tile-${e.device_id}`,onClick:a},o.a.createElement(mi,{isVerified:e.isVerified,isSelected:n,deviceType:e.deviceType}),o.a.createElement("div",{className:"mx_DeviceTile_info"},o.a.createElement(gi,{device:e}),o.a.createElement("div",{className:"mx_DeviceTile_metadata"},o.a.createElement(pi.a,{device:e}))),o.a.createElement("div",{className:"mx_DeviceTile_actions",onClick:Object(hi.a)((()=>{}))},t));var vi=({children:e,device:t,isSelected:n,onSelect:a,onClick:i})=>o.a.createElement("div",{className:"mx_SelectableDeviceTile"},o.a.createElement(L.b,{kind:L.a.Solid,checked:n,onChange:a,className:"mx_SelectableDeviceTile_checkbox",id:`device-tile-checkbox-${t.device_id}`,"data-testid":`device-tile-checkbox-${t.device_id}`},o.a.createElement(bi,{device:t,onClick:i,isSelected:n},e))),fi=n(106),yi=n(170);const Ei=["selectedDeviceCount","isAllSelected","toggleSelectAll","children"];var wi=e=>{let{selectedDeviceCount:t,isAllSelected:n,toggleSelectAll:a,children:i}=e,r=Ft()(e,Ei);const s=n?Object(l.b)("Deselect all"):Object(l.b)("Select all");return o.a.createElement("div",Lt()({className:"mx_FilteredDeviceListHeader"},r),o.a.createElement(yi.a,{label:s,alignment:fi.a.Top},o.a.createElement(L.b,{kind:L.a.Solid,checked:n,onChange:a,id:"device-select-all-checkbox","data-testid":"device-select-all-checkbox","aria-label":s})),o.a.createElement("span",{className:"mx_FilteredDeviceListHeader_label"},t>0?Object(l.b)("%(count)s sessions selected",{count:t}):Object(l.b)("Sessions")),i)};const Si=(e,t)=>t.includes(e),_i=(e,t)=>(t.last_seen_ts||0)-(e.last_seen_ts||0)||(e.display_name||e.device_id).localeCompare(t.display_name||t.device_id),Ci="ALL",Oi={[Fa.a.Verified]:{title:Object(l.b)("Verified sessions"),description:Object(l.b)("For best security, sign out from any session that you don't recognize or use anymore.")},[Fa.a.Unverified]:{title:Object(l.b)("Unverified sessions"),description:Object(l.b)("Verify your sessions for enhanced secure messaging or sign out from those you don't recognize or use anymore.")},[Fa.a.Unverifiable]:{title:Object(l.b)("Unverified session"),description:Object(l.b)("This session doesn't support encryption and thus can't be verified.")},[Fa.a.Inactive]:{title:Object(l.b)("Inactive sessions"),description:Object(l.b)("Consider signing out from old sessions (%(inactiveAgeDays)s days or older) you don't use anymore.",{inactiveAgeDays:ni.a})}},xi=({filter:e})=>{if((e=>!!e&&[Fa.a.Inactive,Fa.a.Unverified,Fa.a.Verified].includes(e))(e)){const{title:t,description:n}=Oi[e];return o.a.createElement("div",{className:"mx_FilteredDeviceList_securityCard"},o.a.createElement(Wa,{variation:e,heading:t,description:o.a.createElement("span",null,n,o.a.createElement(Ha,{variation:e}))}))}return null},ki=({filter:e,clearFilter:t})=>o.a.createElement("div",{className:"mx_FilteredDeviceList_noResults"},(e=>{switch(e){case Fa.a.Verified:return Object(l.b)("No verified sessions found.");case Fa.a.Unverified:return Object(l.b)("No unverified sessions found.");case Fa.a.Inactive:return Object(l.b)("No inactive sessions found.");default:return Object(l.b)("No sessions found.")}})(e),!!e&&o.a.createElement(o.a.Fragment,null," ",o.a.createElement(E.a,{kind:"link_inline",onClick:t,"data-testid":"devices-clear-filter-btn"},Object(l.b)("Show all")))),Ri=({device:e,pusher:t,localNotificationSettings:n,isExpanded:a,isSigningOut:i,isSelected:r,onDeviceExpandToggle:s,onSignOutDevice:l,saveDeviceName:c,onRequestDeviceVerification:d,setPushNotifications:u,toggleSelected:m,supportsMSC3881:h})=>o.a.createElement("li",{className:"mx_FilteredDeviceList_listItem"},o.a.createElement(vi,{isSelected:r,onSelect:m,onClick:s,device:e},i&&o.a.createElement(T.a,{w:16,h:16}),o.a.createElement(ei,{isExpanded:a,onClick:s})),a&&o.a.createElement(Ya,{device:e,pusher:t,localNotificationSettings:n,isSigningOut:i,onVerifyDevice:d,onSignOutDevice:l,saveDeviceName:c,setPushNotifications:u,supportsMSC3881:h,className:"mx_FilteredDeviceList_deviceDetails"})),ji=Object(r.forwardRef)((({devices:e,pushers:t,localNotificationSettings:n,filter:a,expandedDeviceIds:i,signingOutDeviceIds:r,selectedDeviceIds:s,onFilterChange:c,onDeviceExpandToggle:d,saveDeviceName:u,onSignOutDevices:h,onRequestDeviceVerification:p,setPushNotifications:g,setSelectedDeviceIds:b,supportsMSC3881:v},f)=>{const y=((e,t)=>Object(ni.b)(Object.values(e),t?[t]:[]).sort(_i))(e,a);function w(e){return t.find((t=>t[m.PUSHER_DEVICE_ID.name]===e.device_id))}const S=[{id:Ci,label:Object(l.b)("All")},{id:Fa.a.Verified,label:Object(l.b)("Verified"),description:Object(l.b)("Ready for secure messaging")},{id:Fa.a.Unverified,label:Object(l.b)("Unverified"),description:Object(l.b)("Not ready for secure messaging")},{id:Fa.a.Inactive,label:Object(l.b)("Inactive"),description:Object(l.b)("Inactive for %(inactiveAgeDays)s days or longer",{inactiveAgeDays:ni.a})}],_=s.length>=y.length,C=!!r.length;return o.a.createElement("div",{className:"mx_FilteredDeviceList",ref:f},o.a.createElement(wi,{selectedDeviceCount:s.length,isAllSelected:_,toggleSelectAll:()=>{b(_?[]:y.map((e=>e.device_id)))}},s.length?o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{"data-testid":"sign-out-selection-cta",kind:"danger_inline",disabled:C,onClick:()=>h(s),className:"mx_FilteredDeviceList_headerButton"},C&&o.a.createElement(T.a,{w:16,h:16}),Object(l.b)("Sign out")),o.a.createElement(E.a,{"data-testid":"cancel-selection-cta",kind:"content_inline",disabled:C,onClick:()=>b([]),className:"mx_FilteredDeviceList_headerButton"},Object(l.b)("Cancel"))):o.a.createElement(ka,{id:"device-list-filter",label:Object(l.b)("Filter devices"),value:a||Ci,onOptionChange:e=>{c(e===Ci?void 0:e)},options:S,selectedLabel:Object(l.b)("Show")})),y.length?o.a.createElement(xi,{filter:a}):o.a.createElement(ki,{filter:a,clearFilter:()=>c(void 0)}),o.a.createElement("ol",{className:"mx_FilteredDeviceList_list"},y.map((e=>o.a.createElement(Ri,{key:e.device_id,device:e,pusher:w(e),localNotificationSettings:n.get(e.device_id),isExpanded:i.includes(e.device_id),isSigningOut:r.includes(e.device_id),isSelected:Si(e.device_id,s),onDeviceExpandToggle:()=>d(e.device_id),onSignOutDevice:()=>h([e.device_id]),saveDeviceName:t=>u(e.device_id,t),onRequestDeviceVerification:p?()=>p(e.device_id):void 0,setPushNotifications:g,toggleSelected:()=>{return t=e.device_id,void(Si(t,s)?b(s.filter((e=>e!==t))):b([...s,t]));var t},supportsMSC3881:v})))))}));var Ii=n(1355),Ti=n(70),Pi=n(36);const Ni=["options","title"],Di=e=>{let{options:t,title:n}=e,a=Ft()(e,Ni);const[i,r,s,l]=Object(Ti.q)();return o.a.createElement(o.a.Fragment,null,o.a.createElement(Ti.b,Lt()({},a,{onClick:s,title:n,isExpanded:i,inputRef:r}),o.a.createElement(Ii.a,{className:"mx_KebabContextMenu_icon"})),i&&o.a.createElement(Pi.e,Lt()({onFinished:l,compact:!0,rightAligned:!0,closeOnInteraction:!0},{left:(c=r.current.getBoundingClientRect()).left+window.scrollX+c.width,top:c.bottom+window.scrollY,chevronFace:Ti.a.None}),o.a.createElement(Pi.c,null,t)));var c},Mi=({onSignOutCurrentDevice:e,signOutAllOtherSessions:t,otherSessionsCount:n,disabled:a})=>{const i=[o.a.createElement(Pi.b,{key:"sign-out",label:Object(l.b)("Sign out"),onClick:e,isDestructive:!0}),...t?[o.a.createElement(Pi.b,{key:"sign-out-all-others",label:Object(l.b)("Sign out of all other sessions (%(otherSessionsCount)s)",{otherSessionsCount:n}),onClick:t,isDestructive:!0})]:[]];return o.a.createElement(O.a,{heading:Object(l.b)("Current session")},o.a.createElement(Di,{disabled:a,title:Object(l.b)("Options"),options:i,"data-testid":"current-session-menu"}))};var Ai=({device:e,isLoading:t,isSigningOut:n,localNotificationSettings:a,otherSessionsCount:i,setPushNotifications:s,onVerifyCurrentDevice:l,onSignOutCurrentDevice:c,signOutAllOtherSessions:d,saveDeviceName:u})=>{const[m,h]=Object(r.useState)(!1);return o.a.createElement(ie.b,{"data-testid":"current-session-section",heading:o.a.createElement(Mi,{onSignOutCurrentDevice:c,signOutAllOtherSessions:d,otherSessionsCount:i,disabled:t||!e||n})},t&&!e&&o.a.createElement(T.a,null),!!e&&o.a.createElement(o.a.Fragment,null,o.a.createElement(bi,{device:e,onClick:()=>h(!m)},o.a.createElement(ei,{"data-testid":"current-session-toggle-details",isExpanded:m,onClick:()=>h(!m)})),m?o.a.createElement(Ya,{device:e,localNotificationSettings:a,setPushNotifications:s,isSigningOut:n,onVerifyDevice:l,onSignOutDevice:c,saveDeviceName:u,className:"mx_CurrentDeviceSection_deviceDetails"}):o.a.createElement(o.a.Fragment,null,o.a.createElement("br",null),o.a.createElement(Ga,{device:e,onVerifyDevice:l,isCurrentDevice:!0}))))};var Li=({devices:e,currentDeviceId:t,goToFilteredList:n})=>{const a=Object.values(e),i=Object(ni.b)(a,[Fa.a.Unverified]).filter((e=>e.device_id!==t)).length,r=Object(ni.b)(a,[Fa.a.Inactive]).length;if(!(i|r))return null;const s=ni.a;return o.a.createElement(ie.b,{heading:Object(l.b)("Security recommendations"),description:Object(l.b)("Improve your account security by following these recommendations."),"data-testid":"security-recommendations-section"},!!i&&o.a.createElement(Wa,{variation:Fa.a.Unverified,heading:Object(l.b)("Unverified sessions"),description:o.a.createElement(o.a.Fragment,null,Object(l.b)("Verify your sessions for enhanced secure messaging or sign out from those you don't recognize or use anymore."),o.a.createElement(Ha,{variation:Fa.a.Unverified}))},o.a.createElement(E.a,{kind:"link_inline",onClick:()=>n(Fa.a.Unverified),"data-testid":"unverified-devices-cta"},Object(l.b)("View all")+` (${i})`)),!!r&&o.a.createElement(o.a.Fragment,null,!!i&&o.a.createElement("div",{className:"mx_SecurityRecommendations_spacing"}),o.a.createElement(Wa,{variation:Fa.a.Inactive,heading:Object(l.b)("Inactive sessions"),description:o.a.createElement(o.a.Fragment,null,Object(l.b)("Consider signing out from old sessions (%(inactiveAgeDays)s days or older) you don't use anymore.",{inactiveAgeDays:s}),o.a.createElement(Ha,{variation:Fa.a.Inactive}))},o.a.createElement(E.a,{kind:"link_inline",onClick:()=>n(Fa.a.Inactive),"data-testid":"inactive-devices-cta"},Object(l.b)("View all")+` (${r})`))))};const Ui=(e,t)=>async n=>e.deleteMultipleDevices(t,null!=n?n:void 0);class Fi extends o.a.Component{constructor(e){super(e)}render(){var e,t,n,a;const i=m.UNSTABLE_MSC3882_CAPABILITY.findIn(this.props.capabilities),r=!(null===(e=this.props.versions)||void 0===e||null===(t=e.unstable_features)||void 0===t||!t["org.matrix.msc3882"])||!(null==i||!i.enabled),s=!(null===(n=this.props.versions)||void 0===n||null===(a=n.unstable_features)||void 0===a||!a["org.matrix.msc3886"]);return r&&s?o.a.createElement(ie.b,{heading:Object(l.b)("Sign in with QR code")},o.a.createElement("div",{className:"mx_LoginWithQRSection"},o.a.createElement("p",{className:"mx_SettingsTab_subsectionText"},Object(l.b)("You can use this device to sign in a new device with a QR code. You will need to scan the QR code shown on this device with your device that's signed out.")),o.a.createElement(E.a,{onClick:this.props.onShowQr,kind:"primary"},Object(l.b)("Show QR code")))):null}}var Bi=n(1437),Vi=n(147);const Wi=({otherSessionsCount:e,disabled:t,signOutAllOtherSessions:n})=>{const a=[o.a.createElement(Pi.b,{key:"sign-out-all-others",label:Object(l.b)("Sign out of %(count)s sessions",{count:e}),onClick:n,isDestructive:!0})];return o.a.createElement(O.a,{heading:Object(l.b)("Other sessions")},o.a.createElement(Di,{disabled:t,title:Object(l.b)("Options"),options:a,"data-testid":"other-sessions-menu"}))};function zi(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}const Hi=(e,t)=>{const[n,a]=Object(r.useState)([]);return{onSignOutCurrentDevice:()=>{v.b.createDialog(ma.a,{},void 0,!1,!0)},onSignOutOtherDevices:async i=>{if(!i.length)return;if(await(async e=>{const{finished:t}=v.b.createDialog(he.a,{title:Object(l.b)("Sign out"),description:o.a.createElement("div",null,o.a.createElement("p",null,Object(l.b)("Are you sure you want to sign out of %(count)s sessions?",{count:e}))),cancelButton:Object(l.b)("Cancel"),button:Object(l.b)("Sign out")}),[n]=await t;return!!n})(i.length))try{a([...n,...i]),await(async(e,t,n)=>{if(t.length)try{await Ui(e,t)(null),n(!0,void 0)}catch(i){var a;if(!(i instanceof m.MatrixError&&401===i.httpStatus&&null!==(a=i.data)&&void 0!==a&&a.flows))throw i;const r=t.length,o={[A.c.PHASE_PREAUTH]:{title:Object(l.b)("Use Single Sign On to continue"),body:Object(l.b)("Confirm logging out these devices by using Single Sign On to prove your identity.",{count:r}),continueText:Object(l.b)("Single Sign On"),continueKind:"primary"},[A.c.PHASE_POSTAUTH]:{title:Object(l.b)("Confirm signing out these devices",{count:r}),body:Object(l.b)("Click the button below to confirm signing out these devices.",{count:r}),continueText:Object(l.b)("Sign out devices",{count:r}),continueKind:"danger"}};v.b.createDialog(Y.a,{title:Object(l.b)("Authentication"),matrixClient:e,authData:i.data,onFinished:n,makeRequest:Ui(e,t),aestheticsForStagePhases:{[A.c.LOGIN_TYPE]:o,[A.c.UNSTABLE_LOGIN_TYPE]:o}})}})(e,i,(async e=>{e&&await t(),a(n.filter((e=>!i.includes(e))))}))}catch(e){u.a.error("Error deleting sessions",e),a(n.filter((e=>!i.includes(e))))}},signingOutDeviceIds:n}};var Gi=()=>{const{devices:e,pushers:t,localNotificationSettings:n,currentDeviceId:a,isLoadingDeviceList:i,requestDeviceVerification:s,refreshDevices:c,saveDeviceName:d,setPushNotifications:u,supportsMSC3881:m}=wa(),[h,p]=Object(r.useState)(),[g,b]=Object(r.useState)([]),[f,y]=Object(r.useState)([]),E=Object(r.useRef)(null),w=Object(r.useRef)(),S=Object(r.useContext)(Le.a),_=null==S?void 0:S.getUserId(),C=_&&(null==S?void 0:S.getUser(_))||void 0,O=Object(Vi.a)((()=>S.getVersions()),[S]),x=Object(Vi.a)((async()=>null==S?void 0:S.getCapabilities()),[S]),{[a]:k}=e,R=Ft()(e,[a].map(zi)),j=Object.keys(R).length,I=j>0,T=Object(r.useCallback)((e=>{if(!s)return;const t=s(e);v.b.createDialog(ua.a,{verificationRequestPromise:t,member:C,onFinished:async()=>{(await t).cancel(),await c()}})}),[s,c,C]),{onSignOutCurrentDevice:P,onSignOutOtherDevices:N,signingOutDeviceIds:D}=Hi(S,(async()=>{await c(),y([])}));Object(r.useEffect)((()=>()=>{clearTimeout(w.current)}),[w]),Object(r.useEffect)((()=>{y([])}),[h,y]);const M=I?()=>{N(Object.keys(R))}:void 0,[A,L]=Object(r.useState)(),U=Object(r.useCallback)((()=>{L(null)}),[L]),F=Object(r.useCallback)((()=>{L(Bi.b.Show)}),[L]);return A?o.a.createElement(Bi.d,{mode:A,onFinished:U,client:S}):o.a.createElement(Me.a,null,o.a.createElement(Ae.a,{heading:Object(l.b)("Sessions")},o.a.createElement(Li,{devices:e,goToFilteredList:e=>{p(e),clearTimeout(w.current),w.current=window.setTimeout((()=>{var e;return null===(e=E.current)||void 0===e?void 0:e.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}))},currentDeviceId:a}),o.a.createElement(Ai,{device:k,localNotificationSettings:n.get(a),setPushNotifications:u,isSigningOut:D.includes(a),isLoading:i,saveDeviceName:e=>d(a,e),onVerifyCurrentDevice:()=>{v.b.createDialog(St.a,{onFinished:c})},onSignOutCurrentDevice:P,signOutAllOtherSessions:M,otherSessionsCount:j}),I&&o.a.createElement(ie.b,{heading:o.a.createElement(Wi,{otherSessionsCount:j,signOutAllOtherSessions:M,disabled:!!D.length}),description:Object(l.b)("For best security, verify your sessions and sign out from any session that you don't recognize or use anymore."),"data-testid":"other-sessions-section",stretchContent:!0},o.a.createElement(ji,{devices:R,pushers:t,localNotificationSettings:n,filter:h,expandedDeviceIds:g,signingOutDeviceIds:D,selectedDeviceIds:f,setSelectedDeviceIds:y,onFilterChange:p,onDeviceExpandToggle:e=>{g.includes(e)?b(g.filter((t=>t!==e))):b([...g,e])},onRequestDeviceVerification:s?T:void 0,onSignOutDevices:N,saveDeviceName:d,setPushNotifications:u,ref:E,supportsMSC3881:m})),o.a.createElement(Fi,{onShowQr:F,versions:O,capabilities:x})))};class Ki extends o.a.Component{constructor(e){super(e),i()(this,"settingsWatchers",[]),i()(this,"mjolnirChanged",((e,t,n,a)=>{this.setState({mjolnirEnabled:a})})),this.state={mjolnirEnabled:k.b.getValue("feature_mjolnir")}}componentDidMount(){this.settingsWatchers=[k.b.watchSetting("feature_mjolnir",null,this.mjolnirChanged)]}componentWillUnmount(){this.settingsWatchers.forEach((e=>k.b.unwatchSetting(e)))}getTabs(){const e=[];return e.push(new s.a(_n.a.General,Object(l.d)("General"),"mx_UserSettingsDialog_settingsIcon",o.a.createElement(Be,{closeSettingsFn:this.props.onFinished}),"UserSettingsGeneral")),e.push(new s.a(_n.a.Appearance,Object(l.d)("Appearance"),"mx_UserSettingsDialog_appearanceIcon",o.a.createElement(ct,null),"UserSettingsAppearance")),e.push(new s.a(_n.a.Notifications,Object(l.d)("Notifications"),"mx_UserSettingsDialog_bellIcon",o.a.createElement(Ln,null),"UserSettingsNotifications")),e.push(new s.a(_n.a.Preferences,Object(l.d)("Preferences"),"mx_UserSettingsDialog_preferencesIcon",o.a.createElement(Fn,{closeSettingsFn:this.props.onFinished}),"UserSettingsPreferences")),e.push(new s.a(_n.a.Keyboard,Object(l.d)("Keyboard"),"mx_UserSettingsDialog_keyboardIcon",o.a.createElement(da,null),"UserSettingsKeyboard")),e.push(new s.a(_n.a.Sidebar,Object(l.d)("Sidebar"),"mx_UserSettingsDialog_sidebarIcon",o.a.createElement(ia.a,null),"UserSettingsSidebar")),k.b.getValue($.b.Voip)&&e.push(new s.a(_n.a.Voice,Object(l.d)("Voice & Video"),"mx_UserSettingsDialog_voiceIcon",o.a.createElement(Hn,null),"UserSettingsVoiceVideo")),e.push(new s.a(_n.a.Security,Object(l.d)("Security & Privacy"),"mx_UserSettingsDialog_securityIcon",o.a.createElement(Pt,{closeSettingsFn:this.props.onFinished}),"UserSettingsSecurityPrivacy")),e.push(new s.a(_n.a.SessionManager,Object(l.d)("Sessions"),"mx_UserSettingsDialog_sessionsIcon",o.a.createElement(Gi,null),void 0)),(We.b.get("show_labs_settings")||k.b.getFeatureSettingNames().some((e=>k.b.getBetaInfo(e))))&&e.push(new s.a(_n.a.Labs,Object(l.d)("Labs"),"mx_UserSettingsDialog_labsIcon",o.a.createElement(qe,null),"UserSettingsLabs")),this.state.mjolnirEnabled&&e.push(new s.a(_n.a.Mjolnir,Object(l.d)("Ignored users"),"mx_UserSettingsDialog_mjolnirIcon",o.a.createElement(aa,null),"UserSettingMjolnir")),e.push(new s.a(_n.a.Help,Object(l.d)("Help & About"),"mx_UserSettingsDialog_helpIcon",o.a.createElement(ea,{closeSettingsFn:()=>this.props.onFinished()}),"UserSettingsHelpAbout")),e}render(){return o.a.createElement(U.a,{className:"mx_UserSettingsDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(l.b)("Settings")},o.a.createElement("div",{className:"mx_SettingsDialog_content"},o.a.createElement(s.c,{tabs:this.getTabs(),initialTabId:this.props.initialTabId,screenName:"UserSettings"})))}}},1588:function(e,t,n){"use strict";n.d(t,"a",(function(){return q}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3),l=n(4),c=n(6),d=n(2),u=n(11);class m{constructor(e,t){i()(this,"client",void 0),i()(this,"clientSecret",void 0),i()(this,"password",""),i()(this,"sessionId",""),i()(this,"logoutDevices",!1),i()(this,"sendAttempt",0),this.client=Object(l.createClient)({baseUrl:e,idBaseUrl:t}),this.clientSecret=this.client.generateClientSecret()}async resetPassword(e,t,n=!0){this.password=t,this.logoutDevices=n,this.sendAttempt++;try{const t=await this.client.requestPasswordEmailToken(e,this.clientSecret,this.sendAttempt);return this.sessionId=t.sid,t}catch(e){throw"M_THREEPID_NOT_FOUND"===e.errcode?e.message=Object(d.b)("This email address was not found"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}}requestResetToken(e){return this.sendAttempt++,this.client.requestPasswordEmailToken(e,this.clientSecret,this.sendAttempt).then((e=>(this.sessionId=e.sid,e)),(function(e){throw"M_THREEPID_NOT_FOUND"===e.errcode?e.message=Object(d.b)("This email address was not found"):e.httpStatus&&(e.message=e.message+` (Status ${e.httpStatus})`),e}))}setLogoutDevices(e){this.logoutDevices=e}async setNewPassword(e){this.password=e,await this.checkEmailLinkClicked()}async checkEmailLinkClicked(){const e={sid:this.sessionId,client_secret:this.clientSecret};try{await this.client.setPassword({type:"m.login.email.identity",threepid_creds:e,threepidCreds:e},this.password,this.logoutDevices)}catch(e){throw 401===e.httpStatus?e.message=Object(d.b)("Failed to verify email address: make sure you clicked the link in the email"):404===e.httpStatus?e.message=Object(d.b)("Your email address does not appear to be associated with a Matrix ID on this homeserver."):e.httpStatus&&(e.message+=` (Status ${e.httpStatus})`),e}}}var h,p=n(1315),g=n(1317),b=n(1375),v=n(1333),f=n(1334),y=n(1367),E=n(161);function w(){return w=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},w.apply(this,arguments)}function S(e){return r.createElement("svg",w({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0},e),h||(h=r.createElement("path",{d:"M5.092 17.049l6.515 6.709L26.91 8",stroke:"currentColor",strokeWidth:2.5,strokeLinecap:"round",strokeLinejoin:"round"})))}var _;function C(){return C=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},C.apply(this,arguments)}function O(e){return r.createElement("svg",C({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",role:"presentation","aria-hidden":!0},e),_||(_=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M13.333 1.852a5.5 5.5 0 00-5.5 5.5v5.822H7a3 3 0 00-3 3v11.493a3 3 0 003 3h18a3 3 0 003-3V16.174a3 3 0 00-3-3h-.833V7.352a5.5 5.5 0 00-5.5-5.5h-5.334zm7.834 11.322V7.352a2.5 2.5 0 00-2.5-2.5h-5.334a2.5 2.5 0 00-2.5 2.5v5.822h10.334z",fill:"currentColor"})))}var x,k=n(77);function R(){return R=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},R.apply(this,arguments)}function j(e){return r.createElement("svg",R({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 40 29",role:"presentation","aria-hidden":!0},e),x||(x=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M.261 2.576L18.905 21.16a1.64 1.64 0 002.316 0L39.773 2.668C39.92 3.084 40 3.533 40 4v21a4 4 0 01-4 4H4a4 4 0 01-4-4V4c0-.502.092-.982.261-1.424zM2.582.259C3.022.09 3.501 0 4 0h32c.533 0 1.042.104 1.508.294l-17.445 17.39L2.583.26z",fill:"#737D8C"})))}var I=n(1332),T=n(473);const P=({message:e})=>{const t=e?o.a.createElement(T.a,{className:"mx_Icon mx_Icon_16"}):null;return o.a.createElement("div",{className:"mx_ErrorMessage"},t,e)};var N=n(38),D=n(10);const M=({email:e,errorText:t,homeserver:n,loading:a,onInputChanged:i,onLoginClick:s,onSubmitForm:l})=>{const c=a?o.a.createElement(N.a,{w:16,h:16}):Object(d.b)("Send email"),u=Object(r.useRef)(null);return o.a.createElement(o.a.Fragment,null,o.a.createElement(j,{className:"mx_AuthBody_icon"}),o.a.createElement("h1",null,Object(d.b)("Enter your email to reset password")),o.a.createElement("p",{className:"mx_AuthBody_text"},Object(d.b)("<b>%(homeserver)s</b> will send you a verification link to let you reset your password.",{homeserver:n},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("form",{onSubmit:async e=>{var t,n,a;await(null===(t=u.current)||void 0===t?void 0:t.validate({allowEmpty:!1}))?l(e):(null===(n=u.current)||void 0===n||n.focus(),null===(a=u.current)||void 0===a||a.validate({allowEmpty:!1,focused:!0}))}},o.a.createElement("fieldset",{disabled:a},o.a.createElement("div",{className:"mx_AuthBody_fieldRow"},o.a.createElement(I.a,{name:"reset_email",label:"Email address",labelRequired:Object(d.d)("The email address linked to your account must be entered."),labelInvalid:Object(d.d)("The email address doesn't appear to be valid."),value:e,autoFocus:!0,onChange:e=>i("email",e),fieldRef:u})),t&&o.a.createElement(P,{message:t}),o.a.createElement("button",{type:"submit",className:"mx_Login_submit"},c),o.a.createElement("div",{className:"mx_AuthBody_button-container"},o.a.createElement(D.a,{className:"mx_AuthBody_sign-in-instead-button",element:"button",kind:"link",onClick:e=>{e.preventDefault(),s()}},Object(d.b)("Sign in instead"))))))};var A,L=n(655);function U(){return U=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},U.apply(this,arguments)}function F(e){return r.createElement("svg",U({fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",role:"presentation","aria-hidden":!0},e),A||(A=r.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M4.023 2.965a6.418 6.418 0 0110.36 4.369h1.29c.26 0 .416.291.271.509l-2.005 3.011a.327.327 0 01-.544 0l-2.006-3.011a.327.327 0 01.272-.51h1.21a4.918 4.918 0 00-7.918-3.192 3.673 3.673 0 01-.184.136l-.014.01-.004.003-.002.001h-.001v.001l-.415-.625.414.625a.75.75 0 01-.83-1.25l.003-.001.02-.014.083-.062zm-.895 5.702H4.34a.327.327 0 00.272-.51L2.606 5.147a.327.327 0 00-.545 0L.055 8.158c-.144.217.011.509.273.509h1.29a6.417 6.417 0 0010.503 4.251.75.75 0 00-.963-1.149 4.918 4.918 0 01-8.03-3.102z",fill:"currentColor"})))}var B=n(106);const V=(e,t)=>{const n=Object(r.useRef)(),[a,i]=Object(r.useState)(e);return Object(r.useEffect)((()=>()=>{clearTimeout(n.current)})),{toggle:()=>{i(!e),n.current=window.setTimeout((()=>i(e)),t)},value:a}},W=({email:e,errorText:t,onReEnterEmailClick:n,onSubmitForm:a,onResendClick:i})=>{const s=Object(r.useRef)(`mx_CheckEmail_${Math.random()}`).current,{toggle:l,value:c}=V(!1,2500);return o.a.createElement(o.a.Fragment,null,o.a.createElement(L.a,{className:"mx_AuthBody_emailPromptIcon--shifted"}),o.a.createElement("h1",null,Object(d.b)("Check your email to continue")),o.a.createElement("div",{className:"mx_AuthBody_text"},o.a.createElement("p",null,Object(d.b)("Follow the instructions sent to <b>%(email)s</b>",{email:e},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.a.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},Object(d.b)("Wrong email address?")),o.a.createElement(D.a,{className:"mx_AuthBody_resend-button",kind:"link",onClick:n},Object(d.b)("Re-enter email address")))),t&&o.a.createElement(P,{message:t}),o.a.createElement("input",{onClick:a,type:"button",className:"mx_Login_submit",value:Object(d.b)("Next")}),o.a.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.a.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},Object(d.b)("Did not receive it?")),o.a.createElement(D.a,{className:"mx_AuthBody_resend-button",kind:"link",onClick:async()=>{await i(),l()},"aria-describedby":c?s:void 0},o.a.createElement(F,{className:"mx_Icon mx_Icon_16"}),Object(d.b)("Resend"),o.a.createElement(B.b,{id:s,label:Object(d.b)("Verification link email resent!"),alignment:B.a.Top,visible:c}))))},z=({email:e,errorText:t,onCloseClick:n,onReEnterEmailClick:a,onResendClick:i})=>{const s=Object(r.useRef)(`mx_VerifyEmailModal_${Math.random()}`).current,{toggle:l,value:c}=V(!1,2500);return o.a.createElement(o.a.Fragment,null,o.a.createElement(L.a,{className:"mx_AuthBody_emailPromptIcon"}),o.a.createElement("h1",null,Object(d.b)("Verify your email to continue")),o.a.createElement("p",null,Object(d.b)("We need to know it’s you before resetting your password. Click the link in the email we just sent to <b>%(email)s</b>",{email:e},{b:e=>o.a.createElement("b",null,e)})),o.a.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.a.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},Object(d.b)("Did not receive it?")),o.a.createElement(D.a,{className:"mx_AuthBody_resend-button",kind:"link",onClick:async()=>{await i(),l()},"aria-describedby":c?s:void 0},o.a.createElement(F,{className:"mx_Icon mx_Icon_16"}),Object(d.b)("Resend"),o.a.createElement(B.b,{id:s,label:Object(d.b)("Verification link email resent!"),alignment:B.a.Top,visible:c})),t&&o.a.createElement(P,{message:t})),o.a.createElement("div",{className:"mx_AuthBody_did-not-receive"},o.a.createElement("span",{className:"mx_VerifyEMailDialog_text-light"},Object(d.b)("Wrong email address?")),o.a.createElement(D.a,{className:"mx_AuthBody_resend-button",kind:"link",onClick:a},Object(d.b)("Re-enter email address"))),o.a.createElement(D.a,{onClick:n,className:"mx_Dialog_cancelButton","aria-label":Object(d.b)("Close dialog")}))};var H=n(71),G=n(1318);var K=function(e){return e[e.EnterEmail=1]="EnterEmail",e[e.SendingEmail=2]="SendingEmail",e[e.EmailSent=3]="EmailSent",e[e.PasswordInput=4]="PasswordInput",e[e.ResettingPassword=5]="ResettingPassword",e[e.Done=6]="Done",e}(K||{});class q extends o.a.Component{constructor(e){super(e),i()(this,"reset",void 0),i()(this,"fieldPassword",null),i()(this,"fieldPasswordConfirm",null),i()(this,"sendVerificationMail",(async()=>{try{return await this.reset.requestResetToken(this.state.email),!0}catch(e){this.handleError(e)}return!1})),i()(this,"onSubmitForm",(async e=>{if(e.preventDefault(),![K.SendingEmail,K.ResettingPassword].includes(this.state.phase)&&(this.setState({errorText:""}),await this.checkServerLiveliness(this.props.serverConfig),this.state.serverIsAlive))switch(this.state.phase){case K.EnterEmail:this.onPhaseEmailInputSubmit();break;case K.EmailSent:this.onPhaseEmailSentSubmit();break;case K.PasswordInput:this.onPhasePasswordInputSubmit()}})),i()(this,"onInputChanged",((e,t)=>{let n=t.currentTarget.value;"email"===e&&(n=n.trim()),this.setState({[e]:n})})),this.state={phase:K.EnterEmail,email:"",password:"",password2:"",errorText:null,serverIsAlive:!0,serverDeadError:"",serverSupportsControlOfDevicesLogout:!1,logoutDevices:!1},this.reset=new m(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl)}componentDidMount(){this.checkServerCapabilities(this.props.serverConfig)}componentDidUpdate(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||(this.checkServerLiveliness(this.props.serverConfig),this.checkServerCapabilities(this.props.serverConfig))}async checkServerLiveliness(e){try{await G.a.validateServerConfigWithStaticUrls(e.hsUrl,e.isUrl),this.setState({serverIsAlive:!0})}catch(e){const{serverIsAlive:t,serverDeadError:n}=G.a.authComponentStateForError(e,"forgot_password");this.setState({serverIsAlive:t,errorText:n})}}async checkServerCapabilities(e){const t=Object(l.createClient)({baseUrl:e.hsUrl}),n=await t.doesServerSupportLogoutDevices();this.setState({logoutDevices:!n,serverSupportsControlOfDevicesLogout:n})}async onPhaseEmailInputSubmit(){this.phase=K.SendingEmail,await this.sendVerificationMail()?this.phase=K.EmailSent:this.phase=K.EnterEmail}handleError(e){if(429!==(null==e?void 0:e.httpStatus))"ConnectionError"!==(null==e?void 0:e.name)?this.setState({errorText:e.message}):this.setState({errorText:Object(d.b)("Cannot reach homeserver")+": "+Object(d.b)("Ensure you have a stable internet connection, or get in touch with the server admin")});else{var t;const n=parseInt(null==e||null===(t=e.data)||void 0===t?void 0:t.retry_after_ms,10),a=isNaN(n)?Object(d.b)("Too many attempts in a short time. Wait some time before trying again."):Object(d.b)("Too many attempts in a short time. Retry after %(timeout)s.",{timeout:Object(H.m)(n/1e3)});this.setState({errorText:a})}}async onPhaseEmailSentSubmit(){this.setState({phase:K.PasswordInput})}set phase(e){this.setState({phase:e})}async verifyFieldsBeforeSubmit(){const e=[this.fieldPassword,this.fieldPasswordConfirm],t=[];for(const n of e){if(!n)continue;await n.validate({allowEmpty:!1})||t.push(n)}return 0===t.length||(t[0].focus(),t[0].validate({allowEmpty:!1,focused:!0}),!1)}async onPhasePasswordInputSubmit(){if(!await this.verifyFieldsBeforeSubmit())return;if(this.state.logoutDevices){if(!await this.renderConfirmLogoutDevicesDialog())return}this.phase=K.ResettingPassword,this.reset.setLogoutDevices(this.state.logoutDevices);try{return await this.reset.setNewPassword(this.state.password),void this.setState({phase:K.Done})}catch(e){if(401!==e.httpStatus)return void this.handleError(e)}const e=u.b.createDialog(z,{email:this.state.email,errorText:this.state.errorText,onCloseClick:()=>{e.close(),this.setState({phase:K.PasswordInput})},onReEnterEmailClick:()=>{e.close(),this.setState({phase:K.EnterEmail})},onResendClick:this.sendVerificationMail},"mx_VerifyEMailDialog",!1,!1,{onBeforeClose:async e=>("backgroundClick"===e&&this.setState({phase:K.PasswordInput}),!0)});for(;this.state.phase===K.ResettingPassword;)try{await this.reset.setNewPassword(this.state.password),this.setState({phase:K.Done}),e.close()}catch(e){await Object(c.N)(2e3)}}renderEnterEmail(){return o.a.createElement(M,{email:this.state.email,errorText:this.state.errorText,homeserver:this.props.serverConfig.hsName,loading:this.state.phase===K.SendingEmail,onInputChanged:this.onInputChanged,onLoginClick:this.props.onLoginClick,onSubmitForm:this.onSubmitForm})}async renderConfirmLogoutDevicesDialog(){const{finished:e}=u.b.createDialog(k.a,{title:Object(d.b)("Warning!"),description:o.a.createElement("div",null,o.a.createElement("p",null,this.state.serverSupportsControlOfDevicesLogout?Object(d.b)("Signing out your devices will delete the message encryption keys stored on them, making encrypted chat history unreadable."):Object(d.b)("Resetting your password on this homeserver will cause all of your devices to be signed out. This will delete the message encryption keys stored on them, making encrypted chat history unreadable.")),o.a.createElement("p",null,Object(d.b)("If you want to retain access to your chat history in encrypted rooms, set up Key Backup or export your message keys from one of your other devices before proceeding."))),button:Object(d.b)("Continue")}),[t]=await e;return!!t}renderCheckEmail(){return o.a.createElement(W,{email:this.state.email,errorText:this.state.errorText,onReEnterEmailClick:()=>this.setState({phase:K.EnterEmail}),onResendClick:this.sendVerificationMail,onSubmitForm:this.onSubmitForm})}renderSetPassword(){const e=this.state.phase===K.ResettingPassword?o.a.createElement(N.a,{w:16,h:16}):Object(d.b)("Reset password");return o.a.createElement(o.a.Fragment,null,o.a.createElement(O,{className:"mx_AuthBody_lockIcon"}),o.a.createElement("h1",null,Object(d.b)("Reset your password")),o.a.createElement("form",{onSubmit:this.onSubmitForm},o.a.createElement("fieldset",{disabled:this.state.phase===K.ResettingPassword},o.a.createElement("div",{className:"mx_AuthBody_fieldRow"},o.a.createElement(g.a,{name:"reset_password",type:"password",label:Object(d.d)("New Password"),value:this.state.password,minScore:b.a,fieldRef:e=>this.fieldPassword=e,onChange:this.onInputChanged.bind(this,"password"),autoComplete:"new-password"}),o.a.createElement(y.a,{name:"reset_password_confirm",label:Object(d.d)("Confirm new password"),labelRequired:Object(d.d)("A new password must be entered."),labelInvalid:Object(d.d)("New passwords must match each other."),value:this.state.password2,password:this.state.password,fieldRef:e=>this.fieldPasswordConfirm=e,onChange:this.onInputChanged.bind(this,"password2"),autoComplete:"new-password"})),this.state.serverSupportsControlOfDevicesLogout?o.a.createElement("div",{className:"mx_AuthBody_fieldRow"},o.a.createElement(E.b,{onChange:()=>this.setState({logoutDevices:!this.state.logoutDevices}),checked:this.state.logoutDevices},Object(d.b)("Sign out of all devices"))):null,this.state.errorText&&o.a.createElement(P,{message:this.state.errorText}),o.a.createElement("button",{type:"submit",className:"mx_Login_submit"},e))))}renderDone(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(S,{className:"mx_Icon mx_Icon_32 mx_Icon_accent"}),o.a.createElement("h1",null,Object(d.b)("Your password has been reset.")),this.state.logoutDevices?o.a.createElement("p",null,Object(d.b)("You have been logged out of all devices and will no longer receive push notifications. To re-enable notifications, sign in again on each device.")):null,o.a.createElement("input",{className:"mx_Login_submit",type:"button",onClick:this.props.onComplete,value:Object(d.b)("Return to login screen")}))}render(){let e;switch(this.state.phase){case K.EnterEmail:case K.SendingEmail:e=this.renderEnterEmail();break;case K.EmailSent:e=this.renderCheckEmail();break;case K.PasswordInput:case K.ResettingPassword:e=this.renderSetPassword();break;case K.Done:e=this.renderDone();break;default:return s.a.warn(`unknown forgot password phase ${this.state.phase}`),void this.setState({phase:K.EnterEmail})}return o.a.createElement(p.a,null,o.a.createElement(v.a,null),o.a.createElement(f.a,{className:"mx_AuthBody_forgot-password"},e))}}},1589:function(e,t,n){"use strict";n.d(t,"a",(function(){return He}));var a=n(1),i=n.n(a),r=n(13),o=n.n(r),s=n(9),l=n(11),c=n(429),d=n(24),u=n.n(d),m=n(0),h=n.n(m),p=n(4),g=n(57),b=n(100),v=n(105),f=n(2),y=n(182),E=n(256),w=n(34),S=n(162),_=n(1320),C=n(344),O=n(419),x=n(106),k=n(62),R=n(169),j=n(638),I=n(233),T=n(439),P=n(187),N=n(659),D=n(1356),M=n(196),A=n(14),L=n(97),U=n(90),F=n(1442),B=n(29);const V=["m.relates_to"];function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var H=function(e){return e[e.CanSend=0]="CanSend",e[e.Sending=1]="Sending",e[e.Sent=2]="Sent",e[e.Failed=3]="Failed",e}(H||{});const G=({room:e,type:t,content:n,matrixClient:a,onFinished:i})=>{const[r,o]=Object(m.useState)(H.CanSend);let l,c,d,u=!1;return r===H.CanSend?(l="mx_ForwardList_canSend",e.maySendMessage()||(u=!0,c=Object(f.b)("You don't have permission to do this"))):r===H.Sending?(l="mx_ForwardList_sending",u=!0,c=Object(f.b)("Sending"),d=h.a.createElement("div",{className:"mx_ForwardList_sendIcon","aria-label":c})):r===H.Sent?(l="mx_ForwardList_sent",u=!0,c=Object(f.b)("Sent"),d=h.a.createElement("div",{className:"mx_ForwardList_sendIcon","aria-label":c})):(l="mx_ForwardList_sendFailed",u=!0,c=Object(f.b)("Failed to send"),d=h.a.createElement(I.a,{notification:j.a.RED_EXCLAMATION})),h.a.createElement("div",{className:"mx_ForwardList_entry"},h.a.createElement(k.a,{className:"mx_ForwardList_roomButton",onClick:t=>{s.a.dispatch({action:A.a.ViewRoom,room_id:e.roomId,metricsTrigger:"WebForwardShortcut",metricsViaKeyboard:"click"!==t.type}),i(!0)},title:Object(f.b)("Open room"),alignment:x.a.Top},h.a.createElement(O.a,{room:e,avatarSize:32}),h.a.createElement("span",{className:"mx_ForwardList_entry_name"},e.name),h.a.createElement(F.a,{component:"span",className:"mx_ForwardList_entry_detail",room:e})),h.a.createElement(k.a,{kind:r===H.Failed?"danger_outline":"primary_outline",className:`mx_ForwardList_sendButton ${l}`,onClick:async()=>{o(H.Sending);try{await a.sendEvent(e.roomId,t,n),o(H.Sent)}catch(e){o(H.Failed)}},disabled:u,title:c,alignment:x.a.Top},h.a.createElement("div",{className:"mx_ForwardList_sendLabel"},Object(f.b)("Send")),d))};var K=({matrixClient:e,event:t,permalinkCreator:a,onFinished:i})=>{const r=e.getSafeUserId(),[s,l]=Object(m.useState)({});Object(m.useEffect)((()=>{e.getProfileInfo(r).then((e=>l(e)))}),[e,r]);const{type:c,content:d}=(e=>{const t=e.getContent(),{"m.relates_to":n}=t,a=u()(t,V),i=v.a.matches(e.getType())?p.EventType.RoomMessage:e.getType();if(Object(L.l)(e)&&Object(U.f)(a)||v.a.matches(e.getType())){const t=g.d.findIn(a),n=Object(U.g)(e);return{type:i,content:z(z({},a),Object(b.makeLocationContent)(void 0,n,t||Date.now(),void 0,g.a.Pin))}}return{type:i,content:a}})(t),O=new p.MatrixEvent({type:"m.room.message",sender:r,content:d,unsigned:{age:97},event_id:"$9999999999999999999999999999999999999999999",room_id:t.getRoomId()});O.sender={name:s.displayname||r,rawDisplayName:s.displayname,userId:r,getAvatarUrl:(...e)=>Object(S.c)({avatarUrl:s.avatar_url},30,30,"crop"),getMxcAvatarUrl:()=>s.avatar_url};const[x,k]=Object(m.useState)(""),j=x.toLowerCase(),I=Object(y.b)("layout"),A=Object(y.b)("feature_dynamic_room_predecessors");let F=Object(m.useMemo)((()=>Object(T.b)(e.getVisibleRooms(A).filter((e=>"join"===e.getMyMembership()&&!e.isSpaceRoom())))),[e,A]);j&&(F=new P.a(F,{keys:["name"],funcs:[e=>Object(B.m)([e.getCanonicalAlias(),...e.getAltAliases()])],shouldMatchWordsOnly:!1}).match(j));const[W,H]=Object(m.useState)(20);return h.a.createElement(w.a,{title:Object(f.b)("Forward message"),className:"mx_ForwardDialog",contentId:"mx_ForwardList",onFinished:i,fixedWidth:!1},h.a.createElement("h3",null,Object(f.b)("Message preview")),h.a.createElement("div",{className:o()("mx_ForwardDialog_preview",{mx_IRCLayout:I==E.a.IRC})},h.a.createElement(_.b,{mxEvent:O,layout:I,permalinkCreator:a,as:"div",inhibitInteraction:!0})),h.a.createElement("hr",null),h.a.createElement("div",{className:"mx_ForwardList",id:"mx_ForwardList"},h.a.createElement(C.a,{className:"mx_textinput_icon mx_textinput_search",placeholder:Object(f.b)("Search for rooms or people"),onSearch:k,autoFocus:!0}),h.a.createElement(R.a,{className:"mx_ForwardList_content"},F.length>0?h.a.createElement("div",{className:"mx_ForwardList_results"},h.a.createElement(N.a,{className:"mx_ForwardList_resultsList",truncateAt:W,createOverflowElement:function(e,t){const a=Object(f.b)("and %(count)s others...",{count:e});return h.a.createElement(D.b,{className:"mx_EntityTile_ellipsis",avatarJsx:h.a.createElement(M.a,{url:n(1399).default,name:"...",width:36,height:36}),name:a,presenceState:"online",suppressOnHover:!0,onClick:()=>H(t)})},getChildren:(t,n)=>F.slice(t,n).map((t=>h.a.createElement(G,{key:t.roomId,room:t,type:c,content:d,matrixClient:e,onFinished:i}))),getChildCount:()=>F.length})):h.a.createElement("span",{className:"mx_ForwardList_noResults"},Object(f.b)("No results")))))},q=n(3),$=n(117),Y=n(7),J=n(25),Q=n(623),X=n(5),Z=n(335),ee=n(60),te=n(46),ne=n(38),ae=n(1328);const ie=["org.matrix.msc3215.room.moderation.moderated_by"];var re=function(e){return e.Disagreement="org.matrix.msc3215.abuse.nature.disagreement",e.Toxic="org.matrix.msc3215.abuse.nature.toxic",e.Illegal="org.matrix.msc3215.abuse.nature.illegal",e.Spam="org.matrix.msc3215.abuse.nature.spam",e.Other="org.matrix.msc3215.abuse.nature.other",e}(re||{}),oe=function(e){return e.Admin="non-standard.abuse.nature.admin",e}(oe||{});class se extends h.a.Component{constructor(e){super(e),i()(this,"moderation",void 0),i()(this,"onIgnoreUserTooChanged",(e=>{this.setState({ignoreUserToo:e})})),i()(this,"onReasonChange",(({target:{value:e}})=>{this.setState({reason:e})})),i()(this,"onNatureChosen",(e=>{this.setState({nature:e.currentTarget.value})})),i()(this,"onCancel",(()=>{this.props.onFinished(!1)})),i()(this,"onSubmit",(async()=>{let e=this.state.reason||"";if(e=e.trim(),this.moderation){if(!this.state.nature||(this.state.nature==re.Other||this.state.nature==oe.Admin)&&!e)return void this.setState({err:Object(f.b)("Please fill why you're reporting.")})}else if(!e)return void this.setState({err:Object(f.b)("Please fill why you're reporting.")});this.setState({busy:!0,err:void 0});try{const e=Y.a.safeGet(),t=this.props.mxEvent;if(this.moderation&&this.state.nature!==oe.Admin){const n=this.state.nature,a=await Object($.d)(e,this.moderation.moderationBotUserId);if(!a)throw new f.a("Unable to create room with moderation bot");await e.sendEvent(a,"org.matrix.msc3215.abuse.report",{event_id:t.getId(),room_id:t.getRoomId(),moderated_by_id:this.moderation.moderationRoomId,nature:n,reporter:e.getUserId(),comment:this.state.reason.trim()})}else await e.reportEvent(t.getRoomId(),t.getId(),-100,this.state.reason.trim());this.state.ignoreUserToo&&await e.setIgnoredUsers([...e.getIgnoredUsers(),t.getSender()]),this.props.onFinished(!0)}catch(e){q.a.error(e),this.setState({busy:!1,err:e instanceof Error?e.message:String(e)})}}));let t=null,n=null;if(X.b.getValue("feature_report_to_moderators")){const a=Y.a.safeGet().getRoom(e.mxEvent.getRoomId());for(const e of ie){const i=null==a?void 0:a.currentState.getStateEvents(e,e);if(!i)continue;if(Array.isArray(i))throw new TypeError(`getStateEvents(${e}, ${e}) should return at most one state event`);const r=i.event;if(!("content"in r)||"object"!=typeof r.content){console.debug("Moderation error","state event",e,"should have an object field `content`, got",r);continue}const o=r.content;"room_id"in o&&"string"==typeof o.room_id?"user_id"in o&&"string"==typeof o.user_id?(t=o.room_id,n=o.user_id):console.debug("Moderation error","state event",e,"should have a string field `content.user_id`, got",r):console.debug("Moderation error","state event",e,"should have a string field `content.room_id`, got",r)}t&&n&&(this.moderation={moderationRoomId:t,moderationBotUserId:n})}this.state={reason:"",busy:!1,err:void 0,nature:void 0,ignoreUserToo:!1}}render(){var e;let t,n;this.state.err&&(t=h.a.createElement("div",{className:"error"},this.state.err)),this.state.busy&&(n=h.a.createElement("div",{className:"progress"},h.a.createElement(ne.a,null)));const a=h.a.createElement(ae.a,{value:this.state.ignoreUserToo,label:Object(f.b)("Ignore user"),byline:Object(f.b)("Check if you want to hide all current and future messages from this user."),onChange:this.onIgnoreUserTooChanged,disabled:this.state.busy}),i=null===(e=J.b.getObject("report_event"))||void 0===e?void 0:e.get("admin_message_md","adminMessageMD");let r;if(i){const e=new Q.a(i).toHTML({externalLinks:!0});r=h.a.createElement("p",{dangerouslySetInnerHTML:{__html:e}})}if(this.moderation){const e=Y.a.safeGet(),i=J.b.get("validated_server_config").hsName;let r;switch(this.state.nature){case re.Disagreement:r=Object(f.b)("What this user is writing is wrong.\nThis will be reported to the room moderators.");break;case re.Toxic:r=Object(f.b)("This user is displaying toxic behaviour, for instance by insulting other users or sharing adult-only content in a family-friendly room or otherwise violating the rules of this room.\nThis will be reported to the room moderators.");break;case re.Illegal:r=Object(f.b)("This user is displaying illegal behaviour, for instance by doxing people or threatening violence.\nThis will be reported to the room moderators who may escalate this to legal authorities.");break;case re.Spam:r=Object(f.b)("This user is spamming the room with ads, links to ads or to propaganda.\nThis will be reported to the room moderators.");break;case oe.Admin:r=e.isRoomEncrypted(this.props.mxEvent.getRoomId())?Object(f.b)("This room is dedicated to illegal or toxic content or the moderators fail to moderate illegal or toxic content.\nThis will be reported to the administrators of %(homeserver)s. The administrators will NOT be able to read the encrypted content of this room.",{homeserver:i}):Object(f.b)("This room is dedicated to illegal or toxic content or the moderators fail to moderate illegal or toxic content.\nThis will be reported to the administrators of %(homeserver)s.",{homeserver:i});break;case re.Other:r=Object(f.b)("Any other reason. Please describe the problem.\nThis will be reported to the room moderators.");break;default:r=Object(f.b)("Please pick a nature and describe what makes this message abusive.")}return h.a.createElement(w.a,{className:"mx_ReportEventDialog",onFinished:this.props.onFinished,title:Object(f.b)("Report Content"),contentId:"mx_ReportEventDialog"},h.a.createElement("div",null,h.a.createElement(Z.a,{name:"nature",value:re.Disagreement,checked:this.state.nature==re.Disagreement,onChange:this.onNatureChosen},Object(f.b)("Disagree")),h.a.createElement(Z.a,{name:"nature",value:re.Toxic,checked:this.state.nature==re.Toxic,onChange:this.onNatureChosen},Object(f.b)("Toxic Behaviour")),h.a.createElement(Z.a,{name:"nature",value:re.Illegal,checked:this.state.nature==re.Illegal,onChange:this.onNatureChosen},Object(f.b)("Illegal Content")),h.a.createElement(Z.a,{name:"nature",value:re.Spam,checked:this.state.nature==re.Spam,onChange:this.onNatureChosen},Object(f.b)("Spam or propaganda")),h.a.createElement(Z.a,{name:"nature",value:oe.Admin,checked:this.state.nature==oe.Admin,onChange:this.onNatureChosen},Object(f.b)("Report the entire room")),h.a.createElement(Z.a,{name:"nature",value:re.Other,checked:this.state.nature==re.Other,onChange:this.onNatureChosen},Object(f.b)("Other")),h.a.createElement("p",null,r),h.a.createElement(te.a,{className:"mx_ReportEventDialog_reason",element:"textarea",label:Object(f.b)("Reason"),rows:5,onChange:this.onReasonChange,value:this.state.reason,disabled:this.state.busy}),n,t,a),h.a.createElement(ee.a,{primaryButton:Object(f.b)("Send report"),onPrimaryButtonClick:this.onSubmit,focus:!0,onCancel:this.onCancel,disabled:this.state.busy}))}return h.a.createElement(w.a,{className:"mx_ReportEventDialog",onFinished:this.props.onFinished,title:Object(f.b)("Report Content to Your Homeserver Administrator"),contentId:"mx_ReportEventDialog"},h.a.createElement("div",{className:"mx_ReportEventDialog",id:"mx_ReportEventDialog"},h.a.createElement("p",null,Object(f.b)("Reporting this message will send its unique 'event ID' to the administrator of your homeserver. If messages in this room are encrypted, your homeserver administrator will not be able to read the message text or view any files or images.")),r,h.a.createElement(te.a,{className:"mx_ReportEventDialog_reason",element:"textarea",label:Object(f.b)("Reason"),rows:5,onChange:this.onReasonChange,value:this.state.reason,disabled:this.state.busy}),n,t,a),h.a.createElement(ee.a,{primaryButton:Object(f.b)("Send report"),onPrimaryButtonClick:this.onSubmit,focus:!0,onCancel:this.onCancel,disabled:this.state.busy}))}}var le=n(165),ce=n(161),de=n(15),ue=n(635);let me=function(e){return e.Appearance="SPACE_PREFERENCE_APPEARANCE_TAB",e}({});var he=n(168),pe=n(154),ge=n(218);const be=({space:e})=>{const t=Object(y.b)("Spaces.showPeopleInSpace",e.roomId);return h.a.createElement(he.a,null,h.a.createElement(pe.a,{heading:Object(f.b)("Sections to show")},h.a.createElement(ge.b,null,h.a.createElement(ce.b,{checked:!!t,onChange:n=>{X.b.setValue("Spaces.showPeopleInSpace",e.roomId,de.a.ROOM_ACCOUNT,!t)}},Object(f.b)("People")),h.a.createElement(ge.a,null,Object(f.b)("This groups your chats with members of this space. Turning this off will hide those chats from your view of %(spaceName)s.",{spaceName:e.name})))))};var ve=({space:e,initialTabId:t,onFinished:n})=>{const a=[new le.a(me.Appearance,Object(f.d)("Appearance"),"mx_SpacePreferencesDialog_appearanceIcon",h.a.createElement(be,{space:e}))];return h.a.createElement(w.a,{className:"mx_SpacePreferencesDialog",hasCancel:!0,onFinished:n,title:Object(f.b)("Preferences"),fixedWidth:!1},h.a.createElement("h4",null,h.a.createElement(ue.a,{room:e})),h.a.createElement("div",{className:"mx_SettingsDialog_content"},h.a.createElement(le.c,{tabs:a,initialTabId:t})))},fe=n(632),ye=n(10),Ee=n(730),we=n(135),Se=n(652),_e=n(1329);var Ce=({matrixClient:e,space:t})=>{var n,a,i;const[r,o]=Object(m.useState)(!1),[s,l]=Object(m.useState)(""),c=e.getUserId(),[d,u]=Object(m.useState)(null),g=t.currentState.maySendStateEvent(p.EventType.RoomAvatar,c),b=null!==d,[v,y]=Object(m.useState)(t.name),E=t.currentState.maySendStateEvent(p.EventType.RoomName,c),w=v!==t.name,_=null!==(n=null===(a=Object(_e.a)(t))||void 0===a?void 0:a.text)&&void 0!==n?n:"",[C,O]=Object(m.useState)(_),x=t.currentState.maySendStateEvent(p.EventType.RoomTopic,c),k=C!==_;return h.a.createElement(he.a,null,h.a.createElement(pe.a,{heading:Object(f.b)("General")},h.a.createElement("div",null,h.a.createElement("div",null,Object(f.b)("Edit settings relating to your space.")),s&&h.a.createElement("div",{className:"mx_SpaceRoomView_errorText"},s),h.a.createElement(Ee.b,{avatarUrl:null!==(i=Object(S.b)(t,80,80,"crop"))&&void 0!==i?i:void 0,avatarDisabled:r||!g,setAvatar:u,name:v,nameDisabled:r||!E,setName:y,topic:C,topicDisabled:r||!x,setTopic:O}),h.a.createElement(ye.a,{onClick:()=>{u(null),y(t.name),O(_)},disabled:r||!(b||w||k),kind:"link"},Object(f.b)("Cancel")),h.a.createElement(ye.a,{onClick:async()=>{o(!0);const n=[];if(b&&(d?n.push((async()=>{const{content_uri:n}=await e.uploadContent(d);await e.sendStateEvent(t.roomId,p.EventType.RoomAvatar,{url:n},"")})()):n.push(e.sendStateEvent(t.roomId,p.EventType.RoomAvatar,{},""))),w&&n.push(e.setRoomName(t.roomId,v)),k){const a=Object(we.b)(C,{forceHTML:!1});n.push(e.setRoomTopic(t.roomId,C,a))}const a=await Promise.allSettled(n);o(!1);const i=a.filter((e=>"rejected"===e.status));i.length>0&&(q.a.error("Failed to save space settings: ",i),l(Object(f.b)("Failed to save space settings.")))},disabled:r,kind:"primary"},r?Object(f.b)("Saving…"):Object(f.b)("Save Changes"))),h.a.createElement(ge.b,{heading:Object(f.b)("Leave Space")},h.a.createElement(ye.a,{kind:"danger",onClick:()=>{Object(Se.b)(t)}},Object(f.b)("Leave Space")))))},Oe=n(815),xe=n(645),ke=n(198),Re=n(803),je=n(820),Ie=n(338),Te=n(156),Pe=n(147);var Ne=({matrixClient:e,space:t,closeSettingsFn:n})=>{const[a,i]=Object(m.useState)(""),r=Object(Pe.a)((async()=>e.doesServerSupportUnstableFeature("org.matrix.msc3827.stable")),[e],!1),o=e.getUserId(),s=Object(Ie.a)(t,(e=>e.getJoinRule())),[l,c]=Object(Re.a)((()=>{var e,n;return(null===(e=t.currentState.getStateEvents(p.EventType.RoomGuestAccess,""))||void 0===e||null===(n=e.getContent())||void 0===n?void 0:n.guest_access)===p.GuestAccess.CanJoin}),(n=>e.sendStateEvent(t.roomId,p.EventType.RoomGuestAccess,{guest_access:n?p.GuestAccess.CanJoin:p.GuestAccess.Forbidden},"")),(()=>i(Object(f.b)("Failed to update the guest access of this space")))),[d,u]=Object(Re.a)((()=>{var e,n;return(null===(e=t.currentState.getStateEvents(p.EventType.RoomHistoryVisibility,""))||void 0===e||null===(n=e.getContent())||void 0===n?void 0:n.history_visibility)||p.HistoryVisibility.Shared}),(n=>e.sendStateEvent(t.roomId,p.EventType.RoomHistoryVisibility,{history_visibility:n},"")),(()=>i(Object(f.b)("Failed to update the history visibility of this space")))),[g,b]=Object(xe.a)(),v=t.currentState.maySendStateEvent(p.EventType.RoomGuestAccess,o),y=t.currentState.maySendStateEvent(p.EventType.RoomHistoryVisibility,o),E=t.currentState.mayClientSendStateEvent(p.EventType.RoomCanonicalAlias,e),w=t.currentState.getStateEvents(p.EventType.RoomCanonicalAlias,"");let S,_;return s===p.JoinRule.Public&&(S=h.a.createElement("div",null,h.a.createElement(ye.a,{"data-testid":"toggle-guest-access-btn",onClick:b,kind:"link",className:"mx_SettingsTab_showAdvanced","aria-expanded":g},g?Object(f.b)("Hide advanced"):Object(f.b)("Show advanced")),g&&h.a.createElement("div",{className:"mx_SettingsTab_toggleWithDescription"},h.a.createElement(ke.a,{value:l,onChange:c,disabled:!v,label:Object(f.b)("Enable guest access")}),h.a.createElement("p",null,Object(f.b)("Guests can join a space without having an account."),h.a.createElement("br",null),Object(f.b)("This may be useful for public spaces."))))),t.getJoinRule()===p.JoinRule.Public&&(_=h.a.createElement(pe.a,{heading:Object(f.b)("Address")},h.a.createElement(Oe.a,{roomId:t.roomId,canSetCanonicalAlias:E,canSetAliases:!0,canonicalAliasEvent:null!=w?w:void 0,hidePublishSetting:!r}))),h.a.createElement(he.a,null,h.a.createElement(pe.a,{heading:Object(f.b)("Visibility")},a&&h.a.createElement("div",{"data-testid":"space-settings-error",className:"mx_SpaceRoomView_errorText"},a),h.a.createElement(Te.a,{"data-testid":"access-fieldset",legend:Object(f.b)("Access"),description:Object(f.b)("Decide who can view and join %(spaceName)s.",{spaceName:t.name})},h.a.createElement(je.a,{room:t,onError:()=>i(Object(f.b)("Failed to update the visibility of this space")),closeSettingsFn:n}),S,h.a.createElement("div",{className:"mx_SettingsTab_toggleWithDescription"},h.a.createElement(ke.a,{value:d===p.HistoryVisibility.WorldReadable,onChange:e=>{u(e?p.HistoryVisibility.WorldReadable:p.HistoryVisibility.Shared)},disabled:!y,label:Object(f.b)("Preview Space")}),h.a.createElement("p",null,Object(f.b)("Allow people to preview your space before they join."),h.a.createElement("br",null),h.a.createElement("b",null,Object(f.b)("Recommended for public spaces."))))),_))},De=n(40),Me=n(800),Ae=n(814);let Le=function(e){return e.General="SPACE_GENERAL_TAB",e.Visibility="SPACE_VISIBILITY_TAB",e.Roles="SPACE_ROLES_TAB",e.Advanced="SPACE_ADVANCED_TAB",e}({});var Ue=({matrixClient:e,space:t,onFinished:n})=>{Object(fe.a)(s.a,(e=>{e.action===A.a.AfterLeaveRoom&&e.room_id===t.roomId&&n()}));const a=Object(m.useMemo)((()=>[new le.a(Le.General,Object(f.d)("General"),"mx_SpaceSettingsDialog_generalIcon",h.a.createElement(Ce,{matrixClient:e,space:t})),new le.a(Le.Visibility,Object(f.d)("Visibility"),"mx_SpaceSettingsDialog_visibilityIcon",h.a.createElement(Ne,{matrixClient:e,space:t,closeSettingsFn:n})),new le.a(Le.Roles,Object(f.d)("Roles & Permissions"),"mx_RoomSettingsDialog_rolesIcon",h.a.createElement(Ae.a,{room:t})),X.b.getValue(De.b.AdvancedSettings)?new le.a(Le.Advanced,Object(f.d)("Advanced"),"mx_RoomSettingsDialog_warningIcon",h.a.createElement(Me.a,{room:t,closeSettingsFn:n})):null].filter(Boolean)),[e,t,n]);return h.a.createElement(w.a,{title:Object(f.b)("Settings - %(spaceName)s",{spaceName:t.name||Object(f.b)("Unnamed Space")}),className:"mx_SpaceSettingsDialog",contentId:"mx_SpaceSettingsDialog",onFinished:n,fixedWidth:!1},h.a.createElement("div",{className:"mx_SpaceSettingsDialog_content",id:"mx_SpaceSettingsDialog"},h.a.createElement(le.c,{tabs:a})))},Fe=n(621),Be=n(286),Ve=n(113),We=n(184),ze=n(50);class He{constructor(){i()(this,"isRegistered",!1),i()(this,"matrixClient",void 0),i()(this,"onDispatch",(e=>{if(this.matrixClient)switch(e.action){case"open_room_settings":l.b.createDialog(c.b,{roomId:e.room_id||ze.b.instance.roomViewStore.getRoomId(),initialTabId:e.initial_tab_id},void 0,!1,!0);break;case A.a.OpenForwardDialog:l.b.createDialog(K,{matrixClient:this.matrixClient,event:e.event,permalinkCreator:e.permalinkCreator});break;case A.a.OpenReportEventDialog:l.b.createDialog(se,{mxEvent:e.event},"mx_Dialog_reportEvent");break;case A.a.OpenSpacePreferences:l.b.createDialog(ve,{initialTabId:e.initalTabId,space:e.space},void 0,!1,!0);break;case A.a.OpenSpaceSettings:l.b.createDialog(Ue,{matrixClient:e.space.client,space:e.space},void 0,!1,!0);break;case A.a.OpenInviteDialog:l.b.createDialog(Fe.a,{kind:e.kind,call:e.call,roomId:e.roomId},o()("mx_InviteDialog_flexWrapper",e.className),!1,!0).finished.then((t=>{var n;null===(n=e.onFinishedCallback)||void 0===n||n.call(e,t)}));break;case A.a.OpenAddToExistingSpaceDialog:{const t=e.space;l.b.createDialog(Be.d,{onCreateRoomClick:e=>{Object(We.g)(t),Ve.b.trackInteraction("WebAddExistingToSpaceDialogCreateRoomButton",e)},onAddSubspaceClick:()=>Object(We.f)(t),space:t,onFinished:e=>{e&&ze.b.instance.roomViewStore.getRoomId()===t.roomId&&s.a.fire(A.a.UpdateSpaceHierarchy)}},"mx_AddExistingToSpaceDialog_wrapper");break}}}))}prepare(e){this.matrixClient=e,this.isRegistered||(s.a.register(this.onDispatch),this.isRegistered=!0)}}i()(He,"instance",new He)},1590:function(e,t,n){"use strict";n.d(t,"a",(function(){return Y}));var a=n(1),i=n.n(a),r=n(4),o=n(3),s=n(47),l=n(9),c=n(2),d=n(631),u=n(228),m=n(14);const h="mx_snooze_bulk_unverified_device_nag",p="reviewsessions",g=e=>{u.a.sharedInstance().addOrReplaceToast({key:p,title:Object(c.b)("You have unverified sessions"),icon:"verification_warning",props:{description:Object(c.b)("Review to ensure your account is safe"),acceptLabel:Object(c.b)("Review"),onAccept:()=>{Y.sharedInstance().dismissUnverifiedSessions(e),l.a.dispatch({action:m.a.ViewUserDeviceSettings})},rejectLabel:Object(c.b)("Later"),onReject:()=>{Y.sharedInstance().dismissUnverifiedSessions(e),(()=>{try{localStorage.setItem(h,String(Date.now()))}catch(e){o.a.error("Failed to persist bulk unverified device nag snooze",e)}})()}},component:d.a,priority:50})};var b=n(11),v=n(1349),f=n(271),y=n(239),E=n(38);const w="setupencryption",S=e=>{switch(e){case x.SET_UP_ENCRYPTION:return Object(c.b)("Set up Secure Backup");case x.UPGRADE_ENCRYPTION:return Object(c.b)("Encryption upgrade available");case x.VERIFY_THIS_SESSION:return Object(c.b)("Verify this session")}},_=e=>{switch(e){case x.SET_UP_ENCRYPTION:case x.UPGRADE_ENCRYPTION:return"secure_backup";case x.VERIFY_THIS_SESSION:return"verification_warning"}},C=e=>{switch(e){case x.SET_UP_ENCRYPTION:return Object(c.b)("Continue");case x.UPGRADE_ENCRYPTION:return Object(c.b)("Upgrade");case x.VERIFY_THIS_SESSION:return Object(c.b)("Verify")}},O=e=>{switch(e){case x.SET_UP_ENCRYPTION:case x.UPGRADE_ENCRYPTION:return Object(c.b)("Safeguard against losing access to encrypted messages & data");case x.VERIFY_THIS_SESSION:return Object(c.b)("Other users may not trust it")}};let x=function(e){return e.SET_UP_ENCRYPTION="set_up_encryption",e.UPGRADE_ENCRYPTION="upgrade_encryption",e.VERIFY_THIS_SESSION="verify_this_session",e}({});const k=()=>{Y.sharedInstance().dismissEncryptionSetup()},R=e=>{var t;if(null!==(t=y.a.setupEncryptionNeeded)&&void 0!==t&&t.call(y.a,e))return;u.a.sharedInstance().addOrReplaceToast({key:w,title:S(e),icon:_(e),props:{description:O(e),acceptLabel:C(e),onAccept:async()=>{if(e===x.VERIFY_THIS_SESSION)b.b.createDialog(v.a,{},void 0,!1,!0);else{const e=b.b.createDialog(E.a,void 0,"mx_Dialog_spinner",!1,!0);try{await Object(f.b)()}finally{e.close()}}},rejectLabel:Object(c.b)("Later"),onReject:k},component:d.a,priority:e===x.VERIFY_THIS_SESSION?95:40})},j=()=>{u.a.sharedInstance().dismissToast(w)};var I=n(0),T=n.n(I),P=n(7),N=n(1389),D=n(1352),M=n(1390);function A(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?A(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):A(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function U(e){return"unverified_session_"+e}const F=async e=>{const t=P.a.safeGet(),n=await t.getDevice(e),a=L(L({},n),{},{isVerified:await Object(N.a)(t,e),deviceType:D.a.Unknown});u.a.sharedInstance().addOrReplaceToast({key:U(e),title:Object(c.b)("New login. Was this you?"),icon:"verification_warning",props:{description:n.display_name,detail:T.a.createElement(M.a,{device:a}),acceptLabel:Object(c.b)("Yes, it was me"),onAccept:()=>{Y.sharedInstance().dismissUnverifiedSessions([e])},rejectLabel:Object(c.b)("No"),onReject:()=>{Y.sharedInstance().dismissUnverifiedSessions([e]),l.a.dispatch({action:m.a.ViewUserDeviceSettings})}},component:d.a,priority:80})},B=e=>{u.a.sharedInstance().dismissToast(U(e))};var V=n(200),W=n(207);var z=n(25),H=n(75),G=n(1392),K=n(5),q=n(40),$=n(427);class Y{constructor(){i()(this,"dispatcherRef",void 0),i()(this,"dismissed",new Set),i()(this,"dismissedThisDeviceToast",!1),i()(this,"keyBackupInfo",null),i()(this,"keyBackupFetchedAt",null),i()(this,"keyBackupStatusChecked",!1),i()(this,"ourDeviceIdsAtStart",null),i()(this,"displayingToastsForDeviceIds",new Set),i()(this,"running",!1),i()(this,"client",void 0),i()(this,"shouldRecordClientInformation",!1),i()(this,"enableBulkUnverifiedSessionsReminder",!0),i()(this,"deviceClientInformationSettingWatcherRef",void 0),i()(this,"onWillUpdateDevices",(async(e,t)=>{if(!this.client)return;if(t)return;const n=this.client.getSafeUserId();e.includes(n)&&await this.ensureDeviceIdsAtStartPopulated()})),i()(this,"onDevicesUpdated",(e=>{this.client&&e.includes(this.client.getSafeUserId())&&this.recheck()})),i()(this,"onDeviceVerificationChanged",(e=>{this.client&&e===this.client.getUserId()&&this.recheck()})),i()(this,"onUserTrustStatusChanged",(e=>{this.client&&e===this.client.getUserId()&&this.recheck()})),i()(this,"onCrossSingingKeysChanged",(()=>{this.recheck()})),i()(this,"onAccountData",(e=>{(e.getType().startsWith("m.secret_storage.")||e.getType().startsWith("m.cross_signing.")||"m.megolm_backup.v1"===e.getType())&&this.recheck()})),i()(this,"onSync",((e,t)=>{"PREPARED"===e&&null===t&&this.recheck()})),i()(this,"onRoomStateEvents",(e=>{e.getType()===r.EventType.RoomEncryption&&this.recheck()})),i()(this,"onAction",(({action:e})=>{e===m.a.OnLoggedIn&&(this.recheck(),this.updateClientInformation())})),i()(this,"checkKeyBackupStatus",(async()=>{if(this.keyBackupStatusChecked||!this.client)return;const e=this.client.getKeyBackupEnabled();this.keyBackupStatusChecked=null!==e,!1===e&&l.a.dispatch({action:m.a.ReportKeyBackupNotEnabled})})),i()(this,"onRecordClientInformationSettingChange",((e,t,n,a,i)=>{const r=this.shouldRecordClientInformation;this.shouldRecordClientInformation=!!i,this.shouldRecordClientInformation!==r&&this.updateClientInformation()})),i()(this,"updateClientInformation",(async()=>{if(this.client)try{var e;if(this.shouldRecordClientInformation)await Object(G.c)(this.client,z.b.get(),null!==(e=H.a.get())&&void 0!==e?e:void 0);else await Object(G.d)(this.client)}catch(e){o.a.error("Failed to update client information",e)}}))}static sharedInstance(){return window.mxDeviceListener||(window.mxDeviceListener=new Y),window.mxDeviceListener}start(e){this.running=!0,this.client=e,this.client.on(s.b.WillUpdateDevices,this.onWillUpdateDevices),this.client.on(s.b.DevicesUpdated,this.onDevicesUpdated),this.client.on(s.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.client.on(s.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),this.client.on(s.b.KeysChanged,this.onCrossSingingKeysChanged),this.client.on(r.ClientEvent.AccountData,this.onAccountData),this.client.on(r.ClientEvent.Sync,this.onSync),this.client.on(r.RoomStateEvent.Events,this.onRoomStateEvents),this.shouldRecordClientInformation=K.b.getValue("deviceClientInformationOptIn"),this.enableBulkUnverifiedSessionsReminder=K.b.getValue(q.b.BulkUnverifiedSessionsReminder),this.deviceClientInformationSettingWatcherRef=K.b.watchSetting("deviceClientInformationOptIn",null,this.onRecordClientInformationSettingChange),this.dispatcherRef=l.a.register(this.onAction),this.recheck(),this.updateClientInformation()}stop(){this.running=!1,this.client&&(this.client.removeListener(s.b.WillUpdateDevices,this.onWillUpdateDevices),this.client.removeListener(s.b.DevicesUpdated,this.onDevicesUpdated),this.client.removeListener(s.b.DeviceVerificationChanged,this.onDeviceVerificationChanged),this.client.removeListener(s.b.UserTrustStatusChanged,this.onUserTrustStatusChanged),this.client.removeListener(s.b.KeysChanged,this.onCrossSingingKeysChanged),this.client.removeListener(r.ClientEvent.AccountData,this.onAccountData),this.client.removeListener(r.ClientEvent.Sync,this.onSync),this.client.removeListener(r.RoomStateEvent.Events,this.onRoomStateEvents)),this.deviceClientInformationSettingWatcherRef&&K.b.unwatchSetting(this.deviceClientInformationSettingWatcherRef),this.dispatcherRef&&(l.a.unregister(this.dispatcherRef),this.dispatcherRef=void 0),this.dismissed.clear(),this.dismissedThisDeviceToast=!1,this.keyBackupInfo=null,this.keyBackupFetchedAt=null,this.keyBackupStatusChecked=!1,this.ourDeviceIdsAtStart=null,this.displayingToastsForDeviceIds=new Set,this.client=void 0}async dismissUnverifiedSessions(e){o.a.log("Dismissing unverified sessions: "+Array.from(e).join(","));for(const t of e)this.dismissed.add(t);this.recheck()}dismissEncryptionSetup(){this.dismissedThisDeviceToast=!0,this.recheck()}async ensureDeviceIdsAtStartPopulated(){null===this.ourDeviceIdsAtStart&&(this.ourDeviceIdsAtStart=await this.getDeviceIds())}async getDeviceIds(){const e=this.client;return e?await Object($.b)(e,e.getSafeUserId()):new Set}async getKeyBackupInfo(){if(!this.client)return null;const e=(new Date).getTime();return(!this.keyBackupInfo||!this.keyBackupFetchedAt||this.keyBackupFetchedAt<e-3e5)&&(this.keyBackupInfo=await this.client.getKeyBackupVersion(),this.keyBackupFetchedAt=e),this.keyBackupInfo}shouldShowSetupEncryptionToast(){var e;if(Object(f.d)())return!1;const t=this.client;return null!==(e=null==t?void 0:t.getRooms().some((e=>t.isRoomEncrypted(e.roomId))))&&void 0!==e&&e}async recheck(){var e;if(!this.running||!this.client)return;const t=this.client;if(!await t.isVersionSupported("v1.1"))return;const n=t.getCrypto();if(!n)return;if(!t.isInitialSyncComplete())return;const a=await n.isCrossSigningReady(),i=await n.isSecretStorageReady(),r=a&&i;if(this.dismissedThisDeviceToast||r)j(),this.checkKeyBackupStatus();else if(this.shouldShowSetupEncryptionToast())if(await n.getUserDeviceInfo([t.getSafeUserId()]),!await n.getCrossSigningKeyId()&&t.getStoredCrossSigningForUser(t.getSafeUserId()))R(x.VERIFY_THIS_SESSION),this.checkKeyBackupStatus();else{await this.getKeyBackupInfo()?R(x.UPGRADE_ENCRYPTION):(await t.waitForClientWellKnown(),Object(V.g)(t)&&function(){const e=window.matrixChat;return(null==e?void 0:e.state.view)===W.a.LOGGED_IN}()?(j(),Object(f.b)()):R(x.SET_UP_ENCRYPTION))}await this.ensureDeviceIdsAtStartPopulated();const s=new Set,l=new Set,c=a&&Boolean(null===(e=await n.getDeviceVerificationStatus(t.getSafeUserId(),t.deviceId))||void 0===e?void 0:e.crossSigningVerified);if(a){const e=await this.getDeviceIds();for(const a of e){if(a===t.deviceId)continue;const e=await n.getDeviceVerificationStatus(t.getSafeUserId(),a);var d;if(!(null!=e&&e.crossSigningVerified||this.dismissed.has(a)))null!==(d=this.ourDeviceIdsAtStart)&&void 0!==d&&d.has(a)?s.add(a):l.add(a)}}o.a.debug("Old unverified sessions: "+Array.from(s).join(",")),o.a.debug("New unverified sessions: "+Array.from(l).join(",")),o.a.debug("Currently showing toasts for: "+Array.from(this.displayingToastsForDeviceIds).join(","));const m=(()=>{try{const e=localStorage.getItem(h),t=Number.parseInt(e||"",10);return Number.isInteger(t)&&t+6048e5>Date.now()}catch(e){return!1}})();s.size>0&&c&&this.enableBulkUnverifiedSessionsReminder&&!m?g(s):u.a.sharedInstance().dismissToast(p);for(const e of l)F(e);for(const e of this.displayingToastsForDeviceIds)l.has(e)||(o.a.debug("Hiding unverified session toast for "+e),B(e));this.displayingToastsForDeviceIds=l}}},1591:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(89),l=n(3),c=n(7),d=n(2),u=n(63),m=n(60);class h extends o.a.Component{render(){return o.a.createElement("div",null,o.a.createElement("h2",null,Object(d.b)("Verified!")),o.a.createElement("p",null,Object(d.b)("You've successfully verified this user.")),o.a.createElement("p",null,Object(d.b)("Secure messages with this user are end-to-end encrypted and not able to be read by third parties.")),o.a.createElement(m.a,{onPrimaryButtonClick:this.props.onDone,primaryButton:Object(d.b)("Got It"),hasCancel:!1}))}}class p extends o.a.Component{render(){return o.a.createElement("div",null,o.a.createElement("p",null,Object(d.b)("The other party cancelled the verification.")),o.a.createElement(m.a,{primaryButton:Object(d.b)("OK"),hasCancel:!1,onPrimaryButtonClick:this.props.onDone}))}}var g=n(196),b=n(38),v=n(771),f=n(34);class y extends o.a.Component{constructor(e){super(e),i()(this,"showSasEvent",void 0),i()(this,"onFinished",(()=>{this.props.onFinished(3===this.state.phase)})),i()(this,"onCancelClick",(()=>{this.props.onFinished(3===this.state.phase)})),i()(this,"onContinueClick",(()=>{this.setState({phase:2}),this.props.verifier.verify().then((()=>{this.setState({phase:3})})).catch((e=>{l.a.log("Verification failed",e)}))})),i()(this,"onVerifierShowSas",(e=>{this.showSasEvent=e,this.setState({phase:1,sas:e.sas})})),i()(this,"onVerifierCancel",(()=>{this.setState({phase:4})})),i()(this,"onSasMatchesClick",(()=>{var e;null===(e=this.showSasEvent)||void 0===e||e.confirm(),this.setState({phase:2})})),i()(this,"onVerifiedDoneClick",(()=>{this.props.onFinished(!0)}));let t=0;this.props.verifier.hasBeenCancelled&&(l.a.log("Verifier was cancelled in the background."),t=4),this.showSasEvent=null,this.state={phase:t,sasVerified:!1,opponentProfile:null,opponentProfileError:null,sas:null},this.props.verifier.on(s.c.ShowSas,this.onVerifierShowSas),this.props.verifier.on(s.c.Cancel,this.onVerifierCancel),this.fetchOpponentProfile()}componentWillUnmount(){4!==this.state.phase&&3!==this.state.phase&&this.props.verifier.cancel(new Error("User cancel")),this.props.verifier.removeListener(s.c.ShowSas,this.onVerifierShowSas)}async fetchOpponentProfile(){try{const e=await c.a.safeGet().getProfileInfo(this.props.verifier.userId);this.setState({opponentProfile:e})}catch(e){this.setState({opponentProfileError:e})}}renderPhaseStart(){const e=this.props.verifier.userId===c.a.safeGet().getUserId();let t;const n=this.state.opponentProfile;if(n){const e=n.avatar_url?Object(u.b)(n.avatar_url).getSquareThumbnailHttp(48):null;t=o.a.createElement("div",{className:"mx_IncomingSasDialog_opponentProfile"},o.a.createElement(g.a,{name:n.displayname,idName:this.props.verifier.userId,url:e,width:48,height:48,resizeMethod:"crop"}),o.a.createElement("h2",null,n.displayname))}else t=this.state.opponentProfileError?o.a.createElement("div",null,o.a.createElement(g.a,{name:this.props.verifier.userId.slice(1),idName:this.props.verifier.userId,width:48,height:48}),o.a.createElement("h2",null,this.props.verifier.userId)):o.a.createElement(b.a,null);const a=[o.a.createElement("p",{key:"p1"},Object(d.b)("Verify this user to mark them as trusted. Trusting users gives you extra peace of mind when using end-to-end encrypted messages.")),o.a.createElement("p",{key:"p2"},Object(d.b)("Verifying this user will mark their session as trusted, and also mark your session as trusted to them."))],i=[o.a.createElement("p",{key:"p1"},Object(d.b)("Verify this device to mark it as trusted. Trusting this device gives you and other users extra peace of mind when using end-to-end encrypted messages.")),o.a.createElement("p",{key:"p2"},Object(d.b)("Verifying this device will mark it as trusted, and users who have verified with you will trust this device."))];return o.a.createElement("div",null,t,e?i:a,o.a.createElement(m.a,{primaryButton:Object(d.b)("Continue"),hasCancel:!0,onPrimaryButtonClick:this.onContinueClick,onCancel:this.onCancelClick}))}renderPhaseShowSas(){return this.showSasEvent?o.a.createElement(v.a,{sas:this.showSasEvent.sas,onCancel:this.onCancelClick,onDone:this.onSasMatchesClick,isSelf:this.props.verifier.userId===c.a.safeGet().getUserId(),inDialog:!0}):null}renderPhaseWaitForPartnerToConfirm(){return o.a.createElement("div",null,o.a.createElement(b.a,null),o.a.createElement("p",null,Object(d.b)("Waiting for partner to confirm…")))}renderPhaseVerified(){return o.a.createElement(h,{onDone:this.onVerifiedDoneClick})}renderPhaseCancelled(){return o.a.createElement(p,{onDone:this.onCancelClick})}render(){let e;switch(this.state.phase){case 0:e=this.renderPhaseStart();break;case 1:e=this.renderPhaseShowSas();break;case 2:e=this.renderPhaseWaitForPartnerToConfirm();break;case 3:e=this.renderPhaseVerified();break;case 4:e=this.renderPhaseCancelled()}return o.a.createElement(f.a,{title:Object(d.b)("Incoming Verification Request"),onFinished:this.onFinished,fixedWidth:!1},e)}}},1592:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var a=n(13),i=n.n(a),r=n(0),o=n.n(r),s=n(2),l=n(1331),c=n(17),d=n.n(c),u=n(24),m=n.n(u);const h=["children","className"];function p(e){let{children:t,className:n}=e,a=m()(e,h);const r=i()(n,"mx_SplashPage");return o.a.createElement("main",d()({},a,{className:r}),t)}var g=n(10);function b({useCase:e,onClick:t,selected:n}){let a;switch(e){case l.a.PersonalMessaging:a=Object(s.b)("Friends and family");break;case l.a.WorkMessaging:a=Object(s.b)("Coworkers and teams");break;case l.a.CommunityMessaging:a=Object(s.b)("Online community members")}return o.a.createElement(g.a,{className:i()("mx_UseCaseSelectionButton",{mx_UseCaseSelectionButton_selected:n}),onClick:async()=>t(e)},o.a.createElement("div",{className:i()("mx_UseCaseSelectionButton_icon",{mx_UseCaseSelectionButton_messaging:e===l.a.PersonalMessaging,mx_UseCaseSelectionButton_work:e===l.a.WorkMessaging,mx_UseCaseSelectionButton_community:e===l.a.CommunityMessaging})}),o.a.createElement("span",null,a),o.a.createElement("div",{className:"mx_UseCaseSelectionButton_selectedIcon"}))}const v=1500;function f({onFinished:e}){const[t,n]=Object(r.useState)(null);return Object(r.useEffect)((()=>{if(t){let n=window.setTimeout((()=>{n=null,e(t)}),v);return()=>{null!==n&&clearTimeout(n),n=null}}}),[t,e]),o.a.createElement(p,{className:i()("mx_UseCaseSelection",{mx_UseCaseSelection_selected:null!==t})},o.a.createElement("div",{className:"mx_UseCaseSelection_title mx_UseCaseSelection_slideIn"},o.a.createElement("h1",null,Object(s.b)("You're in"))),o.a.createElement("div",{className:"mx_UseCaseSelection_info mx_UseCaseSelection_slideInDelayed"},o.a.createElement("h2",null,Object(s.b)("Who will you chat to the most?")),o.a.createElement("h3",null,Object(s.b)("We'll help you get connected."))),o.a.createElement("div",{className:"mx_UseCaseSelection_options mx_UseCaseSelection_slideInDelayed"},o.a.createElement(b,{useCase:l.a.PersonalMessaging,selected:t===l.a.PersonalMessaging,onClick:n}),o.a.createElement(b,{useCase:l.a.WorkMessaging,selected:t===l.a.WorkMessaging,onClick:n}),o.a.createElement(b,{useCase:l.a.CommunityMessaging,selected:t===l.a.CommunityMessaging,onClick:n})),o.a.createElement("div",{className:"mx_UseCaseSelection_skip mx_UseCaseSelection_slideInDelayed"},o.a.createElement(g.a,{kind:"link",onClick:async()=>n(l.a.Skip)},Object(s.b)("Skip"))))}},1593:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var a=n(0),i=n.n(a),r=n(13),o=n.n(r),s=n(25),l=n(1315),c=n(2),d=n(5),u=n(40),m=n(1430),h=n(1361);const p=`<a href="https://matrix.org" target="_blank" rel="noreferrer noopener">\n    <img width="79" height="34" alt="Matrix" style="padding-left: 1px;vertical-align: middle" src="${n(1565).default}"/>\n</a>`;Object(c.d)("Sign in with SSO");class g extends i.a.PureComponent{render(){const e=s.b.getObject("embedded_pages");let t;e&&(t=e.get("welcome_url"));const n={"$riot:ssoUrl":"#/start_sso","$riot:casUrl":"#/start_cas",$matrixLogo:p,"[matrix]":p};if(!t){var a;const e=s.b.getObject("branding"),i=null!==(a=null==e?void 0:e.get("auth_header_logo_url"))&&void 0!==a?a:"themes/element/img/logos/element-logo.svg";n.$logoUrl=i,t="welcome.html"}return i.a.createElement(l.a,null,i.a.createElement("div",{className:o()("mx_Welcome",{mx_WelcomePage_registrationDisabled:!d.b.getValue(u.b.Registration)})},i.a.createElement(h.a,{className:"mx_WelcomePage",url:t,replaceMap:n}),i.a.createElement(m.a,null)))}}},1594:function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var a=n(0),i=n.n(a),r=n(1315),o=n(1429),s=n(1),l=n.n(s),c=n(3),d=n(4),u=n(7),m=n(2),h=n(11),p=n(316),g=n(60),b=n(34),v=n(38),f=n(416);class y extends i.a.PureComponent{constructor(e){super(e),l()(this,"doBootstrapUIAuth",(async e=>{if(this.state.canUploadKeysWithPasswordOnly&&this.state.accountPassword)await e({type:"m.login.password",identifier:{type:"m.id.user",user:u.a.safeGet().getUserId()},user:u.a.safeGet().getUserId(),password:this.state.accountPassword});else if(this.props.tokenLogin)await e({});else{const t={[p.c.PHASE_PREAUTH]:{title:Object(m.b)("Use Single Sign On to continue"),body:Object(m.b)("To continue, use Single Sign On to prove your identity."),continueText:Object(m.b)("Single Sign On"),continueKind:"primary"},[p.c.PHASE_POSTAUTH]:{title:Object(m.b)("Confirm encryption setup"),body:Object(m.b)("Click the button below to confirm setting up encryption."),continueText:Object(m.b)("Confirm"),continueKind:"primary"}},{finished:n}=h.b.createDialog(f.a,{title:Object(m.b)("Setting up keys"),matrixClient:u.a.safeGet(),makeRequest:e,aestheticsForStagePhases:{[p.c.LOGIN_TYPE]:t,[p.c.UNSTABLE_LOGIN_TYPE]:t}}),[a]=await n;if(!a)throw new Error("Cross-signing key upload auth canceled")}})),l()(this,"bootstrapCrossSigning",(async()=>{this.setState({error:!1});try{const e=u.a.safeGet();await e.bootstrapCrossSigning({authUploadDeviceSigningKeys:this.doBootstrapUIAuth}),this.props.onFinished(!0)}catch(e){if(this.props.tokenLogin)return void this.props.onFinished(!1);this.setState({error:!0}),c.a.error("Error bootstrapping cross-signing",e)}})),l()(this,"onCancel",(()=>{this.props.onFinished(!1)})),this.state={error:!1,canUploadKeysWithPasswordOnly:!!e.accountPassword||null,accountPassword:e.accountPassword||""},this.state.accountPassword||this.queryKeyUploadAuth()}componentDidMount(){this.bootstrapCrossSigning()}async queryKeyUploadAuth(){try{await u.a.safeGet().uploadDeviceSigningKeys(void 0,{}),c.a.log("uploadDeviceSigningKeys unexpectedly succeeded without UI auth!")}catch(e){if(!(e instanceof d.MatrixError&&e.data&&e.data.flows))return void c.a.log("uploadDeviceSigningKeys advertised no flows!");const t=e.data.flows.some((e=>1===e.stages.length&&"m.login.password"===e.stages[0]));this.setState({canUploadKeysWithPasswordOnly:t})}}render(){let e;return e=this.state.error?i.a.createElement("div",null,i.a.createElement("p",null,Object(m.b)("Unable to set up keys")),i.a.createElement("div",{className:"mx_Dialog_buttons"},i.a.createElement(g.a,{primaryButton:Object(m.b)("Retry"),onPrimaryButtonClick:this.bootstrapCrossSigning,onCancel:this.onCancel}))):i.a.createElement("div",null,i.a.createElement(v.a,null)),i.a.createElement(b.a,{className:"mx_CreateCrossSigningDialog",onFinished:this.props.onFinished,title:Object(m.b)("Setting up keys"),hasCancel:!1,fixedWidth:!1},i.a.createElement("div",null,e))}}class E extends i.a.Component{render(){return i.a.createElement(r.a,null,i.a.createElement(o.a,null,i.a.createElement(y,{onFinished:this.props.onFinished,accountPassword:this.props.accountPassword,tokenLogin:this.props.tokenLogin})))}}},1595:function(e,t,n){"use strict";n.d(t,"a",(function(){return D}));var a=n(1),i=n.n(a),r=n(4),o=n(0),s=n.n(o),l=n(13),c=n.n(l),d=n(3),u=n(528),m=n(2),h=n(637),p=n(1318),g=n(1327),b=n(7),v=n(1315),f=n(1344),y=n(9),E=n(1368),w=n(1443),S=n(1375),_=n(10),C=n(1334),O=n(1333),x=n(574),k=n(38),R=n(462);function j({title:e,icon:t,serverPicker:n,children:a}){var i,r,l;const c=Object(o.useContext)(R.a);if(!c)return s.a.createElement(s.a.Fragment,null);const d=null!==(i=c.state[0])&&void 0!==i?i:null;return s.a.createElement(o.Fragment,null,null!==(r=null==d?void 0:d.icon)&&void 0!==r?r:t,s.a.createElement("h1",null,null!==(l=null==d?void 0:d.title)&&void 0!==l?l:e),a,!0!==(null==d?void 0:d.hideServerPicker)&&n)}var I=n(610),T=n(5);function P(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const N=(...e)=>{T.b.getValue("debug_registration")&&d.a.log.call(console,"Registration debuglog:",...e)};class D extends s.a.Component{constructor(e){super(e),i()(this,"loginLogic",void 0),i()(this,"latestServerConfig",void 0),i()(this,"unloadCallback",(e=>{if(this.state.doingUIAuth)return e.preventDefault(),e.returnValue="",""})),i()(this,"onFormSubmit",(async e=>{this.setState({errorText:"",busy:!0,formVals:e,doingUIAuth:!0})})),i()(this,"requestEmailToken",((e,t,n,a)=>{if(!this.state.matrixClient)throw new Error("Matrix client has not yet been loaded");return this.state.matrixClient.requestRegisterEmailToken(e,t,n,this.props.makeRegistrationUrl({client_secret:t,hs_url:this.state.matrixClient.getHomeserverUrl(),is_url:this.state.matrixClient.getIdentityServerUrl(),session_id:a}))})),i()(this,"onUIAuthFinished",(async(e,t)=>{if(!this.state.matrixClient)throw new Error("Matrix client has not yet been loaded");if(N("Registration: ui authentication finished: ",{success:e,response:t}),!e){var n;let e=t.message||t.toString();if(t instanceof r.MatrixError&&"M_RESOURCE_LIMIT_EXCEEDED"===t.errcode){const n=Object(h.d)(t.data.limit_type,t.data.admin_contact,h.f),a=Object(h.d)(t.data.limit_type,t.data.admin_contact,h.a);e=s.a.createElement("div",null,s.a.createElement("p",null,n),s.a.createElement("p",null,a))}else if(null!==(n=t.flows)&&void 0!==n&&n.some((e=>e.stages.includes(r.AuthType.Msisdn)))){var a;(null!==(a=t.flows)&&void 0!==a?a:[]).some((e=>e.stages.includes(r.AuthType.Msisdn)))||(e=Object(m.b)("This server does not support authentication with a phone number."))}else t instanceof r.MatrixError&&"M_USER_IN_USE"===t.errcode?e=Object(m.b)("Someone already has that username, please try another."):t instanceof r.MatrixError&&"M_THREEPID_IN_USE"===t.errcode&&(e=Object(m.b)("That e-mail address or phone number is already in use."));return void this.setState({busy:!1,doingUIAuth:!1,errorText:e})}const i=t.user_id,o=t.access_token;if(!i||!o)throw new Error("Registration failed");b.a.setJustRegisteredUserId(i);const l={doingUIAuth:!1,registeredUsername:i,differentLoggedInUserId:void 0,completedNoSignin:!1,busy:!0},[c,u]=await g.b();c&&!u&&c!==i&&(d.a.log(`Found a session for ${c} but ${i} has just registered.`),l.differentLoggedInUserId=c);const p=Boolean(this.state.formVals.email),v=Boolean(o);N("Registration: ui auth finished:",{hasEmail:p,hasAccessToken:v}),p||!v||l.differentLoggedInUserId?(l.busy=!1,l.completedNoSignin=!0):(await this.props.onLoggedIn({userId:i,deviceId:t.device_id,homeserverUrl:this.state.matrixClient.getHomeserverUrl(),identityServerUrl:this.state.matrixClient.getIdentityServerUrl(),accessToken:o},this.state.formVals.password),this.setupPushers()),this.setState(l)})),i()(this,"onLoginClick",(e=>{e.preventDefault(),e.stopPropagation(),this.props.onLoginClick()})),i()(this,"onGoToFormClicked",(e=>{e.preventDefault(),e.stopPropagation(),this.replaceClient(this.props.serverConfig),this.setState({busy:!1,doingUIAuth:!1})})),i()(this,"makeRegisterRequest",(e=>{if(!this.state.matrixClient)throw new Error("Matrix client has not yet been loaded");const t={username:this.state.formVals.username,password:this.state.formVals.password,initial_device_display_name:this.props.defaultDeviceDisplayName,auth:void 0,inhibit_login:void 0};return e&&(t.auth=e),N("Registration: sending registration request:",e),this.state.matrixClient.registerRequest(t)})),i()(this,"onLoginClickWithCheck",(async e=>{e.preventDefault();const t=await g.h({ignoreGuest:!0});return t||this.props.onLoginClick(),t})),this.state={busy:!1,errorText:null,formVals:{email:this.props.email},doingUIAuth:Boolean(this.props.sessionId),flows:null,completedNoSignin:!1,serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""};const{hsUrl:t,isUrl:n}=this.props.serverConfig;this.loginLogic=new f.a(t,n,null,{defaultDeviceDisplayName:"Element login check"})}componentDidMount(){this.replaceClient(this.props.serverConfig),window.addEventListener("beforeunload",this.unloadCallback)}componentWillUnmount(){window.removeEventListener("beforeunload",this.unloadCallback)}componentDidUpdate(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl||this.replaceClient(this.props.serverConfig)}async replaceClient(e){this.latestServerConfig=e;const{hsUrl:t,isUrl:n}=e;this.setState({errorText:null,serverDeadError:null,serverErrorIsFatal:!1,busy:!0});try{if(await p.a.validateServerConfigWithStaticUrls(t,n),e!==this.latestServerConfig)return;this.setState({serverIsAlive:!0,serverErrorIsFatal:!1})}catch(t){if(e!==this.latestServerConfig)return;if(this.setState(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?P(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):P(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({busy:!1},p.a.authComponentStateForError(t,"register"))),this.state.serverErrorIsFatal)return}const a=Object(r.createClient)({baseUrl:t,idBaseUrl:n});let o;this.loginLogic.setHomeserverUrl(t),this.loginLogic.setIdentityServerUrl(n);try{const t=await this.loginLogic.getFlows();if(e!==this.latestServerConfig)return;o=t.find((e=>"m.login.sso"===e.type||"m.login.cas"===e.type))}catch(t){if(e!==this.latestServerConfig)return;d.a.error("Failed to get login flows to check for SSO support",t)}this.setState({matrixClient:a,ssoFlow:o,busy:!1});try{if(!this.state.doingUIAuth){if(await this.makeRegisterRequest(null),e!==this.latestServerConfig)return;d.a.log("Expecting 401 from register request but got success!")}}catch(t){if(e!==this.latestServerConfig)return;t instanceof r.MatrixError&&401===t.httpStatus?this.setState({flows:t.data.flows}):t instanceof r.MatrixError&&(403===t.httpStatus||"M_FORBIDDEN"===t.errcode)?o?y.a.dispatch({action:"start_login"}):this.setState({serverErrorIsFatal:!0,errorText:Object(m.b)("Registration has been disabled on this homeserver."),flows:[]}):(d.a.log("Unable to query for supported registration methods.",t),this.setState({errorText:Object(m.b)("Unable to query for supported registration methods."),flows:[]}))}}setupPushers(){if(!this.props.brand)return Promise.resolve();const e=b.a.safeGet();return e.getPushers().then((t=>{const n=t.pushers;for(let t=0;t<n.length;++t)if("email"===n[t].kind){const a=n[t];a.data={brand:this.props.brand},e.setPusher(a).then((()=>{d.a.log("Set email branding to "+this.props.brand)}),(e=>{d.a.error("Couldn't set email branding: "+e)}))}}),(e=>{d.a.error("Couldn't get pushers: "+e)}))}getUIAuthInputs(){return{emailAddress:this.state.formVals.email,phoneCountry:this.state.formVals.phoneCountry,phoneNumber:this.state.formVals.phoneNumber}}renderRegisterComponent(){if(this.state.matrixClient&&this.state.doingUIAuth)return s.a.createElement(x.b,{matrixClient:this.state.matrixClient,makeRequest:this.makeRegisterRequest,onAuthFinished:this.onUIAuthFinished,inputs:this.getUIAuthInputs(),requestEmailToken:this.requestEmailToken,sessionId:this.props.sessionId,clientSecret:this.props.clientSecret,emailSid:this.props.idSid,poll:!0});if(!this.state.matrixClient&&!this.state.busy)return null;if(this.state.busy||!this.state.flows)return s.a.createElement("div",{className:"mx_AuthBody_spinner"},s.a.createElement(k.a,null));if(this.state.matrixClient&&this.state.flows.length){let e;if(this.state.ssoFlow){let t;(this.state.ssoFlow.identity_providers||[]).length>1&&(t=s.a.createElement("h2",{className:"mx_AuthBody_centered"},Object(m.b)("Continue with %(ssoButtons)s",{ssoButtons:""}).trim())),e=s.a.createElement(s.a.Fragment,null,t,s.a.createElement(E.a,{matrixClient:this.loginLogic.createTemporaryClient(),flow:this.state.ssoFlow,loginType:"m.login.sso"===this.state.ssoFlow.type?"sso":"cas",fragmentAfterLogin:this.props.fragmentAfterLogin,action:u.c.REGISTER}),s.a.createElement("h2",{className:"mx_AuthBody_centered"},Object(m.b)("%(ssoButtons)s Or %(usernamePassword)s",{ssoButtons:"",usernamePassword:""}).trim()))}return s.a.createElement(s.a.Fragment,null,e,s.a.createElement(S.b,{defaultUsername:this.state.formVals.username,defaultEmail:this.state.formVals.email,defaultPhoneCountry:this.state.formVals.phoneCountry,defaultPhoneNumber:this.state.formVals.phoneNumber,defaultPassword:this.state.formVals.password,onRegisterClick:this.onFormSubmit,flows:this.state.flows,serverConfig:this.props.serverConfig,canSubmit:!this.state.serverErrorIsFatal,matrixClient:this.state.matrixClient}))}return null}render(){let e;const t=this.state.errorText;let n;if(t&&(e=s.a.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=c()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});n=s.a.createElement("div",{className:e},this.state.serverDeadError)}const a=s.a.createElement("span",{className:"mx_AuthBody_changeFlow"},Object(m.b)("Already have an account? <a>Sign in here</a>",{},{a:e=>s.a.createElement(_.a,{kind:"link_inline",onClick:this.onLoginClick},e)}));let i,r;if(this.state.doingUIAuth&&(i=s.a.createElement(_.a,{kind:"link",className:"mx_AuthBody_changeFlow",onClick:this.onGoToFormClicked},Object(m.b)("Go back"))),this.state.completedNoSignin){let e;e=this.state.differentLoggedInUserId?s.a.createElement("div",null,s.a.createElement("p",null,Object(m.b)("Your new account (%(newAccountId)s) is registered, but you're already logged into a different account (%(loggedInUserId)s).",{newAccountId:this.state.registeredUsername,loggedInUserId:this.state.differentLoggedInUserId})),s.a.createElement("p",null,s.a.createElement(_.a,{kind:"link_inline",onClick:async e=>{await this.onLoginClickWithCheck(e)&&y.a.dispatch({action:"view_welcome_page"})}},Object(m.b)("Continue with previous account")))):s.a.createElement("h2",null,Object(m.b)("<a>Log in</a> to your new account.",{},{a:e=>s.a.createElement(_.a,{kind:"link_inline",onClick:async e=>{await this.onLoginClickWithCheck(e)&&y.a.dispatch({action:"view_home_page"})}},e)})),r=s.a.createElement("div",null,s.a.createElement("h1",null,Object(m.b)("Registration Successful")),e)}else r=s.a.createElement(o.Fragment,null,s.a.createElement("div",{className:"mx_Register_mainContent"},s.a.createElement(j,{title:Object(m.b)("Create account"),serverPicker:s.a.createElement(w.a,{title:Object(m.b)("Host account on"),dialogTitle:Object(m.b)("Decide where your account is hosted"),serverConfig:this.props.serverConfig,onServerConfigChange:this.state.doingUIAuth?void 0:this.props.onServerConfigChange})},e,n),this.renderRegisterComponent()),s.a.createElement("div",{className:"mx_Register_footerActions"},i,a));return s.a.createElement(v.a,null,s.a.createElement(O.a,null),s.a.createElement(I.b,null,s.a.createElement(C.a,{flex:!0},r)))}}},1596:function(e,t,n){"use strict";n.d(t,"a",(function(){return W}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(13),l=n.n(s),c=n(3),d=n(528),u=n(2),m=n(1344),h=n(637),p=n(1318),g=n(1315),b=n(75),v=n(5),f=n(40),y=n(25),E=n(10),w=n(229),S=n(46),_=n(1366),C=n(1332);let O,x,k;const R=/^[0-9()\-\s]*$/;var j=function(e){return e.Email="login_field_email",e.MatrixId="login_field_mxid",e.Phone="login_field_phone",e.Password="login_field_phone",e}(j||{});O=j.Email,x=j.Phone,k=j.MatrixId;class I extends o.a.PureComponent{constructor(e){super(e),i()(this,O,null),i()(this,x,null),i()(this,k,null),i()(this,"onForgotPasswordClick",(e=>{var t,n;e.preventDefault(),e.stopPropagation(),null===(t=(n=this.props).onForgotPasswordClick)||void 0===t||t.call(n)})),i()(this,"onSubmitForm",(async e=>{e.preventDefault();if(await this.verifyFieldsBeforeSubmit())switch(this.state.loginType){case j.Email:case j.MatrixId:this.props.onSubmit(this.props.username,void 0,void 0,this.state.password);break;case j.Phone:this.props.onSubmit(void 0,this.props.phoneCountry,this.props.phoneNumber,this.state.password)}})),i()(this,"onUsernameChanged",(e=>{var t,n;null===(t=(n=this.props).onUsernameChanged)||void 0===t||t.call(n,e.target.value)})),i()(this,"onUsernameBlur",(e=>{var t,n;null===(t=(n=this.props).onUsernameBlur)||void 0===t||t.call(n,e.target.value)})),i()(this,"onLoginTypeChange",(e=>{var t,n;const a=e.target.value;this.setState({loginType:a}),null===(t=(n=this.props).onUsernameChanged)||void 0===t||t.call(n,"")})),i()(this,"onPhoneCountryChanged",(e=>{var t,n;null===(t=(n=this.props).onPhoneCountryChanged)||void 0===t||t.call(n,e.iso2)})),i()(this,"onPhoneNumberChanged",(e=>{var t,n;null===(t=(n=this.props).onPhoneNumberChanged)||void 0===t||t.call(n,e.target.value)})),i()(this,"onPasswordChanged",(e=>{this.setState({password:e.target.value})})),i()(this,"validateUsernameRules",Object(w.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(u.b)("Enter username")}]})),i()(this,"onUsernameValidate",(async e=>{const t=await this.validateUsernameRules(e);return this.markFieldValid(j.MatrixId,t.valid),t})),i()(this,"onEmailValidate",(e=>{this.markFieldValid(j.Email,e.valid)})),i()(this,"validatePhoneNumberRules",Object(w.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(u.b)("Enter phone number")},{key:"number",test:({value:e})=>!e||R.test(e),invalid:()=>Object(u.b)("That phone number doesn't look quite right, please check and try again")}]})),i()(this,"onPhoneNumberValidate",(async e=>{const t=await this.validatePhoneNumberRules(e);return this.markFieldValid(j.Password,t.valid),t})),i()(this,"validatePasswordRules",Object(w.a)({rules:[{key:"required",test:({value:e,allowEmpty:t})=>t||!!e,invalid:()=>Object(u.b)("Enter password")}]})),i()(this,"onPasswordValidate",(async e=>{const t=await this.validatePasswordRules(e);return this.markFieldValid(j.Password,t.valid),t})),this.state={fieldValid:{},loginType:j.MatrixId,password:""}}async verifyFieldsBeforeSubmit(){const e=document.activeElement;e&&e.blur();const t=[this.state.loginType,j.Password];for(const e of t){const t=this[e];t&&await t.validate({allowEmpty:!1})}if(await new Promise((e=>this.setState({},e))),this.allFieldsValid())return!0;const n=this.findFirstInvalidField(t);return!n||(n.focus(),n.validate({allowEmpty:!1,focused:!0}),!1)}allFieldsValid(){return Object.values(this.state.fieldValid).every(Boolean)}findFirstInvalidField(e){for(const t of e)if(!this.state.fieldValid[t]&&this[t])return this[t];return null}markFieldValid(e,t){const{fieldValid:n}=this.state;n[e]=t,this.setState({fieldValid:n})}renderLoginField(e,t){const n={error:!1};switch(e){case j.Email:return n.error=this.props.loginIncorrect&&!this.props.username,o.a.createElement(C.a,{id:"mx_LoginForm_email",className:l()(n),name:"username",autoComplete:"email",type:"email",key:"email_input",placeholder:"joe@example.com",value:this.props.username,onChange:this.onUsernameChanged,onBlur:this.onUsernameBlur,disabled:this.props.busy,autoFocus:t,onValidate:this.onEmailValidate,fieldRef:e=>{this[j.Email]=e}});case j.MatrixId:return n.error=this.props.loginIncorrect&&!this.props.username,o.a.createElement(S.a,{id:"mx_LoginForm_username",className:l()(n),name:"username",autoComplete:"username",key:"username_input",type:"text",label:Object(u.b)("Username"),placeholder:Object(u.b)("Username").toLocaleLowerCase(),value:this.props.username,onChange:this.onUsernameChanged,onBlur:this.onUsernameBlur,disabled:this.props.busy,autoFocus:t,onValidate:this.onUsernameValidate,ref:e=>{this[j.MatrixId]=e}});case j.Phone:{n.error=this.props.loginIncorrect&&!this.props.phoneNumber;const e=o.a.createElement(_.a,{value:this.props.phoneCountry,isSmall:!0,showPrefix:!0,onOptionChange:this.onPhoneCountryChanged});return o.a.createElement(S.a,{id:"mx_LoginForm_phone",className:l()(n),name:"phoneNumber",autoComplete:"tel-national",key:"phone_input",type:"text",label:Object(u.b)("Phone"),value:this.props.phoneNumber,prefixComponent:e,onChange:this.onPhoneNumberChanged,disabled:this.props.busy,autoFocus:t,onValidate:this.onPhoneNumberValidate,ref:e=>{this[j.Password]=e}})}}}isLoginEmpty(){switch(this.state.loginType){case j.Email:case j.MatrixId:return!this.props.username;case j.Phone:return!this.props.phoneCountry||!this.props.phoneNumber}}render(){let e;this.props.onForgotPasswordClick&&(e=o.a.createElement(E.a,{className:"mx_Login_forgot",disabled:this.props.busy,kind:"link",onClick:this.onForgotPasswordClick},Object(u.b)("Forgot password?")));const t=l()({error:this.props.loginIncorrect&&!this.isLoginEmpty()}),n=!this.isLoginEmpty(),a=this.renderLoginField(this.state.loginType,!n);let i;return y.b.get().disable_3pid_login||(i=o.a.createElement("div",{className:"mx_Login_type_container"},o.a.createElement("label",{className:"mx_Login_type_label"},Object(u.b)("Sign in with")),o.a.createElement(S.a,{element:"select",value:this.state.loginType,onChange:this.onLoginTypeChange,disabled:this.props.busy},o.a.createElement("option",{key:j.MatrixId,value:j.MatrixId},Object(u.b)("Username")),o.a.createElement("option",{key:j.Email,value:j.Email},Object(u.b)("Email address")),o.a.createElement("option",{key:j.Password,value:j.Password},Object(u.b)("Phone"))))),o.a.createElement("div",null,o.a.createElement("form",{onSubmit:this.onSubmitForm},i,a,o.a.createElement(S.a,{id:"mx_LoginForm_password",className:t,autoComplete:"current-password",type:"password",name:"password",label:Object(u.b)("Password"),value:this.state.password,onChange:this.onPasswordChanged,disabled:this.props.busy,autoFocus:n,onValidate:this.onPasswordValidate,ref:e=>this[j.Password]=e}),e,!this.props.busy&&o.a.createElement("input",{className:"mx_Login_submit",type:"submit",value:Object(u.b)("Sign in"),disabled:this.props.disableSubmit})))}}i()(I,"defaultProps",{onUsernameChanged:function(){},onUsernameBlur:function(){},onPhoneCountryChanged:function(){},onPhoneNumberChanged:function(){},loginIncorrect:!1,disableSubmit:!1});var T=n(183),P=n(38),N=n(1368),D=n(1443),M=n(1334),A=n(1333),L=n(29),U=n(53),F=n(1441);function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function V(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}Object(u.d)("Invalid homeserver discovery response"),Object(u.d)("Failed to get autodiscovery configuration from server"),Object(u.d)("Invalid base_url for m.homeserver"),Object(u.d)("Homeserver URL does not appear to be a valid Matrix homeserver"),Object(u.d)("Invalid identity server discovery response"),Object(u.d)("Invalid base_url for m.identity_server"),Object(u.d)("Identity server URL does not appear to be a valid identity server"),Object(u.d)("General failure");class W extends o.a.PureComponent{constructor(e){super(e),i()(this,"unmounted",!1),i()(this,"oidcNativeFlowEnabled",!1),i()(this,"loginLogic",void 0),i()(this,"stepRendererMap",void 0),i()(this,"isBusy",(()=>!!this.state.busy||!!this.props.busy)),i()(this,"onPasswordLogin",(async(e,t,n,a)=>{if(!this.state.serverIsAlive){this.setState({busy:!0});let e=!0;try{await p.a.validateServerConfigWithStaticUrls(this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl),this.setState({serverIsAlive:!0,errorText:""})}catch(t){const n=p.a.authComponentStateForError(t);this.setState(V({busy:!1,busyLoggingIn:!1},n)),e=!n.serverErrorIsFatal}if(!e)return}this.setState({busy:!0,busyLoggingIn:!0,errorText:null,loginIncorrect:!1}),this.loginLogic.loginViaPassword(e,t,n,a).then((e=>{this.setState({serverIsAlive:!0}),this.props.onLoggedIn(e,a)}),(t=>{if(this.unmounted)return;let n;n=400===t.httpStatus&&e&&e.indexOf("@")>0?Object(u.b)("This homeserver does not support login using email address."):Object(h.c)(t,this.props.serverConfig),this.setState({busy:!1,busyLoggingIn:!1,errorText:n,loginIncorrect:401===t.httpStatus||403===t.httpStatus})}))})),i()(this,"onUsernameChanged",(e=>{this.setState({username:e})})),i()(this,"onUsernameBlur",(async e=>{const t="@"===e[0];if(this.setState({username:e,busy:t,errorText:null,canTryLogin:!0}),t){const t=e.split(":").slice(1).join(":");try{const e=await p.a.validateServerName(t);this.props.onServerConfigChange(e),this.setState({busy:!1})}catch(e){c.a.error("Problem parsing URL or unhandled error doing .well-known discovery:",e);let t=Object(u.b)("Failed to perform homeserver discovery");e instanceof u.a&&e.translatedMessage&&(t=e.translatedMessage);let n=t,a={};p.a.isLivelinessError(e)&&(n=this.state.errorText,a=p.a.authComponentStateForError(e)),this.setState(V({busy:!1,errorText:n},a))}}})),i()(this,"onPhoneCountryChanged",(e=>{this.setState({phoneCountry:e})})),i()(this,"onPhoneNumberChanged",(e=>{this.setState({phoneNumber:e})})),i()(this,"onRegisterClick",(e=>{e.preventDefault(),e.stopPropagation(),this.props.onRegisterClick()})),i()(this,"onTryRegisterClick",(e=>{var t,n;const a=null===(t=this.state.flows)||void 0===t?void 0:t.find((e=>"m.login.password"===e.type)),i=null===(n=this.state.flows)||void 0===n?void 0:n.find((e=>"m.login.sso"===e.type||"m.login.cas"===e.type));if(i&&!a){var r;e.preventDefault(),e.stopPropagation();const t="m.login.sso"===i.type?"sso":"cas";null===(r=b.a.get())||void 0===r||r.startSingleSignOn(this.loginLogic.createTemporaryClient(),t,this.props.fragmentAfterLogin,void 0,d.c.REGISTER)}else this.onRegisterClick(e)})),i()(this,"isSupportedFlow",(e=>!!this.stepRendererMap[e.type]||(c.a.log("Skipping flow",e,"due to unsupported login type",e.type),!1))),i()(this,"renderPasswordStep",(()=>o.a.createElement(I,{onSubmit:this.onPasswordLogin,username:this.state.username,phoneCountry:this.state.phoneCountry,phoneNumber:this.state.phoneNumber,onUsernameChanged:this.onUsernameChanged,onUsernameBlur:this.onUsernameBlur,onPhoneCountryChanged:this.onPhoneCountryChanged,onPhoneNumberChanged:this.onPhoneNumberChanged,onForgotPasswordClick:this.props.onForgotPasswordClick,loginIncorrect:this.state.loginIncorrect,serverConfig:this.props.serverConfig,disableSubmit:this.isBusy(),busy:this.props.isSyncing||this.state.busyLoggingIn}))),i()(this,"renderOidcNativeStep",(()=>{const e=this.state.flows.find((e=>"oidcNativeFlow"===e.type));return o.a.createElement(E.a,{className:"mx_Login_fullWidthButton",kind:"primary",onClick:async()=>{await Object(F.b)(this.props.serverConfig.delegatedAuthentication,e.clientId,this.props.serverConfig.hsUrl,this.props.serverConfig.isUrl)}},Object(u.b)("Continue"))})),i()(this,"renderSsoStep",(e=>{var t,n;const a=null===(t=this.state.flows)||void 0===t?void 0:t.find((t=>t.type==="m.login."+e));return o.a.createElement(N.a,{matrixClient:this.loginLogic.createTemporaryClient(),flow:a,loginType:e,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!(null!==(n=this.state.flows)&&void 0!==n&&n.find((e=>"m.login.password"===e.type))),action:d.c.LOGIN})})),this.oidcNativeFlowEnabled=v.b.getValue(U.a.OidcNativeFlow),this.state={busy:!1,errorText:null,loginIncorrect:!1,canTryLogin:!0,username:e.defaultUsername?e.defaultUsername:"",phoneCountry:"",phoneNumber:"",serverIsAlive:!0,serverErrorIsFatal:!1,serverDeadError:""},this.stepRendererMap={"m.login.password":this.renderPasswordStep,"m.login.cas":()=>this.renderSsoStep("cas"),"m.login.sso":()=>this.renderSsoStep("sso"),oidcNativeFlow:()=>this.renderOidcNativeStep()}}componentDidMount(){this.initLoginLogic(this.props.serverConfig)}componentWillUnmount(){this.unmounted=!0}componentDidUpdate(e){e.serverConfig.hsUrl===this.props.serverConfig.hsUrl&&e.serverConfig.isUrl===this.props.serverConfig.isUrl&&e.serverConfig.delegatedAuthentication===this.props.serverConfig.delegatedAuthentication||this.initLoginLogic(this.props.serverConfig)}async checkServerLiveliness({hsUrl:e,isUrl:t}){try{const{warning:n}=await p.a.validateServerConfigWithStaticUrls(e,t);n?this.setState(V(V({},p.a.authComponentStateForError(n)),{},{errorText:""})):this.setState({serverIsAlive:!0,errorText:""})}catch(e){this.setState(V({busy:!1},p.a.authComponentStateForError(e)))}}async initLoginLogic({hsUrl:e,isUrl:t}){let n=!1;this.props.serverConfig.isDefault&&e===this.props.serverConfig.hsUrl&&t===this.props.serverConfig.isUrl&&(n=!0);const a=n?this.props.fallbackHsUrl:null;this.setState({busy:!0,loginIncorrect:!1}),await this.checkServerLiveliness({hsUrl:e,isUrl:t});const i=new m.a(e,t,a,{defaultDeviceDisplayName:this.props.defaultDeviceDisplayName,delegatedAuthentication:this.oidcNativeFlowEnabled?this.props.serverConfig.delegatedAuthentication:void 0});this.loginLogic=i,i.getFlows().then((e=>{const t=e.filter(this.isSupportedFlow);this.setState({flows:t}),0===t.length&&this.setState({errorText:Object(u.b)("This homeserver doesn't offer any login flows that are supported by this client.")})}),(e=>{this.setState({errorText:Object(h.b)(e,this.props.serverConfig),loginIncorrect:!1,canTryLogin:!1})})).finally((()=>{this.setState({busy:!1})}))}renderLoginComponentForFlows(){if(!this.state.flows)return null;const e=Object(L.m)(["oidcNativeFlow","m.login.password","m.login.sso"].map((e=>{var t;return null===(t=this.state.flows)||void 0===t?void 0:t.find((t=>t.type===e))})));return o.a.createElement(o.a.Fragment,null,e.map((e=>{const t=this.stepRendererMap[e.type];return o.a.createElement(o.a.Fragment,{key:e.type},t())})))}render(){const e=this.isBusy()&&!this.state.busyLoggingIn?o.a.createElement("div",{className:"mx_Login_loader"},o.a.createElement(P.a,null)):null,t=this.state.errorText;let n,a,i;if(t&&(n=o.a.createElement("div",{className:"mx_Login_error"},t)),!this.state.serverIsAlive){const e=l()({mx_Login_error:!0,mx_Login_serverError:!0,mx_Login_serverErrorNonFatal:!this.state.serverErrorIsFatal});a=o.a.createElement("div",{className:e},this.state.serverDeadError)}return this.props.isSyncing||this.state.busyLoggingIn?i=o.a.createElement("div",{className:"mx_AuthBody_paddedFooter"},o.a.createElement("div",{className:"mx_AuthBody_paddedFooter_title"},o.a.createElement(T.a,{w:20,h:20}),this.props.isSyncing?Object(u.b)("Syncing…"):Object(u.b)("Signing In…")),this.props.isSyncing&&o.a.createElement("div",{className:"mx_AuthBody_paddedFooter_subtitle"},Object(u.b)("If you've joined lots of rooms, this might take a while"))):v.b.getValue(f.b.Registration)&&(i=o.a.createElement("span",{className:"mx_AuthBody_changeFlow"},Object(u.b)("New? <a>Create account</a>",{},{a:e=>o.a.createElement(E.a,{kind:"link_inline",onClick:this.onTryRegisterClick},e)}))),o.a.createElement(g.a,null,o.a.createElement(A.a,{disableLanguageSelector:this.props.isSyncing||this.state.busyLoggingIn}),o.a.createElement(M.a,null,o.a.createElement("h1",null,Object(u.b)("Sign in"),e),n,a,o.a.createElement(D.a,{serverConfig:this.props.serverConfig,onServerConfigChange:this.props.onServerConfigChange}),this.renderLoginComponentForFlows(),i))}}},1597:function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return o}));var a=n(1),i=n.n(a),r=n(3);let o=function(e){return e.APP_STARTUP="mx_AppStartup",e.PAGE_CHANGE="mx_PageChange",e.RESEND_EVENT="mx_ResendEvent",e.SEND_E2EE_EVENT="mx_SendE2EEEvent",e.SEND_ATTACHMENT="mx_SendAttachment",e.SWITCH_ROOM="mx_SwithRoom",e.JUMP_TO_ROOM="mx_JumpToRoom",e.JOIN_ROOM="mx_JoinRoom",e.CREATE_DM="mx_CreateDM",e.PEEK_ROOM="mx_PeekRoom",e.VERIFY_E2EE_USER="mx_VerifyE2EEUser",e.LOGIN="mx_Login",e.REGISTER="mx_Register",e.SETUP_VOIP_CALL="mx_SetupVoIPCall",e}({});class s{constructor(){i()(this,"START_PREFIX","start:"),i()(this,"STOP_PREFIX","stop:"),i()(this,"listeners",[]),i()(this,"entries",[])}static get instance(){return s._instance||(s._instance=new s),s._instance}start(e,t){if(!this.supportsPerformanceApi())return;const n=this.buildKey(e,t);performance.getEntriesByName(this.START_PREFIX+n).length>0?r.a.warn(`Recording already started for: ${e}`):performance.mark(this.START_PREFIX+n)}stop(e,t){if(!this.supportsPerformanceApi())return;const n=this.buildKey(e,t);if(0===performance.getEntriesByName(this.START_PREFIX+n).length)return void r.a.warn(`No recording started for: ${e}`);performance.mark(this.STOP_PREFIX+n),performance.measure(n,this.START_PREFIX+n,this.STOP_PREFIX+n),this.clear(e,t);const a=performance.getEntriesByName(n).pop();return this.entries.push(a),this.listeners.forEach((e=>{this.shouldEmit(e,a)&&e.callback([a])})),a}clear(e,t){if(!this.supportsPerformanceApi())return;const n=this.buildKey(e,t);performance.clearMarks(this.START_PREFIX+n),performance.clearMarks(this.STOP_PREFIX+n)}getEntries({name:e,type:t}={}){return this.entries.filter((n=>{const a=!e||n.name===e,i=!t||n.entryType===t;return a&&i}))}addPerformanceDataCallback(e,t=!1){if(this.listeners.push(e),t){const t=this.entries.filter((t=>this.shouldEmit(e,t)));t.length>0&&e.callback(t)}}removePerformanceDataCallback(e){e?this.listeners.splice(this.listeners.findIndex((t=>t.callback===e)),1):this.listeners=[]}supportsPerformanceApi(){return void 0!==performance&&void 0!==performance.mark}shouldEmit(e,t){return!e.entryNames||e.entryNames.includes(t.name)}buildKey(e,t){return`${e}${t?`:${t}`:""}`}}i()(s,"_instance",void 0),window.mxPerformanceMonitor=s.instance,window.mxPerformanceEntryNames=o},1598:function(e,t,n){"use strict";n.d(t,"a",(function(){return j}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3),l=n(528),c=n(12),d=n(2),u=n(9),m=n(1327),h=n(11),p=n(7),g=n(1344),b=n(1315),v=n(1316),f=n(1368),y=n(34),E=n(60);class w extends o.a.Component{constructor(...e){super(...e),i()(this,"onConfirm",(()=>{this.props.onFinished(!0)})),i()(this,"onDecline",(()=>{this.props.onFinished(!1)}))}render(){return o.a.createElement(y.a,{className:"mx_ConfirmWipeDeviceDialog",hasCancel:!0,onFinished:this.props.onFinished,title:Object(d.b)("Clear all data in this session?")},o.a.createElement("div",{className:"mx_ConfirmWipeDeviceDialog_content"},o.a.createElement("p",null,Object(d.b)("Clearing all data from this session is permanent. Encrypted messages will be lost unless their keys have been backed up."))),o.a.createElement(E.a,{primaryButton:Object(d.b)("Clear all data"),onPrimaryButtonClick:this.onConfirm,primaryButtonClass:"danger",cancelButton:Object(d.b)("Cancel"),onCancel:this.onDecline}))}}var S=n(46),_=n(10),C=n(38),O=n(1333),x=n(1334),k=function(e){return e[e.Loading=0]="Loading",e[e.Password=1]="Password",e[e.CAS=2]="CAS",e[e.SSO=3]="SSO",e[e.PasswordWithSocialSignOn=4]="PasswordWithSocialSignOn",e[e.Unsupported=5]="Unsupported",e}(k||{});const R={"m.login.password":k.Password,"m.login.cas":k.CAS,"m.login.sso":k.SSO};class j extends o.a.Component{constructor(e){super(e),i()(this,"onClearAll",(()=>{h.b.createDialog(w,{onFinished:e=>{e&&(s.a.log("Clearing data from soft-logged-out session"),m.i())}})})),i()(this,"onPasswordChange",(e=>{this.setState({password:e.target.value})})),i()(this,"onForgotPassword",(()=>{u.a.dispatch({action:"start_password_recovery"})})),i()(this,"onPasswordLogin",(async e=>{var t;e.preventDefault(),e.stopPropagation(),this.setState({busy:!0});const n=p.a.safeGet(),a=n.getHomeserverUrl(),i=n.getIdentityServerUrl(),r={identifier:{type:"m.id.user",user:n.getUserId()},password:this.state.password,device_id:null!==(t=n.getDeviceId())&&void 0!==t?t:void 0};let o;try{o=await Object(g.b)(a,i,"m.login.password",r)}catch(e){let t=Object(d.b)("Failed to re-authenticate due to a homeserver problem");return e instanceof c.f&&"M_FORBIDDEN"===e.errcode&&(401===e.httpStatus||403===e.httpStatus)&&(t=Object(d.b)("Incorrect password")),void this.setState({busy:!1,errorText:t})}m.e(o).catch((e=>{s.a.error(e),this.setState({busy:!1,errorText:Object(d.b)("Failed to re-authenticate")})}))})),this.state={loginView:k.Loading,keyBackupNeeded:!0,busy:!1,password:"",errorText:"",flows:[]}}componentDidMount(){if(!m.g())return void u.a.dispatch({action:"start_login"});this.initLogin();const e=p.a.safeGet();e.isCryptoEnabled()&&e.countSessionsNeedingBackup().then((e=>{this.setState({keyBackupNeeded:e>0})}))}async initLogin(){const e=this.props.realQueryParams;if(null==e?void 0:e.loginToken)return this.setState({loginView:k.Loading}),void this.trySsoLogin();const t=p.a.safeGet(),n=(await t.loginFlows()).flows,a=n.map((e=>R[e.type])),i=a.includes(k.Password)&&a.includes(k.SSO),r=a.filter((e=>!!e))[0]||k.Unsupported,o=i?k.PasswordWithSocialSignOn:r;this.setState({flows:n,loginView:o})}async trySsoLogin(){var e;this.setState({busy:!0});const t=localStorage.getItem(v.a);if(!t)return s.a.error("Homeserver URL unknown for SSO login callback"),void this.setState({busy:!1,loginView:k.Unsupported});const n=localStorage.getItem(v.c)||p.a.safeGet().getIdentityServerUrl(),a={token:this.props.realQueryParams.loginToken,device_id:null!==(e=p.a.safeGet().getDeviceId())&&void 0!==e?e:void 0};let i;try{i=await Object(g.b)(t,n,"m.login.token",a)}catch(e){return s.a.error(e),void this.setState({busy:!1,loginView:k.Unsupported})}m.e(i).then((()=>{this.props.onTokenLoginCompleted&&this.props.onTokenLoginCompleted()})).catch((e=>{s.a.error(e),this.setState({busy:!1,loginView:k.Unsupported})}))}renderPasswordForm(e){let t;return this.state.errorText&&(t=o.a.createElement("span",{className:"mx_Login_error"},this.state.errorText)),o.a.createElement("form",{onSubmit:this.onPasswordLogin},e?o.a.createElement("p",null,e):null,t,o.a.createElement(S.a,{type:"password",label:Object(d.b)("Password"),onChange:this.onPasswordChange,value:this.state.password,disabled:this.state.busy}),o.a.createElement(_.a,{onClick:this.onPasswordLogin,kind:"primary",type:"submit",disabled:this.state.busy},Object(d.b)("Sign In")),o.a.createElement(_.a,{onClick:this.onForgotPassword,kind:"link"},Object(d.b)("Forgotten your password?")))}renderSsoForm(e){const t=this.state.loginView===k.CAS?"cas":"sso",n=this.state.flows.find((e=>e.type==="m.login."+t));return o.a.createElement("div",null,e?o.a.createElement("p",null,e):null,o.a.createElement(f.a,{matrixClient:p.a.safeGet(),flow:n,loginType:t,fragmentAfterLogin:this.props.fragmentAfterLogin,primary:!this.state.flows.find((e=>"m.login.password"===e.type)),action:l.c.LOGIN}))}renderSignInSection(){if(this.state.loginView===k.Loading)return o.a.createElement(C.a,null);let e=null;return this.state.keyBackupNeeded&&(e=Object(d.b)("Regain access to your account and recover encryption keys stored in this session. Without them, you won't be able to read all of your secure messages in any session.")),this.state.loginView===k.Password?(e||(e=Object(d.b)("Enter your password to sign in and regain access to your account.")),this.renderPasswordForm(e)):this.state.loginView===k.SSO||this.state.loginView===k.CAS?(e||(e=Object(d.b)("Sign in and regain access to your account.")),this.renderSsoForm(e)):this.state.loginView===k.PasswordWithSocialSignOn?(e||(e=Object(d.b)("Sign in and regain access to your account.")),o.a.createElement(o.a.Fragment,null,o.a.createElement("p",null,e),this.renderSsoForm(null),o.a.createElement("h2",{className:"mx_AuthBody_centered"},Object(d.b)("%(ssoButtons)s Or %(usernamePassword)s",{ssoButtons:"",usernamePassword:""}).trim()),this.renderPasswordForm(null))):o.a.createElement("p",null,Object(d.b)("You cannot sign in to your account. Please contact your homeserver admin for more information."))}render(){return o.a.createElement(b.a,null,o.a.createElement(O.a,null),o.a.createElement(x.a,null,o.a.createElement("h1",null,Object(d.b)("You're signed out")),o.a.createElement("h2",null,Object(d.b)("Sign in")),o.a.createElement("div",null,this.renderSignInSection()),o.a.createElement("h2",null,Object(d.b)("Clear personal data")),o.a.createElement("p",null,Object(d.b)("Warning: your personal data (including encryption keys) is still stored in this session. Clear it if you're finished using this session, or want to sign in to another account.")),o.a.createElement("div",null,o.a.createElement(_.a,{onClick:this.onClearAll,kind:"danger"},Object(d.b)("Clear all data")))))}}},1599:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var a=n(1),i=n.n(a),r=n(39),o=n(0),s=n.n(o),l=n(4),c=n(648),d=n(2),u=n(7),m=n(11),h=n(25),p=n(15),g=n(5),b=n(17),v=n.n(b),f=n(13),y=n.n(f),E=n(70);function w({label:e,description:t,onClick:n,isSelected:a,adornment:i}){return s.a.createElement(c.a,{active:a,className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--item",onClick:n},s.a.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},s.a.createElement("span",null,e),s.a.createElement("span",null,t)),i)}function S({label:e,description:t,adornment:n,children:a}){return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--header"},s.a.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},s.a.createElement("span",null,e),s.a.createElement("span",null,t)),n),a)}function _(e){return"options"in e}function C({value:e,onChange:t,options:n,selectedLabel:a,onOpen:i,onClose:r,toKey:o,className:l,AdditionalOptions:c}){const[d,u,m,h]=Object(E.q)(),p=n.flatMap((e=>_(e)?[e,...e.options]:[e])).find((t=>o?o(t.key)===o(e):t.key===e));let g;g=n&&_(n[0])?s.a.createElement(s.a.Fragment,null,n.map((e=>{var n;return s.a.createElement(S,{key:null!==(n=null==o?void 0:o(e.key))&&void 0!==n?n:e.key,label:e.label,description:e.description,adornment:e.adornment},e.options.map((e=>{var n;return s.a.createElement(w,{key:null!==(n=null==o?void 0:o(e.key))&&void 0!==n?n:e.key,label:e.label,description:e.description,onClick:n=>{t(e.key),h(),null==r||r(n)},adornment:e.adornment,isSelected:e===p})})))}))):s.a.createElement(s.a.Fragment,null,n.map((e=>{var n;return s.a.createElement(w,{key:null!==(n=null==o?void 0:o(e.key))&&void 0!==n?n:e.key,label:e.label,description:e.description,onClick:n=>{t(e.key),h(),null==r||r(n)},adornment:e.adornment,isSelected:e===p})})));const b=d&&u.current?s.a.createElement(E.n,v()({onFinished:h,chevronFace:E.a.Top,wrapperClassName:y()("mx_GenericDropdownMenu_wrapper",l)},Object(E.i)(u.current.getBoundingClientRect())),g,c&&s.a.createElement(c,{menuDisplayed:d,openMenu:m,closeMenu:h})):null;return s.a.createElement(s.a.Fragment,null,s.a.createElement(E.b,{className:"mx_GenericDropdownMenu_button",inputRef:u,isExpanded:d,onClick:e=>{m(),null==i||i(e)}},a(p)),b)}var O=n(469),x=n(10),k=n(229);function R(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}const j=Object(k.a)({deriveData:async({value:e})=>{try{return await u.a.safeGet().publicRooms({limit:1,server:null!=e?e:void 0}),{}}catch(e){return{error:e}}},rules:[{key:"required",test:async({value:e})=>!!e,invalid:()=>Object(d.b)("Enter a server name")},{key:"available",final:!0,test:async(e,{error:t})=>!t,valid:()=>Object(d.b)("Looks good"),invalid:({error:e})=>e instanceof l.MatrixError&&"M_FORBIDDEN"===e.errcode?Object(d.b)("You are not allowed to view this server's rooms list"):Object(d.b)("Can't find this server or its room list")}],memoize:!0});function I(e,...t){for(const n of t)e.delete(n)}function T(){var e,t;const[n,a]=function(e,t,n=null,a=!1){const[i,r]=Object(o.useState)(g.b.getValue(e,null!=n?n:void 0,a)),s=Object(o.useCallback)((async a=>{r(a),g.b.setValue(e,n,t,a)}),[t,n,e]);return Object(o.useEffect)((()=>{const t=g.b.watchSetting(e,n,(()=>{r(g.b.getValue(e,n,a))}));return()=>{g.b.unwatchSetting(t)}}),[e,n,a]),[i,s]}("room_directory_servers",p.a.ACCOUNT),i=u.a.getHomeserverName(),r=new Set(null!==(e=null===(t=h.b.getObject("room_directory"))||void 0===t?void 0:t.get("servers"))&&void 0!==e?e:[]);I(r,i);const s=new Set(n);return I(s,i),I(s,...r),{allServers:[i,...Array.from(r).sort(),...Array.from(s).sort()],homeServer:i,userDefinedServers:Array.from(s).sort(),setUserDefinedServers:a}}const P=({protocols:e,config:t,setConfig:n})=>{const{allServers:a,homeServer:l,userDefinedServers:u,setUserDefinedServers:h}=T(),p=a.map((t=>function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?R(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({key:{roomServer:t,instanceId:void 0},label:t,description:t===l?Object(d.b)("Your server"):null,options:[{key:{roomServer:t,instanceId:void 0},label:Object(d.b)("Matrix")},...t===l&&e?Object.values(e).flatMap((e=>e.instances)).map((e=>({key:{roomServer:t,instanceId:e.instance_id},label:e.desc}))):[]]},u.includes(t)?{adornment:s.a.createElement(x.a,{className:"mx_NetworkDropdown_removeServer",alt:Object(d.b)("Remove server “%(roomServer)s”",{roomServer:t}),onClick:()=>h(Object(r.without)(u,t))})}:{}))),g=Object(o.useCallback)((({closeMenu:e})=>s.a.createElement(s.a.Fragment,null,s.a.createElement("span",{className:"mx_GenericDropdownMenu_divider"}),s.a.createElement(c.a,{active:!1,className:"mx_GenericDropdownMenu_Option mx_GenericDropdownMenu_Option--item",onClick:async()=>{e();const{finished:t}=m.b.createDialog(O.a,{title:Object(d.b)("Add a new server"),description:Object(d.b)("Enter the name of a new server you want to explore."),button:Object(d.b)("Add"),hasCancel:!1,placeholder:Object(d.b)("Server name"),validator:j,fixedWidth:!1},"mx_NetworkDropdown_dialog"),[i,r]=await t;i&&(a.includes(r)||(h([...u,r]),n({roomServer:r})))}},s.a.createElement("div",{className:"mx_GenericDropdownMenu_Option--label"},s.a.createElement("span",{className:"mx_NetworkDropdown_addServer"},Object(d.b)("Add new server…")))))),[a,n,h,u]);return s.a.createElement(C,{className:"mx_NetworkDropdown_wrapper",value:t,toKey:e=>e?`${e.roomServer}-${e.instanceId}`:"null",options:p,onChange:e=>n(e),selectedLabel:e=>null!=e&&e.key?Object(d.b)("Show: %(instance)s rooms (%(server)s)",{server:e.key.roomServer,instance:e.key.instanceId?e.label:"Matrix"}):Object(d.b)("Show: Matrix rooms"),AdditionalOptions:g})}},641:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));let a=function(e){return e.CanChangeViewedRoom="io.element.view_room",e.RequiresClient="io.element.requires_client",e}({})}}]);
//# sourceMappingURL=vendors~element-web-app.js.map